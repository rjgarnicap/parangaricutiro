var NL=Object.defineProperty;var zL=(s,i,t)=>i in s?NL(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var h=(s,i,t)=>(zL(s,typeof i!="symbol"?i+"":i,t),t),Ib=(s,i,t)=>{if(!i.has(s))throw TypeError("Cannot "+t)};var De=(s,i,t)=>(Ib(s,i,"read from private field"),t?t.call(s):i.get(s)),ji=(s,i,t)=>{if(i.has(s))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(s):i.set(s,t)},Gi=(s,i,t,n)=>(Ib(s,i,"write to private field"),n?n.call(s,t):i.set(s,t),t);var Ph=(s,i,t)=>(Ib(s,i,"access private method"),t);import{V as ae,a as x,b as Ue,Q as se,B as Wc,c as Je,d as Vt,C as xe,D as _i,E as cc,F as Lr,e as il,L as Mt,M as Z,f as _t,O as ne,P as tc,g as pr,S as et,T as At,h as Xa,i as Pu,j as bt,k as ws,U as ee,W as Mu,l as Cn,m as Jn,n as Gt,o as mP,p as AP,G as SC,q as mt,r as za,s as le,t as mo,u as QL,v as Xs,w as Et,x as mi,y as He,z as EC,A as jL,H as GL,I as vP,J as zi,N as xu,R as yP,K as Qv,X as IC,Y as HL,Z as Zt,_ as Ao,$ as qi,a0 as ic,a1 as ym,a2 as bP,a3 as Js,a4 as Uf,a5 as _P,a6 as Dw,a7 as wP,a8 as TC,a9 as xP,aa as CP,ab as SP,ac as EP,ad as VL,ae as qc,af as Md,ag as WL,ah as Ow,ai as IP,aj as ch,ak as tf,al as RC,am as Ng,an as zg,ao as _o,ap as qL,aq as kc,ar as XL,as as YL,at as Fp,au as Zo,av as Nr,aw as $o,ax as xf,ay as ms,az as KL,aA as fv,aB as Fr,aC as ct,aD as ku,aE as BC,aF as ql,aG as jv,aH as PC,aI as g1,aJ as TP,aK as RP,aL as BP,aM as Gv,aN as Hv,aO as PP,aP as Xc,aQ as Vv,aR as Lw,aS as Wv,aT as hc,aU as JL,aV as ZL,aW as $L,aX as eF,aY as tF,aZ as iF,a_ as nF,a$ as sF,b0 as rF,b1 as oF,b2 as aF,b3 as lF,b4 as nf,b5 as $n,b6 as cF,b7 as hF,b8 as uF,b9 as m1,ba as MP,bb as gh,bc as dr,bd as kP,be as dF,bf as on,bg as fF,bh as pF,bi as gF,bj as DP,bk as Ns,bl as mF,bm as Du,bn as AF,bo as OP,bp as vF,bq as yF,br as ln,bs as sA,bt as lp,bu as LP,bv as kd,bw as Vs,bx as Vn,by as Ya,bz as Cf,bA as bF,bB as _F,bC as pv,bD as wF,bE as FP,bF as xF,bG as CF,bH as SF,bI as Fw,bJ as MC,bK as ad,bL as ld,bM as A1,bN as v1,bO as EF,bP as IF,bQ as Uw,bR as TF,bS as UP,bT as Qg,bU as r0,bV as kC,bW as DC,bX as o0,bY as RF,bZ as BF,b_ as PF,b$ as MF,c0 as kF,c1 as DF,c2 as OF,c3 as LF,c4 as FF,c5 as UF,c6 as NF,c7 as zF,c8 as QF,c9 as jF,ca as GF,cb as y1,cc as HF,cd as NP,ce as VF,cf as b1,cg as zP,ch as WF,ci as qF,cj as XF,ck as QP,cl as Nw,cm as YF,cn as a0,co as sf,cp as OC,cq as l0,cr as jP,cs as KF,ct as JF,cu as ZF,cv as Hs,cw as $F,cx as eU,cy as tU,cz as iU,cA as nU}from"./three.module-19edce0d.js";import{_ as hh}from"./index-bff7ab54.js";let GP,_1=null;function nl(){return GP}function HP(s){if(s==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}_1!==s&&(_1=s,GP=new s)}const Tb=new Map;function fr(s=(i=>(i=globalThis.location)==null?void 0:i.hostname)()){if(Tb.has(s))return Tb.get(s);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(s);return Tb.set(s,t),t===!0}function sU(){return window.location.hostname.includes("glitch.me")}var ut;(function(s){s.ContextRegistered="ContextRegistered",s.ContextCreationStart="ContextCreationStart",s.ContextCreated="ContextCreated",s.ContextFirstFrameRendered="ContextFirstFrameRendered",s.ContextDestroying="ContextDestroying",s.ContextDestroyed="ContextDestroyed",s.MissingCamera="MissingCamera",s.ContextClearing="ContextClearing",s.ContextCleared="ContextCleared"})(ut||(ut={}));class xt{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(i){globalThis["NeedleEngine.Context.Current"]=i}static get All(){return this.Registered}static register(i){this.Registered.push(i),this.dispatchCallback(ut.ContextRegistered,i)}static unregister(i){const t=this.Registered.indexOf(i);t!==-1&&this.Registered.splice(t,1)}static registerCallback(i,t){this._callbacks[i]||(this._callbacks[i]=[]),this._callbacks[i].push(t)}static unregisterCallback(i,t){if(!this._callbacks[i])return;const n=this._callbacks[i].indexOf(t);n!==-1&&this._callbacks[i].splice(n,1)}static dispatchCallback(i,t,n){if(!this._callbacks[i])return!0;const r={event:i,context:t};if(n)for(const a in n)r[a]=n[a];const o=new Array;return this._callbacks[i].forEach(a=>{const l=a(r);l instanceof Promise&&o.push(l)}),Promise.all(o)}static addContextCreatedCallback(i){this.registerCallback(ut.ContextCreated,i)}static addContextDestroyedCallback(i){this.registerCallback(ut.ContextDestroyed,i)}}h(xt,"Registered",[]),h(xt,"_callbacks",{});const rU=()=>s=>s;function WY(s){return rU()(s)}function qY(){return!!Q("debug")}class wo{constructor(i,t){h(this,"_factory");h(this,"_cache",[]);h(this,"_maxSize");h(this,"_index",0);this._factory=i,this._maxSize=t}get(){const i=this._index%this._maxSize;return this._index++,this._cache.length<=i&&(this._cache[i]=this._factory()),this._cache[i]}}let Wh=!1;const zw=new Array;typeof window<"u"&&setTimeout(()=>{if(Wh){const s={},i=new URL(window.location.href),t=new URL(i);t.searchParams.append("console","");const n=t.toString().replace(/=$|=(?=&)/g,"");for(const o of zw){const a=new URL(i);a.searchParams.append(o,""),s[o]=a.toString().replace(/=$|=(?=&)/g,"")}console.log(`ðŸŒµ ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${n} will show an onscreen console window.`);const r=Wh===!0?"":` (containing "${Wh}")`;console.group("Available URL parameters:"+r);for(const o in s)typeof Wh=="string"&&!o.toLowerCase().includes(Wh.toLowerCase())||(console.groupCollapsed(o),console.log("Reload with this flag enabled:"),console.log(s[o]),console.groupEnd());console.groupEnd()}},100);function c0(){var s;return new URLSearchParams((s=globalThis.location)==null?void 0:s.search)}function Q(s){Wh&&!zw.includes(s)&&zw.push(s);const i=c0();if(i.has(s)){const t=i.get(s);if(t){const n=Number(t);return isNaN(n)?t:n}else return!0}return!1}Wh=Q("help");function XY(s,i){const t=c0();t.has(s)?t.set(s,i):t.append(s,i),document.location.search=t.toString()}function Qw(s,i,t=!0){const n=c0();n.has(s)?i===null?n.delete(s):n.set(s,i):i!==null&&n.append(s,i),t?oU(s,n):VP(s,n)}function w1(s,i,t){s.has(i)?s.set(i,t.toString()):s.append(i,t.toString())}function oU(s,i,t){window.history.pushState(t,s,"?"+i.toString())}function VP(s,i,t){window.history.replaceState(t,s,"?"+i.toString())}function YY(s){for(var i="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,r=0;r<s;r++)i+=t.charAt(Math.floor(Math.random()*n));return i}function KY(s,i){return Math.floor(Math.random()*(i-s+1))+s}const x1=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],C1=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function aU(){const s=x1[Math.floor(Math.random()*x1.length)],i=C1[Math.floor(Math.random()*C1.length)];return s+"_"+i}function lU(s){return s=s.replace(/[^a-z0-9Ã¡Ã©Ã­Ã³ÃºÃ±Ã¼ \.,_-]/gim,""),s.trim()}function jg(s,i,t=!0,n=!1){var r;if(i==null)return null;if(i.userData&&i.userData.guid===s)return i;if(i.guid==s)return i;if(n&&(r=i.userData)!=null&&r.components){for(const o of i.userData.components)if(o.guid===s)return o}if(t){if(i.scenes)for(const o in i.scenes){const a=i.scenes[o],l=jg(s,a,t,n);if(l)return l}if(i.children)for(const o in i.children){const a=i.children[o],l=jg(s,a,t,n);if(l)return l}}}function h0(s,i){if(s!=null&&typeof s=="object"){let t;Array.isArray(s)?t=[]:(t=Object.create(s),Object.assign(t,s));for(const n of Object.keys(s)){const r=s[n];i&&!i(s,n,r)?t[n]=r:(r==null?void 0:r.clone)!==void 0&&typeof r.clone=="function"?t[n]=r.clone():t[n]=h0(r,i)}return t}return s}function nc(s){return new Promise((i,t)=>{setTimeout(i,s)})}function LC(s,i){if(s<=0)return Promise.resolve();if(i||(i=xt.Current),!i)return Promise.reject("No context");const t=i.time.frameCount+s;return new Promise((n,r)=>{if(!i)return r("No context");const o=()=>{i.time.frameCount>=t&&(i.pre_update_callbacks.splice(i.pre_update_callbacks.indexOf(o),1),n())};i.pre_update_callbacks.push(o)})}const rA=Q("debugresolveurl"),cU="rel:";function JY(s,i){return Ou(s,i)}function Ou(s,i){if(i===void 0)return rA&&console.warn("getPath: uri is undefined, returning uri",i),i;if(i.startsWith("./"))return i;if(i.startsWith("http"))return rA&&console.warn("getPath: uri is absolute, returning uri",i),i;if(s===void 0)return rA&&console.warn("getPath: source is undefined, returning uri",i),i;i.startsWith(cU)&&(i=i.substring(4));const t=s.lastIndexOf("/");if(t>=0){const n=s.substring(0,t+1);for(;n.endsWith("/")&&i.startsWith("/");)i=i.substring(1);const r=n+i;return rA&&console.log("source:",s,`changed uri 
from`,i,`
to `,r,`
basePath: `+n),r}return i}class hU{constructor(i,t){h(this,"writeCallbacks",[]);h(this,"_applied",!1);h(this,"_object");h(this,"_prop");h(this,"_wrapperProp");this._object=i,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(i){this.writeCallbacks.push(i)}unsubscribeWrite(i){const t=this.writeCallbacks.indexOf(i);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const i=this._object,t=this._prop;if(i[t]===void 0)return;this._applied=!0,i[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const n=i[t];i[this._wrapperProp]=n,Object.defineProperty(i,t,{get:()=>i[this._wrapperProp],set:a=>{i[this._wrapperProp]=a;for(const l of this.writeCallbacks)l(a,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const i=this._object,t=this._prop;Reflect.deleteProperty(i,t);const n=i[this._wrapperProp];i[t]=n,Reflect.deleteProperty(i,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Zc{constructor(i,t){h(this,"_watches",[]);if(Array.isArray(t))for(const n of t)this._watches.push(new Zc(i,n));else this._watches.push(new hU(i,t))}subscribeWrite(i){for(const t of this._watches)t.subscribeWrite(i)}unsubscribeWrite(i){for(const t of this._watches)t.unsubscribeWrite(i)}apply(){for(const i of this._watches)i.apply()}revoke(){for(const i of this._watches)i.revoke()}dispose(){for(const i of this._watches)i.dispose();this._watches.length=0}}const wd=Symbol("needle:watches");function FC(s,i){if(!s[wd])if(s instanceof ae)s[wd]=new Zc(s,["x","y"]);else if(s instanceof x)s[wd]=new Zc(s,["x","y","z"]);else if(s instanceof Ue||s instanceof se)s[wd]=new Zc(s,["x","y","z","w"]);else return!1;return s[wd].subscribeWrite(i),!0}function WP(s,i){if(!s)return;const t=s[wd];t&&t.unsubscribeWrite(i)}let Rb;function Gg(){if(Rb!==void 0)return Rb;const s=window.navigator.userAgent,i=/Windows|MacOS|Mac OS/.test(s),t=/Windows NT/.test(s)&&/Edg/.test(s)&&!/Win64/.test(s);return Rb=i&&!t&&!Cu()}let oA;function uc(){return oA!==void 0?oA:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?oA=!0:oA=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}function uU(){return/Android/.test(navigator.userAgent)}function rf(){return/WebXRViewer\//i.test(navigator.userAgent)}let aA;function S1(){if(aA!==void 0)return aA;if(navigator.userAgentData)return aA=navigator.userAgentData.platform==="macOS";{const s=navigator.userAgent.toLowerCase();return aA=s.includes("mac os x")||s.includes("macintosh")}}let Bb;const dU=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function Cu(){return Bb!==void 0?Bb:Bb=dU.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function $p(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function UC(){return navigator.userAgent.includes("OculusBrowser")}async function lA(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(s){return console.error("Error querying `microphone` permissions.",s),!1}}const fU=/ip=(?<ip>.+?)\n/s;async function ZY(){const i=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),t=fU.exec(i);return t?t[1]:null}async function $Y(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function eK(){return await(await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null)).json()}const Yc=new WeakMap;function pU(s,i,t){if(!Yc.get(s)){const r=new MutationObserver(o=>{mU(s,o)});Yc.set(s,{observer:r,attributeChangedListeners:new Map}),r.observe(s,{attributes:!0})}const n=Yc.get(s).attributeChangedListeners;n.has(i)||n.set(i,[]),n.get(i).push(t)}function gU(s,i,t){if(!Yc.get(s))return;const n=Yc.get(s).attributeChangedListeners;if(!n.has(i))return;const r=n.get(i),o=r.indexOf(t);if(o!==-1&&(r.splice(o,1),r.length<=0)){n.delete(i);const a=Yc.get(s);a==null||a.observer.disconnect(),Yc.delete(s)}}function mU(s,i){const t=Yc.get(s).attributeChangedListeners;for(const n of i)if(n.type==="attributes"){const r=n.attributeName,o=s.getAttribute(r);if(t.has(r))for(const a of t.get(r))a(o)}}class E1{constructor(i){h(this,"reason");this.reason=i}}async function NC(s){const i=await Promise.allSettled(s).catch(r=>[new E1(r.message)]);let t=!1;const n=i.map(r=>"value"in r?r.value:(t=!0,new E1(r.reason)));return{anyFailed:t,results:n}}async function AU(s){if(!globalThis.QRCode){const n="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let r=document.head.querySelector(`script[src="${n}"]`);r||(r=document.createElement("script"),r.src=n,document.head.appendChild(r)),await new Promise((o,a)=>{r.addEventListener("load",()=>{o(!0)})})}const i=globalThis.QRCode,t=s.domElement??document.createElement("div");return new i(t,{width:s.width??256,height:s.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.CorrectLevel.M,...s}),t}const qP=Q("debugdebug");let Hg=!1;(Q("noerrors")||Q("nooverlaymessages"))&&(Hg=!0);const Pb="needle_engine_global_error_container";var Yi;(function(s){s[s.Log=0]="Log",s[s.Warn=1]="Warn",s[s.Error=2]="Error"})(Yi||(Yi={}));function zC(){return KP}const jw=new Array;function vU(s){jw.push(s)}let Mb=!1;function yU(...s){if(!Mb){Mb=!0;try{for(let i=0;i<jw.length;i++)jw[i](...s)}catch(i){console.error(i)}Mb=!1}}const XP=console.error,YP=function(...s){XP.apply(console,s),wU(s),Qa(Yi.Error,s),Gw(...s)};function bU(s){Hg=!s,s?console.error=YP:console.error=XP}function tK(s){return bU(s)}function _U(){Hg||(qP&&console.warn("Patch console",window.location.hostname),console.error=YP,window.addEventListener("error",s=>{if(!s)return;const i=s.error;if(i===void 0){fr()&&console.warn("Received unknown error",s,s.target);return}Qa(Yi.Error,i,s.filename,s.lineno),Gw(s)},!0),window.addEventListener("unhandledrejection",s=>{Hg||s&&(s.reason?Qa(Yi.Error,s.reason.message,s.reason.stack):Qa(Yi.Error,"unhandled rejection"),Gw(s))}))}let KP=0;function Gw(...s){KP+=1,yU(...s)}function wU(s){if(Array.isArray(s))for(let i=0;i<s.length;i++){const t=s[i];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(s[i]="Some animated objects couldn't be found: see console for details")}}function Qa(s,i,t,n){if(Hg)return;const r=xt.Current,o=(r==null?void 0:r.domElement)??document.querySelector("needle-engine");if(o){if(Array.isArray(i)){let a="";for(let l=0;l<i.length;l++){let c=i[l];c instanceof Error&&(c=c.message),typeof c!="object"&&(l>0&&(a+=" "),a+=c)}i=a}!i||i.length<=0||xU(s,o,i)}}const eg=new Map;function xU(s,i,t){if(t==null)return;const n=SU(i);if(n.childElementCount>=20){const l=n.lastElementChild;I1(l)}t.length>400&&(t=t.substring(0,400)+"...");const r=t;if(eg.has(r))return;const o=EU(s,t);n.prepend(o);const a=()=>{eg.delete(r),I1(o)};eg.set(r,a),setTimeout(a,1e4)}function iK(){qP&&console.log("Clearing messages");for(const s of eg.values())s==null||s.call(s);eg.clear()}const CU=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function SU(s){globalThis[Pb]||(globalThis[Pb]=new Map);const i=globalThis[Pb];if(i.has(s))return i.get(s);{const t=document.createElement("div");i.set(s,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,s.shadowRoot?s.shadowRoot.appendChild(t):s.appendChild(t);const n=document.createElement("style");return n.innerHTML=CU,t.appendChild(n),t}}const JP=Symbol("logtype"),qv=new Map;function I1(s){s.remove();const i=s[JP],t=qv.get(i)??[];t.push(s),qv.set(i,t)}function EU(s,i){if(qv.has(s)){const n=qv.get(s);if(n.length>0){const r=n.pop();return r.innerHTML=i,r}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style["-webkit-backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[JP]=s,s){case Yi.Log:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case Yi.Warn:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case Yi.Error:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=i,t}var ea={};ea.d=(s,i)=>{for(var t in i)ea.o(i,t)&&!ea.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:i[t]})};ea.o=(s,i)=>Object.prototype.hasOwnProperty.call(s,i);ea.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var Ki={};ea.d(Ki,{ti:()=>Ot,nS:()=>LM,eB:()=>qg,Yp:()=>QC,VB:()=>Su,BC:()=>bm,zN:()=>Lu,cV:()=>Ef,hW:()=>Yg,k2:()=>tM,K6:()=>lo,M7:()=>jC,ls:()=>_m,Hi:()=>vM,EY:()=>Xg,MR:()=>hM,zf:()=>eM,Ay:()=>Q4,yo:()=>FM});var QC={};ea.r(QC);ea.d(QC,{get:()=>ZP,set:()=>IU});var jC={};ea.r(jC);ea.d(jC,{alphaTestTransformer:()=>d0,asPreprocessorValueTransformer:()=>uM,toPreprocessorTriggerTransformer:()=>$C,toUserDataTransformer:()=>U3,uniformOrUserDataTransformer:()=>ro});const Hw={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},IU=function(s){for(const i in s)Hw[i]=s[i]},ZP=function(s){return Object.prototype.hasOwnProperty.call(Hw,s)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${s}'`),Hw[s]};class Ot{constructor(i,t=null,n=!0){this._id=i,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=n}get id(){return this._id}get value(){return this._value}set value(i){this.isValid(i)&&this._value!==i&&(this._value=i,this._needsUpdate=!0)}update(i,t){this.output(t)}output(i){}_outputValue(i){i[this._id]=this._value}process(i){}render(i){}getInheritedInput(i){if(this._value!=="inherit")return this._value;const t=i._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return ZP(this._id)}isValid(i){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class TU extends Ot{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(i){this.isValid(i)&&(this._value=i,this._needsUpdate=!0)}update(i,t){if(this._value!=="auto")this._actualValue=this._value;else{const n=i._parent._value;if(n!==null){const r=n._renderOrder._actualValue,o=1+n._children._uis.indexOf(i);this._actualValue=r+o}}for(const n of i._children._uis)n._renderOrder._value==="auto"&&(n._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(i){i[this._id]=this._actualValue}get value(){return this._value}}class Lu extends Ot{constructor(i,t=null,n=!0){super(i,t,n),this.output=this._outputValue,this._notInheritedValue=null}update(i,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(i)),this.propagate(i),this._outputValue(t)}propagate(i){for(const t of i._children._uis){const n=t[`_${this._id}`];n!==void 0&&n._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(i){i[this._id]=this._notInheritedValue}set value(i){this.isValid(i)&&this._value!==i&&(this._value=i,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class RU extends Lu{constructor(){super("offset","inherit",!1)}update(i,t){super.update(i,t),i._parent._value!==null&&(i.position.z=this._notInheritedValue)}}class BU extends Lu{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=MU,this.output=this._outputValue}}const PU=["inherit","none","antialiased"];function MU(s){return PU.indexOf(s)===-1?(console.warn(`.fontSmoothing value '${s}' is not valid. Aborted`),!1):!0}var kU=s=>{var i={};return ea.d(i,s),i};const pe=kU({BackSide:()=>Wc,BufferAttribute:()=>Je,BufferGeometry:()=>Vt,Color:()=>xe,DoubleSide:()=>_i,EventDispatcher:()=>cc,FileLoader:()=>Lr,FrontSide:()=>il,LinearFilter:()=>Mt,Mesh:()=>Z,MeshBasicMaterial:()=>_t,Object3D:()=>ne,Plane:()=>tc,PlaneGeometry:()=>pr,ShaderMaterial:()=>et,Texture:()=>At,TextureLoader:()=>Xa,Vector2:()=>ae,Vector3:()=>x,Vector4:()=>Ue});class vi extends Ot{constructor(i,t,n=!0){super(i,"unset",n),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(i,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(i)),this.computeOutputValue(i);for(const n of i._children._uis){const r=n[`_${this._id}`];(r._input?r._input:r._value)==="inherit"&&(n[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(i){this._value=this._input}_computeFromInherited(i){this._value=this._inheritedInput}set value(i){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(i){this.isValidValue(i)&&i!==this._inline&&(this._input=this._inline=i,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(i){return!0}getInheritedInput(i){if(this._input!=="inherit")return this._input;const t=i._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class u0 extends vi{constructor(i,t){super(i,t,!1),this._input=new pe.Vector4(0,0,0,0),this._inline=null,this._value=new pe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(i){this._vector4ValueSetter(this._value,this._input)}set inline(i){this._vector4ValueSetter(this._input,i),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(i){this._input.x!==i&&(this._input.x=i,this._needsUpdate=!0)}get top(){return this._input.x}set right(i){this._input.y!==i&&(this._input.y=i,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(i){this._input.z!==i&&(this._input.z=i,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(i){this._input.w!==i&&(this._input.w=i,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(i,t){if(t instanceof pe.Vector4){i.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(n=>parseFloat(n)),t.length){case 1:i.setScalar(t[0]);return;case 2:i.x=i.z=t[0],i.y=i.w=t[1];return;case 3:i.x=t[0],i.y=t[1],i.z=t[2];return;case 4:i.x=t[0],i.y=t[1],i.z=t[2],i.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||i.setScalar(t)}}class DU extends u0{constructor(){super("padding",new pe.Vector4(0,0,0,0))}computeOutputValue(i){super.computeOutputValue(i),i._bounds._needsUpdate=!0,i._bounds._needsRender=!0,i._layouter._needsProcess=!0,i._renderer._needsRender=!0,i._parent._value&&(i._parent._value._layouter._needsProcess=!0)}}class OU extends u0{constructor(){super("margin",new pe.Vector4(0,0,0,0))}computeOutputValue(i){super.computeOutputValue(i),i._renderer._needsRender=!0,i._parent._value&&(i._parent._value._flexDirection._needsProcess=!0)}}const T1=function(s,i,t){s[i]=t},LU=function(s,i,t){t!==null&&(s[i]=t)};class cA{constructor(i){this._definition=i}set definition(i){this._definition=i}mediate(i,t,n,r=null){for(const o in this._definition){const a=this._definition[o];if(n[o]!==void 0){const l=a.t?a.t:T1;l(t,a.m,n[o]),r&&l(r,a.m,n[o])}}}static mediate(i,t,n,r,o=null){if(t)for(const a in r){const l=r[a];if(n[a]!==void 0){const c=l.t?l.t:T1;c(t,l.m,n[a]),o&&c(o,l.m,n[a])}}}}class FU extends Ot{constructor(){super("parent",null,!1)}update(i,t){i.parent&&i.parent.isUI?this._value=i.parent:this._value=null}set value(i){console.warn("ParentProperty is readonly")}get value(){return this._value}find(i){return this._value?i(this._value)?this._value:this._value._parent.find(i):null}dispose(){this._value=null}}const Vw=function(s,i,t=6){return s.toFixed(t)===i.toFixed(t)};class R1 extends Ot{constructor(i,t){super(i,t,!0),this.output=this._outputValue}set value(i){this.isValid(i)&&(Vw(this._value,i)||(this._value=i,this._needsUpdate=!0))}get value(){return this._value}}class B1 extends Lu{constructor(i){super(i,"inherit",!0),this.isValid=NU}}const UU=[pe.FrontSide,pe.BackSide,pe.DoubleSide];function NU(s){return UU.indexOf(s)===-1?(console.warn(`SideProperty value '${s}' is not valid. Abort`),!1):!0}class $P{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(i){this._lineBreak=i}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(i){this._kerning=i}get fontSize(){return this._fontSize}set fontSize(i){this._fontSize=i}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(i){this._offsetX=i}get offsetY(){return this._offsetY}set offsetY(i){this._offsetY=i}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(i){this._cumulativeWidth=i}get marginLeft(){return this._marginLeft}set marginLeft(i){this._marginLeft=i}get marginRight(){return this._marginRight}set marginRight(i){this._marginRight=i}get paddingLeft(){return this._paddingLeft}set paddingLeft(i){this._paddingLeft=i}get paddingRight(){return this._paddingRight}set paddingRight(i){this._paddingRight=i}get lineBase(){return 0}set fontFactor(i){this._fontFactor=i}get fontFactor(){return this._fontFactor}}class eM{constructor(i){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=i}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(i){this._yoffset=i}clone(i){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class tM extends $P{constructor(i){super(),this._typographic=i}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const zU={light:"100",normal:"400",bold:"700",bolder:"900"};function GC(s){if(!isNaN(s))return s.toString();const i=zU[s];return i||s}class QU extends pe.EventDispatcher{constructor(i,t){super(),this._isReady=!1,this._weight=GC(i),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(i){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(i){let t=this._chars[i];if(t)return t;if(i.match(/\s/))return this._chars[" "];const n=this._getFallbackCharacter(i);if(n&&(t=this._chars[n],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${i}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(i){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(i,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(i){return this._kernings[i]?this._kernings[i]:0}adjustTypographicGlyphs(i){for(const t in i){const n=this.getTypographicGlyph(t),r=i[t];for(const o in r)n["_"+o]=i[t][o]}}_checkReadiness(){this._readyCondition()&&GU(this)}_alterElementProperties(i){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const jU={type:"ready"};function GU(s){s._isReady=!0,s.dispatchEvent(jU)}const bm=QU;class HU extends Ot{constructor(i=null){super("font",i,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=VU}output(i){i[this._id]=this._fontVariant}update(i,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof bm)this._fontVariant=this._value;else{const n=i._fontFamily._value;n&&(this._fontVariant=n.getVariant(i._fontWeight._value,i._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(i),this._handleFontReadyClosure=WU(i,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!i._fontMaterial._defaultMaterial||!(i._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(i._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,i._fontMaterial._needsUpdate=!0))}set value(i){this.isValid(i)&&this._value!==i&&(this._value=i,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function VU(s){return s instanceof bm?!0:(console.warn(`.font value '${s}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function WU(s,i){return function(){i._needsUpdate=!0,s._glyphs._needsProcess=!0,i._fontVariant.removeEventListener("ready",i._handleFontReadyClosure),i._handleFontReadyClosure=null}}class qU extends vi{constructor(i){super("display",i),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=YU}computeOutputValue(i){i._visible._value=this._output!=="none"}}const XU=["none","flex"];function YU(s){return XU.indexOf(s)===-1?(console.warn(`(.style) display value '${s}' is not valid. Aborted`),!1):!0}class KU extends vi{constructor(i){super("boxSizing",i),this._allowsInherit=!1,this.isValidValue=ZU}computeOutputValue(i){this._value=this._inheritedInput,i._bounds._needsUpdate=!0}}const JU=["border-box","content-box"];function ZU(s){return JU.indexOf(s)===-1?(console.warn(`(.style) boxSizing value '${s}' is not valid. Aborted`),!1):!0}class Vg extends vi{constructor(i,t){super(i,t,!1),this._value=new pe.Color,this.output=this._outputValue}computeOutputValue(i){this._input!=="inherit"&&this._value.set(this._input)}set inline(i){this._input=this._inline=i,this._needsUpdate=!0}}class kb extends vi{constructor(i,t){super(i,t,!0),this.isValidValue=$U,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(i){i[this._id]=this._inheritedInput}}function $U(s){return s<0&&s>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${s}' is not valid)`),!1):!0}class e3 extends vi{constructor(i){super("backgroundImage",i,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new pe.Vector2(1,1),this.isValidValue=t3}get value(){return this._value}output(i){i[this._id]=this._value,i.tSize=this._textureSize}computeOutputValue(i){if(this._value=this._inheritedInput,this._value instanceof pe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(i){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function t3(s){return!0}class i3 extends vi{constructor(i){super("backgroundSize",i,!0),this.isValidValue=s3,this.output=this._outputValue}}const n3=["cover","contain","stretch"];function s3(s){return n3.indexOf(s)===-1?(console.warn(`(.style) backgroundSize value '${s}' is not valid. Aborted`),!1):!0}class r3 extends vi{constructor(i){super("overflow",i,!0),this.isValidValue=a3,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(i,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(i)),this.computeOutputValue(i);for(const n of i._children._uis)n._overflow._needsUpdate=!0;this.output(t)}output(i){i.clippingPlanes=this._clippingPlanes}computeOutputValue(i){super.computeOutputValue(i),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=i._parent._value;if(t!==null){const n=t._overflow;if((n._value==="hidden"||n._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new pe.Plane(new pe.Vector3(0,-1,0),1),new pe.Plane(new pe.Vector3(-1,0,0),1),new pe.Plane(new pe.Vector3(0,1,0),1),new pe.Plane(new pe.Vector3(1,0,0),1)];for(let r=0;r<this._clippingPlanes.length;r++)this._clippingPlanes[r].parent=t;n._clippingPlanes!==null&&this._clippingPlanes.push(...n._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(n._value==="visible"||n._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(i){this._renderStrategy(i)}_emptyRender(i){}_hiddenRender(i){const t=i._parent._value,n=t._bounds._offsetHeight,r=t._bounds._offsetWidth,o=t._padding._value,a=t._borderWidth._value;for(let l=0;l<4&&l<this._clippingPlanes.length;l++){const c=this._clippingPlanes[l];switch(l%4){case 0:c.constant=n/2-(o.x+a.x);break;case 1:c.constant=r/2-(o.y+a.y);break;case 2:c.constant=n/2-(o.z+a.z);break;case 3:c.constant=r/2-(o.w+a.w);break}c.applyMatrix4(t.matrixWorld)}for(let l=0;l<i._children._uis.length;l++){const c=i._children._uis[l];c._overflow._needsRender=!0}}_propagateRender(i){for(let t=0;t<i._children._uis.length;t++){const n=i._children._uis[t];n._overflow._needsRender=!0}}}const o3=["visible","hidden"];function a3(s){return o3.indexOf(s)===-1?(console.warn(`(.style) overflow value '${s}' is not valid. Aborted`),!1):!0}const Sf="rem",iM="em",Xv="%",l3=[Sf,iM,Xv],nM=function(s){return l3.indexOf(s)===-1?Sf:s};class c3 extends u0{constructor(i){super("borderRadius",i),this._valueUV=this._value.clone(),this._input=new pe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new pe.Vector2(0,1),this._cornerTR=new pe.Vector2(1,1),this._cornerBR=new pe.Vector2(1,0),this._cornerBL=new pe.Vector2(0,0);const t=new hA(this._valueUV,["x","y"]),n=new hA(this._valueUV,["z","w"]),r=new hA(this._valueUV,["x","w"]),o=new hA(this._valueUV,["y","z"]);t.complementaryMediation=n,n.complementaryMediation=t,r.complementaryMediation=o,o.complementaryMediation=r,this._sideMediators=[t,n,r,o],this._units=Sf}set units(i){this._units=nM(i),this._needsProcess=!0}get units(){return this._units}set mediation(i){i!==this._mediation&&(this._mediation=i,this._needsUpdate=!0)}get mediation(){return this._mediation}output(i){i.cornerTL=this._cornerTL,i.cornerTR=this._cornerTR,i.cornerBR=this._cornerBR,i.cornerBL=this._cornerBL}computeOutputValue(i){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(i){this._needsRender=!0}render(i){this._valueUV.copy(this._value);const t=i._bounds._offsetWidth,n=i._bounds._offsetHeight;if(this._units===Xv&&this._valueUV.divideScalar(100),this._units===Sf&&this._valueUV.divideScalar(Math.min(t,n)),this._mediation)do this._sideMediators.forEach(a=>a.computeValue()),this._sideMediators.sort((a,l)=>a.value<l.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let r=t>n?n/t:1,o=t<n?t/n:1;this._units===Xv&&(r=o=1),this._cornerTL.x=this._valueUV.x*r,this._cornerTL.y=1-this._valueUV.x*o,this._cornerTR.x=1-this._valueUV.y*r,this._cornerTR.y=1-this._valueUV.y*o,this._cornerBR.x=1-this._valueUV.z*r,this._cornerBR.y=this._valueUV.z*o,this._cornerBL.x=this._valueUV.w*r,this._cornerBL.y=this._valueUV.w*o}dispose(){for(const i of this._sideMediators)i.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(i){this._input.x!==i&&(this._input.x=i,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(i){this._input.y!==i&&(this._input.y=i,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(i){this._input.z!==i&&(this._input.z=i,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(i){this._input.w!==i&&(this._input.w=i,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(i){this._input.x===i&&this._input.y===i||(this._input.x=this._input.y=i,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(i){this._input.y===i&&this._input.z===i||(this._input.y=this._input.z=i,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(i){this._input.z===i&&this._input.w===i||(this._input.z=this._input.w=i,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(i){this._input.w===i&&this._input.x===i||(this._input.w=this._input.x=i,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class hA{constructor(i,t){this._borderRadiuses=i,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(i){this._complementaryMediation=i}computeValue(){let i=0;for(const t of this._sideProperties)i+=this._borderRadiuses[t];this._value=i}mediate(i=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;i&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class h3 extends u0{constructor(i){super("borderWidth",i,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=Sf}set units(i){this._units=nM(i),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(i){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,i._bounds._needsUpdate=!0,i._layouter._needsUpdate=!0}_outputValue(i){i[this._id]=this._valueUV}process(i){this._needsRender=!0,i._borderRadius._needsRender=!0}render(i){this._valueUV.copy(this._value);const t=i._bounds._offsetWidth,n=i._bounds._offsetHeight;if(this._units===Xv&&(console.log("Percent"),console.log(this._valueUV)),this._units===Sf)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),n!==0&&(this._valueUV.x/=n,this._valueUV.z/=n);else if(this._units===iM){if(t!==0){const r=t>n?n/t:1;this._valueUV.y*=r,this._valueUV.w*=r}if(n!==0){const r=t<n?t/n:1;this._valueUV.x*=r,this._valueUV.z*=r}}}}class u3 extends Ot{constructor(i,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(i,t){i.visible=this._value,i._parent._value&&(i._parent._value._children._needsUpdate=!0)}set value(i){this.isValid(i)&&this._value!==i&&(this._value=i,this._needsUpdate=!0)}get value(){return this._value}}class sM extends Vg{constructor(i){super("backgroundColor",i,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(i){i._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(i)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class xl extends Ot{constructor(i="untitled"){super(i,void 0,!1)}update(i,t){}output(i){}}class d3 extends Ot{constructor(){super("inlineJustificator",null,!1),this._value=null}update(i,t){}process(i){const t=i._bounds._innerHeight,n=i._layouter._value,r=Math.abs(n.height);let o=(()=>{switch(i._alignItems._value){case"inherit":case"start":return t/2;case"end":return r-t/2;case"stretch":case"center":return r/2}})();const a=i._padding._value,l=i._borderWidth._value;o+=(-a.x+a.z)/2+(-l.x+l.z)/2,n.forEach(c=>{c.y+=o,c.forEach(u=>{u.offsetY+=o})})}}const f3=["start","center","end","stretch"],p3=function(s){return f3.indexOf(s)===-1?(console.warn(`(.style) alignItems value '${s}' is not valid. Aborted`),!1):!0};class HC extends vi{constructor(){super("alignItems","inherit",!0),this.isValidValue=p3}}class VC extends vi{constructor(){super("textAlign","inherit",!0),this.isValidValue=m3}}const g3=["left","right","center","justify","justify-left","justify-right","justify-center"],m3=function(s){return g3.indexOf(s)===-1?(console.warn(`(.style) textAlign value '${s}' is not valid. Aborted`),!1):!0};class WC extends vi{constructor(){super("flexDirection","inherit",!0),this.isValid=v3}}const A3=["row","row-reverse","column","column-reverse"];function v3(s){return A3.indexOf(s)===-1?(console.warn(`(.style) flexDirection value '${s}' is not valid. Aborted`),!1):!0}class qC extends vi{constructor(){super("justifyContent","inherit",!0),this.isValidValue=b3}}const y3=["start","center","end","space-between","space-around","space-evenly"];function b3(s){return y3.indexOf(s)===-1?(console.warn(`(.style) justifyContent value '${s}' is not valid. Aborted`),!1):!0}class _3 extends vi{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(i){this._value=this._inheritedInput,i._parent._value&&(i._parent._value._children._needsProcess=!0)}}class rM extends vi{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=x3}_computeFromInherited(i){super._computeFromInherited(i),i._parent._value&&(i._parent._value._children._needsProcess=!0)}}const w3=["static","absolute"];function x3(s){return w3.indexOf(s)===-1?(console.warn(`(.style) position value '${s}' is not valid. Aborted`),!1):!0}class oM extends vi{constructor(i,t=null){super(i,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(i){this.isValidValue(i)&&i!==this._inline&&(this._inline=i,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let i=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(i=!1),this._input=this._computed):i=this._input==="inherit",i){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=i}}update(i,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(i)),this.computeOutputValue(i);for(const n of i._children._uis)n[`_${this._id}`]._needsUpdate=!0;this.output(t),i._parent._value&&(i._parent._value._layouter._needsProcess=!0)}}computeOutputValue(i){i._bounds._needsUpdate=!0,i._renderer._needsRender=!0}getInheritedInput(i){if(this._input!=="inherit"&&!this._auto)return this._input;const t=i._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class C3 extends oM{constructor(){super("width")}}class S3 extends oM{constructor(){super("height")}computeOutputValue(i){super.computeOutputValue(i)}}class aM extends xl{constructor(){super("textContent"),this._needsUpdate=!1}set value(i){}process(i){let t="";for(let n=0;n<i.children.length;n++){const r=i.children[n];r.isUI&&(t+=r.textContent)}this._value=t}}class lM extends vi{constructor(i){super("fontStyle",i,!0),this.isValidValue=I3}}const E3=["normal","italic"];function I3(s){return E3.indexOf(s)===-1?(console.warn(`(.style) fontStyle value '${s}' is not valid. Aborted`),!1):!0}class cM extends vi{constructor(){super("fontWeight","inherit",!0),this.isValid=R3}}const T3=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function R3(s){return T3.indexOf(s.toString())===-1?(console.warn(`(.style) fontWeight value '${s}' is not valid. Aborted`),!1):!0}class hM{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class B3 extends hM{constructor(i){super(),this._size=i.info.size,this._lineHeight=i.common.lineHeight,this._lineBase=i.common.base,this._name=i.info.face,this._textureWidth=i.common.scaleW,this._textureHeight=i.common.scaleH,this._charset=i.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class P3 extends tM{constructor(i){super(i)}get uv(){return this.typographic.uv}}class Yv extends eM{constructor(i,t){super(i),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/i.textureWidth,right:(t.x+t.width)/i.textureWidth,top:1-(t.y+t.height)/i.textureHeight,bottom:1-t.y/i.textureHeight})}get uv(){return this._uv}clone(i){return new Yv(this._font,{char:i,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new P3(this)}}class M3 extends pe.PlaneGeometry{constructor(i,t){let n=1,r=1;const o=i.typographic.font.size,a=t._segments.value;n=Math.ceil(i.typographic.width/o*a),r=Math.ceil(i.typographic.height/o*a),super(i.width,i.height,n,r),i.uv?(this._mapUVs(i),this._transformGeometry(i)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,i.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(i){const t=i.uv.right-i.uv.left,n=i.uv.bottom-i.uv.top,r=this.getAttribute("uv").array.slice(),o=[];for(let a=0;a<r.length;a+=2){const l=r[a],c=r[a+1];o.push(i.uv.left+t*l),o.push(i.uv.top+n*c)}this.setAttribute("uvG",new pe.BufferAttribute(new Float32Array(o),2))}_nullifyUVs(){const i=[],t=this.getAttribute("uv").array.length;for(let n=0;n<t;n++)i.push(0);this.setAttribute("uvG",new pe.BufferAttribute(new Float32Array(i),2))}_transformGeometry(i){this.translate(i.width/2,-i.height/2,0)}}const k3=`
attribute vec2 uvG;
varying vec2 vUvG;
`,XC=k3,D3=`
vUvG = uvG;
`,YC=D3,O3=`
gl_Position.z -= 0.00001;
`,KC=O3,L3=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,JC=L3,F3=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,ZC=F3,d0=function(s,i,t){s.alphaTest=t,$C(s,"USE_ALPHATEST",t>0)},$C=function(s,i,t){s.defines&&(t?s.defines[i]===void 0&&(s.defines[i]="",s.needsUpdate=!0):s.defines[i]!==void 0&&(delete s.defines[i],s.needsUpdate=!0))},uM=function(s,i,t){s.defines[i]&&s.defines[i]===t||(s.defines[i]=t,s.needsUpdate=!0)},ro=function(s,i,t){s.userData[i]?s.userData[i].value=t:s.uniforms[i].value=t},U3=function(s,i,t){s.userData[i].value=t};class lo{static ensureMaterialOptions(i){i.transparent=!0,i.alphaTest=i.alphaTest||.02}static ensureDefines(i){i.defines||(i.defines={})}static ensureUserData(i,t){i.userData.glyphMap={value:t.glyphMap},i.userData.unitRange={value:new pe.Vector2}}static bindUniformsWithUserData(i,t){i.uniforms.glyphMap=t.userData.glyphMap,i.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(i){lo.injectVertexShaderChunks(i),lo.injectFragmentShaderChunks(i)}static injectVertexShaderChunks(i){i.vertexShader=i.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+XC),i.vertexShader=i.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+YC),i.vertexShader=i.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+KC)}static injectFragmentShaderChunks(i){i.fragmentShader=i.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+JC),i.fragmentShader=i.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+ZC)}static from(i){return class extends i{constructor(n={}){lo.ensureMaterialOptions(n);super(n);h(this,"_cumulativeOnBeforeCompile",n=>{lo.bindUniformsWithUserData(n,this),lo.injectShaderChunks(n),this._userDefinedOnBeforeCompile(n)});lo.ensureDefines(this),lo.ensureUserData(this,n),this._userDefinedOnBeforeCompile=r=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return lo.mediation}set onBeforeCompile(n){this._userDefinedOnBeforeCompile=n}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return Q3}}const N3=function(s,i,t){const n=t?t.texture:null,r=t?t.unitRange:new pe.Vector2;if(s[i]!==void 0){s.glyphMap=n,s.unitRange=r;return}s.userData&&s.userData.glyphMap&&(s.userData.glyphMap.value=n,s.userData.unitRange.value=r)},z3=function(s,i,t){t&&t!=="antialiased"?s.defines.NO_RGSS="":delete s.defines.NO_RGSS,s.needsUpdate=!0},Q3={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:d0},fontSide:{m:"side"},font:{m:"glyphMap",t:N3},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:z3},invertAlpha:{m:"INVERT_ALPHA",t:$C}},j3=`
${XC}
#include <clipping_planes_pars_vertex>
void main() {
	${YC}
	#include <begin_vertex>
	#include <project_vertex>
	${KC}
	#include <clipping_planes_vertex>
}
`,G3=`
uniform vec3 diffuse;
uniform float opacity;
${JC}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${ZC}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,H3=.02;class eS extends pe.ShaderMaterial{static get mediation(){return lo.mediation}constructor(i={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new pe.Vector2(0,0)},alphaTest:{value:H3}},transparent:!0,clipping:!0,vertexShader:j3,fragmentShader:G3,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=i.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(i){this.uniforms.diffuse.value=i}set opacity(i){this.uniforms&&(this.uniforms.opacity.value=i)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(i){this.uniforms.unitRange.value.copy(i)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(i){this.uniforms.glyphMap.value=i}get isDefault(){return this.constructor===eS}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(i){this.uniforms.alphaTest.value=i}}class V3 extends bm{constructor(i,t,n,r){if(super(i,t),this._unitRange=new pe.Vector2(1,1),n.pages?this._buildData(n):W3(this,n),r instanceof pe.Texture)this._texture=r,this._buildTexture(r);else if(typeof r=="string"||r instanceof String)q3(this,r);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof r}'. Only Texture and String allowed.`);this._defaultMaterialClass=eS,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(i){this._defaultMaterialClass=i}get fontMaterial(){return this._defaultMaterialClass}_buildData(i){this._font=new B3(i),this._kernings=this._buildKerningPairs(i),this._chars=this._buildCharacters(i),this._chars[" "]=this._buildCharacterWhite(i),this._chars[`
`]=this._buildCharacterWhite(i,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(i,"	",4,1),this._size=i.info.size,this._lineHeight=i.common.lineHeight,this._lineBase=i.common.base,this._distanceRange=i.distanceField.distanceRange,this._unitRange=new pe.Vector2(this._distanceRange,this._distanceRange).divide(new pe.Vector2(i.common.scaleW,i.common.scaleH))}_buildTexture(i){i.generateMipmaps=!1,i.minFilter=pe.LinearFilter,i.magFilter=pe.LinearFilter,i.needsUpdate=!0}_getFallbackCharacter(i){return Su.missingCharacter(this,i)}getGeometricGlyph(i,t){return new M3(i,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(i){const t={};for(let n=0;n<i.kernings.length;n++){const r=i.kernings[n];if(r.amount===0)continue;const o=String.fromCharCode(r.first,r.second);t[o]=r.amount}return t}_buildCharacters(i){const t={};for(let n=0;n<i.chars.length;n++){const r=i.chars[n];t[r.char]=new Yv(this._font,r)}return t}_buildCharacterWhite(i,t=" ",n=1,r=1){return new Yv(this._font,{char:t,width:i.info.size/3*n,height:i.info.size*.7*r})}_alterElementProperties(i){}}function W3(s,i){new pe.FileLoader().setResponseType("json").load(i,t=>{s._buildData(t),s._checkReadiness()})}function q3(s,i){s._texture=new pe.TextureLoader().load(i,t=>{s._buildTexture(t),s._checkReadiness()})}class f0 extends pe.EventDispatcher{constructor(t){super();h(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&Y3(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,n,r,o,a=!1){if(a||!this.getVariant(t,n)){this._isReady=!1;const l=new V3(t,n,r,o);this._variants.push(l),l.isReady?this._checkReadiness():l.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${n}) already exists.`);return this}addCustomImplementationVariant(t,n=!1){return n||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,n){return t=GC(t),this._variants.find(r=>r.weight===t&&r.style===n)}get name(){return this._name}}const X3={type:"ready"};function Y3(s){s._isReady=!0,s.dispatchEvent(X3)}const gv={},K3=function(s){const i=[...arguments];i.forEach(n=>{if(!(n instanceof f0))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof n} given.`)});const t=function(){return i.every(n=>n.isReady)};return new Promise((n,r)=>{if(t())n();else for(let o=0;o<i.length;o++){const a=i[o];a.isReady||a.addEventListener("ready",()=>{t()&&n()})}})},J3=function(s){return gv[s]&&console.error(`FontLibrary::addFontFamily - Font('${s}') is already registered`),gv[s]=new f0(s),gv[s]},Z3=function(s){return gv[s]},$3=function(s){dM=s};let dM=function(s,i){return console.error(`The character '${i}' is not included in the font characters set.`)," "};function eN(s,i){return dM(s,i)}const tN={addFontFamily:J3,getFontFamily:Z3,prepare:K3,setMissingCharacterHandler:$3,missingCharacter:eN},Su=tN;class fM extends vi{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(i){if(this._input instanceof f0)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=Su.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(i){if(this._input!=="inherit")return this._input;const t=i._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class pM extends vi{constructor(){super("lineHeight","inherit",!0)}update(i,t){super.update(i,t),i._layouter._needsProcess=!0}}class gM extends vi{constructor(){super("whiteSpace","inherit"),this.isValidValue=nN}}const iN=["normal","nowrap","pre","pre-line","pre-wrap"];function nN(s){return iN.indexOf(s)===-1?(console.warn(`(.style) whiteSpace value '${s}' is not valid. Aborted`),!1):!0}class mM extends vi{constructor(){super("letterSpacing","inherit",!0)}}class sN extends vi{constructor(){super("fontSize","inherit",!0)}}class AM extends Ot{constructor(){super("segments",1,!1)}}class rN extends Lu{constructor(){super("invertAlpha","inherit")}}class p0 extends vi{constructor(){super("fontKerning","inherit"),this.isValidValue=aN}}const oN=["normal","none","inherit"];function aN(s){return oN.indexOf(s)===-1?(console.warn(`(.style) fontKerning value '${s}' is not valid. Aborted`),!1):!0}class uA extends Lu{constructor(i){super(i,"inherit",!0)}}class P1 extends Lu{constructor(i){super(i,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(i,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(i):this.propagate(i),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:d0},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},i._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(i){if(this._value!=="inherit")return this._value;let t=i,n=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){n=t[`_${this._id}`]._value;break}return n!==null?n:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const lN=function(s,i,t){s.traverse(n=>{n.renderOrder=t})};class _m extends pe.Object3D{constructor(t,n){super();h(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(Kv.register(this),this.activatePseudoState("root")):(Kv.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:lN}},this._fontMesh=null,this._fontMaterial=new P1("fontMaterial"),this._fontCustomDepthMaterial=new P1("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:LU},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new xl("children"),this._parent=new FU,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new B1("backgroundSide"),this._fontSide=new B1("fontSide"),this._backgroundAlphaTest=new R1("backgroundAlphaTest",.02),this._fontAlphaTest=new R1("fontAlphaTest",.02),this._visible=new u3("visible",!0),this._backgroundCastShadow=new uA("backgroundCastShadow"),this._fontCastShadow=new uA("fontCastShadow"),this._backgroundReceiveShadow=new uA("backgroundReceiveShadow"),this._fontReceiveShadow=new uA("fontReceiveShadow"),this._renderOrder=new TU,this._segments=t.segments?new t.segments:new AM,this._bounds=t.bounds?new t.bounds:new xl("bounds"),this._order=new _3,this._padding=new DU,this._margin=new OU,this._position=new rM,this._flexDirection=t.flexDirection?new t.flexDirection:new WC,this._justifyContent=t.justifyContent?new t.justifyContent:new qC,this._alignItems=t.alignItems?new t.alignItems:new HC,this._display=new qU("flex"),this._boxSizing=new KU("border-box"),this._width=new C3,this._height=new S3,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new sM,this._backgroundOpacity=new kb("backgroundOpacity",.5),this._backgroundImage=new e3,this._backgroundSize=new i3("cover"),this._color=t.color?new t.color:new Vg("color","inherit"),this._fontOpacity=new kb("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new gM,this._fontFamily=t.fontFamily?new t.fontFamily:new fM,this._fontStyle=t.fontStyle?new t.fontStyle:new lM("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new cM,this._fontSize=t.fontSize?new t.fontSize:new sN,this._lineHeight=t.lineHeight?new t.lineHeight:new pM,this._fontKerning=t.fontKerning?new t.fontKerning:new p0,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new mM,this._overflow=new r3("visible"),this._borderRadius=new c3(0),this._borderWidth=new h3(0),this._borderColor=new Vg("borderColor",16711935),this._borderOpacity=new kb("borderOpacity",1),this._font=new HU,this._lineBreak=t.lineBreak?new t.lineBreak:new xl("lineBreak"),this._textContent=t.textContent?new t.textContent:new aM,this._glyphs=t.glyphs?new t.glyphs:new xl("glyphs"),this._inlines=t.inlines?new t.inlines:new xl("inlines"),this._layouter=t.layouter?new t.layouter:new xl("layouter"),this._inlineJustificator=new d3,this._textAlign=t.textAlign?new t.textAlign:new VC,this._autoSize=t.autoSize?new t.autoSize:new xl("autoSize"),this._renderer=t.renderer?new t.renderer:new xl("renderer"),this._offset=new RU,this._invertAlpha=new rN,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new BU,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],n.backgroundSide||(n.backgroundSide=0),n&&this.set(n)}update(){const t={};for(const n of this._components)n._needsUpdate&&(n.update(this,t),n._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const n of this._children._uis)n.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const n=this._components[t];n._needsRender&&(n.render(this),n._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const n=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let r=Su.getFontFamily(n);if(!r){const o=t.fontStyle?t.fontStyle:"normal",a=t.fontWeight?t.fontWeight:"400";r=Su.addFontFamily(n).addVariant(a,o,t.fontFamily,t.fontTexture)}t.fontFamily=r,delete t.fontTexture}for(let n of Object.keys(t)){const r=t[n];switch(n){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),n="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),n="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),n="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),n="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),n="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),n="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),n="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":n="borderColor";break}switch(n){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${n}`].value=r;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${n}`]&&(this[`_${n}`].inline=r);break;case"paddingTop":this._padding.top=r;break;case"paddingRight":this._padding.right=r;break;case"paddingBottom":this._padding.bottom=r;break;case"paddingLeft":this._padding.left=r;break;case"marginTop":this._margin.top=r;break;case"marginRight":this._margin.right=r;break;case"marginBottom":this._margin.bottom=r;break;case"marginLeft":this._margin.left=r;break;case"borderTopWidth":this._borderWidth.top=r;break;case"borderRightWidth":this._borderWidth.right=r;break;case"borderBottomWidth":this._borderWidth.bottom=r;break;case"borderLeftWidth":this._borderWidth.left=r;break;case"borderTopLeftRadius":this._borderRadius.topLeft=r;break;case"borderTopRightRadius":this._borderRadius.topRight=r;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=r;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=r;break;case"side":case"castShadow":case"receiveShadow":const o=n.charAt(0).toUpperCase()+n.substr(1);this[`_background${o}`].value=r,this[`_font${o}`].value=r;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${n}`].value=r;break;default:this[`_${n}`]!==void 0?this[`_${n}`].value=r:this[n]=r}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let n=!1;for(let r=0;r<arguments.length;r++)super.add(arguments[r]),arguments[r].isUI&&(n=!0);return n&&this._rebuildChildrenLists(),this}remove(t){for(const n of Object.keys(arguments))arguments[n].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,ro(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const n of this._components)n.output(t)}cA.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const n=this._fontMaterial.value;if(n){if(!t){t={};for(const r of this._components)r.output(t)}cA.mediate(this,n,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const n of this._components)n.output(t)}cA.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&ro(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const n of this._components)n.output(t)}cA.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const n=this._onAfterUpdates.indexOf(t);n!==-1&&this._onAfterUpdates.splice(n,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,n){this[`_${t}`]=n,this._components.push(n)}replaceProperty(t,n){const r=this[`_${t}`],o=this._components.indexOf(r);return this._components[o]=this[`_${t}`]=n,n.needsUpdate=!0,r}}class Kv{static register(i){this.elements.includes(i)||this.elements.push(i)}static remove(i){const t=this.elements.indexOf(i);t!==-1&&this.elements.splice(t,1)}static update(){for(const i of this.elements)i.update(),i.process(),i.process(),i.render()}}Kv.elements=[];const cN=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,tS=cN,hN=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,iS=hN,uN=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,nS=uN,dN=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,sS=dN,fN=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,rS=fN,pN=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,oS=pN,gN=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,aS=gN,vM={msdfAlphaglyphParsVertexGlsl:XC,msdfAlphaglyphVertexGlsl:YC,msdfOffsetglyphVertexGlsl:KC,msdfAlphaglyphParsFragmentGlsl:JC,msdfAlphaglyphFragmentGlsl:ZC,frameBorderParsVertexGlsl:tS,frameBorderVertexGlsl:iS,frameCommonParsFragmentGlsl:rS,frameBorderParsFragmentGlsl:nS,frameBorderFragmentGlsl:sS,frameBackgroundParsFragmentGlsl:oS,frameBackgroundFragmentGlsl:aS},mN=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${tS}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${iS}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,AN=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${rS}

${nS}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${oS}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${aS}

	${sS}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class Jv{static get mediation(){return yN}static ensureMaterialOptions(i){i.transparent=!0,i.alphaTest=i.alphaTest||.02}static ensureDefines(i){i.defines||(i.defines={})}static ensureUserData(i,t){i.userData.borderColor={value:null},i.userData.borderRadius={value:new pe.Vector4(0,0,0,0)},i.userData.cornerTL={value:new pe.Vector2(0,1)},i.userData.cornerTR={value:new pe.Vector2(1,1)},i.userData.cornerBR={value:new pe.Vector2(1,0)},i.userData.cornerBL={value:new pe.Vector2(0,0)},i.userData.borderWidth={value:new pe.Vector4(0,0,0,0)},i.userData.borderOpacity={value:null},i.userData.frameSize={value:new pe.Vector3(1,1,1)},i.userData.textureSize={value:new pe.Vector2(1,1)}}static bindUniformsWithUserData(i,t){i.uniforms.borderColor=t.userData.borderColor,i.uniforms.borderRadius=t.userData.borderRadius,i.uniforms.cornerTL=t.userData.cornerTL,i.uniforms.cornerTR=t.userData.cornerTR,i.uniforms.cornerBR=t.userData.cornerBR,i.uniforms.cornerBL=t.userData.cornerBL,i.uniforms.borderWidth=t.userData.borderWidth,i.uniforms.borderOpacity=t.userData.borderOpacity,i.uniforms.frameSize=t.userData.frameSize,i.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(i){Jv.injectVertexShaderChunks(i),Jv.injectFragmentShaderChunks(i)}static injectVertexShaderChunks(i){i.vertexShader=i.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+tS),i.vertexShader=i.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+iS)}static injectFragmentShaderChunks(i){i.fragmentShader=i.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+oS),i.fragmentShader=i.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+nS),i.fragmentShader=i.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+rS),i.fragmentShader=i.fragmentShader.replace("#include <map_fragment>",aS),i.fragmentShader=i.fragmentShader.replace("#include <alphamap_fragment>",sS+`
#include <alphamap_fragment>`)}}const vN=function(s,i,t){t=["stretch","contain","cover"].indexOf(t),uM(s,"BACKGROUND_MAPPING",t)},yN={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:d0},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:vN},borderWidth:{m:"borderWidth",t:ro},borderColor:{m:"borderColor",t:ro},cornerTL:{m:"cornerTL",t:ro},cornerTR:{m:"cornerTR",t:ro},cornerBR:{m:"cornerBR",t:ro},cornerBL:{m:"cornerBL",t:ro},borderOpacity:{m:"borderOpacity",t:ro},size:{m:"frameSize",t:ro},tSize:{m:"textureSize",t:ro}};class yM extends pe.ShaderMaterial{static get mediation(){return Jv.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new pe.Color(16777215)},opacity:{value:1},borderColor:{value:new pe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new pe.Vector4(0,0,0,0)},cornerTL:{value:new pe.Vector2(0,1)},cornerTR:{value:new pe.Vector2(1,1)},cornerBR:{value:new pe.Vector2(1,0)},cornerBL:{value:new pe.Vector2(0,0)},borderWidth:{value:new pe.Vector4(0,0,0,0)},frameSize:{value:new pe.Vector3(1,1,1)},textureSize:{value:new pe.Vector2(1,1)}},side:pe.FrontSide,transparent:!0,clipping:!0,vertexShader:mN,fragmentShader:AN,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(i){this.uniforms.map.value=i,i?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(i){this.uniforms.alphaTest.value=i}set opacity(i){this.uniforms&&(this.uniforms.opacity.value=i)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(i){this.uniforms.diffuse.value=i}}class bN extends Ot{constructor(){super("children",null,!1);h(this,"_sortOrder",(t,n)=>t._order._value<n._order._value?-1:t._order._value>n._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(n)?-1:1);this._uis=[],this._boxes=[]}update(t,n){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(n=>n.visible&&n.isUI),this._boxes=this._uis.filter(n=>n.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class bM extends Ot{constructor(){super("bounds",null,!1),this._size=new pe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(i,t){const n=i._width,r=i._padding._value,o=i._borderWidth._value,a=i._margin._value,l=n._auto?1:n._value,c=t*l-(a.y+a.w);Vw(c,this._offsetWidth)||(this._offsetWidth=c,this._innerWidth=this._offsetWidth-(r.y+r.w+o.y+o.w),this._centerX=Db(i),this._propagateWidth(i),this._triggerCascadingDependencies(i))}setReferenceHeight(i,t){const n=i._height,r=i._padding._value,o=i._borderWidth._value,a=i._margin._value,l=n._auto?1:n._value,c=t*l-(a.x+a.z);Vw(c,this._offsetHeight)||(this._offsetHeight=c,this._innerHeight=this._offsetHeight-(r.x+r.z+o.x+o.z),this._centerY=Ob(i),this._propagateHeight(i),this._triggerCascadingDependencies(i))}setChildrenWidth(i,t){const n=i._padding._value,r=i._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(n.y+n.w+r.y+r.w),this._centerX=Db(i),this._propagateWidth(i),this._triggerCascadingDependencies(i)}setChildrenHeight(i,t){const n=i._padding._value,r=i._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(n.x+n.z+r.x+r.z),this._centerY=Ob(i),this._propagateHeight(i),this._triggerCascadingDependencies(i)}update(i,t){const n=i._padding._value,r=i._borderWidth._value,o=i._width;!o._auto&&!o._relative&&(i._boxSizing._value==="content-box"?(this._innerWidth=o._value,this._offsetWidth=this._innerWidth+n.y+n.w+r.y+r.w):(this._offsetWidth=o._value,this._innerWidth=this._offsetWidth-(n.y+n.w+r.y+r.w)),this._centerX=Db(i),this._needsProcess=!0,this._propagateWidth(i),this._triggerCascadingDependencies(i));const a=i._height;!a._auto&&!a._relative&&(i._boxSizing._value==="content-box"?(this._innerHeight=a._value,this._offsetHeight=this._innerHeight+n.x+n.z+r.x+r.z):(this._offsetHeight=a._value,this._innerHeight=this._offsetHeight-(n.x+n.z+r.x+r.z)),this._centerY=Ob(i),this._needsProcess=!0,this._propagateHeight(i),this._triggerCascadingDependencies(i))}render(i){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,i._backgroundMesh&&i._backgroundMesh.updateScale(),i._renderer._needsRender=!0}output(i){i.size=this._size}process(i){i._overflow._needsRender=!0}_computeChildrenSideWidth(i){return _N(i)}_computeChildrenSideHeight(i){return wN(i)}_propagateWidth(i){for(let t=0;t<i._children._boxes.length;t++){const n=i._children._boxes[t];n._width._relative&&n._bounds.setReferenceWidth(n,this._innerWidth)}}_propagateHeight(i){for(let t=0;t<i._children._boxes.length;t++){const n=i._children._boxes[t];n._height._relative&&n._bounds.setReferenceHeight(n,this._innerHeight)}}_triggerCascadingDependencies(i){i._parent._value&&(i._parent._value._autoSize._needsProcess=!0),i._flexDirection._needsProcess=!0,i._fontSize._needsProcess=!0,i._layouter._needsProcess=!0,this._needsRender=!0,i._borderWidth._needsRender=!0,i._borderRadius._needsRender=!0,i._overflow._needsRender=!0}}function Db(s){const i=s._padding._value,t=s._borderWidth._value,n=i.w+t.w,r=i.y+t.y;return(n-r)/2}function Ob(s){const i=s._padding._value,t=s._borderWidth._value,n=i.x+t.x;return(i.z+t.z-n)/2}function _N(s){return s._children._boxes.reduce((i,t)=>{const n=t._margin._value,r=t._bounds._offsetWidth+n.y+n.w;return i+r},0)}function wN(s){return s._children._boxes.reduce((i,t)=>{const n=t._margin._value,r=t._bounds._offsetHeight+n.x+n.z;return i+r},0)}class xN extends HC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(i){switch(this._value=this._inheritedInput,i._flexDirection._value){case"row":case"row-reverse":switch(this._process=RN,this._value){case"start":this._childAlign=SN;break;case"end":this._childAlign=CN;break;default:this._childAlign=M1}break;case"column":case"column-reverse":switch(this._process=TN,this._value){case"start":this._childAlign=IN;break;case"end":this._childAlign=EN;break;default:this._childAlign=M1}break}this._needsProcess=!0,i._autoSize._needsProcess=!0,i._flexDirection._needsProcess=!0,i._justifyContent._needsProcess=!0,this._needsProcess=!0,i._fontSize._needsProcess=!0,i._layouter._needsProcess=!0}process(i){this._process(i,this._childAlign);let t="center",n="center",r="center";const o=i._padding._value,a=i._borderWidth._value;i._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=n="left":this._value==="end"?t=n="right":t="centerX":this._value==="start"?t=r="top":this._value==="end"?t=r="bottom":t="centerY";let l=-(o.x-o.z)/2-(a.x-a.z)/2,c=-(o.y-o.w)/2-(a.y-a.w)/2;n==="left"?c=(o.w-o.y)/2+(a.w-a.y)/2:n==="right"&&(c=-(o.y-o.w)/2-(a.y-a.w)/2),r==="top"?l=-(o.x-o.z)/2-(a.x-a.z)/2:r==="bottom"&&(l=(o.z-o.x)/2+(a.z-a.x)/2),i._children._boxes.forEach(u=>{let d=0,f=0;t==="top"?f=-u._margin._value.x:t==="bottom"?f=u._margin._value.z:t==="left"?d=u._margin._value.w:t==="right"?d=-u._margin._value.y:t==="centerX"?d=(u._margin._value.w-u._margin._value.y)/2:t==="centerY"&&(f=(-u._margin._value.x+u._margin._value.z)/2),i._layouter._childrenPos[u.id].x+=c+d,i._layouter._childrenPos[u.id].y+=l+f})}}function M1(){return 0}function CN(s,i){return-i+s._bounds._offsetHeight/2}function SN(s,i){return i-s._bounds._offsetHeight/2}function EN(s,i){return i-s._bounds._offsetWidth/2}function IN(s,i){return-i+s._bounds._offsetWidth/2}function TN(s,i){const t=s._bounds._innerWidth/2;s._children._boxes.forEach(n=>{s._layouter._childrenPos[n.id].x=i(n,t)})}function RN(s,i){const t=s._bounds._innerHeight/2;s._children._boxes.forEach(n=>{s._layouter._childrenPos[n.id].y=i(n,t)})}class BN extends WC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(i){switch(this._value=this._inheritedInput,this._value){case"row":this._process=PN;break;case"row-reverse":this._process=MN;break;case"column":this._process=kN;break;case"column-reverse":this._process=DN;break}i._justifyContent._needsUpdate||i._justifyContent.computeOutputValue(i),i._alignItems._needsUpdate||i._alignItems.computeOutputValue(i),this._needsProcess=!0}process(i){switch(this._value){case"row":this._offset=-i._bounds._innerWidth/2;break;case"row-reverse":this._offset=i._bounds._innerWidth/2;break;case"column":this._offset=i._bounds._innerHeight/2;break;case"column-reverse":this._offset=-i._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(i),i._justifyContent._needsProcess=!0,i._layouter._needsProcess=!0}}function PN(s){let i=s._flexDirection._offset;const t=s._flexDirection._reverse,n=s._children._boxes;for(let r=0;r<n.length;r++){const o=n[r],a=o.id,l=o._bounds._offsetWidth;i+=o._margin._value.w*t;const c=s._layouter._childrenPos[a];c.x=i+l/2*t,c.y=0,i+=t*(l+o._margin._value.y)}}function MN(s){let i=s._flexDirection._offset;const t=s._flexDirection._reverse,n=s._children._boxes;for(let r=0;r<n.length;r++){const o=n[r],a=o.id,l=o._bounds._offsetWidth;i+=o._margin._value.y*t;const c=s._layouter._childrenPos[a];c.x=i+l/2*t,c.y=0,i+=(l+o._margin._value.w)*t}}function kN(s){let i=s._flexDirection._offset;const t=s._flexDirection._reverse,n=s._children._boxes;for(let r=0;r<n.length;r++){const o=n[r],a=o.id,l=o._bounds._offsetHeight;i+=o._margin._value.x*t;const c=s._layouter._childrenPos[a];c.x=0,c.y=i+l/2*t,i+=(l+o._margin._value.z)*t}}function DN(s){let i=s._flexDirection._offset;const t=s._flexDirection._reverse,n=s._children._boxes;for(let r=0;r<n.length;r++){const o=n[r],a=o.id,l=o._bounds._offsetHeight;i+=o._margin._value.z*t;const c=s._layouter._childrenPos[a];c.x=0,c.y=i+l/2*t,i+=(l+o._margin._value.x)*t}}class ON extends qC{constructor(i){super("justifyContent",i,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(i){switch(this._value=this._inheritedInput,i._flexDirection._value){case"column-reverse":case"column":this._process=FN.bind(this);break;case"row-reverse":case"row":this._process=LN.bind(this);break}switch(this._value){case"end":this._computeOffset=zN,this._computeMargin=Lb;break;case"center":this._computeOffset=QN,this._computeMargin=Lb;break;case"start":this._computeOffset=dA,this._computeMargin=Lb;break;case"space-between":this._computeOffset=dA,this._computeMargin=jN;break;case"space-around":this._computeOffset=dA,this._computeMargin=HN;break;case"space-evenly":this._computeOffset=dA,this._computeMargin=GN;break}i._flexDirection._needsProcess=!0}process(i){this._process(i),i._alignItems._needsProcess=!0}}function LN(s){const i=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:n}=UN(s),r=i*2-t*Math.sign(i),o=this._computeOffset(r),a=this._computeMargin(s,n,s._flexDirection._reverse);s._children._boxes.forEach((l,c)=>{s._layouter._childrenPos[l.id].x-=o-a[c]})}function FN(s){const i=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:n}=NN(s),r=i*2-t*Math.sign(i),o=this._computeOffset(r),a=this._computeMargin(s,n,s._flexDirection._reverse);s._children._boxes.forEach((l,c)=>{s._layouter._childrenPos[l.id].y-=o-a[c]})}function UN(s){const i=s._bounds._computeChildrenSideWidth(s);return{usedDirectionSpace:i,remainingSpace:s._bounds._innerWidth-i}}function NN(s){const i=s._bounds._computeChildrenSideHeight(s);return{usedDirectionSpace:i,remainingSpace:s._bounds._innerHeight-i}}function dA(s){return 0}function zN(s){return s}function QN(s){return s/2}function Lb(s,i=0,t=1){return Array(s._children._boxes.length).fill(0)}function jN(s,i=0,t=1){const r=s._children._boxes.length,o=Array(r).fill(0);if(i>0&&r>1){const a=i/(r-1)*t;o[0]=0;for(let l=1;l<r;l++)o[l]=a*l}return o}function GN(s,i=0,t=1){const r=s._children._boxes.length,o=Array(r).fill(0);if(i>0){const a=i/(r+1)*t;for(let l=0;l<r;l++)o[l]=a*(l+1)}return o}function HN(s,i=0,t=1){const r=s._children._boxes.length,o=Array(r).fill(0);if(i>0){const a=i/r*t,l=a/2;o[0]=l;for(let c=1;c<r;c++)o[c]=l+a*c}return o}let Fb;class _M extends pe.Mesh{constructor(i){const t=i.slice,n={};let r=1,o=1;if(t){if(r=t.width?t.width:1,o=t.height?t.height:1,t.top){if(t.left){const p=new pe.PlaneGeometry(t.left*r,t.top*o,1,1);ml(p,0,t.left,1-t.top,1),p.translate(t.left*r/2,-t.top*o/2,0),n.topLeft=p}const f=new pe.PlaneGeometry(1,t.top*o,1,1);if(ml(f,t.left,1-t.right,1-t.top,1),f.translate(0,-t.top*o/2,0),n.top=f,t.right){const p=new pe.PlaneGeometry(t.right*r,t.top*o,1,1);ml(p,1-t.right,1,1-t.top,1),p.translate(-t.right*r/2,-t.top*o/2,0),n.topRight=p}}if(t.left){const f=new pe.PlaneGeometry(t.left*r,1,1,1);ml(f,0,t.left,t.bottom,1-t.top),f.translate(t.left*r/2,0,0),n.left=f}const d=new pe.PlaneGeometry(1,1,1,1);if(ml(d,t.left,1-t.right,t.bottom,1-t.top),n.middle=d,t.right){const f=new pe.PlaneGeometry(t.right*r,1,1,1);ml(f,1-t.right,1,t.bottom,1-t.top),f.translate(-t.right*r/2,0,0),n.right=f}if(t.bottom){if(t.left){const p=new pe.PlaneGeometry(t.left*r,t.bottom*o,1,1);ml(p,0,t.left,0,t.bottom),p.translate(t.left*r/2,t.bottom*o/2,0),n.bottomLeft=p}const f=new pe.PlaneGeometry(1,t.bottom*o,1,1);if(ml(f,t.left,1-t.right,0,t.bottom),f.translate(0,t.bottom*o/2,0),n.bottom=f,t.right){const p=new pe.PlaneGeometry(t.right*r,t.bottom*o,1,1);ml(p,1-t.right,1,0,t.bottom),p.translate(-t.right*r/2,t.bottom*o/2,0),n.bottomRight=p}}}let a=i.backgroundMaterial;t&&(Fb||(Fb=new pe.MeshBasicMaterial({alphaTest:1.1})),a=Fb);const l=new pe.PlaneGeometry(1,1,i._segments.value,i._segments.value),c=new pe.BufferAttribute(new Float32Array(l.getAttribute("uv").array),2);if(l.setAttribute("uvB",c).name="uvB",super(l,a),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new pe.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new pe.Vector3(r,o,1);for(const u in n){const d=new pe.Mesh(n[u],i.backgroundMaterial);this.add(d),n[u]=d}this.updateScale=this.updateScaleSlice,this.slices=n}}updateScale(){}updateScaleSlice(){const i=new pe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(i.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(i.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const n=this.slices[t];n.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const r=VN[t];for(const a in r)n.position[a]=this.scale[a]*r[a]*n.scale[a];const o=WN[t];if(o){o.x&&(n.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),o.y&&(n.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const a in o){const l=this.scale[a]-(1-this.sliceSize[a])*this.sliceScale[a];n.scale[a]=Math.max(0,l*(1/this.scale[a]))}}}i.x!==1&&(this.slices.left.scale.x*=i.x,this.slices.topLeft.scale.x*=i.x,this.slices.bottomLeft.scale.x*=i.x,this.slices.right.scale.x*=i.x,this.slices.topRight.scale.x*=i.x,this.slices.bottomRight.scale.x*=i.x),i.y!==1&&(this.slices.top.scale.y*=i.y,this.slices.topLeft.scale.y*=i.y,this.slices.topRight.scale.y*=i.y,this.slices.bottom.scale.y*=i.y,this.slices.bottomLeft.scale.y*=i.y,this.slices.bottomRight.scale.y*=i.y)}}const VN={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},WN={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function ml(s,i,t,n,r){const o=t-i,a=r-n,l=s.attributes.uv;for(let u=0;u<l.count;u++){const d=l.getX(u),f=l.getY(u);l.setXY(u,i+d*o,n+f*a)}const c=new pe.BufferAttribute(new Float32Array(s.getAttribute("uv").array),2);s.setAttribute("uvB",c).name="uvB"}class wM extends Ot{constructor(){super("renderer")}render(i){i._backgroundMesh||i.setBackgroundMesh(new _M(i)),i.performAfterUpdate()}}class qN extends rM{constructor(){super("position")}update(i,t){super.update(i,t),this._needsProcess=!0}}class XN extends Ot{constructor(){super("autosize"),this._needsProcess=!0}process(i){i._width._auto&&YN(i),i._height._auto&&KN(i);const t=i._alignItems._value==="stretch",n=t&&i._flexDirection._value.indexOf("column")!==-1,r=t&&!n;for(const o of i._children._boxes)(o._width._auto&&n||o._width._relative)&&o._bounds.setReferenceWidth(o,i._bounds._innerWidth),(o._height._auto&&r||o._height._relative)&&o._bounds.setReferenceHeight(o,i._bounds._innerHeight)}}function YN(s){s._bounds.setChildrenWidth(s,ZN(s))}function KN(s){s._bounds.setChildrenHeight(s,JN(s))}function JN(s){switch(s._flexDirection._value){case"row":case"row-reverse":return i4(s);case"column":case"column-reverse":return e4(s)}}function ZN(s){switch(s._flexDirection._value){case"row":case"row-reverse":return $N(s);case"column":case"column-reverse":return t4(s)}}function $N(s){let i=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const n=t._margin._value,r=t._bounds._offsetWidth+n.y+n.w;i+=r}return i}function e4(s){let i=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const n=t._margin._value,r=t._bounds._offsetHeight+n.x+n.z;i+=r}return i}function t4(s){let i=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const n=t._margin._value,r=t._bounds._offsetWidth+n.y+n.w;r>i&&(i=r)}return i}function i4(s){let i=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const n=t._margin._value,r=t._bounds._offsetHeight+n.x+n.z;r>i&&(i=r)}return i}class Wg extends _m{constructor(i,t){Wg.definePropertiesValues(i,t),super(i,t),Wg.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new pe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(i,t){i.children||(i.children=bN),i.bounds||(i.bounds=bM),i.flexDirection||(i.flexDirection=BN),i.justifyContent||(i.justifyContent=ON),i.alignItems||(i.alignItems=xN),i.position||(i.position=qN),i.autoSize||(i.autoSize=XN),i.renderer||(i.renderer=wM),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(i){Object.defineProperties(i,{isBox:{configurable:!1,enumerable:!0,value:!0}}),i.backgroundMaterial=new yM,i._renderer.render(i),i._backgroundMesh.visible=!1}}class k1 extends Array{constructor(...i){super(...i),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class n4 extends Ot{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(i,t){this._childrenPos={};for(const n of i._children._boxes)n._position._value==="static"&&(this._childrenPos[n.id]=n.position)}process(i){}}class qg extends Wg{constructor(i={}){const t={};qg.definePropertiesValues(t,i),super(t,i),qg.init(this)}add(i){const t=[];for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isBox?t.push(r):console.warn("Block element can only contain Box elements.",r)}return super.add(...t)}static definePropertiesValues(i,t){i.layouter=n4}static init(i){Object.defineProperties(i,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class s4 extends Ot{constructor(){super("textContent",null,!1)}update(i,t){i._glyphs._needsUpdate=!0,i._whiteSpace._needsProcess=!0}}class r4 extends Ot{constructor(){super("inlines",null,!1),this._value=null}process(i){if(this._value=i._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=i._padding._value.w,this._value[0].marginLeft=i._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=i._padding._value.y,this._value[t].marginRight=i._margin._value.y}i._fontSize._needsProcess=!0,i._lineBreak._needsProcess=!0,i._fontKerning._needsProcess=!0,i._layouter._needsProcess=!0}get value(){return this._value}}class o4 extends Ot{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(i){i._font._fontVariant&&i._font._fontVariant.isReady&&(this._value=i._whiteSpace._whiteSpacedContent.split("").map(t=>i._font._fontVariant.getTypographicGlyph(t)),this._value&&(i._inlines._needsProcess=!0))}get value(){return this._value}}class a4 extends Vg{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(i){this._input==="inherit"?this._value.set(this.getInheritedInput(i)):this._value.set(this._input)}}class xM extends Ot{constructor(i=`- ,.:?!
`){super("lineBreak",i,!0),this._newLineBreakability=null}update(i,t){this._needsProcess=!0}process(i){const t=i._whiteSpace._newLineBreakability;if(i._inlines._value)for(let n=0;n<i._inlines._value.length;n++){const r=i._inlines._value[n],o=r.char;let a=null;o!==void 0&&(t!=="nowrap"&&(this._value.includes(o)||o.match(/\s/g))&&(a="possible"),o.match(/\n/g)&&(a=t)),r.lineBreak=a}}get value(){return this._value}}class CM extends Ot{constructor(){super("layouter",null,!1),this._value=null}update(i,t){this._value=i._parent.find(n=>n.isUI&&n.isText),this._needsProcess=!0}process(i){this._value&&(this._value._layouter._needsProcess=!0)}}class l4 extends Vg{constructor(i){super("backgroundColor",i,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(i){this._input==="inherit"?this._value.set(this.getInheritedInput(i)):this._value.set(this._input)}}class SM extends lM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class EM extends cM{constructor(){super()}computeOutputValue(i){this._value=GC(this.getInheritedInput(i))}}class IM extends fM{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(i){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(i)),t instanceof f0)this._value=t,i._font._needsUpdate=!0;else if(typeof t=="string"){const n=Su.getFontFamily(t);n?(this._value=n,i._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class lS extends gM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(i){switch(super._computeFromInherited(i),this._newLineBreakability=c4(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=h4;break;case"pre-line":this._stringCollapser=TM;break;default:this._stringCollapser=u4}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=m4;break;case"pre-wrap":this._inlineCollapser=g4;break;default:this._inlineCollapser=A4}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=d4;break;case"pre":this._inlineWrapper=f4;break;default:this._inlineWrapper=p4}this._needsProcess=!0}process(i){i.isInline&&!i.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(i._textContent._value),i._glyphs._needsProcess=!0)}}const D1={"	":"	","\n":`
`,"\r":"\r"," ":" "},c4=function(s){switch(s){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function h4(s){return TM(s.replace(/\n/g," "))}function TM(s){return s.replace(/[ ]{2,}/g," ")}function u4(s){return s}function d4(s,i,t,n){const r=s[i];if(r.lineBreak==="mandatory"||t+r.xadvance+r.xoffset+r.kerning>n.INNER_WIDTH)return!0;const o=PM(s,i,n);return v4(s[i-1],t,o,n)}function f4(s,i,t,n){return s[i].lineBreak==="mandatory"}function p4(){return!1}function g4(s){if(!s[0])return 0;const i=s[0],t=s[s.length-1];return i.char&&i.char===`
`&&s.length>1&&BM([i],s[1]),t.char&&t.char===`
`&&s.length>1&&RM([t],s[s.length-2]),i.offsetX}function m4(s){if(!s[0])return 0;let i=[],t;for(let n=0;n<s.length;n++){const r=s[n];if(r.char&&D1[r.char]&&s.length>n){i.push(r),t=s[n+1];continue}break}BM(i,t),i=[],t=null;for(let n=s.length-1;n>0;n--){const r=s[n];if(r.char&&D1[r.char]&&n>0){i.push(r),t=s[n-1];continue}break}return RM(i,t),s[0].offsetX}function A4(s){return s[0]?s[0].offsetX:0}function RM(s,i){if(i)for(let t=0;t<s.length;t++){const n=s[t];n.fontFactor=0,n.offsetX=i.offsetX+i.cumulativeWidth,n.cumulativeWidth=0}}function BM(s,i){if(i)for(let t=0;t<s.length;t++){const n=s[t];n.fontFactor=0,n.offsetX=i.offsetX,n.cumulativeWidth=0}}function PM(s,i,t,n){if(n=n||0,!s[i])return n;const r=s[i];return r.lineBreak?n+r.xadvance:PM(s,i+1,t,n+r.xadvance+r.xoffset+r.kerning+t.LETTERSPACING)}function v4(s,i,t,n){return!s||!s.char||i+t<n.INNER_WIDTH?!1:n.BREAKON.indexOf(s.char)>-1}class MM extends mM{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(i){super._computeFromInherited(i),i._fontSize._needsProcess=!0,i._layouter._needsProcess=!0}}class kM extends vi{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(i){this._value=this._inheritedInput,i._font._fontVariant&&(i._bounds._needsProcess=!0,i._layouter._needsProcess=!0)}process(i){if(!i._font._fontVariant||!i._font._fontVariant.isReady)return;const t=this._value/i._font._fontVariant.typographic.size,n=i._inlines._value;for(let r=0;r<n.length;r++){const o=n[r];o.resetOffsets(),o.fontSize=this._value,o.fontFactor=t}}get value(){return this._value}}class DM extends AM{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(i,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(i)),i._layouter._needsUpdate=!0}set value(i){this._value!==i&&(this._value=i,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class y4 extends DM{constructor(){super(),this._value="inherit"}}class b4 extends p0{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(i){super._computeFromInherited(i),i._parent._value._layouter._needsProcess=!1}process(i){if(this._value!=="none"){const t=i._whiteSpace._whiteSpacedContent,n=i._inlines._value;for(let r=1;r<n.length;r++){const o=t[r-1]+t[r];n[r].kerning=i._font._fontVariant.getKerningAmount(o)}}}}class OM extends Ot{constructor(){super("children",null,!1),this._uis=[]}update(i,t){}process(i){}_compute(i){}dispose(){}}function _4(s,i=!1){const t=s[0].index!==null,n=new Set(Object.keys(s[0].attributes)),r=new Set(Object.keys(s[0].morphAttributes)),o={},a={},l=s[0].morphTargetsRelative,c=new pe.BufferGeometry;let u=0;for(let d=0;d<s.length;++d){const f=s[d];let p=0;if(t!==(f.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const g in f.attributes){if(!n.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+g+'" attribute exists among all geometries, or in none of them.'),null;o[g]===void 0&&(o[g]=[]),o[g].push(f.attributes[g]),p++}if(p!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(l!==f.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in f.morphAttributes){if(!r.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;a[g]===void 0&&(a[g]=[]),a[g].push(f.morphAttributes[g])}if(i){let g;if(t)g=f.index.count;else if(f.attributes.position!==void 0)g=f.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;c.addGroup(u,g,d),u+=g}}if(t){let d=0;const f=[];for(let p=0;p<s.length;++p){const g=s[p].index;for(let m=0;m<g.count;++m)f.push(g.getX(m)+d);d+=s[p].attributes.position.count}c.setIndex(f)}for(const d in o){const f=O1(o[d]);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" attribute."),null;c.setAttribute(d,f)}for(const d in a){const f=a[d][0].length;if(f===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[d]=[];for(let p=0;p<f;++p){const g=[];for(let A=0;A<a[d].length;++A)g.push(a[d][A][p]);const m=O1(g);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" morphAttribute."),null;c.morphAttributes[d].push(m)}}return c}function O1(s){let i,t,n,r=-1,o=0;for(let u=0;u<s.length;++u){const d=s[u];if(i===void 0&&(i=d.array.constructor),i!==d.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=d.itemSize),t!==d.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=d.normalized),n!==d.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=d.gpuType),r!==d.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=d.count*t}const a=new i(o),l=new pe.BufferAttribute(a,t,n);let c=0;for(let u=0;u<s.length;++u){const d=s[u];if(d.isInterleavedBufferAttribute){const f=c/t;for(let p=0,g=d.count;p<g;p++)for(let m=0;m<t;m++){const A=d.getComponent(p,m);l.setComponent(p+f,m,A)}}else a.set(d.array,c);c+=d.count*t}return r!==void 0&&(l.gpuType=r),l}class w4 extends Ot{constructor(){super("renderer")}render(i){if(!i._inlines._value||!i._inlines._value.length)return;const t=i._inlines._value.map(r=>i._font._fontVariant.getGeometricGlyph(r,i).translate(r.offsetX,r.offsetY,0)),n=_4(t);i.setFontMesh(new pe.Mesh(n,i.fontMaterial)),i._fontMesh.renderOrder=1/0}}class x4 extends VC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(i){this._value=this._inheritedInput,i._layouter._needsProcess=!0}}class Ef extends _m{constructor(t={}){const n={};Ef.definePropertiesValues(n,t);super(n,t);h(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});Ef.init(this)}add(t){const n=[];for(let r=0;r<arguments.length;r++){const o=arguments[r];!o.isUI||o.isInline?(n.push(o),o.position.z=.005):console.warn("Block element can only contain Box elements.",o)}return super.add(...n)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,n){t.children||(t.children=OM),t.textContent||(t.textContent=s4),t.glyphs||(t.glyphs=o4),t.inlines||(t.inlines=r4),t.layouter||(t.layouter=CM),t.renderer||(t.renderer=w4),t.fontFamily||(t.fontFamily=IM),t.fontWeight||(t.fontWeight=EM),t.fontStyle||(t.fontStyle=SM),t.fontSize||(t.fontSize=kM),t.color||(t.color=a4),t.backgroundColor||(t.backgroundColor=l4),t.lineBreak||(t.lineBreak=xM),t.letterSpacing||(t.letterSpacing=MM),t.whiteSpace||(t.whiteSpace=lS),t.segments||(t.segments=y4),t.textAlign||(t.textAlign=x4),t.fontKerning||(t.fontKerning=b4)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class C4 extends aM{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(i){this._value!==i&&(this._value=i,this._needsUpdate=!0)}update(i,t){this._needsUpdate=!1;for(let n=i.children.length-1;n>=0;n--){const r=i.children[n];r.isUI&&(i.remove(r),r.clear())}i._children._uis=[],this._value&&i.add(new Ef({name:"anonymousInline",textContent:this._value}))}}class S4 extends Array{constructor(...i){super(...i),this.width=0,this.height=0}}class E4 extends Ot{constructor(){super("layouter",null,!1),this._value=null}update(i,t){}process(i){let t=i._width._value;i._width._auto?t=1/0:t=i._bounds._innerWidth;const n=i._lineHeight._value,r=new S4(new k1);let o=0;i._children._inlines.forEach(f=>{if(!f._inlines.value)return;this._resetInlines(f);const p=f._fontSize._value,g=f._letterSpacing._value*p,m=f._whiteSpace._value,A=f._lineBreak._value,y={WHITESPACE:m,LETTERSPACING:g,BREAKON:A,INNER_WIDTH:t},b=f._whiteSpace._inlineWrapper;o+=f._margin._value.w+f._padding._value.w,f._inlines.value.forEach((_,w,S)=>{const E=r[r.length-1];if(b(S,w,o,y)){if(r.push(new k1(_)),_.offsetX=_.xoffset,_.width===0){o=0;return}_.cumulativeWidth=_.xadvance+g,o=_.cumulativeWidth;return}r[r.length-1].push(_),_.offsetX=o+_.xoffset+_.kerning,_.cumulativeWidth=_.xadvance+_.kerning+g,o+=_.cumulativeWidth,E.length-1===1&&E[E.length-2].width===0&&(_.offsetX-=_.xoffset,o-=_.xoffset)}),o+=f._margin._value.y+f._padding._value.y});const a=i._whiteSpace._inlineCollapser;let l=0,c=0,u=0;r.forEach((f,p)=>{const g=a(f);let m=0,A=0;if(f.forEach(y=>{m=Math.max(m,y.lineHeight),A=Math.max(A,y.lineBase),y.offsetX-=g}),f.lineHeight=m,f.lineBase=A,p===0?u=-(m*n-m)*.5:u-=r[p-1].lineHeight*n,f.y=u,f.x=0,f.forEach(y=>{y.offsetY=u-y.anchor,y.lineHeight<f.lineHeight&&(y.offsetY-=f.lineBase-y.lineBase)}),c+=f.lineHeight*n,f.width=0,f[0]){const y=f[f.length-1];f.width=y.offsetX+y.cumulativeWidth+y.paddingRight+y.marginRight+f[0].offsetX,l=Math.max(l,f.width)}}),r.height=c,r.width=l,this._value=r,t===1/0&&i._bounds.setChildrenWidth(i,r.width),i._height._auto&&i._bounds.setChildrenHeight(i,r.height);const d=i._parent._value;d&&(d._autoSize._needsProcess=!0,d._flexDirection._needsProcess=!0),i._inlineJustificator._needsProcess=!0,i._textAlign._needsProcess=!0,i._overflow._needsUpdate=!0}_resetInlines(i){i._fontSize.process(i)}}class I4 extends VC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(i){this._value=this._inheritedInput,this._needsProcess=!0}process(i){T4(i),i._renderer._needsRender=!0}}function T4(s){const i=s._layouter._value,t=s._textAlign._value,n=s._bounds._innerWidth;for(let r=0;r<i.length;r++){const o=i[r],a=R4(s,o,r===i.length-1),l=s._padding._value,c=s._borderWidth._value,u=(-l.w+l.y)/2+(-c.w+c.y)/2;o.x+=a;for(let d=0;d<o.length;d++)o[d].offsetX+=a-u}if(t.indexOf("justify")===0)for(let r=0;r<i.length;r++){const o=i[r];if(t.indexOf("-")!==-1&&r===i.length-1)return;const a=n-o.width;if(a<=0)return;let l=0;for(let f=1;f<o.length-1;f++)l+=o[f].char===" "?1:0;const c=a/l;let u=1;t==="justify-right"&&(o.reverse(),u=-1);let d=0;for(let f=1;f<=o.length-1;f++){const p=o[f];p.offsetX+=d*u,d+=p.char===" "?c:0}t==="justify-right"&&o.reverse()}}function R4(s,i,t){switch(s._textAlign._value){case"justify-left":case"justify":case"left":return-s._bounds._innerWidth/2;case"justify-right":case"right":return-i.width+s._bounds._innerWidth/2;case"center":return-i.width/2;case"justify-center":return t?-i.width/2:-s._bounds._innerWidth/2;default:console.warn(`textAlign: '${s._textAlign._value}' is not valid`)}}class B4 extends WC{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(i){this._value=this._inheritedInput}}class P4 extends pM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class M4 extends p0{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(i){super._computeFromInherited(i)}}class k4 extends bM{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class D4 extends Ot{constructor(){super("children",null,!1);h(this,"_sortOrder",(t,n)=>t._order._value<n._order._value?-1:t._order._value>n._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(n)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,n){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(n=>n.visible&&n.isUI),this._inlines=this._uis.filter(n=>n.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class O4 extends Ot{constructor(){super("autosize")}process(i){if(i._layouter._value&&i._layouter._value.length){const t=i._layouter._value,n=i._padding._value,r=i._borderWidth._value;i._width._auto&&i._bounds.setOffsetWidth(i,t.width+n.w+n.y+r.w+r.y),i._height._auto&&i._bounds.setOffsetHeight(i,t.height+n.x+n.z+r.x+r.z)}}}class L4 extends wM{constructor(){super("renderer"),this._needsUpdate=!1}render(i){super.render(i);for(const t of i._children._inlines)t._renderer.render(t);i.performAfterUpdate()}}class Xg extends Wg{constructor(i={},t={}){Xg.definePropertiesValues(t,i),super(t,i),Xg.init(this)}add(i){const t=[];let n=!1;for(let r=0;r<arguments.length;r++){const o=arguments[r];!o.isUI||o.isInline?(o.isInline&&(n=!0),t.push(o)):console.warn("Block element can only contain Box elements.",o)}return t.length>0&&super.add(...t),n&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(i){this._textContent.value=i}get textContent(){return super.textContent}set invertAlpha(i){this._invertAlpha.value=i}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(i,t){i.flexDirection=B4,i.justifyContent=qC,i.alignItems=HC,i.bounds=k4,i.autoSize=O4,i.renderer=L4,i.children||(i.children=D4),i.textContent||(i.textContent=C4),i.layouter||(i.layouter=E4),i.lineHeight||(i.lineHeight=P4),i.textAlign||(i.textAlign=I4),i.whiteSpace||(i.whiteSpace=lS),i.fontKerning||(i.fontKerning=M4),i.segments||(i.segments=DM),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(i){Object.defineProperties(i,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class F4 extends Ot{constructor(){super("inlines",null,!1),this._value=[]}process(i){this._value[0].paddingLeft=i._padding._value.w,this._value[0].marginLeft=i._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=i._padding._value.y,this._value[t].marginRight=i._margin._value.y}}class U4 extends Ot{constructor(){super("renderer")}render(i){i._backgroundMesh||i.setBackgroundMesh(new _M(i)),i._backgroundMesh.position.x=i._inlines._value[0].offsetX+i._inlines._value[0].width/2,i._backgroundMesh.position.y=i._inlines._value[0].offsetY+i._inlines._value[0].lineBase/2,i._bounds.render(i)}}class N4 extends Ot{constructor(){super("bounds",null,!1),this._size=new pe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(i,t){this.output(t),this._needsProcess=!0}process(i){this._offsetWidth=this._innerWidth=i._inlines._value[0].width,this._offsetHeight=this._innerHeight=i._inlines._value[0].height,this._needsRender=!0,i._borderWidth._needsRender=!0,i._borderRadius._needsRender=!0}render(i){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(i){i.size=this._size}}class Yg extends _m{constructor(i={}){const t={};Yg.definePropertiesValues(t,i),super(t,i),Yg.init(this)}clear(){for(const i of this._inlines._value)i.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new pe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(i){const t=[];for(let n=0;n<arguments.length;n++){const r=arguments[n];r.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",r):(t.push(r),r.position.z=.005)}return super.add(...t)}static definePropertiesValues(i,t){i.children||(i.children=OM),i.bounds||(i.bounds=N4),i.inlines||(i.inlines=F4),i.layouter||(i.layouter=CM),i.renderer||(i.renderer=U4),i.fontFamily||(i.fontFamily=IM),i.fontWeight||(i.fontWeight=EM),i.fontStyle||(i.fontStyle=SM),i.fontSize||(i.fontSize=kM),i.backgroundColor||(i.backgroundColor=sM),i.lineBreak||(i.lineBreak=xM),i.letterSpacing||(i.letterSpacing=MM),i.whiteSpace||(i.whiteSpace=lS),i.fontKerning||(i.fontKerning=p0),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(i){Object.defineProperties(i,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),i._inlines._value=[new z4(i)],i.backgroundMaterial=new yM,i._renderer.render(i)}}class z4 extends $P{constructor(i){super(),this._uiElement=i}get xadvance(){const i=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):i.w+i.y+t.value}get width(){const i=this._uiElement._width;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):i.value}get height(){const i=this._uiElement._height;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):i.value}get anchor(){return this.height}get lineHeight(){const i=this._uiElement._height;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):i.value}get lineBase(){const i=this._uiElement._height;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):i.value}clear(){this._uiElement=null}}class LM{constructor(i){this._subject=i}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const FM=()=>Kv.update(),UM={BaseProperty:Ot,Block:qg,Text:Xg,Inline:Ef,InlineBlock:Yg,MeshUIBaseElement:_m,FontLibrary:Su,update:FM,MSDFFontMaterialUtils:lo,ShaderChunkUI:vM,Behavior:LM,FontVariant:bm};typeof global<"u"&&(global.ThreeMeshUI=UM);const Q4=UM;var j4=Ki.ti,NM=Ki.nS,cS=Ki.eB,G4=Ki.Yp,Ww=Ki.VB,H4=Ki.BC,V4=Ki.zN,mv=Ki.cV,W4=Ki.hW,q4=Ki.k2,X4=Ki.K6,Y4=Ki.M7,K4=Ki.ls,J4=Ki.Hi,hS=Ki.EY,Z4=Ki.MR,$4=Ki.zf,qt=Ki.Ay,zM=Ki.yo;const L1=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:j4,Behavior:NM,Block:cS,DefaultValues:G4,FontLibrary:Ww,FontVariant:H4,InheritableProperty:V4,Inline:mv,InlineBlock:W4,InlineGlyph:q4,MSDFFontMaterialUtils:X4,MaterialTransformers:Y4,MeshUIBaseElement:K4,ShaderChunkUI:J4,Text:hS,TypographicFont:Z4,TypographicGlyph:$4,default:qt,update:zM},Symbol.toStringTag,{value:"Module"}));class ez{constructor(){h(this,"Rad2Deg",180/Math.PI);h(this,"Deg2Rad",Math.PI/180);h(this,"Epsilon",1e-5)}random(i,t){return Array.isArray(i)?i.length<=0?null:i[Math.floor(Math.random()*i.length)]:i!==void 0&&t!==void 0?Math.random()*(t-i)+i:Math.random()}randomVector3(i,t=0,n=1){i.x=this.random(t,n),i.y=this.random(t,n),i.z=this.random(t,n)}clamp(i,t,n){return i<t?t:i>n?n:i}clamp01(i){return this.clamp(i,0,1)}lerp(i,t,n){return n=n<0?0:n,n=n>1?1:n,i+(t-i)*n}inverseLerp(i,t,n){return(n-i)/(t-i)}remap(i,t,n,r,o){return r+(o-r)*(i-t)/(n-t)}moveTowards(i,t,n){return i+=n,(n<0&&i<t||n>0&&i>t)&&(i=t),i}toDegrees(i){return i*180/Math.PI}toRadians(i){return i*Math.PI/180}tan(i){return Math.tan(i)}gammaToLinear(i){return Math.pow(i,2.2)}linearToGamma(i){return Math.pow(i,1/2.2)}approximately(i,t,n=Number.EPSILON){for(const r of tz){const o=i[r],a=t[r];if(o===void 0||a===void 0)break;if(Math.abs(o-a)>n)return!1}return!0}easeInOutCubic(i){return i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2}}const tz=["x","y","z","w"],ye=new ez;class F1{constructor(i){h(this,"y");h(this,"s");h(this,"alpha",0);this.setAlpha(i),this.y=null,this.s=null}setAlpha(i){if(i<=0||i>1)throw new Error;this.alpha=i}filter(i,t){t&&this.setAlpha(t);let n;return this.y?n=this.alpha*i+(1-this.alpha)*this.s:n=i,this.y=i,this.s=n,n}lastValue(){return this.y}reset(i){this.y=i,this.s=i}}class Ub{constructor(i,t=1,n=0,r=1){h(this,"freq");h(this,"minCutOff");h(this,"beta");h(this,"dCutOff");h(this,"x");h(this,"dx");h(this,"lasttime");if(i<=0||t<=0||r<=0)throw new Error;this.freq=i,this.minCutOff=t,this.beta=n,this.dCutOff=r,this.x=new F1(this.alpha(this.minCutOff)),this.dx=new F1(this.alpha(this.dCutOff)),this.lasttime=null}alpha(i){const t=1/this.freq;return 1/(1+1/(2*Math.PI*i)/t)}filter(i,t=null){this.lasttime&&t&&(this.freq=1/(t-this.lasttime)),this.lasttime=t;const n=this.x.lastValue(),r=n?(i-n)*this.freq:0,o=this.dx.filter(r,this.alpha(this.dCutOff)),a=this.minCutOff+this.beta*Math.abs(o);return this.x.filter(i,this.alpha(a))}reset(i){i!=null&&this.x.reset(i),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class QM{constructor(i,t=1,n=0,r=1){h(this,"x");h(this,"y");h(this,"z");this.x=new Ub(i,t,n,r),this.y=new Ub(i,t,n,r),this.z=new Ub(i,t,n,r)}filter(i,t,n=null){t.x=this.x.filter(i.x,n),t.y=this.y.filter(i.y,n),t.z=this.z.filter(i.z,n)}reset(i){this.x.reset(i==null?void 0:i.x),this.y.reset(i==null?void 0:i.y),this.z.reset(i==null?void 0:i.z)}}class If extends Z{constructor(i,t,n,r=128){if(t<=0||n<=0||r<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const o=new Pu(n,2*r,r);o.scale(1,1,-1);const a=o.getAttribute("position"),l=new x;for(let c=0;c<a.count;++c)if(l.fromBufferAttribute(a,c),l.y<0){const u=-t*3/2,d=l.y<u?-t/l.y:1-l.y*l.y/(3*u*u);l.multiplyScalar(d),l.toArray(a.array,3*c)}a.needsUpdate=!0,super(o,new _t({map:i,depthWrite:!1}))}}const Av="needle:cameraController";function iz(s){return s[Av]}function U1(s,i,t){t?s[Av]=i:s[Av]===i&&(s[Av]=null)}const qw="needle:autofit";function nz(s){return s[qw]===void 0?!0:s[qw]!==!1}function N1(s,i){s[qw]=i}function nK(s,i,t){const n=s.length(),r=i.length(),o=ye.lerp(n,r,t);return s.lerp(i,t).normalize().multiplyScalar(o)}const Nb=new se,sz=new se().setFromAxisAngle(new x(0,1,0),Math.PI);function sK(s,i){s.lookAt(i),s.quaternion.multiply(sz)}function g0(s,i,t=!0,n=!1){if(s===i)return;Nb.copy(s.quaternion);const r=Ve(i),o=Ve(s);if(n){if(na(s,Ht(i)),t){const a=o.y,l=o.sub(GM(s));l.y=a,s.lookAt(l)}Number.isNaN(s.quaternion.x)&&s.quaternion.copy(Nb);return}t&&(r.y=o.y),s.lookAt(r),Number.isNaN(s.quaternion.x)&&s.quaternion.copy(Nb)}const rz=new wo(()=>new x,100);function Be(s,i,t){const n=rz.get();return n.set(0,0,0),s instanceof x?n.copy(s):Array.isArray(s)?n.set(s[0],s[1],s[2]):s instanceof DOMPointReadOnly?n.set(s.x,s.y,s.z):typeof s=="number"&&(n.x=s,n.y=i!==void 0?i:n.x,n.z=t!==void 0?t:n.x),n}const oz=new wo(()=>new xe,30);function az(s){const i=oz.get();return s?i.copy(s):i.set(0,0,0),i}const lz=new wo(()=>new se,100);function Ia(s){const i=lz.get();return i.identity(),s instanceof se?i.copy(s):s instanceof DOMPointReadOnly&&i.set(s.x,s.y,s.z,s.w),i}const uS=new wo(()=>new x,100),z1=Symbol("lastMatrixWorldUpdateKey");function Ve(s,i=null,t=!0){const n=i??uS.get();return s?s.parent?(t&&s.updateWorldMatrix(!0,!1),s.matrixWorldNeedsUpdate&&s[z1]!==Date.now()&&(s[z1]=Date.now(),s.updateMatrixWorld()),n.setFromMatrixPosition(s.matrixWorld),n):n.copy(s.position):n.set(0,0,0)}function Sn(s,i){if(!s)return s;const t=uS.get();return i!==t&&t.copy(i),((s==null?void 0:s.parent)??s).worldToLocal(t),s.position.set(t.x,t.y,t.z),s}function Tf(s,i,t,n){const r=uS.get();return r.set(i,t,n),Sn(s,r),s}const Zv=new wo(()=>new se,100),hu=new se,zb=new se;function Ht(s,i=null){if(!s)return Zv.get().identity();const t=i??Zv.get();return s.parent?(s.getWorldQuaternion(t),t):t.copy(s.quaternion)}function na(s,i){if(!s)return;i!==hu&&hu.copy(i);const t=hu,n=s==null?void 0:s.parent;n==null||n.getWorldQuaternion(zb),zb.invert();const r=zb.multiply(t);s.quaternion.set(r.x,r.y,r.z,r.w)}function jM(s,i,t,n,r){hu.set(i,t,n,r),na(s,hu)}const cz=new wo(()=>new x,100),hz=new x;function oi(s,i=null){return i||(i=cz.get()),s?s.parent?(s.getWorldScale(i),i):i.copy(s.scale):i.set(0,0,0)}function Kg(s,i){if(!s)return;if(!s.parent){s.scale.copy(i);return}const t=hz;s.parent.getWorldScale(t),s.scale.copy(i),s.scale.divide(t)}const uz=new x,Q1=new se;function rK(s){return Ht(s,Q1),uz.set(0,0,1).applyQuaternion(Q1)}const dz=new wo(()=>new x,100),j1=new se;function GM(s,i){return i||(i=dz.get().set(0,0,1)),Ht(s,j1),i.applyQuaternion(j1)}const G1=new Gt,H1=new Gt,fz=new x;function HM(s){const i=Zv.get();return s.getWorldQuaternion(i),H1.setFromQuaternion(i),H1}function VM(s,i){const t=Zv.get();na(s,t.setFromEuler(i))}function m0(s){const i=HM(s),t=fz;return t.set(i.x,i.y,i.z),t.x=ye.toDegrees(t.x),t.y=ye.toDegrees(t.y),t.z=ye.toDegrees(t.z),t}function WM(s,i){A0(s,i.x,i.y,i.z,!0)}function A0(s,i,t,n,r=!0){r&&(i=ye.toRadians(i),t=ye.toRadians(t),n=ye.toRadians(n)),G1.set(i,t,n),hu.setFromEuler(G1),na(s,hu)}function Xw(s,i=!0){s&&(i?function t(n){console.groupCollapsed((n.name?n.name:"(no name : "+n.type+")")+" %o",n),n.children.forEach(t),console.groupEnd()}(s):s.traverse(function(t){for(var n="|___",r=t;r.parent!==null;)n="	"+n,r=r.parent;console.log(n+t.name+" <"+t.type+">")}))}function oK(s){let i=(s==null?void 0:s.name)||"";if(!s)return i;let t=s.parent;for(;t;)i=t.name+"/"+i,t=t.parent;return i}function pz(s){if(s){const i=s;return i.blendMode!==void 0&&i.clampWhenFinished!==void 0&&i.enabled!==void 0&&i.fadeIn!==void 0&&i.getClip!==void 0}return!1}class Ho{static createBlitMaterial(i){return new et({uniforms:{map:new ee(null)},vertexShader:this.vertex,fragmentShader:i})}static copyTexture(i,t){const n=t??this.blipMaterial;n.uniforms.map.value=i,n.needsUpdate=!0,n.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new et({uniforms:{map:new ee(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const r=n.vertexShader;n.vertexShader=this.vertex,this.mesh||(this.mesh=new Z(this.planeGeometry,this.blipMaterial));const o=this.mesh;o.material=n,o.frustumCulled=!1,this.scene.children.length=0,this.scene.add(o),this.renderer||(this.renderer=new Mu({antialias:!1})),this.renderer.setSize(i.image.width,i.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const a=new At(this.renderer.domElement);return a.name="Copy",a.needsUpdate=!0,n.vertexShader=r,a}static textureToCanvas(i,t){if(!i)return null;(t===!0||i.isCompressedTexture===!0)&&(i=gz(i));const n=i.image;if(mz(n)){const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d");return o?(o.drawImage(n,0,0,n.width,n.height,0,0,r.width,r.height),r):(console.error("Failed getting canvas 2d context"),null)}return null}}h(Ho,"planeGeometry",new pr(2,2,1,1)),h(Ho,"renderer"),h(Ho,"perspectiveCam",new bt),h(Ho,"scene",new ws),h(Ho,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),h(Ho,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),h(Ho,"blipMaterial"),h(Ho,"mesh");function gz(s){return Ho.copyTexture(s)}function aK(s,i=!1){return Ho.textureToCanvas(s,i)}function mz(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}function Az(s){const i=s.type;return i==="Mesh"||i==="SkinnedMesh"}function qM(s,i){i?s["needle:rendercustomshadow"]=!0:s["needle:rendercustomshadow"]=!1}function vz(s){if(s){if(s["needle:rendercustomshadow"]===!0)return!0;if(s["needle:rendercustomshadow"]==null)return!0}return!1}function sl(s,i=void 0){const t=new Cn;t.makeEmpty();const n=[];function r(a){let l=!0;if(a.visible&&nz(a)!==!1&&!(a.type==="TransformControlsGizmo"||a.type==="TransformControlsPlane")){if(a instanceof AP&&(l=!1),a instanceof SC&&(l=!1),a instanceof If&&(l=!1),a.isGizmo===!0&&(l=!1),a.material instanceof mP&&(l=!1),Az(a)||(l=!1),l){if(i&&Array.isArray(i)&&(i!=null&&i.includes(a)))return;if(typeof i=="function"&&i(a)===!0)return}if(a.isUI!==!0){if(l){const c=a.children;a.children=n;const u=a.position,d=a.scale;if(Number.isNaN(u.x)||Number.isNaN(u.y)||Number.isNaN(u.z)){console.warn(`Object "${a.name}" has NaN values in position or scale.... will ignore it`,u,d);return}t.expandByObject(a,!0),a.children=c}for(const c of a.children)r(c)}}}let o=!1;for(const a of s)a&&(o=!0,a.updateMatrixWorld(),r(a));return o||console.warn("No objects to fit camera to..."),t}function yz(s,i,t){const n=sl([s],t==null?void 0:t.ignore),r=new x;n.getSize(r);const o=new x;n.getCenter(o);const a=new x;i.getSize(a);const l=new x;i.getCenter(l);const c=new x;c.set(a.x/r.x,a.y/r.y,a.z/r.z);const u=Math.min(c.x,c.y,c.z),d=(t==null?void 0:t.scale)!==!1;if(d&&Kg(s,oi(s).multiplyScalar(u)),(t==null?void 0:t.position)!==!1){const f=new x;n.getCenter(f),f.y=n.min.y;const p=new x;i.getCenter(p),p.y=i.min.y;const g=p.clone().sub(f);d&&g.multiplyScalar(u),Sn(s,Ve(s).add(g))}return{boundsBefore:n,scale:c}}function bz(s,i){const t=sl([s]),n=new x;t.getCenter(n),n.y=t.min.y;const r=i.clone().sub(n),o=Ve(s);return Sn(s,o.add(r)),{offset:r,bounds:t}}function XM(s,i,t,n){if(Array.isArray(i)){let a=!0;for(let l=0;l<i.length;l++)XM(s,i[l],l,i)||(a=!1);return a}if(i.type==="MeshStandardMaterial")return!1;if(i["material:fbx"]!=null)return!0;const r=new Jn;r["material:fbx"]=i;const o=i;return o&&(o.map?r.color.set(1,1,1):r.color.copyLinearToSRGB(o.color),r.emissive.copyLinearToSRGB(o.emissive),r.emissiveIntensity=o.emissiveIntensity,r.opacity=o.opacity,r.displacementScale=o.displacementScale,r.transparent=o.transparent,r.bumpMap=o.bumpMap,r.aoMap=o.aoMap,r.map=o.map,r.displacementMap=o.displacementMap,r.emissiveMap=o.emissiveMap,r.normalMap=o.normalMap,r.envMap=o.envMap,r.alphaMap=o.alphaMap,r.metalness=o.reflectivity,o.shininess&&(r.roughness=1-Math.sqrt(o.shininess)/10),r.needsUpdate=!0),t===void 0?s.material=r:n[t]=r,!0}let fA=!1;vU((...s)=>{var i;be()&&((i=xt.Current)!=null&&i.isInXR)&&(of(!0),YM("error",...s))});function of(s){if(s){if(fA)return;fA=!0,wz()}else{if(!fA)return;fA=!1,xz()}}const tg={log:void 0,warn:void 0,error:void 0};class _z{constructor(){h(this,"familyName","needle-xr");h(this,"root",null);h(this,"context",null);h(this,"defaultFontSize",.06);h(this,"targetObject",new ne);h(this,"userForwardViewPoint",new x);h(this,"oneEuroFilter",new QM(90,.8));h(this,"_lastElementRemoveTime",0);h(this,"onBeforeRender",()=>{var t,n;const i=(t=this.context)==null?void 0:t.mainCamera;if(this.context&&i instanceof bt){const r=this.getRoot();Number.isNaN(r.position.x)&&r.position.set(0,0,0),Number.isNaN(r.quaternion.x)&&r.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const o=((n=this.context.xr)==null?void 0:n.rigScale)??1,a=3.5*o,l=i.worldForward;l.y=0,l.normalize().multiplyScalar(a),this.userForwardViewPoint.copy(i.worldPosition).sub(l),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*o&&(this.targetObject.position.copy(this.userForwardViewPoint),g0(this.targetObject,i,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,r.position,this.context.time.time);const u=this.context.time.deltaTime;if(r.quaternion.slerp(this.targetObject.quaternion,u*5),r.scale.setScalar(o),this.targetObject.removeFromParent(),this.context.scene.add(r),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const d=Date.now();for(let f=0;f<this._activeTexts.length;f++){const p=this._activeTexts[f];if(p instanceof qt.Text&&d-p._activatedTime>2e4){p.removeFromParent(),this._textBuffer.push(p),this._activeTexts.splice(f,1);break}}}}});h(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});h(this,"_textBuffer",[]);h(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=xt.Current||xt.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var i,t,n;(t=this.context)==null||t.pre_render_callbacks.splice((i=this.context)==null?void 0:i.pre_render_callbacks.indexOf(this.onBeforeRender),1),(n=this.root)==null||n.removeFromParent()}addLog(i,t){const n=this.getRoot(),r=this.getText();let o=16777215,a=0;switch(i){case"log":o=16777215,a=0;break;case"warn":o=16772761,a=4465152;break;case"error":o=16755370,a=7798784;break}t.length>1e3&&(t=t.substring(0,1e3)+"...");const l=new Date().toISOString().split("T")[1].split(".")[0];r.textContent="["+l+"] "+t,r.visible=!0,r._activatedTime=Date.now(),n.add(r),this._activeTexts.push(r),this.context&&this.context.scene.add(n),r.set({backgroundColor:o,color:a}),qt.update()}ensureFont(){let i=qt.FontLibrary.getFontFamily(this.familyName);if(!i){i=qt.FontLibrary.addFontFamily(this.familyName);const t=i.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{qt.update()})}}getText(){const i=this.getRoot();if(this._textBuffer.length>0){const n=this._textBuffer.pop();return n.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(n),100),n}if(i.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const t=new qt.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(t),500),setTimeout(()=>this.disableDepthTestRecursive(t),1500),t}disableDepthTestRecursive(i,t=0){for(let r=0;r<i.children.length;r++){const o=i.children[r];o instanceof ne&&this.disableDepthTestRecursive(o,t+1)}i.renderOrder=10*t,i.layers.set(2);const n=i.material;n&&(n.depthWrite=!1,n.depthTest=!1,n.transparent=!0),t===0&&qt.update()}getRoot(){if(this.root)return this.root;const i=this.defaultFontSize,t={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:i,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new qt.Block(t),this.root}}let Gs=null;function wz(){Gs||(Gs=new _z),Gs.onEnable();for(const s in tg){tg[s]=console[s];let i=!1;console[s]=function(){var t;if((t=tg[s])==null||t.apply(console,arguments),!i)try{i=!0,YM(s,...arguments)}finally{i=!1}}}}function xz(){Gs==null||Gs.onDisable();for(const s in tg)console[s]=tg[s]}const cp=new Map;function YM(s,...i){try{switch(cp.clear(),s){case"log":Gs==null||Gs.addLog("log",t());break;case"warn":Gs==null||Gs.addLog("warn",t());break;case"error":Gs==null||Gs.addLog("error",t());break}}catch(o){console.error("Error in spatial console",o)}finally{cp.clear()}function t(){let o="";for(let a=0;a<i.length;a++){const l=i[a];o+=n(l),a<i.length-1&&(o+=", ")}return o}function n(o,a=0){if(typeof o=="string")return'"'+o+'"';if(typeof o=="number"){if(o%1!==0){const c=o.toFixed(5),u=c.indexOf(".");let d=c.length-1;for(;d>u&&c[d]==="0";)d--;return c.substring(0,d+1)}return o.toString()}else if(Array.isArray(o)){let l="[";for(let c=0;c<o.length;c++){const u=o[c];l+=n(u,a+1),c<o.length-1&&(l+=", ")}return l+="]",l}else{if(o===null)return"null";if(o===void 0)return"undefined";if(typeof o=="function")return o.name+"()"}if(o instanceof ae)return`(${n(o.x)}, ${n(o.y)})`;if(o instanceof x)return`(${n(o.x)}, ${n(o.y)}, ${n(o.z)})`;if(o instanceof Ue)return`(${n(o.x)}, ${n(o.y)}, ${n(o.z)}, ${n(o.w)})`;if(o instanceof se)return`(${n(o.x)}, ${n(o.y)}, ${n(o.z)}, ${n(o.w)})`;if(o instanceof mt||o instanceof At)return o.name;if(o instanceof za)return`[${o.elements.join(", ")}]`;if(o instanceof le)return`[${o.elements.join(", ")}]`;if(o instanceof mo)return o.mask.toString();if(typeof o=="object"){if(cp.has(o))return"*";let l=`{
`;l+=r(a);const c=Object.keys(o);let u="";for(let d=0;d<c.length;d++){const f=c[d],p=o[f];if(cp.has(p)){u+="";continue}cp.set(p,!0),u+=f+":"+n(p,a+1),d<c.length-1&&(u+=", "),u.length>=60&&(u+=`
`,u+=r(a),l+=u,u="")}return l+=u,l+=`
}`,l}return o}function r(o){let a="";for(let l=0;l<o;l++)a+=" ";return a}}const Cz=Q("nodevlogs");function bi(s,i=Yi.Log){Qa(i,s)}function Xt(s){bi(s,Yi.Warn)}function dS(s){bi(s,Yi.Error)}let Yw,Qb;function be(){if(Cz)return!1;if(Yw!==void 0)return Yw;if(Qb!==void 0)return Qb;let s=fr();return s||(s=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),Qb=s,s}function lK(s){Yw=s}let kr=null,Rr=null,ja=null,jb=!1,V1=null;const KM="terminal",Up=Q("console"),Sz=Q("noerrors")||Q("noconsole");Up&&JM();if(!Sz&&(Up||fr())){if(fr()&&!Up){const i=new URL(window.location.href);i.searchParams.set("console","1"),console.log('ðŸŒµ Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+i.toString())}const s=uc()||UC()&&be();if((s||Up)&&(_U(),ZM(),$M(!0),s)){const i=document.querySelector("needle-engine");i==null||i.addEventListener("enter-ar",()=>{(Up||kr||zC()>0)&&Q("noerrors")}),i==null||i.addEventListener("exit-ar",()=>{Bz()})}}const Kw=Symbol("consoleParent");function JM(){if(kr!==null){kr.showSwitch();return}$M()}function Ez(){kr!==null&&(kr.hide(),kr.hideSwitch())}function ZM(){V1||(V1=setInterval(Iz,500))}let W1=0;function Iz(){const s=zC(),i=s!==W1;W1=s,i&&Tz()}function Tz(){JM(),ja&&(ja.setAttribute("error","true"),ja.innerText="ðŸ¤¬")}function Rz(){ja&&(ja.removeAttribute("error"),ja.innerText=KM)}function Bz(){Rr&&Rr[Kw]&&Rr[Kw].appendChild(Rr)}function $M(s=!1){if(kr||jb)return;jb=!0;const i=document.createElement("script");i.onload=()=>{jb=!1,ZM(),kr=new VConsole({pluginOrder:["default","needle-console"]});const t=globalThis["needle:codegen_files"];if(t&&t.length>0&&kr.addPlugin(Pz()),Rr=kz(),Rr&&(Rr[Kw]=Rr.parentElement,Rr.style.position="absolute",Rr.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),kr.setSwitchPosition(20,30),ja=Mz(),ja){ja.innerText=KM,ja.addEventListener("click",Rz);const n=document.createElement("style"),r=40;n.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${r}px;
                    height: ${r}px;
                    padding: 0;
                    line-height: ${r}px;
                    font-size: ${r*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,Rr==null||Rr.prepend(n),s===!0&&zC()<=0&&Ez(),console.log("ðŸŒµ Debug console has loaded")}},i.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(i)}function Pz(){const s=new VConsole.VConsolePlugin("needle-console","ðŸŒµ Inspect glTF"),i=()=>document.querySelector("#__vc_plug_"+s._id+" iframe");return s.on("renderTab",function(t){const n=globalThis["needle:codegen_files"];if(!n||n.length===0)return;let r=globalThis["needle:codegen_files"][0];const o=r.indexOf("?");o>-1&&(r=r.substring(0,o));const l=location.protocol+"//"+location.host+location.pathname+"/"+r,c=encodeURIComponent(l);s.fullUrl="https://viewer.needle.tools?inspect&file="+c;var u='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';t(u)}),s.on("show",function(){const t=i();t&&t.src!==s.fullUrl&&(t.src=s.fullUrl)}),s.on("hide",function(){const t=i();t&&(t.src="")}),s.on("addTopBar",function(t){var n=new Array;n.push({name:"Open in new window â†—",onClick:function(r){window.open(s.fullUrl,"_blank"),kr==null||kr.hide()}}),n.push({name:"Reload",onClick:function(r){const o=i();o&&(o.src=s.fullUrl)}}),n.push({name:"Fullscreen",onClick:function(r){const o=i();o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen instanceof Function&&o.webkitRequestFullscreen()}}),t(n)}),s}function Mz(){const s=document.querySelector("#__vconsole .vc-switch");return s||null}function kz(){const s=document.querySelector("#__vconsole");return s||null}const ek=Q("debugdefines");Nf('if(!globalThis[""3.47.7""]) globalThis[""3.47.7""] = "0.0.0";');Nf('if(!globalThis[""Needle Engine for Blender 0.51.3""]) globalThis[""Needle Engine for Blender 0.51.3""] = "unknown";');Nf('if(!globalThis[""Sun Sep 08 2024 19:19:20 GMT-0600 (hora estÃ¡ndar central)""]) globalThis[""Sun Sep 08 2024 19:19:20 GMT-0600 (hora estÃ¡ndar central)""] = "unknown";');Nf('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.47.7";');Nf('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Needle Engine for Blender 0.51.3";');Nf('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Sun Sep 08 2024 19:19:20 GMT-0600 (hora estÃ¡ndar central)";');const Yo="3.47.7",fS="Needle Engine for Blender 0.51.3",tk="Sun Sep 08 2024 19:19:20 GMT-0600 (hora estÃ¡ndar central)";ek&&console.log(`Engine version: ${Yo} (generator: ${fS})
Project built at ${tk}`);const $c="needle_isActiveInHierarchy",xd="builtin_components",vv="needle_editor_guid";function Nf(s){try{(0,eval)(s)}catch(i){ek&&console.error(i)}}const Dz='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Oz=btoa(Dz),Lz="data:image/svg+xml;base64,"+Oz,Fz=Lz,Uz=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(Uz);const Nz='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',zz=btoa(Nz),Qz="data:image/svg+xml;charset=utf-8;base64,"+zz,jz=Qz;/**
 * postprocessing v6.36.1 build Mon Sep 02 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van RÃ¼schen
 * @license Zlib
 */var Gb=1/1e3,Gz=1e3,Hz=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(s){typeof document<"u"&&document.hidden!==void 0&&(s?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=s)}get delta(){return this._delta*Gb}get fixedDelta(){return this._fixedDelta*Gb}set fixedDelta(s){this._fixedDelta=s*Gz}get elapsed(){return this._elapsed*Gb}update(s){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(s!==void 0?s:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(s){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Vz=(()=>{const s=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),i=new Float32Array([0,0,2,0,0,2]),t=new Vt;return t.setAttribute("position",new Je(s,3)),t.setAttribute("uv",new Je(i,2)),t})(),Rn=class Jw{static get fullscreenGeometry(){return Vz}constructor(i="Pass",t=new ws,n=new QL){this.name=i,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(i){if(this.rtt===i){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!i}}set mainScene(i){}set mainCamera(i){}setRenderer(i){this.renderer=i}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(i){let t=this.screen;t!==null?t.material=i:(t=new Z(Jw.fullscreenGeometry,i),t.frustumCulled=!1,this.scene===null&&(this.scene=new ws),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(i){this.fullscreenMaterial=i}getDepthTexture(){return null}setDepthTexture(i,t=Xs){}render(i,t,n,r,o){throw new Error("Render method not implemented!")}setSize(i,t){}initialize(i,t,n){}dispose(){for(const i of Object.keys(this)){const t=this[i];(t instanceof Et||t instanceof mt||t instanceof At||t instanceof Jw)&&this[i].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Wz=class extends Rn{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(s,i,t,n,r){const o=s.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},qz=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Fu="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",ik=class extends et{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ee(null),opacity:new ee(1)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qz,vertexShader:Fu})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}getOpacity(s){return this.uniforms.opacity.value}setOpacity(s){this.uniforms.opacity.value=s}},nk=class extends Rn{constructor(s,i=!0){super("CopyPass"),this.fullscreenMaterial=new ik,this.needsSwap=!1,this.renderTarget=s,s===void 0&&(this.renderTarget=new Et(1,1,{minFilter:Mt,magFilter:Mt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=i}get resize(){return this.autoResize}set resize(s){this.autoResize=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(s){this.autoResize=s}render(s,i,t,n,r){this.fullscreenMaterial.inputBuffer=i.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,i){this.autoResize&&this.renderTarget.setSize(s,i)}initialize(s,i,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==mi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":s!==null&&s.outputColorSpace===He&&(this.renderTarget.texture.colorSpace=He))}},q1=new xe,v0=class extends Rn{constructor(s=!0,i=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=s,this.depth=i,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(s,i,t){this.color=s,this.depth=i,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(s){this.overrideClearColor=s}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(s){this.overrideClearAlpha=s}render(s,i,t,n,r){const o=this.overrideClearColor,a=this.overrideClearAlpha,l=s.getClearAlpha(),c=o!==null,u=a>=0;c?(s.getClearColor(q1),s.setClearColor(o,u?a:l)):u&&s.setClearAlpha(a),s.setRenderTarget(this.renderToScreen?null:i),s.clear(this.color,this.depth,this.stencil),c?s.setClearColor(q1,l):u&&s.setClearAlpha(l)}},Xz=class extends Rn{constructor(s,i){super("MaskPass",s,i),this.needsSwap=!1,this.clearPass=new v0(!1,!1,!0),this.inverse=!1}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get inverted(){return this.inverse}set inverted(s){this.inverse=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(s){this.inverted=s}render(s,i,t,n,r){const o=s.getContext(),a=s.state.buffers,l=this.scene,c=this.camera,u=this.clearPass,d=this.inverted?0:1,f=1-d;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,d,4294967295),a.stencil.setClear(f),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(s,null):(u.render(s,i),u.render(s,t))),this.renderToScreen?(s.setRenderTarget(null),s.render(l,c)):(s.setRenderTarget(i),s.render(l,c),s.setRenderTarget(t),s.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},pS=class{constructor(s=null,{depthBuffer:i=!0,stencilBuffer:t=!1,multisampling:n=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(i,t,r,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new nk,this.depthTexture=null,this.passes=[],this.timer=new Hz,this.autoRenderToScreen=!0,this.setRenderer(s)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(s){const i=this.inputBuffer,t=this.multisampling;t>0&&s>0?(this.inputBuffer.samples=s,this.outputBuffer.samples=s,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==s&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(i.depthBuffer,i.stencilBuffer,i.texture.type,s),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(s){if(this.renderer=s,s!==null){const i=s.getSize(new ae),t=s.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===mi&&s.outputColorSpace===He&&(this.inputBuffer.texture.colorSpace=He,this.outputBuffer.texture.colorSpace=He,this.inputBuffer.dispose(),this.outputBuffer.dispose()),s.autoClear=!1,this.setSize(i.width,i.height);for(const r of this.passes)r.initialize(s,t,n)}}replaceRenderer(s,i=!0){const t=this.renderer,n=t.domElement.parentNode;return this.setRenderer(s),i&&n!==null&&(n.removeChild(t.domElement),n.appendChild(s.domElement)),t}createDepthTexture(){const s=this.depthTexture=new EC;return this.inputBuffer.depthTexture=s,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(s.format=jL,s.type=GL):s.type=vP,s}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const s of this.passes)s.setDepthTexture(null)}}createBuffer(s,i,t,n){const r=this.renderer,o=r===null?new ae:r.getDrawingBufferSize(new ae),a={minFilter:Mt,magFilter:Mt,stencilBuffer:i,depthBuffer:s,type:t},l=new Et(o.width,o.height,a);return n>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=n),t===mi&&r!==null&&r.outputColorSpace===He&&(l.texture.colorSpace=He),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(s){for(const i of this.passes)i.mainScene=s}setMainCamera(s){for(const i of this.passes)i.mainCamera=s}addPass(s,i){const t=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new ae),o=n.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(s.setRenderer(n),s.setSize(r.width,r.height),s.initialize(n,o,a),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),s.renderToScreen&&(this.autoRenderToScreen=!1)),i!==void 0?t.splice(i,0,s):t.push(s),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),s.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(s of t)s.setDepthTexture(l)}else s.setDepthTexture(this.depthTexture)}removePass(s){const i=this.passes,t=i.indexOf(s);if(t!==-1&&i.splice(t,1).length>0){if(this.depthTexture!==null){const o=(l,c)=>l||c.needsDepthTexture;i.reduce(o,!1)||(s.getDepthTexture()===this.depthTexture&&s.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===i.length&&(s.renderToScreen=!1,i.length>0&&(i[i.length-1].renderToScreen=!0))}}removeAllPasses(){const s=this.passes;this.deleteDepthTexture(),s.length>0&&(this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!1),this.passes=[])}render(s){const i=this.renderer,t=this.copyPass;let n=this.inputBuffer,r=this.outputBuffer,o=!1,a,l,c;s===void 0&&(this.timer.update(),s=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(i,n,r,s,o),u.needsSwap&&(o&&(t.renderToScreen=u.renderToScreen,a=i.getContext(),l=i.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),t.render(i,n,r,s,o),l.setFunc(a.EQUAL,1,4294967295)),c=n,n=r,r=c),u instanceof Xz?o=!0:u instanceof Wz&&(o=!1))}setSize(s,i,t){const n=this.renderer,r=n.getSize(new ae);(s===void 0||i===void 0)&&(s=r.width,i=r.height),(r.width!==s||r.height!==i)&&n.setSize(s,i,t);const o=n.getDrawingBufferSize(new ae);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const s of this.passes)s.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Rn.fullscreenGeometry.dispose()}},Ur={NONE:0,DEPTH:1,CONVOLUTION:2},St={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Yz=class{constructor(){this.shaderParts=new Map([[St.FRAGMENT_HEAD,null],[St.FRAGMENT_MAIN_UV,null],[St.FRAGMENT_MAIN_IMAGE,null],[St.VERTEX_HEAD,null],[St.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ur.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=zi}},Hb=!1,X1=class{constructor(s=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(s),this.meshCount=0,this.replaceMaterial=i=>{if(i.isMesh){let t;if(i.material.flatShading)switch(i.material.side){case _i:t=this.materialsFlatShadedDoubleSide;break;case Wc:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(i.material.side){case _i:t=this.materialsDoubleSide;break;case Wc:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(i,i.material),i.isSkinnedMesh?i.material=t[2]:i.isInstancedMesh?i.material=t[1]:i.material=t[0],++this.meshCount}}}cloneMaterial(s){if(!(s instanceof et))return s.clone();const i=s.uniforms,t=new Map;for(const r in i){const o=i[r].value;o.isRenderTargetTexture&&(i[r].value=null,t.set(r,o))}const n=s.clone();for(const r of t)i[r[0]].value=r[1],n.uniforms[r[0]].value=r[1];return n}setMaterial(s){if(this.disposeMaterials(),this.material=s,s!==null){const i=this.materials=[this.cloneMaterial(s),this.cloneMaterial(s),this.cloneMaterial(s)];for(const t of i)t.uniforms=Object.assign({},s.uniforms),t.side=il;i[2].skinning=!0,this.materialsBackSide=i.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},s.uniforms),n.side=Wc,n}),this.materialsDoubleSide=i.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},s.uniforms),n.side=_i,n}),this.materialsFlatShaded=i.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},s.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=i.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},s.uniforms),n.flatShading=!0,n.side=Wc,n}),this.materialsFlatShadedDoubleSide=i.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},s.uniforms),n.flatShading=!0,n.side=_i,n})}}render(s,i,t){const n=s.shadowMap.enabled;if(s.shadowMap.enabled=!1,Hb){const r=this.originalMaterials;this.meshCount=0,i.traverse(this.replaceMaterial),s.render(i,t);for(const o of r)o[0].material=o[1];this.meshCount!==r.size&&r.clear()}else{const r=i.overrideMaterial;i.overrideMaterial=this.material,s.render(i,t),i.overrideMaterial=r}s.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const s=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const i of s)i.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Hb}static set workaroundEnabled(s){Hb=s}},wc=-1,Dt=class extends cc{constructor(s,i=wc,t=wc,n=1){super(),this.resizable=s,this.baseSize=new ae(1,1),this.preferredSize=new ae(i,t),this.target=this.preferredSize,this.s=n,this.effectiveSize=new ae,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const s=this.baseSize,i=this.preferredSize,t=this.effectiveSize,n=this.scale;i.width!==wc?t.width=i.width:i.height!==wc?t.width=Math.round(i.height*(s.width/Math.max(s.height,1))):t.width=Math.round(s.width*n),i.height!==wc?t.height=i.height:i.width!==wc?t.height=Math.round(i.width/Math.max(s.width/Math.max(s.height,1),1)):t.height=Math.round(s.height*n)}get width(){return this.effectiveSize.width}set width(s){this.preferredWidth=s}get height(){return this.effectiveSize.height}set height(s){this.preferredHeight=s}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(s){this.s!==s&&(this.s=s,this.preferredSize.setScalar(wc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(s){this.scale=s}get baseWidth(){return this.baseSize.width}set baseWidth(s){this.baseSize.width!==s&&(this.baseSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(s){this.baseWidth=s}get baseHeight(){return this.baseSize.height}set baseHeight(s){this.baseSize.height!==s&&(this.baseSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(s){this.baseHeight=s}setBaseSize(s,i){(this.baseSize.width!==s||this.baseSize.height!==i)&&(this.baseSize.set(s,i),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(s){this.preferredSize.width!==s&&(this.preferredSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(s){this.preferredWidth=s}get preferredHeight(){return this.preferredSize.height}set preferredHeight(s){this.preferredSize.height!==s&&(this.preferredSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(s){this.preferredHeight=s}setPreferredSize(s,i){(this.preferredSize.width!==s||this.preferredSize.height!==i)&&(this.preferredSize.set(s,i),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(s){this.s=s.scale,this.baseSize.set(s.baseWidth,s.baseHeight),this.preferredSize.set(s.preferredWidth,s.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return wc}},Kz=class{constructor(s=0){this.nextId=s}getNextId(){return this.nextId++}reset(s=0){return this.nextId=s,this}},Vb=new Kz(2),Jz=class extends Set{constructor(s,i=Vb.getNextId()){super(),this.exclusive=!1,this._layer=i,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),Vb.reset(2),this._layer=Vb.getNextId()),s!==void 0&&this.set(s)}get layer(){return this._layer}set layer(s){const i=this._layer;for(const t of this)t.layers.disable(i),t.layers.enable(s);this._layer=s}getLayer(){return this.layer}setLayer(s){this.layer=s}isExclusive(){return this.exclusive}setExclusive(s){this.exclusive=s}clear(){const s=this.layer;for(const i of this)i.layers.disable(s);return super.clear()}set(s){this.clear();for(const i of s)this.add(i);return this}indexOf(s){return this.has(s)?0:-1}add(s){return this.exclusive?s.layers.set(this.layer):s.layers.enable(this.layer),super.add(s)}delete(s){return this.has(s)&&s.layers.disable(this.layer),super.delete(s)}toggle(s){let i;return this.has(s)?(this.delete(s),i=!1):(this.add(s),i=!0),i}setVisible(s){for(const i of this)s?i.layers.enable(0):i.layers.disable(0);return this}},Ze={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Zz="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",$z="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",eQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",tQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",iQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",nQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",sQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",rQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",oQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",aQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",lQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",cQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",hQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",uQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",dQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",fQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",pQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",gQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",mQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",AQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",vQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",yQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",bQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",_Q="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",wQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",xQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",CQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",SQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",EQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",IQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",TQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",RQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",BQ=new Map([[Ze.ADD,Zz],[Ze.ALPHA,$z],[Ze.AVERAGE,eQ],[Ze.COLOR,tQ],[Ze.COLOR_BURN,iQ],[Ze.COLOR_DODGE,nQ],[Ze.DARKEN,sQ],[Ze.DIFFERENCE,rQ],[Ze.DIVIDE,oQ],[Ze.DST,null],[Ze.EXCLUSION,aQ],[Ze.HARD_LIGHT,lQ],[Ze.HARD_MIX,cQ],[Ze.HUE,hQ],[Ze.INVERT,uQ],[Ze.INVERT_RGB,dQ],[Ze.LIGHTEN,fQ],[Ze.LINEAR_BURN,pQ],[Ze.LINEAR_DODGE,gQ],[Ze.LINEAR_LIGHT,mQ],[Ze.LUMINOSITY,AQ],[Ze.MULTIPLY,vQ],[Ze.NEGATION,yQ],[Ze.NORMAL,bQ],[Ze.OVERLAY,_Q],[Ze.PIN_LIGHT,wQ],[Ze.REFLECT,xQ],[Ze.SATURATION,CQ],[Ze.SCREEN,SQ],[Ze.SOFT_LIGHT,EQ],[Ze.SRC,IQ],[Ze.SUBTRACT,TQ],[Ze.VIVID_LIGHT,RQ]]),PQ=class extends cc{constructor(s,i=1){super(),this._blendFunction=s,this.opacity=new ee(i)}getOpacity(){return this.opacity.value}setOpacity(s){this.opacity.value=s}get blendFunction(){return this._blendFunction}set blendFunction(s){this._blendFunction=s,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(s){this.blendFunction=s}getShaderCode(){return BQ.get(this.blendFunction)}},Ka={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},MQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,kQ="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",DQ=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],sk=class extends et{constructor(s=new Ue){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ee(null),texelSize:new ee(new Ue),scale:new ee(1),kernel:new ee(0)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:MQ,vertexShader:kQ}),this.setTexelSize(s.x,s.y),this.kernelSize=Ka.MEDIUM}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.inputBuffer=s}get kernelSequence(){return DQ[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(){return this.uniforms.scale.value}setScale(s){this.uniforms.scale.value=s}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(s){this.uniforms.kernel.value=s}setKernel(s){this.kernel=s}setTexelSize(s,i){this.uniforms.texelSize.value.set(s,i,s*.5,i*.5)}setSize(s,i){const t=1/s,n=1/i;this.uniforms.texelSize.value.set(t,n,t*.5,n*.5)}},gS=class extends Rn{constructor({kernelSize:s=Ka.MEDIUM,resolutionScale:i=.5,width:t=Dt.AUTO_SIZE,height:n=Dt.AUTO_SIZE,resolutionX:r=t,resolutionY:o=n}={}){super("KawaseBlurPass"),this.renderTargetA=new Et(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new Dt(this,r,o,i);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new sk,this._blurMaterial.kernelSize=s,this.copyMaterial=new ik}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(s){this._blurMaterial=s}get dithering(){return this.copyMaterial.dithering}set dithering(s){this.copyMaterial.dithering=s}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(s){this.blurMaterial.kernelSize=s}get width(){return this.resolution.width}set width(s){this.resolution.preferredWidth=s}get height(){return this.resolution.height}set height(s){this.resolution.preferredHeight=s}get scale(){return this.blurMaterial.scale}set scale(s){this.blurMaterial.scale=s}getScale(){return this.blurMaterial.scale}setScale(s){this.blurMaterial.scale=s}getKernelSize(){return this.kernelSize}setKernelSize(s){this.kernelSize=s}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,i,t,n,r){const o=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,u=this.blurMaterial,d=u.kernelSequence;let f=i;this.fullscreenMaterial=u;for(let p=0,g=d.length;p<g;++p){const m=p&1?c:l;u.kernel=d[p],u.inputBuffer=f.texture,s.setRenderTarget(m),s.render(o,a),f=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=f.texture,s.setRenderTarget(this.renderToScreen?null:t),s.render(o,a)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i);const n=t.width,r=t.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(s,i)}initialize(s,i,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==mi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):s!==null&&s.outputColorSpace===He&&(this.renderTargetA.texture.colorSpace=He,this.renderTargetB.texture.colorSpace=He))}static get AUTO_SIZE(){return Dt.AUTO_SIZE}},OQ=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,LQ=class extends et{constructor(s=!1,i=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:TC.replace(/\D+/g,"")},uniforms:{inputBuffer:new ee(null),threshold:new ee(0),smoothing:new ee(1),range:new ee(null)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:OQ,vertexShader:Fu}),this.colorOutput=s,this.luminanceRange=i}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get threshold(){return this.uniforms.threshold.value}set threshold(s){this.smoothing>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=s}getThreshold(){return this.threshold}setThreshold(s){this.threshold=s}get smoothing(){return this.uniforms.smoothing.value}set smoothing(s){this.threshold>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=s}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(s){this.smoothing=s}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(s){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(s){s?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(s){return this.colorOutput}setColorOutputEnabled(s){this.colorOutput=s}get useRange(){return this.luminanceRange!==null}set useRange(s){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(s){s!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=s,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(s){this.luminanceRange=s}},rk=class extends Rn{constructor({renderTarget:s,luminanceRange:i,colorOutput:t,resolutionScale:n=1,width:r=Dt.AUTO_SIZE,height:o=Dt.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("LuminancePass"),this.fullscreenMaterial=new LQ(t,i),this.needsSwap=!1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Dt(this,a,l,n);c.addEventListener("change",u=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(s,i,t,n,r){const o=this.fullscreenMaterial;o.inputBuffer=i.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i),this.renderTarget.setSize(t.width,t.height)}initialize(s,i,t){t!==void 0&&t!==mi&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},FQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,UQ="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",NQ=class extends et{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new ee(null),texelSize:new ee(new ae)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:FQ,vertexShader:UQ})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setSize(s,i){this.uniforms.texelSize.value.set(1/s,1/i)}},zQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,QQ="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",jQ=class extends et{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new ee(null),supportBuffer:new ee(null),texelSize:new ee(new ae),radius:new ee(.85)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zQ,vertexShader:QQ})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}set supportBuffer(s){this.uniforms.supportBuffer.value=s}get radius(){return this.uniforms.radius.value}set radius(s){this.uniforms.radius.value=s}setSize(s,i){this.uniforms.texelSize.value.set(1/s,1/i)}},GQ=class extends Rn{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new NQ,this.upsamplingMaterial=new jQ,this.resolution=new ae}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(s){if(this.levels!==s){const i=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<s;++t){const n=i.clone();n.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(n)}this.upsamplingMipmaps.push(i);for(let t=1,n=s-1;t<n;++t){const r=i.clone();r.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(s){this.upsamplingMaterial.radius=s}render(s,i,t,n,r){const{scene:o,camera:a}=this,{downsamplingMaterial:l,upsamplingMaterial:c}=this,{downsamplingMipmaps:u,upsamplingMipmaps:d}=this;let f=i;this.fullscreenMaterial=l;for(let p=0,g=u.length;p<g;++p){const m=u[p];l.setSize(f.width,f.height),l.inputBuffer=f.texture,s.setRenderTarget(m),s.render(o,a),f=m}this.fullscreenMaterial=c;for(let p=d.length-1;p>=0;--p){const g=d[p];c.setSize(f.width,f.height),c.inputBuffer=f.texture,c.supportBuffer=u[p].texture,s.setRenderTarget(g),s.render(o,a),f=g}}setSize(s,i){const t=this.resolution;t.set(s,i);let n=t.width,r=t.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)n=Math.round(n*.5),r=Math.round(r*.5),this.downsamplingMipmaps[o].setSize(n,r),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(n,r)}initialize(s,i,t){if(t!==void 0){const n=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of n)r.texture.type=t;if(t!==mi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(s!==null&&s.outputColorSpace===He)for(const r of n)r.texture.colorSpace=He}}dispose(){super.dispose();for(const s of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))s.dispose()}},Ys=class extends cc{constructor(s,i,{attributes:t=Ur.NONE,blendFunction:n=Ze.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=s,this.renderer=null,this.attributes=t,this.fragmentShader=i,this.vertexShader=l,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new PQ(n),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=zi,this._outputColorSpace=xu}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(s){this._inputColorSpace=s,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(s){this._outputColorSpace=s,this.setChanged()}set mainScene(s){}set mainCamera(s){}getName(){return this.name}setRenderer(s){this.renderer=s}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(s){this.attributes=s,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(s){this.fragmentShader=s,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(s){this.vertexShader=s,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(s,i=Xs){}update(s,i,t){}setSize(s,i){}initialize(s,i,t){}dispose(){for(const s of Object.keys(this)){const i=this[s];(i instanceof Et||i instanceof mt||i instanceof At||i instanceof Rn)&&this[s].dispose()}}},HQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,mS=class extends Ys{constructor({blendFunction:i=Ze.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:n=.025,mipmapBlur:r=!1,intensity:o=1,radius:a=.85,levels:l=8,kernelSize:c=Ka.LARGE,resolutionScale:u=.5,width:d=Dt.AUTO_SIZE,height:f=Dt.AUTO_SIZE,resolutionX:p=d,resolutionY:g=f}={}){super("BloomEffect",HQ,{blendFunction:i,uniforms:new Map([["map",new ee(null)],["intensity",new ee(o)]])}),this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new gS({kernelSize:c}),this.luminancePass=new rk({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new GQ,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=a,this.mipmapBlurPass.levels=l,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new Dt(this,p,g,u);m.addEventListener("change",A=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(i){this.resolution.preferredWidth=i}get height(){return this.resolution.height}set height(i){this.resolution.preferredHeight=i}get dithering(){return this.blurPass.dithering}set dithering(i){this.blurPass.dithering=i}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(i){this.blurPass.kernelSize=i}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(i){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(i){this.uniforms.get("intensity").value=i}getIntensity(){return this.intensity}setIntensity(i){this.intensity=i}getResolutionScale(){return this.resolution.scale}setResolutionScale(i){this.resolution.scale=i}update(i,t,n){const r=this.renderTarget,o=this.luminancePass;o.enabled?(o.render(i,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(i,o.renderTarget):this.blurPass.render(i,o.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(i,t):this.blurPass.render(i,t,r)}setSize(i,t){const n=this.resolution;n.setBaseSize(i,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(i,t),this.mipmapBlurPass.setSize(i,t)}initialize(i,t,n){this.blurPass.initialize(i,t,n),this.luminancePass.initialize(i,t,n),this.mipmapBlurPass.initialize(i,t,n),n!==void 0&&(this.renderTarget.texture.type=n,i!==null&&i.outputColorSpace===He&&(this.renderTarget.texture.colorSpace=He))}},VQ="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",ok=class extends Ys{constructor({blendFunction:s=Ze.SRC,brightness:i=0,contrast:t=0}={}){super("BrightnessContrastEffect",VQ,{blendFunction:s,uniforms:new Map([["brightness",new ee(i)],["contrast",new ee(t)]])}),this.inputColorSpace=He}get brightness(){return this.uniforms.get("brightness").value}set brightness(s){this.uniforms.get("brightness").value=s}getBrightness(){return this.brightness}setBrightness(s){this.brightness=s}get contrast(){return this.uniforms.get("contrast").value}set contrast(s){this.uniforms.get("contrast").value=s}getContrast(){return this.contrast}setContrast(s){this.contrast=s}},WQ=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,qQ="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",ak=class extends Ys{constructor({offset:s=new ae(.001,5e-4),radialModulation:i=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",WQ,{vertexShader:qQ,attributes:Ur.CONVOLUTION,uniforms:new Map([["offset",new ee(s)],["modulationOffset",new ee(t)]])}),this.radialModulation=i}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(s){s?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(s){this.uniforms.get("modulationOffset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}},lk={RED:0,GREEN:1,BLUE:2,ALPHA:3},ck={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},XQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,pA=class extends et{constructor(s=!1,i=!1){super({name:"BokehMaterial",defines:{PASS:s?"2":"1"},uniforms:{inputBuffer:new ee(null),cocBuffer:new ee(null),texelSize:new ee(new ae),kernel64:new ee(null),kernel16:new ee(null),scale:new ee(1)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:XQ,vertexShader:Fu}),i&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set cocBuffer(s){this.uniforms.cocBuffer.value=s}setCoCBuffer(s){this.uniforms.cocBuffer.value=s}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(s){return this.scale}setScale(s){this.scale=s}generateKernel(){const s=2.39996323,i=new Float64Array(128),t=new Float64Array(32);let n=0,r=0;for(let o=0,a=Math.sqrt(80);o<80;++o){const l=o*s,c=Math.sqrt(o)/a,u=c*Math.cos(l),d=c*Math.sin(l);o%5===0?(t[r++]=u,t[r++]=d):(i[n++]=u,i[n++]=d)}this.uniforms.kernel64.value=i,this.uniforms.kernel16.value=t}setTexelSize(s,i){this.uniforms.texelSize.value.set(s,i)}setSize(s,i){this.uniforms.texelSize.value.set(1/s,1/i)}};function Dd(s,i,t){return s*(i-t)-i}function iu(s,i,t){return Math.min(Math.max((s+i)/(i-t),0),1)}var YQ=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,KQ=class extends et{constructor(s){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ee(null),focusDistance:new ee(0),focusRange:new ee(0),cameraNear:new ee(.3),cameraFar:new ee(1e3)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:YQ,vertexShader:Fu}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(s)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,i=Xs){this.depthBuffer=s,this.depthPacking=i}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(s){this.uniforms.focusDistance.value=s}get worldFocusDistance(){return-Dd(this.focusDistance,this.near,this.far)}set worldFocusDistance(s){this.focusDistance=iu(-s,this.near,this.far)}getFocusDistance(s){this.uniforms.focusDistance.value=s}setFocusDistance(s){this.uniforms.focusDistance.value=s}get focalLength(){return this.focusRange}set focalLength(s){this.focusRange=s}get focusRange(){return this.uniforms.focusRange.value}set focusRange(s){this.uniforms.focusRange.value=s}get worldFocusRange(){return-Dd(this.focusRange,this.near,this.far)}set worldFocusRange(s){this.focusRange=iu(-s,this.near,this.far)}getFocalLength(s){return this.focusRange}setFocalLength(s){this.focusRange=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},JQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,ZQ=class extends et{constructor(s=null){super({name:"MaskMaterial",uniforms:{maskTexture:new ee(s),inputBuffer:new ee(null),strength:new ee(1)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:JQ,vertexShader:Fu}),this.colorChannel=lk.RED,this.maskFunction=ck.DISCARD}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set maskTexture(s){this.uniforms.maskTexture.value=s,delete this.defines.MASK_PRECISION_HIGH,s.type!==mi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(s){this.maskTexture=s}set colorChannel(s){this.defines.COLOR_CHANNEL=s.toFixed(0),this.needsUpdate=!0}setColorChannel(s){this.colorChannel=s}set maskFunction(s){this.defines.MASK_FUNCTION=s.toFixed(0),this.needsUpdate=!0}setMaskFunction(s){this.maskFunction=s}get inverted(){return this.defines.INVERTED!==void 0}set inverted(s){this.inverted&&!s?delete this.defines.INVERTED:s&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get strength(){return this.uniforms.strength.value}set strength(s){this.uniforms.strength.value=s}getStrength(){return this.strength}setStrength(s){this.strength=s}},Ra=class extends Rn{constructor(s,i="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=s,this.input=i}setInput(s){this.input=s}render(s,i,t,n,r){const o=this.fullscreenMaterial.uniforms;i!==null&&o!==void 0&&o[this.input]!==void 0&&(o[this.input].value=i.texture),s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}initialize(s,i,t){t!==void 0&&t!==mi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$Q=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,hk=class extends Ys{constructor(s,{blendFunction:i,worldFocusDistance:t,worldFocusRange:n,focusDistance:r=0,focalLength:o=.1,focusRange:a=o,bokehScale:l=1,resolutionScale:c=1,width:u=Dt.AUTO_SIZE,height:d=Dt.AUTO_SIZE,resolutionX:f=u,resolutionY:p=d}={}){super("DepthOfFieldEffect",$Q,{blendFunction:i,attributes:Ur.DEPTH,uniforms:new Map([["nearColorBuffer",new ee(null)],["farColorBuffer",new ee(null)],["nearCoCBuffer",new ee(null)],["farCoCBuffer",new ee(null)],["scale",new ee(1)]])}),this.camera=s,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Ra(new KQ(s));const g=this.cocMaterial;g.focusDistance=r,g.focusRange=a,t!==void 0&&(g.worldFocusDistance=t),n!==void 0&&(g.worldFocusRange=n),this.blurPass=new gS({resolutionScale:c,resolutionX:f,resolutionY:p,kernelSize:Ka.MEDIUM}),this.maskPass=new Ra(new ZQ(this.renderTargetCoC.texture));const m=this.maskPass.fullscreenMaterial;m.colorChannel=lk.GREEN,this.maskFunction=ck.MULTIPLY_RGB,this.bokehNearBasePass=new Ra(new pA(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Ra(new pA(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Ra(new pA(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Ra(new pA(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const A=this.resolution=new Dt(this,f,p,c);A.addEventListener("change",y=>this.setSize(A.baseWidth,A.baseHeight)),this.bokehScale=l}set mainCamera(s){this.camera=s,this.cocMaterial.copyCameraSettings(s)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(s){this.maskFunction!==s&&(this.defines.set("MASK_FUNCTION",s.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=s,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(s){this.bokehNearBasePass.fullscreenMaterial.scale=s,this.bokehNearFillPass.fullscreenMaterial.scale=s,this.bokehFarBasePass.fullscreenMaterial.scale=s,this.bokehFarFillPass.fullscreenMaterial.scale=s,this.maskPass.fullscreenMaterial.strength=s,this.uniforms.get("scale").value=s}getBokehScale(){return this.bokehScale}setBokehScale(s){this.bokehScale=s}getTarget(){return this.target}setTarget(s){this.target=s}calculateFocusDistance(s){const i=this.camera,t=i.position.distanceTo(s);return iu(-t,i.near,i.far)}setDepthTexture(s,i=Xs){this.cocMaterial.depthBuffer=s,this.cocMaterial.depthPacking=i}update(s,i,t){const n=this.renderTarget,r=this.renderTargetCoC,o=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){const l=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=l}this.cocPass.render(s,null,r),this.blurPass.render(s,r,o),this.maskPass.render(s,i,a),this.bokehFarBasePass.render(s,a,n),this.bokehFarFillPass.render(s,n,this.renderTargetFar),this.bokehNearBasePass.render(s,i,n),this.bokehNearFillPass.render(s,n,this.renderTargetNear)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i);const n=t.width,r=t.height;this.cocPass.setSize(s,i),this.blurPass.setSize(s,i),this.maskPass.setSize(s,i),this.renderTargetFar.setSize(s,i),this.renderTargetCoC.setSize(s,i),this.renderTargetMasked.setSize(s,i),this.renderTarget.setSize(n,r),this.renderTargetNear.setSize(n,r),this.renderTargetCoCBlurred.setSize(n,r),this.bokehNearBasePass.fullscreenMaterial.setSize(s,i),this.bokehNearFillPass.fullscreenMaterial.setSize(s,i),this.bokehFarBasePass.fullscreenMaterial.setSize(s,i),this.bokehFarFillPass.fullscreenMaterial.setSize(s,i)}initialize(s,i,t){this.cocPass.initialize(s,i,t),this.maskPass.initialize(s,i,t),this.bokehNearBasePass.initialize(s,i,t),this.bokehNearFillPass.initialize(s,i,t),this.bokehFarBasePass.initialize(s,i,t),this.bokehFarFillPass.initialize(s,i,t),this.blurPass.initialize(s,i,mi),s.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===He&&(this.renderTarget.texture.colorSpace=He,this.renderTargetNear.texture.colorSpace=He,this.renderTargetFar.texture.colorSpace=He,this.renderTargetMasked.texture.colorSpace=He))}};function ej(s,i,t){const n=new Map([[_P,1],[qc,1],[Md,2],[qi,4]]);let r;if(n.has(i)||console.error("Invalid noise texture format"),t===mi){r=new Uint8Array(s*n.get(i));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()*255+.5}else{r=new Float32Array(s*n.get(i));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()}return r}var tj=class extends Uf{constructor(s,i,t=_P,n=mi){super(ej(s*i,t,n),s,i,t,n),this.needsUpdate=!0}},ig={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},ij=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,nj=class extends et{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:ig.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new ee(null),depthBuffer0:new ee(null),depthBuffer1:new ee(null),cameraNearFar:new ee(new ae(1,1))},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ij,vertexShader:Fu}),this.depthMode=Dw}set depthBuffer0(s){this.uniforms.depthBuffer0.value=s}set depthPacking0(s){this.defines.DEPTH_PACKING_0=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(s,i=Xs){this.depthBuffer0=s,this.depthPacking0=i}set depthBuffer1(s){this.uniforms.depthBuffer1.value=s}set depthPacking1(s){this.defines.DEPTH_PACKING_1=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(s,i=Xs){this.depthBuffer1=s,this.depthPacking1=i}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(s){this.defines.DEPTH_TEST_STRATEGY=s.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(s){this.maxDepthStrategy=s?ig.KEEP_MAX_DEPTH:ig.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(s){this.maxDepthStrategy=s}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(s){this.defines.DEPTH_EPSILON=s.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(s){this.epsilon=s}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(s){let i;switch(s){case VL:i="false";break;case EP:i="true";break;case Qv:i="abs(d1 - d0) <= DEPTH_EPSILON";break;case IC:i="abs(d1 - d0) > DEPTH_EPSILON";break;case Dw:i="d0 > d1";break;case SP:i="d0 >= d1";break;case CP:i="d0 <= d1";break;case xP:default:i="d0 < d1";break}this.defines.DEPTH_MODE=s.toFixed(0),this.defines["depthTest(d0, d1)"]=i,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(s){this.depthMode=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),s instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},y0=class extends Rn{constructor(s,i,t=null){super("RenderPass",s,i),this.needsSwap=!1,this.clearPass=new v0,this.overrideMaterialManager=t===null?null:new X1(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get renderToScreen(){return super.renderToScreen}set renderToScreen(s){super.renderToScreen=s,this.clearPass.renderToScreen=s}get overrideMaterial(){const s=this.overrideMaterialManager;return s!==null?s.material:null}set overrideMaterial(s){const i=this.overrideMaterialManager;s!==null?i!==null?i.setMaterial(s):this.overrideMaterialManager=new X1(s):i!==null&&(i.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(s){this.overrideMaterial=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getSelection(){return this.selection}setSelection(s){this.selection=s}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(s){this.skipShadowMapUpdate=s}getClearPass(){return this.clearPass}render(s,i,t,n,r){const o=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,u=o.background,d=s.shadowMap.autoUpdate,f=this.renderToScreen?null:i;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(s.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(s,i),s.setRenderTarget(f),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(s,o,a):s.render(o,a),a.layers.mask=c,o.background=u,s.shadowMap.autoUpdate=d}},sj="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",uk=class extends Ys{constructor({blendFunction:s=Ze.SRC,hue:i=0,saturation:t=0}={}){super("HueSaturationEffect",sj,{blendFunction:s,uniforms:new Map([["hue",new ee(new x)],["saturation",new ee(t)]])}),this.hue=i}get saturation(){return this.uniforms.get("saturation").value}set saturation(s){this.uniforms.get("saturation").value=s}getSaturation(){return this.saturation}setSaturation(s){this.saturation=s}get hue(){const s=this.uniforms.get("hue").value;return Math.acos((s.x*3-1)/2)}set hue(s){const i=Math.sin(s),t=Math.cos(s);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*i-t+1)/3,(Math.sqrt(3)*i-t+1)/3)}getHue(){return this.hue}setHue(s){this.hue=s}},AS={DEPTH:0,LUMA:1,COLOR:2},rj={DISABLED:0,DEPTH:1,CUSTOM:2},qh={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},vn={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},hp={DEFAULT:0,ESKIL:1},oj=class extends Rn{constructor(s,i,{renderTarget:t,resolutionScale:n=1,width:r=Dt.AUTO_SIZE,height:o=Dt.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new y0(s,i,new wP({depthPacking:yP}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const u=c.clearPass;u.overrideClearColor=new xe(16777215),u.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{minFilter:Zt,magFilter:Zt}),this.renderTarget.texture.name="DepthPass.Target");const d=this.resolution=new Dt(this,a,l,n);d.addEventListener("change",f=>this.setSize(d.baseWidth,d.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,i,t,n,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,o)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i),this.renderTarget.setSize(t.width,t.height)}},aj="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",dk=class extends Ys{constructor(i=30){super("PixelationEffect",aj,{uniforms:new Map([["active",new ee(!1)],["d",new ee(new Ue)]])}),this.resolution=new ae,this._granularity=0,this.granularity=i}get granularity(){return this._granularity}set granularity(i){let t=Math.floor(i);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(i){this.granularity=i}setSize(i,t){const n=this.resolution;n.set(i,t);const r=this.granularity,o=r/n.x,a=r/n.y;this.uniforms.get("d").value.set(o,a,1/o,1/a)}},fk=class extends mS{constructor(s,i,t){super(t),this.setAttributes(this.getAttributes()|Ur.DEPTH),this.camera=i,this.depthPass=new oj(s,i),this.clearPass=new v0(!0,!1,!1),this.clearPass.overrideClearColor=new xe(0),this.depthMaskPass=new Ra(new nj);const n=this.depthMaskMaterial;n.copyCameraSettings(i),n.depthBuffer1=this.depthPass.texture,n.depthPacking1=yP,n.depthMode=Qv,this.renderTargetMasked=new Et(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Jz,this._inverted=!1,this._ignoreBackground=!1}set mainScene(s){this.depthPass.mainScene=s}set mainCamera(s){this.camera=s,this.depthPass.mainCamera=s,this.depthMaskMaterial.copyCameraSettings(s)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(s){this._inverted=s,this.depthMaskMaterial.depthMode=s?IC:Qv}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(s){this._ignoreBackground=s,this.depthMaskMaterial.maxDepthStrategy=s?ig.DISCARD_MAX_DEPTH:ig.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}setDepthTexture(s,i=Xs){this.depthMaskMaterial.depthBuffer0=s,this.depthMaskMaterial.depthPacking0=i}update(s,i,t){const n=this.camera,r=this.selection,o=this.inverted;let a=i;if(this.ignoreBackground||!o||r.size>0){const l=n.layers.mask;n.layers.set(r.layer),this.depthPass.render(s),n.layers.mask=l,a=this.renderTargetMasked,this.clearPass.render(s,a),this.depthMaskPass.render(s,i,a)}super.update(s,a,t)}setSize(s,i){super.setSize(s,i),this.renderTargetMasked.setSize(s,i),this.depthPass.setSize(s,i)}initialize(s,i,t){super.initialize(s,i,t),this.clearPass.initialize(s,i,t),this.depthPass.initialize(s,i,t),this.depthMaskPass.initialize(s,i,t),s!==null&&s.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===He&&(this.renderTargetMasked.texture.colorSpace=He))}},lj=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,cj=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,hj=class extends et{constructor(s=new ae,i=AS.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:TC.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new ee(null),depthBuffer:new ee(null),predicationBuffer:new ee(null),texelSize:new ee(s)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:lj,vertexShader:cj}),this.edgeDetectionMode=i}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,i=Xs){this.depthBuffer=s,this.depthPacking=i}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(s){this.defines.EDGE_DETECTION_MODE=s.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(s){this.edgeDetectionMode=s}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(s){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=s.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(s){this.localContrastAdaptationFactor=s}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(s){this.defines.EDGE_THRESHOLD=s.toFixed("6"),this.defines.DEPTH_THRESHOLD=(s*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(s){this.edgeDetectionThreshold=s}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(s){this.defines.PREDICATION_MODE=s.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(s){this.predicationMode=s}set predicationBuffer(s){this.uniforms.predicationBuffer.value=s}setPredicationBuffer(s){this.uniforms.predicationBuffer.value=s}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(s){this.defines.PREDICATION_THRESHOLD=s.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(s){this.predicationThreshold=s}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(s){this.defines.PREDICATION_SCALE=s.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(s){this.predicationScale=s}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(s){this.defines.PREDICATION_STRENGTH=s.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(s){this.predicationStrength=s}setSize(s,i){this.uniforms.texelSize.value.set(1/s,1/i)}},uj=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,dj="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",fj=class extends et{constructor(s=new ae,i=new ae){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new ee(null),searchTexture:new ee(null),areaTexture:new ee(null),resolution:new ee(i),texelSize:new ee(s)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:uj,vertexShader:dj})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(s){this.uniforms.searchTexture.value=s}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(s){this.uniforms.areaTexture.value=s}setLookupTextures(s,i){this.searchTexture=s,this.areaTexture=i}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(s){const i=Math.min(Math.max(s,0),112);this.defines.MAX_SEARCH_STEPS_INT=i.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=i.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(s){this.orthogonalSearchSteps=s}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(s){const i=Math.min(Math.max(s,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=i.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=i.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(s){this.diagonalSearchSteps=s}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(s){s?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(s){this.diagonalDetection=s}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(s){const i=Math.min(Math.max(s,0),100);this.defines.CORNER_ROUNDING=i.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(i/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(s){this.cornerRounding=s}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(s){s?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(s){this.cornerDetection=s}setSize(s,i){const t=this.uniforms;t.texelSize.value.set(1/s,1/i),t.resolution.value.set(s,i)}},Y1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",K1="data:image/png;base64,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",pj="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",gj="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",pk=class extends Ys{constructor({blendFunction:s=Ze.SRC,preset:i=qh.MEDIUM,edgeDetectionMode:t=AS.COLOR,predicationMode:n=rj.DISABLED}={}){super("SMAAEffect",pj,{vertexShader:gj,blendFunction:s,attributes:Ur.CONVOLUTION|Ur.DEPTH,uniforms:new Map([["weightMap",new ee(null)]])});let r,o;arguments.length>1&&(r=arguments[0],o=arguments[1],arguments.length>2&&(i=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Et(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new v0(!0,!1,!1),this.clearPass.overrideClearColor=new xe(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Ra(new hj),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=n,this.weightsPass=new Ra(new fj);const a=new HL;a.onLoad=()=>{const l=new At(r);l.name="SMAA.Search",l.magFilter=Zt,l.minFilter=Zt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!0,this.weightsMaterial.searchTexture=l;const c=new At(o);c.name="SMAA.Area",c.magFilter=Mt,c.minFilter=Mt,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!1,this.weightsMaterial.areaTexture=c,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),r!==void 0&&o!==void 0?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(r=new Image,o=new Image,r.addEventListener("load",()=>a.itemEnd("search")),o.addEventListener("load",()=>a.itemEnd("area")),r.src=Y1,o.src=K1),this.applyPreset(i)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(s){this.edgeDetectionMaterial.edgeDetectionThreshold=s}setOrthogonalSearchSteps(s){this.weightsMaterial.orthogonalSearchSteps=s}applyPreset(s){const i=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(s){case qh.LOW:i.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case qh.MEDIUM:i.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case qh.HIGH:i.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case qh.ULTRA:i.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(s,i=Xs){this.edgeDetectionMaterial.depthBuffer=s,this.edgeDetectionMaterial.depthPacking=i}update(s,i,t){this.clearPass.render(s,this.renderTargetEdges),this.edgeDetectionPass.render(s,i,this.renderTargetEdges),this.weightsPass.render(s,this.renderTargetEdges,this.renderTargetWeights)}setSize(s,i){this.edgeDetectionMaterial.setSize(s,i),this.weightsMaterial.setSize(s,i),this.renderTargetEdges.setSize(s,i),this.renderTargetWeights.setSize(s,i)}dispose(){const{searchTexture:s,areaTexture:i}=this.weightsMaterial;s!==null&&i!==null&&(s.dispose(),i.dispose()),super.dispose()}static get searchImageDataURL(){return Y1}static get areaImageDataURL(){return K1}},mj=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,Aj="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",vj=class extends et{constructor(s){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ee(null),normalBuffer:new ee(null),normalDepthBuffer:new ee(null),noiseTexture:new ee(null),inverseProjectionMatrix:new ee(new le),projectionMatrix:new ee(new le),texelSize:new ee(new ae),cameraNearFar:new ee(new ae),distanceCutoff:new ee(new ae),proximityCutoff:new ee(new ae),noiseScale:new ee(new ae),minRadiusScale:new ee(.33),intensity:new ee(1),fade:new ee(.01),bias:new ee(0)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:mj,vertexShader:Aj}),this.copyCameraSettings(s),this.resolution=new ae,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(s){this.uniforms.normalDepthBuffer.value=s,s!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(s){this.normalDepthBuffer=s}set normalBuffer(s){this.uniforms.normalBuffer.value=s}setNormalBuffer(s){this.uniforms.normalBuffer.value=s}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,i=Xs){this.depthBuffer=s,this.depthPacking=i}set noiseTexture(s){this.uniforms.noiseTexture.value=s}setNoiseTexture(s){this.uniforms.noiseTexture.value=s}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(s){this.defines.SAMPLES_INT=s.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/s).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(s){this.samples=s}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(s){this.defines.SPIRAL_TURNS=s.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(s){this.rings=s}get intensity(){return this.uniforms.intensity.value}set intensity(s){this.uniforms.intensity.value=s,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(s){this.uniforms.intensity.value=s}get fade(){return this.uniforms.fade.value}set fade(s){this.uniforms.fade.value=s}getFade(){return this.uniforms.fade.value}setFade(s){this.uniforms.fade.value=s}get bias(){return this.uniforms.bias.value}set bias(s){this.uniforms.bias.value=s}getBias(){return this.uniforms.bias.value}setBias(s){this.uniforms.bias.value=s}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(s){this.uniforms.minRadiusScale.value=s}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(s){this.uniforms.minRadiusScale.value=s}updateRadius(){const s=this.r*this.resolution.height;this.defines.RADIUS=s.toFixed(11),this.defines.RADIUS_SQ=(s*s).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(s){this.r=Math.min(Math.max(s,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(s){this.radius=s}get distanceScaling(){return!0}set distanceScaling(s){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(s){this.distanceScaling=s}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(s){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-Dd(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(s){this.distanceThreshold=iu(-s,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(s){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+s,0),1)}get worldDistanceFalloff(){return-Dd(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(s){this.distanceFalloff=iu(-s,this.near,this.far)}setDistanceCutoff(s,i){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+i,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(s){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-Dd(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(s){this.proximityThreshold=iu(-s,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(s){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+s,0),1)}get worldProximityFalloff(){return-Dd(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(s){this.proximityFalloff=iu(-s,this.near,this.far)}setProximityCutoff(s,i){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+i,0),1))}setTexelSize(s,i){this.uniforms.texelSize.value.set(s,i)}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),this.uniforms.projectionMatrix.value.copy(s.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(s.projectionMatrix).invert(),s instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,i){const t=this.uniforms,n=t.noiseTexture.value;n!==null&&t.noiseScale.value.set(s/n.image.width,i/n.image.height),t.texelSize.value.set(1/s,1/i),this.resolution.set(s,i),this.updateRadius()}},yj=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,bj="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",_j=class extends et{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ee(null),normalBuffer:new ee(null),texelSize:new ee(new ae)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yj,vertexShader:bj})}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,i=Xs){this.depthBuffer=s,this.depthPacking=i}set normalBuffer(s){this.uniforms.normalBuffer.value=s,s!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(s){this.normalBuffer=s}setTexelSize(s,i){this.uniforms.texelSize.value.set(s,i)}setSize(s,i){this.uniforms.texelSize.value.set(1/s,1/i)}},vS=class extends Rn{constructor({normalBuffer:s=null,resolutionScale:i=.5,width:t=Dt.AUTO_SIZE,height:n=Dt.AUTO_SIZE,resolutionX:r=t,resolutionY:o=n}={}){super("DepthDownsamplingPass");const a=new _j;a.normalBuffer=s,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Et(1,1,{minFilter:Zt,magFilter:Zt,depthBuffer:!1,type:Ao}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new Dt(this,r,o,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(s,i=Xs){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=i}render(s,i,t,n,r){s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(s,i)}initialize(s,i,t){const n=s.getContext();if(!(n.getExtension("EXT_color_buffer_float")||n.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},wj=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,J1=64,gk=class extends Ys{constructor(s,i,{blendFunction:t=Ze.MULTIPLY,samples:n=9,rings:r=7,normalDepthBuffer:o=null,depthAwareUpsampling:a=!0,worldDistanceThreshold:l,worldDistanceFalloff:c,worldProximityThreshold:u,worldProximityFalloff:d,distanceThreshold:f=.97,distanceFalloff:p=.03,rangeThreshold:g=5e-4,rangeFalloff:m=.001,minRadiusScale:A=.1,luminanceInfluence:y=.7,radius:b=.1825,intensity:_=1,bias:w=.025,fade:S=.01,color:E=null,resolutionScale:I=1,width:k=Dt.AUTO_SIZE,height:T=Dt.AUTO_SIZE,resolutionX:P=k,resolutionY:B=T}={}){super("SSAOEffect",wj,{blendFunction:t,attributes:Ur.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new ee(null)],["normalDepthBuffer",new ee(o)],["luminanceInfluence",new ee(y)],["color",new ee(null)],["intensity",new ee(_)],["scale",new ee(0)]])}),this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const M=this.resolution=new Dt(this,P,B,I);M.addEventListener("change",W=>this.setSize(M.baseWidth,M.baseHeight)),this.camera=s,this.depthDownsamplingPass=new vS({normalBuffer:i,resolutionScale:I}),this.depthDownsamplingPass.enabled=o===null,this.ssaoPass=new Ra(new vj(s));const U=new tj(J1,J1,qi);U.wrapS=U.wrapT=ic;const G=this.ssaoMaterial;G.normalBuffer=i,G.noiseTexture=U,G.minRadiusScale=A,G.samples=n,G.radius=b,G.rings=r,G.fade=S,G.bias=w,G.distanceThreshold=f,G.distanceFalloff=p,G.proximityThreshold=g,G.proximityFalloff=m,l!==void 0&&(G.worldDistanceThreshold=l),c!==void 0&&(G.worldDistanceFalloff=c),u!==void 0&&(G.worldProximityThreshold=u),d!==void 0&&(G.worldProximityFalloff=d),o!==null&&(this.ssaoMaterial.normalDepthBuffer=o,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=a,this.color=E}set mainCamera(s){this.camera=s,this.ssaoMaterial.copyCameraSettings(s)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(s){this.ssaoMaterial.normalBuffer=s,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=s}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(s){this.ssaoMaterial.samples=s}get rings(){return this.ssaoMaterial.rings}set rings(s){this.ssaoMaterial.rings=s}get radius(){return this.ssaoMaterial.radius}set radius(s){this.ssaoMaterial.radius=s}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(s){this.depthAwareUpsampling!==s&&(s?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(s){this.depthAwareUpsampling=s}get distanceScaling(){return!0}set distanceScaling(s){}get color(){return this.uniforms.get("color").value}set color(s){const i=this.uniforms,t=this.defines;s!==null?t.has("COLORIZE")?i.get("color").value.set(s):(t.set("COLORIZE","1"),i.get("color").value=new xe(s),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),i.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(s){this.uniforms.get("luminanceInfluence").value=s}get intensity(){return this.uniforms.get("intensity").value}set intensity(s){this.uniforms.get("intensity").value=s}getColor(){return this.color}setColor(s){this.color=s}setDistanceCutoff(s,i){this.ssaoMaterial.distanceThreshold=s,this.ssaoMaterial.distanceFalloff=i}setProximityCutoff(s,i){this.ssaoMaterial.proximityThreshold=s,this.ssaoMaterial.proximityFalloff=i}setDepthTexture(s,i=Xs){this.depthDownsamplingPass.setDepthTexture(s,i),this.ssaoMaterial.depthBuffer=s,this.ssaoMaterial.depthPacking=i}update(s,i,t){const n=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(s),this.ssaoPass.render(s,null,n)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i);const n=t.width,r=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(n,r),this.renderTarget.setSize(n,r),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(s,i)}initialize(s,i,t){try{let n=this.uniforms.get("normalDepthBuffer").value;n===null&&(this.depthDownsamplingPass.initialize(s,i,t),n=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=n,this.ssaoMaterial.normalDepthBuffer=n,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},xj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Cj="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",Sj=class extends sk{constructor({kernelSize:s=Ka.MEDIUM,offset:i=0,rotation:t=0,focusArea:n=.4,feather:r=.3}={}){super(),this.fragmentShader=xj,this.vertexShader=Cj,this.kernelSize=s,this.uniforms.aspect=new ee(1),this.uniforms.rotation=new ee(new ae),this.uniforms.maskParams=new ee(new Ue),this._offset=i,this._focusArea=n,this._feather=r,this.rotation=t,this.updateParams()}updateParams(){const s=this.uniforms.maskParams.value,i=Math.max(this.focusArea,0),t=Math.max(i-this.feather,0);s.set(this.offset-i,this.offset-t,this.offset+i,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(s){this.uniforms.rotation.value.set(Math.cos(s),Math.sin(s))}get offset(){return this._offset}set offset(s){this._offset=s,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(s){this._focusArea=s,this.updateParams()}get feather(){return this._feather}set feather(s){this._feather=s,this.updateParams()}setSize(s,i){super.setSize(s,i),this.uniforms.aspect.value=s/i}},Ej=class extends gS{constructor({offset:s=0,rotation:i=0,focusArea:t=.4,feather:n=.3,kernelSize:r=Ka.MEDIUM,resolutionScale:o=.5,resolutionX:a=Dt.AUTO_SIZE,resolutionY:l=Dt.AUTO_SIZE}={}){super({kernelSize:r,resolutionScale:o,resolutionX:a,resolutionY:l}),this.blurMaterial=new Sj({kernelSize:r,offset:s,rotation:i,focusArea:t,feather:n})}},Ij=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,Tj="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",mk=class extends Ys{constructor({blendFunction:i,offset:t=0,rotation:n=0,focusArea:r=.4,feather:o=.3,kernelSize:a=Ka.MEDIUM,resolutionScale:l=.5,resolutionX:c=Dt.AUTO_SIZE,resolutionY:u=Dt.AUTO_SIZE}={}){super("TiltShiftEffect",Ij,{vertexShader:Tj,blendFunction:i,uniforms:new Map([["rotation",new ee(new ae)],["maskParams",new ee(new ae)],["map",new ee(null)]])}),this._offset=t,this._focusArea=r,this._feather=o,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new Ej({kernelSize:a,resolutionScale:l,resolutionX:c,resolutionY:u,offset:t,rotation:n,focusArea:r,feather:o});const d=this.resolution=new Dt(this,c,u,l);d.addEventListener("change",f=>this.setSize(d.baseWidth,d.baseHeight)),this.rotation=n,this.updateParams()}updateParams(){const i=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);i.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(i){this.uniforms.get("rotation").value.set(Math.cos(i),Math.sin(i)),this.blurPass.blurMaterial.rotation=i}get offset(){return this._offset}set offset(i){this._offset=i,this.blurPass.blurMaterial.offset=i,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(i){this._focusArea=i,this.blurPass.blurMaterial.focusArea=i,this.updateParams()}get feather(){return this._feather}set feather(i){this._feather=i,this.blurPass.blurMaterial.feather=i,this.updateParams()}get bias(){return 0}set bias(i){}update(i,t,n){this.blurPass.render(i,t,this.renderTarget)}setSize(i,t){const n=this.resolution;n.setBaseSize(i,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n)}initialize(i,t,n){this.blurPass.initialize(i,t,n),n!==void 0&&(this.renderTarget.texture.type=n,i!==null&&i.outputColorSpace===He&&(this.renderTarget.texture.colorSpace=He))}},Rj=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,Bj=class extends et{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new ee(null),luminanceBuffer1:new ee(null),minLuminance:new ee(.01),deltaTime:new ee(0),tau:new ee(1)},extensions:{shaderTextureLOD:!0},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Rj,vertexShader:Fu})}set luminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}setLuminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}set luminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}setLuminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}set mipLevel1x1(s){this.defines.MIP_LEVEL_1X1=s.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(s){this.mipLevel1x1=s}set deltaTime(s){this.uniforms.deltaTime.value=s}setDeltaTime(s){this.uniforms.deltaTime.value=s}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(s){this.uniforms.minLuminance.value=s}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(s){this.uniforms.minLuminance.value=s}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(s){this.uniforms.tau.value=s}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(s){this.uniforms.tau.value=s}},Pj=class extends Rn{constructor(s,{minLuminance:i=.01,adaptationRate:t=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new Bj,this.needsSwap=!1,this.renderTargetPrevious=new Et(1,1,{minFilter:Zt,magFilter:Zt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const n=this.fullscreenMaterial;n.luminanceBuffer0=this.renderTargetPrevious.texture,n.luminanceBuffer1=s,n.minLuminance=i,n.adaptationRate=t,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new nk(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(s){this.fullscreenMaterial.mipLevel1x1=s}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(s){this.fullscreenMaterial.adaptationRate=s}render(s,i,t,n,r){this.fullscreenMaterial.deltaTime=n,s.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),s.render(this.scene,this.camera),this.copyPass.render(s,this.renderTargetAdapted)}},Mj=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,$v=class extends Ys{constructor({blendFunction:i=Ze.SRC,adaptive:t=!1,mode:n=t?vn.REINHARD2_ADAPTIVE:vn.AGX,resolution:r=256,maxLuminance:o=4,whitePoint:a=o,middleGrey:l=.6,minLuminance:c=.01,averageLuminance:u=1,adaptationRate:d=1}={}){super("ToneMappingEffect",Mj,{blendFunction:i,uniforms:new Map([["luminanceBuffer",new ee(null)],["maxLuminance",new ee(o)],["whitePoint",new ee(a)],["middleGrey",new ee(l)],["averageLuminance",new ee(u)]])}),this.renderTargetLuminance=new Et(1,1,{minFilter:ym,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new rk({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new Pj(this.luminancePass.texture,{minLuminance:c,adaptationRate:d}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=r,this.mode=n}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(i){if(this.mode!==i){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",i.toFixed(0)),i){case vn.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case vn.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case vn.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case vn.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case vn.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case vn.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=i===vn.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(i){this.mode=i}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(i){this.uniforms.get("whitePoint").value=i}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(i){this.uniforms.get("middleGrey").value=i}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(i){this.uniforms.get("averageLuminance").value=i}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(i){const t=Math.max(0,Math.ceil(Math.log2(i))),n=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(n,n),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(i){this.resolution=i}get adaptive(){return this.mode===vn.REINHARD2_ADAPTIVE}set adaptive(i){this.mode=i?vn.REINHARD2_ADAPTIVE:vn.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(i){this.adaptiveLuminanceMaterial.adaptationRate=i}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(i){console.warn(this.name,"distinction was removed.")}update(i,t,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(i,t),this.adaptiveLuminancePass.render(i,null,null,n))}initialize(i,t,n){this.adaptiveLuminancePass.initialize(i,t,n)}},kj=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Ak=class extends Ys{constructor({blendFunction:s,eskil:i=!1,technique:t=i?hp.ESKIL:hp.DEFAULT,offset:n=.5,darkness:r=.5}={}){super("VignetteEffect",kj,{blendFunction:s,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new ee(n)],["darkness",new ee(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(s){this.technique!==s&&(this.defines.set("VIGNETTE_TECHNIQUE",s.toFixed(0)),this.setChanged())}get eskil(){return this.technique===hp.ESKIL}set eskil(s){this.technique=s?hp.ESKIL:hp.DEFAULT}getTechnique(){return this.technique}setTechnique(s){this.technique=s}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}get darkness(){return this.uniforms.get("darkness").value}set darkness(s){this.uniforms.get("darkness").value=s}getDarkness(){return this.darkness}setDarkness(s){this.darkness=s}},Dj=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Oj="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Lj=class extends et{constructor(s,i,t,n,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:TC.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ee(null),depthBuffer:new ee(null),resolution:new ee(new ae),texelSize:new ee(new ae),cameraNear:new ee(.3),cameraFar:new ee(1e3),aspect:new ee(1),time:new ee(0)},blending:Js,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),s&&this.setShaderParts(s),i&&this.setDefines(i),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,i=Xs){this.depthBuffer=s,this.depthPacking=i}setShaderData(s){this.setShaderParts(s.shaderParts),this.setDefines(s.defines),this.setUniforms(s.uniforms),this.setExtensions(s.extensions)}setShaderParts(s){return this.fragmentShader=Dj.replace(St.FRAGMENT_HEAD,s.get(St.FRAGMENT_HEAD)||"").replace(St.FRAGMENT_MAIN_UV,s.get(St.FRAGMENT_MAIN_UV)||"").replace(St.FRAGMENT_MAIN_IMAGE,s.get(St.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Oj.replace(St.VERTEX_HEAD,s.get(St.VERTEX_HEAD)||"").replace(St.VERTEX_MAIN_SUPPORT,s.get(St.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(s){for(const i of s.entries())this.defines[i[0]]=i[1];return this.needsUpdate=!0,this}setUniforms(s){for(const i of s.entries())this.uniforms[i[0]]=i[1];return this}setExtensions(s){this.extensions={};for(const i of s)this.extensions[i]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(s){this.encodeOutput!==s&&(s?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(s){return this.encodeOutput}setOutputEncodingEnabled(s){this.encodeOutput=s}get time(){return this.uniforms.time.value}set time(s){this.uniforms.time.value=s}setDeltaTime(s){this.uniforms.time.value+=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,i){const t=this.uniforms;t.resolution.value.set(s,i),t.texelSize.value.set(1/s,1/i),t.aspect.value=s/i}static get Section(){return St}};function Z1(s,i,t){for(const n of i){const r="$1"+s+n.charAt(0).toUpperCase()+n.slice(1),o=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const a of t.entries())a[1]!==null&&t.set(a[0],a[1].replace(o,r))}}function Fj(s,i,t){let n=i.getFragmentShader(),r=i.getVertexShader();const o=n!==void 0&&/mainImage/.test(n),a=n!==void 0&&/mainUv/.test(n);if(t.attributes|=i.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${i.name})`);if(a&&t.attributes&Ur.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${i.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${i.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let u=c.get(St.FRAGMENT_HEAD)||"",d=c.get(St.FRAGMENT_MAIN_UV)||"",f=c.get(St.FRAGMENT_MAIN_IMAGE)||"",p=c.get(St.VERTEX_HEAD)||"",g=c.get(St.VERTEX_MAIN_SUPPORT)||"";const m=new Set,A=new Set;if(a&&(d+=`	${s}MainUv(UV);
`,t.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const _=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);g+=`	${s}MainSupport(`,g+=_?`vUv);
`:`);
`;for(const w of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const S of w[1].split(/\s*,\s*/))t.varyings.add(S),m.add(S),A.add(S);for(const w of r.matchAll(l))A.add(w[1])}for(const _ of n.matchAll(l))A.add(_[1]);for(const _ of i.defines.keys())A.add(_.replace(/\([\w\s,]*\)/g,""));for(const _ of i.uniforms.keys())A.add(_);A.delete("while"),A.delete("for"),A.delete("if"),i.uniforms.forEach((_,w)=>t.uniforms.set(s+w.charAt(0).toUpperCase()+w.slice(1),_)),i.defines.forEach((_,w)=>t.defines.set(s+w.charAt(0).toUpperCase()+w.slice(1),_));const y=new Map([["fragment",n],["vertex",r]]);Z1(s,A,t.defines),Z1(s,A,y),n=y.get("fragment"),r=y.get("vertex");const b=i.blendMode;if(t.blendModes.set(b.blendFunction,b),o){i.inputColorSpace!==null&&i.inputColorSpace!==t.colorSpace&&(f+=i.inputColorSpace===He?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),i.outputColorSpace!==xu?t.colorSpace=i.outputColorSpace:i.inputColorSpace!==null&&(t.colorSpace=i.inputColorSpace);const _=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;f+=`${s}MainImage(color0, UV, `,t.attributes&Ur.DEPTH&&_.test(n)&&(f+="depth, ",t.readDepth=!0),f+=`color1);
	`;const w=s+"BlendOpacity";t.uniforms.set(w,b.opacity),f+=`color0 = blend${b.blendFunction}(color0, color1, ${w});

	`,u+=`uniform float ${w};

`}if(u+=n+`
`,r!==null&&(p+=r+`
`),c.set(St.FRAGMENT_HEAD,u),c.set(St.FRAGMENT_MAIN_UV,d),c.set(St.FRAGMENT_MAIN_IMAGE,f),c.set(St.VERTEX_HEAD,p),c.set(St.VERTEX_MAIN_SUPPORT,g),i.extensions!==null)for(const _ of i.extensions)t.extensions.add(_)}}var $1=class extends Rn{constructor(s,...i){super("EffectPass"),this.fullscreenMaterial=new Lj(null,null,null,s),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(i),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(s){for(const i of this.effects)i.mainScene=s}set mainCamera(s){this.fullscreenMaterial.copyCameraSettings(s);for(const i of this.effects)i.mainCamera=s}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(s){this.fullscreenMaterial.encodeOutput=s}get dithering(){return this.fullscreenMaterial.dithering}set dithering(s){const i=this.fullscreenMaterial;i.dithering=s,i.needsUpdate=!0}setEffects(s){for(const i of this.effects)i.removeEventListener("change",this.listener);this.effects=s.sort((i,t)=>t.attributes-i.attributes);for(const i of this.effects)i.addEventListener("change",this.listener)}updateMaterial(){const s=new Yz;let i=0;for(const a of this.effects)if(a.blendMode.blendFunction===Ze.DST)s.attributes|=a.getAttributes()&Ur.DEPTH;else{if(s.attributes&a.getAttributes()&Ur.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);Fj("e"+i++,a,s)}let t=s.shaderParts.get(St.FRAGMENT_HEAD),n=s.shaderParts.get(St.FRAGMENT_MAIN_IMAGE),r=s.shaderParts.get(St.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of s.blendModes.values())t+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;s.attributes&Ur.DEPTH?(s.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,s.colorSpace===He&&(n+=`color0 = sRGBToLinear(color0);
	`),s.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,s.defines.set("UV","transformedUv")):s.defines.set("UV","vUv"),s.shaderParts.set(St.FRAGMENT_HEAD,t),s.shaderParts.set(St.FRAGMENT_MAIN_IMAGE,n),s.shaderParts.set(St.FRAGMENT_MAIN_UV,r);for(const[a,l]of s.shaderParts)l!==null&&s.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=i===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(s)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(s,i=Xs){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=i;for(const t of this.effects)t.setDepthTexture(s,i)}render(s,i,t,n,r){for(const o of this.effects)o.update(s,i,n);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=i.texture,o.time+=n*this.timeScale,s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}}setSize(s,i){this.fullscreenMaterial.setSize(s,i);for(const t of this.effects)t.setSize(s,i)}initialize(s,i,t){this.renderer=s;for(const n of this.effects)n.initialize(s,i,t);this.updateMaterial(),t!==void 0&&t!==mi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const s of this.effects)s.removeEventListener("change",this.listener),s.dispose()}handleEvent(s){switch(s.type){case"change":this.recompile();break}}},vk=class extends Rn{constructor(s,i,{renderTarget:t,resolutionScale:n=1,width:r=Dt.AUTO_SIZE,height:o=Dt.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new y0(s,i,new bP);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const u=c.getClearPass();u.overrideClearColor=new xe(7829503),u.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{minFilter:Zt,magFilter:Zt}),this.renderTarget.texture.name="NormalPass.Target");const d=this.resolution=new Dt(this,a,l,n);d.addEventListener("change",f=>this.setSize(d.baseWidth,d.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,i,t,n,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,o,o)}setSize(s,i){const t=this.resolution;t.setBaseSize(s,i),this.renderTarget.setSize(t.width,t.height)}},ng=function(){var s=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(d){d.preventDefault(),n(++s%i.children.length)},!1);function t(d){return i.appendChild(d.dom),d}function n(d){for(var f=0;f<i.children.length;f++)i.children[f].style.display=f===d?"block":"none";s=d}var r=(performance||Date).now(),o=r,a=0,l=t(new ng.Panel("FPS","#0ff","#002")),c=t(new ng.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new ng.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var d=(performance||Date).now();if(c.update(d-r,200),d>=o+1e3&&(l.update(a*1e3/(d-o),100),o=d,a=0,u)){var f=performance.memory;u.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return d},update:function(){r=this.end()},domElement:i,setMode:n}};ng.Panel=function(s,i,t){var n=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),l=80*a,c=48*a,u=3*a,d=2*a,f=3*a,p=15*a,g=74*a,m=30*a,A=document.createElement("canvas");A.width=l,A.height=c,A.style.cssText="width:80px;height:48px";var y=A.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=t,y.fillRect(0,0,l,c),y.fillStyle=i,y.fillText(s,u,d),y.fillRect(f,p,g,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(f,p,g,m),{dom:A,update:function(b,_){n=Math.min(n,b),r=Math.max(r,b),y.fillStyle=t,y.globalAlpha=1,y.fillRect(0,0,l,p),y.fillStyle=i,y.fillText(o(b)+" "+s+" ("+o(n)+"-"+o(r)+")",u,d),y.drawImage(A,f+a,p,g-a,m,f,p,g-a,m),y.fillRect(f+g-a,p,a,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(f+g-a,p,a,o((1-b/_)*m))}}};const Uj=Q("debugpatch");function yS(s,i,t,n){const r=Uj===i;if(!t&&!n)return;const o=i+"___needle";Nj(s,i,t,n);const a=Object.getOwnPropertyDescriptor(s,i),l=s[i];r&&console.log("Patch",s.constructor.name,i,a,l),a?(r&&console.log("Apply patch with existing descriptor",s.constructor.name,i,a),typeof a.value=="function"&&(s[i]=tI(a.value,s,i))):(r&&console.log("Create patch with new property",s.constructor.name,i,a),Object.defineProperty(s,i,{set:function(c){if(typeof c=="function")this[o]=tI(c,s,i);else{const u=this[o];yk(s,i,this,u,c),this[o]=c,bk(s,i,this,u,c)}},get:function(){const c=this[o];return typeof c=="function"&&c[o]?c[o]:c}}))}function fK(s,i,t){const n=bS(s,i);if(n)for(let r=n.length-1;r>=0;r--){const o=n[r];o.prefix===t&&(o.prefix=null),o.postfix===t&&(o.postfix=null),!o.prefix&&!o.postfix&&n.splice(r,1)}}const eI=Symbol("Needle:Patches:WrappedFunction");function tI(s,i,t){if(s[eI])return s;const n=function(...r){yk(i,t,this,...r);const o=s.apply(this,r);return bk(i,t,this,o,...r),o};return n[eI]=!0,n}const Wb="Needle:Patches";function Zw(){return globalThis[Wb]||(globalThis[Wb]=new WeakMap),globalThis[Wb]}function bS(s,i){const t=Zw().get(s);return t?t.get(i):null}function Nj(s,i,t,n){let r=Zw().get(s);r||(r=new Map,Zw().set(s,r));let o=r.get(i);o||(o=[],r.set(i,o)),o.push({prefix:t,postfix:n})}function yk(s,i,t,...n){var o;if(!t)return;const r=bS(s,i);if(r)for(const a of r)(o=a.prefix)==null||o.call(t,...n)}function bk(s,i,t,n,...r){var a;if(!t)return;const o=bS(s,i);if(o)for(const l of o)(a=l.postfix)==null||a.call(t,n,...r)}const _k="1.2.9";globalThis.GLTF_PROGRESSIVE_VERSION=_k;console.debug(`[gltf-progressive] version ${_k}`);function zj(s,i=1e-4){i=Math.max(i,Number.EPSILON);const t={},n=s.getIndex(),r=s.getAttribute("position"),o=n?n.count:r.count;let a=0;const l=Object.keys(s.attributes),c={},u={},d=[],f=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let _=0,w=l.length;_<w;_++){const S=l[_],E=s.attributes[S];c[S]=new Je(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized);const I=s.morphAttributes[S];I&&(u[S]=new Je(new I.array.constructor(I.count*I.itemSize),I.itemSize,I.normalized))}const g=i*.5,m=Math.log10(1/i),A=Math.pow(10,m),y=g*A;for(let _=0;_<o;_++){const w=n?n.getX(_):_;let S="";for(let E=0,I=l.length;E<I;E++){const k=l[E],T=s.getAttribute(k),P=T.itemSize;for(let B=0;B<P;B++)S+=`${~~(T[f[B]](w)*A+y)},`}if(S in t)d.push(t[S]);else{for(let E=0,I=l.length;E<I;E++){const k=l[E],T=s.getAttribute(k),P=s.morphAttributes[k],B=T.itemSize,M=c[k],U=u[k];for(let G=0;G<B;G++){const W=f[G],Y=p[G];if(M[Y](a,T[W](w)),P)for(let D=0,L=P.length;D<L;D++)U[D][Y](a,P[D][W](w))}}t[S]=a,d.push(a),a++}}const b=s.clone();for(const _ in s.attributes){const w=c[_];if(b.setAttribute(_,new Je(w.array.slice(0,a*w.itemSize),w.itemSize,w.normalized)),_ in u)for(let S=0;S<u[_].length;S++){const E=u[_][S];b.morphAttributes[_][S]=new Je(E.array.slice(0,a*E.itemSize),E.itemSize,E.normalized)}}return b.setIndex(d),b}function iI(s,i){if(i===WL)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(i===Ow||i===IP){let t=s.getIndex();if(t===null){const a=[],l=s.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);s.setIndex(a),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,r=[];if(i===Ow)for(let a=1;a<=n;a++)r.push(t.getX(0)),r.push(t.getX(a)),r.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(r.push(t.getX(a)),r.push(t.getX(a+1)),r.push(t.getX(a+2))):(r.push(t.getX(a+2)),r.push(t.getX(a+1)),r.push(t.getX(a)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),s}class rl extends ch{constructor(i){super(i),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Vj(t)}),this.register(function(t){return new eG(t)}),this.register(function(t){return new tG(t)}),this.register(function(t){return new iG(t)}),this.register(function(t){return new qj(t)}),this.register(function(t){return new Xj(t)}),this.register(function(t){return new Yj(t)}),this.register(function(t){return new Kj(t)}),this.register(function(t){return new Hj(t)}),this.register(function(t){return new Jj(t)}),this.register(function(t){return new Wj(t)}),this.register(function(t){return new $j(t)}),this.register(function(t){return new Zj(t)}),this.register(function(t){return new jj(t)}),this.register(function(t){return new nG(t)}),this.register(function(t){return new sG(t)})}load(i,t,n,r){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=tf.extractUrlBase(i);a=tf.resolveURL(u,this.path)}else a=tf.extractUrlBase(i);this.manager.itemStart(i);const l=function(u){r?r(u):console.error(u),o.manager.itemError(i),o.manager.itemEnd(i)},c=new Lr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(i,function(u){try{o.parse(u,a,function(d){t(d),o.manager.itemEnd(i)},l)}catch(d){l(d)}},n,l)}setDRACOLoader(i){return this.dracoLoader=i,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(i){return this.ktx2Loader=i,this}setMeshoptDecoder(i){return this.meshoptDecoder=i,this}register(i){return this.pluginCallbacks.indexOf(i)===-1&&this.pluginCallbacks.push(i),this}unregister(i){return this.pluginCallbacks.indexOf(i)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(i),1),this}parse(i,t,n,r){let o;const a={},l={},c=new TextDecoder;if(typeof i=="string")o=JSON.parse(i);else if(i instanceof ArrayBuffer)if(c.decode(new Uint8Array(i,0,4))===wk){try{a[ft.KHR_BINARY_GLTF]=new rG(i)}catch(f){r&&r(f);return}o=JSON.parse(a[ft.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(i));else o=i;if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new vG(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const f=this.pluginCallbacks[d](u);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[f.name]=f,a[f.name]=!0}if(o.extensionsUsed)for(let d=0;d<o.extensionsUsed.length;++d){const f=o.extensionsUsed[d],p=o.extensionsRequired||[];switch(f){case ft.KHR_MATERIALS_UNLIT:a[f]=new Gj;break;case ft.KHR_DRACO_MESH_COMPRESSION:a[f]=new oG(o,this.dracoLoader);break;case ft.KHR_TEXTURE_TRANSFORM:a[f]=new aG;break;case ft.KHR_MESH_QUANTIZATION:a[f]=new lG;break;default:p.indexOf(f)>=0&&l[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(a),u.setPlugins(l),u.parse(n,r)}parseAsync(i,t){const n=this;return new Promise(function(r,o){n.parse(i,t,r,o)})}}function Qj(){let s={};return{get:function(i){return s[i]},add:function(i,t){s[i]=t},remove:function(i){delete s[i]},removeAll:function(){s={}}}}const ft={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class jj{constructor(i){this.parser=i,this.name=ft.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const i=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&i._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(i){const t=this.parser,n="light:"+i;let r=t.cache.get(n);if(r)return r;const o=t.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[i];let u;const d=new xe(16777215);c.color!==void 0&&d.setRGB(c.color[0],c.color[1],c.color[2],zi);const f=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new zg(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Ng(d),u.distance=f;break;case"spot":u=new RC(d),u.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,Fc(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=t.createUniqueName(c.name||"light_"+i),r=Promise.resolve(u),t.cache.add(n,r),r}getDependency(i,t){if(i==="light")return this._loadLight(t)}createNodeAttachment(i){const t=this,n=this.parser,o=n.json.nodes[i],l=(o.extensions&&o.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(c){return n._getNodeRef(t.cache,l,c)})}}let Gj=class{constructor(){this.name=ft.KHR_MATERIALS_UNLIT}getMaterialType(){return _t}extendParams(i,t,n){const r=[];i.color=new xe(1,1,1),i.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;i.color.setRGB(a[0],a[1],a[2],zi),i.opacity=a[3]}o.baseColorTexture!==void 0&&r.push(n.assignTexture(i,"map",o.baseColorTexture,He))}return Promise.all(r)}},Hj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(i,t){const r=this.parser.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=r.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}},Vj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_CLEARCOAT}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const l=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ae(l,l)}return Promise.all(o)}},Wj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_IRIDESCENCE}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}},qj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_SHEEN}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new xe(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const l=a.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],zi)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,He)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}},Xj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_TRANSMISSION}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}},Yj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_VOLUME}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const l=a.attenuationColor||[1,1,1];return t.attenuationColor=new xe().setRGB(l[0],l[1],l[2],zi),Promise.all(o)}},Kj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_IOR}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const r=this.parser.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=r.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},Jj=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_SPECULAR}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const l=a.specularColorFactor||[1,1,1];return t.specularColor=new xe().setRGB(l[0],l[1],l[2],zi),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,He)),Promise.all(o)}},Zj=class{constructor(i){this.parser=i,this.name=ft.EXT_MATERIALS_BUMP}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(o)}},$j=class{constructor(i){this.parser=i,this.name=ft.KHR_MATERIALS_ANISOTROPY}getMaterialType(i){const n=this.parser.json.materials[i];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(i,t){const n=this.parser,r=n.json.materials[i];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&o.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(o)}};class eG{constructor(i){this.parser=i,this.name=ft.KHR_TEXTURE_BASISU}loadTexture(i){const t=this.parser,n=t.json,r=n.textures[i];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(i,o.source,a)}}class tG{constructor(i){this.parser=i,this.name=ft.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(i){const t=this.name,n=this.parser,r=n.json,o=r.textures[i];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],l=r.images[a.source];let c=n.textureLoader;if(l.uri){const u=n.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(i,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(i)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(i){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){i(t.height===1)}})),this.isSupported}}class iG{constructor(i){this.parser=i,this.name=ft.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(i){const t=this.name,n=this.parser,r=n.json,o=r.textures[i];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],l=r.images[a.source];let c=n.textureLoader;if(l.uri){const u=n.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(i,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(i)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(i){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){i(t.height===1)}})),this.isSupported}}class nG{constructor(i){this.name=ft.EXT_MESHOPT_COMPRESSION,this.parser=i}loadBufferView(i){const t=this.parser.json,n=t.bufferViews[i];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){const c=r.byteOffset||0,u=r.byteLength||0,d=r.count,f=r.byteStride,p=new Uint8Array(l,c,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(d,f,p,r.mode,r.filter).then(function(g){return g.buffer}):a.ready.then(function(){const g=new ArrayBuffer(d*f);return a.decodeGltfBuffer(new Uint8Array(g),d,f,p,r.mode,r.filter),g})})}else return null}}let sG=class{constructor(i){this.name=ft.EXT_MESH_GPU_INSTANCING,this.parser=i}createNodeMesh(i){const t=this.parser.json,n=t.nodes[i];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const u of r.primitives)if(u.mode!==oo.TRIANGLES&&u.mode!==oo.TRIANGLE_STRIP&&u.mode!==oo.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=n.extensions[this.name].attributes,l=[],c={};for(const u in a)l.push(this.parser.getDependency("accessor",a[u]).then(d=>(c[u]=d,c[u])));return l.length<1?null:(l.push(this.parser.createNodeMesh(i)),Promise.all(l).then(u=>{const d=u.pop(),f=d.isGroup?d.children:[d],p=u[0].count,g=[];for(const m of f){const A=new le,y=new x,b=new se,_=new x(1,1,1),w=new qL(m.geometry,m.material,p);for(let S=0;S<p;S++)c.TRANSLATION&&y.fromBufferAttribute(c.TRANSLATION,S),c.ROTATION&&b.fromBufferAttribute(c.ROTATION,S),c.SCALE&&_.fromBufferAttribute(c.SCALE,S),w.setMatrixAt(S,A.compose(y,b,_));for(const S in c)if(S==="_COLOR_0"){const E=c[S];w.instanceColor=new kc(E.array,E.itemSize,E.normalized)}else S!=="TRANSLATION"&&S!=="ROTATION"&&S!=="SCALE"&&m.geometry.setAttribute(S,c[S]);ne.prototype.copy.call(w,m),this.parser.assignFinalMaterial(w),g.push(w)}return d.isGroup?(d.clear(),d.add(...g),d):g[0]}))}};const wk="glTF",up=12,nI={JSON:1313821514,BIN:5130562};class rG{constructor(i){this.name=ft.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(i,0,up),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(i.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wk)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-up,o=new DataView(i,up);let a=0;for(;a<r;){const l=o.getUint32(a,!0);a+=4;const c=o.getUint32(a,!0);if(a+=4,c===nI.JSON){const u=new Uint8Array(i,up+a,l);this.content=n.decode(u)}else if(c===nI.BIN){const u=up+a;this.body=i.slice(u,u+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class oG{constructor(i,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ft.KHR_DRACO_MESH_COMPRESSION,this.json=i,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(i,t){const n=this.json,r=this.dracoLoader,o=i.extensions[this.name].bufferView,a=i.extensions[this.name].attributes,l={},c={},u={};for(const d in a){const f=$w[d]||d.toLowerCase();l[f]=a[d]}for(const d in i.attributes){const f=$w[d]||d.toLowerCase();if(a[d]!==void 0){const p=n.accessors[i.attributes[d]],g=af[p.componentType];u[f]=g.name,c[f]=p.normalized===!0}}return t.getDependency("bufferView",o).then(function(d){return new Promise(function(f,p){r.decodeDracoFile(d,function(g){for(const m in g.attributes){const A=g.attributes[m],y=c[m];y!==void 0&&(A.normalized=y)}f(g)},l,u,zi,p)})})}}class aG{constructor(){this.name=ft.KHR_TEXTURE_TRANSFORM}extendTexture(i,t){return(t.texCoord===void 0||t.texCoord===i.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(i=i.clone(),t.texCoord!==void 0&&(i.channel=t.texCoord),t.offset!==void 0&&i.offset.fromArray(t.offset),t.rotation!==void 0&&(i.rotation=t.rotation),t.scale!==void 0&&i.repeat.fromArray(t.scale),i.needsUpdate=!0),i}}class lG{constructor(){this.name=ft.KHR_MESH_QUANTIZATION}}class xk extends JL{constructor(i,t,n,r){super(i,t,n,r)}copySampleValue_(i){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=i*r*3+r;for(let a=0;a!==r;a++)t[a]=n[o+a];return t}interpolate_(i,t,n,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=l*2,u=l*3,d=r-t,f=(n-t)/d,p=f*f,g=p*f,m=i*u,A=m-u,y=-2*g+3*p,b=g-p,_=1-y,w=b-p+f;for(let S=0;S!==l;S++){const E=a[A+S+l],I=a[A+S+c]*d,k=a[m+S+l],T=a[m+S]*d;o[S]=_*E+w*I+y*k+b*T}return o}}const cG=new se;class hG extends xk{interpolate_(i,t,n,r){const o=super.interpolate_(i,t,n,r);return cG.fromArray(o).normalize().toArray(o),o}}const oo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},af={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sI={9728:Zt,9729:Mt,9984:TP,9985:RP,9986:BP,9987:ym},rI={33071:Gv,33648:Hv,10497:ic},qb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$w={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},uG={CUBICSPLINE:void 0,LINEAR:PC,STEP:PP},Xb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function dG(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new Jn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:il})),s.DefaultMaterial}function Mh(s,i,t){for(const n in t.extensions)s[n]===void 0&&(i.userData.gltfExtensions=i.userData.gltfExtensions||{},i.userData.gltfExtensions[n]=t.extensions[n])}function Fc(s,i){i.extras!==void 0&&(typeof i.extras=="object"?Object.assign(s.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function fG(s,i,t){let n=!1,r=!1,o=!1;for(let u=0,d=i.length;u<d;u++){const f=i[u];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(o=!0),n&&r&&o)break}if(!n&&!r&&!o)return Promise.resolve(s);const a=[],l=[],c=[];for(let u=0,d=i.length;u<d;u++){const f=i[u];if(n){const p=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):s.attributes.position;a.push(p)}if(r){const p=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):s.attributes.normal;l.push(p)}if(o){const p=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):s.attributes.color;c.push(p)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const d=u[0],f=u[1],p=u[2];return n&&(s.morphAttributes.position=d),r&&(s.morphAttributes.normal=f),o&&(s.morphAttributes.color=p),s.morphTargetsRelative=!0,s})}function pG(s,i){if(s.updateMorphTargets(),i.weights!==void 0)for(let t=0,n=i.weights.length;t<n;t++)s.morphTargetInfluences[t]=i.weights[t];if(i.extras&&Array.isArray(i.extras.targetNames)){const t=i.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function gG(s){let i;const t=s.extensions&&s.extensions[ft.KHR_DRACO_MESH_COMPRESSION];if(t?i="draco:"+t.bufferView+":"+t.indices+":"+Yb(t.attributes):i=s.indices+":"+Yb(s.attributes)+":"+s.mode,s.targets!==void 0)for(let n=0,r=s.targets.length;n<r;n++)i+=":"+Yb(s.targets[n]);return i}function Yb(s){let i="";const t=Object.keys(s).sort();for(let n=0,r=t.length;n<r;n++)i+=t[n]+":"+s[t[n]]+";";return i}function ex(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function mG(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const AG=new le;class vG{constructor(i={},t={}){this.json=i,this.extensions={},this.plugins={},this.options=t,this.cache=new Qj,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&o<98?this.textureLoader=new Xa(this.options.manager):this.textureLoader=new XL(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Lr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(i){this.extensions=i}setPlugins(i){this.plugins=i}parse(i,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const l={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:n,userData:{}};return Mh(o,l,r),Fc(l,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){i(l)})}).catch(t)}_markDefs(){const i=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){const a=t[r].joints;for(let l=0,c=a.length;l<c;l++)i[a[l]].isBone=!0}for(let r=0,o=i.length;r<o;r++){const a=i[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(i,t){t!==void 0&&(i.refs[t]===void 0&&(i.refs[t]=i.uses[t]=0),i.refs[t]++)}_getNodeRef(i,t,n){if(i.refs[t]<=1)return n;const r=n.clone(),o=(a,l)=>{const c=this.associations.get(a);c!=null&&this.associations.set(l,c);for(const[u,d]of a.children.entries())o(d,l.children[u])};return o(n,r),r.name+="_instance_"+i.uses[t]++,r}_invokeOne(i){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=i(t[n]);if(r)return r}return null}_invokeAll(i){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=i(t[r]);o&&n.push(o)}return n}getDependency(i,t){const n=i+":"+t;let r=this.cache.get(n);if(!r){switch(i){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(i,t)}),!r)throw new Error("Unknown type: "+i);break}this.cache.add(n,r)}return r}getDependencies(i){let t=this.cache.get(i);if(!t){const n=this,r=this.json[i+(i==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(o,a){return n.getDependency(i,a)})),this.cache.add(i,t)}return t}loadBuffer(i){const t=this.json.buffers[i],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&i===0)return Promise.resolve(this.extensions[ft.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){n.load(tf.resolveURL(t.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(i){const t=this.json.bufferViews[i];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+r)})}loadAccessor(i){const t=this,n=this.json,r=this.json.accessors[i];if(r.bufferView===void 0&&r.sparse===void 0){const a=qb[r.type],l=af[r.componentType],c=r.normalized===!0,u=new l(r.count*a);return Promise.resolve(new Je(u,a,c))}const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const l=a[0],c=qb[r.type],u=af[r.componentType],d=u.BYTES_PER_ELEMENT,f=d*c,p=r.byteOffset||0,g=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,m=r.normalized===!0;let A,y;if(g&&g!==f){const b=Math.floor(p/g),_="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let w=t.cache.get(_);w||(A=new u(l,b*g,r.count*g/d),w=new YL(A,g/d),t.cache.add(_,w)),y=new Xc(w,c,p%g/d,m)}else l===null?A=new u(r.count*c):A=new u(l,p,r.count*c),y=new Je(A,c,m);if(r.sparse!==void 0){const b=qb.SCALAR,_=af[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,S=r.sparse.values.byteOffset||0,E=new _(a[1],w,r.sparse.count*b),I=new u(a[2],S,r.sparse.count*c);l!==null&&(y=new Je(y.array.slice(),y.itemSize,y.normalized));for(let k=0,T=E.length;k<T;k++){const P=E[k];if(y.setX(P,I[k*c]),c>=2&&y.setY(P,I[k*c+1]),c>=3&&y.setZ(P,I[k*c+2]),c>=4&&y.setW(P,I[k*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(i){const t=this.json,n=this.options,o=t.textures[i].source,a=t.images[o];let l=this.textureLoader;if(a.uri){const c=n.manager.getHandler(a.uri);c!==null&&(l=c)}return this.loadTextureImage(i,o,l)}loadTextureImage(i,t,n){const r=this,o=this.json,a=o.textures[i],l=o.images[t],c=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(t,n).then(function(d){d.flipY=!1,d.name=a.name||l.name||"",d.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(d.name=l.uri);const p=(o.samplers||{})[a.sampler]||{};return d.magFilter=sI[p.magFilter]||Mt,d.minFilter=sI[p.minFilter]||ym,d.wrapS=rI[p.wrapS]||ic,d.wrapT=rI[p.wrapT]||ic,d.anisotropy=4,r.associations.set(d,{textures:i}),d}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(i,t){const n=this,r=this.json,o=this.options;if(this.sourceCache[i]!==void 0)return this.sourceCache[i].then(f=>f.clone());const a=r.images[i],l=self.URL||self.webkitURL;let c=a.uri||"",u=!1;if(a.bufferView!==void 0)c=n.getDependency("bufferView",a.bufferView).then(function(f){u=!0;const p=new Blob([f],{type:a.mimeType});return c=l.createObjectURL(p),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+i+" is missing URI and bufferView");const d=Promise.resolve(c).then(function(f){return new Promise(function(p,g){let m=p;t.isImageBitmapLoader===!0&&(m=function(A){const y=new At(A);y.needsUpdate=!0,p(y)}),t.load(tf.resolveURL(f,o.path),m,void 0,g)})}).then(function(f){return u===!0&&l.revokeObjectURL(c),f.userData.mimeType=a.mimeType||mG(a.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[i]=d,d}assignTexture(i,t,n,r){const o=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),o.extensions[ft.KHR_TEXTURE_TRANSFORM]){const l=n.extensions!==void 0?n.extensions[ft.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=o.associations.get(a);a=o.extensions[ft.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),o.associations.set(a,c)}}return r!==void 0&&(a.colorSpace=r),i[t]=a,a})}assignFinalMaterial(i){const t=i.geometry;let n=i.material;const r=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(i.isPoints){const l="PointsMaterial:"+n.uuid;let c=this.cache.get(l);c||(c=new Fp,mt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(l,c)),n=c}else if(i.isLine){const l="LineBasicMaterial:"+n.uuid;let c=this.cache.get(l);c||(c=new Zo,mt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(l,c)),n=c}if(r||o||a){let l="ClonedMaterial:"+n.uuid+":";r&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=n.clone(),o&&(c.vertexColors=!0),a&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(n))),n=c}i.material=n}getMaterialType(){return Jn}loadMaterial(i){const t=this,n=this.json,r=this.extensions,o=n.materials[i];let a;const l={},c=o.extensions||{},u=[];if(c[ft.KHR_MATERIALS_UNLIT]){const f=r[ft.KHR_MATERIALS_UNLIT];a=f.getMaterialType(),u.push(f.extendParams(l,o,t))}else{const f=o.pbrMetallicRoughness||{};if(l.color=new xe(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){const p=f.baseColorFactor;l.color.setRGB(p[0],p[1],p[2],zi),l.opacity=p[3]}f.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",f.baseColorTexture,He)),l.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,l.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(i)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(i,l)})))}o.doubleSided===!0&&(l.side=_i);const d=o.alphaMode||Xb.OPAQUE;if(d===Xb.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===Xb.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==_t&&(u.push(t.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new ae(1,1),o.normalTexture.scale!==void 0)){const f=o.normalTexture.scale;l.normalScale.set(f,f)}if(o.occlusionTexture!==void 0&&a!==_t&&(u.push(t.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==_t){const f=o.emissiveFactor;l.emissive=new xe().setRGB(f[0],f[1],f[2],zi)}return o.emissiveTexture!==void 0&&a!==_t&&u.push(t.assignTexture(l,"emissiveMap",o.emissiveTexture,He)),Promise.all(u).then(function(){const f=new a(l);return o.name&&(f.name=o.name),Fc(f,o),t.associations.set(f,{materials:i}),o.extensions&&Mh(r,f,o),f})}createUniqueName(i){const t=Nr.sanitizeNodeName(i||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(i){const t=this,n=this.extensions,r=this.primitiveCache;function o(l){return n[ft.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(c){return oI(c,l,t)})}const a=[];for(let l=0,c=i.length;l<c;l++){const u=i[l],d=gG(u),f=r[d];if(f)a.push(f.promise);else{let p;u.extensions&&u.extensions[ft.KHR_DRACO_MESH_COMPRESSION]?p=o(u):p=oI(new Vt,u,t),r[d]={primitive:u,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(i){const t=this,n=this.json,r=this.extensions,o=n.meshes[i],a=o.primitives,l=[];for(let c=0,u=a.length;c<u;c++){const d=a[c].material===void 0?dG(this.cache):this.getDependency("material",a[c].material);l.push(d)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(c){const u=c.slice(0,c.length-1),d=c[c.length-1],f=[];for(let g=0,m=d.length;g<m;g++){const A=d[g],y=a[g];let b;const _=u[g];if(y.mode===oo.TRIANGLES||y.mode===oo.TRIANGLE_STRIP||y.mode===oo.TRIANGLE_FAN||y.mode===void 0)b=o.isSkinnedMesh===!0?new $o(A,_):new Z(A,_),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),y.mode===oo.TRIANGLE_STRIP?b.geometry=iI(b.geometry,IP):y.mode===oo.TRIANGLE_FAN&&(b.geometry=iI(b.geometry,Ow));else if(y.mode===oo.LINES)b=new xf(A,_);else if(y.mode===oo.LINE_STRIP)b=new ms(A,_);else if(y.mode===oo.LINE_LOOP)b=new KL(A,_);else if(y.mode===oo.POINTS)b=new fv(A,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(b.geometry.morphAttributes).length>0&&pG(b,o),b.name=t.createUniqueName(o.name||"mesh_"+i),Fc(b,o),y.extensions&&Mh(r,b,y),t.assignFinalMaterial(b),f.push(b)}for(let g=0,m=f.length;g<m;g++)t.associations.set(f[g],{meshes:i,primitives:g});if(f.length===1)return o.extensions&&Mh(r,f[0],o),f[0];const p=new Fr;o.extensions&&Mh(r,p,o),t.associations.set(p,{meshes:i});for(let g=0,m=f.length;g<m;g++)p.add(f[g]);return p})}loadCamera(i){let t;const n=this.json.cameras[i],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new bt(ct.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new ku(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Fc(t,n),Promise.resolve(t)}loadSkin(i){const t=this.json.skins[i],n=[];for(let r=0,o=t.joints.length;r<o;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const o=r.pop(),a=r,l=[],c=[];for(let u=0,d=a.length;u<d;u++){const f=a[u];if(f){l.push(f);const p=new le;o!==null&&p.fromArray(o.array,u*16),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new BC(l,c)})}loadAnimation(i){const t=this.json,n=this,r=t.animations[i],o=r.name?r.name:"animation_"+i,a=[],l=[],c=[],u=[],d=[];let f=0,p=r.channels.length;for(f=0,p=r.channels.length;f<p;f++){const g=r.channels[f],m=r.samplers[g.sampler],A=g.target,y=A.node,b=r.parameters!==void 0?r.parameters[m.input]:m.input,_=r.parameters!==void 0?r.parameters[m.output]:m.output;A.node!==void 0&&(a.push(this.getDependency("node",y)),l.push(this.getDependency("accessor",b)),c.push(this.getDependency("accessor",_)),u.push(m),d.push(A))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u),Promise.all(d)]).then(function(g){const m=g[0],A=g[1],y=g[2],b=g[3],_=g[4],w=[];for(f=0,p=m.length;f<p;f++){const S=m[f],E=A[f],I=y[f],k=b[f],T=_[f];if(S===void 0)continue;S.updateMatrix&&S.updateMatrix();const P=n._createAnimationTracks(S,E,I,k,T);if(P)for(let B=0;B<P.length;B++)w.push(P[B])}return new ql(o,void 0,w)})}createNodeMesh(i){const t=this.json,n=this,r=t.nodes[i];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let c=0,u=r.weights.length;c<u;c++)l.morphTargetInfluences[c]=r.weights[c]}),a})}loadNode(i){const t=this.json,n=this,r=t.nodes[i],o=n._loadNodeShallow(i),a=[],l=r.children||[];for(let u=0,d=l.length;u<d;u++)a.push(n.getDependency("node",l[u]));const c=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([o,Promise.all(a),c]).then(function(u){const d=u[0],f=u[1],p=u[2];p!==null&&d.traverse(function(g){g.isSkinnedMesh&&g.bind(p,AG)});for(let g=0,m=f.length;g<m;g++)d.add(f[g]);return d})}_loadNodeShallow(i){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[i]!==void 0)return this.nodeCache[i];const o=t.nodes[i],a=o.name?r.createUniqueName(o.name):"",l=[],c=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(i)});return c&&l.push(c),o.camera!==void 0&&l.push(r.getDependency("camera",o.camera).then(function(u){return r._getNodeRef(r.cameraCache,o.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(i)}).forEach(function(u){l.push(u)}),this.nodeCache[i]=Promise.all(l).then(function(u){let d;if(o.isBone===!0?d=new jv:u.length>1?d=new Fr:u.length===1?d=u[0]:d=new ne,d!==u[0])for(let f=0,p=u.length;f<p;f++)d.add(u[f]);if(o.name&&(d.userData.name=o.name,d.name=a),Fc(d,o),o.extensions&&Mh(n,d,o),o.matrix!==void 0){const f=new le;f.fromArray(o.matrix),d.applyMatrix4(f)}else o.translation!==void 0&&d.position.fromArray(o.translation),o.rotation!==void 0&&d.quaternion.fromArray(o.rotation),o.scale!==void 0&&d.scale.fromArray(o.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=i,d}),this.nodeCache[i]}loadScene(i){const t=this.extensions,n=this.json.scenes[i],r=this,o=new Fr;n.name&&(o.name=r.createUniqueName(n.name)),Fc(o,n),n.extensions&&Mh(t,o,n);const a=n.nodes||[],l=[];for(let c=0,u=a.length;c<u;c++)l.push(r.getDependency("node",a[c]));return Promise.all(l).then(function(c){for(let d=0,f=c.length;d<f;d++)o.add(c[d]);const u=d=>{const f=new Map;for(const[p,g]of r.associations)(p instanceof mt||p instanceof At)&&f.set(p,g);return d.traverse(p=>{const g=r.associations.get(p);g!=null&&f.set(p,g)}),f};return r.associations=u(o),o})}_createAnimationTracks(i,t,n,r,o){const a=[],l=i.name?i.name:i.uuid,c=[];xc[o.path]===xc.weights?i.traverse(function(p){p.morphTargetInfluences&&c.push(p.name?p.name:p.uuid)}):c.push(l);let u;switch(xc[o.path]){case xc.weights:u=Lw;break;case xc.rotation:u=Wv;break;case xc.position:case xc.scale:u=Vv;break;default:switch(n.itemSize){case 1:u=Lw;break;case 2:case 3:default:u=Vv;break}break}const d=r.interpolation!==void 0?uG[r.interpolation]:PC,f=this._getArrayFromAccessor(n);for(let p=0,g=c.length;p<g;p++){const m=new u(c[p]+"."+xc[o.path],t.array,f,d);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),a.push(m)}return a}_getArrayFromAccessor(i){let t=i.array;if(i.normalized){const n=ex(t.constructor),r=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o++)r[o]=t[o]*n;t=r}return t}_createCubicSplineTrackInterpolant(i){i.createInterpolant=function(n){const r=this instanceof Wv?hG:xk;return new r(this.times,this.values,this.getValueSize()/3,n)},i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function yG(s,i,t){const n=i.attributes,r=new Cn;if(n.POSITION!==void 0){const l=t.json.accessors[n.POSITION],c=l.min,u=l.max;if(c!==void 0&&u!==void 0){if(r.set(new x(c[0],c[1],c[2]),new x(u[0],u[1],u[2])),l.normalized){const d=ex(af[l.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=i.targets;if(o!==void 0){const l=new x,c=new x;for(let u=0,d=o.length;u<d;u++){const f=o[u];if(f.POSITION!==void 0){const p=t.json.accessors[f.POSITION],g=p.min,m=p.max;if(g!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(m[2]))),p.normalized){const A=ex(af[p.componentType]);c.multiplyScalar(A)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}s.boundingBox=r;const a=new hc;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,s.boundingSphere=a}function oI(s,i,t){const n=i.attributes,r=[];function o(a,l){return t.getDependency("accessor",a).then(function(c){s.setAttribute(l,c)})}for(const a in n){const l=$w[a]||a.toLowerCase();l in s.attributes||r.push(o(n[a],l))}if(i.indices!==void 0&&!s.index){const a=t.getDependency("accessor",i.indices).then(function(l){s.setIndex(l)});r.push(a)}return g1.workingColorSpace!==zi&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${g1.workingColorSpace}" not supported.`),Fc(s,i),yG(s,i,t),Promise.all(r).then(function(){return i.targets!==void 0?fG(s,i.targets,t):s})}var bG=function(){var s="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",i="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var r=WebAssembly.validate(t)?i:s,o,a=WebAssembly.instantiate(l(r),{}).then(function(b){o=b.instance,o.exports.__wasm_call_ctors()});function l(b){for(var _=new Uint8Array(b.length),w=0;w<b.length;++w){var S=b.charCodeAt(w);_[w]=S>96?S-97:S>64?S-39:S+4}for(var E=0,w=0;w<b.length;++w)_[E++]=_[w]<60?n[_[w]]:(_[w]-60)*64+_[++w];return _.buffer.slice(0,E)}function c(b,_,w,S,E,I){var k=o.exports.sbrk,T=w+3&-4,P=k(T*S),B=k(E.length),M=new Uint8Array(o.exports.memory.buffer);M.set(E,B);var U=b(P,w,S,B,E.length);if(U==0&&I&&I(P,T,S),_.set(M.subarray(P,P+w*S)),k(P-k(0)),U!=0)throw new Error("Malformed buffer data: "+U)}var u={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},d={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},f=[],p=0;function g(b){var _={object:new Worker(b),pending:0,requests:{}};return _.object.onmessage=function(w){var S=w.data;_.pending-=S.count,_.requests[S.id][S.action](S.value),delete _.requests[S.id]},_}function m(b){for(var _="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(l(r))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+y.toString(),w=new Blob([_],{type:"text/javascript"}),S=URL.createObjectURL(w),E=0;E<b;++E)f[E]=g(S);URL.revokeObjectURL(S)}function A(b,_,w,S,E){for(var I=f[0],k=1;k<f.length;++k)f[k].pending<I.pending&&(I=f[k]);return new Promise(function(T,P){var B=new Uint8Array(w),M=p++;I.pending+=b,I.requests[M]={resolve:T,reject:P},I.object.postMessage({id:M,count:b,size:_,source:B,mode:S,filter:E},[B.buffer])})}function y(b){a.then(function(){var _=b.data;try{var w=new Uint8Array(_.count*_.size);c(o.exports[_.mode],w,_.count,_.size,_.source,o.exports[_.filter]),self.postMessage({id:_.id,count:_.count,action:"resolve",value:w},[w.buffer])}catch(S){self.postMessage({id:_.id,count:_.count,action:"reject",value:S})}})}return{ready:a,supported:!0,useWorkers:function(b){m(b)},decodeVertexBuffer:function(b,_,w,S,E){c(o.exports.meshopt_decodeVertexBuffer,b,_,w,S,o.exports[u[E]])},decodeIndexBuffer:function(b,_,w,S){c(o.exports.meshopt_decodeIndexBuffer,b,_,w,S)},decodeIndexSequence:function(b,_,w,S){c(o.exports.meshopt_decodeIndexSequence,b,_,w,S)},decodeGltfBuffer:function(b,_,w,S,E,I){c(o.exports[d[E]],b,_,w,S,o.exports[u[I]])},decodeGltfBufferAsync:function(b,_,w,S,E){return f.length>0?A(b,_,w,d[S],u[E]):a.then(function(){var I=new Uint8Array(b*_);return c(o.exports[d[S]],I,b,_,w,o.exports[u[E]]),I})}}}();const Kb=new WeakMap;class _G extends ch{constructor(i){super(i),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(i){return this.decoderPath=i,this}setDecoderConfig(i){return this.decoderConfig=i,this}setWorkerLimit(i){return this.workerLimit=i,this}load(i,t,n,r){const o=new Lr(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(i,a=>{this.parse(a,t,r)},n,r)}parse(i,t,n=()=>{}){this.decodeDracoFile(i,t,null,null,He).catch(n)}decodeDracoFile(i,t,n,r,o=zi,a=()=>{}){const l={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:o};return this.decodeGeometry(i,l).then(t).catch(a)}decodeGeometry(i,t){const n=JSON.stringify(t);if(Kb.has(i)){const c=Kb.get(i);if(c.key===n)return c.promise;if(i.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const o=this.workerNextTaskID++,a=i.byteLength,l=this._getWorker(o,a).then(c=>(r=c,new Promise((u,d)=>{r._callbacks[o]={resolve:u,reject:d},r.postMessage({type:"decode",id:o,taskConfig:t,buffer:i},[i])}))).then(c=>this._createGeometry(c.geometry));return l.catch(()=>!0).then(()=>{r&&o&&this._releaseTask(r,o)}),Kb.set(i,{key:n,promise:l}),l}_createGeometry(i){const t=new Vt;i.index&&t.setIndex(new Je(i.index.array,1));for(let n=0;n<i.attributes.length;n++){const r=i.attributes[n],o=r.name,a=r.array,l=r.itemSize,c=new Je(a,l);o==="color"&&(this._assignVertexColorSpace(c,r.vertexColorSpace),c.normalized=!(a instanceof Float32Array)),t.setAttribute(o,c)}return t}_assignVertexColorSpace(i,t){if(t!==He)return;const n=new xe;for(let r=0,o=i.count;r<o;r++)n.fromBufferAttribute(i,r).convertSRGBToLinear(),i.setXYZ(r,n.r,n.g,n.b)}_loadLibrary(i,t){const n=new Lr(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,o)=>{n.load(i,r,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const i=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return i?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];i||(this.decoderConfig.wasmBinary=n[1]);const o=wG.toString(),a=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(i,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(o){const a=o.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,o){return r._taskLoad>o._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[i]=t,n._taskLoad+=t,n})}_releaseTask(i,t){i._taskLoad-=i._taskCosts[t],delete i._callbacks[t],delete i._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(i=>i._taskLoad))}dispose(){for(let i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function wG(){let s,i;onmessage=function(a){const l=a.data;switch(l.type){case"init":s=l.decoderConfig,i=new Promise(function(d){s.onModuleLoaded=function(f){d({draco:f})},DracoDecoderModule(s)});break;case"decode":const c=l.buffer,u=l.taskConfig;i.then(d=>{const f=d.draco,p=new f.Decoder;try{const g=t(f,p,new Int8Array(c),u),m=g.attributes.map(A=>A.array.buffer);g.index&&m.push(g.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:g},m)}catch(g){console.error(g),self.postMessage({type:"error",id:l.id,error:g.message})}finally{f.destroy(p)}});break}};function t(a,l,c,u){const d=u.attributeIDs,f=u.attributeTypes;let p,g;const m=l.GetEncodedGeometryType(c);if(m===a.TRIANGULAR_MESH)p=new a.Mesh,g=l.DecodeArrayToMesh(c,c.byteLength,p);else if(m===a.POINT_CLOUD)p=new a.PointCloud,g=l.DecodeArrayToPointCloud(c,c.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const A={index:null,attributes:[]};for(const y in d){const b=self[f[y]];let _,w;if(u.useUniqueIDs)w=d[y],_=l.GetAttributeByUniqueId(p,w);else{if(w=l.GetAttributeId(p,a[d[y]]),w===-1)continue;_=l.GetAttribute(p,w)}const S=r(a,l,p,y,b,_);y==="color"&&(S.vertexColorSpace=u.vertexColorSpace),A.attributes.push(S)}return m===a.TRIANGULAR_MESH&&(A.index=n(a,l,p)),a.destroy(p),A}function n(a,l,c){const d=c.num_faces()*3,f=d*4,p=a._malloc(f);l.GetTrianglesUInt32Array(c,f,p);const g=new Uint32Array(a.HEAPF32.buffer,p,d).slice();return a._free(p),{array:g,itemSize:1}}function r(a,l,c,u,d,f){const p=f.num_components(),m=c.num_points()*p,A=m*d.BYTES_PER_ELEMENT,y=o(a,d),b=a._malloc(A);l.GetAttributeDataArrayForAllPoints(c,f,y,A,b);const _=new d(a.HEAPF32.buffer,b,m).slice();return a._free(b),{name:u,array:_,itemSize:p}}function o(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class xG{constructor(i=4){this.pool=i,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(i){if(!this.workers[i]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,i)),this.workers[i]=t}}_getIdleWorker(){for(let i=0;i<this.pool;i++)if(!(this.workerStatus&1<<i))return i;return-1}_onMessage(i,t){const n=this.workersResolve[i];if(n&&n(t),this.queue.length){const{resolve:r,msg:o,transfer:a}=this.queue.shift();this.workersResolve[i]=r,this.workers[i].postMessage(o,a)}else this.workerStatus^=1<<i}setWorkerCreator(i){this.workerCreator=i}setWorkerLimit(i){this.pool=i}postMessage(i,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(i,t)):this.queue.push({resolve:n,msg:i,transfer:t})})}dispose(){this.workers.forEach(i=>i.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const CG=0,aI=2,SG=1,lI=2,EG=0,IG=1,TG=10,RG=0,Ck=9,Sk=15,Ek=16,Ik=22,Tk=37,Rk=43,Bk=76,Pk=83,Mk=97,kk=100,Dk=103,Ok=109,Lk=165,Fk=166;class BG{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class dp{constructor(i,t,n,r){this._dataView=new DataView(i.buffer,i.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const i=this._dataView.getUint8(this._offset);return this._offset+=1,i}_nextUint16(){const i=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,i}_nextUint32(){const i=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,i}_nextUint64(){const i=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,i}_nextInt32(){const i=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,i}_skip(i){return this._offset+=i,this}_scan(i,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<i;)r++,this._offset++;return r<i&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const Os=[171,75,84,88,32,50,48,187,13,10,26,10];function cI(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function PG(s){const i=new Uint8Array(s.buffer,s.byteOffset,Os.length);if(i[0]!==Os[0]||i[1]!==Os[1]||i[2]!==Os[2]||i[3]!==Os[3]||i[4]!==Os[4]||i[5]!==Os[5]||i[6]!==Os[6]||i[7]!==Os[7]||i[8]!==Os[8]||i[9]!==Os[9]||i[10]!==Os[10]||i[11]!==Os[11])throw new Error("Missing KTX 2.0 identifier.");const t=new BG,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new dp(s,Os.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const o=r._nextUint32();t.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint32(),d=r._nextUint64(),f=r._nextUint64(),p=new dp(s,Os.length+n,3*o*8,!0);for(let L=0;L<o;L++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const g=new dp(s,a,l,!0),m={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},A=(m.descriptorBlockSize/4-6)/4;for(let L=0;L<A;L++){const V={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&V.channelType?(V.sampleLower=g._nextInt32(),V.sampleUpper=g._nextInt32()):(V.sampleLower=g._nextUint32(),V.sampleUpper=g._nextUint32()),m.samples[L]=V}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const y=new dp(s,c,u,!0);for(;y._offset<u;){const L=y._nextUint32(),V=y._scan(L),te=cI(V),K=y._scan(L-V.byteLength);t.keyValue[te]=te.match(/^ktx/i)?cI(K):K,y._offset%4&&y._skip(4-y._offset%4)}if(f<=0)return t;const b=new dp(s,d,f,!0),_=b._nextUint16(),w=b._nextUint16(),S=b._nextUint32(),E=b._nextUint32(),I=b._nextUint32(),k=b._nextUint32(),T=[];for(let L=0;L<o;L++)T.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const P=d+b._offset,B=P+S,M=B+E,U=M+I,G=new Uint8Array(s.buffer,s.byteOffset+P,S),W=new Uint8Array(s.buffer,s.byteOffset+B,E),Y=new Uint8Array(s.buffer,s.byteOffset+M,I),D=new Uint8Array(s.buffer,s.byteOffset+U,k);return t.globalData={endpointCount:_,selectorCount:w,imageDescs:T,endpointsData:G,selectorsData:W,tablesData:Y,extendedData:D},t}let Jb,Cl,tx;const Zb={env:{emscripten_notify_memory_growth:function(s){tx=new Uint8Array(Cl.exports.memory.buffer)}}};class MG{init(){return Jb||(Jb=typeof fetch<"u"?fetch("data:application/wasm;base64,"+hI).then(i=>i.arrayBuffer()).then(i=>WebAssembly.instantiate(i,Zb)).then(this._init):WebAssembly.instantiate(Buffer.from(hI,"base64"),Zb).then(this._init),Jb)}_init(i){Cl=i.instance,Zb.env.emscripten_notify_memory_growth(0)}decode(i,t=0){if(!Cl)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=i.byteLength,r=Cl.exports.malloc(n);tx.set(i,r),t=t||Number(Cl.exports.ZSTD_findDecompressedSize(r,n));const o=Cl.exports.malloc(t),a=Cl.exports.ZSTD_decompress(o,t,r,n),l=tx.slice(o,o+a);return Cl.exports.free(r),Cl.exports.free(o),l}}const hI="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",$b=new WeakMap;let e_=0,t_;class Ga extends ch{constructor(i){super(i),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new xG,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(i){return this.transcoderPath=i,this}setWorkerLimit(i){return this.workerPool.setWorkerLimit(i),this}async detectSupportAsync(i){return this.workerConfig={astcSupported:await i.hasFeatureAsync("texture-compression-astc"),etc1Supported:await i.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await i.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await i.hasFeatureAsync("texture-compression-bc"),bptcSupported:await i.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await i.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(i){return i.isWebGPURenderer===!0?this.workerConfig={astcSupported:i.hasFeature("texture-compression-astc"),etc1Supported:i.hasFeature("texture-compression-etc1"),etc2Supported:i.hasFeature("texture-compression-etc2"),dxtSupported:i.hasFeature("texture-compression-bc"),bptcSupported:i.hasFeature("texture-compression-bptc"),pvrtcSupported:i.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:i.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:i.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:i.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:i.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:i.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:i.extensions.has("WEBGL_compressed_texture_pvrtc")||i.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},i.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const i=new Lr(this.manager);i.setPath(this.transcoderPath),i.setWithCredentials(this.withCredentials);const t=i.loadAsync("basis_transcoder.js"),n=new Lr(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([o,a])=>{const l=Ga.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(Ga.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ga.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ga.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),d=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:d},[d]),u})}),e_>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),e_++}return this.transcoderPending}load(i,t,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new Lr(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(i,a=>{if($b.has(a))return $b.get(a).promise.then(t).catch(r);this._createTexture(a).then(l=>t?t(l):null).catch(r)},n,r)}_createTextureFrom(i,t){const{faces:n,width:r,height:o,format:a,type:l,error:c,dfdFlags:u}=i;if(l==="error")return Promise.reject(c);let d;if(t.faceCount===6)d=new aF(n,a,mi);else{const f=n[0].mipmaps;d=t.layerCount>1?new lF(f,r,o,t.layerCount,a,mi):new nf(f,r,o,a,mi)}return d.minFilter=n[0].mipmaps.length===1?Mt:ym,d.magFilter=Mt,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=Uk(t),d.premultiplyAlpha=!!(u&SG),d}async _createTexture(i,t={}){const n=PG(new Uint8Array(i));if(n.vkFormat!==RG)return DG(n);const r=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:i,taskConfig:r},[i])).then(a=>this._createTextureFrom(a.data,n));return $b.set(i,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),e_--,this}}Ga.BasisFormat={ETC1S:0,UASTC_4x4:1};Ga.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Ga.EngineFormat={RGBAFormat:qi,RGBA_ASTC_4x4_Format:ZL,RGBA_BPTC_Format:$L,RGBA_ETC2_EAC_Format:eF,RGBA_PVRTC_4BPPV1_Format:tF,RGBA_S3TC_DXT5_Format:iF,RGB_ETC1_Format:nF,RGB_ETC2_Format:sF,RGB_PVRTC_4BPPV1_Format:rF,RGB_S3TC_DXT1_Format:oF};Ga.BasisWorker=function(){let s,i,t;const n=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(m){const A=m.data;switch(A.type){case"init":s=A.config,a(A.transcoderBinary);break;case"transcode":i.then(()=>{try{const{faces:y,buffers:b,width:_,height:w,hasAlpha:S,format:E,dfdFlags:I}=l(A.buffer);self.postMessage({type:"transcode",id:A.id,faces:y,width:_,height:w,hasAlpha:S,format:E,dfdFlags:I},b)}catch(y){console.error(y),self.postMessage({type:"error",id:A.id,error:y.message})}});break}});function a(m){i=new Promise(A=>{t={wasmBinary:m,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(m){const A=new t.KTX2File(new Uint8Array(m));function y(){A.close(),A.delete()}if(!A.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const b=A.isUASTC()?o.UASTC_4x4:o.ETC1S,_=A.getWidth(),w=A.getHeight(),S=A.getLayers()||1,E=A.getLevels(),I=A.getFaces(),k=A.getHasAlpha(),T=A.getDFDFlags(),{transcoderFormat:P,engineFormat:B}=f(b,_,w,k);if(!_||!w||!E)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const M=[],U=[];for(let G=0;G<I;G++){const W=[];for(let Y=0;Y<E;Y++){const D=[];let L,V;for(let K=0;K<S;K++){const ue=A.getImageLevelInfo(Y,K,G);G===0&&Y===0&&K===0&&(ue.origWidth%4!==0||ue.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),E>1?(L=ue.origWidth,V=ue.origHeight):(L=ue.width,V=ue.height);const de=new Uint8Array(A.getImageTranscodedSizeInBytes(Y,K,0,P));if(!A.transcodeImage(de,Y,K,G,P,0,-1,-1))throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");D.push(de)}const te=g(D);W.push({data:te,width:L,height:V}),U.push(te.buffer)}M.push({mipmaps:W,width:_,height:w,format:B})}return y(),{faces:M,buffers:U,width:_,height:w,hasAlpha:k,format:B,dfdFlags:T}}const c=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=c.sort(function(m,A){return m.priorityETC1S-A.priorityETC1S}),d=c.sort(function(m,A){return m.priorityUASTC-A.priorityUASTC});function f(m,A,y,b){let _,w;const S=m===o.ETC1S?u:d;for(let E=0;E<S.length;E++){const I=S[E];if(s[I.if]&&I.basisFormat.includes(m)&&!(b&&I.transcoderFormat.length<2)&&!(I.needsPowerOfTwo&&!(p(A)&&p(y))))return _=I.transcoderFormat[b?1:0],w=I.engineFormat[b?1:0],{transcoderFormat:_,engineFormat:w}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),_=r.RGBA32,w=n.RGBAFormat,{transcoderFormat:_,engineFormat:w}}function p(m){return m<=2?!0:(m&m-1)===0&&m!==0}function g(m){if(m.length===1)return m[0];let A=0;for(let _=0;_<m.length;_++){const w=m[_];A+=w.byteLength}const y=new Uint8Array(A);let b=0;for(let _=0;_<m.length;_++){const w=m[_];y.set(w,b),b+=w.byteLength}return y}};const kG=new Set([qi,Md,qc]),i_={[Ok]:qi,[Mk]:qi,[Tk]:qi,[Rk]:qi,[Dk]:Md,[Pk]:Md,[Ek]:Md,[Ik]:Md,[kk]:qc,[Bk]:qc,[Sk]:qc,[Ck]:qc,[Fk]:m1,[Lk]:m1},n_={[Ok]:Ao,[Mk]:$n,[Tk]:mi,[Rk]:mi,[Dk]:Ao,[Pk]:$n,[Ek]:mi,[Ik]:mi,[kk]:Ao,[Bk]:$n,[Sk]:mi,[Ck]:mi,[Fk]:mi,[Lk]:mi};async function DG(s){const{vkFormat:i}=s;if(i_[i]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===aI&&(t_||(t_=new Promise(async o=>{const a=new MG;await a.init(),o(a)})),t=await t_);const n=[];for(let o=0;o<s.levels.length;o++){const a=Math.max(1,s.pixelWidth>>o),l=Math.max(1,s.pixelHeight>>o),c=s.pixelDepth?Math.max(1,s.pixelDepth>>o):0,u=s.levels[o];let d;if(s.supercompressionScheme===CG)d=u.levelData;else if(s.supercompressionScheme===aI)d=t.decode(u.levelData,u.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let f;n_[i]===Ao?f=new Float32Array(d.buffer,d.byteOffset,d.byteLength/Float32Array.BYTES_PER_ELEMENT):n_[i]===$n?f=new Uint16Array(d.buffer,d.byteOffset,d.byteLength/Uint16Array.BYTES_PER_ELEMENT):f=d,n.push({data:f,width:a,height:l,depth:c})}let r;if(kG.has(i_[i]))r=s.pixelDepth===0?new Uf(n[0].data,s.pixelWidth,s.pixelHeight):new cF(n[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new nf(n,s.pixelWidth,s.pixelHeight)}return r.mipmaps=n,r.type=n_[i],r.format=i_[i],r.colorSpace=Uk(s),r.needsUpdate=!0,Promise.resolve(r)}function Uk(s){const i=s.dataFormatDescriptor[0];return i.colorPrimaries===IG?i.transferFunction===lI?He:zi:i.colorPrimaries===TG?i.transferFunction===lI?hF:uF:i.colorPrimaries===EG?xu:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${i.colorPrimaries}"`),xu)}let ey="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",_S="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";fetch(ey+"draco_decoder.js",{method:"head"}).catch(s=>{ey="./include/draco/",_S="./include/ktx2/"});function OG(s){ey=s}function LG(s){_S=s}let Cd,yv,Sd;function wS(s){return Cd||(Cd=new _G,Cd.setDecoderPath(ey),Cd.setDecoderConfig({type:"js"})),Sd||(Sd=new Ga,Sd.setTranscoderPath(_S)),yv||(yv=bG),s?Sd.detectSupport(s):s!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:Cd,ktx2Loader:Sd,meshoptDecoder:yv}}function FG(s){s.dracoLoader||s.setDRACOLoader(Cd),s.ktx2Loader||s.setKTX2Loader(Sd),s.meshoptDecoder||s.setMeshoptDecoder(yv)}wm("debugprogressive");function wm(s){const t=new URL(window.location.href).searchParams.get(s);return t==null||t==="0"||t==="false"?!1:t===""?!0:t}function UG(s,i){if(i===void 0||i.startsWith("./")||i.startsWith("http")||s===void 0)return i;const t=s.lastIndexOf("/");if(t>=0){const n=s.substring(0,t+1);for(;n.endsWith("/")&&i.startsWith("/");)i=i.substring(1);return n+i}return i}let fp;function NG(){return fp!==void 0||(fp=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),wm("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",fp)),fp}const ix=Symbol("needle:raycast-mesh");function xm(s){return(s==null?void 0:s[ix])instanceof Vt?s[ix]:null}function zG(s,i){if((s.type==="Mesh"||s.type==="SkinnedMesh")&&!xm(s)){const n=QG(i);n.userData={isRaycastMesh:!0},s[ix]=n}}function QG(s){const i=new Vt;for(const t in s.attributes)i.setAttribute(t,s.getAttribute(t));return i.setIndex(s.getIndex()),i}const Uc=new Array,kl="NEEDLE_progressive",ni=wm("debugprogressive"),s_=Symbol("needle-progressive-texture"),sg=new Map,nx=new Set;if(ni){let n=function(){s+=1,console.log("Toggle LOD level",s,sg),sg.forEach((r,o)=>{for(const a of r.keys){const l=o[a];if(l!=null){if(l.isBufferGeometry===!0){const c=pt.getMeshLODInformation(l),u=c?Math.min(s,c.lods.length):0;o["DEBUG:LOD"]=s,pt.assignMeshLOD(o,u),c&&(i=Math.max(i,c.lods.length-1))}else if(o.isMaterial===!0){o["DEBUG:LOD"]=s,pt.assignTextureLOD(o,s);break}}}}),s>=i&&(s=-1)},s=-1,i=2,t=!1;window.addEventListener("keyup",r=>{r.key==="p"&&n(),r.key==="w"&&(t=!t,nx&&nx.forEach(o=>{o.name!="BackgroundCubeMaterial"&&o.glyphMap==null&&"wireframe"in o&&(o.wireframe=t)}))})}function uI(s,i,t){var r;if(!ni)return;sg.has(s)||sg.set(s,{keys:[],sourceId:t});const n=sg.get(s);((r=n==null?void 0:n.keys)==null?void 0:r.includes(i))==!1&&n.keys.push(i)}const sn=class{constructor(i,t){h(this,"parser");h(this,"url");h(this,"_isLoadingMesh");h(this,"loadMesh",i=>{var n,r;if(this._isLoadingMesh)return null;const t=(r=(n=this.parser.json.meshes[i])==null?void 0:n.extensions)==null?void 0:r[kl];return t?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",i).then(o=>{var a;return this._isLoadingMesh=!1,o&&sn.registerMesh(this.url,t.guid,o,(a=t.lods)==null?void 0:a.length,void 0,t),o})):null});ni&&console.log("Progressive extension registered for",t),this.parser=i,this.url=t}get name(){return kl}static getMeshLODInformation(i){const t=this.getAssignedLODInformation(i);return t!=null&&t.key?this.lodInfos.get(t.key):null}static getMaterialMinMaxLODsCount(i,t){const n=this,r="LODS:minmax",o=i[r];if(o!=null)return o;if(t||(t={min_count:1/0,max_count:0,lods:[]}),Array.isArray(i)){for(const l of i)this.getMaterialMinMaxLODsCount(l,t);return i[r]=t,t}if(ni==="verbose"&&console.log("getMaterialMinMaxLODsCount",i),i.type==="ShaderMaterial"||i.type==="RawShaderMaterial"){const l=i;for(const c of Object.keys(l.uniforms)){const u=l.uniforms[c].value;(u==null?void 0:u.isTexture)===!0&&a(u,t)}}else if(i.isMaterial)for(const l of Object.keys(i)){const c=i[l];(c==null?void 0:c.isTexture)===!0&&a(c,t)}return i[r]=t,t;function a(l,c){const u=n.getAssignedLODInformation(l);if(u){const d=n.lodInfos.get(u.key);if(d&&d.lods){c.min_count=Math.min(c.min_count,d.lods.length),c.max_count=Math.max(c.max_count,d.lods.length);for(let f=0;f<d.lods.length;f++){const p=d.lods[f];p.width&&(c.lods[f]=c.lods[f]||{min_height:1/0,max_height:0},c.lods[f].min_height=Math.min(c.lods[f].min_height,p.height),c.lods[f].max_height=Math.max(c.lods[f].max_height,p.height))}}}}}static hasLODLevelAvailable(i,t){var o;if(Array.isArray(i)){for(const a of i)if(this.hasLODLevelAvailable(a,t))return!0;return!1}if(i.isMaterial===!0){for(const a of Object.keys(i)){const l=i[a];if(l&&l.isTexture&&this.hasLODLevelAvailable(l,t))return!0}return!1}else if(i.isGroup===!0){for(const a of i.children)if(a.isMesh===!0&&this.hasLODLevelAvailable(a,t))return!0}let n,r;if(i.isMesh?n=i.geometry:(i.isBufferGeometry||i.isTexture)&&(n=i),n&&(o=n==null?void 0:n.userData)!=null&&o.LODS){const a=n.userData.LODS;if(r=this.lodInfos.get(a.key),t===void 0)return r!=null;if(r)return Array.isArray(r.lods)?t<r.lods.length:t===0}return!1}static assignMeshLOD(i,t){var n;if(!i)return Promise.resolve(null);if(i instanceof Z||i.isMesh===!0){const r=i.geometry,o=this.getAssignedLODInformation(r);if(!o)return Promise.resolve(null);for(const a of Uc)(n=a.onBeforeGetLODMesh)==null||n.call(a,i,t);return i["LOD:requested level"]=t,sn.getOrLoadLOD(r,t).then(a=>{if(i["LOD:requested level"]===t){if(delete i["LOD:requested level"],Array.isArray(a)){const l=o.index||0;a=a[l]}a&&r!=a&&((a==null?void 0:a.isBufferGeometry)?(i.geometry=a,ni&&uI(i,"geometry",o.url)):ni&&console.error("Invalid LOD geometry",a))}return a}).catch(a=>(console.error("Error loading mesh LOD",i,a),null))}else ni&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",i);return Promise.resolve(null)}static assignTextureLOD(i,t=0){if(!i)return Promise.resolve(null);if(i instanceof mt||i.isMaterial===!0){const n=i,r=[],o=new Array;if(ni&&nx.add(n),n.uniforms&&n.isRawShaderMaterial||n.isShaderMaterial===!0){const a=n;for(const l of Object.keys(a.uniforms)){const c=a.uniforms[l].value;if((c==null?void 0:c.isTexture)===!0){const u=this.assignTextureLODForSlot(c,t,n,l);r.push(u),o.push(l)}}}else for(const a of Object.keys(n)){const l=n[a];if((l==null?void 0:l.isTexture)===!0){const c=this.assignTextureLODForSlot(l,t,n,a);r.push(c),o.push(a)}}return Promise.all(r).then(a=>{const l=new Array;for(let c=0;c<a.length;c++){const u=a[c],d=o[c];u&&u.isTexture===!0?l.push({material:n,slot:d,texture:u,level:t}):l.push({material:n,slot:d,texture:null,level:t})}return l})}if(i instanceof At||i.isTexture===!0){const n=i;return this.assignTextureLODForSlot(n,t,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(i,t,n,r){return(i==null?void 0:i.isTexture)!==!0?Promise.resolve(null):r==="glyphMap"?Promise.resolve(i):sn.getOrLoadLOD(i,t).then(o=>{if(Array.isArray(o))return null;if((o==null?void 0:o.isTexture)===!0){if(o!=i){if(n&&r){const a=n[r];if(a){const l=this.getAssignedLODInformation(a);if(l&&(l==null?void 0:l.level)<t)return ni==="verbose"&&console.warn("Assigned texture level is already higher: ",l.level,t,n,a,o),null}n[r]=o}if(ni&&r&&n){const a=this.getAssignedLODInformation(i);a&&uI(n,r,a.url)}}return o}else ni=="verbose"&&console.warn("No LOD found for",i,t);return null}).catch(o=>(console.error("Error loading LOD",i,o),null))}afterRoot(i){var t,n;return ni&&console.log("AFTER",this.url,i),(t=this.parser.json.textures)==null||t.forEach((r,o)=>{var a;if(r!=null&&r.extensions){const l=r==null?void 0:r.extensions[kl];if(l){if(!l.lods){ni&&console.warn("Texture has no LODs",l);return}let c=!1;for(const u of this.parser.associations.keys())if(u.isTexture===!0){const d=this.parser.associations.get(u);(d==null?void 0:d.textures)===o&&(c=!0,sn.registerTexture(this.url,u,(a=l.lods)==null?void 0:a.length,o,l))}c||this.parser.getDependency("texture",o).then(u=>{var d;u&&sn.registerTexture(this.url,u,(d=l.lods)==null?void 0:d.length,o,l)})}}}),(n=this.parser.json.meshes)==null||n.forEach((r,o)=>{if(r!=null&&r.extensions){const a=r==null?void 0:r.extensions[kl];if(a&&a.lods){for(const l of this.parser.associations.keys())if(l.isMesh){const c=this.parser.associations.get(l);(c==null?void 0:c.meshes)===o&&sn.registerMesh(this.url,a.guid,l,a.lods.length,c.primitives,a)}}}}),null}static async getOrLoadLOD(i,t){var l,c,u,d;const n=ni=="verbose",r=i.userData.LODS;if(!r)return null;const o=r==null?void 0:r.key;let a;if(i.isTexture===!0){const f=i;f.source&&f.source[s_]&&(a=f.source[s_])}if(a||(a=sn.lodInfos.get(o)),a){if(t>0){let g=!1;const m=Array.isArray(a.lods);if(m&&t>=a.lods.length?g=!0:m||(g=!0),g)return this.lowresCache.get(o)}const f=Array.isArray(a.lods)?(l=a.lods[t])==null?void 0:l.path:a.lods;if(!f)return ni&&!a["missing:uri"]&&(a["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+t,a)),null;const p=UG(r.url,f);if(p.endsWith(".glb")||p.endsWith(".gltf")){if(!a.guid)return console.warn("missing pointer for glb/gltf texture",a),null;const g=p+"_"+a.guid,m=this.previouslyLoaded.get(g);if(m!==void 0){n&&console.log(`LOD ${t} was already loading/loaded: ${g}`);let _=await m.catch(S=>(console.error(`Error loading LOD ${t} from ${p}
`,S),null)),w=!1;if(_==null||(_ instanceof At&&i instanceof At?(c=_.image)!=null&&c.data||(u=_.source)!=null&&u.data?_=this.copySettings(i,_):(w=!0,this.previouslyLoaded.delete(g)):_ instanceof Vt&&i instanceof Vt&&((d=_.attributes.position)!=null&&d.array||(w=!0,this.previouslyLoaded.delete(g)))),!w)return _}const A=a,y=new Promise(async(_,w)=>{const S=new rl;FG(S),ni&&(await new Promise(P=>setTimeout(P,1e3)),n&&console.warn("Start loading (delayed) "+p,A.guid));let E=p;if(A&&Array.isArray(A.lods)){const P=A.lods[t];P.hash&&(E+="?v="+P.hash)}const I=await S.loadAsync(E).catch(P=>(console.error(`Error loading LOD ${t} from ${p}
`,P),null));if(!I)return null;const k=I.parser;n&&console.log("Loading finished "+p,A.guid);let T=0;if(I.parser.json.textures){let P=!1;for(const B of I.parser.json.textures){if(B!=null&&B.extensions){const M=B==null?void 0:B.extensions[kl];if(M!=null&&M.guid&&M.guid===A.guid){P=!0;break}}T++}if(P){let B=await k.getDependency("texture",T);return B&&sn.assignLODInformation(r.url,B,o,t,void 0,void 0),n&&console.log('change "'+i.name+'" â†’ "'+B.name+'"',p,T,B,g),i instanceof At&&(B=this.copySettings(i,B)),B&&(B.guid=A.guid),_(B)}else ni&&console.warn("Could not find texture with guid",A.guid,I.parser.json)}if(T=0,I.parser.json.meshes){let P=!1;for(const B of I.parser.json.meshes){if(B!=null&&B.extensions){const M=B==null?void 0:B.extensions[kl];if(M!=null&&M.guid&&M.guid===A.guid){P=!0;break}}T++}if(P){const B=await k.getDependency("mesh",T),M=A;if(n&&console.log(`Loaded Mesh "${B.name}"`,p,T,B,g),B.isMesh===!0){const U=B.geometry;return sn.assignLODInformation(r.url,U,o,t,void 0,M.density),_(U)}else{const U=new Array;for(let G=0;G<B.children.length;G++){const W=B.children[G];if(W.isMesh===!0){const Y=W.geometry;sn.assignLODInformation(r.url,Y,o,t,G,M.density),U.push(Y)}}return _(U)}}else ni&&console.warn("Could not find mesh with guid",A.guid,I.parser.json)}return _(null)});return this.previouslyLoaded.set(g,y),await y}else if(i instanceof At){n&&console.log("Load texture from uri: "+p);const m=await new Xa().loadAsync(p);return m?(m.guid=a.guid,m.flipY=!1,m.needsUpdate=!0,m.colorSpace=i.colorSpace,n&&console.log(a,m)):ni&&console.warn("failed loading",p),m}}else ni&&console.warn(`Can not load LOD ${t}: no LOD info found for "${o}" ${i.name}`,i.type);return null}static assignLODInformation(i,t,n,r,o,a){if(!t)return;t.userData||(t.userData={});const l=new jG(i,n,r,o,a);t.userData.LODS=l}static getAssignedLODInformation(i){var t;return((t=i==null?void 0:i.userData)==null?void 0:t.LODS)||null}static copySettings(i,t){return t=t.clone(),ni&&console.warn(`Copying texture settings
`,i.uuid,`
`,t.uuid),t.offset=i.offset,t.repeat=i.repeat,t.colorSpace=i.colorSpace,t.magFilter=i.magFilter,t.minFilter=i.minFilter,t.wrapS=i.wrapS,t.wrapT=i.wrapT,t.flipY=i.flipY,t.anisotropy=i.anisotropy,t.mipmaps||(t.generateMipmaps=i.generateMipmaps),t}};let pt=sn;h(pt,"registerTexture",(i,t,n,r,o)=>{if(ni&&console.log("> Progressive: register texture",r,t.name,t.uuid,t,o),!t){ni&&console.error("gltf-progressive: Register texture without texture");return}t.source&&(t.source[s_]=o);const a=o.guid;sn.assignLODInformation(i,t,a,n,r,void 0),sn.lodInfos.set(a,o),sn.lowresCache.set(a,t)}),h(pt,"registerMesh",(i,t,n,r,o,a)=>{var u;ni&&console.log("> Progressive: register mesh",o,n.name,a,n.uuid,n);const l=n.geometry;if(!l){ni&&console.warn("gltf-progressive: Register mesh without geometry");return}l.userData||(l.userData={}),sn.assignLODInformation(i,l,t,r,o,a.density),sn.lodInfos.set(t,a);let c=sn.lowresCache.get(t);c?c.push(n.geometry):c=[n.geometry],sn.lowresCache.set(t,c),r>0&&!xm(n)&&zG(n,l);for(const d of Uc)(u=d.onRegisteredNewMesh)==null||u.call(d,n,a)}),h(pt,"lodInfos",new Map),h(pt,"previouslyLoaded",new Map),h(pt,"lowresCache",new Map);class jG{constructor(i,t,n,r,o){h(this,"url");h(this,"key");h(this,"level");h(this,"index");h(this,"density");this.url=i,this.key=t,this.level=n,r!=null&&(this.index=r),o!=null&&(this.density=o)}}const Do=wm("debugprogressive"),GG=wm("noprogressive"),r_=Symbol("Needle:LODSManager"),o_=Symbol("Needle:LODState"),cd=Symbol("Needle:CurrentLOD"),Oo={mesh_lod:-1,texture_lod:-1};var Ui,Tr,Dl,Hy,bf,_f,Vy,Ol;let Xh=(Ui=class{constructor(i,t){h(this,"context");h(this,"renderer");h(this,"projectionScreenMatrix",new le);h(this,"targetTriangleDensity",2e5);h(this,"updateInterval","auto");ji(this,Tr,1);h(this,"pause",!1);h(this,"manual",!1);h(this,"_lodchangedlisteners",[]);ji(this,Dl,void 0);ji(this,Hy,new MP);ji(this,bf,0);ji(this,_f,0);ji(this,Vy,0);ji(this,Ol,0);h(this,"_fpsBuffer",[60,60,60,60,60]);h(this,"_sphere",new hc);h(this,"_tempBox",new Cn);h(this,"_tempBox2",new Cn);h(this,"tempMatrix",new le);h(this,"_tempWorldPosition",new x);h(this,"_tempBoxSize",new x);h(this,"_tempBox2Size",new x);this.renderer=i,this.context={...t}}static getObjectLODState(i){return i[o_]}static addPlugin(i){Uc.push(i)}static removePlugin(i){const t=Uc.indexOf(i);t>=0&&Uc.splice(t,1)}static get(i,t){if(i[r_])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),i[r_];const n=new Ui(i,{engine:"unknown",...t});return i[r_]=n,n}get plugins(){return Uc}addEventListener(i,t){i==="changed"&&this._lodchangedlisteners.push(t)}removeEventListener(i,t){if(i==="changed"){const n=this._lodchangedlisteners.indexOf(t);n>=0&&this._lodchangedlisteners.splice(n,1)}}enable(){if(De(this,Dl))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let i=0;Gi(this,Dl,this.renderer.render);const t=this;wS(this.renderer),this.renderer.render=function(n,r){const o=t.renderer.getRenderTarget();(o==null||"isXRRenderTarget"in o&&o.isXRRenderTarget)&&(i=0,Gi(t,bf,De(t,bf)+1),Gi(t,_f,De(t,Hy).getDelta()),Gi(t,Vy,De(t,Vy)+De(t,_f)),t._fpsBuffer.shift(),t._fpsBuffer.push(1/De(t,_f)),Gi(t,Ol,t._fpsBuffer.reduce((l,c)=>l+c)/t._fpsBuffer.length),Do&&De(t,bf)%200===0&&console.log("FPS",Math.round(De(t,Ol)),"Interval:",De(t,Tr)));const a=i++;De(t,Dl).call(this,n,r),t.onAfterRender(n,r,a)}}disable(){De(this,Dl)&&(this.renderer.render=De(this,Dl),Gi(this,Dl,void 0))}update(i,t){this.internalUpdate(i,t)}onAfterRender(i,t,n){if(this.pause)return;const o=this.renderer.renderLists.get(i,0).opaque;let a=!0;if(o.length===1){const l=o[0].material;(l.name==="EffectMaterial"||l.name==="CopyShader")&&(a=!1)}if((t.parent&&t.parent.type==="CubeCamera"||n>=1&&t.type==="OrthographicCamera")&&(a=!1),a){if(GG||(this.updateInterval==="auto"?De(this,Ol)<40&&De(this,Tr)<10?(Gi(this,Tr,De(this,Tr)+1),Do&&console.warn("â†“ Reducing LOD updates",De(this,Tr),De(this,Ol).toFixed(0))):De(this,Ol)>=60&&De(this,Tr)>1&&(Gi(this,Tr,De(this,Tr)-1),Do&&console.warn("â†‘ Increasing LOD updates",De(this,Tr),De(this,Ol).toFixed(0))):Gi(this,Tr,this.updateInterval),De(this,Tr)>0&&De(this,bf)%De(this,Tr)!=0))return;this.internalUpdate(i,t)}}internalUpdate(i,t){var c,u;const n=this.renderer.renderLists.get(i,0),r=n.opaque;this.projectionScreenMatrix.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);const o=this.targetTriangleDensity;for(const d of r){if(d.material&&(((c=d.geometry)==null?void 0:c.type)==="BoxGeometry"||((u=d.geometry)==null?void 0:u.type)==="BufferGeometry")&&(d.material.name==="SphericalGaussianBlur"||d.material.name=="BackgroundCubeMaterial"||d.material.name==="CubemapFromEquirect"||d.material.name==="EquirectangularToCubeUV")){Do&&(d.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(d.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",d,d.material.name,d.material.type)));continue}switch(d.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(Do==="color"&&d.material&&!d.object.progressive_debug_color){d.object.progressive_debug_color=!0;const p=Math.random()*16777215,g=new Jn({color:p});d.object.material=g}const f=d.object;(f instanceof Z||f.isMesh)&&this.updateLODs(i,t,f,o)}const a=n.transparent;for(const d of a){const f=d.object;(f instanceof Z||f.isMesh)&&this.updateLODs(i,t,f,o)}const l=n.transmissive;for(const d of l){const f=d.object;(f instanceof Z||f.isMesh)&&this.updateLODs(i,t,f,o)}}updateLODs(i,t,n,r){var l,c;n.userData||(n.userData={});let o=n[o_];if(o||(o=new HG,n[o_]=o),o.frames++<2)return;for(const u of Uc)(l=u.onBeforeUpdateLOD)==null||l.call(u,this.renderer,i,t,n);this.calculateLodLevel(t,n,o,r,Oo),Oo.mesh_lod=Math.round(Oo.mesh_lod),Oo.texture_lod=Math.round(Oo.texture_lod),Oo.mesh_lod>=0&&this.loadProgressiveMeshes(n,Oo.mesh_lod);let a=Oo.texture_lod;if(n.material&&a>=0){const u=n["DEBUG:LOD"];u!=null&&(a=u),this.loadProgressiveTextures(n.material,a)}for(const u of Uc)(c=u.onAfterUpdatedLOD)==null||c.call(u,this.renderer,i,t,n,Oo);o.lastLodLevel_Mesh=Oo.mesh_lod,o.lastLodLevel_Texture=Oo.texture_lod}loadProgressiveTextures(i,t){if(!i)return;if(Array.isArray(i)){for(const r of i)this.loadProgressiveTextures(r,t);return}let n=!1;(i[cd]===void 0||t<i[cd])&&(n=!0),n&&(i[cd]=t,pt.assignTextureLOD(i,t).then(r=>{this._lodchangedlisteners.forEach(o=>o({type:"texture",level:t,object:i}))}))}loadProgressiveMeshes(i,t){if(!i)return Promise.resolve(null);if(i[cd]!==t){i[cd]=t;const n=i.geometry;return pt.assignMeshLOD(i,t).then(r=>(r&&i[cd]==t&&n!=i.geometry&&this._lodchangedlisteners.forEach(o=>o({type:"mesh",level:t,object:i})),r))}return Promise.resolve(null)}static isInside(i,t){const n=i.min,r=i.max,o=(n.x+r.x)*.5,a=(n.y+r.y)*.5;return this._tempPtInside.set(o,a,n.z).applyMatrix4(t).z<0}calculateLodLevel(i,t,n,r,o){var y;if(!t){o.mesh_lod=-1,o.texture_lod=-1;return}if(!i){o.mesh_lod=-1,o.texture_lod=-1;return}let l=10+1,c=!1;if(Do&&t["DEBUG:LOD"]!=null)return t["DEBUG:LOD"];const u=pt.getMeshLODInformation(t.geometry),d=u==null?void 0:u.lods,f=d&&d.length>0,p=pt.getMaterialMinMaxLODsCount(t.material),g=(p==null?void 0:p.min_count)!=1/0&&p.min_count>0&&p.max_count>0;if(!f&&!g){o.mesh_lod=0,o.texture_lod=0;return}f||(c=!0,l=0);const m=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let A=t.geometry.boundingBox;if(t.type==="SkinnedMesh"){const b=t;if(!b.boundingBox)b.computeBoundingBox();else if(n.frames%30===0){const _=xm(b),w=b.geometry;_&&(b.geometry=_),b.computeBoundingBox(),b.geometry=w}A=b.boundingBox}if(A&&i.isPerspectiveCamera){const b=i;if(t.geometry.attributes.color&&t.geometry.attributes.color.count<100&&t.geometry.boundingSphere){this._sphere.copy(t.geometry.boundingSphere),this._sphere.applyMatrix4(t.matrixWorld);const B=i.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(B)){o.mesh_lod=0,o.texture_lod=0;return}}if(this._tempBox.copy(A),this._tempBox.applyMatrix4(t.matrixWorld),Ui.isInside(this._tempBox,this.projectionScreenMatrix)){o.mesh_lod=0,o.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&b.fov>70){const B=this._tempBox.min,M=this._tempBox.max;let U=B.x,G=B.y,W=M.x,Y=M.y;const D=2,L=1.5,V=(B.x+M.x)*.5,te=(B.y+M.y)*.5;U=(U-V)*D+V,G=(G-te)*D+te,W=(W-V)*D+V,Y=(Y-te)*D+te;const K=U<0&&W>0?0:Math.min(Math.abs(B.x),Math.abs(M.x)),ue=G<0&&Y>0?0:Math.min(Math.abs(B.y),Math.abs(M.y)),de=Math.max(K,ue);n.lastCentrality=(L-de)*(L-de)*(L-de)}else n.lastCentrality=1;const _=this._tempBox.getSize(this._tempBoxSize);_.multiplyScalar(.5),screen.availHeight>0&&m>0&&_.multiplyScalar(m/screen.availHeight),_.x*=b.aspect;const w=i.matrixWorldInverse,S=this._tempBox2;S.copy(A),S.applyMatrix4(t.matrixWorld),S.applyMatrix4(w);const E=S.getSize(this._tempBox2Size),I=Math.max(E.x,E.y);if(Math.max(_.x,_.y)!=0&&I!=0&&(_.z=E.z/Math.max(E.x,E.y)*Math.max(_.x,_.y)),n.lastScreenCoverage=Math.max(_.x,_.y,_.z),n.lastScreenspaceVolume.copy(_),n.lastScreenCoverage*=n.lastCentrality,Do&&Ui.debugDrawLine){const B=this.tempMatrix.copy(this.projectionScreenMatrix);B.invert();const M=Ui.corner0,U=Ui.corner1,G=Ui.corner2,W=Ui.corner3;M.copy(this._tempBox.min),U.copy(this._tempBox.max),U.x=M.x,G.copy(this._tempBox.max),G.y=M.y,W.copy(this._tempBox.max);const Y=(M.z+W.z)*.5;M.z=U.z=G.z=W.z=Y,M.applyMatrix4(B),U.applyMatrix4(B),G.applyMatrix4(B),W.applyMatrix4(B),Ui.debugDrawLine(M,U,255),Ui.debugDrawLine(M,G,255),Ui.debugDrawLine(U,W,255),Ui.debugDrawLine(G,W,255)}let T=999;if(d&&n.lastScreenCoverage>0){for(let B=0;B<d.length;B++)if(d[B].density/n.lastScreenCoverage<r){T=B;break}}T<l&&(l=T,c=!0)}if(c?o.mesh_lod=l:o.mesh_lod=n.lastLodLevel_Mesh,Do&&o.mesh_lod!=n.lastLodLevel_Mesh){const _=d==null?void 0:d[o.mesh_lod];_&&console.log(`Mesh LOD changed: ${n.lastLodLevel_Mesh} â†’ ${o.mesh_lod} (${_.density.toFixed(0)}) - ${t.name}`)}if(g){const b="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(n.lastLodLevel_Texture<0){if(o.texture_lod=p.max_count-1,Do){const _=p.lods[p.max_count-1];Do&&console.log(`First Texture LOD ${o.texture_lod} (${_.max_height}px) - ${t.name}`)}}else{const _=n.lastScreenspaceVolume.x+n.lastScreenspaceVolume.y+n.lastScreenspaceVolume.z;let w=n.lastScreenCoverage*2;((y=this.context)==null?void 0:y.engine)==="model-viewer"&&(w*=2);const E=m/window.devicePixelRatio*w;for(let I=p.lods.length-1;I>=0;I--){let k=p.lods[I];if(!(b&&k.max_height>=2048)&&!(NG()&&k.max_height>4096)&&k.max_height>E){if(o.texture_lod=I,o.texture_lod<n.lastLodLevel_Texture){const T=k.max_height;Do&&console.log(`Texture LOD changed: ${n.lastLodLevel_Texture} â†’ ${o.texture_lod} = ${T}px 
Screensize: ${E.toFixed(0)}px, Coverage: ${(100*n.lastScreenCoverage).toFixed(2)}%, Volume ${_.toFixed(1)} 
${t.name}`)}break}}}}else o.texture_lod=0}},Tr=new WeakMap,Dl=new WeakMap,Hy=new WeakMap,bf=new WeakMap,_f=new WeakMap,Vy=new WeakMap,Ol=new WeakMap,h(Ui,"debugDrawLine"),h(Ui,"corner0",new x),h(Ui,"corner1",new x),h(Ui,"corner2",new x),h(Ui,"corner3",new x),h(Ui,"_tempPtInside",new x),Ui);class HG{constructor(){h(this,"frames",0);h(this,"lastLodLevel_Mesh",-1);h(this,"lastLodLevel_Texture",-1);h(this,"lastScreenCoverage",0);h(this,"lastScreenspaceVolume",new x);h(this,"lastCentrality",0)}}const dI=Symbol("NEEDLE_mesh_lod"),gA=Symbol("NEEDLE_texture_lod");let pp=null;function Nk(){const s=VG();s&&(s.mapURLs(function(i){return fI(),i}),fI(),pp==null||pp.disconnect(),pp=new MutationObserver(i=>{i.forEach(t=>{t.addedNodes.forEach(n=>{n instanceof HTMLElement&&n.tagName.toLowerCase()==="model-viewer"&&zk(n)})})}),pp.observe(document,{childList:!0,subtree:!0}))}function VG(){if(typeof customElements>"u")return null;const s=customElements.get("model-viewer");return s||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),Nk()}),null)}function fI(){if(typeof document>"u")return;document.querySelectorAll("model-viewer").forEach(i=>{zk(i)})}const pI=new WeakSet;let WG=0;function zk(s){if(!s||pI.has(s))return null;pI.add(s),console.debug("[gltf-progressive] found new model-viewer..."+ ++WG+`
`,s.getAttribute("src"));let i=null,t=null,n=null;for(let r=s;r!=null;r=Object.getPrototypeOf(r)){const o=Object.getOwnPropertySymbols(r),a=o.find(u=>u.toString()=="Symbol(renderer)"),l=o.find(u=>u.toString()=="Symbol(scene)"),c=o.find(u=>u.toString()=="Symbol(needsRender)");!i&&a!=null&&(i=s[a].threeRenderer),!t&&l!=null&&(t=s[l]),!n&&c!=null&&(n=s[c])}if(i&&t){let o=function(){if(n){let a=0,l=setInterval(()=>{if(a++>5){clearInterval(l);return}n==null||n.call(s)},300)}};console.debug("[gltf-progressive] setup model-viewer");const r=Xh.get(i,{engine:"model-viewer"});return Xh.addPlugin(new qG),r.enable(),r.addEventListener("changed",()=>{n==null||n.call(s)}),s.addEventListener("model-visibility",a=>{a.detail.visible&&(n==null||n.call(s))}),s.addEventListener("load",()=>{o()}),()=>{r.disable()}}return null}class qG{constructor(){h(this,"_didWarnAboutMissingUrl",!1)}onBeforeUpdateLOD(i,t,n,r){this.tryParseMeshLOD(t,r),this.tryParseTextureLOD(t,r)}getUrl(i){if(!i)return null;let t=i.getAttribute("src");return t||(t=i.src),t||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",i),this._didWarnAboutMissingUrl=!0),t}tryGetCurrentGLTF(i){return i._currentGLTF}tryGetCurrentModelViewer(i){return i.element}tryParseTextureLOD(i,t){if(t[gA]==!0)return;t[gA]=!0;const n=this.tryGetCurrentGLTF(i),r=this.tryGetCurrentModelViewer(i),o=this.getUrl(r);if(o&&n&&t.material){let l=function(c){var d,f,p;if(c[gA]==!0)return;c[gA]=!0,c.userData&&(c.userData.LOD=-1);const u=Object.keys(c);for(let g=0;g<u.length;g++){const m=u[g],A=c[m];if((A==null?void 0:A.isTexture)===!0){const y=(f=(d=A.userData)==null?void 0:d.associations)==null?void 0:f.textures;if(y==null)continue;const b=n.parser.json.textures[y];if(!b){console.warn("Texture data not found for texture index "+y);continue}if((p=b==null?void 0:b.extensions)!=null&&p[kl]){const _=b.extensions[kl];_&&o&&pt.registerTexture(o,A,_.lods.length,y,_)}}}};const a=t.material;if(Array.isArray(a))for(const c of a)l(c);else l(a)}}tryParseMeshLOD(i,t){var a,l;if(t[dI]==!0)return;t[dI]=!0;const n=this.tryGetCurrentModelViewer(i),r=this.getUrl(n);if(!r)return;const o=(l=(a=t.userData)==null?void 0:a.gltfExtensions)==null?void 0:l[kl];if(o&&r){const c=t.uuid;pt.registerMesh(r,c,t,0,o.lods.length,o)}}}Nk();const Rf=[];function xS(s){Rf.indexOf(s)===-1&&Rf.push(s)}function EK(s){const i=Rf.indexOf(s);i!==-1&&Rf.splice(i,1)}const Bf=[];function Qk(s){Bf.indexOf(s)===-1&&Bf.push(s)}function IK(s){const i=Bf.indexOf(s);i!==-1&&Bf.splice(i,1)}function XG(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:s}));for(let i=0;i<Rf.length;i++)Rf[i](s)}function YG(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:s}));for(let i=0;i<Bf.length;i++)Bf[i](s)}const yn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function jk(s){const i=await fetch(s);if(i.ok)return i.json();throw new Error(i.statusText)}async function KG(s){if(!s)throw new Error("No basePath supplied");return await jk(`${s}/profilesList.json`)}async function JG(s,i,t=null,n=!0){if(!s)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No basePath supplied");const r=await KG(i);let o;if(s.profiles.some(c=>{const u=r[c];return u&&(o={profileId:c,profilePath:`${i}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");const c=r[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${i}/${c.path}`,deprecated:!!c.deprecated}}const a=await jk(o.profilePath);let l;if(n){let c;if(s.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[s.handedness],!c)throw new Error(`No matching handedness, ${s.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const ZG={xAxis:0,yAxis:0,button:0,state:yn.ComponentState.DEFAULT};function $G(s=0,i=0){let t=s,n=i;if(Math.sqrt(s*s+i*i)>1){const a=Math.atan2(i,s);t=Math.cos(a),n=Math.sin(a)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}let e8=class{constructor(i){this.componentProperty=i.componentProperty,this.states=i.states,this.valueNodeName=i.valueNodeName,this.valueNodeProperty=i.valueNodeProperty,this.valueNodeProperty===yn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=i.minNodeName,this.maxNodeName=i.maxNodeName),this.value=0,this.updateFromComponent(ZG)}updateFromComponent({xAxis:i,yAxis:t,button:n,state:r}){const{normalizedXAxis:o,normalizedYAxis:a}=$G(i,t);switch(this.componentProperty){case yn.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case yn.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?a:.5;break;case yn.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case yn.ComponentProperty.STATE:this.valueNodeProperty===yn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},t8=class{constructor(i,t){if(!i||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=i,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const r=new e8(t.visualResponses[n]);this.visualResponses[n]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:yn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(i){if(this.values.state=yn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&i.buttons.length>this.gamepadIndices.button){const t=i.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=yn.ComponentState.PRESSED:(t.touched||this.values.button>yn.ButtonTouchThreshold)&&(this.values.state=yn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&i.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=i.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===yn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>yn.AxisTouchThreshold&&(this.values.state=yn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&i.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=i.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===yn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>yn.AxisTouchThreshold&&(this.values.state=yn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},i8=class{constructor(i,t,n){if(!i)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=i,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[i.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const o=this.layoutDescription.components[r];this.components[r]=new t8(r,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const i=[];return Object.values(this.components).forEach(t=>{i.push(t.data)}),i}updateFromGamepad(){Object.values(this.components).forEach(i=>{i.updateFromGamepad(this.xrInputSource.gamepad)})}};const tn=Q("debuginput");var Kc;(function(s){s.Mouse="mouse",s.Touch="touch",s.Controller="controller",s.Hand="hand"})(Kc||(Kc={}));var gI;(function(s){s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove"})(gI||(gI={}));var mI;(function(s){s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress"})(mI||(mI={}));var dt;(function(s){s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove",s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress"})(dt||(dt={}));class Dc extends PointerEvent{constructor(t,n,r){super(t,r);h(this,"clientZ");h(this,"deviceIndex");h(this,"origin");h(this,"source");h(this,"mode");h(this,"_ray");h(this,"space");h(this,"isClick",!1);h(this,"isDoubleClick",!1);h(this,"_used",!1);h(this,"_pointerid");h(this,"_pointerType");h(this,"_type");h(this,"metadata",{});h(this,"intersections",new Array);h(this,"_immediatePropagationStopped",!1);h(this,"_propagationStopped",!1);this.clientZ=r.clientZ,this._pointerid=r.pointerId,this._pointerType=r.pointerType,this._type=t,this.deviceIndex=r.deviceIndex,this.origin=r.origin,this.source=n,this.mode=r.mode,this._ray=r.ray,this.space=r.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new gh(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(t){this._ray=t}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var t;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}stopPropagation(){var t;this._propagationStopped=!0,super.stopPropagation(),(t=this.source)==null||t.stopPropagation(),tn&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class mA extends KeyboardEvent{constructor(t,n,r){super(t,r);h(this,"source");this.source=n}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class PK{constructor(i){h(this,"key");h(this,"keyType");h(this,"source");this.key=i.key,this.keyType=i.type,this.source=i}}var Pr;(function(s){s[s.Early=-100]="Early",s[s.Default=0]="Default",s[s.Late=100]="Late"})(Pr||(Pr={}));class n8{constructor(i){h(this,"_eventListeners",{});h(this,"_doubleClickTimeThreshold",.2);h(this,"_longPressTimeThreshold",1);h(this,"_specialCursorTrigger",0);h(this,"context");h(this,"_pointerDown",[!1]);h(this,"_pointerUp",[!1]);h(this,"_pointerClick",[!1]);h(this,"_pointerDoubleClick",[!1]);h(this,"_pointerPressed",[!1]);h(this,"_pointerPositions",[new ae]);h(this,"_pointerPositionsLastFrame",[new ae]);h(this,"_pointerPositionsDelta",[new ae]);h(this,"_pointerPositionsRC",[new ae]);h(this,"_pointerPositionDown",[new x]);h(this,"_pointerDownTime",[]);h(this,"_pointerUpTime",[]);h(this,"_pointerUpTimestamp",[]);h(this,"_pointerIds",[]);h(this,"_pointerTypes",[""]);h(this,"_mouseWheelChanged",[!1]);h(this,"_mouseWheelDeltaY",[0]);h(this,"_pointerEvent",[]);h(this,"_pointerEventsPressed",[]);h(this,"_pointerSpace",[]);h(this,"_pressedStack",new Map);h(this,"_htmlEventSource");h(this,"onLostFocus",()=>{for(const i in this.keysPressed)this.keysPressed[i].pressed=!1});h(this,"onEndOfFrame",()=>{for(let i=0;i<this._pointerUp.length;i++)this._pointerUp[i]=!1;for(let i=0;i<this._pointerDown.length;i++)this._pointerDown[i]=!1;for(let i=0;i<this._pointerClick.length;i++)this._pointerClick[i]=!1;for(let i=0;i<this._pointerDoubleClick.length;i++)this._pointerDoubleClick[i]=!1;for(const i of this._pointerPositionsDelta)i.set(0,0);for(let i=0;i<this._mouseWheelChanged.length;i++)this._mouseWheelChanged[i]=!1;for(let i=0;i<this._mouseWheelDeltaY.length;i++)this._mouseWheelDeltaY[i]=0});h(this,"onContextMenu",i=>{this.canReceiveInput(i)!==!1&&i instanceof PointerEvent&&i.pointerType});h(this,"keysPressed",{});h(this,"onKeyDown",i=>{if(tn&&console.log(`key down ${i.code}, ${this.context.application.hasFocus}`,i),!this.context.application.hasFocus)return;const t=this.keysPressed[i.code];if(t&&t.pressed)return;this.keysPressed[i.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:i.key,code:i.code};const n=new mA(dt.KeyDown,i,i);this.onDispatchEvent(n)});h(this,"onKeyPressed",i=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[i.code];if(!t)return;t.pressed=!0,t.frame=this.context.time.frameCount+1;const n=new mA(dt.KeyPressed,i,i);this.onDispatchEvent(n)});h(this,"onKeyUp",i=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[i.code];if(!t)return;t.pressed=!1,t.frame=this.context.time.frameCount+1;const n=new mA(dt.KeyUp,i,i);this.onDispatchEvent(n)});h(this,"onWheelWindow",i=>{document.pointerLockElement&&this.onMouseWheel(i)});h(this,"onMouseWheel",i=>{if(this.canReceiveInput(i)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const t=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=t+i.deltaY});h(this,"onPointerDown",i=>{if(this.context.isInAR||this.canReceiveInput(i)===!1)return;i.target instanceof HTMLElement&&i.target.setPointerCapture(i.pointerId);const t=this.getPointerId(i);tn&&bi(`pointer down #${t}, identifier:${i.pointerId}`);const n=this.getAndUpdateSpatialObjectForScreenPosition(t,i.clientX,i.clientY),r=new Dc(dt.PointerDown,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:n,pressure:i.pressure});this.onDown(r)});h(this,"onPointerMove",i=>{if(this.context.isInAR)return;let t=i.button;i.pointerType==="mouse"&&(t=this.getFirstPressedButtonForPointer(0)??0);const n=this.getPointerId(i,t);t===-1&&(t=n);const r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Dc(dt.PointerMove,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:t,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:r,pressure:i.pressure});this.onMove(o)});h(this,"onPointerCancel",i=>{this.context.isInAR||(tn&&console.log("Pointer cancel",i),this.onPointerUp(i))});h(this,"onPointerUp",i=>{if(this.context.isInAR)return;i.target instanceof HTMLElement&&i.target.releasePointerCapture(i.pointerId);const t=this.getPointerId(i),n=new Dc(dt.PointerUp,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:this.getAndUpdateSpatialObjectForScreenPosition(t,i.clientX,i.clientY),pressure:i.pressure});this.onUp(n),this._pointerIds[t]=-1,tn&&console.log("ID="+t,"PointerId="+i.pointerId,"ALL:",[...this._pointerIds])});h(this,"onTouchStart",i=>{if(this.context.isInAR)for(let t=0;t<i.changedTouches.length;t++){const n=i.changedTouches[t],r=this.getPointerIndex(n.identifier),o=this.getAndUpdateSpatialObjectForScreenPosition(r,n.clientX,n.clientY),a=new Dc(dt.PointerDown,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:0,clientX:n.clientX,clientY:n.clientY,pointerType:"touch",buttonName:"unknown",device:o,pressure:n.force});this.onDown(a)}});h(this,"onTouchMove",i=>{if(this.context.isInAR)for(let t=0;t<i.changedTouches.length;t++){const n=i.changedTouches[t],r=this.getPointerIndex(n.identifier),o=this.getAndUpdateSpatialObjectForScreenPosition(r,n.clientX,n.clientY),a=new Dc(dt.PointerMove,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:0,clientX:n.clientX,clientY:n.clientY,pointerType:"touch",buttonName:"unknown",device:o,pressure:n.force});this.onMove(a)}});h(this,"onTouchEnd",i=>{if(this.context.isInAR)for(let t=0;t<i.changedTouches.length;t++){const n=i.changedTouches[t],r=this.getPointerIndex(n.identifier),o=new Dc(dt.PointerUp,i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:0,clientX:n.clientX,clientY:n.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(r,n.clientX,n.clientY),pressure:n.force});this.onUp(o),this._pointerIds[r]=-1}});h(this,"tempNearPlaneVector",new x);h(this,"tempFarPlaneVector",new x);h(this,"tempLookMatrix",new le);this.context=i,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(i,t,n){if(this._eventListeners[i]||(this._eventListeners[i]=[]),!t||typeof t!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}n?n={...n}:n={};let r=0;(n==null?void 0:n.queue)!=null&&(r=n.queue);const o=this._eventListeners[i],a=o.find(l=>l.priority===r);a?a.listeners.push({callback:t,options:n}):(o.push({priority:r,listeners:[{callback:t,options:n}]}),o.sort((l,c)=>l.priority-c.priority))}removeEventListener(i,t,n){if(!this._eventListeners[i]||!t)return;const r=this._eventListeners[i];if((n==null?void 0:n.queue)!=null){const o=r.find(l=>l.priority===n.queue);if(!o)return;const a=o.listeners.findIndex(l=>l.callback===t);a>=0&&o.listeners.splice(a,1)}else for(const o of r){const a=o.listeners.findIndex(l=>l.callback===t);a>=0&&o.listeners.splice(a,1)}}dispatchEvent(i){var n,r,o,a;let t=!1;if(i instanceof mA){const l=this._eventListeners[i.type];if(l)for(const c of l)for(let u=0;u<c.listeners.length;u++){const d=c.listeners[u];if((r=(n=d.options)==null?void 0:n.signal)!=null&&r.aborted){c.listeners.splice(u,1),u--;continue}d.options.once&&(c.listeners.splice(u,1),u--),d.callback(i)}}if(i instanceof Dc){const l=this._eventListeners[i.type];if(l)for(const c of l){if(t)break;for(let u=0;u<c.listeners.length;u++){const d=c.listeners[u];if((a=(o=d.options)==null?void 0:o.signal)!=null&&a.aborted){c.listeners.splice(u,1),u--;continue}if(i.immediatePropagationStopped){t=!0,tn&&console.log("immediatePropagationStopped",i.type);break}else i.propagationStopped&&(t=!0,tn&&console.log("propagationStopped",i.type));d.options.once&&(c.listeners.splice(u,1),u--),d.callback(i)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(i){for(const t of this._pointerEventsPressed)if(t.pointerId===i&&t.used)return!0;return!1}getPointerPressedCount(){let i=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&i++;return i}getPointerPosition(i){return i>=this._pointerPositions.length?null:this._pointerPositions[i]}getPointerPositionLastFrame(i){return i>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[i]}getPointerPositionDelta(i){return i>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[i]}getPointerPositionRC(i){return i>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[i]}getPointerDown(i){return i>=this._pointerDown.length?!1:this._pointerDown[i]}getPointerUp(i){return i>=this._pointerUp.length?!1:this._pointerUp[i]}getPointerPressed(i){return i>=this._pointerPressed.length?!1:this._pointerPressed[i]}getPointerClicked(i){return i>=this._pointerClick.length?!1:this._pointerClick[i]}getPointerDoubleClicked(i){return i>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[i]}getPointerDownTime(i){return i>=this._pointerDownTime.length?-1:this._pointerDownTime[i]}getPointerUpTime(i){return i>=this._pointerUpTime.length?-1:this._pointerUpTime[i]}getPointerLongPress(i){return i>=this._pointerDownTime.length?!1:this.getPointerPressed(i)&&this.context.time.time-this._pointerDownTime[i]>this._longPressTimeThreshold}getIsMouse(i){return i<0||i>=this._pointerTypes.length?!1:this._pointerTypes[i]===Kc.Mouse}getIsTouch(i){return i<0||i>=this._pointerTypes.length?!1:this._pointerTypes[i]===Kc.Touch}getTouchesPressedCount(){let i=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&this.getIsTouch(t)&&i++;return i}getMouseWheelChanged(i=0){return i>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[i]}getMouseWheelDeltaY(i=0){return i>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[i]}getPointerEvent(i){if(!(i>=this._pointerEvent.length))return this._pointerEvent[i]??void 0}*foreachPointerId(i){for(let t=0;t<this._pointerTypes.length;t++)if(this._pointerIsActive(t)){if(i!==void 0){const n=this._pointerTypes[t];if(Array.isArray(i)){let r=!1;for(const o of i)if(n===o){r=!0;break}if(!r)continue}else if(i!==n)continue}yield t}}*foreachTouchId(){for(let i=0;i<this._pointerTypes.length;i++)this._pointerTypes[i]===Kc.Touch&&this._pointerIsActive[i]&&(yield i)}_pointerIsActive(i){return i<0?!1:this._pointerPressed[i]||this._pointerDown[i]||this._pointerUp[i]}onDownButton(i,t){let n=this._pressedStack.get(i);n||(n=[],this._pressedStack.set(i,n)),n.push(t)}onReleaseButton(i,t){const n=this._pressedStack.get(i);if(!n)return;const r=n.indexOf(t);r>=0&&n.splice(r,1)}getFirstPressedButtonForPointer(i){const t=this._pressedStack.get(i);if(t)return t[0]}getLatestPressedButtonForPointer(i){const t=this._pressedStack.get(i);if(t)return t[t.length-1]}getKeyDown(){for(const i in this.keysPressed){const t=this.keysPressed[i];if(t.startFrame===this.context.time.frameCount)return t.key}return null}getKeyPressed(){for(const i in this.keysPressed){const t=this.keysPressed[i];if(t.pressed)return t.key}return null}isKeyDown(i){var n;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(i);if(t!==null){for(const r of t)if(this.isKeyDown(r))return!0;return!1}return((n=this.keysPressed[i])==null?void 0:n.startFrame)===this.context.time.frameCount&&this.keysPressed[i].pressed}isKeyUp(i){var n;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(i);if(t!==null){for(const r of t)if(this.isKeyUp(r))return!0;return!1}return((n=this.keysPressed[i])==null?void 0:n.frame)===this.context.time.frameCount&&!this.keysPressed[i].pressed}isKeyPressed(i){var n;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(i);if(t!==null){for(const r of t)if(this.isKeyPressed(r))return!0;return!1}return(n=this.keysPressed[i])==null?void 0:n.pressed}getCodeForCommonKeyName(i){if(i.length===1){if(i>="0"&&i<="9")return["Digit"+i];if(i>="a"&&i<="z")return["Key"+i.toUpperCase()];if(i==" ")return["Space"]}switch(i){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(i){switch(i.type){case dt.PointerDown:tn&&bi("Create Pointer down"),this.onDownButton(i.deviceIndex,i.button),this.onDown(i);break;case dt.PointerMove:tn&&bi("Create Pointer move"),this.onMove(i);break;case dt.PointerUp:tn&&bi("Create Pointer up"),this.onUp(i),this.onReleaseButton(i.deviceIndex,i.button);break}}convertScreenspaceToRaycastSpace(i){return i.x=(i.x-this.context.domX)/this.context.domWidth*2-1,i.y=-((i.y-this.context.domY)/this.context.domHeight)*2+1,i}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var i,t;window.removeEventListener("contextmenu",this.onContextMenu),(i=this._htmlEventSource)==null||i.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(t=this._htmlEventSource)==null||t.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const i=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);i>=0&&this.context.post_render_callbacks.splice(i,1),this.unbindEvents()}canReceiveInput(i){var t;return i.target===((t=this.context.renderer)==null?void 0:t.domElement)||i.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&i.target===document.body&&rf()?!0:(tn&&console.warn("CanReceiveInput:False for",i.target),!1)}getPointerId(i,t){return i.pointerType==="mouse"?0+(t??i.button):this.getPointerIndex(i.pointerId)}getButtonName(i){const t=i.button;if(i.pointerType==="mouse")switch(t){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(i,t,n){let r=this._pointerSpace[i];r||(r=new ne,this._pointerSpace[i]=r),this._pointerSpace[i]=r;const o=this.context.mainCamera;if(o){const a=this.tempNearPlaneVector.set(t,n,-1);this.convertScreenspaceToRaycastSpace(a);const l=this.tempFarPlaneVector.set(a.x,a.y,1);a.unproject(o),l.unproject(o);const c=o.worldUp||Be(0,1,0).applyQuaternion(Ht(o));this.tempLookMatrix.lookAt(l,a,c),r.position.set(a.x,a.y,a.z),r.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return r}isInRect(i){if(this.context.isInXR)return!0;const t=this.context.domElement.getBoundingClientRect(),n=i.clientX,r=i.clientY,o=n>=t.x&&n<=t.right&&r>=t.y&&r<=t.bottom;return tn&&!o&&console.log("Not in rect",t,n,r),o}onDown(i){const t=i.pointerId;if(this.getPointerPressed(t)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${t}`,tn?i:""),tn&&console.log(i.pointerType,"DOWN",t),!!this.isInRect(i)){for(this.setPointerState(t,this._pointerPressed,!0),this.setPointerState(t,this._pointerDown,!0),this.setPointerStateT(t,this._pointerEvent,i.source);t>=this._pointerTypes.length;)this._pointerTypes.push(i.pointerType);for(this._pointerTypes[t]=i.pointerType;t>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new x);for(this._pointerPositionDown[t].set(i.clientX,i.clientY,i.clientZ??0);t>=this._pointerPositions.length;)this._pointerPositions.push(new ae);this._pointerPositions[t].set(i.clientX,i.clientY),t>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(i),this._pointerEventsPressed.push(i),this.onDispatchEvent(i)}}onMove(i){const t=i.pointerId,n=this.getPointerPressed(t);n===!1&&!this.isInRect(i)||i.pointerType===Kc.Touch&&!n||(this.updatePointerPosition(i),this.setPointerStateT(t,this._pointerEvent,i.source),this.onDispatchEvent(i))}onUp(i){const t=i.pointerId;if(!this.getPointerPressed(t)){tn&&console.log(i.pointerType,"UP",t,"was not down");return}tn&&console.log(i.pointerType,"UP",t),this.setPointerState(t,this._pointerPressed,!1),this.setPointerStateT(t,this._pointerEvent,i.source),this.setPointerState(t,this._pointerUp,!0),this.updatePointerPosition(i);for(let c=this._pointerEventsPressed.length-1;c>=0;c--)if(this._pointerEventsPressed[c].pointerId===t){this._pointerEventsPressed.splice(c,1);break}if(!this._pointerPositionDown[t]){tn&&Xt("Received pointer up event without matching down event for button: "+t),console.warn("Received pointer up event without matching down event for button: "+t);return}const r=this._pointerUpTime[t],o=this._pointerDownTime[t],a=this.context.time.realtimeSinceStartup,l=a-o;if(t>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[t]=a,l<1){let c=i.clientX-this._pointerPositionDown[t].x,u=i.clientY-this._pointerPositionDown[t].y,d=0;if(i.isSpatial&&i.clientZ!=null&&(d=i.clientZ-this._pointerPositionDown[t].z,c*=200,u*=200,d*=200),Math.abs(c)<5&&Math.abs(u)<5&&Math.abs(d)<5){this.setPointerState(t,this._pointerClick,!0),i.isClick=!0;const f=a-r;tn&&console.log("CLICK",t,c,u,d,f),f<this._doubleClickTimeThreshold&&f>0&&(this.setPointerState(t,this._pointerDoubleClick,!0),i.isDoubleClick=!0)}}this.onDispatchEvent(i)}updatePointerPosition(i){const t=i.pointerId;for(;t>=this._pointerPositions.length;)this._pointerPositions.push(new ae);for(;t>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new ae);for(;t>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new ae);const n=this._pointerPositionsLastFrame[t];n.copy(this._pointerPositions[t]);const r=this._pointerPositionsDelta[t];let o=i.clientX-n.x,a=i.clientY-n.y;if(i.source instanceof MouseEvent||i.source instanceof TouchEvent){const d=i.source;o===0&&d.movementX!==0&&(o=d.movementX||0),a===0&&d.movementY!==0&&(a=d.movementY||0)}r.x+=o,r.y+=a,this._pointerPositions[t].x=i.clientX,this._pointerPositions[t].y=i.clientY;const l=i.clientX,c=i.clientY;for(;t>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new ae);const u=this._pointerPositionsRC[t];u.set(l,c),this.convertScreenspaceToRaycastSpace(u)}getPointerIndex(i){let t=-1;for(let n=0;n<this._pointerIds.length;n++){if(this._pointerIds[n]===i)return n;t===-1&&this._pointerIds[n]===-1&&(t=n)}return t!==-1?(this._pointerIds[t]=i,t):(tn&&console.log("PUSH pointerId:",i),this._pointerIds.push(i),this._pointerIds.length-1)}setPointerState(i,t,n){t[i]=n}setPointerStateT(i,t,n){return t[i]=n,n}onDispatchEvent(i){const t=Ge.Current;try{Ge.Current=this.context,this.dispatchEvent(i)}finally{Ge.Current=t}}}const lf=new le().makeRotationY(Math.PI),ao=new se().setFromAxisAngle(new x(0,1,0),Math.PI),s8=Q("debugwebxr");class r8{constructor(){h(this,"priority",-1e5);h(this,"gameObject");if(this.gameObject=new ne,this.gameObject.name="Implicit XR Rig",s8){const i=PS(16733661);i.position.y+=.5,this.gameObject.add(i)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const Al=Q("debugwebxr"),AA=Q("debugcustomgesture"),o8="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",a8="generic-trigger",l8=new se().setFromEuler(new Gt(ct.degToRad(0),ct.degToRad(-90),ct.degToRad(-90))),c8=new x(.04,-.04,0);class Gk{constructor(i,t,n){h(this,"xr");h(this,"inputSource");h(this,"index",0);h(this,"emitEvents",!0);h(this,"_connected",!0);h(this,"_isTracking",!1);h(this,"__gamepad");h(this,"__hand");h(this,"__side");h(this,"_hitTestSource");h(this,"_hasSelectEvent",!1);h(this,"_isMxInk",!1);h(this,"_handJointPoses",new Map);h(this,"_gripMatrix",new le);h(this,"_gripPosition",new x);h(this,"_gripQuaternion",new se);h(this,"_linearVelocity",new x);h(this,"_rayPositionRaw",new x);h(this,"_rayRotationRaw",new se);h(this,"_rayMatrix",new le);h(this,"_rayPosition",new x);h(this,"_rayQuaternion",new se);h(this,"_gripWorldPosition",new x);h(this,"_gripWorldQuaternion",new se);h(this,"_rayWorldPosition",new x);h(this,"_rayWorldQuaternion",new se);h(this,"_pinchPosition",new x);h(this,"_ray");h(this,"_hand_wristDotUp");h(this,"_object");h(this,"_gripSpaceObject");h(this,"_raySpaceObject");h(this,"model",null);h(this,"_debugAxesHelper",new dr(.15));h(this,"_debugGripAxesHelper",new dr(.07));h(this,"_debugRayAxesHelper",new dr(.07));h(this,"_hitTestSourcePromise",null);h(this,"onPointerHits",i=>{});h(this,"_needleGamepadButtons",{});h(this,"_buttonMap",new Map);h(this,"_motioncontroller");h(this,"_layout");h(this,"getMotionController");h(this,"emitPointerDownEvent",!0);h(this,"emitPointerUpEvent",!0);h(this,"emitPointerMoveEvent",!0);h(this,"pointerMoveDistanceThreshold",.03);h(this,"pointerMoveAngleThreshold",.05);h(this,"_selectButtonIndex");h(this,"_squeezeButtonIndex");h(this,"onSelectStart",i=>{var r,o,a,l;if(!this.emitPointerDownEvent||this.inputSource!==i.inputSource)return;this.onUpdateFrame(i.frame),this._hasSelectEvent=!0;const t=(r=this._layout)==null?void 0:r.selectComponentId,n=(l=(a=(o=this._layout)==null?void 0:o.components[t])==null?void 0:a.gamepadIndices)==null?void 0:l.button;n!==void 0&&(this._selectButtonIndex=n),!AA&&(Al&&Pe.DrawDirection(this.rayWorldPosition,Be(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(dt.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,i))});h(this,"onSelectEnd",i=>{this.emitPointerUpEvent&&(AA||this.inputSource===i.inputSource&&this.emitPointerEvent(dt.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,i))});h(this,"onSequeezeStart",i=>{var t,n,r;this.emitPointerDownEvent&&this.inputSource===i.inputSource&&(this._squeezeButtonIndex=(r=(n=(t=this._layout)==null?void 0:t.components["xr-standard-squeeze"])==null?void 0:n.gamepadIndices)==null?void 0:r.button,this._squeezeButtonIndex!==void 0&&(Al&&Pe.DrawDirection(this.rayWorldPosition,Be(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(dt.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,i)))});h(this,"onSequeezeEnd",i=>{this.emitPointerUpEvent&&this.inputSource===i.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(dt.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,i)});h(this,"states",{});h(this,"_didMoveLastFrame",!1);h(this,"_lastPointerMovePosition",new x);h(this,"_lastPointerMoveQuaternion",new se);h(this,"pointerInit");this.xr=i,this.inputSource=t,this.index=n,this._object=new ne,this._object.name=`NeedleXRController_${n}`,Al&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new ne,this._raySpaceObject=new ne,this._gripSpaceObject.name=`NeedleXRController_${n}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${n}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new gh,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(i,t){var r;if(t=t||this.xr.frame,!this.hand||!(t!=null&&t.getJointPose)||!this.xr.referenceSpace)return null;let n=(r=this._handJointPoses)==null?void 0:r.get(i);return n||(n=t.getJointPose(i,this.xr.referenceSpace),n&&this._handJointPoses.set(i,n),n)}get gripPosition(){return Be(this._gripPosition)}get gripQuaternion(){return Ia(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return Be(this._linearVelocity).applyQuaternion(ao)}get rayPosition(){return Be(this._rayPosition)}get rayQuaternion(){return Ia(this._rayQuaternion)}get gripWorldPosition(){return Be(this._gripWorldPosition)}get gripWorldQuaternion(){return Ia(this._gripWorldQuaternion)}get rayWorldPosition(){return Be(this._rayWorldPosition)}updateRayWorldPosition(){var t;const i=(t=this.xr.context.mainCamera)==null?void 0:t.parent;this._rayWorldPosition.copy(this._rayPositionRaw),i&&this._rayWorldPosition.applyMatrix4(i.matrixWorld)}get rayWorldQuaternion(){return Ia(this._rayWorldQuaternion)}get pinchPosition(){return Be(this._pinchPosition)}updateRayWorldQuaternion(){var n;const i=(n=this.xr.context.mainCamera)==null?void 0:n.parent,t=i?Ht(i):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(ao),t&&this._rayWorldQuaternion.premultiply(t)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(Be(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var t;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const i=(t=this.handObject)==null?void 0:t.joints.wrist;if(i){const n=Be(0,1,0).applyQuaternion(i.quaternion),r=Be(0,1,0).dot(n);return this._hand_wristDotUp=r}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var i;return this.isHandUpsideDown&&((i=this.getGesture("pinch"))==null?void 0:i.isDown)}get object(){return this._object}async getModelUrl(){var i;return(i=this.getMotionController)==null?void 0:i.then(t=>(t==null?void 0:t.assetUrl)||null)}_requestHitTestSource(){var i;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((i=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:i.then(t=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=t:(t.cancel(),null))))??null:null}onUpdate(i){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(i),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var o;Pe.DrawSphere(this.rayWorldPosition,.003),Pe.DrawDirection(this.rayWorldPosition,Be(0,0,10).applyQuaternion(this.rayWorldQuaternion));const t=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),n=this.inputSource.profiles.join(`
`);let r=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(r+=`
Pinch: ${(o=this.getGesture("pinch"))==null?void 0:o.value.toFixed(3)}`),r+=`
`+n,r+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const a=this.inputSource.gamepad;let l="[btns "+a.buttons.length+"]: "+a.buttons.map(c=>c.value.toPrecision(1)).join(",");l+=`
[axes `+a.axes.length+"]: "+a.axes.map(c=>c.toPrecision(1)).join(","),r+=`
`+l}Pe.DrawLabel(t,r,.006)}onUpdateFrame(i){var d,f,p,g,m,A,y,b,_,w,S;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const t=i.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=t!=null;let n=null,r=null,o=null,a=null;if(t){const E=t.transform;if(this._rayMatrix.fromArray(E.matrix).premultiply(lf),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,Be(1,1,1)),o=Be(E.position),a=Ia(E.orientation),this._isMxInk){const I=Be(.013,0,-.028).applyQuaternion(a);o.add(I),this._rayPosition.add(I)}this._rayPositionRaw.copy(o),this._rayRotationRaw.copy(a)}if(this.inputSource.gripSpace){const E=i.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(E){const I=E.transform;if(n=Be(I.position),r=Ia(I.orientation),this._gripMatrix.fromArray(I.matrix).premultiply(lf),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Be(1,1,1)),"linearVelocity"in E&&E.linearVelocity){const k=E.linearVelocity;this._linearVelocity.set(k.x,k.y,k.z)}}}(d=this.xr.context.mainCamera)!=null&&d.parent&&(this._object.parent!==((f=this.xr.context.mainCamera)==null?void 0:f.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((p=this._gripSpaceObject)==null?void 0:p.parent)!==((g=this.xr.context.mainCamera)==null?void 0:g.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((m=this._raySpaceObject)==null?void 0:m.parent)!==((A=this.xr.context.mainCamera)==null?void 0:A.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const l=this.hand;if(l){let E=!1;const I=l.get("wrist"),k=I&&this.getHandJointPose(I,i);if(k){E=!0;const B=k.transform.position,M=k.transform.orientation;this._object.position.set(B.x,B.y,B.z),this._object.quaternion.set(M.x,M.y,M.z,M.w).multiply(ao)}E||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(ao));const T=l.get("middle-finger-metacarpal"),P=T&&this.getHandJointPose(T,i);P&&(this._gripMatrix.fromArray(P.transform.matrix).premultiply(lf),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Be(1,1,1)),n=Be().copy(P.transform.position),r=Ia().copy(P.transform.orientation),r.multiply(l8),n.add(Be(c8).applyQuaternion(r)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&n&&r?(this._object.position.copy(n),this._object.quaternion.copy(r).multiply(ao)):o&&a&&(this._object.position.copy(o),this._object.quaternion.copy(a).multiply(ao));Al&&(o&&a&&((y=this._raySpaceObject)==null||y.position.copy(o),(b=this._raySpaceObject)==null||b.quaternion.copy(a).multiply(ao)),n&&r&&((_=this._gripSpaceObject)==null||_.position.copy(n),(w=this._gripSpaceObject)==null||w.quaternion.copy(r).multiply(ao)));const c=(S=this.xr.context.mainCamera)==null?void 0:S.parent,u=c?Ht(c):void 0;n&&r&&(this._gripWorldPosition.copy(n),c&&this._gripWorldPosition.applyMatrix4(c.matrixWorld),this._gripWorldQuaternion.copy(r),this._gripWorldQuaternion.multiply(ao),u&&this._gripWorldQuaternion.premultiply(u)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var i,t,n,r,o,a;this._connected=!1,Al&&console.warn("Controller disconnected",this.index);for(const l of this._object.children)this.xr.context.scene.attach(l);(i=this._object)==null||i.removeFromParent(),(t=this._debugAxesHelper)==null||t.removeFromParent(),(n=this._debugGripAxesHelper)==null||n.removeFromParent(),(r=this._debugRayAxesHelper)==null||r.removeFromParent(),(o=this._gripSpaceObject)==null||o.removeFromParent(),(a=this._raySpaceObject)==null||a.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(i){var n;if(!this._layout)return;switch(i){case"primary-button":if(this.isLeft)i="x-button";else if(this.isRight)i="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,i)}if(this._buttonMap.has(i))return this.toNeedleGamepadButton(this._buttonMap.get(i),i);const t=(n=this._layout)==null?void 0:n.components[i];if(t!=null&&t.gamepadIndices)switch(t.type){case"button":case"squeeze":if(this.inputSource.gamepad){const r=t.gamepadIndices.button;return this._buttonMap.set(i,r),this.toNeedleGamepadButton(r,i)}break;default:console.warn("Unsupported component type",t.type);break}this._buttonMap.set(i,void 0)}getGesture(i){const t=this.states[i];if(!t)return null;this.states[i]=t;const n=this._needleGamepadButtons[i]||new vI(void 0,i);return n.pressed=t.pressed,n.value=t.value,n.isDown=t.isDown,n.isUp=t.isUp,this._needleGamepadButtons[i]=n,n}getPointerId(i){if((i==="primary"||i==="pinch")&&(i=0),typeof i!="number"){const t=this._buttonMap.get(i);if(t===void 0)return;i=t}return this.index*10+i}toNeedleGamepadButton(i,t){var a,l;if(!((a=this.inputSource.gamepad)!=null&&a.buttons))return;const n=(l=this.inputSource.gamepad)==null?void 0:l.buttons[i],r=this.states[i],o=this._needleGamepadButtons[i]||new vI(i,t);return n&&(o.pressed=n.pressed,o.value=n.value,o.touched=n.touched),r&&(o.isDown=r.isDown,o.isUp=r.isUp),this._needleGamepadButtons[i]=o,o}getStick(i){var n,r,o,a,l,c,u,d,f;if(!this._layout)return{x:0,y:0,z:0};if(i==="primary"){const p=((n=this.inputSource.gamepad)==null?void 0:n.axes[0])||0,g=((r=this.inputSource.gamepad)==null?void 0:r.axes[1])||0,m=((a=(o=this.inputSource.gamepad)==null?void 0:o.buttons[3])==null?void 0:a.value)||0;return{x:p,y:g,z:m}}const t=(l=this._layout)==null?void 0:l.components[i];if(t!=null&&t.gamepadIndices)switch(t.type){case"thumbstick":if(this.inputSource.gamepad){const p=t.gamepadIndices.xAxis,g=t.gamepadIndices.yAxis;let m=(c=this.inputSource.gamepad)==null?void 0:c.axes[p],A=(u=this.inputSource.gamepad)==null?void 0:u.axes[g];m*=-1,A*=-1;const y=t.gamepadIndices.button,b=(f=(d=this.inputSource.gamepad)==null?void 0:d.buttons[y])==null?void 0:f.value;return{x:m,y:A,z:b}}}return{x:0,y:0,z:0}}initialize(){var i;if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(t=>t.startsWith("generic-trigger")),this._isMxInk=this.profiles.includes("meta-quest-touch-plus")&&((i=this.inputSource.gamepad)==null?void 0:i.buttons.length)===7,!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const t=JG(this.inputSource,o8,a8);this.getMotionController=t.then(n=>{var a;if(!this.connected)return null;this._isMxInk&&(n.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb"),this._motioncontroller=new i8(this.inputSource,n.profile,n.assetPath||"");const o=n.profile.layouts[this.inputSource.handedness];if(this._layout=o,this._layout&&!((a=this._layout.gamepad)!=null&&a.length)){this._layout.gamepad=[];for(const l in this._layout.components){const c=this._layout.components[l];this._layout.gamepad[c.gamepadIndices.button]=l}}return this._motioncontroller}).catch(n=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,n),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var i,t,n;if((i=this.gamepad)!=null&&i.buttons)for(let r=0;r<this.gamepad.buttons.length;r++){const o=this.gamepad.buttons[r],a=this.states[r]||new AI;let l=null;o.pressed&&!a.pressed?(l="pointerdown",a.isDown=!0,a.isUp=!1):!o.pressed&&a.pressed?(l="pointerup",a.isDown=!1,a.isUp=!0):(a.isDown=!1,a.isUp=!1),a.value=o.value,a.pressed=o.pressed,this.states[r]=a;const c=r!==this._selectButtonIndex&&r!==this._squeezeButtonIndex;if(l!=null&&c){const u=(t=this._layout)==null?void 0:t.gamepad[r];(Al||AA)&&console.log("Emitting pointer event",l,r,u,o.value,this.gamepad,this._layout),this.emitPointerEvent(l,r,u??"none",!1,null,o.value)}}if(this.hand){const r=this.handObject;if(r){const o=r.joints["index-finger-tip"],a=r.joints["thumb-tip"];if(o&&a){const l=o.position.distanceTo(a.position);this._pinchPosition.lerpVectors(o.position,a.position,.5);const c=(n=this.xr.context.mainCamera)==null?void 0:n.parent;if(c&&this._pinchPosition.applyMatrix4(c.matrixWorld),l!==0){const f=this.states.pinch||new AI,p=(.02+.01)*1.5;f.value=1-(l-.02)/p;const g=l<.02-.01,m=l>.02+.01;g&&!f.pressed?(AA&&console.log("pinch start",l),f.isDown=!0,f.isUp=!1,f.pressed=!0):m&&f.pressed?(f.isDown=!1,f.isUp=!0,f.pressed=!1):(f.isDown=!1,f.isUp=!1),this.states.pinch=f}}}}}onUpdateMove(){var n,r;if(!this.emitPointerMoveEvent)return;let i=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(i=!0),i||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(i=!0),i){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),Al&&Pe.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let o=this.xr.context.input.getFirstPressedButtonForPointer(this.index);o===void 0&&(o=0);const a=(r=(n=this.gamepad)==null?void 0:n.buttons[o])==null?void 0:r.value;this.emitPointerEvent("pointermove",o,"none",!1,null,a)}else this._didMoveLastFrame=!1}emitPointerEvent(i,t,n,r,o=null,a){if(!this.emitEvents){Al&&i!==dt.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,i,t);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(t),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=t,this.pointerInit.buttonName=n,this.pointerInit.isPrimary=r,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=a,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const l=Ge.Current;Ge.Current=this.xr.context,Al&&i!=="pointermove"&&console.warn("Pointer event",i,t,n,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Dc(i,o,this.pointerInit)),Ge.Current=l}}}class AI{constructor(){h(this,"isDown",!1);h(this,"isUp",!1);h(this,"pressed",!1);h(this,"value",0)}}class vI{constructor(i,t){h(this,"index");h(this,"name");h(this,"touched",!1);h(this,"pressed",!1);h(this,"value",0);h(this,"isDown",!1);h(this,"isUp",!1);this.index=i,this.name=t}}const cf=new Map,Od=new Map;let yI=0;function mh(s,i,t){if(cf.has(i)||cf.set(i,new Array),cf.get(i).push({method:s,options:{once:!1,...t}}),yI<30){const n=Od.get(i);n&&(n==null?void 0:n.length)>100&&(yI+=1,console.warn(`You have ${n.length} methods registered for Event ${i}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function Ah(s,i){const t=Od.get(i);if(t){for(let r=0;r<t.length;r++)if(t[r].method===s){t.splice(r,1);return}}const n=cf.get(i);if(n){for(let r=0;r<n.length;r++)if(n[r].method===s){n.splice(r,1);return}}}function ua(s,i){i===ut.ContextCreated&&sx.delete(s),Hk(s,i)}function Hk(s,i){i===qe.Start&&cf.get(ut.ContextCreated)&&Hk(s,ut.ContextCreated);const t=i===qe.Start||i===ut.ContextCreated,n=Od.get(i);n&&n.length>0&&_I(s,n,t);const r=cf.get(i);if(r&&r.length>0){const o=[...r];r.length=0,_I(s,o,t),o.length>0&&(Od.has(i)||Od.set(i,new Array),Od.get(i).push(...o))}}const vA=new Array,bI={context:null};function _I(s,i,t){var r,o;vA.length=0;for(let a=0;a<i.length;a++)vA.push(i[a]);let n=sx.get(s);for(let a=0;a<vA.length;a++){const l=vA[a];let c=!0;if(n&&n.has(l)&&(c=!1),c)try{bI.context=s,(r=l.method)==null||r.call(bI,s)}catch(u){console.error("Error in lifecycle method",u)}if((o=l.options)!=null&&o.once){for(let u=0;u<i.length;u++)if(i[u]===l){i.splice(u,1);break}}else t&&(n||(n=new Set,sx.set(s,n)),n.add(l))}}const sx=new WeakMap,a_=2,Oa=4,Fl=4,CS=4,Nc=new Int32Array(2),wI=new Float32Array(Nc.buffer),xI=new Float64Array(Nc.buffer),yA=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Xl{constructor(i,t){this.low=i|0,this.high=t|0}static create(i,t){return i==0&&t==0?Xl.ZERO:new Xl(i,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(i){return this.low==i.low&&this.high==i.high}}Xl.ZERO=new Xl(0,0);var rx;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(rx||(rx={}));class Jg{constructor(i){this.bytes_=i,this.position_=0}static allocate(i){return new Jg(new Uint8Array(i))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(i){this.position_=i}capacity(){return this.bytes_.length}readInt8(i){return this.readUint8(i)<<24>>24}readUint8(i){return this.bytes_[i]}readInt16(i){return this.readUint16(i)<<16>>16}readUint16(i){return this.bytes_[i]|this.bytes_[i+1]<<8}readInt32(i){return this.bytes_[i]|this.bytes_[i+1]<<8|this.bytes_[i+2]<<16|this.bytes_[i+3]<<24}readUint32(i){return this.readInt32(i)>>>0}readInt64(i){return new Xl(this.readInt32(i),this.readInt32(i+4))}readUint64(i){return new Xl(this.readUint32(i),this.readUint32(i+4))}readFloat32(i){return Nc[0]=this.readInt32(i),wI[0]}readFloat64(i){return Nc[yA?0:1]=this.readInt32(i),Nc[yA?1:0]=this.readInt32(i+4),xI[0]}writeInt8(i,t){this.bytes_[i]=t}writeUint8(i,t){this.bytes_[i]=t}writeInt16(i,t){this.bytes_[i]=t,this.bytes_[i+1]=t>>8}writeUint16(i,t){this.bytes_[i]=t,this.bytes_[i+1]=t>>8}writeInt32(i,t){this.bytes_[i]=t,this.bytes_[i+1]=t>>8,this.bytes_[i+2]=t>>16,this.bytes_[i+3]=t>>24}writeUint32(i,t){this.bytes_[i]=t,this.bytes_[i+1]=t>>8,this.bytes_[i+2]=t>>16,this.bytes_[i+3]=t>>24}writeInt64(i,t){this.writeInt32(i,t.low),this.writeInt32(i+4,t.high)}writeUint64(i,t){this.writeUint32(i,t.low),this.writeUint32(i+4,t.high)}writeFloat32(i,t){wI[0]=t,this.writeInt32(i,Nc[0])}writeFloat64(i,t){xI[0]=t,this.writeInt32(i,Nc[yA?0:1]),this.writeInt32(i+4,Nc[yA?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Oa+Fl)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let i="";for(let t=0;t<Fl;t++)i+=String.fromCharCode(this.readInt8(this.position_+Oa+t));return i}__offset(i,t){const n=i-this.readInt32(i);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(i,t){return i.bb_pos=t+this.readInt32(t),i.bb=this,i}__string(i,t){i+=this.readInt32(i);const n=this.readInt32(i);let r="",o=0;if(i+=Oa,t===rx.UTF8_BYTES)return this.bytes_.subarray(i,i+n);for(;o<n;){let a;const l=this.readUint8(i+o++);if(l<192)a=l;else{const c=this.readUint8(i+o++);if(l<224)a=(l&31)<<6|c&63;else{const u=this.readUint8(i+o++);if(l<240)a=(l&15)<<12|(c&63)<<6|u&63;else{const d=this.readUint8(i+o++);a=(l&7)<<18|(c&63)<<12|(u&63)<<6|d&63}}}a<65536?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode((a>>10)+55296,(a&1024-1)+56320))}return r}__union_with_string(i,t){return typeof i=="string"?this.__string(t):this.__union(i,t)}__indirect(i){return i+this.readInt32(i)}__vector(i){return i+this.readInt32(i)+Oa}__vector_len(i){return this.readInt32(i+this.readInt32(i))}__has_identifier(i){if(i.length!=Fl)throw new Error("FlatBuffers: file identifier must be length "+Fl);for(let t=0;t<Fl;t++)if(i.charCodeAt(t)!=this.readInt8(this.position()+Oa+t))return!1;return!0}createLong(i,t){return Xl.create(i,t)}createScalarList(i,t){const n=[];for(let r=0;r<t;++r)i(r)!==null&&n.push(i(r));return n}createObjList(i,t){const n=[];for(let r=0;r<t;++r){const o=i(r);o!==null&&n.push(o.unpack())}return n}}class Cm{constructor(i){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;i?t=i:t=1024,this.bb=Jg.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(i){this.force_defaults=i}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(i,t){i>this.minalign&&(this.minalign=i);const n=~(this.bb.capacity()-this.space+t)+1&i-1;for(;this.space<n+i+t;){const r=this.bb.capacity();this.bb=Cm.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(n)}pad(i){for(let t=0;t<i;t++)this.bb.writeInt8(--this.space,0)}writeInt8(i){this.bb.writeInt8(this.space-=1,i)}writeInt16(i){this.bb.writeInt16(this.space-=2,i)}writeInt32(i){this.bb.writeInt32(this.space-=4,i)}writeInt64(i){this.bb.writeInt64(this.space-=8,i)}writeFloat32(i){this.bb.writeFloat32(this.space-=4,i)}writeFloat64(i){this.bb.writeFloat64(this.space-=8,i)}addInt8(i){this.prep(1,0),this.writeInt8(i)}addInt16(i){this.prep(2,0),this.writeInt16(i)}addInt32(i){this.prep(4,0),this.writeInt32(i)}addInt64(i){this.prep(8,0),this.writeInt64(i)}addFloat32(i){this.prep(4,0),this.writeFloat32(i)}addFloat64(i){this.prep(8,0),this.writeFloat64(i)}addFieldInt8(i,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(i))}addFieldInt16(i,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(i))}addFieldInt32(i,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(i))}addFieldInt64(i,t,n){(this.force_defaults||!t.equals(n))&&(this.addInt64(t),this.slot(i))}addFieldFloat32(i,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(i))}addFieldFloat64(i,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(i))}addFieldOffset(i,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(i))}addFieldStruct(i,t,n){t!=n&&(this.nested(t),this.slot(i))}nested(i){if(i!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(i){this.vtable!==null&&(this.vtable[i]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(i){const t=i.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,r=Jg.allocate(n);return r.setPosition(n-t),r.bytes().set(i.bytes(),n-t),r}addOffset(i){this.prep(Oa,0),this.writeInt32(this.offset()-i+Oa)}startObject(i){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=i;for(let t=0;t<i;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const i=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const n=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?i-this.vtable[t]:0);const r=2;this.addInt16(i-this.object_start);const o=(n+r)*a_;this.addInt16(o);let a=0;const l=this.space;e:for(t=0;t<this.vtables.length;t++){const c=this.bb.capacity()-this.vtables[t];if(o==this.bb.readInt16(c)){for(let u=a_;u<o;u+=a_)if(this.bb.readInt16(l+u)!=this.bb.readInt16(c+u))continue e;a=this.vtables[t];break}}return a?(this.space=this.bb.capacity()-i,this.bb.writeInt32(this.space,a-i)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-i,this.offset()-i)),this.isNested=!1,i}finish(i,t,n){const r=n?CS:0;if(t){const o=t;if(this.prep(this.minalign,Oa+Fl+r),o.length!=Fl)throw new Error("FlatBuffers: file identifier must be length "+Fl);for(let a=Fl-1;a>=0;a--)this.writeInt8(o.charCodeAt(a))}this.prep(this.minalign,Oa+r),this.addOffset(i),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(i,t){this.finish(i,t,!0)}requiredField(i,t){const n=this.bb.capacity()-i,r=n-this.bb.readInt32(n);if(!(this.bb.readInt16(r+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(i,t,n){this.notNested(),this.vector_num_elems=t,this.prep(Oa,i*t),this.prep(n,i*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(i){if(!i)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(i))return this.string_maps.get(i);const t=this.createString(i);return this.string_maps.set(i,t),t}createString(i){if(!i)return 0;let t;if(i instanceof Uint8Array)t=i;else{t=[];let n=0;for(;n<i.length;){let r;const o=i.charCodeAt(n++);if(o<55296||o>=56320)r=o;else{const a=i.charCodeAt(n++);r=(o<<10)+a+(65536-56623104-56320)}r<128?t.push(r):(r<2048?t.push(r>>6&31|192):(r<65536?t.push(r>>12&15|224):t.push(r>>18&7|240,r>>12&63|128),t.push(r>>6&63|128)),t.push(r&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let n=0,r=this.space,o=this.bb.bytes();n<t.length;n++)o[r++]=t[n];return this.endVector()}createLong(i,t){return Xl.create(i,t)}createObjectOffset(i){return i===null?0:typeof i=="string"?this.createString(i):i.pack(this)}createObjectOffsetList(i){const t=[];for(let n=0;n<i.length;++n){const r=i[n];if(r!==null)t.push(this.createObjectOffset(r));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(i,t){return t(this,i.length),this.createObjectOffsetList(i),this.endVector()}}const Vk={};function Wk(s,i){Vk[s]=i}function h8(s){const i=s.getBufferIdentifier(),t=Vk[i];return t(s)}function u8(s){return typeof s.guid=="function"?s.guid():null}function b0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var qk={exports:{}};(function(s){var i={};i.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),i.useArrayBufferView=!i.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),s.exports.binaryFeatures=i;var t=s.exports.BlobBuilder;typeof window<"u"&&(t=s.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function n(){this._pieces=[],this._parts=[]}n.prototype.append=function(r){typeof r=="number"?this._pieces.push(r):(this.flush(),this._parts.push(r))},n.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);i.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),i.useBlobBuilder){for(var r=new t,o=0,a=this._parts.length;o<a;o++)r.append(this._parts[o]);return r.getBlob()}else return new Blob(this._parts)},s.exports.BufferBuilder=n})(qk);var Xk=qk.exports,d8=Xk.BufferBuilder,CI=Xk.binaryFeatures,f8={unpack:function(s){var i=new is(s);return i.unpack()},pack:function(s){var i=new ns;i.pack(s);var t=i.getBuffer();return t}},p8=f8;function is(s){this.index=0,this.dataBuffer=s,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}is.prototype.unpack=function(){var s=this.unpack_uint8();if(s<128)return s;if((s^224)<32)return(s^224)-32;var i;if((i=s^160)<=15)return this.unpack_raw(i);if((i=s^176)<=15)return this.unpack_string(i);if((i=s^144)<=15)return this.unpack_array(i);if((i=s^128)<=15)return this.unpack_map(i);switch(s){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return i=this.unpack_uint16(),this.unpack_string(i);case 217:return i=this.unpack_uint32(),this.unpack_string(i);case 218:return i=this.unpack_uint16(),this.unpack_raw(i);case 219:return i=this.unpack_uint32(),this.unpack_raw(i);case 220:return i=this.unpack_uint16(),this.unpack_array(i);case 221:return i=this.unpack_uint32(),this.unpack_array(i);case 222:return i=this.unpack_uint16(),this.unpack_map(i);case 223:return i=this.unpack_uint32(),this.unpack_map(i)}};is.prototype.unpack_uint8=function(){var s=this.dataView[this.index]&255;return this.index++,s};is.prototype.unpack_uint16=function(){var s=this.read(2),i=(s[0]&255)*256+(s[1]&255);return this.index+=2,i};is.prototype.unpack_uint32=function(){var s=this.read(4),i=((s[0]*256+s[1])*256+s[2])*256+s[3];return this.index+=4,i};is.prototype.unpack_uint64=function(){var s=this.read(8),i=((((((s[0]*256+s[1])*256+s[2])*256+s[3])*256+s[4])*256+s[5])*256+s[6])*256+s[7];return this.index+=8,i};is.prototype.unpack_int8=function(){var s=this.unpack_uint8();return s<128?s:s-256};is.prototype.unpack_int16=function(){var s=this.unpack_uint16();return s<32768?s:s-65536};is.prototype.unpack_int32=function(){var s=this.unpack_uint32();return s<Math.pow(2,31)?s:s-Math.pow(2,32)};is.prototype.unpack_int64=function(){var s=this.unpack_uint64();return s<Math.pow(2,63)?s:s-Math.pow(2,64)};is.prototype.unpack_raw=function(s){if(this.length<this.index+s)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+s+" "+this.length);var i=this.dataBuffer.slice(this.index,this.index+s);return this.index+=s,i};is.prototype.unpack_string=function(s){for(var i=this.read(s),t=0,n="",r,o;t<s;)r=i[t],r<128?(n+=String.fromCharCode(r),t++):(r^192)<32?(o=(r^192)<<6|i[t+1]&63,n+=String.fromCharCode(o),t+=2):(o=(r&15)<<12|(i[t+1]&63)<<6|i[t+2]&63,n+=String.fromCharCode(o),t+=3);return this.index+=s,n};is.prototype.unpack_array=function(s){for(var i=new Array(s),t=0;t<s;t++)i[t]=this.unpack();return i};is.prototype.unpack_map=function(s){for(var i={},t=0;t<s;t++){var n=this.unpack(),r=this.unpack();i[n]=r}return i};is.prototype.unpack_float=function(){var s=this.unpack_uint32(),i=s>>31,t=(s>>23&255)-127,n=s&8388607|8388608;return(i===0?1:-1)*n*Math.pow(2,t-23)};is.prototype.unpack_double=function(){var s=this.unpack_uint32(),i=this.unpack_uint32(),t=s>>31,n=(s>>20&2047)-1023,r=s&1048575|1048576,o=r*Math.pow(2,n-20)+i*Math.pow(2,n-52);return(t===0?1:-1)*o};is.prototype.read=function(s){var i=this.index;if(i+s<=this.length)return this.dataView.subarray(i,i+s);throw new Error("BinaryPackFailure: read index out of range")};function ns(){this.bufferBuilder=new d8}ns.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};ns.prototype.pack=function(s){var i=typeof s;if(i==="string")this.pack_string(s);else if(i==="number")Math.floor(s)===s?this.pack_integer(s):this.pack_double(s);else if(i==="boolean")s===!0?this.bufferBuilder.append(195):s===!1&&this.bufferBuilder.append(194);else if(i==="undefined")this.bufferBuilder.append(192);else if(i==="object")if(s===null)this.bufferBuilder.append(192);else{var t=s.constructor;if(t==Array)this.pack_array(s);else if(t==Blob||t==File||s instanceof Blob||s instanceof File)this.pack_bin(s);else if(t==ArrayBuffer)CI.useArrayBufferView?this.pack_bin(new Uint8Array(s)):this.pack_bin(s);else if("BYTES_PER_ELEMENT"in s)CI.useArrayBufferView?this.pack_bin(new Uint8Array(s.buffer)):this.pack_bin(s.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(s);else if(t==Date)this.pack_string(s.toString());else if(typeof s.toBinaryPack=="function")this.bufferBuilder.append(s.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+i+'" not yet supported');this.bufferBuilder.flush()};ns.prototype.pack_bin=function(s){var i=s.length||s.byteLength||s.size;if(i<=15)this.pack_uint8(160+i);else if(i<=65535)this.bufferBuilder.append(218),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(i);else throw new Error("Invalid length");this.bufferBuilder.append(s)};ns.prototype.pack_string=function(s){var i=m8(s);if(i<=15)this.pack_uint8(176+i);else if(i<=65535)this.bufferBuilder.append(216),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(i);else throw new Error("Invalid length");this.bufferBuilder.append(s)};ns.prototype.pack_array=function(s){var i=s.length;if(i<=15)this.pack_uint8(144+i);else if(i<=65535)this.bufferBuilder.append(220),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(i);else throw new Error("Invalid length");for(var t=0;t<i;t++)this.pack(s[t])};ns.prototype.pack_integer=function(s){if(s>=-32&&s<=127)this.bufferBuilder.append(s&255);else if(s>=0&&s<=255)this.bufferBuilder.append(204),this.pack_uint8(s);else if(s>=-128&&s<=127)this.bufferBuilder.append(208),this.pack_int8(s);else if(s>=0&&s<=65535)this.bufferBuilder.append(205),this.pack_uint16(s);else if(s>=-32768&&s<=32767)this.bufferBuilder.append(209),this.pack_int16(s);else if(s>=0&&s<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(s);else if(s>=-2147483648&&s<=2147483647)this.bufferBuilder.append(210),this.pack_int32(s);else if(s>=-9223372036854776e3&&s<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(s);else if(s>=0&&s<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(s);else throw new Error("Invalid integer")};ns.prototype.pack_double=function(s){var i=0;s<0&&(i=1,s=-s);var t=Math.floor(Math.log(s)/Math.LN2),n=s/Math.pow(2,t)-1,r=Math.floor(n*Math.pow(2,52)),o=Math.pow(2,32),a=i<<31|t+1023<<20|r/o&1048575,l=r%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(l)};ns.prototype.pack_object=function(s){var i=Object.keys(s),t=i.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var n in s)s.hasOwnProperty(n)&&(this.pack(n),this.pack(s[n]))};ns.prototype.pack_uint8=function(s){this.bufferBuilder.append(s)};ns.prototype.pack_uint16=function(s){this.bufferBuilder.append(s>>8),this.bufferBuilder.append(s&255)};ns.prototype.pack_uint32=function(s){var i=s&4294967295;this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)};ns.prototype.pack_uint64=function(s){var i=s/Math.pow(2,32),t=s%Math.pow(2,32);this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};ns.prototype.pack_int8=function(s){this.bufferBuilder.append(s&255)};ns.prototype.pack_int16=function(s){this.bufferBuilder.append((s&65280)>>8),this.bufferBuilder.append(s&255)};ns.prototype.pack_int32=function(s){this.bufferBuilder.append(s>>>24&255),this.bufferBuilder.append((s&16711680)>>>16),this.bufferBuilder.append((s&65280)>>>8),this.bufferBuilder.append(s&255)};ns.prototype.pack_int64=function(s){var i=Math.floor(s/Math.pow(2,32)),t=s%Math.pow(2,32);this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function g8(s){var i=s.charCodeAt(0);return i<=2047?"00":i<=65535?"000":i<=2097151?"0000":i<=67108863?"00000":"000000"}function m8(s){return s.length>600?new Blob([s]).size:s.replace(/[^\u0000-\u007F]/g,g8).length}const SI=b0(p8);let Yk=!0,Kk=!0;function Np(s,i,t){const n=s.match(i);return n&&n.length>=t&&parseInt(n[t],10)}function zf(s,i,t){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(a,l){if(a!==i)return r.apply(this,arguments);const c=u=>{const d=t(u);d&&(l.handleEvent?l.handleEvent(d):l(d))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(l,c),r.apply(this,[a,c])};const o=n.removeEventListener;n.removeEventListener=function(a,l){if(a!==i||!this._eventMap||!this._eventMap[i])return o.apply(this,arguments);if(!this._eventMap[i].has(l))return o.apply(this,arguments);const c=this._eventMap[i].get(l);return this._eventMap[i].delete(l),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(n,"on"+i,{get(){return this["_on"+i]},set(a){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),a&&this.addEventListener(i,this["_on"+i]=a)},enumerable:!0,configurable:!0})}function A8(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Yk=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function v8(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Kk=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function SS(){if(typeof window=="object"){if(Yk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _0(s,i){Kk&&console.warn(s+" is deprecated, please use "+i+" instead.")}function y8(s){const i={browser:null,version:null};if(typeof s>"u"||!s.navigator)return i.browser="Not a browser.",i;const{navigator:t}=s;if(t.mozGetUserMedia)i.browser="firefox",i.version=Np(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection&&!s.RTCIceGatherer)i.browser="chrome",i.version=Np(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=Np(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))i.browser="safari",i.version=Np(t.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return i.browser="Not a supported browser.",i;return i}function EI(s){return Object.prototype.toString.call(s)==="[object Object]"}function Jk(s){return EI(s)?Object.keys(s).reduce(function(i,t){const n=EI(s[t]),r=n?Jk(s[t]):s[t],o=n&&!Object.keys(r).length;return r===void 0||o?i:Object.assign(i,{[t]:r})},{}):s}function ox(s,i,t){!i||t.has(i.id)||(t.set(i.id,i),Object.keys(i).forEach(n=>{n.endsWith("Id")?ox(s,s.get(i[n]),t):n.endsWith("Ids")&&i[n].forEach(r=>{ox(s,s.get(r),t)})}))}function II(s,i,t){const n=t?"outbound-rtp":"inbound-rtp",r=new Map;if(i===null)return r;const o=[];return s.forEach(a=>{a.type==="track"&&a.trackIdentifier===i.id&&o.push(a)}),o.forEach(a=>{s.forEach(l=>{l.type===n&&l.trackId===a.id&&ox(s,l,r)})}),r}const TI=SS;function Zk(s,i){const t=s&&s.navigator;if(!t.mediaDevices)return;const n=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof l[u]=="object"?l[u]:{ideal:l[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(p,g){return p?p+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(d.ideal!==void 0){c.optional=c.optional||[];let p={};typeof d.ideal=="number"?(p[f("min",u)]=d.ideal,c.optional.push(p),p={},p[f("max",u)]=d.ideal,c.optional.push(p)):(p[f("",u)]=d.ideal,c.optional.push(p))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",u)]=d.exact):["min","max"].forEach(p=>{d[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(p,u)]=d[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(i.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const u=function(d,f,p){f in d&&!(p in d)&&(d[p]=d[f],delete d[f])};l=JSON.parse(JSON.stringify(l)),u(l.audio,"autoGainControl","googAutoGainControl"),u(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=n(l.audio)}if(l&&typeof l.video=="object"){let u=l.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=i.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete l.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(p=>{p=p.filter(m=>m.kind==="videoinput");let g=p.find(m=>f.some(A=>m.label.toLowerCase().includes(A)));return!g&&p.length&&f.includes("back")&&(g=p[p.length-1]),g&&(l.video.deviceId=u.exact?{exact:g.deviceId}:{ideal:g.deviceId}),l.video=n(l.video),TI("chrome: "+JSON.stringify(l)),c(l)})}l.video=n(l.video)}return TI("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return i.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,u){r(l,d=>{t.webkitGetUserMedia(d,c,f=>{u&&u(o(f))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return r(c,u=>l(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(o(d))))}}}function b8(s,i){if(!(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices)&&s.navigator.mediaDevices){if(typeof i!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}s.navigator.mediaDevices.getDisplayMedia=function(n){return i(n).then(r=>{const o=n.video&&n.video.width,a=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:l||3}},o&&(n.video.mandatory.maxWidth=o),a&&(n.video.mandatory.maxHeight=a),s.navigator.mediaDevices.getUserMedia(n)})}}}function $k(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function eD(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let o;s.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let o;s.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else zf(s,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function tD(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const i=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,c){let u=r.apply(this,arguments);return u||(u=i(this,l),this._senders.push(u)),u};const o=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(i(this,a))})};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const n=i.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function iD(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[n,r,o]=arguments;if(arguments.length>0&&typeof n=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof n!="function"))return i.apply(this,[]);const a=function(c){const u={};return c.result().forEach(f=>{const p={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(g=>{p[g]=f.stat(g)}),u[p.id]=p}),u},l=function(c){return new Map(Object.keys(c).map(u=>[u,c[u]]))};if(arguments.length>=2){const c=function(u){r(l(a(u)))};return i.apply(this,[c,n])}return new Promise((c,u)=>{i.apply(this,[function(d){c(l(a(d)))},u])}).then(r,o)}}function nD(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(a=>a._pc=this),o});const n=s.RTCPeerConnection.prototype.addTrack;n&&(s.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),s.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>II(a,o.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r}),zf(s,"track",n=>(n.receiver._pc=n.srcElement,n)),s.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>II(o,r.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const n=arguments[0];let r,o,a;return this.getSenders().forEach(l=>{l.track===n&&(r?a=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===n&&(o?a=!0:o=l),l.track===n)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function sD(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=i.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(u=>l.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],n.apply(this,arguments)};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function rD(s,i){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&i.version>=65)return sD(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const d=t.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new s.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}n.apply(this,[d])};const r=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},s.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(A=>A===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(A=>A.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[f.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const A=new s.MediaStream([d]);this._streams[f.id]=A,this._reverseStreams[A.id]=f,this.addStream(A)}return this.getSenders().find(A=>A.track===d)};function o(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const g=u._reverseStreams[p],m=u._streams[g.id];f=f.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function a(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const g=u._reverseStreams[p],m=u._streams[g.id];f=f.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=s.RTCPeerConnection.prototype[u],f={[u](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const A=o(this,m);p[0].apply(null,[A])},m=>{p[1]&&p[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>o(this,m))}};s.RTCPeerConnection.prototype[u]=f[u]});const l=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:o(this,u)}}),s.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(A=>d.track===A)&&(p=this._streams[g])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ax(s,i){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=s.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=r[t]})}function oD(s,i){zf(s,"negotiationneeded",t=>{const n=t.target;if(!((i.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}const RI=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:oD,shimAddTrackRemoveTrack:rD,shimAddTrackRemoveTrackWithNative:sD,shimGetDisplayMedia:b8,shimGetSendersWithDtmf:tD,shimGetStats:iD,shimGetUserMedia:Zk,shimMediaStream:$k,shimOnTrack:eD,shimPeerConnection:ax,shimSenderReceiverGetStats:nD},Symbol.toStringTag,{value:"Module"}));function _8(s,i){let t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(n=>{if(n&&(n.urls||n.url)){let r=n.urls||n.url;n.url&&!n.urls&&_0("RTCIceServer.url","RTCIceServer.urls");const o=typeof r=="string";return o&&(r=[r]),r=r.filter(a=>{if(a.indexOf("stun:")===0)return!1;const l=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return l&&!t?(t=!0,!0):l&&!t}),delete n.url,n.urls=o?r[0]:r,!!r.length}})}var aD={exports:{}};(function(s){var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(t){return t.trim().split(`
`).map(function(n){return n.trim()})},i.splitSections=function(t){var n=t.split(`
m=`);return n.map(function(r,o){return(o>0?"m="+r:r).trim()+`\r
`})},i.getDescription=function(t){var n=i.splitSections(t);return n&&n[0]},i.getMediaSections=function(t){var n=i.splitSections(t);return n.shift(),n},i.matchPrefix=function(t,n){return i.splitLines(t).filter(function(r){return r.indexOf(n)===0})},i.parseCandidate=function(t){var n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");for(var r={foundation:n[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},o=8;o<n.length;o+=2)switch(n[o]){case"raddr":r.relatedAddress=n[o+1];break;case"rport":r.relatedPort=parseInt(n[o+1],10);break;case"tcptype":r.tcpType=n[o+1];break;case"ufrag":r.ufrag=n[o+1],r.usernameFragment=n[o+1];break;default:r[n[o]]=n[o+1];break}return r},i.writeCandidate=function(t){var n=[];n.push(t.foundation),n.push(t.component),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);var r=t.type;return n.push("typ"),n.push(r),r!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},i.parseIceOptions=function(t){return t.substr(14).split(" ")},i.parseRtpMap=function(t){var n=t.substr(9).split(" "),r={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),r.name=n[0],r.clockRate=parseInt(n[1],10),r.channels=n.length===3?parseInt(n[2],10):1,r.numChannels=r.channels,r},i.writeRtpMap=function(t){var n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);var r=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},i.parseExtmap=function(t){var n=t.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},i.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},i.parseFmtp=function(t){for(var n={},r,o=t.substr(t.indexOf(" ")+1).split(";"),a=0;a<o.length;a++)r=o[a].trim().split("="),n[r[0].trim()]=r[1];return n},i.writeFmtp=function(t){var n="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var o=[];Object.keys(t.parameters).forEach(function(a){t.parameters[a]?o.push(a+"="+t.parameters[a]):o.push(a)}),n+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return n},i.parseRtcpFb=function(t){var n=t.substr(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},i.writeRtcpFb=function(t){var n="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(o){n+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},i.parseSsrcMedia=function(t){var n=t.indexOf(" "),r={ssrc:parseInt(t.substr(7,n-7),10)},o=t.indexOf(":",n);return o>-1?(r.attribute=t.substr(n+1,o-n-1),r.value=t.substr(o+1)):r.attribute=t.substr(n+1),r},i.parseSsrcGroup=function(t){var n=t.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(r){return parseInt(r,10)})}},i.getMid=function(t){var n=i.matchPrefix(t,"a=mid:")[0];if(n)return n.substr(6)},i.parseFingerprint=function(t){var n=t.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},i.getDtlsParameters=function(t,n){var r=i.matchPrefix(t+n,"a=fingerprint:");return{role:"auto",fingerprints:r.map(i.parseFingerprint)}},i.writeDtlsParameters=function(t,n){var r="a=setup:"+n+`\r
`;return t.fingerprints.forEach(function(o){r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},i.parseCryptoLine=function(t){var n=t.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},i.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?i.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var n=t.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},i.getCryptoParameters=function(t,n){var r=i.matchPrefix(t+n,"a=crypto:");return r.map(i.parseCryptoLine)},i.getIceParameters=function(t,n){var r=i.matchPrefix(t+n,"a=ice-ufrag:")[0],o=i.matchPrefix(t+n,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},i.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},i.parseRtpParameters=function(t){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=i.splitLines(t),o=r[0].split(" "),a=3;a<o.length;a++){var l=o[a],c=i.matchPrefix(t,"a=rtpmap:"+l+" ")[0];if(c){var u=i.parseRtpMap(c),d=i.matchPrefix(t,"a=fmtp:"+l+" ");switch(u.parameters=d.length?i.parseFmtp(d[0]):{},u.rtcpFeedback=i.matchPrefix(t,"a=rtcp-fb:"+l+" ").map(i.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase());break}}}return i.matchPrefix(t,"a=extmap:").forEach(function(f){n.headerExtensions.push(i.parseExtmap(f))}),n},i.writeRtpDescription=function(t,n){var r="";r+="m="+t+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map(function(a){return a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType}).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(function(a){r+=i.writeRtpMap(a),r+=i.writeFmtp(a),r+=i.writeRtcpFb(a)});var o=0;return n.codecs.forEach(function(a){a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),r+=`a=rtcp-mux\r
`,n.headerExtensions&&n.headerExtensions.forEach(function(a){r+=i.writeExtmap(a)}),r},i.parseRtpEncodingParameters=function(t){var n=[],r=i.parseRtpParameters(t),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=i.matchPrefix(t,"a=ssrc:").map(function(p){return i.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="cname"}),c=l.length>0&&l[0].ssrc,u,d=i.matchPrefix(t,"a=ssrc-group:FID").map(function(p){var g=p.substr(17).split(" ");return g.map(function(m){return parseInt(m,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(u=d[0][1]),r.codecs.forEach(function(p){if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){var g={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&u&&(g.rtx={ssrc:u}),n.push(g),o&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(g))}}),n.length===0&&c&&n.push({ssrc:c});var f=i.matchPrefix(t,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substr(5),10)*1e3*.95-50*40*8:f=void 0,n.forEach(function(p){p.maxBitrate=f})),n},i.parseRtcpParameters=function(t){var n={},r=i.matchPrefix(t,"a=ssrc:").map(function(l){return i.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"})[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var o=i.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;var a=i.matchPrefix(t,"a=rtcp-mux");return n.mux=a.length>0,n},i.parseMsid=function(t){var n,r=i.matchPrefix(t,"a=msid:");if(r.length===1)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};var o=i.matchPrefix(t,"a=ssrc:").map(function(a){return i.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="msid"});if(o.length>0)return n=o[0].value.split(" "),{stream:n[0],track:n[1]}},i.parseSctpDescription=function(t){var n=i.parseMLine(t),r=i.matchPrefix(t,"a=max-message-size:"),o;r.length>0&&(o=parseInt(r[0].substr(19),10)),isNaN(o)&&(o=65536);var a=i.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:o};var l=i.matchPrefix(t,"a=sctpmap:");if(l.length>0){var c=i.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},i.writeSctpDescription=function(t,n){var r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&r.push("a=max-message-size:"+n.maxMessageSize+`\r
`),r.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(t,n,r){var o,a=n!==void 0?n:2;t?o=t:o=i.generateSessionId();var l=r||"thisisadapterortc";return`v=0\r
o=`+l+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.writeMediaSection=function(t,n,r,o){var a=i.writeRtpDescription(t.kind,n);if(a+=i.writeIceParameters(t.iceGatherer.getLocalParameters()),a+=i.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),a+="a=mid:"+t.mid+`\r
`,t.direction?a+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?a+=`a=sendrecv\r
`:t.rtpSender?a+=`a=sendonly\r
`:t.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,t.rtpSender){var l="msid:"+o.id+" "+t.rtpSender.track.id+`\r
`;a+="a="+l,a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+l,t.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+l,a+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+`\r
`),a},i.getDirection=function(t,n){for(var r=i.splitLines(t),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return n?i.getDirection(n):"sendrecv"},i.getKind=function(t){var n=i.splitLines(t),r=n[0].split(" ");return r[0].substr(2)},i.isRejected=function(t){return t.split(" ",2)[1]==="0"},i.parseMLine=function(t){var n=i.splitLines(t),r=n[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},i.parseOLine=function(t){var n=i.matchPrefix(t,"o=")[0],r=n.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},i.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var n=i.splitLines(t),r=0;r<n.length;r++)if(n[r].length<2||n[r].charAt(1)!=="=")return!1;return!0},s.exports=i})(aD);var lD=aD.exports;const bv=b0(lD);var We=lD;function w8(s){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[s.type]||s.type}function BI(s,i,t,n,r){var o=We.writeRtpDescription(s.kind,i);if(o+=We.writeIceParameters(s.iceGatherer.getLocalParameters()),o+=We.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":r||"active"),o+="a=mid:"+s.mid+`\r
`,s.rtpSender&&s.rtpReceiver?o+=`a=sendrecv\r
`:s.rtpSender?o+=`a=sendonly\r
`:s.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,s.rtpSender){var a=s.rtpSender._initialTrackId||s.rtpSender.track.id;s.rtpSender._initialTrackId=a;var l="msid:"+(n?n.id:"-")+" "+a+`\r
`;o+="a="+l,o+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+l,s.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+l,o+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+We.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+We.localCName+`\r
`),o}function x8(s,i){var t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(function(n){if(n&&(n.urls||n.url)){var r=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof r=="string";return o&&(r=[r]),r=r.filter(function(a){var l=a.indexOf("turn:")===0&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!t;return l?(t=!0,!0):a.indexOf("stun:")===0&&i>=14393&&a.indexOf("?transport=udp")===-1}),delete n.url,n.urls=o?r[0]:r,!!r.length}})}function bA(s,i){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(o,a){o=parseInt(o,10);for(var l=0;l<a.length;l++)if(a[l].payloadType===o||a[l].preferredPayloadType===o)return a[l]},r=function(o,a,l,c){var u=n(o.parameters.apt,l),d=n(a.parameters.apt,c);return u&&d&&u.name.toLowerCase()===d.name.toLowerCase()};return s.codecs.forEach(function(o){for(var a=0;a<i.codecs.length;a++){var l=i.codecs[a];if(o.name.toLowerCase()===l.name.toLowerCase()&&o.clockRate===l.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&l.parameters.apt&&!r(o,l,s.codecs,i.codecs))continue;l=JSON.parse(JSON.stringify(l)),l.numChannels=Math.min(o.numChannels,l.numChannels),t.codecs.push(l),l.rtcpFeedback=l.rtcpFeedback.filter(function(c){for(var u=0;u<o.rtcpFeedback.length;u++)if(o.rtcpFeedback[u].type===c.type&&o.rtcpFeedback[u].parameter===c.parameter)return!0;return!1});break}}}),s.headerExtensions.forEach(function(o){for(var a=0;a<i.headerExtensions.length;a++){var l=i.headerExtensions[a];if(o.uri===l.uri){t.headerExtensions.push(l);break}}}),t}function PI(s,i,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[i][s].indexOf(t)!==-1}function l_(s,i){var t=s.getRemoteCandidates().find(function(n){return i.foundation===n.foundation&&i.ip===n.ip&&i.port===n.port&&i.priority===n.priority&&i.protocol===n.protocol&&i.type===n.type});return t||s.addRemoteCandidate(i),!t}function ls(s,i){var t=new Error(i);return t.name=s,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[s],t}var C8=function(s,i){function t(c,u){u.addTrack(c),u.dispatchEvent(new s.MediaStreamTrackEvent("addtrack",{track:c}))}function n(c,u){u.removeTrack(c),u.dispatchEvent(new s.MediaStreamTrackEvent("removetrack",{track:c}))}function r(c,u,d,f){var p=new Event("track");p.track=u,p.receiver=d,p.transceiver={receiver:d},p.streams=f,s.setTimeout(function(){c._dispatchEvent("track",p)})}var o=function(c){var u=this,d=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(p){u[p]=d[p].bind(d)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw ls("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=x8(c.iceServers||[],i),this._iceGatherers=[],c.iceCandidatePoolSize)for(var f=c.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new s.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=We.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(c,u){this._isClosed||(this.dispatchEvent(u),typeof this["on"+c]=="function"&&this["on"+c](u))},o.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(c,u){var d=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&d)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var p=this._createIceAndDtlsTransports();f.iceTransport=p.iceTransport,f.dtlsTransport=p.dtlsTransport}return u||this.transceivers.push(f),f},o.prototype.addTrack=function(c,u){if(this._isClosed)throw ls("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(g){return g.track===c});if(d)throw ls("InvalidAccessError","Track already exists.");for(var f,p=0;p<this.transceivers.length;p++)!this.transceivers[p].track&&this.transceivers[p].kind===c.kind&&(f=this.transceivers[p]);return f||(f=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(u)===-1&&this.localStreams.push(u),f.track=c,f.stream=u,f.rtpSender=new s.RTCRtpSender(c,f.dtlsTransport),f.rtpSender},o.prototype.addStream=function(c){var u=this;if(i>=15025)c.getTracks().forEach(function(f){u.addTrack(f,c)});else{var d=c.clone();c.getTracks().forEach(function(f,p){var g=d.getTracks()[p];f.addEventListener("enabled",function(m){g.enabled=m.enabled})}),d.getTracks().forEach(function(f){u.addTrack(f,d)})}},o.prototype.removeTrack=function(c){if(this._isClosed)throw ls("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof s.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var u=this.transceivers.find(function(p){return p.rtpSender===c});if(!u)throw ls("InvalidAccessError","Sender was not created by this connection.");var d=u.stream;u.rtpSender.stop(),u.rtpSender=null,u.track=null,u.stream=null;var f=this.transceivers.map(function(p){return p.stream});f.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(c){var u=this;c.getTracks().forEach(function(d){var f=u.getSenders().find(function(p){return p.track===d});f&&u.removeTrack(f)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},o.prototype._createIceGatherer=function(c,u){var d=this;if(u&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new s.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(p){var g=!p.candidate||Object.keys(p.candidate).length===0;f.state=g?"completed":"gathering",d.transceivers[c].bufferedCandidateEvents!==null&&d.transceivers[c].bufferedCandidateEvents.push(p)},f.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),f},o.prototype._gather=function(c,u){var d=this,f=this.transceivers[u].iceGatherer;if(!f.onlocalcandidate){var p=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),f.onlocalcandidate=function(g){if(!(d.usingBundle&&u>0)){var m=new Event("icecandidate");m.candidate={sdpMid:c,sdpMLineIndex:u};var A=g.candidate,y=!A||Object.keys(A).length===0;if(y)(f.state==="new"||f.state==="gathering")&&(f.state="completed");else{f.state==="new"&&(f.state="gathering"),A.component=1,A.ufrag=f.getLocalParameters().usernameFragment;var b=We.writeCandidate(A);m.candidate=Object.assign(m.candidate,We.parseCandidate(b)),m.candidate.candidate=b,m.candidate.toJSON=function(){return{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex,usernameFragment:m.candidate.usernameFragment}}}var _=We.getMediaSections(d._localDescription.sdp);y?_[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:_[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,d._localDescription.sdp=We.getDescription(d._localDescription.sdp)+_.join("");var w=d.transceivers.every(function(S){return S.iceGatherer&&S.iceGatherer.state==="completed"});d.iceGatheringState!=="gathering"&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),y||d._dispatchEvent("icecandidate",m),w&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},s.setTimeout(function(){p.forEach(function(g){f.onlocalcandidate(g)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var c=this,u=new s.RTCIceTransport(null);u.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var d=new s.RTCDtlsTransport(u);return d.ondtlsstatechange=function(){c._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:u,dtlsTransport:d}},o.prototype._disposeIceAndDtlsTransports=function(c){var u=this.transceivers[c].iceGatherer;u&&(delete u.onlocalcandidate,delete this.transceivers[c].iceGatherer);var d=this.transceivers[c].iceTransport;d&&(delete d.onicestatechange,delete this.transceivers[c].iceTransport);var f=this.transceivers[c].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[c].dtlsTransport)},o.prototype._transceive=function(c,u,d){var f=bA(c.localCapabilities,c.remoteCapabilities);u&&c.rtpSender&&(f.encodings=c.sendEncodingParameters,f.rtcp={cname:We.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(f.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(f)),d&&c.rtpReceiver&&f.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&i<15019&&c.recvEncodingParameters.forEach(function(p){delete p.rtx}),c.recvEncodingParameters.length?f.encodings=c.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(f.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(f.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(f))},o.prototype.setLocalDescription=function(c){var u=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(ls("TypeError",'Unsupported type "'+c.type+'"'));if(!PI("setLocalDescription",c.type,u.signalingState)||u._isClosed)return Promise.reject(ls("InvalidStateError","Can not set local "+c.type+" in state "+u.signalingState));var d,f;if(c.type==="offer")d=We.splitSections(c.sdp),f=d.shift(),d.forEach(function(g,m){var A=We.parseRtpParameters(g);u.transceivers[m].localCapabilities=A}),u.transceivers.forEach(function(g,m){u._gather(g.mid,m)});else if(c.type==="answer"){d=We.splitSections(u._remoteDescription.sdp),f=d.shift();var p=We.matchPrefix(f,"a=ice-lite").length>0;d.forEach(function(g,m){var A=u.transceivers[m],y=A.iceGatherer,b=A.iceTransport,_=A.dtlsTransport,w=A.localCapabilities,S=A.remoteCapabilities,E=We.isRejected(g)&&We.matchPrefix(g,"a=bundle-only").length===0;if(!E&&!A.rejected){var I=We.getIceParameters(g,f),k=We.getDtlsParameters(g,f);p&&(k.role="server"),(!u.usingBundle||m===0)&&(u._gather(A.mid,m),b.state==="new"&&b.start(y,I,p?"controlling":"controlled"),_.state==="new"&&_.start(k));var T=bA(w,S);u._transceive(A,T.codecs.length>0,!1)}})}return u._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?u._updateSignalingState("have-local-offer"):u._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(c){var u=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(ls("TypeError",'Unsupported type "'+c.type+'"'));if(!PI("setRemoteDescription",c.type,u.signalingState)||u._isClosed)return Promise.reject(ls("InvalidStateError","Can not set remote "+c.type+" in state "+u.signalingState));var d={};u.remoteStreams.forEach(function(b){d[b.id]=b});var f=[],p=We.splitSections(c.sdp),g=p.shift(),m=We.matchPrefix(g,"a=ice-lite").length>0,A=We.matchPrefix(g,"a=group:BUNDLE ").length>0;u.usingBundle=A;var y=We.matchPrefix(g,"a=ice-options:")[0];return y?u.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:u.canTrickleIceCandidates=!1,p.forEach(function(b,_){var w=We.splitLines(b),S=We.getKind(b),E=We.isRejected(b)&&We.matchPrefix(b,"a=bundle-only").length===0,I=w[0].substr(2).split(" ")[2],k=We.getDirection(b,g),T=We.parseMsid(b),P=We.getMid(b)||We.generateIdentifier();if(E||S==="application"&&(I==="DTLS/SCTP"||I==="UDP/DTLS/SCTP")){u.transceivers[_]={mid:P,kind:S,protocol:I,rejected:!0};return}!E&&u.transceivers[_]&&u.transceivers[_].rejected&&(u.transceivers[_]=u._createTransceiver(S,!0));var B,M,U,G,W,Y,D,L,V,te=We.parseRtpParameters(b),K,ue;E||(K=We.getIceParameters(b,g),ue=We.getDtlsParameters(b,g),ue.role="client"),D=We.parseRtpEncodingParameters(b);var de=We.parseRtcpParameters(b),_e=We.matchPrefix(b,"a=end-of-candidates",g).length>0,Ee=We.matchPrefix(b,"a=candidate:").map(function(Tt){return We.parseCandidate(Tt)}).filter(function(Tt){return Tt.component===1});if((c.type==="offer"||c.type==="answer")&&!E&&A&&_>0&&u.transceivers[_]&&(u._disposeIceAndDtlsTransports(_),u.transceivers[_].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[_].iceTransport=u.transceivers[0].iceTransport,u.transceivers[_].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[_].rtpSender&&u.transceivers[_].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[_].rtpReceiver&&u.transceivers[_].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),c.type==="offer"&&!E){B=u.transceivers[_]||u._createTransceiver(S),B.mid=P,B.iceGatherer||(B.iceGatherer=u._createIceGatherer(_,A)),Ee.length&&B.iceTransport.state==="new"&&(_e&&(!A||_===0)?B.iceTransport.setRemoteCandidates(Ee):Ee.forEach(function(Tt){l_(B.iceTransport,Tt)})),L=s.RTCRtpReceiver.getCapabilities(S),i<15019&&(L.codecs=L.codecs.filter(function(Tt){return Tt.name!=="rtx"})),Y=B.sendEncodingParameters||[{ssrc:(2*_+2)*1001}];var Xe=!1;if(k==="sendrecv"||k==="sendonly"){if(Xe=!B.rtpReceiver,W=B.rtpReceiver||new s.RTCRtpReceiver(B.dtlsTransport,S),Xe){var Me;V=W.track,T&&T.stream==="-"||(T?(d[T.stream]||(d[T.stream]=new s.MediaStream,Object.defineProperty(d[T.stream],"id",{get:function(){return T.stream}})),Object.defineProperty(V,"id",{get:function(){return T.track}}),Me=d[T.stream]):(d.default||(d.default=new s.MediaStream),Me=d.default)),Me&&(t(V,Me),B.associatedRemoteMediaStreams.push(Me)),f.push([V,W,Me])}}else B.rtpReceiver&&B.rtpReceiver.track&&(B.associatedRemoteMediaStreams.forEach(function(Tt){var hi=Tt.getTracks().find(function(Ei){return Ei.id===B.rtpReceiver.track.id});hi&&n(hi,Tt)}),B.associatedRemoteMediaStreams=[]);B.localCapabilities=L,B.remoteCapabilities=te,B.rtpReceiver=W,B.rtcpParameters=de,B.sendEncodingParameters=Y,B.recvEncodingParameters=D,u._transceive(u.transceivers[_],!1,Xe)}else if(c.type==="answer"&&!E){B=u.transceivers[_],M=B.iceGatherer,U=B.iceTransport,G=B.dtlsTransport,W=B.rtpReceiver,Y=B.sendEncodingParameters,L=B.localCapabilities,u.transceivers[_].recvEncodingParameters=D,u.transceivers[_].remoteCapabilities=te,u.transceivers[_].rtcpParameters=de,Ee.length&&U.state==="new"&&((m||_e)&&(!A||_===0)?U.setRemoteCandidates(Ee):Ee.forEach(function(Tt){l_(B.iceTransport,Tt)})),(!A||_===0)&&(U.state==="new"&&U.start(M,K,"controlling"),G.state==="new"&&G.start(ue));var Ke=bA(B.localCapabilities,B.remoteCapabilities),Pt=Ke.codecs.filter(function(Tt){return Tt.name.toLowerCase()==="rtx"}).length;!Pt&&B.sendEncodingParameters[0].rtx&&delete B.sendEncodingParameters[0].rtx,u._transceive(B,k==="sendrecv"||k==="recvonly",k==="sendrecv"||k==="sendonly"),W&&(k==="sendrecv"||k==="sendonly")?(V=W.track,T?(d[T.stream]||(d[T.stream]=new s.MediaStream),t(V,d[T.stream]),f.push([V,W,d[T.stream]])):(d.default||(d.default=new s.MediaStream),t(V,d.default),f.push([V,W,d.default]))):delete B.rtpReceiver}}),u._dtlsRole===void 0&&(u._dtlsRole=c.type==="offer"?"active":"passive"),u._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(d).forEach(function(b){var _=d[b];if(_.getTracks().length){if(u.remoteStreams.indexOf(_)===-1){u.remoteStreams.push(_);var w=new Event("addstream");w.stream=_,s.setTimeout(function(){u._dispatchEvent("addstream",w)})}f.forEach(function(S){var E=S[0],I=S[1];_.id===S[2].id&&r(u,E,I,[_])})}}),f.forEach(function(b){b[2]||r(u,b[0],b[1],[])}),s.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(b){b.iceTransport&&b.iceTransport.state==="new"&&b.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),b.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(c){this.signalingState=c;var u=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",u)},o.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,s.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var u=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",u)}},0))},o.prototype._updateIceConnectionState=function(){var c,u={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&u[f.iceTransport.state]++}),c="new",u.failed>0?c="failed":u.checking>0?c="checking":u.disconnected>0?c="disconnected":u.new>0?c="new":u.connected>0?c="connected":u.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var d=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",d)}},o.prototype._updateConnectionState=function(){var c,u={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(u[f.iceTransport.state]++,u[f.dtlsTransport.state]++)}),u.connected+=u.completed,c="new",u.failed>0?c="failed":u.connecting>0?c="connecting":u.disconnected>0?c="disconnected":u.new>0?c="new":u.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var d=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",d)}},o.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(ls("InvalidStateError","Can not call createOffer after close"));var u=c.transceivers.filter(function(m){return m.kind==="audio"}).length,d=c.transceivers.filter(function(m){return m.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(f.offerToReceiveAudio===!0?u=1:f.offerToReceiveAudio===!1?u=0:u=f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(f.offerToReceiveVideo===!0?d=1:f.offerToReceiveVideo===!1?d=0:d=f.offerToReceiveVideo)}for(c.transceivers.forEach(function(m){m.kind==="audio"?(u--,u<0&&(m.wantReceive=!1)):m.kind==="video"&&(d--,d<0&&(m.wantReceive=!1))});u>0||d>0;)u>0&&(c._createTransceiver("audio"),u--),d>0&&(c._createTransceiver("video"),d--);var p=We.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(m,A){var y=m.track,b=m.kind,_=m.mid||We.generateIdentifier();m.mid=_,m.iceGatherer||(m.iceGatherer=c._createIceGatherer(A,c.usingBundle));var w=s.RTCRtpSender.getCapabilities(b);i<15019&&(w.codecs=w.codecs.filter(function(E){return E.name!=="rtx"})),w.codecs.forEach(function(E){E.name==="H264"&&E.parameters["level-asymmetry-allowed"]===void 0&&(E.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(I){E.name.toLowerCase()===I.name.toLowerCase()&&E.clockRate===I.clockRate&&(E.preferredPayloadType=I.payloadType)})}),w.headerExtensions.forEach(function(E){var I=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];I.forEach(function(k){E.uri===k.uri&&(E.id=k.id)})});var S=m.sendEncodingParameters||[{ssrc:(2*A+1)*1001}];y&&i>=15019&&b==="video"&&!S[0].rtx&&(S[0].rtx={ssrc:S[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new s.RTCRtpReceiver(m.dtlsTransport,b)),m.localCapabilities=w,m.sendEncodingParameters=S}),c._config.bundlePolicy!=="max-compat"&&(p+="a=group:BUNDLE "+c.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),p+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(m,A){p+=BI(m,m.localCapabilities,"offer",m.stream,c._dtlsRole),p+=`a=rtcp-rsize\r
`,m.iceGatherer&&c.iceGatheringState!=="new"&&(A===0||!c.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,p+="a="+We.writeCandidate(y)+`\r
`}),m.iceGatherer.state==="completed"&&(p+=`a=end-of-candidates\r
`))});var g=new s.RTCSessionDescription({type:"offer",sdp:p});return Promise.resolve(g)},o.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(ls("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(ls("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var u=We.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(u+="a=group:BUNDLE "+c.transceivers.map(function(p){return p.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`;var d=We.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(p,g){if(!(g+1>d)){if(p.rejected){p.kind==="application"?p.protocol==="DTLS/SCTP"?u+=`m=application 0 DTLS/SCTP 5000\r
`:u+="m=application 0 "+p.protocol+` webrtc-datachannel\r
`:p.kind==="audio"?u+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:p.kind==="video"&&(u+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),u+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+p.mid+`\r
`;return}if(p.stream){var m;p.kind==="audio"?m=p.stream.getAudioTracks()[0]:p.kind==="video"&&(m=p.stream.getVideoTracks()[0]),m&&i>=15019&&p.kind==="video"&&!p.sendEncodingParameters[0].rtx&&(p.sendEncodingParameters[0].rtx={ssrc:p.sendEncodingParameters[0].ssrc+1})}var A=bA(p.localCapabilities,p.remoteCapabilities),y=A.codecs.filter(function(b){return b.name.toLowerCase()==="rtx"}).length;!y&&p.sendEncodingParameters[0].rtx&&delete p.sendEncodingParameters[0].rtx,u+=BI(p,A,"answer",p.stream,c._dtlsRole),p.rtcpParameters&&p.rtcpParameters.reducedSize&&(u+=`a=rtcp-rsize\r
`)}});var f=new s.RTCSessionDescription({type:"answer",sdp:u});return Promise.resolve(f)},o.prototype.addIceCandidate=function(c){var u=this,d;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,p){if(u._remoteDescription)if(!c||c.candidate==="")for(var g=0;g<u.transceivers.length&&!(!u.transceivers[g].rejected&&(u.transceivers[g].iceTransport.addRemoteCandidate({}),d=We.getMediaSections(u._remoteDescription.sdp),d[g]+=`a=end-of-candidates\r
`,u._remoteDescription.sdp=We.getDescription(u._remoteDescription.sdp)+d.join(""),u.usingBundle));g++);else{var m=c.sdpMLineIndex;if(c.sdpMid){for(var A=0;A<u.transceivers.length;A++)if(u.transceivers[A].mid===c.sdpMid){m=A;break}}var y=u.transceivers[m];if(y){if(y.rejected)return f();var b=Object.keys(c.candidate).length>0?We.parseCandidate(c.candidate):{};if(b.protocol==="tcp"&&(b.port===0||b.port===9)||b.component&&b.component!==1)return f();if((m===0||m>0&&y.iceTransport!==u.transceivers[0].iceTransport)&&!l_(y.iceTransport,b))return p(ls("OperationError","Can not add ICE candidate"));var _=c.candidate.trim();_.indexOf("a=")===0&&(_=_.substr(2)),d=We.getMediaSections(u._remoteDescription.sdp),d[m]+="a="+(b.type?_:"end-of-candidates")+`\r
`,u._remoteDescription.sdp=We.getDescription(u._remoteDescription.sdp)+d.join("")}else return p(ls("OperationError","Can not add ICE candidate"))}else return p(ls("InvalidStateError","Can not add ICE candidate without a remote description"));f()})},o.prototype.getStats=function(c){if(c&&c instanceof s.MediaStreamTrack){var u=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===c?u=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===c&&(u=f.rtpReceiver)}),!u)throw ls("InvalidAccessError","Invalid selector.");return u.getStats()}var d=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(p){f[p]&&d.push(f[p].getStats())})}),Promise.all(d).then(function(f){var p=new Map;return f.forEach(function(g){g.forEach(function(m){p.set(m.id,m)})}),p})};var a=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];a.forEach(function(c){var u=s[c];if(u&&u.prototype&&u.prototype.getStats){var d=u.prototype.getStats;u.prototype.getStats=function(){return d.apply(this).then(function(f){var p=new Map;return Object.keys(f).forEach(function(g){f[g].type=w8(f[g]),p.set(g,f[g])}),p})}}});var l=["createOffer","createAnswer"];return l.forEach(function(c){var u=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[0]=="function"||typeof d[1]=="function"?u.apply(this,[arguments[2]]).then(function(f){typeof d[0]=="function"&&d[0].apply(null,[f])},function(f){typeof d[1]=="function"&&d[1].apply(null,[f])}):u.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(c){var u=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"||typeof d[2]=="function"?u.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)},function(f){typeof d[2]=="function"&&d[2].apply(null,[f])}):u.apply(this,arguments)}}),["getStats"].forEach(function(c){var u=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"?u.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)}):u.apply(this,arguments)}}),o};const S8=b0(C8);function cD(s){const i=s&&s.navigator,t=function(r){return{name:{PermissionDeniedError:"NotAllowedError"}[r.name]||r.name,message:r.message,constraint:r.constraint,toString(){return this.name}}},n=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(r){return n(r).catch(o=>Promise.reject(t(o)))}}function hD(s){"getDisplayMedia"in s.navigator&&s.navigator.mediaDevices&&(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=s.navigator.getDisplayMedia.bind(s.navigator)))}function lx(s,i){if(s.RTCIceGatherer&&(s.RTCIceCandidate||(s.RTCIceCandidate=function(r){return r}),s.RTCSessionDescription||(s.RTCSessionDescription=function(r){return r}),i.version<15025)){const n=Object.getOwnPropertyDescriptor(s.MediaStreamTrack.prototype,"enabled");Object.defineProperty(s.MediaStreamTrack.prototype,"enabled",{set(r){n.set.call(this,r);const o=new Event("enabled");o.enabled=r,this.dispatchEvent(o)}})}s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)&&Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new s.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),s.RTCDtmfSender&&!s.RTCDTMFSender&&(s.RTCDTMFSender=s.RTCDtmfSender);const t=S8(s,i.version);s.RTCPeerConnection=function(r){return r&&r.iceServers&&(r.iceServers=_8(r.iceServers,i.version),SS("ICE servers after filtering:",r.iceServers)),new t(r)},s.RTCPeerConnection.prototype=t.prototype}function uD(s){s.RTCRtpSender&&!("replaceTrack"in s.RTCRtpSender.prototype)&&(s.RTCRtpSender.prototype.replaceTrack=s.RTCRtpSender.prototype.setTrack)}const MI=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:hD,shimGetUserMedia:cD,shimPeerConnection:lx,shimReplaceTrack:uD},Symbol.toStringTag,{value:"Module"}));function dD(s,i){const t=s&&s.navigator,n=s&&s.MediaStreamTrack;if(t.getUserMedia=function(r,o,a){_0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(o,a)},!(i.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},n&&n.prototype.getSettings){const a=n.prototype.getSettings;n.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(n&&n.prototype.applyConstraints){const a=n.prototype.applyConstraints;n.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function E8(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:i}:n.video.mediaSource=i,s.navigator.mediaDevices.getUserMedia(n)})}function fD(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cx(s,i){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=s.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=a[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return n.apply(this,[o||null]).then(c=>{if(i.version<53&&!a)try{c.forEach(u=>{u.type=t[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((d,f)=>{c.set(f,Object.assign({},d,{type:t[d.type]||d.type}))})}return c}).then(a,l)}}function pD(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(o=>o._pc=this),r});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function gD(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(r=>r._pc=this),n}),zf(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function mD(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){_0("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function AD(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function vD(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const i=s.RTCPeerConnection.prototype.addTransceiver;i&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],r=n&&"sendEncodings"in n;r&&n.sendEncodings.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=i.apply(this,arguments);if(r){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n.sendEncodings,a.sendEncodings=n.sendEncodings,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function yD(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const i=s.RTCRtpSender.prototype.getParameters;i&&(s.RTCRtpSender.prototype.getParameters=function(){const n=i.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function bD(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function _D(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const i=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}const kI=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:vD,shimCreateAnswer:_D,shimCreateOffer:bD,shimGetDisplayMedia:E8,shimGetParameters:yD,shimGetUserMedia:dD,shimOnTrack:fD,shimPeerConnection:cx,shimRTCDataChannel:AD,shimReceiverGetStats:gD,shimRemoveStream:mD,shimSenderGetStats:pD},Symbol.toStringTag,{value:"Module"}));function wD(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>i.call(this,r,n)),n.getVideoTracks().forEach(r=>i.call(this,r,n))},s.RTCPeerConnection.prototype.addTrack=function(n,...r){return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),i.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function xD(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,n.dispatchEvent(a)})}),i.apply(n,arguments)}}}function CD(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,t=i.createOffer,n=i.createAnswer,r=i.setLocalDescription,o=i.setRemoteDescription,a=i.addIceCandidate;i.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],p=t.apply(this,[f]);return d?(p.then(u,d),Promise.resolve()):p},i.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[f]);return d?(p.then(u,d),Promise.resolve()):p};let l=function(c,u,d){const f=r.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f};i.setLocalDescription=l,l=function(c,u,d){const f=o.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f},i.setRemoteDescription=l,l=function(c,u,d){const f=a.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f},i.addIceCandidate=l}function SD(s){const i=s&&s.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const t=i.mediaDevices,n=t.getUserMedia.bind(t);i.mediaDevices.getUserMedia=r=>n(ED(r))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(n,r,o){i.mediaDevices.getUserMedia(n).then(r,o)}.bind(i))}function ED(s){return s&&s.video!==void 0?Object.assign({},s,{video:Jk(s.video)}):s}function ID(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection;s.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const o=[];for(let a=0;a<n.iceServers.length;a++){let l=n.iceServers[a];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(_0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(n.iceServers[a])}n.iceServers=o}return new i(n,r)},s.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return i.generateCertificate}})}function TD(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function RD(s){const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video")}return i.apply(this,arguments)}}function BD(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const DI=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:BD,shimCallbacksAPI:CD,shimConstraints:ED,shimCreateOfferLegacy:RD,shimGetUserMedia:SD,shimLocalStreamsAPI:wD,shimRTCIceServerUrls:ID,shimRemoteStreamsAPI:xD,shimTrackEventTransceiver:TD},Symbol.toStringTag,{value:"Module"}));function _v(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const i=s.RTCIceCandidate;s.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new i(n),o=bv.parseCandidate(n.candidate),a=Object.assign(r,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new i(n)},s.RTCIceCandidate.prototype=i.prototype,zf(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function zp(s,i){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const c=bv.splitSections(l.sdp);return c.shift(),c.some(u=>{const d=bv.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},n=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},r=function(l){let c=65536;return i.browser==="firefox"&&(i.version<57?l===-1?c=16384:c=2147483637:i.version<60?c=i.version===57?65535:65536:c=2147483637),c},o=function(l,c){let u=65536;i.browser==="firefox"&&i.version===57&&(u=65535);const d=bv.matchPrefix(l.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substr(19),10):i.browser==="firefox"&&c!==-1&&(u=2147483637),u},a=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=n(arguments[0]),u=r(c),d=o(arguments[0],c);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return f}}),this._sctp=p}return a.apply(this,arguments)}}function Qp(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function i(n,r){const o=n.send;n.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(n.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return i(r,this),r},zf(s,"datachannel",n=>(i(n.channel,n.target),n))}function hx(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const i=s.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=i[t];i[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function ux(s,i){if(!s.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&r instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return t.apply(this,arguments)}}function wv(s,i){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const I8=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ux,shimAddIceCandidateNullOrEmpty:wv,shimConnectionState:hx,shimMaxMessageSize:zp,shimRTCIceCandidate:_v,shimSendThrowTypeError:Qp},Symbol.toStringTag,{value:"Module"}));function T8({window:s}={},i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=SS,n=y8(s),r={browserDetails:n,commonShim:I8,extractVersion:Np,disableLog:A8,disableWarnings:v8};switch(n.browser){case"chrome":if(!RI||!ax||!i.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=RI,wv(s,n),Zk(s,n),$k(s),ax(s,n),eD(s),rD(s,n),tD(s),iD(s),nD(s),oD(s,n),_v(s),hx(s),zp(s,n),Qp(s),ux(s,n);break;case"firefox":if(!kI||!cx||!i.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=kI,wv(s,n),dD(s,n),cx(s,n),fD(s),mD(s),pD(s),gD(s),AD(s),vD(s),yD(s),bD(s),_D(s),_v(s),hx(s),zp(s,n),Qp(s);break;case"edge":if(!MI||!lx||!i.shimEdge)return t("MS edge shim is not included in this adapter release."),r;t("adapter.js shimming edge."),r.browserShim=MI,cD(s),hD(s),lx(s,n),uD(s),zp(s,n),Qp(s);break;case"safari":if(!DI||!i.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=DI,wv(s,n),ID(s),RD(s),CD(s),wD(s),xD(s),TD(s),SD(s),BD(s),_v(s),zp(s,n),Qp(s),ux(s,n);break;default:t("Unsupported browser!");break}return r}const OI=T8({window:typeof window>"u"?void 0:window});function al(s,i,t,n){Object.defineProperty(s,i,{get:t,set:n,enumerable:!0,configurable:!0})}var c_=OI.default||OI,gp=new(function(){function s(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return s.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},s.prototype.isBrowserSupported=function(){var i=this.getBrowser(),t=this.getVersion(),n=this.supportedBrowsers.includes(i);return n?i==="chrome"?t>=this.minChromeVersion:i==="firefox"?t>=this.minFirefoxVersion:i==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},s.prototype.getBrowser=function(){return c_.browserDetails.browser},s.prototype.getVersion=function(){return c_.browserDetails.version||0},s.prototype.isUnifiedPlanSupported=function(){var i=this.getBrowser(),t=c_.browserDetails.version||0;if(i==="chrome"&&t<this.minChromeVersion)return!1;if(i==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r},s.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},s}()),LI={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},R8=function(){function s(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=LI,this.browser=gp.getBrowser(),this.browserVersion=gp.getVersion(),this.supports=function(){var i={browser:gp.isBrowserSupported(),webRTC:gp.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!i.webRTC)return i;var t;try{t=new RTCPeerConnection(LI),i.audioVideo=!0;var n=void 0;try{n=t.createDataChannel("_PEERJSTEST",{ordered:!0}),i.data=!0,i.reliable=!!n.ordered;try{n.binaryType="blob",i.binaryBlob=!gp.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{t&&t.close()}return i}(),this.pack=SI.pack,this.unpack=SI.unpack,this._dataCount=1}return s.prototype.noop=function(){},s.prototype.validateId=function(i){return!i||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(i)},s.prototype.chunk=function(i){for(var t=[],n=i.size,r=Math.ceil(n/Rt.chunkedMTU),o=0,a=0;a<n;){var l=Math.min(n,a+Rt.chunkedMTU),c=i.slice(a,l),u={__peerData:this._dataCount,n:o,data:c,total:r};t.push(u),a=l,o++}return this._dataCount++,t},s.prototype.blobToArrayBuffer=function(i,t){var n=new FileReader;return n.onload=function(r){r.target&&t(r.target.result)},n.readAsArrayBuffer(i),n},s.prototype.binaryStringToArrayBuffer=function(i){for(var t=new Uint8Array(i.length),n=0;n<i.length;n++)t[n]=i.charCodeAt(n)&255;return t.buffer},s.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},s.prototype.isSecure=function(){return location.protocol==="https:"},s}(),Rt=new R8,PD={};al(PD,"Peer",()=>px,s=>px=s);var Sm={},B8=Object.prototype.hasOwnProperty,Ks="~";function Zg(){}Object.create&&(Zg.prototype=Object.create(null),new Zg().__proto__||(Ks=!1));function P8(s,i,t){this.fn=s,this.context=i,this.once=t||!1}function MD(s,i,t,n,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new P8(t,n||s,r),a=Ks?Ks+i:i;return s._events[a]?s._events[a].fn?s._events[a]=[s._events[a],o]:s._events[a].push(o):(s._events[a]=o,s._eventsCount++),s}function xv(s,i){--s._eventsCount===0?s._events=new Zg:delete s._events[i]}function xs(){this._events=new Zg,this._eventsCount=0}xs.prototype.eventNames=function(){var i=[],t,n;if(this._eventsCount===0)return i;for(n in t=this._events)B8.call(t,n)&&i.push(Ks?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i};xs.prototype.listeners=function(i){var t=Ks?Ks+i:i,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a};xs.prototype.listenerCount=function(i){var t=Ks?Ks+i:i,n=this._events[t];return n?n.fn?1:n.length:0};xs.prototype.emit=function(i,t,n,r,o,a){var l=Ks?Ks+i:i;if(!this._events[l])return!1;var c=this._events[l],u=arguments.length,d,f;if(c.fn){switch(c.once&&this.removeListener(i,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,a),!0}for(f=1,d=new Array(u-1);f<u;f++)d[f-1]=arguments[f];c.fn.apply(c.context,d)}else{var p=c.length,g;for(f=0;f<p;f++)switch(c[f].once&&this.removeListener(i,c[f].fn,void 0,!0),u){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,r);break;default:if(!d)for(g=1,d=new Array(u-1);g<u;g++)d[g-1]=arguments[g];c[f].fn.apply(c[f].context,d)}}return!0};xs.prototype.on=function(i,t,n){return MD(this,i,t,n,!1)};xs.prototype.once=function(i,t,n){return MD(this,i,t,n,!0)};xs.prototype.removeListener=function(i,t,n,r){var o=Ks?Ks+i:i;if(!this._events[o])return this;if(!t)return xv(this,o),this;var a=this._events[o];if(a.fn)a.fn===t&&(!r||a.once)&&(!n||a.context===n)&&xv(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||r&&!a[l].once||n&&a[l].context!==n)&&c.push(a[l]);c.length?this._events[o]=c.length===1?c[0]:c:xv(this,o)}return this};xs.prototype.removeAllListeners=function(i){var t;return i?(t=Ks?Ks+i:i,this._events[t]&&xv(this,t)):(this._events=new Zg,this._eventsCount=0),this};xs.prototype.off=xs.prototype.removeListener;xs.prototype.addListener=xs.prototype.on;xs.prefixed=Ks;xs.EventEmitter=xs;Sm=xs;var Ie={};al(Ie,"LogLevel",()=>lr,s=>lr=s);al(Ie,"default",()=>FI,s=>FI=s);var kh=function(s,i){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var n=t.call(s),r,o=[],a;try{for(;(i===void 0||i-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Dh=function(s,i,t){if(t||arguments.length===2)for(var n=0,r=i.length,o;n<r;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return s.concat(o||Array.prototype.slice.call(i))},M8="PeerJS: ",lr;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(lr||(lr={}));var k8=function(){function s(){this._logLevel=lr.Disabled}return Object.defineProperty(s.prototype,"logLevel",{get:function(){return this._logLevel},set:function(i){this._logLevel=i},enumerable:!1,configurable:!0}),s.prototype.log=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this._logLevel>=lr.All&&this._print.apply(this,Dh([lr.All],kh(i),!1))},s.prototype.warn=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this._logLevel>=lr.Warnings&&this._print.apply(this,Dh([lr.Warnings],kh(i),!1))},s.prototype.error=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this._logLevel>=lr.Errors&&this._print.apply(this,Dh([lr.Errors],kh(i),!1))},s.prototype.setLogFunction=function(i){this._print=i},s.prototype._print=function(i){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Dh([M8],kh(t),!1);for(var o in r)r[o]instanceof Error&&(r[o]="("+r[o].name+") "+r[o].message);i>=lr.All?console.log.apply(console,Dh([],kh(r),!1)):i>=lr.Warnings?console.warn.apply(console,Dh(["WARNING"],kh(r),!1)):i>=lr.Errors&&console.error.apply(console,Dh(["ERROR"],kh(r),!1))},s}(),FI=new k8,kD={};al(kD,"Socket",()=>UI,s=>UI=s);var qo;(function(s){s.Data="data",s.Media="media"})(qo||(qo={}));var Oi;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(Oi||(Oi={}));var El;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json"})(El||(El={}));var jl;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(jl||(jl={}));var Yn;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(Yn||(Yn={}));var ES={};ES=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz StÃ¼ckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","SoÌˆren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var D8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),O8=function(s,i){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var n=t.call(s),r,o=[],a;try{for(;(i===void 0||i-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},L8=function(s,i,t){if(t||arguments.length===2)for(var n=0,r=i.length,o;n<r;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return s.concat(o||Array.prototype.slice.call(i))},F8=function(s){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&s[i],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},UI=function(s){D8(i,s);function i(t,n,r,o,a,l){l===void 0&&(l=5e3);var c=s.call(this)||this;c.pingInterval=l,c._disconnected=!0,c._messagesQueue=[];var u=t?"wss://":"ws://";return c._baseUrl=u+n+":"+r+o+"peerjs?key="+a,c}return i.prototype.start=function(t,n){var r=this;this._id=t;var o="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(n);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+ES.version),this._disconnected=!1,this._socket.onmessage=function(a){var l;try{l=JSON.parse(a.data),Ie.default.log("Server message received:",l)}catch{Ie.default.log("Invalid server message",a.data);return}r.emit(jl.Message,l)},this._socket.onclose=function(a){r._disconnected||(Ie.default.log("Socket closed.",a),r._cleanup(),r._disconnected=!0,r.emit(jl.Disconnected))},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),Ie.default.log("Socket open"),r._scheduleHeartbeat())})},i.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},i.prototype._sendHeartbeat=function(){if(!this._wsOpen()){Ie.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:Yn.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},i.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},i.prototype._sendQueuedMessages=function(){var t,n,r=L8([],O8(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=F8(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l)}}catch(c){t={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},i.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(jl.Error,"Invalid message");return}if(this._wsOpen()){var n=JSON.stringify(t);this._socket.send(n)}}},i.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},i.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},i}(Sm.EventEmitter),dx={};al(dx,"MediaConnection",()=>QI,s=>QI=s);var IS={};al(IS,"Negotiator",()=>NI,s=>NI=s);var ty=function(){return ty=Object.assign||function(s){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},ty.apply(this,arguments)},_A=function(s,i,t,n){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(d){try{u(n.next(d))}catch(f){a(f)}}function c(d){try{u(n.throw(d))}catch(f){a(f)}}function u(d){d.done?o(d.value):r(d.value).then(l,c)}u((n=n.apply(s,i||[])).next())})},wA=function(s,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=i.call(s,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},NI=function(){function s(i){this.connection=i}return s.prototype.startConnection=function(i){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===qo.Media&&i._stream&&this._addTracksToConnection(i._stream,t),i.originator){if(this.connection.type===qo.Data){var n=this.connection,r={ordered:!!i.reliable},o=t.createDataChannel(n.label,r);n.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",i.sdp)},s.prototype._startPeerConnection=function(){Ie.default.log("Creating RTCPeerConnection.");var i=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(i),i},s.prototype._setupListeners=function(i){var t=this,n=this.connection.peer,r=this.connection.connectionId,o=this.connection.type,a=this.connection.provider;Ie.default.log("Listening for ICE candidates."),i.onicecandidate=function(l){!l.candidate||!l.candidate.candidate||(Ie.default.log("Received ICE candidates for ".concat(n,":"),l.candidate),a.socket.send({type:Yn.Candidate,payload:{candidate:l.candidate,type:o,connectionId:r},dst:n}))},i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"failed":Ie.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":Ie.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit("error",new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":Ie.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":i.onicecandidate=Rt.noop;break}t.connection.emit("iceStateChanged",i.iceConnectionState)},Ie.default.log("Listening for data channel"),i.ondatachannel=function(l){Ie.default.log("Received data channel");var c=l.channel,u=a.getConnection(n,r);u.initialize(c)},Ie.default.log("Listening for remote stream"),i.ontrack=function(l){Ie.default.log("Received remote stream");var c=l.streams[0],u=a.getConnection(n,r);if(u.type===qo.Media){var d=u;t._addStreamToMediaConnection(c,d)}}},s.prototype.cleanup=function(){Ie.default.log("Cleaning up PeerConnection to "+this.connection.peer);var i=this.connection.peerConnection;if(i){this.connection.peerConnection=null,i.onicecandidate=i.oniceconnectionstatechange=i.ondatachannel=i.ontrack=function(){};var t=i.signalingState!=="closed",n=!1;if(this.connection.type===qo.Data){var r=this.connection,o=r.dataChannel;o&&(n=!!o.readyState&&o.readyState!=="closed")}(t||n)&&i.close()}},s.prototype._makeOffer=function(){return _A(this,void 0,Promise,function(){var i,t,n,r,o,a,l;return wA(this,function(c){switch(c.label){case 0:i=this.connection.peerConnection,t=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,i.createOffer(this.connection.options.constraints)];case 2:n=c.sent(),Ie.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,i.setLocalDescription(n)];case 4:return c.sent(),Ie.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Rt.browser},this.connection.type===qo.Data&&(o=this.connection,r=ty(ty({},r),{label:o.label,reliable:o.reliable,serialization:o.serialization})),t.socket.send({type:Yn.Offer,payload:r,dst:this.connection.peer}),[3,6];case 5:return a=c.sent(),a!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Oi.WebRTC,a),Ie.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return l=c.sent(),t.emitError(Oi.WebRTC,l),Ie.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}})})},s.prototype._makeAnswer=function(){return _A(this,void 0,Promise,function(){var i,t,n,r,o;return wA(this,function(a){switch(a.label){case 0:i=this.connection.peerConnection,t=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,i.createAnswer()];case 2:n=a.sent(),Ie.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,i.setLocalDescription(n)];case 4:return a.sent(),Ie.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),t.socket.send({type:Yn.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:Rt.browser},dst:this.connection.peer}),[3,6];case 5:return r=a.sent(),t.emitError(Oi.WebRTC,r),Ie.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return o=a.sent(),t.emitError(Oi.WebRTC,o),Ie.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},s.prototype.handleSDP=function(i,t){return _A(this,void 0,Promise,function(){var n,r,o,a;return wA(this,function(l){switch(l.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,r=this.connection.provider,Ie.default.log("Setting remote description",t),o=this,l.label=1;case 1:return l.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return l.sent(),Ie.default.log("Set remoteDescription:".concat(i," for:").concat(this.connection.peer)),i!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return a=l.sent(),r.emitError(Oi.WebRTC,a),Ie.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},s.prototype.handleCandidate=function(i){return _A(this,void 0,Promise,function(){var t,n,r,o,a,l;return wA(this,function(c){switch(c.label){case 0:Ie.default.log("handleCandidate:",i),t=i.candidate,n=i.sdpMLineIndex,r=i.sdpMid,o=this.connection.peerConnection,a=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:n,candidate:t}))];case 2:return c.sent(),Ie.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return l=c.sent(),a.emitError(Oi.WebRTC,l),Ie.default.log("Failed to handleCandidate, ",l),[3,4];case 4:return[2]}})})},s.prototype._addTracksToConnection=function(i,t){if(Ie.default.log("add tracks from stream ".concat(i.id," to peer connection")),!t.addTrack)return Ie.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");i.getTracks().forEach(function(n){t.addTrack(n,i)})},s.prototype._addStreamToMediaConnection=function(i,t){Ie.default.log("add stream ".concat(i.id," to media connection ").concat(t.connectionId)),t.addStream(i)},s}(),TS={};al(TS,"BaseConnection",()=>zI,s=>zI=s);var U8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),zI=function(s){U8(i,s);function i(t,n,r){var o=s.call(this)||this;return o.peer=t,o.provider=n,o.options=r,o._open=!1,o.metadata=r.metadata,o}return Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),i}(Sm.EventEmitter),N8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),iy=function(){return iy=Object.assign||function(s){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},iy.apply(this,arguments)},z8=function(s){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&s[i],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},QI=function(s){N8(i,s);function i(t,n,r){var o=s.call(this,t,n,r)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||i.ID_PREFIX+Rt.randomToken(),o._negotiator=new IS.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(i.prototype,"type",{get:function(){return qo.Media},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),i.prototype.addStream=function(t){Ie.default.log("Receiving stream",t),this._remoteStream=t,s.prototype.emit.call(this,"stream",t)},i.prototype.handleMessage=function(t){var n=t.type,r=t.payload;switch(t.type){case Yn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case Yn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ie.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},i.prototype.answer=function(t,n){var r,o;if(n===void 0&&(n={}),this._localStream){Ie.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(iy(iy({},this.options._payload),{_stream:t}));var a=this.provider._getMessages(this.connectionId);try{for(var l=z8(a),c=l.next();!c.done;c=l.next()){var u=c.value;this.handleMessage(u)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this._open=!0},i.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},i.ID_PREFIX="mc_",i}(TS.BaseConnection),fx={};al(fx,"DataConnection",()=>GI,s=>GI=s);var DD={};al(DD,"EncodingQueue",()=>jI,s=>jI=s);var Q8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),jI=function(s){Q8(i,s);function i(){var t=s.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(n){t._processing=!1,n.target&&t.emit("done",n.target.result),t.doNextTask()},t.fileReader.onerror=function(n){Ie.default.error("EncodingQueue error:",n),t._processing=!1,t.destroy(),t.emit("error",n)},t}return Object.defineProperty(i.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),i.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},i.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},i.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},i}(Sm.EventEmitter),j8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),G8=function(s){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&s[i],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},GI=function(s){j8(i,s);function i(t,n,r){var o=s.call(this,t,n,r)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new DD.EncodingQueue,o.connectionId=o.options.connectionId||i.ID_PREFIX+Rt.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||El.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(a){o._bufferedSend(a)}),o._encodingQueue.on("error",function(){Ie.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new IS.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(i.prototype,"type",{get:function(){return qo.Data},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),i.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},i.prototype._configureDataChannel=function(){var t=this;(!Rt.supports.binaryBlob||Rt.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){Ie.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(n){Ie.default.log("DC#".concat(t.connectionId," dc onmessage:"),n.data),t._handleDataMessage(n)},this.dataChannel.onclose=function(){Ie.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},i.prototype._handleDataMessage=function(t){var n=this,r=t.data,o=r.constructor,a=this.serialization===El.Binary||this.serialization===El.BinaryUTF8,l=r;if(a){if(o===Blob){Rt.blobToArrayBuffer(r,function(u){var d=Rt.unpack(u);n.emit("data",d)});return}else if(o===ArrayBuffer)l=Rt.unpack(r);else if(o===String){var c=Rt.binaryStringToArrayBuffer(r);l=Rt.unpack(c)}}else this.serialization===El.JSON&&(l=this.parse(r));if(l.__peerData){this._handleChunk(l);return}s.prototype.emit.call(this,"data",l)},i.prototype._handleChunk=function(t){var n=t.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:t.total};if(r.data[t.n]=t.data,r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];var o=new Blob(r.data);this._handleDataMessage({data:o})}},i.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},i.prototype.send=function(t,n){if(!this.open){s.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===El.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===El.Binary||this.serialization===El.BinaryUTF8){var r=Rt.pack(t);if(!n&&r.size>Rt.chunkedMTU){this._sendChunks(r);return}Rt.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(t)},i.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},i.prototype._trySend=function(t){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>i.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(r){return Ie.default.error("DC#:".concat(this.connectionId," Error when sending:"),r),this._buffering=!0,this.close(),!1}return!0},i.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},i.prototype._sendChunks=function(t){var n,r,o=Rt.chunk(t);Ie.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var a=G8(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.send(c,!0)}}catch(u){n={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},i.prototype.handleMessage=function(t){var n=t.payload;switch(t.type){case Yn.Answer:this._negotiator.handleSDP(t.type,n.sdp);break;case Yn.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:Ie.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},i.ID_PREFIX="dc_",i.MAX_BUFFERED_AMOUNT=8388608,i}(TS.BaseConnection),OD={};al(OD,"API",()=>WI,s=>WI=s);var HI=function(s,i,t,n){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(d){try{u(n.next(d))}catch(f){a(f)}}function c(d){try{u(n.throw(d))}catch(f){a(f)}}function u(d){d.done?o(d.value):r(d.value).then(l,c)}u((n=n.apply(s,i||[])).next())})},VI=function(s,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=i.call(s,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},WI=function(){function s(i){this._options=i}return s.prototype._buildRequest=function(i){var t=this._options.secure?"https":"http",n=this._options,r=n.host,o=n.port,a=n.path,l=n.key,c=new URL("".concat(t,"://").concat(r,":").concat(o).concat(a).concat(l,"/").concat(i));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",ES.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},s.prototype.retrieveId=function(){return HI(this,void 0,Promise,function(){var i,t,n;return VI(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(i=r.sent(),i.status!==200)throw new Error("Error. Status:".concat(i.status));return[2,i.text()];case 2:throw t=r.sent(),Ie.default.error("Error retrieving ID",t),n="",this._options.path==="/"&&this._options.host!==Rt.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},s.prototype.listAllPeers=function(){return HI(this,void 0,Promise,function(){var i,t,n;return VI(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(i=r.sent(),i.status!==200)throw i.status===401?(t="",this._options.host===Rt.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(i.status));return[2,i.json()];case 2:throw n=r.sent(),Ie.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},s}(),H8=function(){var s=function(i,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},s(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(i,t);function n(){this.constructor=i}i.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),rg=function(){return rg=Object.assign||function(s){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},rg.apply(this,arguments)},mp=function(s){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&s[i],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},V8=function(s,i){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var n=t.call(s),r,o=[],a;try{for(;(i===void 0||i-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},px=function(s){H8(i,s);function i(t,n){var r=s.call(this)||this;r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map;var o;return t&&t.constructor==Object?n=t:t&&(o=t.toString()),n=rg({debug:0,host:Rt.CLOUD_HOST,port:Rt.CLOUD_PORT,path:"/",key:i.DEFAULT_KEY,token:Rt.randomToken(),config:Rt.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),r._options=n,r._options.host==="/"&&(r._options.host=window.location.hostname),r._options.path&&(r._options.path[0]!=="/"&&(r._options.path="/"+r._options.path),r._options.path[r._options.path.length-1]!=="/"&&(r._options.path+="/")),r._options.secure===void 0&&r._options.host!==Rt.CLOUD_HOST?r._options.secure=Rt.isSecure():r._options.host==Rt.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&Ie.default.setLogFunction(r._options.logFunction),Ie.default.logLevel=r._options.debug||0,r._api=new OD.API(n),r._socket=r._createServerConnection(),!Rt.supports.audioVideo&&!Rt.supports.data?(r._delayedAbort(Oi.BrowserIncompatible,"The current browser does not support WebRTC"),r):o&&!Rt.validateId(o)?(r._delayedAbort(Oi.InvalidID,'ID "'.concat(o,'" is invalid')),r):(o?r._initialize(o):r._api.retrieveId().then(function(a){return r._initialize(a)}).catch(function(a){return r._abort(Oi.ServerError,a)}),r)}return Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connections",{get:function(){var t,n,r=Object.create(null);try{for(var o=mp(this._connections),a=o.next();!a.done;a=o.next()){var l=V8(a.value,2),c=l[0],u=l[1];r[c]=u}}catch(d){t={error:d}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),i.prototype._createServerConnection=function(){var t=this,n=new kD.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(jl.Message,function(r){t._handleMessage(r)}),n.on(jl.Error,function(r){t._abort(Oi.SocketError,r)}),n.on(jl.Disconnected,function(){t.disconnected||(t.emitError(Oi.Network,"Lost connection to server."),t.disconnect())}),n.on(jl.Close,function(){t.disconnected||t._abort(Oi.SocketClosed,"Underlying socket is already closed.")}),n},i.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},i.prototype._handleMessage=function(t){var n,r,o=t.type,a=t.payload,l=t.src;switch(o){case Yn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Yn.Error:this._abort(Oi.ServerError,a.msg);break;case Yn.IdTaken:this._abort(Oi.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Yn.InvalidKey:this._abort(Oi.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Yn.Leave:Ie.default.log("Received leave message from ".concat(l)),this._cleanupPeer(l),this._connections.delete(l);break;case Yn.Expire:this.emitError(Oi.PeerUnavailable,"Could not connect to peer ".concat(l));break;case Yn.Offer:var m=a.connectionId,A=this.getConnection(l,m);if(A&&(A.close(),Ie.default.warn("Offer received for existing Connection ID:".concat(m))),a.type===qo.Media){var c=new dx.MediaConnection(l,this,{connectionId:m,_payload:a,metadata:a.metadata});A=c,this._addConnection(l,A),this.emit("call",c)}else if(a.type===qo.Data){var u=new fx.DataConnection(l,this,{connectionId:m,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});A=u,this._addConnection(l,A),this.emit("connection",u)}else{Ie.default.warn("Received malformed connection type:".concat(a.type));return}var d=this._getMessages(m);try{for(var f=mp(d),p=f.next();!p.done;p=f.next()){var g=p.value;A.handleMessage(g)}}catch(y){n={error:y}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}break;default:if(!a){Ie.default.warn("You received a malformed message from ".concat(l," of type ").concat(o));return}var m=a.connectionId,A=this.getConnection(l,m);A&&A.peerConnection?A.handleMessage(t):m?this._storeMessage(m,t):Ie.default.warn("You received an unrecognized message:",t);break}},i.prototype._storeMessage=function(t,n){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(n)},i.prototype._getMessages=function(t){var n=this._lostMessages.get(t);return n?(this._lostMessages.delete(t),n):[]},i.prototype.connect=function(t,n){if(n===void 0&&(n={}),this.disconnected){Ie.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Oi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var r=new fx.DataConnection(t,this,n);return this._addConnection(t,r),r},i.prototype.call=function(t,n,r){if(r===void 0&&(r={}),this.disconnected){Ie.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Oi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Ie.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new dx.MediaConnection(t,this,rg(rg({},r),{_stream:n}));return this._addConnection(t,o),o},i.prototype._addConnection=function(t,n){Ie.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(n)},i.prototype._removeConnection=function(t){var n=this._connections.get(t.peer);if(n){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}this._lostMessages.delete(t.connectionId)},i.prototype.getConnection=function(t,n){var r,o,a=this._connections.get(t);if(!a)return null;try{for(var l=mp(a),c=l.next();!c.done;c=l.next()){var u=c.value;if(u.connectionId===n)return u}}catch(d){r={error:d}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return null},i.prototype._delayedAbort=function(t,n){var r=this;setTimeout(function(){r._abort(t,n)},0)},i.prototype._abort=function(t,n){Ie.default.error("Aborting!"),this.emitError(t,n),this._lastServerId?this.disconnect():this.destroy()},i.prototype.emitError=function(t,n){Ie.default.error("Error:",n);var r;typeof n=="string"?r=new Error(n):r=n,r.type=t,this.emit("error",r)},i.prototype.destroy=function(){this.destroyed||(Ie.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},i.prototype._cleanup=function(){var t,n;try{for(var r=mp(this._connections.keys()),o=r.next();!o.done;o=r.next()){var a=o.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},i.prototype._cleanupPeer=function(t){var n,r,o=this._connections.get(t);if(o)try{for(var a=mp(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.close()}}catch(u){n={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},i.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;Ie.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},i.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)Ie.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ie.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},i.prototype.listAllPeers=function(t){var n=this;t===void 0&&(t=function(r){}),this._api.listAllPeers().then(function(r){return t(r)}).catch(function(r){return n._abort(Oi.ServerError,r)})},i.DEFAULT_KEY="peerjs",i}(Sm.EventEmitter),gx=PD.Peer;const W8=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return px},default:gx,util:Rt},Symbol.toStringTag,{value:"Module"}));let RS;function MK(){return RS}function kK(s){RS=s}function q8(s,i){return i||(i={}),i={...RS,...i},s?new gx(s,i):new gx(i)}async function qI(){const s=await hh(()=>Promise.resolve().then(()=>W8),void 0,import.meta.url);return console.log(s),s.default===void 0?s:s.default}var mx;(function(s){s.ConnectionList="connection-list"})(mx||(mx={}));class X8{constructor(){h(this,"_host");h(this,"_client");h(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const i="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(i)}async trySetupHost(i){const t=await qI(),n=new t(i);n.on("error",r=>{console.error(r),this._host=void 0,this.trySetupClient(i)}),n.on("open",r=>{this._host=new K8(n)})}async trySetupClient(i){const t=await qI();this._client=new t,this._client.on("error",n=>{console.error("Client error",n)}),this._client.on("open",n=>{console.log("client connected",n),this._clientData=this._client.connect(i,{metadata:{id:n}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",r=>{console.log("<<",r)})})}}class Y8{constructor(i){h(this,"_peer");this._peer=i}}class K8 extends Y8{constructor(t){var n;super(t);h(this,"_connections",[]);console.log("I AM THE HOST"),(n=this._peer)==null||n.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const n=this._connections.map(r=>{var o;return(o=r.metadata)==null?void 0:o.id}).filter(r=>r!==void 0);this.broadcast({type:mx.ConnectionList,connections:n})}broadcast(t){if(t!=null){console.log(">>",t);for(const n in this._peer.connections){const r=this._peer.connections[n];if(r)if(Array.isArray(r))for(const o of r)o&&o.send(t);else console.warn(r)}}}}var Vo;(function(s){s[s.OnConnection=0]="OnConnection",s[s.OnRoomJoin=1]="OnRoomJoin",s[s.Queued=2]="Queued",s[s.Immediate=3]="Immediate"})(Vo||(Vo={}));const XI="https://urls.needle.tools/default-networking-backend/index";let vl="wss://needle-tiny-starter.glitch.me/socket";const sr=!!Q("debugnet"),xA=!!(sr||Q("debugowner")),h_=Q("debugnetbin");var Ax;(function(s){s.ConnectionInfo="connection-start-info"})(Ax||(Ax={}));var je;(function(s){s.Join="join-room",s.Leave="leave-room",s.JoinedRoom="joined-room",s.LeftRoom="left-room",s.UserJoinedRoom="user-joined-room",s.UserLeftRoom="user-left-room",s.RoomStateSent="room-state-sent"})(je||(je={}));class DK{constructor(){h(this,"room");h(this,"viewId");h(this,"allowEditing");h(this,"inRoom")}}class OK{constructor(){h(this,"room")}}class LK{constructor(){h(this,"userId")}}var us;(function(s){s.RequestHasOwner="request-has-owner",s.ResponseHasOwner="response-has-owner",s.RequestIsOwner="request-is-owner",s.ResponseIsOwner="response-is-owner",s.RequestOwnership="request-ownership",s.GainedOwnership="gained-ownership",s.RemoveOwnership="remove-ownership",s.LostOwnership="lost-ownership",s.GainedOwnershipBroadcast="gained-ownership-broadcast",s.LostOwnershipBroadcast="lost-ownership-broadcast"})(us||(us={}));class LD{constructor(i,t){h(this,"guid");h(this,"connection");h(this,"_hasOwnership",!1);h(this,"_isOwned");h(this,"_gainSubscription");h(this,"_lostSubscription");h(this,"_hasOwnerResponse");h(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=i,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),i.beginListen(us.LostOwnership,this._lostSubscription),i.beginListen(us.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),i.beginListen(us.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(us.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(i){i.guid===this.guid&&(this._isOwned=i.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(us.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(i){i.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=i.value,i.value||(xA&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((i,t)=>{this.requestOwnership();let n=0;const r=()=>{if(n++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?i(this):r()},100)};r()})}requestOwnership(){return xA&&console.log("Request ownership",this.guid),this.connection.send(us.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(us.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(us.GainedOwnership,this._gainSubscription),this.connection.stopListen(us.LostOwnership,this._lostSubscription),this.connection.stopListen(us.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(i){i.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===i.owner?(xA&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(i){i===this.guid&&(xA&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class J8{constructor(i){h(this,"context");h(this,"_peer",null);h(this,"_usersInRoomCopy",[]);h(this,"_defaultMessagesBuffer",[]);h(this,"_defaultMessagesBufferArray",[]);h(this,"netWebSocketUrlProvider");h(this,"_listeners",{});h(this,"_listenersBinary",{});h(this,"connected",!1);h(this,"channelId");h(this,"_connectionId",null);h(this,"_ws");h(this,"_waitingForSocket",{});h(this,"_isInRoom",!1);h(this,"_currentRoomName",null);h(this,"_currentRoomViewId",null);h(this,"_currentRoomAllowEditing",!0);h(this,"_currentInRoom",[]);h(this,"_state",{});h(this,"_currentDelay",-1);h(this,"_connectingToWebsocketPromise",null);this.context=i}get peer(){return this._peer||(this._peer=new X8),this._peer}tryGetState(i){return i==="invalid"?null:this._state[i]}get connectionId(){return this._connectionId}get isDebugEnabled(){return sr}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const i=new URL(window.location.href);return i.searchParams.set("view",this.currentRoomViewId),i.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var i;return((i=this._ws)==null?void 0:i.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(i){return this._currentInRoom.indexOf(i)!==-1}usersInRoom(i=null){i||(i=this._usersInRoomCopy),i.length=0;for(const t of this._currentInRoom)i.push(t);return i}joinRoom(i,t=!1){return i?i.length>1024?(console.error('Room name too long, can not join: "'+i+'". Max length is 1024 characters.'),!1):(this.connect(),sr&&console.log("join: "+i),this.send(je.Join,{room:i,viewOnly:t},Vo.OnConnection),!0):(console.error('Missing room name, can not join: "'+i+'"'),!1)}leaveRoom(i=null){return i||(i=this.currentRoomName),i?(this.send(je.Leave,{room:i}),!0):(console.error('Missing room name, can not join: "'+i+'"'),!1)}send(i,t=null,n=Vo.Queued){if(t===null&&(t={}),n===Vo.Queued){this._defaultMessagesBuffer.push({key:i,value:t});return}return this.sendWithWebsocket(i,t,n)}sendDeleteRemoteState(i){this.send("delete-state",{guid:i,dontSave:!0}),delete this._state[i]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(i){var t;h_&&console.log("<< send binary",this.context.time.frame,i.length/1024+" KB"),(t=this._ws)==null||t.send(i)}sendBufferedMessagesNow(){var n;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const i=Object.keys(this._defaultMessagesBuffer).length;for(const r in this._defaultMessagesBuffer){const o=this._defaultMessagesBuffer[r];if(i<=1){this.sendWithWebsocket(o.key,o.value,Vo.Immediate);break}const a=this.toMessage(o.key,o.value);this._defaultMessagesBufferArray.push(a)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&sr&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(n=this._ws)==null||n.send(t)}beginListen(i,t){return this._listeners[i]||(this._listeners[i]=[]),this._listeners[i].push(t),t}stopListening(i,t){return this.stopListen(i,t)}stopListen(i,t){if(!t||!this._listeners[i])return;const n=this._listeners[i].indexOf(t);n>=0&&this._listeners[i].splice(n,1)}beginListenBinary(i,t){return this._listenersBinary[i]||(this._listenersBinary[i]=[]),this._listenersBinary[i].push(t),t}stopListenBinary(i,t){if(!this._listenersBinary[i])return;const n=this._listenersBinary[i].indexOf(t);n>=0&&this._listenersBinary[i].splice(n,1)}registerProvider(i){this.netWebSocketUrlProvider=i}async connect(){var t;if(this.connected)return Promise.resolve(!0);sr&&console.log("connecting");const i=(t=this.netWebSocketUrlProvider)==null?void 0:t.getWebsocketUrl();return i?vl=i:sU()&&(vl="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var i;(i=this._ws)==null||i.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(i,t)=>{var u,d;let n=!1;const r=f=>{n||(n=!0,i(f))};if(vl===void 0&&(console.log("Fetch default backend url: "+XI),vl=await(await fetch(XI)).text()),vl===void 0){r(!1);return}console.debug(`âŠ¡ Connecting to networking backend on
`+vl);const o=await hh(()=>import("./index-d7be2e3b.js"),[],import.meta.url),a=((u=o.default)==null?void 0:u.WebsocketBuilder)??o.WebsocketBuilder,l=((d=o.default)==null?void 0:d.ExponentialBackoff)??o.ExponentialBackoff,c=new a(vl).withMaxRetries(3).withBackoff(new l(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=c,this.connected=!0,be()||sr?console.log(`âŠž Connected to networking backend
`+vl):console.debug("âŠž Connected to networking backend",vl),r(!0),this.onSendQueued(Vo.OnConnection)}).onClose(f=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,r(!1)}).onError(f=>{console.error("âŠ  Websocket error"),r(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();c.addEventListener(o.WebsocketEvent.message,(f,p)=>{this.onMessage(f,p)})})}onMessage(i,t){const n=t.data;try{if(typeof n!="string"){n.size&&this.handleIncomingBinaryMessage(n);return}const r=JSON.parse(n);if(Array.isArray(r))for(const o of r)this.handleIncomingStringMessage(o);else this.handleIncomingStringMessage(r);return}catch(r){sr&&n==="pong"?console.log("<<",n):be()&&console.error("Failed to parse message",r)}}async handleIncomingBinaryMessage(i){h_&&console.log("<< bin",this.context.time.frame);const t=await i.arrayBuffer();var n=new Uint8Array(t);const r=new Jg(n),o=r.getBufferIdentifier(),a=this._listenersBinary[o],l=h8(r),c=u8(l);if(c&&typeof c=="string"&&(this._state[c]=l),!a)return;const u=l??r;for(const d of a)d(u)}handleIncomingStringMessage(i){var r,o;if(sr&&console.log("<<",i.key??i),i.key)switch(i.key){case Ax.ConnectionInfo:if(i.data){const c=i.data;c&&(console.assert(c.id!==void 0&&c.id!==null&&c.id.length>0,"server did not send connection id",c.id),console.debug("Your id is: "+c.id,this.context.alias??""),this._connectionId=c.id)}else console.warn("Expected connection id in "+i.key);break;case je.JoinedRoom:if(sr&&console.log(i),i){this._isInRoom=!0;const c=i;this._currentRoomName=c.room,this._currentRoomViewId=c.viewId,this._currentRoomAllowEditing=c.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...c.inRoom),(h_||be())&&console.debug("Joined Needle Engine Room: "+c.room);const u=new URL(window.location.href);u.searchParams.has("room")&&u.searchParams.delete("room"),u.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${u.href}`)}this.onSendQueued(Vo.OnRoomJoin);break;case je.LeftRoom:i.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case je.UserJoinedRoom:if(i.data){const c=i.data;this._currentInRoom.push(c.userId),sr&&console.log(c.userId+" joined","now in room:",this._currentInRoom)}break;case je.UserLeftRoom:if(i.data){const c=i.data,u=this._currentInRoom.indexOf(c.userId);u>=0&&(sr&&console.log(c.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(u,1)),c.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":sr&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const l=(r=i.data)==null?void 0:r.time;l&&(this._currentDelay=this.context.time.time-l),sr&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((o=this._currentInRoom)==null?void 0:o.length));break}const t=i.data;t&&(this._state[t.guid]=t);let n=this._listeners[i.key];if(n){n=[...n];for(const a of n)try{a(i.data)}catch(l){console.error('Error invoking callback for "'+i.key+'"',l)}}}toMessage(i,t){return{key:i,data:t}}sendWithWebsocket(i,t,n=Vo.OnRoomJoin){if(!this._ws){const o=this._waitingForSocket[n]||[];o.push(()=>this.sendWithWebsocket(i,t,n)),this._waitingForSocket[n]=o;return}const r=JSON.stringify(this.toMessage(i,t));sr&&console.log(">>",i),this._ws.send(r)}onSendQueued(i){const t=this._waitingForSocket[i];if(t){for(const n of t)n();t.length=0}}}const og=Q("debugwebxr");class u_{constructor(i,t){h(this,"controllerStates",[]);h(this,"userId");h(this,"context");h(this,"userStateEvtName");h(this,"onReceivedControllerState",i=>{og&&console.log(`XRSync: Received change for ${this.userId}: ${i.type} ${i.handedness}; tracked=${i.isTracking}`);let t=!1;for(let n=0;n<this.controllerStates.length;n++)if(this.controllerStates[n].index===i.index){this.controllerStates[n]=i,t=!0;break}t||this.controllerStates.push(i)});this.userId=i,this.context=t,this.userStateEvtName="xr-sync-user-state-"+i,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(i){if(this.context.connection.isConnected!=!1){for(let t=this.controllerStates.length-1;t>=0;t--){const n=this.controllerStates[t];let r=!1;for(let o=0;o<i.controllers.length;o++)i.controllers[o].index===n.index&&(r=!0);r||(og&&console.log(`XRSync: ${n.type} ${n.handedness} removed`,n.index),this.controllerStates.splice(t,1),this.sendControllerRemoved(n))}for(const t of i.controllers)this.updateControllerStates(t)}}onExitXR(i){for(const t of this.controllerStates)this.sendControllerRemoved(t);this.controllerStates.length=0}sendControllerRemoved(i){i.isTracking=!1,i.guid="",this.context.connection.send(this.userStateEvtName,i),this.context.connection.sendDeleteRemoteState(i.guid)}updateControllerStates(i){const t=this.controllerStates.find(n=>n.index===i.index);if(t){let n=!1;n||(n=t.isTracking!=i.isTracking),n&&(t.isTracking=i.isTracking,this.context.connection.send(this.userStateEvtName,t))}else{const n={guid:this.userId+"-"+i.index,isTracking:i.isTracking,handedness:i.side,index:i.index,type:i.hand?"hand":"controller"};this.controllerStates.push(n),this.context.connection.send(this.userStateEvtName,n),og&&console.log(`XRSync: ${n.type} ${n.handedness} added`,n.index)}}}class Z8{constructor(i){h(this,"context");h(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(og&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new u_(this.context.connection.connectionId,this.context)));for(const i of this.context.connection.usersInRoom())this._states.has(i)||this._states.set(i,new u_(i,this.context))}});h(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const i=this._states.get(this.context.connection.connectionId);i==null||i.dispose(),this._states.delete(this.context.connection.connectionId)}});h(this,"onOtherUserJoinedRoom",i=>{const t=i.userId;this._states.has(t)||(og&&console.log("XRSync: Remote user joined room",t),this._states.set(t,new u_(t,this.context)))});h(this,"onOtherUserLeftRoom",i=>{const t=i.userId;if(!this._states.has(t)){const n=this._states.get(t);n==null||n.dispose(),this._states.delete(t)}});h(this,"_states",new Map);this.context=i,this.context.connection.beginListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(je.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(je.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(je.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(i){return i?this._states.has(i):!1}isTracking(i,t){if(!i)return;const n=this._states.get(i);if(!n)return;const r=n.controllerStates.find(o=>o.handedness===t);return(r==null?void 0:r.isTracking)||!1}getDeviceType(i,t){if(!i)return;const n=this._states.get(i);if(!n)return;const r=n.controllerStates.find(o=>o.handedness===t);return(r==null?void 0:r.type)||"unknown"}destroy(){this.context.connection.stopListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(je.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(je.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(je.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(i){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.update(i)}}onExitXR(i){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.onExitXR(i)}}}class YI{constructor(){h(this,"_fadeToColorQuad");h(this,"_fadeToColorMaterial");h(this,"_requestedFadeValue",0);h(this,"_transitionPromise",null);h(this,"_transitionResolve",null);this._fadeToColorMaterial=new _t({color:0,transparent:!0,depthTest:!1,fog:!1,side:_i}),this._fadeToColorQuad=new Z(new pr(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(i,t){const n=this._fadeToColorQuad,r=this._fadeToColorMaterial;n.parent!==i&&r.opacity>0?i.add(n):r.opacity===0&&n.removeFromParent(),n.layers.set(2),n.material=this._fadeToColorMaterial,n.position.z=-1,n.renderOrder=1/0;const o=this._requestedFadeValue;r.opacity=ye.lerp(r.opacity,o,t/.03),Math.abs(r.opacity-o)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const i=new Promise(t=>{this._transitionResolve=t});return this._transitionPromise=i,i}}class $8 extends kP{constructor(i,t={}){const n=t.font;if(n===void 0)super();else{const r=n.generateShapes(i,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(r,t)}this.type="TextGeometry"}}class e5 extends ch{constructor(i){super(i)}load(i,t,n,r){const o=this,a=new Lr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(l){const c=o.parse(JSON.parse(l));t&&t(c)},n,r)}parse(i){return new FD(i)}}class FD{constructor(i){this.isFont=!0,this.type="Font",this.data=i}generateShapes(i,t=100){const n=[],r=t5(i,t,this.data);for(let o=0,a=r.length;o<a;o++)n.push(...r[o].toShapes());return n}}function t5(s,i,t){const n=Array.from(s),r=i/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r,a=[];let l=0,c=0;for(let u=0;u<n.length;u++){const d=n[u];if(d===`
`)l=0,c-=o;else{const f=i5(d,r,l,c,t);l+=f.offsetX,a.push(f.path)}}return a}function i5(s,i,t,n,r){const o=r.glyphs[s]||r.glyphs["?"];if(!o){console.error('THREE.Font: character "'+s+'" does not exists in font family '+r.familyName+".");return}const a=new dF;let l,c,u,d,f,p,g,m;if(o.o){const A=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let y=0,b=A.length;y<b;)switch(A[y++]){case"m":l=A[y++]*i+t,c=A[y++]*i+n,a.moveTo(l,c);break;case"l":l=A[y++]*i+t,c=A[y++]*i+n,a.lineTo(l,c);break;case"q":u=A[y++]*i+t,d=A[y++]*i+n,f=A[y++]*i+t,p=A[y++]*i+n,a.quadraticCurveTo(f,p,u,d);break;case"b":u=A[y++]*i+t,d=A[y++]*i+n,f=A[y++]*i+t,p=A[y++]*i+n,g=A[y++]*i+t,m=A[y++]*i+n,a.bezierCurveTo(f,p,g,m,u,d);break}}return{offsetX:o.ha*i,path:a}}var Ko;(function(s){s[s.Quad=0]="Quad",s[s.Cube=1]="Cube",s[s.Sphere=2]="Sphere",s[s.RoundedCube=10]="RoundedCube"})(Ko||(Ko={}));var gm,vx;class Uu{static createText(i,t){let n=null;const r=(t==null?void 0:t.font)||s5((t==null?void 0:t.familyFamily)||null);r instanceof FD?n=Ph(this,gm,vx).call(this,i,r,t):n==null&&(n=new Vt);const o=(t==null?void 0:t.color)||16777215,a=new Z(n,(t==null?void 0:t.material)??new Jn({color:o}));return this.applyDefaultObjectOptions(a,t),r instanceof Promise?r.then(l=>{a.geometry=Ph(this,gm,vx).call(this,i,l,t),t!=null&&t.onGeometry&&t.onGeometry(a)}):t!=null&&t.onGeometry&&t.onGeometry(a),a}static createOccluder(i){const t=new _t({colorWrite:!1,depthWrite:!0,side:_i});return this.createPrimitive(i,{material:t})}static createPrimitive(i,t){let n;const r=(t==null?void 0:t.color)||16777215;switch(i){case"Quad":case Ko.Quad:{const o=new pr(1,1,1,1),a=(t==null?void 0:t.material)??new Jn({color:r});t!=null&&t.texture&&"map"in a&&(a.map=t.texture),n=new Z(o,a),n.name="Quad"}break;case"Cube":case Ko.Cube:{const o=new on(1,1,1),a=(t==null?void 0:t.material)??new Jn({color:r});t!=null&&t.texture&&"map"in a&&(a.map=t.texture),n=new Z(o,a),n.name="Cube"}break;case Ko.RoundedCube:case"RoundedCube":{const o=n5(1,1,1,.1,2),a=(t==null?void 0:t.material)??new Jn({color:r});t!=null&&t.texture&&"map"in a&&(a.map=t.texture),n=new Z(o,a),n.name="RoundedCube"}break;case"Sphere":case Ko.Sphere:{const o=new Pu(.5,16,16),a=(t==null?void 0:t.material)??new Jn({color:r});t!=null&&t.texture&&"map"in a&&(a.map=t.texture),n=new Z(o,a),n.name="Sphere"}break;case"ShaderBall":n=new Fr,n.name="ShaderBall",r5(n,t);break}return this.applyDefaultObjectOptions(n,t),n}static createSprite(i){const n=new fF({color:16777215});i!=null&&i.texture&&"map"in n&&(n.map=i.texture);const r=new pF(n);return this.applyDefaultObjectOptions(r,i),r}static applyDefaultObjectOptions(i,t){i.receiveShadow=!0,i.castShadow=!0,t!=null&&t.name&&(i.name=t.name),t!=null&&t.position&&(Array.isArray(t.position)?i.position.set(t.position[0],t.position[1],t.position[2]):i.position.set(t.position.x,t.position.y,t.position.z)),t!=null&&t.rotation&&(Array.isArray(t.rotation)?i.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]):i.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z)),t!=null&&t.scale&&(typeof t.scale=="number"?i.scale.set(t.scale,t.scale,t.scale):i.scale.set(t.scale.x,t.scale.y,t.scale.z)),(t==null?void 0:t.receiveShadow)!=null&&(i.receiveShadow=t.receiveShadow),(t==null?void 0:t.castShadow)!=null&&(i.castShadow=t.castShadow),t!=null&&t.parent&&t.parent.add(i)}}gm=new WeakSet,vx=function(i,t,n){const r=(n==null?void 0:n.depth)||.1;return new $8(i,{font:t,size:1,depth:r,height:r,bevelEnabled:(n==null?void 0:n.bevel)||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},ji(Uu,gm);function n5(s,i,t,n,r){const o=new gF,a=1e-5,l=n-a;o.absarc(a,a,a,-Math.PI/2,-Math.PI,!0),o.absarc(a,i-l*2,a,Math.PI,Math.PI/2,!0),o.absarc(s-l*2,i-l*2,a,Math.PI/2,0,!0),o.absarc(s-l*2,a,a,0,-Math.PI/2,!0);const c=new kP(o,{bevelEnabled:!0,bevelSegments:r*2,steps:1,bevelSize:l,bevelThickness:n,curveSegments:r});return c.scale(1,1,1-n),c.center(),c.computeVertexNormals(),c}const CA=new Map;function s5(s){let i="";switch(s){default:case"OpenSans":i="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":i="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(CA.has(i)){const r=CA.get(i);if(r)return r}const t=new e5,n=new Promise((r,o)=>{t.load(i,a=>{CA.set(i,a),r(a)},void 0,o)});return CA.set(i,n),n}let d_=!1,f_=null;function r5(s,i){if(f_===null){const t="https://cdn.needle.tools/static/models/shaderball.glb",n=new rl,r=wS(null);n.setDRACOLoader(r.dracoLoader),n.setKTX2Loader(r.ktx2Loader),d_=!0,f_=n.loadAsync(t).then(o=>{const a=o.scene;return a.position.y-=.5,a}).catch(o=>(console.warn("Failed to load shaderball mesh: "+o.message),JI())).finally(()=>{d_=!1})}if(d_){const t=JI();t.name="ShaderBall-Placeholder";const n=t.children[0];(n==null?void 0:n.type)==="Mesh"&&KI(n,i),s.add(t)}f_.then(t=>{s.children.forEach(o=>{o.name==="ShaderBall-Placeholder"&&s.remove(o)});const n=t.clone(),r=n.children[0];(r==null?void 0:r.type)==="Mesh"&&KI(r,i),s.add(n)})}function KI(s,i){var n;if((i==null?void 0:i.color)||(i==null?void 0:i.material)||(i==null?void 0:i.texture)){const r=(i==null?void 0:i.material)??((n=s.material)==null?void 0:n.clone())??new Jn;i.color&&"color"in r&&r.color instanceof xe&&r.color.set(i.color),i!=null&&i.texture&&"map"in r&&(r.map=i.texture),s.material=r}}function JI(){return new Fr().add(Uu.createPrimitive("Sphere",{material:new _t({transparent:!0,opacity:.1})}))}const JE=class{constructor(i,t,n){h(this,"_session");h(this,"_mode");h(this,"_init");h(this,"_renderer");h(this,"_camera");h(this,"_scene");h(this,"onEnd",()=>{var i;(i=this._session)==null||i.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});h(this,"_lastTime",0);h(this,"onFrame",(i,t)=>{const n=i-this._lastTime;this.update(i,n),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});h(this,"_objects",[]);this._mode=i,this._init=t,this._session=n,this._session.addEventListener("end",this.onEnd),this._renderer=new Mu({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(n),this._renderer.xr.enabled=!0,this._camera=new bt,this._scene=new ws,this._scene.fog=new DP(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(i,t){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!t)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const n=await navigator.xr.requestSession(i,t);return n.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new JE(i,t,n),this._active):(n.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await nc(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const i={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,i}async onBeforeHandoff(){await nc(1e3),this._scene.clear()}setupScene(){this._scene.background=new xe(0),this._scene.add(new SC(5,10,1118481,1118481));const i=new zg(16777215,1);i.position.set(0,20,0),i.castShadow=!1,this._scene.add(i);const t=new zg(16777215,1);t.position.set(0,-1,0),t.castShadow=!1,this._scene.add(t);const n=new Ng(16777215,1,100,1);n.position.set(0,2,0),n.castShadow=!1,n.distance=200,this._scene.add(n);const r=50;for(let o=0;o<100;o++){const a=new Jn({color:2236962,metalness:1,roughness:.8});this.isAR&&(a.emissive=new xe(Math.random(),Math.random(),Math.random()),a.emissiveIntensity=Math.random());const l=ye.random(0,1)>.5?Ko.Sphere:Ko.Cube,c=Uu.createPrimitive(l,{material:a});c.position.x=ye.random(-r,r),c.position.y=ye.random(-2,r),c.position.z=ye.random(-r,r),c.rotation.x=ye.random(0,Math.PI*2),c.rotation.y=ye.random(0,Math.PI*2),c.rotation.z=ye.random(0,Math.PI*2),c.scale.multiplyScalar(.5+Math.random()*10);const u=c.position.distanceTo(this._camera.position)-c.scale.x;u<1&&c.position.multiplyScalar(1+1/u),this._objects.push(c),this._scene.add(c)}}update(i,t){const n=i*4e-4;for(let r=0;r<this._objects.length;r++){const o=this._objects[r];o.position.y+=Math.sin(n+r*.5)*.005,o.rotateY(.002)}}};let Jc=JE;h(Jc,"_active",null),h(Jc,"_requestInFlight",!1);const ZI="NeedleXRSession onStart",$I="NeedleXRSession onEnd",Hi=Q("debugwebxr"),eT=Q("stats");let p_=0;function o5(s){let i=null;const t=s;return t.getAROverlayContainer?i=t.getAROverlayContainer():i=s,i}a5();async function a5(){var s;if(Q("debugasap")){let i=globalThis["needle:XRSession"];if(i instanceof Promise){delete globalThis["needle:XRSession"],xt.addContextCreatedCallback(async t=>{if(!i)return;of(!0);const n=await i;if(n){const r=Fe.getDefaultSessionInit("immersive-vr");Fe.setSession("immersive-vr",n,r,t.context)}else console.error("NeedleXRSession: ASAP session was rejected");i=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(s=navigator.xr)==null||s.addEventListener("sessiongranted",async()=>{of(!0),console.log("Received Session Granted..."),await nc(100);const i=sessionStorage.getItem("needle_xr_session_mode"),t=sessionStorage.getItem("needle_xr_session_init")??null,n=t?JSON.parse(t):null;let r=null;if(UD()&&(await Jc.start(i||"immersive-vr",n||Fe.getDefaultSessionInit("immersive-vr")),await h5(),r=await Jc.handoff()),r)Fe.setSession(r.mode,r.session,r.init,Ge.Current);else if(i&&t){console.log("Session Granted: Restore last session");const o=JSON.parse(t);Fe.start(i,o).catch(a=>console.warn(a))}else Fe.start("immersive-vr").catch(o=>console.warn("Session Granted failed:",o))},{once:!0})}}function l5(s,i){sessionStorage.setItem("needle_xr_session_mode",s),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(i))}function c5(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const BS=new Set;xt.registerCallback(ut.ContextCreationStart,async s=>{BS.add(s.context)});xt.registerCallback(ut.ContextCreated,async s=>{BS.delete(s.context)});function UD(){return BS.size>0}function h5(){return new Promise(s=>{const i=Date.now(),t=setInterval(()=>{(!UD()||Date.now()-i>6e4)&&(clearInterval(t),s())},100)})}Gg()&&be()&&window.addEventListener("keydown",s=>{(s.key==="x"||s.key==="Escape")&&Fe.active&&Fe.stop()});const Ml=class{constructor(i,t,n,r){h(this,"context");h(this,"session");h(this,"mode");h(this,"controllers",[]);h(this,"_rigScale",1);h(this,"_lastRigScaleUpdate",-1);h(this,"_rigs",[]);h(this,"_viewerHitTestSource",null);h(this,"_defaultRig");h(this,"_xr_scripts");h(this,"_xr_update_scripts",[]);h(this,"_inactive_scripts",[]);h(this,"_controllerAdded");h(this,"_controllerRemoved");h(this,"_originalCameraWorldPosition");h(this,"_originalCameraWorldRotation");h(this,"_originalCameraWorldScale");h(this,"_originalCameraParent");h(this,"_mainCamera",null);h(this,"onRendererSessionSet",()=>{var i;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(i=this.context.mainCameraComponent)==null||i.applyClearFlags())});h(this,"onInputSourceAdded",i=>{if(i.targetRayMode==="screen")return;let t=0;for(let r=0;r<this.session.inputSources.length;r++)if(this.session.inputSources[r]===i){t=r;break}if(this.controllers.find(r=>r.inputSource===i)){console.warn("Controller already exists for input source",t);return}Hi&&console.log("Adding controller",t);const n=new Gk(this,i,t);this._newControllers.push(n)});h(this,"_ended",!1);h(this,"_newControllers",[]);h(this,"onEnd",i=>{var r,o,a;if(this._ended)return;this._ended=!0,Hi&&console.log("XR Session ended"),c5(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Ah(this.onBefore,qe.LateUpdate);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);t>=0&&this.context.pre_render_callbacks.splice(t,1);const n=this.context.post_render_callbacks.indexOf(this.onAfterRender);n>=0&&this.context.post_render_callbacks.splice(n,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var l,c;(l=this.context.mainCameraComponent)==null||l.applyClearFlags(),(c=this.context.mainCameraComponent)==null||c.applyClippingPlane()}),YG({session:this});for(const l of Ml._xrEndListeners)l({xr:this});for(let l=0;l<this.controllers.length;l++)this.disconnectInputSource(this.controllers[l].inputSource);for(const l of this._xr_scripts)(r=l==null?void 0:l.onLeaveXR)==null||r.call(l,{xr:this});(o=this.sync)==null||o.onExitXR(this),this.context.mainCamera&&((a=this._originalCameraParent)==null||a.add(this.context.mainCamera),this._originalCameraWorldPosition&&Sn(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&na(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&Kg(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),of(!1),performance.mark($I),performance.measure("NeedleXRSession",ZI,$I)});h(this,"_didStart",!1);h(this,"onBefore",i=>{var r,o,a,l,c,u,d,f;const t=i.xrFrame;if(!t)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((r=this.rig)==null?void 0:r.isActive)==!1&&(Hi&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((o=this._mainCamera)!=null&&o.gameObject)&&((l=(a=this._mainCamera)==null?void 0:a.gameObject)==null?void 0:l.parent)!==this.rig.gameObject&&this.rig.gameObject.add((c=this._mainCamera)==null?void 0:c.gameObject),this.internalUpdateState(),this.applyCustomForward();const n={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const p=[...this.context.new_scripts_xr];for(let g=0;g<p.length;g++){const m=this.context.new_scripts_xr[g];if(!m||m.destroyed||((u=m.supportsXR)==null?void 0:u.call(m,this.mode))==!1){this.context.new_scripts_xr.splice(g,1);continue}if(!m.activeAndEnabled){this.context.new_scripts_xr.splice(g,1),this.markInactive(m);continue}if(this.addScript(m)){this.invokeCallback_EnterXR(m);for(const A of this.controllers)this.invokeCallback_ControllerAdded(m,A)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const g=sl(this.context.scene.children);if(g){const m=g.getSize(Be());if(m.length()>0){const A=this._defaultRig.gameObject;A.position.set(g.min.x+m.x*.5,g.min.y,g.max.z+m.z*.5+1.5);const y=g.getCenter(Be());y.y=A.position.y,A.lookAt(y)}}}XG({session:this});for(const g of Ml._xrStartListeners)g(n);const p=[...this._xr_scripts];Hi&&console.log("NeedleXRSession start, handle scripts:",p);for(const g of p){if(g.destroyed){this._script_to_remove.push(g);continue}if(!g.activeAndEnabled){this.markInactive(g);continue}this.invokeCallback_EnterXR(g);for(const m of this.controllers)this.invokeCallback_ControllerAdded(g,m)}}this.syncCameraCullingMask();for(const p of this.controllers)p.onUpdate(t);if(this._newControllers.length>0){const p=[...this._newControllers];this._newControllers.length=0;for(const g of p){if(!g.connected){console.warn("New controller is not connected",g);continue}this.controllers.push(g);for(const m of this._xr_scripts){if(m.destroyed){this._script_to_remove.push(m);continue}m.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(m,g)}}this.controllers.sort((g,m)=>g.index-m.index)}Hi&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(of(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const p of this._xr_update_scripts){if(p.destroyed===!0){this._script_to_remove.push(p);continue}if(p.activeAndEnabled===!1){this.markInactive(p);continue}p.onUpdateXR&&p.onUpdateXR(n)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const p=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const g of p)!g.destroyed&&this.running&&((d=g.onLeaveXR)==null||d.call(g,n)),this.removeScript(g)}(f=this.sync)==null||f.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")});h(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});h(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),Gg()||!this._renderOnceOnDevice){const i=this.context.renderer;if(i.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const t=i.xr.enabled,n=i.getRenderTarget(),r=this.context.scene.background;i.xr.enabled=!1,i.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):i.render(this.context.scene,this.context.mainCamera),i.xr.enabled=t,i.setRenderTarget(n),this.context.scene.background=r}}});h(this,"_script_to_remove",[]);h(this,"_camera");h(this,"_cameraRenderParent",new ne().rotateY(Math.PI));h(this,"_previousCameraParent");h(this,"_customforward",!0);h(this,"originalCameraNearPlane");h(this,"_viewerPose");h(this,"_transformOrientation",new se);h(this,"_transformPosition",new x);h(this,"_transition");var o,a;performance.mark(ZI),l5(i,r.init),this.session=t,this.mode=i,this.context=n,(Hi||Q("console"))&&of(!0),this._xr_scripts=[...r.scripts],this._xr_update_scripts=this._xr_scripts.filter(l=>typeof l.onUpdateXR=="function"),this._controllerAdded=r.controller_added,this._controllerRemoved=r.controller_removed,mh(this.onBefore,qe.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((o=r.init.optionalFeatures)!=null&&o.includes("hit-test")||(a=r.init.requiredFeatures)!=null&&a.includes("hit-test"))&&t.requestReferenceSpace("viewer").then(l=>{var c,u;return(u=(c=t.requestHitTestSource)==null?void 0:c.call(t,{space:l}))==null?void 0:u.then(d=>this._viewerHitTestSource=d).catch(d=>console.error(d))}).catch(l=>console.error(l)),this.context.mainCamera&&(this._originalCameraWorldPosition=Ve(this.context.mainCamera,new x),this._originalCameraWorldRotation=Ht(this.context.mainCamera,new se),this._originalCameraWorldScale=oi(this.context.mainCamera,new x),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new r8,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let l=0;l<t.inputSources.length;l++){const c=t.inputSources[l];if(!c.handedness){console.warn("Input source in xr session has no handedness - ignoring",l);continue}this.onInputSourceAdded(c)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",l=>{for(const c of l.removed)this.disconnectInputSource(c);for(const c of l.added)this.onInputSourceAdded(c)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):Hi&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(i){return this._sync||(this._sync=new Z8(i)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var i;return((i=this._activeSession)==null?void 0:i.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(i=>i.some(t=>t)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(i){var t;return((t=this.xrSystem)==null?void 0:t.isSessionSupported(i).catch(n=>(Hi&&console.error(n),!1)))??Promise.resolve(!1)}static onSessionRequestStart(i){this._sessionRequestStartListeners.push(i)}static offSessionRequestStart(i){const t=this._sessionRequestStartListeners.indexOf(i);t>=0&&this._sessionRequestStartListeners.splice(t,1)}static onSessionRequestEnd(i){this._sessionRequestEndListeners.push(i)}static offSessionRequestEnd(i){const t=this._sessionRequestEndListeners.indexOf(i);t>=0&&this._sessionRequestEndListeners.splice(t,1)}static onXRSessionStart(i){this._xrStartListeners.push(i)}static offXRSessionStart(i){const t=this._xrStartListeners.indexOf(i);t>=0&&this._xrStartListeners.splice(t,1)}static onXRSessionEnd(i){this._xrEndListeners.push(i)}static offXRSessionEnd(i){const t=this._xrEndListeners.indexOf(i);t>=0&&this._xrEndListeners.splice(t,1)}static onControllerAdded(i){this._controllerAddedListeners.push(i)}static offControllerAdded(i){const t=this._controllerAddedListeners.indexOf(i);t>=0&&this._controllerAddedListeners.splice(t,1)}static onControllerRemoved(i){this._controllerRemovedListeners.push(i)}static offControllerRemoved(i){const t=this._controllerRemovedListeners.indexOf(i);t>=0&&this._controllerRemovedListeners.splice(t,1)}static offerSession(i,t,n){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+i),t=="default"&&(t=this.getDefaultSessionInit(i)),navigator.xr.offerSession(i,{...t}).then(r=>Ml.setSession(i,r,t,n)).catch(r=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(i){switch(i){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",i),{}}}static async start(i,t,n){var l,c,u,d;if(be()&&Q("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await Jc.start(i,t||Ml.getDefaultSessionInit(i)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(Hi||be())&&Xt("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(n||(n=Ge.Current),n||(n=xt.All[0]),!n)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),t||(t={}),i){case"immersive-ar":{if(await((l=this.xrSystem)==null?void 0:l.isSessionSupported("immersive-ar"))!==!0)return console.error(i+" is not supported by this browser."),null;const p=this.getDefaultSessionInit(i),g=o5(n.domElement);g&&!UC()&&(p.domOverlay={root:g},p.optionalFeatures.push("dom-overlay")),t={...p,...t}}break;case"immersive-vr":{if(await((c=this.xrSystem)==null?void 0:c.isSessionSupported("immersive-vr"))!==!0)return console.error(i+" is not supported by this browser."),null;t={...this.getDefaultSessionInit(i),...t}}break;default:console.warn("No default session init for mode",i);break}t.optionalFeatures??(t.optionalFeatures=[]),t.requiredFeatures??(t.requiredFeatures=[]),await Jc.stop();const r=i=="immersive-ar"?n.scripts_immersive_ar:n.scripts_immersive_vr;Hi?console.log(`%cRequesting ${i} session`,"font-weight:bold;",t,r):console.log(`%cRequesting ${i} session`,"font-weight:bold;");for(const f of r)f.onBeforeXR&&f.onBeforeXR(i,t);for(const f of this._sessionRequestStartListeners)f({mode:i,init:t});Hi&&bi("Requesting "+i+" session ("+Date.now()+")"),this._currentSessionRequest=(u=navigator.xr)==null?void 0:u.requestSession(i,t),this._currentSessionRequestMode=i;const o=await((d=this._currentSessionRequest)==null?void 0:d.catch(f=>{console.error(f,"Code: "+f.code),f.code===9&&Xt("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&Xt("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const f of this._sessionRequestEndListeners)f({mode:i,init:t,newSession:o||null});if(!o)return console.warn("XR Session request was rejected"),null;const a=this.setSession(i,o,t,n);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),a}static setSession(i,t,n,r){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const o=i=="immersive-ar"?r.scripts_immersive_ar:r.scripts_immersive_vr;return this._activeSession=new Ml(i,t,r,{scripts:o,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:n}),t.addEventListener("end",this.onEnd),Hi?console.log(`%cStarted ${i} session`,"font-weight:bold;",o):console.log(`%cStarted ${i} session`,"font-weight:bold;"),this._activeSession}static stop(){var i;(i=this._activeSession)==null||i.end()}get sync(){return Ml._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(i=>i.side==="left")}get rightController(){return this.controllers.find(i=>i.side==="right")}getController(i){return typeof i=="number"?this.controllers[i]||null:this.controllers.find(t=>t.side===i)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(i=>i.inputSource.targetRayMode==="tracked-pointer")||be()&&Gg()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const i=this.frame.getImageTrackingResults();for(const t of i)if(t.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const i=this._rigs[0]??null;return i!=null&&i.gameObject&&kf(i.gameObject)||(i==null?void 0:i.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):i}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(i){this._rigs.indexOf(i)>=0||(i.priority===void 0&&(i.priority=0),this._rigs.push(i),this.updateActiveXRRig())}removeRig(i){const t=this._rigs.indexOf(i);t!==-1&&(this._rigs.splice(t,1),this.updateActiveXRRig())}setRigActive(i){const t=this._rigs.indexOf(i);this._rigs.splice(t,1),this._rigs.unshift(i),this.updateActiveXRRig()}getUserOffsetInRig(){var n;const i=(n=this.context.mainCamera)==null?void 0:n.position;if(!i||!this.rig)return Be(0,0,0);const t=Be(i);return t.x*=-1,t.z*=-1,t.applyQuaternion(Ia(this.rig.gameObject.quaternion)),t}updateActiveXRRig(){const i=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let t=this._rigs[0];t&&t.priority===void 0&&(t.priority=0);for(let n=1;n<this._rigs.length;n++){const r=this._rigs[n];if(r.isActive){if(kf(r.gameObject)){this._rigs.splice(n,1),n--;continue}(!t||t.isActive===!1||r.priority!==void 0&&r.priority>t.priority)&&(t=r)}}if(i!==t){const n=this._rigs.indexOf(t);n>=0&&this._rigs.splice(n,1),this._rigs.unshift(t)}Hi&&(i===t?console.log("Updated Active XR Rig:",t,"prev:",i):console.log("Updated Active XRRig:",t," (the same as before)"))}getHitTest(i){if(i)return this.getControllerHitTest(i);if(!this._viewerHitTestSource)return null;const t=this._viewerHitTestSource,n=this.frame.getHitTestResults(t);if(n.length>0){const r=n[0];return this.convertHitTestResult(r)}return null}getControllerHitTest(i){const t=i.getHitTestSource();if(!t)return null;const n=this.frame.getHitTestResultsForTransientInput(t);for(const r of n)if(r.inputSource===i.inputSource)for(const o of r.results)return this.convertHitTestResult(o);return null}convertHitTestResult(i){const t=this.context.renderer.xr.getReferenceSpace(),n=t&&i.getPose(t);if(n){const r=Be(n.transform.position),o=Ia(n.transform.orientation),a=this.context.mainCamera;if((a==null?void 0:a.parent)!==this._cameraRenderParent&&r.applyMatrix4(lf),a!=null&&a.parent){r.applyMatrix4(a.parent.matrixWorld),o.multiply(ao);const l=Ht(a.parent);l.premultiply(ao),o.premultiply(l)}return{hit:i,position:r,quaternion:o}}return null}convertSpace(i){const t=Be(i.position);t.applyMatrix4(lf);const n=Ia(i.orientation);return n.premultiply(ao),{position:t,quaternion:n}}disconnectInputSource(i){const t=(n,r,o)=>{if(n.inputSource===i){Hi&&console.log("Disconnecting controller",n.index),this.controllers.splice(o,1),this.invokeControllerEvent(n,this._controllerRemoved,"removed");const a={xr:this,controller:n,change:"removed"};for(const l of this._xr_scripts)l.onXRControllerRemoved&&l.onXRControllerRemoved(a);n.onDisconnected()}};for(let n=this.controllers.length-1;n>=0;n--){const r=this.controllers[n];t(r,this.controllers,n)}for(let n=this._newControllers.length-1;n>=0;n--){const r=this._newControllers[n];t(r,this._newControllers,n)}}end(){this._ended||this.session.end().catch(i=>console.warn(i))}onRenderDebug(){if(Hi)for(const i of this.controllers)i.onRenderDebug();if((Hi||eT)&&this.rig&&(p_++,p_>=20)){const i=this.rig.gameObject.worldPosition,t=this.rig.gameObject.worldForward;i.add(t.multiplyScalar(1.5));const n=this.rig.gameObject.worldUp;i.add(n.multiplyScalar(2.5));let r="";if(r+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,r+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,Hi||eT)for(const o of this.controllers)r+=`
${o.hand?"hand":"ctrl"} ${o.inputSource.handedness}[${o.index}] con:${o.connected} tr:${o.isTracking} hts:${o.hasHitTestSource?"yes":"no"}`;p_=0,Pe.DrawLabel(i,r,void 0,1/60*20)}}addScript(i){return this._xr_scripts.includes(i)?!1:(Hi&&console.log("Register new XRScript",i),this._xr_scripts.push(i),typeof i.onUpdateXR=="function"&&this._xr_update_scripts.push(i),!0)}markInactive(i){if(!(this._inactive_scripts.indexOf(i)>=0)){this.removeScript(i,!1),this._inactive_scripts.push(i);for(const t of this.controllers)this.invokeCallback_ControllerRemoved(i,t);this.invokeCallback_LeaveXR(i)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let i=this._inactive_scripts.length-1;i>=0;i--){const t=this._inactive_scripts[i];if(t.activeAndEnabled){this._inactive_scripts.splice(i,1),this.addScript(t),this.invokeCallback_EnterXR(t);for(const n of this.controllers)this.invokeCallback_ControllerAdded(t,n)}}}removeScript(i,t=!0){Hi&&console.log("Remove XRScript",i);const n=this._xr_scripts.indexOf(i);n>=0&&this._xr_scripts.splice(n,1);const r=this._xr_update_scripts.indexOf(i);if(r>=0&&this._xr_update_scripts.splice(r,1),t){const o=this._inactive_scripts.indexOf(i);o>=0&&this._inactive_scripts.splice(o,1)}}invokeCallback_EnterXR(i){i.onEnterXR&&i.onEnterXR({xr:this})}invokeCallback_ControllerAdded(i,t){i.onXRControllerAdded&&i.onXRControllerAdded({xr:this,controller:t,change:"added"})}invokeCallback_ControllerRemoved(i,t){i.onXRControllerRemoved&&i.onXRControllerRemoved({xr:this,controller:t,change:"removed"})}invokeCallback_LeaveXR(i){i.onLeaveXR&&!i.destroyed&&i.onLeaveXR({xr:this})}syncCameraCullingMask(){var n;const i=this.context.xrCamera,t=(n=this.context.mainCameraComponent)==null?void 0:n.cullingMask;if(i&&t!==void 0){for(const r of i.cameras)r.layers.mask=t;i.layers.mask=t}else if(i){for(const r of i.cameras)r.layers.enableAll();i.layers.enableAll()}}invokeControllerEvent(i,t,n){for(let r=t.length-1;r>=0;r--){const o=t[r];if(o)try{o({xr:this,controller:i,change:n})}catch(a){console.error(a)}}}applyCustomForward(){var i;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(i=this._previousCameraParent)==null||i.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let t=.02;if(this.rig){const n=oi(this.rig.gameObject);t*=n.x}this._camera instanceof bt&&this._camera.near>t&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=t)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof bt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const i=this.context.renderer.xr.getReferenceSpace();if(!i){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(i),this._viewerPose){const t=this._viewerPose.transform;this._transformPosition.set(t.position.x,t.position.y,t.position.z),this._transformOrientation.set(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)}}get transition(){return this._transition||(this._transition=new YI),this._transition}fadeTransition(){return this._transition||(this._transition=new YI),this._transition.fadeTransition()}updateFade(i){this._transition&&i instanceof bt&&this._transition.update(i,this.context.time.deltaTime)}onUpdateFade_PostRender(){var i;(i=this._transition)==null||i.remove()}};let Fe=Ml;h(Fe,"_sync",null),h(Fe,"_currentSessionRequestMode",null),h(Fe,"_currentSessionRequest"),h(Fe,"_activeSession"),h(Fe,"_sessionRequestStartListeners",[]),h(Fe,"_sessionRequestEndListeners",[]),h(Fe,"_xrStartListeners",[]),h(Fe,"_xrEndListeners",[]),h(Fe,"_controllerAddedListeners",[]),h(Fe,"_controllerRemovedListeners",[]),h(Fe,"onEnd",()=>{Hi&&console.log("XR Session ended"),Ml._activeSession=null});const g_=Q("debugwebxr");class u5{static tryFindAvatarObjects(i,t,n){if(n.head&&n.leftHand&&n.rightHand)return;const r=i.name.toLocaleLowerCase();!n.head&&r.includes("head")&&(g_&&console.log("FOUND AVATAR HEAD",i.name),n.head=new tt("",t,i)),r.includes("hand")&&(!n.leftHand&&r.includes("left")&&(g_&&console.log("FOUND AVATAR LEFT HAND",i.name),n.leftHand=new tt("",t,i)),!n.rightHand&&r.includes("right")&&(g_&&console.log("FOUND AVATAR RIGHT HAND",i.name),n.rightHand=new tt("",t,i)));for(let o=0;o<i.children.length;o++){if(n.head&&n.leftHand&&n.rightHand)return;const a=i.children[o];this.tryFindAvatarObjects(a,t,n)}}}const cs=new x,tT=new x,iT=new se,d5=Q("debuggizmos"),Lo=8947848,m_=32,no=class{constructor(){}static isGizmo(i){return i[yx]!==void 0}static DrawLabel(i,t,n=.05,r=0,o,a,l){var d;if(!no.enabled)return null;o||(o=Lo);const c=((d=Fe.active)==null?void 0:d.rigScale)??1,u=ri.getTextLabel(r,t,n*c,o,a);return l instanceof ne&&l.add(u),u.position.x=i.x,u.position.y=i.y,u.position.z=i.z,u}static DrawRay(i,t,n=Lo,r=0,o=!0){if(!no.enabled)return;const a=ri.getLine(r),l=a.geometry.getAttribute("position");l.setXYZ(0,i.x,i.y,i.z),cs.set(t.x,t.y,t.z).multiplyScalar(999999999),l.setXYZ(1,i.x+cs.x,i.y+cs.y,i.z+cs.z),l.needsUpdate=!0,a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1}static DrawDirection(i,t,n=Lo,r=0,o=!0,a=1){if(!no.enabled)return;const l=ri.getLine(r),c=l.geometry.getAttribute("position");c.setXYZ(0,i.x,i.y,i.z),t.w!==void 0?(cs.set(0,0,-a),iT.set(t.x,t.y,t.z,t.w),cs.applyQuaternion(iT)):(cs.set(t.x,t.y,t.z),cs.multiplyScalar(a)),c.setXYZ(1,i.x+cs.x,i.y+cs.y,i.z+cs.z),c.needsUpdate=!0,l.material.color.set(n),l.material.depthTest=o,l.material.depthWrite=!1}static DrawLine(i,t,n=Lo,r=0,o=!0){if(!no.enabled)return;const a=ri.getLine(r),l=a.geometry.getAttribute("position");l.setXYZ(0,i.x,i.y,i.z),l.setXYZ(1,t.x,t.y,t.z),l.needsUpdate=!0,a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawCircle(i,t,n,r=Lo,o=0,a=!0){if(!no.enabled)return;const l=ri.getCircle(o);l.position.set(i.x,i.y,i.z),l.scale.set(n,n,n),l.quaternion.setFromUnitVectors(this._up,cs.set(t.x,t.y,t.z).normalize()),l.material.color.set(r),l.material.depthTest=a,l.material.depthWrite=!1,l.material.fog=!1}static DrawWireSphere(i,t,n=Lo,r=0,o=!0){if(!no.enabled)return;const a=ri.getSphere(t,r,!0);Tf(a,i.x,i.y,i.z),a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawSphere(i,t,n=Lo,r=0,o=!0){if(!no.enabled)return;const a=ri.getSphere(t,r,!1);Tf(a,i.x,i.y,i.z),a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1}static DrawWireBox(i,t,n=Lo,r=0,o=!0){if(!no.enabled)return;const a=ri.getBox(r);a.position.set(i.x,i.y,i.z),a.scale.set(t.x,t.y,t.z),a.material.color.set(n),a.material.depthTest=o,a.material.wireframe=!0,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireBox3(i,t=Lo,n=0,r=!0){if(!no.enabled)return;const o=ri.getBox(n);o.position.copy(i.getCenter(cs)),o.scale.copy(i.getSize(cs)),o.material.color.set(t),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawArrow(i,t,n=Lo,r=0,o=!0,a=!1){if(!no.enabled)return;const l=ri.getArrowHead(r);l.position.set(t.x,t.y,t.z),l.quaternion.setFromUnitVectors(this._up.set(0,1,0),cs.set(t.x,t.y,t.z).sub(tT.set(i.x,i.y,i.z)).normalize());const u=cs.set(t.x,t.y,t.z).sub(tT.set(i.x,i.y,i.z)).length()*.1;l.scale.set(u,u,u),l.material.color.set(n),l.material.depthTest=o,l.material.wireframe=a,this.DrawLine(i,t,n,r,o)}static DrawWireMesh(i){const t=ri.getMesh(i.duration??0);"mesh"in i?(t.geometry=i.mesh.geometry,t.matrix.copy(i.mesh.matrixWorld)):(t.geometry=i.geometry,t.matrix.copy(i.matrix)),t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,t.material.color.set(i.color??Lo),t.material.depthTest=i.depthTest??!0,t.material.wireframe=!0}static setVisible(i){for(const t of ri.timedObjectsBuffer)t.visible=i}};let Pe=no;h(Pe,"enabled",!0),h(Pe,"_up",new x(0,1,0));const f5=new on(1,1,1);function PS(s=null){const i=new xe(s??14540253),t=new mF(f5);return new xf(t,new Zo({color:i}))}const yx=Symbol("GizmoCache");class ri{static ensureFont(){let i=qt.FontLibrary.getFontFamily(this.familyName);if(!i){i=qt.FontLibrary.addFontFamily(this.familyName);const t=i.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");t==null||t.addEventListener("ready",()=>{qt.update()})}}static getTextLabel(i,t,n,r,o){this.ensureFont();let a=this.textLabelCache.pop(),l=1;o&&typeof o=="string"&&(o==null?void 0:o.length)>=8&&o.startsWith("#")?(l=parseInt(o.substring(7),16)/255,o=o.substring(0,7),d5&&console.log(o,l)):typeof o=="object"&&o.a!==void 0&&(l=o.a);const c={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:n,color:r,lineHeight:1,backgroundColor:o??void 0,backgroundOpacity:l,textContent:t,borderRadius:.5*n,padding:.8*n,whiteSpace:"pre",offset:.05*n};if(a)a.set(c);else{a=new hS(c);const u=this,d=a;d.setText=function(f){this.set({textContent:f}),u.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Ge.Current,a,i,this.textLabelCache),a}static getBox(i){let t=this.boxesCache.pop();if(!t){const n=new on(1,1,1);t=new Z(n)}return this.registerTimedObject(Ge.Current,t,i,this.boxesCache),t}static getLine(i){let t=this.linesCache.pop();if(!t){t=new ms;let n=t.geometry.getAttribute("position");n||(n=new Je(new Float32Array(2*3),3),t.geometry.setAttribute("position",n))}return t.frustumCulled=!1,this.registerTimedObject(Ge.Current,t,i,this.linesCache),t}static getCircle(i){let t=this.circlesCache.pop();if(!t){t=new ms;let n=t.geometry.getAttribute("position");if(!n){n=new Je(new Float32Array(m_*3),3),t.geometry.setAttribute("position",n);const r=Be(0,1,0),o=Be(0,0,1),a=Be(o);a.cross(r).normalize();const l=Be(a),c=Math.PI*2/(m_-1);for(let u=0;u<m_+1;u++){const d=c*u;r.copy(l).multiplyScalar(Math.cos(d)*1),a.copy(o).multiplyScalar(Math.sin(d)*1);const f=r.add(a);n.setXYZ(u,f.x,f.y,f.z)}}}return t.frustumCulled=!1,this.registerTimedObject(Ge.Current,t,i,this.circlesCache),t}static getSphere(i,t,n){let r=this.spheresCache.pop();return r||(r=new Z(new Pu(1,8,8))),r.scale.set(i,i,i),r.material.wireframe=n,this.registerTimedObject(Ge.Current,r,t,this.spheresCache),r}static getArrowHead(i){let t=this.arrowHeadsCache.pop();return t||(t=new Z(new Ns(0,.5,1,8))),this.registerTimedObject(Ge.Current,t,i,this.arrowHeadsCache),t}static getMesh(i){let t=this.mesh.pop();return t||(t=new Z,t.material=new _t),this.registerTimedObject(Ge.Current,t,i,this.mesh),t}static registerTimedObject(i,t,n,r){if(!i){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const o=this.contextBeforeRenderCallbacks.get(i),a=this.contextPostRenderCallbacks.get(i);if(o){if(i.pre_render_callbacks[i.pre_render_callbacks.length-1]!==o){const l=i.pre_render_callbacks.indexOf(o);l>=0&&i.pre_render_callbacks.splice(l,1),i.pre_render_callbacks.push(o)}}else{const l=()=>{this.onBeforeRender(i,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(i,l),i.pre_render_callbacks.push(l)}if(a){if(i.post_render_callbacks[i.post_render_callbacks.length-1]!==a){const l=i.post_render_callbacks.indexOf(a);l>=0&&i.post_render_callbacks.splice(l,1),i.post_render_callbacks.push(a)}}else{const l=()=>{this.onPostRender(i,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(i,l),i.post_render_callbacks.push(l)}t.traverse(l=>{l.layers.disableAll(),l.layers.enable(2)}),t.renderOrder=999999,t[yx]=r,t.castShadow=!1,t.receiveShadow=!1,t.isGizmo=!0,this.timedObjectsBuffer.push(t),this.timesBuffer.push(Ge.Current.time.realtimeSinceStartup+n),i.scene.add(t)}static onBeforeRender(i,t){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,qt.update());for(let n=0;n<t.length;n++){const r=t[n];if(i.mainCamera&&r instanceof qt.MeshUIBaseElement){if(kf(r))continue;const o=i.isInVR,a=!1,l=!o;g0(r,i.mainCamera,a,l)}}}static onPostRender(i,t,n){const r=i.time.realtimeSinceStartup;for(let o=t.length-1;o>=0;o--){const a=t[o];r>=n[o]-1e-6&&(t.splice(o,1),n.splice(o,1),a.removeFromParent(),kf(a)!=!0&&a[yx].push(a))}}}h(ri,"familyName","needle-gizmos"),h(ri,"linesCache",[]),h(ri,"circlesCache",[]),h(ri,"spheresCache",[]),h(ri,"boxesCache",[]),h(ri,"arrowHeadsCache",[]),h(ri,"mesh",[]),h(ri,"textLabelCache",[]),h(ri,"timedObjectsBuffer",new Array),h(ri,"timesBuffer",new Array),h(ri,"contextPostRenderCallbacks",new Map),h(ri,"contextBeforeRenderCallbacks",new Map),h(ri,"tmuiNeedsUpdate",!1);const Wo=Q("debugphysics"),nT=new mo;class sc{constructor(){h(this,"ray");h(this,"cam");h(this,"screenPoint");h(this,"raycaster");h(this,"results");h(this,"targets");h(this,"recursive",!0);h(this,"minDistance");h(this,"maxDistance");h(this,"lineThreshold");h(this,"layerMask");h(this,"ignore");h(this,"testObject");h(this,"useAcceleratedRaycast")}screenPointFromOffset(i,t){this.screenPoint===void 0&&(this.screenPoint=new ae),this.screenPoint.x=i/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(i){nT.set(i),this.layerMask=nT}setMask(i){this.layerMask||(this.layerMask=new mo);const t=this.layerMask;t?t.mask=i:this.layerMask=i}}h(sc,"AllLayers",4294967295);class ND{constructor(i,t,n){h(this,"distance");h(this,"point");h(this,"object");this.object=i,this.distance=t,this.point=n}}const Wy=class{constructor(i){h(this,"context");h(this,"engine");h(this,"raycaster",new Du);h(this,"defaultRaycastOptions",new sc);h(this,"targetBuffer",new Array(1));h(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});h(this,"sphereResults",new Array);h(this,"sphereMask",new mo);h(this,"sphere",new hc);h(this,"tempBoundingBox",new Cn);this.context=i}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(i,t=void 0,n=1/0,r=!0){var o;return((o=this.context.physics.engine)==null?void 0:o.raycast(i,t,{maxDistance:n,solid:r}))??null}raycastPhysicsFastAndGetNormal(i,t=void 0,n=1/0,r=!0){var o;return((o=this.context.physics.engine)==null?void 0:o.raycastAndGetNormal(i,t,{maxDistance:n,solid:r}))??null}sphereOverlapPhysics(i,t){var n;return((n=this.context.physics.engine)==null?void 0:n.sphereOverlap(i,t))??null}sphereOverlap(i,t,n=!0,r=!1,o=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const a=this.sphereMask;a.enableAll(),a.disable(2);for(const l of this.context.scene.children)this.intersectSphere(l,i,t,a,this.sphereResults,n,r,o);return this.sphereResults.sort((l,c)=>l.distance-c.distance)}raycastFromRay(i,t=null){const n=t??this.defaultRaycastOptions;n.ray=i;const r=this.raycast(n);return n===this.defaultRaycastOptions&&(n.ray=void 0),r}raycast(i=null){Wo&&performance.mark("raycast.start"),i||(i=this.defaultRaycastOptions);const t=i.screenPoint??this.context.input.mousePositionRC,n=i.raycaster??this.raycaster;if(n.near=i.minDistance??0,n.far=i.maxDistance??1/0,n.params=this.defaultThresholds,i.lineThreshold===void 0&&(i.lineThreshold=-1),n.params.Line={threshold:i.lineThreshold},i.ray)n.ray.copy(i.ray);else{const l=i.cam??this.context.mainCamera;if(!l)return Wo&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const c=this.context.xrCamera;this.context.isInXR&&c instanceof AF&&c.cameras.length>0?n.setFromCamera(t,c.cameras[0]):n.setFromCamera(t,l)}let r=i.targets;r||(r=this.targetBuffer,r.length=1,r[0]=this.context.scene);let o=i.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),o||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),o=this.defaultRaycastOptions.results),i.layerMask!==void 0?i.layerMask instanceof mo?n.layers.mask=i.layerMask.mask:n.layers.mask=i.layerMask:(n.layers.enableAll(),n.layers.disable(2)),Wo&&(Pe.DrawRay(n.ray.origin,n.ray.direction,16711680,2),console.time("raycast")),o.length=0,Wy._raycasting++,this.intersect(this.raycaster,r,o,i),o.sort((l,c)=>l.distance-c.distance);const a=i.ignore;return a!==void 0&&a.length>0&&(o=o.filter(l=>!a.includes(l.object))),Wy._raycasting--,Wo&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",o!=null&&o.length?[...o]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),o}intersect(i,t,n,r){var o,a,l;for(const c of t){if(!c||c.visible===!1||Pe.isGizmo(c)||r.lineThreshold!==void 0&&r.lineThreshold<0&&c instanceof ms)continue;let u=!0;const d=c,f=d.geometry;if(r.testObject){const p=(o=r.testObject)==null?void 0:o.call(r,c);if(p===!1)continue;p==="continue in children"&&(u=!1)}if(u&&(f&&sT(f)||(u=!1)),u){const p=xm(c);p&&(d.geometry=p);const g=n.length;let m=!0;r.precise===!1&&(m=!1),m||(m=((l=(a=f.getAttribute("position"))==null?void 0:a.array)==null?void 0:l.length)<64),d instanceof If&&(m=!1),!m&&g5(d,i,n)||(r.useAcceleratedRaycast!==!1?ny.runMeshBVHRaycast(i,d,n,this.context):i.intersectObject(d,!1,n)),Wo&&n.length!=g&&Pe.DrawWireMesh({mesh:c,depthTest:!1,duration:.2,color:p?8969557:7798784}),d.geometry=f}r.recursive!==!1&&this.intersect(i,c.children,n,r)}return n}intersectSphere(i,t,n,r,o,a,l,c){let u=i&&i.isMesh&&i.layers.test(r)&&!Pe.isGizmo(i);u&&(u=i.visible),u&&(u=!(i instanceof ms)),u&&(u=!(i instanceof If));const d=i,f=d.geometry;if(u&&c){const p=c(i);if(p===!1)return;p==="continue in children"&&(u=!1)}if(f&&sT(f)||(u=!1),u){if(l){const p=this.sphere;p.center.copy(t),p.radius=n;const g=o.length;if(ny.runMeshBVHRaycast(this.sphere,d,o,this.context),g!=o.length&&!a)return}else if(f.boundingBox||f.computeBoundingBox(),f.boundingBox){d.matrixWorldNeedsUpdate&&d.updateWorldMatrix(!1,!1);const p=this.tempBoundingBox.copy(f.boundingBox).applyMatrix4(d.matrixWorld),g=this.sphere;if(g.center.copy(t),g.radius=n,g.intersectsBox(p)){const m=Ve(i),A=m.distanceTo(g.center),y=new ND(i,A,m);if(o.push(y),!a)return}}}if(i.children)for(const p of i.children){const g=o.length;if(this.intersectSphere(p,t,n,r,o,a,l,c),g!=o.length&&!a)return}}};let ag=Wy;h(ag,"_raycasting",0);function sT(s){return!(s.index&&s.index.array.length<3)}const Oh=new hc,SA=new tc,p5=new za;function g5(s,i,t){const n=s._computeIntersections;if(!n)return!1;let r=s["_computeIntersections:Needle"];return r||(r=s["_computeIntersections:Needle"]=function(o,a,l){const c=this,u=c.geometry.boundingSphere;if(u){if(c instanceof If){SA.setFromNormalAndCoplanarPoint(Be(0,1,0),Be(0,-c.position.y,0)),SA.applyMatrix4(c.matrixWorld,p5);const f=o.ray.intersectPlane(SA,Be());if(f){Oh.copy(u),Oh.applyMatrix4(c.matrixWorld);const g=Be(f).sub(o.ray.origin).length(),m=Oh.radius*.5;g<m&&a.push({distance:g,point:f,object:c,normal:SA.normal.clone()})}return}Oh.copy(u),Oh.applyMatrix4(c.matrixWorld);const d=o.ray.intersectSphere(Oh,Be());if(d){const f=Be(d).sub(o.ray.origin),p=f.length();if(p>Oh.radius){const g=f.clone().normalize();a.push({distance:p,point:d,object:c,normal:g})}}}}),s._computeIntersections=r,i.intersectObject(s,!1,t),s._computeIntersections=n,!0}var ny;(function(s){function i(b,_,w,S){var I,k,T;if(!_.geometry||!_.geometry.hasAttribute("position"))return!1;const E=_.geometry;if(_!=null&&_.isSkinnedMesh){const P=_,B=P.bvhNeedsUpdate;if(!P.staticGenerator)l(),o&&(P.staticGenerator=new o(_),P.staticGenerator.applyWorldTransforms=!1,P.staticGeometry=P.staticGenerator.generate(),E.boundsTree=a==null?void 0:a.call(P.staticGeometry),P.staticGeometryLastUpdate=performance.now()+Math.random()*200,P.autoUpdateMeshBVH===void 0&&(P.autoUpdateMeshBVH=!1));else if(E.boundsTree&&(P.autoUpdateMeshBVH===!0||B===!0)){const M=performance.now(),U=M-P.staticGeometryLastUpdate;(B||U>100)&&(P.bvhNeedsUpdate=!1,P.staticGeometryLastUpdate=M,(I=P.staticGenerator)==null||I.generate(P.staticGeometry),E.boundsTree.refit())}}else if(!E.boundsTree){u||y();let P=!0;if((S.xr||E[g]===!1||(k=E.getAttribute("position"))!=null&&k.isInterleavedBufferAttribute||E.index&&((T=E.index)!=null&&T.isInterleavedBufferAttribute))&&(P=!1),P&&f){if(E[p]===void 0){let B=null;if(A.length>0){const M=A.shift();M&&!M.running&&(B=M)}if(!B&&m.length<3&&(B=new f,m.push(B)),B!=null&&!B.running){Wo&&console.log("<<<< worker start",B),E[p]="queued",performance.mark("bvh.create.start");const M=E.clone();B.generate(M).then(U=>{E[p]="done",E.boundsTree=U}).catch(U=>{E[p]="failed - "+(U==null?void 0:U.message),E[g]=!1}).finally(()=>{Wo&&console.log(">>>>> worker done"),A.push(B),M.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}else Wo&&console.warn("No worker available")}}else(!d||!P)&&(l(),r&&(performance.mark("bvh.create.start"),E.boundsTree=new r(E),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(b instanceof Du){const P=b,B=_.raycast;n&&E.boundsTree?(_.acceleratedRaycast||(_.acceleratedRaycast=n.bind(_)),_.raycast=_.acceleratedRaycast):Wo&&console.warn("No bounds tree found for mesh",_.name);const M=P.firstHitOnly;return P.firstHitOnly=!1,P.intersectObject(_,!1,w),P.firstHitOnly=M,_.raycast=B,!0}else if(b instanceof hc){const P=E.boundsTree;if(P){const B=b;if(c.copy(_.matrixWorld).invert(),B.applyMatrix4(c),P.intersectsSphere(B)){const U=Ve(_),G=U.distanceTo(B.center),W=new ND(_,G,U);w.push(W)}}return!0}return!1}s.runMeshBVHRaycast=i;let t=!1,n=null,r=null,o=null,a=null;function l(){t||(t=!0,hh(()=>import("./index-6703deee.js"),["./index-6703deee.js","./MeshBVH-b62bff9f.js","./three.module-19edce0d.js"],import.meta.url).then(b=>{n=b.acceleratedRaycast,r=b.MeshBVH,o=b.StaticGeometryGenerator,a=b.computeBoundsTree}).catch(b=>{(Wo||be())&&console.warn("Failed to load mesh bvh library")}))}const c=new le;let u=!1,d=!1,f=null;const p=Symbol("Needle:MeshBVH-Worker"),g=Symbol("Needle:MeshBVH-CanUseWorker"),m=[],A=[];function y(){u=!0,d=!0,hh(()=>import("./GenerateMeshBVHWorker-a6403e14.js"),["./GenerateMeshBVHWorker-a6403e14.js","./three.module-19edce0d.js","./MeshBVH-b62bff9f.js"],import.meta.url).then(b=>{f=b.GenerateMeshBVHWorker}).catch(b=>{(Wo||be())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{d=!1})}})(ny||(ny={}));const rT=Symbol("gltf-loader-internal-usage-tracker"),m5=Q("debugusers"),kg=class{constructor(i){h(this,"parser");h(this,"_getDependency");h(this,"_loadingId");h(this,"_loadedObjects",new Set);this.parser=i,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(i){return kg._loadingProcesses>0}beforeRoot(){kg._loadingProcesses++;const i=this,t=this._getDependency;return this.parser.getDependency=function(n,r){const o=t.call(this,n,r);return o.then(a=>(a&&(i._loadedObjects.add(a),a[rT]=i._loadingId),a)),o},null}afterRoot(i){kg._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[rT],t instanceof ne&&(t.parent||t instanceof Z&&setTimeout(()=>{m5&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null},1e3));return null}};let lg=kg;h(lg,"_loadingProcesses",0);class A5{constructor(){window.addEventListener("unhandledrejection",i=>{var n;if(i.defaultPrevented)return;const t=(n=i==null?void 0:i.reason)==null?void 0:n.path;if(t){const r=t[0];r&&r.tagName==="IMG"&&(console.warn(`Could not load image:
`+r.src),i.preventDefault())}})}}const w0=Q("trackresources");function zD(){return w0==="dispose"}let Nu=!0;w0===0&&(Nu=!1);function FK(s){Nu=s}function v5(){return Nu}const QD=Symbol("disposable");function jD(s,i){s&&(s[QD]=i,uu&&console.warn("Set disposable",i,s))}const GD=Symbol("disposed");function UK(s){return s[GD]===!0}function si(s){var i;if(s){if(s[QD]===!1){uu&&console.warn("Object is marked as not disposable",s);return}if(s[GD]=!0,s instanceof ws)si(s.environment),si(s.background),si(s.customDepthMaterial),si(s.customDistanceMaterial);else if(s instanceof $o)si(s.geometry),si(s.material),si(s.skeleton),si(s.bindMatrix),si(s.bindMatrixInverse),si(s.customDepthMaterial),si(s.customDistanceMaterial),s.geometry=null,s.material=null;else if(s instanceof Z)si(s.geometry),si(s.material),si(s.customDepthMaterial),si(s.customDistanceMaterial),s.geometry=null,s.material=null;else if(s instanceof Vt){hd(s);for(const t of Object.keys(s.attributes)){const n=s.attributes[t];si(n)}}else if(s instanceof Je||s instanceof Xc)uu&&console.warn("BufferAttribute dispose not supported",s.count);else if(s instanceof Array)for(const t of s)t instanceof mt&&si(t);else if(s instanceof mt){hd(s);for(const n of Object.keys(s)){const r=s[n];r instanceof At&&(si(r),s[n]=null)}const t=s.uniforms;if(t)for(const n of Object.keys(t)){const r=t[n];r instanceof At?(si(r),t[n]=null):r instanceof ee&&(si(r.value),r.value=null)}}else s instanceof At?(hd(s),hd(s.source),((i=s.source)==null?void 0:i.data)instanceof ImageBitmap&&hd(s.source.data)):s instanceof BC?(hd(s.boneTexture),s.boneTexture=null):s instanceof jv||!(s instanceof ne)&&uu&&console.warn("Unknown object type",s)}}function hd(s){s&&((uu||zD()||w0)&&console.warn("ðŸ§¨ FREE",s),s instanceof ImageBitmap?s.close():s instanceof OP?s.data=null:s.dispose())}function y5(s){(s instanceof Z||s instanceof $o)&&(s.material=null,s.geometry=null)}const b5=new Set;function HD(s,i,t=null,n){if(n||(n=b5,n.clear()),!s)return n;const r=s[$g];if(r)for(const o of r)n.has(o)||(t==null?void 0:t.call(null,o))!==!1&&(n.add(o),i&&HD(o,!0,t,n));return n}function NK(s){return s[jp]}const uu=Q("debugresourceusers")||Q("debugmemory"),$g=Symbol("needle-resource-users"),jp=Symbol("needle-resource-users-count");function Ls(s,i){yS(s,i,function(t,n){Nu&&!ag.raycasting&&(sy($g,this,t,!1),sy($g,this,n,!0))})}Nu&&(Ls(Z.prototype,"material"),Ls(Z.prototype,"geometry"),Ls(mt.prototype,"map"),Ls(mt.prototype,"bumpMap"),Ls(mt.prototype,"alphaMap"),Ls(mt.prototype,"normalMap"),Ls(mt.prototype,"displacementMap"),Ls(mt.prototype,"roughnessMap"),Ls(mt.prototype,"metalnessMap"),Ls(mt.prototype,"emissiveMap"),Ls(mt.prototype,"specularMap"),Ls(mt.prototype,"envMap"),Ls(mt.prototype,"lightMap"),Ls(mt.prototype,"aoMap"),Ls(mt.prototype,"gradientMap"));function _5(s){if(Nu===!1)return;const i=s[$g];if(i)for(const t of i)sy($g,t,s,!1)}Nu&&yS(mt.prototype,"dispose",function(){_5(this)});let bx=0;function sy(s,i,t,n){if(bx>0)return;if(Array.isArray(t)){for(const o of t)sy(s,i,o,n);return}if(!t)return;let r=t[s];if(r||(r=new Set),n){if(i&&!r.has(i)){r.add(i);let o=t[jp]||0;o+=1,t[jp]=o,uu&&console.warn(`ðŸŸ¢ Added user of "${t.type}"`,i,t,o,"users:",r)}}else if(i&&r.has(i)){r.delete(i);let o=t[jp]||0;o>0&&(o-=1,t[jp]=o),uu&&console.warn(`ðŸ”´ Removed user of "${t.type}"`,i,t,o,"users:",r),o<=0&&(lg.isLoading(t)||(w0&&console.warn(`ðŸ”´ Removed all user of "${t.type}"`,t),zD()&&si(t)))}t[s]=r}try{yS(Mu.prototype,"render",function(){bx++},function(){bx--})}catch(s){console.warn("Could not wrap WebGLRenderer.render",s)}var em;(function(s){s.Added="component-added",s.Removing="removing-component"})(em||(em={}));const oT=Q("debugcomponentevents");class x0{static addComponentLifecylceEventListener(i,t){this.eventListeners.has(i)&&this.eventListeners.set(i,[]);let n=this.eventListeners.get(i);n||(n=[]),n.push(t),this.eventListeners.set(i,n),oT&&console.log("Added event listener for "+i,this.eventListeners)}static removeComponentLifecylceEventListener(i,t){const n=this.eventListeners.get(i);if(!n)return;const r=n.indexOf(t);r<0||n.splice(r,1)}static dispatchComponentLifecycleEvent(i,t){const n=this.eventListeners.get(i);if(oT&&console.log("Dispatching event "+i,n),!!n)for(const r of n)r(t)}}h(x0,"eventListeners",new Map);const tm=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),VD=Symbol("isUsingInstancing"),WD=Symbol("instancingRenderer"),Gp=Symbol("instancingAutoUpdateBounds");class ta{static isUsingInstancing(i){return i[VD]===!0}static getRenderer(i){return i[WD]||null}setAutoUpdateBounds(i,t){const n=ta.getRenderer(i);n&&(n[Gp]=t)}static markDirty(i,t=!0){if(i&&(this.isUsingInstancing(i)&&(i[tm]=!0,i.matrixWorldNeedsUpdate=!0),t))for(const n of i.children)ta.markDirty(n,!0)}}function hf(s,i){try{i?s(i):s()}catch(t){return console.error(t),!1}return!0}const _x=Q("debugnewscripts"),w5=Q("debughierarchy"),ui=[];function x5(){return ui.length>0}function ry(s){if(!(s.new_scripts.length<=0)){if(_x&&console.log("Register new components",s.new_scripts.length,[...s.new_scripts],s.alias?"element: "+s.alias:s.hash,s),s.new_scripts_pre_setup_callbacks.length>0){for(const i of s.new_scripts_pre_setup_callbacks)i&&i();s.new_scripts_pre_setup_callbacks.length=0}ui.length=0,s.new_scripts.length>0&&ui.push(...s.new_scripts),s.new_scripts.length=0;for(let i=0;i<ui.length;i++)try{const t=ui[i];if(t.isComponent!==!0){(be()||_x)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),ui.splice(i,1),i--;continue}if(t.destroyed)continue;if(!t.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),ui.splice(i,1),i--;continue}t.context=s,cg(t.gameObject),MS(t,s)}catch(t){console.error(t),Ul(ui[i],s),ui.splice(i,1),i--}for(let i=0;i<ui.length;i++)try{const t=ui[i];if(t.destroyed){Ul(ui[i],s),ui.splice(i,1),i--;continue}if(t.registering)try{t.registering()}catch(n){console.error(n)}t.__internalAwake!==void 0&&(t.gameObject||console.error("Calling awake for a component without a GameObject",t,t.gameObject),cg(t.gameObject),t.activeAndEnabled&&hf(t.__internalAwake.bind(t)))}catch(t){console.error(t),Ul(ui[i],s),ui.splice(i,1),i--}for(let i=0;i<ui.length;i++)try{const t=ui[i];if(t.destroyed||t.enabled===!1||(cg(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,hf(t.__internalEnable.bind(t)))}catch(t){console.error(t),Ul(ui[i],s),ui.splice(i,1),i--}for(let i=0;i<ui.length;i++)try{const t=ui[i];if(t.destroyed||!t.gameObject)continue;s.new_script_start.push(t)}catch(t){console.error(t),Ul(ui[i],s),ui.splice(i,1),i--}ui.length=0;for(const i of s.new_scripts_post_setup_callbacks)i&&i();s.new_scripts_post_setup_callbacks.length=0}}function C5(s){s&&(s.__internalDisable(!0),Ul(s,s.context))}function qD(s,i){for(let t=0;t<s.new_script_start.length;t++)try{const n=s.new_script_start[t];if(i!==void 0&&n.gameObject!==i||n.destroyed||n.activeAndEnabled===!1)continue;hf(n.__internalAwake.bind(n)),n.enabled&&(hf(n.__internalEnable.bind(n)),hf(n.__internalStart.bind(n)),s.new_script_start.splice(t,1),t--)}catch(n){console.error(n),Ul(s.new_script_start[t],s),s.new_script_start.splice(t,1),t--}}function MS(s,i){i.scripts.indexOf(s)===-1&&(i.scripts.push(s),s.earlyUpdate&&i.scripts_earlyUpdate.push(s),s.update&&i.scripts_update.push(s),s.lateUpdate&&i.scripts_lateUpdate.push(s),s.onBeforeRender&&i.scripts_onBeforeRender.push(s),s.onAfterRender&&i.scripts_onAfterRender.push(s),s.onPausedChanged&&i.scripts_pausedChanged.push(s),A_(s,null)&&i.new_scripts_xr.push(s),A_(s,"immersive-vr")&&i.scripts_immersive_vr.push(s),A_(s,"immersive-ar")&&i.scripts_immersive_ar.push(s))}function Ul(s,i){Jr(s,i.new_scripts),Jr(s,i.new_script_start),Jr(s,i.scripts),Jr(s,i.scripts_earlyUpdate),Jr(s,i.scripts_update),Jr(s,i.scripts_lateUpdate),Jr(s,i.scripts_onBeforeRender),Jr(s,i.scripts_onAfterRender),Jr(s,i.scripts_pausedChanged),Jr(s,i.new_scripts_xr),Jr(s,i.scripts_immersive_vr),Jr(s,i.scripts_immersive_ar),i.stopAllCoroutinesFrom(s)}function Jr(s,i){const t=i.indexOf(s);t>=0&&i.splice(t,1)}function A_(s,i){var t;if(s){const n=s;if(n.onBeforeXR||n.onEnterXR||n.onUpdateXR||n.onLeaveXR||n.onXRControllerAdded||n.onXRControllerRemoved)return!(i!=null&&((t=n.supportsXR)==null?void 0:t.call(n,i))===!1)}return!1}function Cv(s){if(s||(s=xt.Current.scene),!s){console.trace("Invalid call - no current context.");return}const i=Tm(s);XD(s,i,!0)||(_x||be()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,s):console.error('Failed to update active state in hierarchy of "'+s.name+'"',s),console.warn(" â†‘ this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function XD(s,i,t,n=0){if(n>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const r=Tm(s);if(i&&(i=r,i&&s.parent)){const c=s.parent;i=c[$c],i===void 0&&(c instanceof ws||(i=!0))}const a=s[$c]!==i;s[$c]=i,a&&(w5&&console.warn("ACTIVE CHANGE",s.name,r,s.visible,i,"changed?"+a,s),t&&S5(s,c=>{i?c.enabled&&(hf(c.__internalAwake.bind(c)),c.enabled&&(c.__didEnable=!0,c.onEnable())):c.__didAwake&&c.enabled&&(c.__didEnable=!1,c.onDisable())}));let l=!0;if(s.children){const c=n+1;for(const u of s.children)XD(u,i,t,c)===!1&&(l=!1)}return l}function cg(s){let i=!0,t=s,n=!1;for(;t&&t;){if(t.type==="Scene"&&(n=!0),!Tm(t)){i=!1;break}t=t.parent}if(!s){console.error("GO is null");return}s[$c]=i&&n}function S5(s,i){var t;if((t=s.userData)!=null&&t.components)for(const n of s.userData.components)i(n)}const Sv=new Map,YD=Symbol("prewarmFlag"),wx=Symbol("waitingForPrewarm"),xx=Q("debugprewarm");function E5(s,i){if(!s||s[YD]===!0||s[wx]===!0)return;Sv.has(i)||Sv.set(i,[]),s[wx]=!0,Sv.get(i).push(s),xx&&console.debug("register prewarm",s.name)}let aT=null,lT=null;function I5(s){if(!s)return;const i=Sv.get(s);if(!(i!=null&&i.length))return;const t=s.mainCamera;if(t){xx&&console.log("prewarm",i.length,"objects",[...i]);const n=s.renderer;if(n.compile){const r=s.scene;n.compile(r,t),aT??(aT=new vF(64)),lT??(lT=new yF(.001,9999999,aT)),lT.update(n,r);for(const o of i)o[YD]=!0,o[wx]=!1;i.length=0,xx&&console.log("prewarm done")}}}const T5=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function R5(s){return typeof s=="string"&&T5.test(s)}const Gn=[];for(let s=0;s<256;++s)Gn.push((s+256).toString(16).slice(1));function B5(s,i=0){return Gn[s[i+0]]+Gn[s[i+1]]+Gn[s[i+2]]+Gn[s[i+3]]+"-"+Gn[s[i+4]]+Gn[s[i+5]]+"-"+Gn[s[i+6]]+Gn[s[i+7]]+"-"+Gn[s[i+8]]+Gn[s[i+9]]+"-"+Gn[s[i+10]]+Gn[s[i+11]]+Gn[s[i+12]]+Gn[s[i+13]]+Gn[s[i+14]]+Gn[s[i+15]]}function P5(s){if(!R5(s))throw TypeError("Invalid UUID");let i;const t=new Uint8Array(16);return t[0]=(i=parseInt(s.slice(0,8),16))>>>24,t[1]=i>>>16&255,t[2]=i>>>8&255,t[3]=i&255,t[4]=(i=parseInt(s.slice(9,13),16))>>>8,t[5]=i&255,t[6]=(i=parseInt(s.slice(14,18),16))>>>8,t[7]=i&255,t[8]=(i=parseInt(s.slice(19,23),16))>>>8,t[9]=i&255,t[10]=(i=parseInt(s.slice(24,36),16))/1099511627776&255,t[11]=i/4294967296&255,t[12]=i>>>24&255,t[13]=i>>>16&255,t[14]=i>>>8&255,t[15]=i&255,t}function M5(s){s=unescape(encodeURIComponent(s));const i=[];for(let t=0;t<s.length;++t)i.push(s.charCodeAt(t));return i}const k5="6ba7b810-9dad-11d1-80b4-00c04fd430c8",D5="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function O5(s,i,t){function n(r,o,a,l){var c;if(typeof r=="string"&&(r=M5(r)),typeof o=="string"&&(o=P5(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+r.length);if(u.set(o),u.set(r,o.length),u=t(u),u[6]=u[6]&15|i,u[8]=u[8]&63|128,a){l=l||0;for(let d=0;d<16;++d)a[l+d]=u[d];return a}return B5(u)}try{n.name=s}catch{}return n.DNS=k5,n.URL=D5,n}function L5(s,i,t,n){switch(s){case 0:return i&t^~i&n;case 1:return i^t^n;case 2:return i&t^i&n^t&n;case 3:return i^t^n}}function v_(s,i){return s<<i|s>>>32-i}function F5(s){const i=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const a=unescape(encodeURIComponent(s));s=[];for(let l=0;l<a.length;++l)s.push(a.charCodeAt(l))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const n=s.length/4+2,r=Math.ceil(n/16),o=new Array(r);for(let a=0;a<r;++a){const l=new Uint32Array(16);for(let c=0;c<16;++c)l[c]=s[a*64+c*4]<<24|s[a*64+c*4+1]<<16|s[a*64+c*4+2]<<8|s[a*64+c*4+3];o[a]=l}o[r-1][14]=(s.length-1)*8/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=(s.length-1)*8&4294967295;for(let a=0;a<r;++a){const l=new Uint32Array(80);for(let g=0;g<16;++g)l[g]=o[a][g];for(let g=16;g<80;++g)l[g]=v_(l[g-3]^l[g-8]^l[g-14]^l[g-16],1);let c=t[0],u=t[1],d=t[2],f=t[3],p=t[4];for(let g=0;g<80;++g){const m=Math.floor(g/20),A=v_(c,5)+L5(m,u,d,f)+p+i[m]+l[g]>>>0;p=f,f=d,d=v_(u,30)>>>0,u=c,c=A}t[0]=t[0]+c>>>0,t[1]=t[1]+u>>>0,t[2]=t[2]+d>>>0,t[3]=t[3]+f>>>0,t[4]=t[4]+p>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const U5=O5("v5",80,F5),cT=U5;xt.registerCallback(ut.ContextCreated,s=>{const i=s.context;j5(i),z5(i)});const oy=Q("debugcomponents"),hT="eff8ba80-635d-11ec-90d6-0242ac120003";class En{constructor(i){h(this,"_originalSeed");h(this,"_seed");typeof i=="string"&&(i=En.hash(i)),this._originalSeed=i,this._seed=i}get seed(){return this._seed}set seed(i){this._seed=i}reset(){this._seed=this._originalSeed}generateUUID(i){if(typeof i=="string")return cT(i,hT);const t=this._seed;return this._seed-=1,cT(t.toString(),hT)}initialize(i){typeof i=="string"?this._seed=En.hash(i):this._seed=i}static createFromString(i){return new En(this.hash(i))}static hash(i){let t=0;for(let n=0;n<i.length;n++)t=i.charCodeAt(n)+((t<<5)-t);return t}}var Pf;(function(s){s.NewInstanceCreated="new-instance-created",s.InstanceDestroyed="instance-destroyed"})(Pf||(Pf={}));class N5{constructor(i){h(this,"guid");h(this,"dontSave");this.guid=i}}function C0(s,i,t=!0,n){if(!s)return;const r=s;if(xo(s,t),!i){console.warn("Can not send destroy: No networking connection provided",s.guid);return}if(!i.isConnected){console.warn("Can not send destroy: not connected",s.guid);return}let o=s.guid;if(!o&&r.uuid&&(o=r.uuid),!o){console.warn("Can not send destroy: failed to find guid",s);return}KD(o,i,n)}function KD(s,i,t){const n=new N5(s);(t==null?void 0:t.saveInRoom)===!1&&(n.dontSave=!0),i.send(Pf.InstanceDestroyed,n,Vo.Queued)}function z5(s){s.connection.beginListen(Pf.InstanceDestroyed,i=>{oy&&console.log("[Remote] Destroyed",s.scene,i);const t=T0(i.guid,s.scene);t&&xo(t)})}class zK{constructor(i,t,n){h(this,"filename");h(this,"hash");h(this,"size");this.filename=i,this.hash=t,this.size=n}}class Q5{constructor(i,t){h(this,"guid");h(this,"originalGuid");h(this,"seed");h(this,"visible");h(this,"hostData");h(this,"dontSave");h(this,"parent");h(this,"position");h(this,"rotation");h(this,"scale");h(this,"preventCreation");h(this,"deleteStateOnDisconnect");this.originalGuid=i,this.guid=t}}function JD(s,i,t,n){var c;const r=s;if(!r.guid)return console.warn("Can not instantiate: No guid",r),null;if(i.context||(i.context=Ge.Current),!i.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const o=i?{...i}:null,{instance:a,seed:l}=G5(r,i);if(a){const u=a;if(u.guid){oy&&console.log("[Local] new instance","gameobject:",a==null?void 0:a.guid);const d=new Q5(r.guid,u.guid);d.seed=l,i.deleteOnDisconnect===!0&&(d.deleteStateOnDisconnect=!0),o&&(o.position&&(d.position={x:o.position.x,y:o.position.y,z:o.position.z}),o.rotation&&(d.rotation={x:o.rotation.x,y:o.rotation.y,z:o.rotation.z,w:o.rotation.w}),o.scale&&(d.scale={x:o.scale.x,y:o.scale.y,z:o.scale.z})),d.position||(d.position={x:u.position.x,y:u.position.y,z:u.position.z}),d.rotation||(d.rotation={x:u.quaternion.x,y:u.quaternion.y,z:u.quaternion.z,w:u.quaternion.w}),d.scale||(d.scale={x:u.scale.x,y:u.scale.y,z:u.scale.z}),d.visible=r.visible,o!=null&&o.parent&&(typeof o.parent=="string"?d.parent=o.parent:d.parent=o.parent.guid),d.hostData=t,n===!1&&(d.dontSave=!0),(c=i==null?void 0:i.context)==null||c.connection.send(Pf.NewInstanceCreated,d)}else console.warn("Missing guid, can not send new instance event",u)}return a}function kS(){return Math.random()*9999999}function j5(s){s.connection.beginListen(Pf.NewInstanceCreated,async i=>{const t=await V5(i.originalGuid,s.scene);if(i.preventCreation===!0)return;if(!t){console.warn("could not find object that was instantiated: "+i.guid);return}const n=new ll;i.position&&(n.position=new x(i.position.x,i.position.y,i.position.z)),i.rotation&&(n.rotation=new se(i.rotation.x,i.rotation.y,i.rotation.z,i.rotation.w)),i.scale&&(n.scale=new x(i.scale.x,i.scale.y,i.scale.z)),n.parent=i.parent,i.seed&&(n.idProvider=new En(i.seed)),n.visible=i.visible,n.context=s,oy&&s.alias&&console.log("[Remote] instantiate in: "+s.alias);const r=Rm(t,n);r&&(i.parent==="scene"&&s.scene.add(r),oy&&console.log("[Remote] new instance","gameobject:",r==null?void 0:r.guid,t))})}function G5(s,i){const t=kS(),n=i??new ll;n.idProvider=new En(t);const r=Rm(s,n);return{seed:t,instance:r}}const ZD={};function H5(s,i){ZD[s]=i}async function V5(s,i){const t=ZD[s];if(t!=null){const n=await t(s);if(n)return n}return $D(s,i)}function $D(s,i){if(i===null||!s)return null;if(i.guid===s)return i;if(i.children)for(const t of i.children){const n=$D(s,t);if(n)return n}return null}const Em=Q("gizmos"),bn=Q("debugextension"),y_=Q("debugtypes");class W5{constructor(){h(this,"_types",{});y_&&console.warn("TypeStore: Created",this)}add(i,t){y_&&console.warn("ADD TYPE",i);const n=this._types[i];n===void 0?this._types[i]=t:y_&&n!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",i)}get(i){return this._types[i]}}const q5=Symbol("BuiltInType"),O=new W5,QK=function(s){O.get(s.name)||O.add(s.name,s)},DS=Q("debugresolvedependencies"),X5=["/extensions/","extensions/"],Y5=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function OS(s,i){DS&&console.log(s,i);const t=[];Cx(Y5,s,i,t);const n=await Promise.all(t);return typeof i=="string"&&n.length===1?n[0]:n}function K5(s,i){return!s||!i?!1:s["needle:identifier"]!=null&&i["needle:identifier"]!=null?s["needle:identifier"]===i["needle:identifier"]:!1}function J5(s,i){s["needle:identifier"]=i}function Cx(s,i,t,n){if(typeof t=="object"&&t!==void 0&&t!==null)for(const r of Object.keys(t)){const o=t[r];if(typeof o=="string"){const a=uT(i,o);if(a!=null)typeof a.then=="function"?n.push(a.then(l=>t[r]=l)):t[r]=a;else{const l=dT(s,i,o);if(l){n.push(l.then(c=>(t[r]=c,c)));continue}}}else if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=o[a],c=uT(i,l);if(c!==null){typeof c.then=="function"?n.push(c.then(u=>o[a]=u)):o[a]=c;continue}for(const u of s){const d=eO(u.prefix,l);if(d>=0){DS&&console.log(u,d,u.dependencyName),n.push(i.getDependency(u.dependencyName,d).then(f=>o[a]=f));break}}typeof l=="object"&&Cx(s,i,l,n)}else typeof o=="object"&&Cx(s,i,o,n)}else if(typeof t=="string"){const r=dT(s,i,t);r&&n.push(r)}}function uT(s,i){if(s&&s.plugins&&typeof i=="string"){for(const t of X5)if(i.startsWith(t)){let n=i.substring(t.length);const r=n.indexOf("/");r>=0&&(n=n.substring(0,r));const o=s.plugins[n];if(bn&&console.log(n,o),typeof(o==null?void 0:o.resolve)=="function"){const a=i.substring(t.length+n.length+1);return o.resolve(s,a)}break}}return null}function dT(s,i,t){for(const n of s){const r=eO(n.prefix,t);if(r>=0)return DS&&console.warn("GET DEPENDENCY",n,r,n.dependencyName),i.getDependency(n.dependencyName,r)}return null}function eO(s,i){if(typeof i=="string"&&i.startsWith(s)){const t=i.substring(s.length),n=Number.parseInt(t);if(n>=0)return n}return-1}const b_="NEEDLE_persistent_assets";function Z5(s){return(s==null?void 0:s.___persistentAsset)===!0}class $5{constructor(i){h(this,"parser");this.parser=i}get name(){return b_}async afterRoot(i){var r,o;if(!((o=(r=this.parser)==null?void 0:r.json)!=null&&o.extensions))return;const t=this.parser.json.extensions[b_];if(!t)return;bn&&console.log(t);const n=new Array;for(const a of t==null?void 0:t.assets){const l=OS(this.parser,a);l&&n.push(l)}await Promise.all(n)}resolve(i,t){const n=Number.parseInt(t);if(n>=0){bn&&console.log(t);const r=i.json.extensions[b_];if(r){const o=r==null?void 0:r.assets[n];if(o&&typeof o=="object"){o.___persistentAsset=!0;const a=o.__type;a&&O.get(a)}return o}}return null}}const Ba=Q("debugserializer");class e6{constructor(){h(this,"typeMap",new Map)}register(i,t){if(this.typeMap.has(i)){const n=this.typeMap.get(i);if(n===t)return;Ba&&console.warn("Type: "+i+" is already registered",t,n)}Ba&&console.log("Register type serializer",t.name,t,i),this.typeMap.set(i,t)}getSerializer(i){if(i)return this.typeMap.get(i)}getSerializerForConstructor(i,t=0){if(t>20)return;if(!i||!i.constructor){Ba&&console.log("invalid type");return}const n=i.name,r=this.getSerializer(i);if(r!==void 0)return Ba&&console.log("FOUND SERIALIZER",r==null?void 0:r.name,i.name,i.constructor.name,"for type: "+n,r,i,this.typeMap),r;const o=Object.getPrototypeOf(i);if(o&&o!==i){const a=this.getSerializerForConstructor(o,++t);if(a){const l=o.constructor||o.prototype;Ba&&console.log("FOUND SERIALIZER(in constructor) "+l.constructor.name,l.name,l,a),this.register(l,a)}return a}Ba&&console.warn("No serializer found for "+n,i,i.name,i.constructor.name)}}const ay=new e6;class Eo{constructor(i,t){h(this,"name");if(this.name=t,Array.isArray(i))for(const n of i)ay.register(n,this);else ay.register(i,this)}}class t6{constructor(){h(this,"isDevMode",fr());h(this,"cache",{})}registerDefinedKeys(i,t){if(this.isDevMode&&this.cache[i]===void 0){this.cache[i]=Object.keys(t);const n=t;n.$serializedTypes&&Object.keys(n.$serializedTypes)&&this.cache[i].push(...Object.keys(n.$serializedTypes)),Ba&&console.log("registerDefinedKeys for "+i,this.cache[i],t)}}getDefinedKey(i,t){return this.cache[i]===void 0?!1:this.cache[i].includes(t)}}class tO{constructor(i){h(this,"root");h(this,"gltf");h(this,"gltfId");h(this,"object");h(this,"target");h(this,"nodeId");h(this,"nodeToObject");h(this,"objectToNode");h(this,"context");h(this,"path");h(this,"type");h(this,"serializable");h(this,"implementationInformation");this.root=i}}function i6(s,i){const t=s.$serializedTypes;if(t===void 0)return null;const n={};for(const r in t){const o=s[r];if(o!=null&&typeof o=="object"){const a=ay.getSerializerForConstructor(o);if(a){n[r]=a.onSerialize(o,i);continue}}n[r]=o}return n.name=s.constructor.name,typeof s.guid=="string"&&(n.guid=s.guid),n}const Ev=[];function iO(s,i){if(!s)return i;typeof s.$serializedTypes=="object"&&(i||(i={}),Object.assign(i,s.$serializedTypes));const t=Object.getPrototypeOf(s);return iO(t,i)}function Sx(s,i,t){if(!s)return!1;if(t.target=s,s.onBeforeDeserialize!==void 0){const r=s.onBeforeDeserialize(i,t);if(typeof r=="boolean")return r}const n=iO(s);if(i){if(typeof i.guid=="string"&&(s.guid=i.guid),n)for(const r in n){let l=function(c){const d=c.type;return d?Ex(a,d,t,void 0,s[r]):Ex(a,c,t,void 0,s[r])};const o=n[r],a=i[r];if(Ba&&console.log(r,a,s,o),!(s[r]!==void 0&&a===void 0)&&(t.type=void 0,t.path=r,t.serializable=o,!(s.onBeforeDeserializeMember!==void 0&&s.onBeforeDeserializeMember(r,a,t)===!0))){if(o===null)s[r]=a;else{if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c],d=l(u);if(d!==void 0||c===o.length-1){s[r]=d;break}}else s[r]=l(o);Ev.length=0}s.onAfterDeserializeMember!==void 0&&s.onAfterDeserializeMember(r,a,t)}}r6(s,i)}return s6(s,i,t.implementationInformation),s.onAfterDeserialize!==void 0&&s.onAfterDeserialize(i,t),!0}const n6=Q("noerrors");function s6(s,i,t){var o,a;if(n6||!i||!fr()||!s||s.constructor&&s.constructor[q5]===!0)return;const n=(o=s.constructor)==null?void 0:o.name,r=Object.getOwnPropertyNames(i);for(const l of r){if(l==="sourceId")continue;const c=s[l];if(c==null)continue;const u=i[l];if((t==null?void 0:t.getDefinedKey(n,l))===!1){const d=l.charAt(0).toUpperCase()+l.slice(1);t.getDefinedKey(n,d)&&(Qa(Yi.Warn,'<strong>Please rename</strong> "'+d+'" to "'+l+'" in '+n),console.warn('Please use lowercase for field: "'+d+'" in '+n,u,s));continue}if(u!=null){if(typeof u=="object"&&(c===void 0||!c.isObject3D)){if(typeof u.node=="number"||typeof u.guid=="string"){if(u.could_not_resolve)continue;if(!(c!==void 0&&Object.keys(c).length>1)){Qa(Yi.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${l}? : Object3D;

in script ${n}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(n,l,s[l],s);continue}}else if(!Array.isArray(c)){const d=(a=c.constructor)==null?void 0:a.name;if(d==="Object"&&!c.constructor["did_warn:missing_serializable"]){c.constructor["did_warn:missing_serializable"]=!0;const f='You might be missing a @serializable(Type) decorator for field "'+l+'" in '+n+".ts";console.warn(f+`
${l}:`,u,d),Qa(Yi.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof c=="string"&&(u.endsWith(".gltf")||u.endsWith(".glb"))){Qa(Yi.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${l}? : AssetReference;

in script ${n}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(n,l,s[l],s);continue}}}}function r6(s,i){for(const t of Object.keys(i)){const n=i[t];if(typeof n=="object"&&n!==null&&n!==void 0){const r=s[t];if(!r){Ba&&console.log(t,"is undefined on",s);continue}for(const o of Object.keys(n))if(r[o]===void 0&&fT(n[o])&&!fT(r)){const l=o6(r,o);if(l&&((l==null?void 0:l.writable)===void 0||(l==null?void 0:l.writable)===!1)&&l.set===void 0){Ba&&console.warn('Property is not writable "'+o+'"',r,l,n[o],r[o]);continue}r[o]=n[o]}}}}function o6(s,i){for(;s;){const t=Object.getOwnPropertyDescriptor(s,i);if(t)return t;s=Object.getPrototypeOf(s)}}function fT(s){switch(typeof s){case"number":case"string":case"boolean":return!0}return!1}function Ex(s,i,t,n,r){let o=typeof i=="function"&&i.prototype===void 0,a=i;if(o)try{if(a=i==null?void 0:i.call(i,r),o=!1,a==null)return}catch(d){console.error("Error in callback",d,s)}if(t.type=a,!o&&r instanceof a)return r;if(n||(n={serializer:ay.getSerializerForConstructor(a)}),r&&typeof r=="object"&&Z5(r)){if(r.__concreteInstance)return r.__concreteInstance;const d=r;if(!d.$serializedTypes&&a.prototype.$serializedTypes&&(d.$serializedTypes=a.prototype.$serializedTypes),d.$serializedTypes&&Sx(d,s,t),r&&a!==void 0)try{let f=null;n.serializer&&(f=n.serializer.onDeserialize(s,t)),f||(f=new a,bn&&console.log("Create concrete instance for persistent asset",r,"instance:",f),Mf(f,r)),r.__concreteInstance=f,r=f}catch(f){console.error("Error creating instance or creating values on instance",f,r,a)}return r}if(Array.isArray(s)){const d=[];for(let f=0;f<s.length;f++){const p=s[f],g=Ex(p,i,t,n,p);d.push(g)}return d}const l=n==null?void 0:n.serializer;if(l)return l.onDeserialize(s,t);let c;if(s&&(s.isMaterial||s.isTexture||s.isObject3D||s instanceof ql))c=s;else{if(s===void 0)return;if(s===null&&(a===mt||a===At||a===Z||a===ql))return null;try{c=new a(...a6(s))}catch(d){console.error("Error creating "+t.path,t.target,d);return}}const u=c;return u.$serializedTypes&&Sx(u,s,t),c}function a6(s){if(Ev.length=0,typeof s=="object"&&s!==null&&s!==void 0)for(const i of Object.keys(s))Ev.push(s[i]);return Ev}const Ix=Symbol("assigned component properties");function Mf(s,i,t){var r;if(i==null||s==null)return;s[Ix]=!0;const n=((r=s.constructor)==null?void 0:r.name)??"unknown";t==null||t.registerDefinedKeys(n,s);for(const o of Object.keys(i)){const a=l6(s,o);typeof(a==null?void 0:a.value)!="function"&&(!a||a.writable===!0||(a==null?void 0:a.set)!==void 0)&&(s[o]=i[o])}delete s[Ix]}function l6(s,i){let t;do t=Object.getOwnPropertyDescriptor(s,i);while(!t&&(s=Object.getPrototypeOf(s)));return t}const nO=Symbol("customVisibilityFlag");function Gc(s,i){s.layers[nO]=i}const pT=Symbol("DidPatchLayers");function c6(){const s=mo.prototype;if(s[pT])return;s[pT]=!0;const i=s.test;s.test=function(t){return this[nO]===!1?!1:i.call(this,t)}}c6();Object.defineProperty(bt.prototype,"fov",{get:function(){return this._fov},set:function(s){const i=s!==this._fov;this._fov=s,i&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(bt.prototype,"near",{get:function(){return this._near},set:function(s){const i=s!==this._near;this._near=s,i&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(bt.prototype,"far",{get:function(){return this._far},set:function(s){const i=s!==this._far;this._far=s,i&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const sO=new Map;function h6(s,i){if(!s)return;if(!i){console.warn("No prototype found",s,s.prototype,s.constructor);return}const t=sO.get(i);t&&t.apply(s)}function u6(s){const i=d6(s.prototype);sO.set(s,i)}function d6(s){return new f6(s)}class f6{constructor(i){h(this,"$symbol");h(this,"extensions");h(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(i),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const n=this.extensions[t],r=Object.getOwnPropertyDescriptor(i,n);r&&this.descriptors.push(r)}}apply(i){if(!i[this.$symbol]){i[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const n=this.extensions[t],r=this.descriptors[t];r&&Object.defineProperty(i,n,r)}}}}const Lh=new Du,fs=new x,Cc=new x,pi=new se,gT={X:new x(1,0,0),Y:new x(0,1,0),Z:new x(0,0,1)},__={type:"change"},mT={type:"mouseDown"},AT={type:"mouseUp",mode:null},vT={type:"objectChange"};class p6 extends ne{constructor(i,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new LS;this._gizmo=n,this.add(n);const r=new b6;this._plane=r,this.add(r);const o=this;function a(_,w){let S=w;Object.defineProperty(o,_,{get:function(){return S!==void 0?S:w},set:function(E){S!==E&&(S=E,r[_]=E,n[_]=E,o.dispatchEvent({type:_+"-changed",value:E}),o.dispatchEvent(__))}}),o[_]=w,r[_]=w,n[_]=w}a("camera",i),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new x,c=new x,u=new se,d=new se,f=new x,p=new se,g=new x,m=new x,A=new x,y=0,b=new x;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",u),a("worldQuaternionStart",d),a("cameraPosition",f),a("cameraQuaternion",p),a("pointStart",g),a("pointEnd",m),a("rotationAxis",A),a("rotationAngle",y),a("eye",b),this._offset=new x,this._startNorm=new x,this._endNorm=new x,this._cameraScale=new x,this._parentPosition=new x,this._parentQuaternion=new se,this._parentQuaternionInv=new se,this._parentScale=new x,this._worldScaleStart=new x,this._worldQuaternionInv=new se,this._worldScale=new x,this._positionStart=new x,this._quaternionStart=new se,this._scaleStart=new x,this._getPointer=g6.bind(this),this._onPointerDown=A6.bind(this),this._onPointerHover=m6.bind(this),this._onPointerMove=v6.bind(this),this._onPointerUp=y6.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(i){if(this.object===void 0||this.dragging===!0)return;i!==null&&Lh.setFromCamera(i,this.camera);const t=w_(this._gizmo.picker[this.mode],Lh);t?this.axis=t.object.name:this.axis=null}pointerDown(i){if(!(this.object===void 0||this.dragging===!0||i!=null&&i.button!==0)&&this.axis!==null){i!==null&&Lh.setFromCamera(i,this.camera);const t=w_(this._plane,Lh,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,mT.mode=this.mode,this.dispatchEvent(mT)}}pointerMove(i){const t=this.axis,n=this.mode,r=this.object;let o=this.space;if(n==="scale"?o="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(o="world"),r===void 0||t===null||this.dragging===!1||i!==null&&i.button!==-1)return;i!==null&&Lh.setFromCamera(i,this.camera);const a=w_(this._plane,Lh,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(r.position.applyQuaternion(pi.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),o==="world"&&(r.parent&&r.position.add(fs.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(fs.setFromMatrixPosition(r.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Cc.set(l,l,l)}else fs.copy(this.pointStart),Cc.copy(this.pointEnd),fs.applyQuaternion(this._worldQuaternionInv),Cc.applyQuaternion(this._worldQuaternionInv),Cc.divide(fs),t.search("X")===-1&&(Cc.x=1),t.search("Y")===-1&&(Cc.y=1),t.search("Z")===-1&&(Cc.z=1);r.scale.copy(this._scaleStart).multiply(Cc),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(fs.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(fs.copy(this.rotationAxis).cross(this.eye))*l):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(gT[t]),fs.copy(gT[t]),o==="local"&&fs.applyQuaternion(this.worldQuaternion),fs.cross(this.eye),fs.length()===0?c=!0:this.rotationAngle=this._offset.dot(fs.normalize())*l),(t==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(pi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(pi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(__),this.dispatchEvent(vT)}}pointerUp(i){i!==null&&i.button!==0||(this.dragging&&this.axis!==null&&(AT.mode=this.mode,this.dispatchEvent(AT)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(i){i.geometry&&i.geometry.dispose(),i.material&&i.material.dispose()})}attach(i){return this.object=i,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(__),this.dispatchEvent(vT),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Lh}getMode(){return this.mode}setMode(i){this.mode=i}setTranslationSnap(i){this.translationSnap=i}setRotationSnap(i){this.rotationSnap=i}setScaleSnap(i){this.scaleSnap=i}setSize(i){this.size=i}setSpace(i){this.space=i}}function g6(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const i=this.domElement.getBoundingClientRect();return{x:(s.clientX-i.left)/i.width*2-1,y:-(s.clientY-i.top)/i.height*2+1,button:s.button}}}function m6(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function A6(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function v6(s){this.enabled&&this.pointerMove(this._getPointer(s))}function y6(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function w_(s,i,t){const n=i.intersectObject(s,!0);for(let r=0;r<n.length;r++)if(n[r].object.visible||t)return n[r];return!1}const EA=new Gt,Wt=new x(0,1,0),yT=new x(0,0,0),bT=new le,IA=new se,Iv=new se,da=new x,_T=new le,Hp=new x(1,0,0),Vh=new x(0,1,0),Vp=new x(0,0,1),TA=new x,Ap=new x,vp=new x;class LS extends ne{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const i=new _t({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Zo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=i.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const o=i.clone();o.color.setHex(16711680);const a=i.clone();a.color.setHex(65280);const l=i.clone();l.color.setHex(255);const c=i.clone();c.color.setHex(16711680),c.opacity=.5;const u=i.clone();u.color.setHex(65280),u.opacity=.5;const d=i.clone();d.color.setHex(255),d.opacity=.5;const f=i.clone();f.opacity=.25;const p=i.clone();p.color.setHex(16776960),p.opacity=.25,i.clone().color.setHex(16776960);const m=i.clone();m.color.setHex(7895160);const A=new Ns(0,.04,.1,12);A.translate(0,.05,0);const y=new on(.08,.08,.08);y.translate(0,.04,0);const b=new Vt;b.setAttribute("position",new ln([0,0,0,1,0,0],3));const _=new Ns(.0075,.0075,.5,3);_.translate(0,.25,0);function w(Y,D){const L=new lp(Y,.0075,3,64,D*Math.PI*2);return L.rotateY(Math.PI/2),L.rotateX(Math.PI/2),L}function S(){const Y=new Vt;return Y.setAttribute("position",new ln([0,0,0,1,1,1],3)),Y}const E={X:[[new Z(A,o),[.5,0,0],[0,0,-Math.PI/2]],[new Z(A,o),[-.5,0,0],[0,0,Math.PI/2]],[new Z(_,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Z(A,a),[0,.5,0]],[new Z(A,a),[0,-.5,0],[Math.PI,0,0]],[new Z(_,a)]],Z:[[new Z(A,l),[0,0,.5],[Math.PI/2,0,0]],[new Z(A,l),[0,0,-.5],[-Math.PI/2,0,0]],[new Z(_,l),null,[Math.PI/2,0,0]]],XYZ:[[new Z(new sA(.1,0),f.clone()),[0,0,0]]],XY:[[new Z(new on(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new Z(new on(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Z(new on(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},I={X:[[new Z(new Ns(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Z(new Ns(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Z(new Ns(.2,0,.6,4),n),[0,.3,0]],[new Z(new Ns(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Z(new Ns(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Z(new Ns(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Z(new sA(.2,0),n)]],XY:[[new Z(new on(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Z(new on(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Z(new on(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new Z(new sA(.01,2),r),null,null,null,"helper"]],END:[[new Z(new sA(.01,2),r),null,null,null,"helper"]],DELTA:[[new ms(S(),r),null,null,null,"helper"]],X:[[new ms(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ms(b,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ms(b,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T={XYZE:[[new Z(w(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new Z(w(.5,.5),o)]],Y:[[new Z(w(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new Z(w(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new Z(w(.75,1),p),null,[0,Math.PI/2,0]]]},P={AXIS:[[new ms(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},B={XYZE:[[new Z(new Pu(.25,10,8),n)]],X:[[new Z(new lp(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Z(new lp(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Z(new lp(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Z(new lp(.75,.1,2,24),n)]]},M={X:[[new Z(y,o),[.5,0,0],[0,0,-Math.PI/2]],[new Z(_,o),[0,0,0],[0,0,-Math.PI/2]],[new Z(y,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Z(y,a),[0,.5,0]],[new Z(_,a)],[new Z(y,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Z(y,l),[0,0,.5],[Math.PI/2,0,0]],[new Z(_,l),[0,0,0],[Math.PI/2,0,0]],[new Z(y,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Z(new on(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new Z(new on(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Z(new on(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Z(new on(.1,.1,.1),f.clone())]]},U={X:[[new Z(new Ns(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Z(new Ns(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Z(new Ns(.2,0,.6,4),n),[0,.3,0]],[new Z(new Ns(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Z(new Ns(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Z(new Ns(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Z(new on(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Z(new on(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Z(new on(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Z(new on(.2,.2,.2),n),[0,0,0]]]},G={X:[[new ms(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ms(b,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ms(b,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function W(Y){const D=new ne;for(const L in Y)for(let V=Y[L].length;V--;){const te=Y[L][V][0].clone(),K=Y[L][V][1],ue=Y[L][V][2],de=Y[L][V][3],_e=Y[L][V][4];te.name=L,te.tag=_e,K&&te.position.set(K[0],K[1],K[2]),ue&&te.rotation.set(ue[0],ue[1],ue[2]),de&&te.scale.set(de[0],de[1],de[2]),te.updateMatrix();const Ee=te.geometry.clone();Ee.applyMatrix4(te.matrix),te.geometry=Ee,te.renderOrder=1/0,te.position.set(0,0,0),te.rotation.set(0,0,0),te.scale.set(1,1,1),D.add(te)}return D}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=W(E)),this.add(this.gizmo.rotate=W(T)),this.add(this.gizmo.scale=W(M)),this.add(this.picker.translate=W(I)),this.add(this.picker.rotate=W(B)),this.add(this.picker.scale=W(U)),this.add(this.helper.translate=W(k)),this.add(this.helper.rotate=W(P)),this.add(this.helper.scale=W(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(i){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Iv;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let o=0;o<r.length;o++){const a=r[o];a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(l*this.size/4),a.tag==="helper"){a.visible=!1,a.name==="AXIS"?(a.visible=!!this.axis,this.axis==="X"&&(pi.setFromEuler(EA.set(0,0,0)),a.quaternion.copy(n).multiply(pi),Math.abs(Wt.copy(Hp).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(pi.setFromEuler(EA.set(0,0,Math.PI/2)),a.quaternion.copy(n).multiply(pi),Math.abs(Wt.copy(Vh).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(pi.setFromEuler(EA.set(0,Math.PI/2,0)),a.quaternion.copy(n).multiply(pi),Math.abs(Wt.copy(Vp).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(pi.setFromEuler(EA.set(0,Math.PI/2,0)),Wt.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(bT.lookAt(yT,Wt,Vh)),a.quaternion.multiply(pi),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),fs.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),fs.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(fs),a.visible=this.dragging):(a.quaternion.copy(n),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1));continue}a.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(Wt.copy(Hp).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(Wt.copy(Vh).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(Wt.copy(Vp).applyQuaternion(n).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(Wt.copy(Vp).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(Wt.copy(Hp).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(Wt.copy(Vh).applyQuaternion(n).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(IA.copy(n),Wt.copy(this.eye).applyQuaternion(pi.copy(n).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(bT.lookAt(this.eye,yT,Vh)),a.name==="X"&&(pi.setFromAxisAngle(Hp,Math.atan2(-Wt.y,Wt.z)),pi.multiplyQuaternions(IA,pi),a.quaternion.copy(pi)),a.name==="Y"&&(pi.setFromAxisAngle(Vh,Math.atan2(Wt.x,Wt.z)),pi.multiplyQuaternions(IA,pi),a.quaternion.copy(pi)),a.name==="Z"&&(pi.setFromAxisAngle(Vp,Math.atan2(Wt.y,Wt.x)),pi.multiplyQuaternions(IA,pi),a.quaternion.copy(pi))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(c){return a.name===c}))&&(a.material.color.setHex(16776960),a.material.opacity=1)}super.updateMatrixWorld(i)}}class b6 extends Z{constructor(){super(new pr(1e5,1e5,2,2),new _t({visible:!1,wireframe:!0,side:_i,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(i){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),TA.copy(Hp).applyQuaternion(t==="local"?this.worldQuaternion:Iv),Ap.copy(Vh).applyQuaternion(t==="local"?this.worldQuaternion:Iv),vp.copy(Vp).applyQuaternion(t==="local"?this.worldQuaternion:Iv),Wt.copy(Ap),this.mode){case"translate":case"scale":switch(this.axis){case"X":Wt.copy(this.eye).cross(TA),da.copy(TA).cross(Wt);break;case"Y":Wt.copy(this.eye).cross(Ap),da.copy(Ap).cross(Wt);break;case"Z":Wt.copy(this.eye).cross(vp),da.copy(vp).cross(Wt);break;case"XY":da.copy(vp);break;case"YZ":da.copy(TA);break;case"XZ":Wt.copy(vp),da.copy(Ap);break;case"XYZ":case"E":da.set(0,0,0);break}break;case"rotate":default:da.set(0,0,0)}da.length()===0?this.quaternion.copy(this.cameraQuaternion):(_T.lookAt(fs.set(0,0,0),da,Wt),this.quaternion.setFromRotationMatrix(_T)),super.updateMatrixWorld(i)}}const _6=Q("debuggetcomponent"),wT=()=>_6||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function w6(s){return s==null||s.isObject3D?s:s.object&&s.object.isObject3D?s.object:s}function rO(s,i){if(!s||!s.userData.components)return i;const t=s.userData.components.indexOf(i);return t<0||(x0.dispatchComponentLifecycleEvent(em.Removing,i),i.gameObject=null,s.userData.components.splice(t,1)),i}function S0(s,i,t){const n=Qf(s,i);return n||vo(s,i,t)}const oO=new En("addComponentIdProvider");function uf(s,i,t=!0){s.userData||(s.userData={}),s.userData.components||(s.userData.components=[]),s.userData.components.push(i),i.gameObject=s,(i.guid===void 0||i.guid==="invalid")&&(i.guid=oO.generateUUID()),NS(s),WS(i,i.context);try{t&&i.__internalAwake&&(cg(s),i.activeAndEnabled&&i.__internalAwake()),x0.dispatchComponentLifecycleEvent(em.Added,i)}catch(n){console.error(n)}return i}function vo(s,i,t,n){if(typeof i=="function"){const r=new i;t&&r.__internalNewInstanceCreated(t);let o=!0;return(n==null?void 0:n.callAwake)!=null&&(o=n.callAwake),uf(s,r,o)}if(i.destroyed)return console.warn("Can not move/add a destroyed component",i),i;if(i.gameObject===s)return i;if(i.gameObject&&i.gameObject.userData.components){const r=i.gameObject.userData.components.indexOf(i);i.gameObject.userData.components.splice(r,1)}if(!s.userData.components)s.userData.components=[];else if(s.userData.components.includes(i))return i;return s.userData.components.push(i),i.gameObject=s,(i.guid===void 0||i.guid==="invalid")&&(i.guid=oO.generateUUID()),t&&i._internalInit(t),WS(i,i.context),i}function x6(s){if(s.gameObject&&s.gameObject.userData.components){const i=s.gameObject.userData.components.indexOf(s);s.gameObject.userData.components.splice(i,1)}s.__internalDisable&&s.__internalDisable(),Ul(s,s.context??Ge.Current),s.destroy(),s.gameObject=null}let xT=!1;function aO(s,i,t){var n;if(s==null)return null;if(!s.isObject3D)return console.error("Object is not object3D"),null;if(!((n=s==null?void 0:s.userData)!=null&&n.components)||(typeof i=="string"&&(xT||(xT=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,i))),wT()&&console.log("[onGetComponent] FIND",i),i==null))return null;for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r];let a=Object.getPrototypeOf(o);for(;a;){if(a===i.prototype)if(wT()&&console.log("[onGetComponent] MATCH BY PROTOYPE",a),t)t.push(o);else return o;a=Object.getPrototypeOf(a)}}return t||null}function Qf(s,i){const t=aO(s,i);return t?Array.isArray(t)?t[0]:t:null}function E0(s,i,t,n=!0){return t||(t=[]),n&&(t.length=0),aO(s,i,t),t}function I0(s,i,t){var r;const n=Qf(s,i);if(t===!1&&(n==null?void 0:n.enabled)===!1)return null;if(n)return n;for(let o=0;o<((r=s==null?void 0:s.children)==null?void 0:r.length);o++){const a=I0(s.children[o],i);if(a)return a}return null}function Im(s,i,t,n=!0){var r;t||(t=[]),n&&(t.length=0),E0(s,i,t,!1);for(let o=0;o<((r=s==null?void 0:s.children)==null?void 0:r.length);o++)Im(s.children[o],i,t,!1);return t}function ly(s,i){if(!s)return null;if(Array.isArray(s)){for(let n=0;n<s.length;n++){const r=w6(s[n]),o=ly(r,i);if(o)return o}return null}const t=Qf(s,i);return t||(s.parent?ly(s.parent,i):null)}function FS(s,i,t,n=!0){return t||(t=[]),n&&(t.length=0),s?(E0(s,i,t,!1),s.parent?FS(s.parent,i,t,!1):t):t}function US(s,i=void 0,t=!0){if(!s)return null;if(!i&&(i=Ge.Current,!i))return console.error("Can not search object without any needle context or scene!!!"),null;let n=i;if(n.isScene||(n=i==null?void 0:i.scene),!n)return null;for(const r in n.children){const o=n.children[r];if(t===!1&&o[$c]===!1)continue;const a=I0(o,s);if(a)return a}return null}function C6(s,i,t=void 0){if(!s)return i;if(i||(i=[]),i.length=0,!t&&(t=Ge.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),i;"scene"in t&&(t=t.scene);const n=t;if(!n)return i;for(const r in n.children){const o=n.children[r];Im(o,s,i,!1)}return i}function NS(s){s&&s.isObject3D===!0&&h6(s,ne)}ne.prototype.SetActive=function(s){this.visible=s};ne.prototype.setActive=function(s){this.visible=s};ne.prototype.destroy=function(){xo(this)};ne.prototype.addComponent=function(s,i){return vo(this,s,i)};ne.prototype.addNewComponent=function(s,i){return vo(this,s,i)};ne.prototype.removeComponent=function(s){return rO(this,s)};ne.prototype.getOrAddComponent=function(s,i){return S0(this,s,i)};ne.prototype.getComponent=function(s){return Qf(this,s)};ne.prototype.getComponents=function(s,i){return E0(this,s,i)};ne.prototype.getComponentInChildren=function(s){return I0(this,s)};ne.prototype.getComponentsInChildren=function(s,i){return Im(this,s,i)};ne.prototype.getComponentInParent=function(s){return ly(this,s)};ne.prototype.getComponentsInParent=function(s,i){return FS(this,s,i)};Object.getOwnPropertyDescriptor(ne.prototype,"activeSelf")||Object.defineProperty(ne.prototype,"activeSelf",{get:function(){return Tm(this)},set:function(s){Bv(this,s)}});Object.getOwnPropertyDescriptor(ne.prototype,"transform")||Object.defineProperty(ne.prototype,"transform",{get:function(){return this}});Object.getOwnPropertyDescriptor(ne.prototype,"worldPosition")||Object.defineProperty(ne.prototype,"worldPosition",{get:function(){return this instanceof LS?Ve(this.object):Ve(this)},set:function(s){Sn(this,s)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldQuaternion")||Object.defineProperty(ne.prototype,"worldQuaternion",{get:function(){return this instanceof LS?Ht(this.object):Ht(this)},set:function(s){na(this,s)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldRotation")||Object.defineProperty(ne.prototype,"worldRotation",{get:function(){return m0(this)},set:function(s){WM(this,s)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldScale")||Object.defineProperty(ne.prototype,"worldScale",{get:function(){return oi(this)},set:function(s){Kg(this,s)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldForward")||Object.defineProperty(ne.prototype,"worldForward",{get:function(){return Be().set(0,0,1).applyQuaternion(Ht(this))}});Object.getOwnPropertyDescriptor(ne.prototype,"worldRight")||Object.defineProperty(ne.prototype,"worldRight",{get:function(){return Be().set(1,0,0).applyQuaternion(Ht(this))}});Object.getOwnPropertyDescriptor(ne.prototype,"worldUp")||Object.defineProperty(ne.prototype,"worldUp",{get:function(){return Be().set(0,1,0).applyQuaternion(Ht(this))}});u6(ne);class Ut extends xe{constructor(t,n,r,o){var i=(...args)=>{super(...args);h(this,"alpha",1)};n!=null&&r!=null?(i(t,n,r),this.alpha=o):(i(t),this.alpha=1)}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,n){const r=t;return r.alpha!=null&&(this.alpha=ye.lerp(this.alpha,r.alpha,n)),super.lerp(t,n)}lerpColors(t,n,r){const o=t,a=n;return o.alpha!=null&&a.alpha!=null&&(this.alpha=ye.lerp(o.alpha,a.alpha,r)),super.lerpColors(t,n,r)}multiply(t){const n=t;return n.alpha!=null&&(this.alpha=this.alpha*n.alpha),super.multiply(t)}fromArray(t,n=0){return this.alpha=t[n+3],super.fromArray(t,n)}}const Tv=Q("debuggetcomponent"),Rv=Q("debuginstantiate");var CT;(function(s){s[s.None=0]="None",s[s.HideInHierarchy=1]="HideInHierarchy",s[s.HideInInspector=2]="HideInInspector",s[s.DontSaveInEditor=4]="DontSaveInEditor",s[s.NotEditable=8]="NotEditable",s[s.DontSaveInBuild=16]="DontSaveInBuild",s[s.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",s[s.DontSave=52]="DontSave",s[s.HideAndDontSave=61]="HideAndDontSave"})(CT||(CT={}));class ll{constructor(){h(this,"idProvider");h(this,"parent");h(this,"keepWorldPosition");h(this,"position");h(this,"rotation");h(this,"scale");h(this,"visible");h(this,"context");h(this,"components")}clone(){var t,n,r;const i=new ll;return i.idProvider=this.idProvider,i.parent=this.parent,i.keepWorldPosition=this.keepWorldPosition,i.position=(t=this.position)==null?void 0:t.clone(),i.rotation=(n=this.rotation)==null?void 0:n.clone(),i.scale=(r=this.scale)==null?void 0:r.clone(),i.visible=this.visible,i.context=this.context,i.components=this.components,i}cloneAssign(i){var t,n,r;this.idProvider=i.idProvider,this.parent=i.parent,this.keepWorldPosition=i.keepWorldPosition,this.position=(t=i.position)==null?void 0:t.clone(),this.rotation=(n=i.rotation)==null?void 0:n.clone(),this.scale=(r=i.scale)==null?void 0:r.clone(),this.visible=i.visible,this.context=i.context,this.components=i.components}}function Tm(s){return s.visible}function Bv(s,i){return typeof i=="number"&&(i=i>.5),s.visible=i,s.visible}function S6(s){return s[$c]||zS(s)}function E6(s,i){s[VD]=i}function zS(s){return ta.isUsingInstancing(s)}function T0(s,i){return jg(s,i,!0,!0)}const lO=Symbol("isDestroyed");function kf(s){return s[lO]}function I6(s,i){s[lO]=i}const Tx=Symbol("isDontDestroy");function ST(s,i=!0){s[Tx]=i}const Pv=[],Mv=[];function xo(s,i=!0,t=!1){Pv.length=0,Mv.length=0,Rx(s,i,!0);for(const n of Pv)n.gameObject=null,n.context=null;for(const n of Mv)I6(n,!0),t&&si(n),y5(n);Mv.length=0,Pv.length=0}function Rx(s,i=!0,t=!0){var a;if(s==null)return;const n=s;if(n.isComponent){if(n[Tx])return;Pv.push(n);const l=n.gameObject;n.__internalDisable(),n.__internalDestroy(),n.gameObject=l;return}if(s[Tx])return;const r=s;Tv&&console.log(r),Mv.push(r);const o=(a=r.userData)==null?void 0:a.components;if(o!=null&&Array.isArray(o)){let l=o.length;for(let c=0;c<o.length;c++){const u=o[c];Rx(u,i,!1),o.length<l&&(l=o.length,c--)}}if(i&&r.children)for(const l of r.children)Rx(l,i,!1);t&&r.removeFromParent()}function Df(s,i,t=!0){return cO(s,i,t)}function*QS(s,i,t=!1,n=999,r=0){if(s!=null&&s.userData.components&&!(r>n)){for(const o of s.userData.components)i&&(o==null?void 0:o.isComponent)===!0&&o instanceof i?yield o:yield o;if(t===!0)for(const o of s.children)yield*QS(o,i,!0,n,r+1)}}function cO(s,i,t,n=0){var r;if(s){if(s.isObject3D,n>1e3){console.warn("Failed to iterate components: too many levels");return}if((r=s.userData)!=null&&r.components)for(let o=0;o<s.userData.components.length;o++){const a=s.userData.components[o];if((a==null?void 0:a.isComponent)===!0){const l=i(a);if(l!==void 0)return l}}if(t&&s.children){const o=n+1;for(let a=0;a<s.children.length;a++){const l=s.children[a];if(!l)continue;const c=cO(l,i,t,o);if(c!==void 0)return c}}}}function Rm(s,i=null){let t=null;i!==null&&(i.x!==void 0?(t=new ll,t.position=i):t=i);let n=Ge.Current;t!=null&&t.context&&(n=t.context),Tv&&n.alias&&console.log("context",n.alias),t&&!t.idProvider&&(t.idProvider=new En(Date.now()));const r=[],o={},a={},l=hO(n,s,t,r,o,a);l&&(R6(o),T6(a,o)),Tv&&(Xw(s,!0),Xw(l,!0));const c={};if((t==null?void 0:t.components)!==!1){for(const u in r){const d=r[u],f=d.guid;t&&t.idProvider&&(d.guid=t.idProvider.generateUUID(),c[f]=d.guid,Tv&&console.log(d.name,d.guid)),WS(d,n),d.__internalNewInstanceCreated&&d.__internalNewInstanceCreated()}for(const u in r){const d=r[u];d.resolveGuids&&d.resolveGuids(c),d.enabled!==!1&&(d.enabled=!0)}ry(n)}return l}function hO(s,i,t,n,r,o){var d;if(!i)return null;const a=i.userData;i.userData={};const l=i.children;i.children=[];const c=i.clone(!1);if(NS(c),i.userData=a,i.children=l,r[i.uuid]={original:i,clone:c},Rv&&console.log("ADD",i,c),i.type==="SkinnedMesh"&&(o[i.uuid]={original:i,clone:c}),(t==null?void 0:t.visible)!==void 0&&(c.visible=t.visible),t!=null&&t.idProvider){c.uuid=t.idProvider.generateUUID();const f=c;f&&(f.guid=c.uuid)}i.animations&&i.animations.length>0&&(c.animations=[...i.animations]);const u=i.parent;if(u&&u.add(c),t!=null&&t.position?Sn(c,t.position):c.position.copy(i.position),t!=null&&t.rotation?na(c,t.rotation):c.quaternion.copy(i.quaternion),t!=null&&t.scale?c.scale.copy(t.scale):c.scale.copy(i.scale),t!=null&&t.parent&&t.parent!=="scene"){let f=null;if(typeof t.parent=="string"?f=jg(t.parent,s.scene,!0):f=t.parent,f){const p=t.keepWorldPosition===!0?f.attach:f.add;p?p.call(f,c):console.error("Invalid parent object",f,"received when instantiating:",i)}else console.warn("could not find parent:",t.parent)}for(const[f,p]of Object.entries(i.userData))f!=="components"&&(c.userData[f]=p);if((d=i.userData)!=null&&d.components){const f=i.userData.components,p=[];c.userData.components=p;for(let g=0;g<f.length;g++){const m=f[g],A=new m.constructor;Mf(A,m),m[vv]!==void 0&&(A[vv]=m[vv]),p.push(A),A.gameObject=c,n.push(A),r[m.guid]={original:m,clone:A},x0.dispatchComponentLifecycleEvent(em.Added,A)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const f in i.children){const p=i.children[f],g=hO(s,p,t,n,r,o);g&&c.add(g)}return c}function T6(s,i){for(const t in s){const n=s[t],r=n.original,o=r.skeleton,a=n.clone;if(!o){console.warn("Skinned mesh has no skeleton?",n);continue}const l=o.bones,c=a.skeleton.clone();a.skeleton=c,a.bindMatrix.clone().copy(r.bindMatrix),a.bindMatrixInverse.copy(r.bindMatrixInverse);const u=[];c.bones=u;for(let d=0;d<l.length;d++){const f=l[d],g=i[f.uuid].clone;u.push(g)}}for(const t in s){const n=s[t].clone;n.skeleton.update(),n.bind(n.skeleton,n.bindMatrix),n.updateMatrixWorld(!0)}}function R6(s){var i;for(const t in s){const r=s[t].clone;if(r!=null&&r.isObject3D&&((i=r==null?void 0:r.userData)!=null&&i.components))for(let o=0;o<r.userData.components.length;o++){const a=r.userData.components[o],l=Object.entries(a);for(const[c,u]of l)if(Array.isArray(u)){const d=[];a[c]=d;for(let f=0;f<u.length;f++){const p=u[f];if(typeof p!="object"){d.push(p);continue}const g=ET(a,c,p,s);g!==void 0?d.push(g):d.push(p)}}else if(typeof u=="object"){const d=ET(a,c,u,s);d!==void 0&&(a[c]=d)}}}}function ET(s,i,t,n){var r,o;if(t!=null)if(t.isComponent===!0){const a=t.gameObject;if(a){const l=a.uuid,c=(r=n[l])==null?void 0:r.clone;if(!c){Rv&&console.log("reference did not change",i,s,t);return}const u=a.userData.components.indexOf(t);if(u>=0&&c.isObject3D)return Rv&&console.log(i,l),c.userData.components[u];console.warn("could not find component",i,t)}}else if(t.isObject3D===!0){if(i==="gameObject")return;const a=t;if(a){const l=a.uuid,c=(o=n[l])==null?void 0:o.clone;if(c)return Rv&&console.log(i,"old",t,"new",c),c}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return t.__internalOnInstantiate(n)}}var uO={exports:{}},dO={exports:{}};(function(){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return i.rotl(t,8)&16711935|i.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=i.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],r=0,o=0;r<t.length;r++,o+=8)n[o>>>5]|=t[r]<<24-o%32;return n},wordsToBytes:function(t){for(var n=[],r=0;r<t.length*32;r+=8)n.push(t[r>>>5]>>>24-r%32&255);return n},bytesToHex:function(t){for(var n=[],r=0;r<t.length;r++)n.push((t[r]>>>4).toString(16)),n.push((t[r]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],r=0;r<t.length;r+=2)n.push(parseInt(t.substr(r,2),16));return n},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var o=t[r]<<16|t[r+1]<<8|t[r+2],a=0;a<4;a++)r*8+a*6<=t.length*8?n.push(s.charAt(o>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,o=0;r<t.length;o=++r%4)o!=0&&n.push((s.indexOf(t.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<o*2|s.indexOf(t.charAt(r))>>>6-o*2);return n}};dO.exports=i})();var B6=dO.exports,Bx={utf8:{stringToBytes:function(s){return Bx.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(Bx.bin.bytesToString(s)))}},bin:{stringToBytes:function(s){for(var i=[],t=0;t<s.length;t++)i.push(s.charCodeAt(t)&255);return i},bytesToString:function(s){for(var i=[],t=0;t<s.length;t++)i.push(String.fromCharCode(s[t]));return i.join("")}}},IT=Bx;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var P6=function(s){return s!=null&&(fO(s)||M6(s)||!!s._isBuffer)};function fO(s){return!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function M6(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&fO(s.slice(0,0))}(function(){var s=B6,i=IT.utf8,t=P6,n=IT.bin,r=function(o,a){o.constructor==String?a&&a.encoding==="binary"?o=n.stringToBytes(o):o=i.stringToBytes(o):t(o)?o=Array.prototype.slice.call(o,0):!Array.isArray(o)&&o.constructor!==Uint8Array&&(o=o.toString());for(var l=s.bytesToWords(o),c=o.length*8,u=1732584193,d=-271733879,f=-1732584194,p=271733878,g=0;g<l.length;g++)l[g]=(l[g]<<8|l[g]>>>24)&16711935|(l[g]<<24|l[g]>>>8)&4278255360;l[c>>>5]|=128<<c%32,l[(c+64>>>9<<4)+14]=c;for(var m=r._ff,A=r._gg,y=r._hh,b=r._ii,g=0;g<l.length;g+=16){var _=u,w=d,S=f,E=p;u=m(u,d,f,p,l[g+0],7,-680876936),p=m(p,u,d,f,l[g+1],12,-389564586),f=m(f,p,u,d,l[g+2],17,606105819),d=m(d,f,p,u,l[g+3],22,-1044525330),u=m(u,d,f,p,l[g+4],7,-176418897),p=m(p,u,d,f,l[g+5],12,1200080426),f=m(f,p,u,d,l[g+6],17,-1473231341),d=m(d,f,p,u,l[g+7],22,-45705983),u=m(u,d,f,p,l[g+8],7,1770035416),p=m(p,u,d,f,l[g+9],12,-1958414417),f=m(f,p,u,d,l[g+10],17,-42063),d=m(d,f,p,u,l[g+11],22,-1990404162),u=m(u,d,f,p,l[g+12],7,1804603682),p=m(p,u,d,f,l[g+13],12,-40341101),f=m(f,p,u,d,l[g+14],17,-1502002290),d=m(d,f,p,u,l[g+15],22,1236535329),u=A(u,d,f,p,l[g+1],5,-165796510),p=A(p,u,d,f,l[g+6],9,-1069501632),f=A(f,p,u,d,l[g+11],14,643717713),d=A(d,f,p,u,l[g+0],20,-373897302),u=A(u,d,f,p,l[g+5],5,-701558691),p=A(p,u,d,f,l[g+10],9,38016083),f=A(f,p,u,d,l[g+15],14,-660478335),d=A(d,f,p,u,l[g+4],20,-405537848),u=A(u,d,f,p,l[g+9],5,568446438),p=A(p,u,d,f,l[g+14],9,-1019803690),f=A(f,p,u,d,l[g+3],14,-187363961),d=A(d,f,p,u,l[g+8],20,1163531501),u=A(u,d,f,p,l[g+13],5,-1444681467),p=A(p,u,d,f,l[g+2],9,-51403784),f=A(f,p,u,d,l[g+7],14,1735328473),d=A(d,f,p,u,l[g+12],20,-1926607734),u=y(u,d,f,p,l[g+5],4,-378558),p=y(p,u,d,f,l[g+8],11,-2022574463),f=y(f,p,u,d,l[g+11],16,1839030562),d=y(d,f,p,u,l[g+14],23,-35309556),u=y(u,d,f,p,l[g+1],4,-1530992060),p=y(p,u,d,f,l[g+4],11,1272893353),f=y(f,p,u,d,l[g+7],16,-155497632),d=y(d,f,p,u,l[g+10],23,-1094730640),u=y(u,d,f,p,l[g+13],4,681279174),p=y(p,u,d,f,l[g+0],11,-358537222),f=y(f,p,u,d,l[g+3],16,-722521979),d=y(d,f,p,u,l[g+6],23,76029189),u=y(u,d,f,p,l[g+9],4,-640364487),p=y(p,u,d,f,l[g+12],11,-421815835),f=y(f,p,u,d,l[g+15],16,530742520),d=y(d,f,p,u,l[g+2],23,-995338651),u=b(u,d,f,p,l[g+0],6,-198630844),p=b(p,u,d,f,l[g+7],10,1126891415),f=b(f,p,u,d,l[g+14],15,-1416354905),d=b(d,f,p,u,l[g+5],21,-57434055),u=b(u,d,f,p,l[g+12],6,1700485571),p=b(p,u,d,f,l[g+3],10,-1894986606),f=b(f,p,u,d,l[g+10],15,-1051523),d=b(d,f,p,u,l[g+1],21,-2054922799),u=b(u,d,f,p,l[g+8],6,1873313359),p=b(p,u,d,f,l[g+15],10,-30611744),f=b(f,p,u,d,l[g+6],15,-1560198380),d=b(d,f,p,u,l[g+13],21,1309151649),u=b(u,d,f,p,l[g+4],6,-145523070),p=b(p,u,d,f,l[g+11],10,-1120210379),f=b(f,p,u,d,l[g+2],15,718787259),d=b(d,f,p,u,l[g+9],21,-343485551),u=u+_>>>0,d=d+w>>>0,f=f+S>>>0,p=p+E>>>0}return s.endian([u,d,f,p])};r._ff=function(o,a,l,c,u,d,f){var p=o+(a&l|~a&c)+(u>>>0)+f;return(p<<d|p>>>32-d)+a},r._gg=function(o,a,l,c,u,d,f){var p=o+(a&c|l&~c)+(u>>>0)+f;return(p<<d|p>>>32-d)+a},r._hh=function(o,a,l,c,u,d,f){var p=o+(a^l^c)+(u>>>0)+f;return(p<<d|p>>>32-d)+a},r._ii=function(o,a,l,c,u,d,f){var p=o+(l^(a|~c))+(u>>>0)+f;return(p<<d|p>>>32-d)+a},r._blocksize=16,r._digestsize=16,uO.exports=function(o,a){if(o==null)throw new Error("Illegal argument "+o);var l=s.wordsToBytes(r(o,a));return a&&a.asBytes?l:a&&a.asString?n.bytesToString(l):s.bytesToHex(l)}})();var k6=uO.exports;const D6=b0(k6);class TT{constructor(i,t,n,r){h(this,"success");h(this,"filename");h(this,"hash");h(this,"size");h(this,"url");this.success=i,this.filename=t,this.hash=n,this.size=r}}async function O6(s,i){const t=await s.arrayBuffer(),n=pO(t),r=s.name.split(".").pop(),o=n+"."+r,a=s.name.split(".").shift();console.assert(a!==void 0);const l={alias:a,filename:o},u=await(await fetch(i+"/exists",{method:"POST",body:JSON.stringify(l)})).json();if(u.success||console.warn("exists check did fail"),u.exists)return console.log("file already exists",n),new TT(!0,o,n,s.size);console.log("begin uploading file",a,s.size);const d=new FormData;d.append("file",s);const f={};f.filesize=s.size,a&&(f.alias=a);const g=await(await fetch(i+"/upload/file",{method:"POST",body:d,headers:f})).json();if((g==null?void 0:g.success)===!1)return g.message!==void 0?console.error("Upload failed:",g.message):console.error("Upload failed"),null;console.assert(g.hash_sum===n,"hash sum did not match","received:",g.hash_sum,"expected:",n),g.success&&console.log("successfully uploaded",n,g.id);const m=new TT(g.success,o,n,s.size);return m.url=i,m}function pO(s){return D6(new Uint8Array(s))}async function gO(s,i,t,n,r=!1){try{const o=await fetch(n+"/download/file",{method:"POST",body:s});if(o.status!==200)return console.error("download failed",o),null;const a=await o.blob(),l=await a.arrayBuffer();r||console.assert(a.size===t,"size mismatch","expected:",t,"got:",a.size);const c=pO(l);return r||console.assert(c===i,"hash mismatch, downloaded file is invalid"),a.arrayBuffer()}catch(o){console.error(o)}return null}async function L6(s,i){var d;const t=await fetch(s),n=(d=t.body)==null?void 0:d.getReader(),r=t.headers.get("Content-Length"),o=r?parseInt(r):0;if(!n)return null;let a=0;const l=[];for(;;){const{done:f,value:p}=await n.read();if(p&&(l.push(p),a+=p.length,i.call(null,new ProgressEvent("progress",{loaded:a,total:o}))),f)break}const c=new Uint8Array(a);let u=0;for(const f of l)c.set(f,u),u+=f.length;return c}const Sc=Q("debugaddressables");class F6{constructor(i){h(this,"_context");h(this,"_assetReferences",{});h(this,"preUpdate",()=>{});this._context=i,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const i=this._context.pre_update_callbacks.indexOf(this.preUpdate);i>=0&&this._context.pre_update_callbacks.splice(i,1);for(const t in this._assetReferences){const n=this._assetReferences[t];n==null||n.unload()}this._assetReferences={}}findAssetReference(i){return this._assetReferences[i]||null}registerAssetReference(i){return i.uri&&(this._assetReferences[i.uri]?console.warn("Asset reference already registered",i):this._assetReferences[i.uri]=i),i}unregisterAssetReference(i){i.uri&&delete this._assetReferences[i.uri]}}const x_=Symbol("assetReference"),Zh=class{constructor(i,t,n=null){h(this,"_loading");h(this,"_asset");h(this,"_glbRoot");h(this,"_url");h(this,"_progressListeners",[]);h(this,"_hash");h(this,"_hashedUri");h(this,"_isLoadingRawBinary",!1);h(this,"_rawBinary");this._url=i,this._hash=t,i.includes("?v=")?this._hashedUri=i:this._hashedUri=t?i+"?v="+t:i,n!==null&&(this.asset=n),H5(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(i,t){if(!t&&(t=Ge.Current,!t))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const n=t.addressables,r=n.findAssetReference(i);if(r)return r;const o=new Zh(i,t.hash);return n.registerAssetReference(o),o}static getOrCreate(i,t,n){if(typeof i=="string"){if(!n&&(n=Ge.Current,!n))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else n=i.context,i=i.sourceId;const r=Ou(i,t);Sc&&console.log("GetOrCreate Addressable from",i,t,"FinalPath=",r);const o=n.addressables,a=o.findAssetReference(r);if(a)return a;const l=new Zh(r,n.hash);return o.registerAssetReference(l),l}get asset(){return this._glbRoot??this._asset}set asset(i){this._asset=i}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(i){return i===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||kf(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(Sc&&console.log("Unload",this.asset),this.asset.scene&&xo(this.asset.scene,!0,!0),xo(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Ge.Current&&Ge.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,Sc&&console.log("Preload",this._hashedUri);const i=await L6(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(i==null?void 0:i.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(i){if(Sc&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(i&&this._progressListeners.push(i),this._loading!==void 0)return this._loading.then(r=>this.asset);const t=Ge.Current;this._rawBinary?(this._loading=nl().parseSync(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(Sc&&console.log("Load async",this.uri),this._loading=nl().loadSync(t,this._hashedUri,this.uri,null,r=>{this.raiseProgressEvent(r)}));const n=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(n),this._loading=void 0,n)return n[x_]=this,this._glbRoot&&(this._glbRoot[x_]=this),this.asset&&(this.asset[x_]=this),ry(t),n.scene!==void 0&&(this.asset=n),this.asset}async instantiate(i){return this.onInstantiate(i,!1)}async instantiateSynced(i,t=!0){return this.onInstantiate(i,!0,t)}beginListenDownload(i){this._progressListeners.indexOf(i)<0&&this._progressListeners.push(i)}endListenDownload(i){const t=this._progressListeners.indexOf(i);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(i){for(const t of this._progressListeners)t(this,i)}async onInstantiate(i,t=!1,n){const r=Ge.Current,o=new ll;if(i instanceof ne?o.parent=i:i&&(Object.assign(o,i),o.cloneAssign(i)),o.parent||(o.parent=r.scene),this.mustLoad&&await this.loadAssetAsync(),Sc&&console.log("Instantiate",this.uri,"parent:",i),this.asset){Sc&&console.log("Add to scene",this.asset);let a=Zh.currentlyInstantiating.get(this.uri);if(a!==void 0&&a>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+a+")"),null;try{if(a===void 0&&(a=0),a+=1,Zh.currentlyInstantiating.set(this.uri,a),t){o.context=r;const l=this.asset;l.guid=this.uri;const c=JD(l,o,void 0,n);if(c)return c}else{const l=Rm(this.asset,o);if(l)return l}}finally{r.post_render_callbacks.push(()=>{a===void 0||a<0?a=0:a-=1,Zh.currentlyInstantiating.set(this.uri,a)})}}else Sc&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(i){if(i&&i.scene){const t=i.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let tt=Zh;h(tt,"currentlyInstantiating",new Map);class U6 extends Eo{constructor(){super([tt],"AssetReferenceSerializer")}onSerialize(i,t){if(i&&i.uri!==void 0&&typeof i.uri=="string")return i.uri}onDeserialize(i,t){if(typeof i=="string")return t.context?t.gltfId?tt.getOrCreate(t.gltfId,i,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(i instanceof ne){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const n=i,r=t.context,o=n.guid??n.uuid,a=r.addressables.findAssetReference(o);if(a)return a;const l=new tt(o,void 0,n);return r.addressables.registerAssetReference(l),l}return null}}new U6;const N6=Promise.resolve(null),Dg=class{constructor(i){h(this,"url");h(this,"_bitmap");h(this,"_bitmapObject");h(this,"loader",null);this.url=i}static getOrCreate(i){let t=Dg.imageReferences.get(i);return t||(t=new Dg(i),Dg.imageReferences.set(i,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const i=new Image;return i.src=this.url,i}createTexture(){return this.url?(this.loader||(this.loader=new Xa),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):N6}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((i,t)=>{const n=document.createElement("img");n.addEventListener("load",()=>{this._bitmap=createImageBitmap(n).then(r=>(this._bitmapObject=r,i(r),r))}),n.addEventListener("error",r=>{console.error("Failed to load image:"+this.url,r),i(null)}),n.src=this.url}),this._bitmap)}};let hg=Dg;h(hg,"imageReferences",new Map);class z6 extends Eo{constructor(){super([hg],"ImageReferenceSerializer")}onSerialize(i,t){return null}onDeserialize(i,t){if(typeof i=="string"){const n=Ou(t.gltfId,i);return hg.getOrCreate(n)}}}new z6;const Og=class{constructor(i){h(this,"url");h(this,"res");this.url=i}static getOrCreate(i){let t=Og.cache.get(i);return t||(t=new Og(i),Og.cache.set(i,t)),t}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(i=>i.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(i=>i.text())}};let ug=Og;h(ug,"cache",new Map);class Q6 extends Eo{constructor(){super([ug],"FileReferenceSerializer")}onSerialize(i,t){return null}onDeserialize(i,t){if(typeof i=="string"){const n=Ou(t.gltfId,i);return ug.getOrCreate(n)}}}new Q6;class j6{constructor(i){h(this,"context");h(this,"mixers",[]);this.context=i}onDestroy(){this.mixers.forEach(i=>i.stopAllAction()),this.mixers.length=0}registerAnimationMixer(i){if(!i){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(i)||this.mixers.push(i)}unregisterAnimationMixer(i){if(!i)return;const t=this.mixers.indexOf(i);t!==-1&&this.mixers.splice(t,1)}}class im{static tryGetActionsFromMixer(i){const t=i._actions;return t||null}static tryGetAnimationClipsFromObjectHierarchy(i,t){if(t||(t=new Array),i)i.animations&&t.push(...i.animations);else return t;if(i.children)for(const n of i.children)this.tryGetAnimationClipsFromObjectHierarchy(n,t);return t}static assignAnimationsFromFile(i,t){if(!i||!i.animations)return;for(let r=0;r<i.animations.length;r++){const o=i.animations[r];if(!(!o.tracks||o.tracks.length<=0))for(const a in o.tracks){const l=o.tracks[a],c=Nr.parseTrackName(l.name);let u=Nr.findNode(i.scene,c.nodeName);if(!u){const f=l.__objectName??l.name.substring(0,l.name.indexOf("."));if(u=i.scene.getObjectByProperty("uuid",f),!u)continue}let d=n(u);if(!d){if(!(t!=null&&t.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}d=t.createAnimationComponent(i.scene,o)}d.addClip&&d.addClip(o)}}function n(r){var a;if(!r)return null;const o=(a=r.userData)==null?void 0:a.components;if(o&&o.length>0){for(let l=0;l<o.length;l++)if(o[l].isAnimationComponent===!0)return r}return n(r.parent)}}}var du;(function(s){s.Visible="application-visible",s.Hidden="application-hidden",s.MuteChanged="application-mutechanged"})(du||(du={}));let cy=!1;const Ld=[];function zu(){if(cy)return;be()&&console.debug("User interaction registered: audio can now be played"),cy=!0;const s=[...Ld];Ld.length=0,s.forEach(i=>i())}document.addEventListener("mousedown",zu);document.addEventListener("pointerup",zu);document.addEventListener("click",zu);document.addEventListener("dragstart",zu);document.addEventListener("touchend",zu);document.addEventListener("keydown",zu);Fe.onXRSessionStart(()=>{zu()});const ZE=class extends EventTarget{constructor(t){super();h(this,"_mute",!1);h(this,"context");h(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return cy}static registerWaitForInteraction(t){if(t!==null){if(cy){t();return}Ld.indexOf(t)===-1&&Ld.push(t)}}static unregisterWaitForInteraction(t){const n=Ld.indexOf(t);n!==-1&&Ld.splice(n,1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event(du.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(du.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(du.Visible));break}}};let Ja=ZE;h(Ja,"registerWaitForAllowAudio",ZE.registerWaitForInteraction);function*G6(s,i=null){const t=i?i.time:Ge.Current.time,n=t.time;for(;t.time-n<s;)yield}function*jK(s){for(let i=0;i<s;i++)yield}function*H6(s){let i=!0;for(s.then(()=>i=!1),s.catch(()=>i=!1);i;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var RT=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))};try{URL.revokeObjectURL(RT(""))}catch{RT=function(i){return"data:application/javascript;charset=UTF-8,"+encodeURI(i)}}var Xi=Uint8Array,Ws=Uint16Array,Of=Uint32Array,R0=new Xi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),B0=new Xi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Px=new Xi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mO=function(s,i){for(var t=new Ws(31),n=0;n<31;++n)t[n]=i+=1<<s[n-1];for(var r=new Of(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return[t,r]},AO=mO(R0,2),vO=AO[0],Mx=AO[1];vO[28]=258,Mx[258]=28;var yO=mO(B0,0),V6=yO[0],BT=yO[1],kx=new Ws(32768);for(var ai=0;ai<32768;++ai){var Ec=(ai&43690)>>>1|(ai&21845)<<1;Ec=(Ec&52428)>>>2|(Ec&13107)<<2,Ec=(Ec&61680)>>>4|(Ec&3855)<<4,kx[ai]=((Ec&65280)>>>8|(Ec&255)<<8)>>>1}var Za=function(s,i,t){for(var n=s.length,r=0,o=new Ws(i);r<n;++r)++o[s[r]-1];var a=new Ws(i);for(r=0;r<i;++r)a[r]=a[r-1]+o[r-1]<<1;var l;if(t){l=new Ws(1<<i);var c=15-i;for(r=0;r<n;++r)if(s[r])for(var u=r<<4|s[r],d=i-s[r],f=a[s[r]-1]++<<d,p=f|(1<<d)-1;f<=p;++f)l[kx[f]>>>c]=u}else for(l=new Ws(n),r=0;r<n;++r)s[r]&&(l[r]=kx[a[s[r]-1]++]>>>15-s[r]);return l},uh=new Xi(288);for(var ai=0;ai<144;++ai)uh[ai]=8;for(var ai=144;ai<256;++ai)uh[ai]=9;for(var ai=256;ai<280;++ai)uh[ai]=7;for(var ai=280;ai<288;++ai)uh[ai]=8;var nm=new Xi(32);for(var ai=0;ai<32;++ai)nm[ai]=5;var W6=Za(uh,9,0),q6=Za(uh,9,1),X6=Za(nm,5,0),Y6=Za(nm,5,1),C_=function(s){for(var i=s[0],t=1;t<s.length;++t)s[t]>i&&(i=s[t]);return i},Fo=function(s,i,t){var n=i/8|0;return(s[n]|s[n+1]<<8)>>(i&7)&t},S_=function(s,i){var t=i/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(i&7)},jS=function(s){return(s/8|0)+(s&7&&1)},GS=function(s,i,t){(i==null||i<0)&&(i=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Ws?Ws:s instanceof Of?Of:Xi)(t-i);return n.set(s.subarray(i,t)),n},K6=function(s,i,t){var n=s.length;if(!n||t&&!t.l&&n<5)return i||new Xi(0);var r=!i||t,o=!t||t.i;t||(t={}),i||(i=new Xi(n*3));var a=function(Me){var Ke=i.length;if(Me>Ke){var Pt=new Xi(Math.max(Ke*2,Me));Pt.set(i),i=Pt}},l=t.f||0,c=t.p||0,u=t.b||0,d=t.l,f=t.d,p=t.m,g=t.n,m=n*8;do{if(!d){t.f=l=Fo(s,c,1);var A=Fo(s,c+1,3);if(c+=3,A)if(A==1)d=q6,f=Y6,p=9,g=5;else if(A==2){var w=Fo(s,c,31)+257,S=Fo(s,c+10,15)+4,E=w+Fo(s,c+5,31)+1;c+=14;for(var I=new Xi(E),k=new Xi(19),T=0;T<S;++T)k[Px[T]]=Fo(s,c+T*3,7);c+=S*3;for(var P=C_(k),B=(1<<P)-1,M=Za(k,P,1),T=0;T<E;){var U=M[Fo(s,c,B)];c+=U&15;var y=U>>>4;if(y<16)I[T++]=y;else{var G=0,W=0;for(y==16?(W=3+Fo(s,c,3),c+=2,G=I[T-1]):y==17?(W=3+Fo(s,c,7),c+=3):y==18&&(W=11+Fo(s,c,127),c+=7);W--;)I[T++]=G}}var Y=I.subarray(0,w),D=I.subarray(w);p=C_(Y),g=C_(D),d=Za(Y,p,1),f=Za(D,g,1)}else throw"invalid block type";else{var y=jS(c)+4,b=s[y-4]|s[y-3]<<8,_=y+b;if(_>n){if(o)throw"unexpected EOF";break}r&&a(u+b),i.set(s.subarray(y,_),u),t.b=u+=b,t.p=c=_*8;continue}if(c>m){if(o)throw"unexpected EOF";break}}r&&a(u+131072);for(var L=(1<<p)-1,V=(1<<g)-1,te=c;;te=c){var G=d[S_(s,c)&L],K=G>>>4;if(c+=G&15,c>m){if(o)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(K<256)i[u++]=K;else if(K==256){te=c,d=null;break}else{var ue=K-254;if(K>264){var T=K-257,de=R0[T];ue=Fo(s,c,(1<<de)-1)+vO[T],c+=de}var _e=f[S_(s,c)&V],Ee=_e>>>4;if(!_e)throw"invalid distance";c+=_e&15;var D=V6[Ee];if(Ee>3){var de=B0[Ee];D+=S_(s,c)&(1<<de)-1,c+=de}if(c>m){if(o)throw"unexpected EOF";break}r&&a(u+131072);for(var Xe=u+ue;u<Xe;u+=4)i[u]=i[u-D],i[u+1]=i[u+1-D],i[u+2]=i[u+2-D],i[u+3]=i[u+3-D];u=Xe}}t.l=d,t.p=te,t.b=u,d&&(l=1,t.m=p,t.d=f,t.n=g)}while(!l);return u==i.length?i:GS(i,0,u)},yl=function(s,i,t){t<<=i&7;var n=i/8|0;s[n]|=t,s[n+1]|=t>>>8},yp=function(s,i,t){t<<=i&7;var n=i/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},E_=function(s,i){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return[HS,0];if(r==1){var a=new Xi(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(E,I){return E.f-I.f}),t.push({s:-1,f:25001});var l=t[0],c=t[1],u=0,d=1,f=2;for(t[0]={s:-1,f:l.f+c.f,l,r:c};d!=r-1;)l=t[t[u].f<t[f].f?u++:f++],c=t[u!=d&&t[u].f<t[f].f?u++:f++],t[d++]={s:-1,f:l.f+c.f,l,r:c};for(var p=o[0].s,n=1;n<r;++n)o[n].s>p&&(p=o[n].s);var g=new Ws(p+1),m=Dx(t[d-1],g,0);if(m>i){var n=0,A=0,y=m-i,b=1<<y;for(o.sort(function(I,k){return g[k.s]-g[I.s]||I.f-k.f});n<r;++n){var _=o[n].s;if(g[_]>i)A+=b-(1<<m-g[_]),g[_]=i;else break}for(A>>>=y;A>0;){var w=o[n].s;g[w]<i?A-=1<<i-g[w]++-1:++n}for(;n>=0&&A;--n){var S=o[n].s;g[S]==i&&(--g[S],++A)}m=i}return[new Xi(g),m]},Dx=function(s,i,t){return s.s==-1?Math.max(Dx(s.l,i,t+1),Dx(s.r,i,t+1)):i[s.s]=t},PT=function(s){for(var i=s.length;i&&!s[--i];);for(var t=new Ws(++i),n=0,r=s[0],o=1,a=function(c){t[n++]=c},l=1;l<=i;++l)if(s[l]==r&&l!=i)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=s[l]}return[t.subarray(0,n),i]},bp=function(s,i){for(var t=0,n=0;n<i.length;++n)t+=s[n]*i[n];return t},kv=function(s,i,t){var n=t.length,r=jS(i+2);s[r]=n&255,s[r+1]=n>>>8,s[r+2]=s[r]^255,s[r+3]=s[r+1]^255;for(var o=0;o<n;++o)s[r+o+4]=t[o];return(r+4+n)*8},MT=function(s,i,t,n,r,o,a,l,c,u,d){yl(i,d++,t),++r[256];for(var f=E_(r,15),p=f[0],g=f[1],m=E_(o,15),A=m[0],y=m[1],b=PT(p),_=b[0],w=b[1],S=PT(A),E=S[0],I=S[1],k=new Ws(19),T=0;T<_.length;++T)k[_[T]&31]++;for(var T=0;T<E.length;++T)k[E[T]&31]++;for(var P=E_(k,7),B=P[0],M=P[1],U=19;U>4&&!B[Px[U-1]];--U);var G=u+5<<3,W=bp(r,uh)+bp(o,nm)+a,Y=bp(r,p)+bp(o,A)+a+14+3*U+bp(k,B)+(2*k[16]+3*k[17]+7*k[18]);if(G<=W&&G<=Y)return kv(i,d,s.subarray(c,c+u));var D,L,V,te;if(yl(i,d,1+(Y<W)),d+=2,Y<W){D=Za(p,g,0),L=p,V=Za(A,y,0),te=A;var K=Za(B,M,0);yl(i,d,w-257),yl(i,d+5,I-1),yl(i,d+10,U-4),d+=14;for(var T=0;T<U;++T)yl(i,d+3*T,B[Px[T]]);d+=3*U;for(var ue=[_,E],de=0;de<2;++de)for(var _e=ue[de],T=0;T<_e.length;++T){var Ee=_e[T]&31;yl(i,d,K[Ee]),d+=B[Ee],Ee>15&&(yl(i,d,_e[T]>>>5&127),d+=_e[T]>>>12)}}else D=W6,L=uh,V=X6,te=nm;for(var T=0;T<l;++T)if(n[T]>255){var Ee=n[T]>>>18&31;yp(i,d,D[Ee+257]),d+=L[Ee+257],Ee>7&&(yl(i,d,n[T]>>>23&31),d+=R0[Ee]);var Xe=n[T]&31;yp(i,d,V[Xe]),d+=te[Xe],Xe>3&&(yp(i,d,n[T]>>>5&8191),d+=B0[Xe])}else yp(i,d,D[n[T]]),d+=L[n[T]];return yp(i,d,D[256]),d+L[256]},J6=new Of([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),HS=new Xi(0),Z6=function(s,i,t,n,r,o){var a=s.length,l=new Xi(n+a+5*(1+Math.ceil(a/7e3))+r),c=l.subarray(n,l.length-r),u=0;if(!i||a<8)for(var d=0;d<=a;d+=65535){var f=d+65535;f<a?u=kv(c,u,s.subarray(d,f)):(c[d]=o,u=kv(c,u,s.subarray(d,a)))}else{for(var p=J6[i-1],g=p>>>13,m=p&8191,A=(1<<t)-1,y=new Ws(32768),b=new Ws(A+1),_=Math.ceil(t/3),w=2*_,S=function(ss){return(s[ss]^s[ss+1]<<_^s[ss+2]<<w)&A},E=new Of(25e3),I=new Ws(288),k=new Ws(32),T=0,P=0,d=0,B=0,M=0,U=0;d<a;++d){var G=S(d),W=d&32767,Y=b[G];if(y[W]=Y,b[G]=W,M<=d){var D=a-d;if((T>7e3||B>24576)&&D>423){u=MT(s,c,0,E,I,k,P,B,U,d-U,u),B=T=P=0,U=d;for(var L=0;L<286;++L)I[L]=0;for(var L=0;L<30;++L)k[L]=0}var V=2,te=0,K=m,ue=W-Y&32767;if(D>2&&G==S(d-ue))for(var de=Math.min(g,D)-1,_e=Math.min(32767,d),Ee=Math.min(258,D);ue<=_e&&--K&&W!=Y;){if(s[d+V]==s[d+V-ue]){for(var Xe=0;Xe<Ee&&s[d+Xe]==s[d+Xe-ue];++Xe);if(Xe>V){if(V=Xe,te=ue,Xe>de)break;for(var Me=Math.min(ue,Xe-2),Ke=0,L=0;L<Me;++L){var Pt=d-ue+L+32768&32767,Tt=y[Pt],hi=Pt-Tt+32768&32767;hi>Ke&&(Ke=hi,Y=Pt)}}}W=Y,Y=y[W],ue+=W-Y+32768&32767}if(te){E[B++]=268435456|Mx[V]<<18|BT[te];var Ei=Mx[V]&31,Ps=BT[te]&31;P+=R0[Ei]+B0[Ps],++I[257+Ei],++k[Ps],M=d+V,++T}else E[B++]=s[d],++I[s[d]]}}u=MT(s,c,o,E,I,k,P,B,U,d-U,u),!o&&u&7&&(u=kv(c,u+1,HS))}return GS(l,0,n+jS(u)+r)},$6=function(){for(var s=new Of(256),i=0;i<256;++i){for(var t=i,n=9;--n;)t=(t&1&&3988292384)^t>>>1;s[i]=t}return s}(),eH=function(){var s=-1;return{p:function(i){for(var t=s,n=0;n<i.length;++n)t=$6[t&255^i[n]]^t>>>8;s=t},d:function(){return~s}}},tH=function(s,i,t,n,r){return Z6(s,i.level==null?6:i.level,i.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):12+i.mem,t,n,!r)},bO=function(s,i){var t={};for(var n in s)t[n]=s[n];for(var n in i)t[n]=i[n];return t},Wn=function(s,i,t){for(;t;++i)s[i]=t,t>>>=8},iH=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function nH(s,i){return tH(s,i||{},0,0)}function Wp(s,i){return K6((iH(s),s.subarray(2,-4)),i)}var _O=function(s,i,t,n){for(var r in s){var o=s[r],a=i+r;o instanceof Xi?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],bO(n,o[1])]:_O(o,a+"/",t,n)}},kT=typeof TextEncoder<"u"&&new TextEncoder,sH=typeof TextDecoder<"u"&&new TextDecoder,rH=0;try{sH.decode(HS,{stream:!0}),rH=1}catch{}function hy(s,i){if(i){for(var t=new Xi(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(kT)return kT.encode(s);for(var r=s.length,o=new Xi(s.length+(s.length>>1)),a=0,l=function(d){o[a++]=d},n=0;n<r;++n){if(a+5>o.length){var c=new Xi(a+8+(r-n<<1));c.set(o),o=c}var u=s.charCodeAt(n);u<128||i?l(u):u<2048?(l(192|u>>6),l(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|s.charCodeAt(++n)&1023,l(240|u>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|u&63)):(l(224|u>>12),l(128|u>>6&63),l(128|u&63))}return GS(o,0,a)}var Ox=function(s){var i=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";i+=n+4}return i},DT=function(s,i,t,n,r,o,a,l){var c=n.length,u=t.extra,d=l&&l.length,f=Ox(u);Wn(s,i,a!=null?33639248:67324752),i+=4,a!=null&&(s[i++]=20,s[i++]=t.os),s[i]=20,i+=2,s[i++]=t.flag<<1|(o==null&&8),s[i++]=r&&8,s[i++]=t.compression&255,s[i++]=t.compression>>8;var p=new Date(t.mtime==null?Date.now():t.mtime),g=p.getFullYear()-1980;if(g<0||g>119)throw"date not in range 1980-2099";if(Wn(s,i,g<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),i+=4,o!=null&&(Wn(s,i,t.crc),Wn(s,i+4,o),Wn(s,i+8,t.size)),Wn(s,i+12,c),Wn(s,i+14,f),i+=16,a!=null&&(Wn(s,i,d),Wn(s,i+6,t.attrs),Wn(s,i+10,a),i+=14),s.set(n,i),i+=c,f)for(var m in u){var A=u[m],y=A.length;Wn(s,i,+m),Wn(s,i+2,y),s.set(A,i+4),i+=4+y}return d&&(s.set(l,i),i+=d),i},oH=function(s,i,t,n,r){Wn(s,i,101010256),Wn(s,i+8,t),Wn(s,i+10,t),Wn(s,i+12,n),Wn(s,i+16,r)};function aH(s,i){i||(i={});var t={},n=[];_O(s,"",t,i);var r=0,o=0;for(var a in t){var l=t[a],c=l[0],u=l[1],d=u.level==0?0:8,f=hy(a),p=f.length,g=u.comment,m=g&&hy(g),A=m&&m.length,y=Ox(u.extra);if(p>65535)throw"filename too long";var b=d?nH(c,u):c,_=b.length,w=eH();w.p(c),n.push(bO(u,{size:c.length,crc:w.d(),c:b,f,m,u:p!=a.length||m&&g.length!=A,o:r,compression:d})),r+=30+p+y+_,o+=76+2*(p+y)+(A||0)+_}for(var S=new Xi(o+22),E=r,I=o-r,k=0;k<n.length;++k){var f=n[k];DT(S,f.o,f,f.f,f.u,f.c.length);var T=30+f.f.length+Ox(f.extra);S.set(f.c,f.o+T),DT(S,r,f,f.f,f.u,f.c.length,f.o,f.m),r+=16+T+(f.m?f.m.length:0)}return oH(S,r,n.length,I,E),S}class sm extends LP{constructor(i){super(i),this.type=$n}parse(i){const P=Math.pow(2.7182818,2.2);function B(C,R){let F=0;for(let ie=0;ie<65536;++ie)(ie==0||C[ie>>3]&1<<(ie&7))&&(R[F++]=ie);const q=F-1;for(;F<65536;)R[F++]=0;return q}function M(C){for(let R=0;R<16384;R++)C[R]={},C[R].len=0,C[R].lit=0,C[R].p=null}const U={l:0,c:0,lc:0};function G(C,R,F,q,ie){for(;F<C;)R=R<<8|yt(q,ie),F+=8;F-=C,U.l=R>>F&(1<<C)-1,U.c=R,U.lc=F}const W=new Array(59);function Y(C){for(let F=0;F<=58;++F)W[F]=0;for(let F=0;F<65537;++F)W[C[F]]+=1;let R=0;for(let F=58;F>0;--F){const q=R+W[F]>>1;W[F]=R,R=q}for(let F=0;F<65537;++F){const q=C[F];q>0&&(C[F]=q|W[q]++<<6)}}function D(C,R,F,q,ie,$){const fe=R;let me=0,ve=0;for(;q<=ie;q++){if(fe.value-R.value>F)return!1;G(6,me,ve,C,fe);const he=U.l;if(me=U.c,ve=U.lc,$[q]=he,he==63){if(fe.value-R.value>F)throw new Error("Something wrong with hufUnpackEncTable");G(8,me,ve,C,fe);let ge=U.l+6;if(me=U.c,ve=U.lc,q+ge>ie+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ge--;)$[q++]=0;q--}else if(he>=59){let ge=he-59+2;if(q+ge>ie+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ge--;)$[q++]=0;q--}}Y($)}function L(C){return C&63}function V(C){return C>>6}function te(C,R,F,q){for(;R<=F;R++){const ie=V(C[R]),$=L(C[R]);if(ie>>$)throw new Error("Invalid table entry");if($>14){const fe=q[ie>>$-14];if(fe.len)throw new Error("Invalid table entry");if(fe.lit++,fe.p){const me=fe.p;fe.p=new Array(fe.lit);for(let ve=0;ve<fe.lit-1;++ve)fe.p[ve]=me[ve]}else fe.p=new Array(1);fe.p[fe.lit-1]=R}else if($){let fe=0;for(let me=1<<14-$;me>0;me--){const ve=q[(ie<<14-$)+fe];if(ve.len||ve.p)throw new Error("Invalid table entry");ve.len=$,ve.lit=R,fe++}}}return!0}const K={c:0,lc:0};function ue(C,R,F,q){C=C<<8|yt(F,q),R+=8,K.c=C,K.lc=R}const de={c:0,lc:0};function _e(C,R,F,q,ie,$,fe,me,ve){if(C==R){q<8&&(ue(F,q,ie,$),F=K.c,q=K.lc),q-=8;let he=F>>q;if(he=new Uint8Array([he])[0],me.value+he>ve)return!1;const ge=fe[me.value-1];for(;he-- >0;)fe[me.value++]=ge}else if(me.value<ve)fe[me.value++]=C;else return!1;de.c=F,de.lc=q}function Ee(C){return C&65535}function Xe(C){const R=Ee(C);return R>32767?R-65536:R}const Me={a:0,b:0};function Ke(C,R){const F=Xe(C),ie=Xe(R),$=F+(ie&1)+(ie>>1),fe=$,me=$-ie;Me.a=fe,Me.b=me}function Pt(C,R){const F=Ee(C),q=Ee(R),ie=F-(q>>1)&65535,$=q+ie-32768&65535;Me.a=$,Me.b=ie}function Tt(C,R,F,q,ie,$,fe){const me=fe<16384,ve=F>ie?ie:F;let he=1,ge,ke;for(;he<=ve;)he<<=1;for(he>>=1,ge=he,he>>=1;he>=1;){ke=0;const Re=ke+$*(ie-ge),Ye=$*he,nt=$*ge,Le=q*he,Qe=q*ge;let ot,Ii,Mi,_r;for(;ke<=Re;ke+=nt){let ii=ke;const wt=ke+q*(F-ge);for(;ii<=wt;ii+=Qe){const en=ii+Le,Kr=ii+Ye,dn=Kr+Le;me?(Ke(C[ii+R],C[Kr+R]),ot=Me.a,Mi=Me.b,Ke(C[en+R],C[dn+R]),Ii=Me.a,_r=Me.b,Ke(ot,Ii),C[ii+R]=Me.a,C[en+R]=Me.b,Ke(Mi,_r),C[Kr+R]=Me.a,C[dn+R]=Me.b):(Pt(C[ii+R],C[Kr+R]),ot=Me.a,Mi=Me.b,Pt(C[en+R],C[dn+R]),Ii=Me.a,_r=Me.b,Pt(ot,Ii),C[ii+R]=Me.a,C[en+R]=Me.b,Pt(Mi,_r),C[Kr+R]=Me.a,C[dn+R]=Me.b)}if(F&he){const en=ii+Ye;me?Ke(C[ii+R],C[en+R]):Pt(C[ii+R],C[en+R]),ot=Me.a,C[en+R]=Me.b,C[ii+R]=ot}}if(ie&he){let ii=ke;const wt=ke+q*(F-ge);for(;ii<=wt;ii+=Qe){const en=ii+Le;me?Ke(C[ii+R],C[en+R]):Pt(C[ii+R],C[en+R]),ot=Me.a,C[en+R]=Me.b,C[ii+R]=ot}}ge=he,he>>=1}return ke}function hi(C,R,F,q,ie,$,fe,me,ve){let he=0,ge=0;const ke=fe,Re=Math.trunc(q.value+(ie+7)/8);for(;q.value<Re;)for(ue(he,ge,F,q),he=K.c,ge=K.lc;ge>=14;){const nt=he>>ge-14&16383,Le=R[nt];if(Le.len)ge-=Le.len,_e(Le.lit,$,he,ge,F,q,me,ve,ke),he=de.c,ge=de.lc;else{if(!Le.p)throw new Error("hufDecode issues");let Qe;for(Qe=0;Qe<Le.lit;Qe++){const ot=L(C[Le.p[Qe]]);for(;ge<ot&&q.value<Re;)ue(he,ge,F,q),he=K.c,ge=K.lc;if(ge>=ot&&V(C[Le.p[Qe]])==(he>>ge-ot&(1<<ot)-1)){ge-=ot,_e(Le.p[Qe],$,he,ge,F,q,me,ve,ke),he=de.c,ge=de.lc;break}}if(Qe==Le.lit)throw new Error("hufDecode issues")}}const Ye=8-ie&7;for(he>>=Ye,ge-=Ye;ge>0;){const nt=R[he<<14-ge&16383];if(nt.len)ge-=nt.len,_e(nt.lit,$,he,ge,F,q,me,ve,ke),he=de.c,ge=de.lc;else throw new Error("hufDecode issues")}return!0}function Ei(C,R,F,q,ie,$){const fe={value:0},me=F.value,ve=zt(R,F),he=zt(R,F);F.value+=4;const ge=zt(R,F);if(F.value+=4,ve<0||ve>=65537||he<0||he>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const ke=new Array(65537),Re=new Array(16384);M(Re);const Ye=q-(F.value-me);if(D(C,F,Ye,ve,he,ke),ge>8*(q-(F.value-me)))throw new Error("Something wrong with hufUncompress");te(ke,ve,he,Re),hi(ke,Re,C,F,ge,he,$,ie,fe)}function Ps(C,R,F){for(let q=0;q<F;++q)R[q]=C[R[q]]}function Wr(C){for(let R=1;R<C.length;R++){const F=C[R-1]+C[R]-128;C[R]=F}}function ss(C,R){let F=0,q=Math.floor((C.length+1)/2),ie=0;const $=C.length-1;for(;!(ie>$||(R[ie++]=C[F++],ie>$));)R[ie++]=C[q++]}function Ar(C){let R=C.byteLength;const F=new Array;let q=0;const ie=new DataView(C);for(;R>0;){const $=ie.getInt8(q++);if($<0){const fe=-$;R-=fe+1;for(let me=0;me<fe;me++)F.push(ie.getUint8(q++))}else{const fe=$;R-=2;const me=ie.getUint8(q++);for(let ve=0;ve<fe+1;ve++)F.push(me)}}return F}function qr(C,R,F,q,ie,$){let fe=new DataView($.buffer);const me=F[C.idx[0]].width,ve=F[C.idx[0]].height,he=3,ge=Math.floor(me/8),ke=Math.ceil(me/8),Re=Math.ceil(ve/8),Ye=me-(ke-1)*8,nt=ve-(Re-1)*8,Le={value:0},Qe=new Array(he),ot=new Array(he),Ii=new Array(he),Mi=new Array(he),_r=new Array(he);for(let wt=0;wt<he;++wt)_r[wt]=R[C.idx[wt]],Qe[wt]=wt<1?0:Qe[wt-1]+ke*Re,ot[wt]=new Float32Array(64),Ii[wt]=new Uint16Array(64),Mi[wt]=new Uint16Array(ke*64);for(let wt=0;wt<Re;++wt){let en=8;wt==Re-1&&(en=nt);let Kr=8;for(let Ft=0;Ft<ke;++Ft){Ft==ke-1&&(Kr=Ye);for(let Yt=0;Yt<he;++Yt)Ii[Yt].fill(0),Ii[Yt][0]=ie[Qe[Yt]++],Xr(Le,q,Ii[Yt]),Ro(Ii[Yt],ot[Yt]),Bo(ot[Yt]);Yr(ot);for(let Yt=0;Yt<he;++Yt)vr(ot[Yt],Mi[Yt],Ft*64)}let dn=0;for(let Ft=0;Ft<he;++Ft){const Yt=F[C.idx[Ft]].type;for(let gl=8*wt;gl<8*wt+en;++gl){dn=_r[Ft][gl];for(let ap=0;ap<ge;++ap){const ha=ap*64+(gl&7)*8;fe.setUint16(dn+0*2*Yt,Mi[Ft][ha+0],!0),fe.setUint16(dn+1*2*Yt,Mi[Ft][ha+1],!0),fe.setUint16(dn+2*2*Yt,Mi[Ft][ha+2],!0),fe.setUint16(dn+3*2*Yt,Mi[Ft][ha+3],!0),fe.setUint16(dn+4*2*Yt,Mi[Ft][ha+4],!0),fe.setUint16(dn+5*2*Yt,Mi[Ft][ha+5],!0),fe.setUint16(dn+6*2*Yt,Mi[Ft][ha+6],!0),fe.setUint16(dn+7*2*Yt,Mi[Ft][ha+7],!0),dn+=8*2*Yt}}if(ge!=ke)for(let gl=8*wt;gl<8*wt+en;++gl){const ap=_r[Ft][gl]+8*ge*2*Yt,ha=ge*64+(gl&7)*8;for(let nA=0;nA<Kr;++nA)fe.setUint16(ap+nA*2*Yt,Mi[Ft][ha+nA],!0)}}}const ii=new Uint16Array(me);fe=new DataView($.buffer);for(let wt=0;wt<he;++wt){F[C.idx[wt]].decoded=!0;const en=F[C.idx[wt]].type;if(F[wt].type==2)for(let Kr=0;Kr<ve;++Kr){const dn=_r[wt][Kr];for(let Ft=0;Ft<me;++Ft)ii[Ft]=fe.getUint16(dn+Ft*2*en,!0);for(let Ft=0;Ft<me;++Ft)fe.setFloat32(dn+Ft*2*en,J(ii[Ft]),!0)}}}function Xr(C,R,F){let q,ie=1;for(;ie<64;)q=R[C.value],q==65280?ie=64:q>>8==255?ie+=q&255:(F[ie]=q,ie++),C.value++}function Ro(C,R){R[0]=J(C[0]),R[1]=J(C[1]),R[2]=J(C[5]),R[3]=J(C[6]),R[4]=J(C[14]),R[5]=J(C[15]),R[6]=J(C[27]),R[7]=J(C[28]),R[8]=J(C[2]),R[9]=J(C[4]),R[10]=J(C[7]),R[11]=J(C[13]),R[12]=J(C[16]),R[13]=J(C[26]),R[14]=J(C[29]),R[15]=J(C[42]),R[16]=J(C[3]),R[17]=J(C[8]),R[18]=J(C[12]),R[19]=J(C[17]),R[20]=J(C[25]),R[21]=J(C[30]),R[22]=J(C[41]),R[23]=J(C[43]),R[24]=J(C[9]),R[25]=J(C[11]),R[26]=J(C[18]),R[27]=J(C[24]),R[28]=J(C[31]),R[29]=J(C[40]),R[30]=J(C[44]),R[31]=J(C[53]),R[32]=J(C[10]),R[33]=J(C[19]),R[34]=J(C[23]),R[35]=J(C[32]),R[36]=J(C[39]),R[37]=J(C[45]),R[38]=J(C[52]),R[39]=J(C[54]),R[40]=J(C[20]),R[41]=J(C[22]),R[42]=J(C[33]),R[43]=J(C[38]),R[44]=J(C[46]),R[45]=J(C[51]),R[46]=J(C[55]),R[47]=J(C[60]),R[48]=J(C[21]),R[49]=J(C[34]),R[50]=J(C[37]),R[51]=J(C[47]),R[52]=J(C[50]),R[53]=J(C[56]),R[54]=J(C[59]),R[55]=J(C[61]),R[56]=J(C[35]),R[57]=J(C[36]),R[58]=J(C[48]),R[59]=J(C[49]),R[60]=J(C[57]),R[61]=J(C[58]),R[62]=J(C[62]),R[63]=J(C[63])}function Bo(C){const R=.5*Math.cos(.7853975),F=.5*Math.cos(3.14159/16),q=.5*Math.cos(3.14159/8),ie=.5*Math.cos(3*3.14159/16),$=.5*Math.cos(5*3.14159/16),fe=.5*Math.cos(3*3.14159/8),me=.5*Math.cos(7*3.14159/16),ve=new Array(4),he=new Array(4),ge=new Array(4),ke=new Array(4);for(let Re=0;Re<8;++Re){const Ye=Re*8;ve[0]=q*C[Ye+2],ve[1]=fe*C[Ye+2],ve[2]=q*C[Ye+6],ve[3]=fe*C[Ye+6],he[0]=F*C[Ye+1]+ie*C[Ye+3]+$*C[Ye+5]+me*C[Ye+7],he[1]=ie*C[Ye+1]-me*C[Ye+3]-F*C[Ye+5]-$*C[Ye+7],he[2]=$*C[Ye+1]-F*C[Ye+3]+me*C[Ye+5]+ie*C[Ye+7],he[3]=me*C[Ye+1]-$*C[Ye+3]+ie*C[Ye+5]-F*C[Ye+7],ge[0]=R*(C[Ye+0]+C[Ye+4]),ge[3]=R*(C[Ye+0]-C[Ye+4]),ge[1]=ve[0]+ve[3],ge[2]=ve[1]-ve[2],ke[0]=ge[0]+ge[1],ke[1]=ge[3]+ge[2],ke[2]=ge[3]-ge[2],ke[3]=ge[0]-ge[1],C[Ye+0]=ke[0]+he[0],C[Ye+1]=ke[1]+he[1],C[Ye+2]=ke[2]+he[2],C[Ye+3]=ke[3]+he[3],C[Ye+4]=ke[3]-he[3],C[Ye+5]=ke[2]-he[2],C[Ye+6]=ke[1]-he[1],C[Ye+7]=ke[0]-he[0]}for(let Re=0;Re<8;++Re)ve[0]=q*C[16+Re],ve[1]=fe*C[16+Re],ve[2]=q*C[48+Re],ve[3]=fe*C[48+Re],he[0]=F*C[8+Re]+ie*C[24+Re]+$*C[40+Re]+me*C[56+Re],he[1]=ie*C[8+Re]-me*C[24+Re]-F*C[40+Re]-$*C[56+Re],he[2]=$*C[8+Re]-F*C[24+Re]+me*C[40+Re]+ie*C[56+Re],he[3]=me*C[8+Re]-$*C[24+Re]+ie*C[40+Re]-F*C[56+Re],ge[0]=R*(C[Re]+C[32+Re]),ge[3]=R*(C[Re]-C[32+Re]),ge[1]=ve[0]+ve[3],ge[2]=ve[1]-ve[2],ke[0]=ge[0]+ge[1],ke[1]=ge[3]+ge[2],ke[2]=ge[3]-ge[2],ke[3]=ge[0]-ge[1],C[0+Re]=ke[0]+he[0],C[8+Re]=ke[1]+he[1],C[16+Re]=ke[2]+he[2],C[24+Re]=ke[3]+he[3],C[32+Re]=ke[3]-he[3],C[40+Re]=ke[2]-he[2],C[48+Re]=ke[1]-he[1],C[56+Re]=ke[0]-he[0]}function Yr(C){for(let R=0;R<64;++R){const F=C[0][R],q=C[1][R],ie=C[2][R];C[0][R]=F+1.5747*ie,C[1][R]=F-.1873*q-.4682*ie,C[2][R]=F+1.8556*q}}function vr(C,R,F){for(let q=0;q<64;++q)R[F+q]=kd.toHalfFloat(Dn(C[q]))}function Dn(C){return C<=1?Math.sign(C)*Math.pow(Math.abs(C),2.2):Math.sign(C)*Math.pow(P,Math.abs(C)-1)}function er(C){return new DataView(C.array.buffer,C.offset.value,C.size)}function yr(C){const R=C.viewer.buffer.slice(C.offset.value,C.offset.value+C.size),F=new Uint8Array(Ar(R)),q=new Uint8Array(F.length);return Wr(F),ss(F,q),new DataView(q.buffer)}function rs(C){const R=C.array.slice(C.offset.value,C.offset.value+C.size),F=Wp(R),q=new Uint8Array(F.length);return Wr(F),ss(F,q),new DataView(q.buffer)}function Ms(C){const R=C.viewer,F={value:C.offset.value},q=new Uint16Array(C.width*C.scanlineBlockSize*(C.channels*C.type)),ie=new Uint8Array(8192);let $=0;const fe=new Array(C.channels);for(let nt=0;nt<C.channels;nt++)fe[nt]={},fe[nt].start=$,fe[nt].end=fe[nt].start,fe[nt].nx=C.width,fe[nt].ny=C.lines,fe[nt].size=C.type,$+=fe[nt].nx*fe[nt].ny*fe[nt].size;const me=it(R,F),ve=it(R,F);if(ve>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(me<=ve)for(let nt=0;nt<ve-me+1;nt++)ie[nt+me]=pl(R,F);const he=new Uint16Array(65536),ge=B(ie,he),ke=zt(R,F);Ei(C.array,R,F,ke,q,$);for(let nt=0;nt<C.channels;++nt){const Le=fe[nt];for(let Qe=0;Qe<fe[nt].size;++Qe)Tt(q,Le.start+Qe,Le.nx,Le.size,Le.ny,Le.nx*Le.size,ge)}Ps(he,q,$);let Re=0;const Ye=new Uint8Array(q.buffer.byteLength);for(let nt=0;nt<C.lines;nt++)for(let Le=0;Le<C.channels;Le++){const Qe=fe[Le],ot=Qe.nx*Qe.size,Ii=new Uint8Array(q.buffer,Qe.end*2,ot*2);Ye.set(Ii,Re),Re+=ot*2,Qe.end+=ot}return new DataView(Ye.buffer)}function ks(C){const R=C.array.slice(C.offset.value,C.offset.value+C.size),F=Wp(R),q=C.lines*C.channels*C.width,ie=C.type==1?new Uint16Array(q):new Uint32Array(q);let $=0,fe=0;const me=new Array(4);for(let ve=0;ve<C.lines;ve++)for(let he=0;he<C.channels;he++){let ge=0;switch(C.type){case 1:me[0]=$,me[1]=me[0]+C.width,$=me[1]+C.width;for(let ke=0;ke<C.width;++ke){const Re=F[me[0]++]<<8|F[me[1]++];ge+=Re,ie[fe]=ge,fe++}break;case 2:me[0]=$,me[1]=me[0]+C.width,me[2]=me[1]+C.width,$=me[2]+C.width;for(let ke=0;ke<C.width;++ke){const Re=F[me[0]++]<<24|F[me[1]++]<<16|F[me[2]++]<<8;ge+=Re,ie[fe]=ge,fe++}break}}return new DataView(ie.buffer)}function On(C){const R=C.viewer,F={value:C.offset.value},q=new Uint8Array(C.width*C.lines*(C.channels*C.type*2)),ie={version:$i(R,F),unknownUncompressedSize:$i(R,F),unknownCompressedSize:$i(R,F),acCompressedSize:$i(R,F),dcCompressedSize:$i(R,F),rleCompressedSize:$i(R,F),rleUncompressedSize:$i(R,F),rleRawSize:$i(R,F),totalAcUncompressedCount:$i(R,F),totalDcUncompressedCount:$i(R,F),acCompression:$i(R,F)};if(ie.version<2)throw new Error("EXRLoader.parse: "+op.compression+" version "+ie.version+" is unsupported");const $=new Array;let fe=it(R,F)-2;for(;fe>0;){const Le=Zi(R.buffer,F),Qe=pl(R,F),ot=Qe>>2&3,Ii=(Qe>>4)-1,Mi=new Int8Array([Ii])[0],_r=pl(R,F);$.push({name:Le,index:Mi,type:_r,compression:ot}),fe-=Le.length+3}const me=op.channels,ve=new Array(C.channels);for(let Le=0;Le<C.channels;++Le){const Qe=ve[Le]={},ot=me[Le];Qe.name=ot.name,Qe.compression=0,Qe.decoded=!1,Qe.type=ot.pixelType,Qe.pLinear=ot.pLinear,Qe.width=C.width,Qe.height=C.lines}const he={idx:new Array(3)};for(let Le=0;Le<C.channels;++Le){const Qe=ve[Le];for(let ot=0;ot<$.length;++ot){const Ii=$[ot];Qe.name==Ii.name&&(Qe.compression=Ii.compression,Ii.index>=0&&(he.idx[Ii.index]=Le),Qe.offset=Le)}}let ge,ke,Re;if(ie.acCompressedSize>0)switch(ie.acCompression){case 0:ge=new Uint16Array(ie.totalAcUncompressedCount),Ei(C.array,R,F,ie.acCompressedSize,ge,ie.totalAcUncompressedCount);break;case 1:const Le=C.array.slice(F.value,F.value+ie.totalAcUncompressedCount),Qe=Wp(Le);ge=new Uint16Array(Qe.buffer),F.value+=ie.totalAcUncompressedCount;break}if(ie.dcCompressedSize>0){const Le={array:C.array,offset:F,size:ie.dcCompressedSize};ke=new Uint16Array(rs(Le).buffer),F.value+=ie.dcCompressedSize}if(ie.rleRawSize>0){const Le=C.array.slice(F.value,F.value+ie.rleCompressedSize),Qe=Wp(Le);Re=Ar(Qe.buffer),F.value+=ie.rleCompressedSize}let Ye=0;const nt=new Array(ve.length);for(let Le=0;Le<nt.length;++Le)nt[Le]=new Array;for(let Le=0;Le<C.lines;++Le)for(let Qe=0;Qe<ve.length;++Qe)nt[Qe].push(Ye),Ye+=ve[Qe].width*C.type*2;qr(he,nt,ve,ge,ke,q);for(let Le=0;Le<ve.length;++Le){const Qe=ve[Le];if(!Qe.decoded)switch(Qe.compression){case 2:let ot=0,Ii=0;for(let Mi=0;Mi<C.lines;++Mi){let _r=nt[Le][ot];for(let ii=0;ii<Qe.width;++ii){for(let wt=0;wt<2*Qe.type;++wt)q[_r++]=Re[Ii+wt*Qe.width*Qe.height];Ii++}ot++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(q.buffer)}function Zi(C,R){const F=new Uint8Array(C);let q=0;for(;F[R.value+q]!=0;)q+=1;const ie=new TextDecoder().decode(F.slice(R.value,R.value+q));return R.value=R.value+q+1,ie}function os(C,R,F){const q=new TextDecoder().decode(new Uint8Array(C).slice(R.value,R.value+F));return R.value=R.value+F,q}function tr(C,R){const F=un(C,R),q=zt(C,R);return[F,q]}function as(C,R){const F=zt(C,R),q=zt(C,R);return[F,q]}function un(C,R){const F=C.getInt32(R.value,!0);return R.value=R.value+4,F}function zt(C,R){const F=C.getUint32(R.value,!0);return R.value=R.value+4,F}function yt(C,R){const F=C[R.value];return R.value=R.value+1,F}function pl(C,R){const F=C.getUint8(R.value);return R.value=R.value+1,F}const $i=function(C,R){let F;return"getBigInt64"in DataView.prototype?F=Number(C.getBigInt64(R.value,!0)):F=C.getUint32(R.value+4,!0)+Number(C.getUint32(R.value,!0)<<32),R.value+=8,F};function Ln(C,R){const F=C.getFloat32(R.value,!0);return R.value+=4,F}function z(C,R){return kd.toHalfFloat(Ln(C,R))}function J(C){const R=(C&31744)>>10,F=C&1023;return(C>>15?-1:1)*(R?R===31?F?NaN:1/0:Math.pow(2,R-15)*(1+F/1024):6103515625e-14*(F/1024))}function it(C,R){const F=C.getUint16(R.value,!0);return R.value+=2,F}function Qt(C,R){return J(it(C,R))}function Ds(C,R,F,q){const ie=F.value,$=[];for(;F.value<ie+q-1;){const fe=Zi(R,F),me=un(C,F),ve=pl(C,F);F.value+=3;const he=un(C,F),ge=un(C,F);$.push({name:fe,pixelType:me,pLinear:ve,xSampling:he,ySampling:ge})}return F.value+=1,$}function br(C,R){const F=Ln(C,R),q=Ln(C,R),ie=Ln(C,R),$=Ln(C,R),fe=Ln(C,R),me=Ln(C,R),ve=Ln(C,R),he=Ln(C,R);return{redX:F,redY:q,greenX:ie,greenY:$,blueX:fe,blueY:me,whiteX:ve,whiteY:he}}function ir(C,R){const F=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],q=pl(C,R);return F[q]}function f1(C,R){const F=zt(C,R),q=zt(C,R),ie=zt(C,R),$=zt(C,R);return{xMin:F,yMin:q,xMax:ie,yMax:$}}function Eb(C,R){const F=["INCREASING_Y"],q=pl(C,R);return F[q]}function rd(C,R){const F=Ln(C,R),q=Ln(C,R);return[F,q]}function Po(C,R){const F=Ln(C,R),q=Ln(C,R),ie=Ln(C,R);return[F,q,ie]}function Mo(C,R,F,q,ie){if(q==="string"||q==="stringvector"||q==="iccProfile")return os(R,F,ie);if(q==="chlist")return Ds(C,R,F,ie);if(q==="chromaticities")return br(C,F);if(q==="compression")return ir(C,F);if(q==="box2i")return f1(C,F);if(q==="lineOrder")return Eb(C,F);if(q==="float")return Ln(C,F);if(q==="v2f")return rd(C,F);if(q==="v3f")return Po(C,F);if(q==="int")return un(C,F);if(q==="rational")return tr(C,F);if(q==="timecode")return as(C,F);if(q==="preview")return F.value+=ie,"skipped";F.value+=ie}function Bh(C,R,F){const q={};if(C.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");q.version=C.getUint8(4);const ie=C.getUint8(5);q.spec={singleTile:!!(ie&2),longName:!!(ie&4),deepFormat:!!(ie&8),multiPart:!!(ie&16)},F.value=8;let $=!0;for(;$;){const fe=Zi(R,F);if(fe==0)$=!1;else{const me=Zi(R,F),ve=zt(C,F),he=Mo(C,R,F,me,ve);he===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${me}'.`):q[fe]=he}}if(ie&-5)throw console.error("THREE.EXRHeader:",q),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return q}function ko(C,R,F,q,ie){const $={size:0,viewer:R,array:F,offset:q,width:C.dataWindow.xMax-C.dataWindow.xMin+1,height:C.dataWindow.yMax-C.dataWindow.yMin+1,channels:C.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:C.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:zi};switch(C.compression){case"NO_COMPRESSION":$.lines=1,$.uncompress=er;break;case"RLE_COMPRESSION":$.lines=1,$.uncompress=yr;break;case"ZIPS_COMPRESSION":$.lines=1,$.uncompress=rs;break;case"ZIP_COMPRESSION":$.lines=16,$.uncompress=rs;break;case"PIZ_COMPRESSION":$.lines=32,$.uncompress=Ms;break;case"PXR24_COMPRESSION":$.lines=16,$.uncompress=ks;break;case"DWAA_COMPRESSION":$.lines=32,$.uncompress=On;break;case"DWAB_COMPRESSION":$.lines=256,$.uncompress=On;break;default:throw new Error("EXRLoader.parse: "+C.compression+" is unsupported")}if($.scanlineBlockSize=$.lines,$.type==1)switch(ie){case Ao:$.getter=Qt,$.inputSize=2;break;case $n:$.getter=it,$.inputSize=2;break}else if($.type==2)switch(ie){case Ao:$.getter=Ln,$.inputSize=4;break;case $n:$.getter=z,$.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+$.type+" for "+C.compression+".");$.blockCount=(C.dataWindow.yMax+1)/$.scanlineBlockSize;for(let me=0;me<$.blockCount;me++)$i(R,q);$.outputChannels=$.channels==3?4:$.channels;const fe=$.width*$.height*$.outputChannels;switch(ie){case Ao:$.byteArray=new Float32Array(fe),$.channels<$.outputChannels&&$.byteArray.fill(1,0,fe);break;case $n:$.byteArray=new Uint16Array(fe),$.channels<$.outputChannels&&$.byteArray.fill(15360,0,fe);break;default:console.error("THREE.EXRLoader: unsupported type: ",ie);break}return $.bytesPerLine=$.width*$.inputSize*$.channels,$.outputChannels==4?($.format=qi,$.colorSpace=zi):($.format=qc,$.colorSpace=xu),$}const ca=new DataView(i),od=new Uint8Array(i),_c={value:0},op=Bh(ca,i,_c),gt=ko(op,ca,od,_c,this.type),p1={value:0},UL={R:0,G:1,B:2,A:3,Y:0};for(let C=0;C<gt.height/gt.scanlineBlockSize;C++){const R=zt(ca,_c);gt.size=zt(ca,_c),gt.lines=R+gt.scanlineBlockSize>gt.height?gt.height-R:gt.scanlineBlockSize;const q=gt.size<gt.lines*gt.bytesPerLine?gt.uncompress(gt):er(gt);_c.value+=gt.size;for(let ie=0;ie<gt.scanlineBlockSize;ie++){const $=ie+C*gt.scanlineBlockSize;if($>=gt.height)break;for(let fe=0;fe<gt.channels;fe++){const me=UL[op.channels[fe].name];for(let ve=0;ve<gt.width;ve++){p1.value=(ie*(gt.channels*gt.width)+fe*gt.width+ve)*gt.inputSize;const he=(gt.height-1-$)*(gt.width*gt.outputChannels)+ve*gt.outputChannels+me;gt.byteArray[he]=gt.getter(q,p1)}}}}return{header:op,width:gt.width,height:gt.height,data:gt.byteArray,format:gt.format,colorSpace:gt.colorSpace,type:this.type}}setDataType(i){return this.type=i,this}load(i,t,n,r){function o(a,l){a.colorSpace=l.colorSpace,a.minFilter=Mt,a.magFilter=Mt,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,l)}return super.load(i,o,n,r)}}const lH=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:sm},Symbol.toStringTag,{value:"Module"}));class uy extends LP{constructor(i){super(i),this.type=$n}parse(i){const a=function(T,P){switch(T){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},d=`
`,f=function(T,P,B){P=P||1024;let U=T.pos,G=-1,W=0,Y="",D=String.fromCharCode.apply(null,new Uint16Array(T.subarray(U,U+128)));for(;0>(G=D.indexOf(d))&&W<P&&U<T.byteLength;)Y+=D,W+=D.length,U+=128,D+=String.fromCharCode.apply(null,new Uint16Array(T.subarray(U,U+128)));return-1<G?(B!==!1&&(T.pos+=W+G+1),Y+D.slice(0,G)):!1},p=function(T){const P=/^#\?(\S+)/,B=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,W={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,D;for((T.pos>=T.byteLength||!(Y=f(T)))&&a(1,"no header found"),(D=Y.match(P))||a(3,"bad initial token"),W.valid|=1,W.programtype=D[1],W.string+=Y+`
`;Y=f(T),Y!==!1;){if(W.string+=Y+`
`,Y.charAt(0)==="#"){W.comments+=Y+`
`;continue}if((D=Y.match(B))&&(W.gamma=parseFloat(D[1])),(D=Y.match(M))&&(W.exposure=parseFloat(D[1])),(D=Y.match(U))&&(W.valid|=2,W.format=D[1]),(D=Y.match(G))&&(W.valid|=4,W.height=parseInt(D[1],10),W.width=parseInt(D[2],10)),W.valid&2&&W.valid&4)break}return W.valid&2||a(3,"missing format specifier"),W.valid&4||a(3,"missing image size specifier"),W},g=function(T,P,B){const M=P;if(M<8||M>32767||T[0]!==2||T[1]!==2||T[2]&128)return new Uint8Array(T);M!==(T[2]<<8|T[3])&&a(3,"wrong scanline width");const U=new Uint8Array(4*P*B);U.length||a(4,"unable to allocate buffer space");let G=0,W=0;const Y=4*M,D=new Uint8Array(4),L=new Uint8Array(Y);let V=B;for(;V>0&&W<T.byteLength;){W+4>T.byteLength&&a(1),D[0]=T[W++],D[1]=T[W++],D[2]=T[W++],D[3]=T[W++],(D[0]!=2||D[1]!=2||(D[2]<<8|D[3])!=M)&&a(3,"bad rgbe scanline format");let te=0,K;for(;te<Y&&W<T.byteLength;){K=T[W++];const de=K>128;if(de&&(K-=128),(K===0||te+K>Y)&&a(3,"bad scanline data"),de){const _e=T[W++];for(let Ee=0;Ee<K;Ee++)L[te++]=_e}else L.set(T.subarray(W,W+K),te),te+=K,W+=K}const ue=M;for(let de=0;de<ue;de++){let _e=0;U[G]=L[de+_e],_e+=M,U[G+1]=L[de+_e],_e+=M,U[G+2]=L[de+_e],_e+=M,U[G+3]=L[de+_e],G+=4}V--}return U},m=function(T,P,B,M){const U=T[P+3],G=Math.pow(2,U-128)/255;B[M+0]=T[P+0]*G,B[M+1]=T[P+1]*G,B[M+2]=T[P+2]*G,B[M+3]=1},A=function(T,P,B,M){const U=T[P+3],G=Math.pow(2,U-128)/255;B[M+0]=kd.toHalfFloat(Math.min(T[P+0]*G,65504)),B[M+1]=kd.toHalfFloat(Math.min(T[P+1]*G,65504)),B[M+2]=kd.toHalfFloat(Math.min(T[P+2]*G,65504)),B[M+3]=kd.toHalfFloat(1)},y=new Uint8Array(i);y.pos=0;const b=p(y),_=b.width,w=b.height,S=g(y.subarray(y.pos),_,w);let E,I,k;switch(this.type){case Ao:k=S.length/4;const T=new Float32Array(k*4);for(let B=0;B<k;B++)m(S,B*4,T,B*4);E=T,I=Ao;break;case $n:k=S.length/4;const P=new Uint16Array(k*4);for(let B=0;B<k;B++)A(S,B*4,P,B*4);E=P,I=$n;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:_,height:w,data:E,header:b.string,gamma:b.gamma,exposure:b.exposure,type:I}}setDataType(i){return this.type=i,this}load(i,t,n,r){function o(a,l){switch(a.type){case Ao:case $n:a.colorSpace=zi,a.minFilter=Mt,a.magFilter=Mt,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,l)}return super.load(i,o,n,r)}}const cH=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:uy},Symbol.toStringTag,{value:"Module"})),OT="NEEDLE_lightmaps",_p=Q("debuglightmapsextension")||Q("debuglightmaps");var Gl;(function(s){s[s.Lightmap=0]="Lightmap",s[s.Skybox=1]="Skybox",s[s.Reflection=2]="Reflection"})(Gl||(Gl={}));class hH{constructor(i,t,n){h(this,"parser");h(this,"registry");h(this,"source");this.parser=i,this.registry=t,this.source=n}get name(){return OT}afterRoot(i){const t=this.parser.json.extensions;if(t){const n=t[OT];if(n){const r=n.textures;return r!=null&&r.length?(_p&&console.log(n),new Promise(async(o,a)=>{const l=[];for(const u of r)if(u.pointer){_p&&console.log(u);let d=null;if(u.pointer.startsWith("/textures/"))_p&&console.log("Load texture from gltf",u.pointer),d=OS(this.parser,u.pointer).then(f=>this.resolveTexture(u,f));else if(typeof u.pointer=="string"){_p&&console.log("Load texture from path",u.pointer);const f=Ou(this.source,u.pointer);let p;f.endsWith(".exr")?p=new sm(this.parser.options.manager):f.endsWith(".hdr")?p=new uy(this.parser.options.manager):p=new Xa(this.parser.options.manager),d=p.loadAsync(f,void 0).then(g=>this.resolveTexture(u,g))}else u.pointer;d&&l.push(d)}const c=await NC(l);c!=null&&c.anyFailed&&be()&&console.error("Failed to load lightmap extension",c),o()})):null}}return null}resolveTexture(i,t){const n=t;_p&&console.log("Lightmap loaded:",n),n!=null&&n.isTexture&&(this.registry?(n.colorSpace=zi,this.registry.registerTexture(this.source,i.type,n,i.index)):console.log(Gl[i.type],i.pointer,n))}}const LT=!!Q("debuglightmaps");class uH{constructor(i){h(this,"_context");h(this,"_lightmaps",new Map);this._context=i}clear(){this._lightmaps.clear()}registerTexture(i,t,n,r){LT&&console.log("Registering ",Gl[t]+' "'+i+'"',n),this._lightmaps.has(i)||this._lightmaps.set(i,new Map);const o=this._lightmaps.get(i),a=(o==null?void 0:o.get(t))??[];a.length<r&&(a.length=r+1),a[r]=n,o==null||o.set(t,a)}tryGetLightmap(i,t=0){return this.tryGet(i,Gl.Lightmap,t)}tryGetSkybox(i){return this.tryGet(i,Gl.Skybox,0)}tryGetReflection(i){return this.tryGet(i,Gl.Reflection,0)}tryGet(i,t,n){if(!i)return LT&&console.warn("Missing source id"),null;const r=this._lightmaps.get(i);if(!r)return null;const o=r.get(t);return o===void 0||!(o!=null&&o.length)||o.length<=n?null:o[n]}}Vs.lights_fragment_maps=Vs.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Vs.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Vs.lights_fragment_begin=Vs.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);Vn.lightmap.lightmapScaleOffset={value:new Ue(1,1,0,0)};const I_=Q("debugprogressive"),RA=new Cn,BA=new hc;class dH{constructor(i){h(this,"context");h(this,"_lodsManager");this.context=i}get manager(){return this._lodsManager}get targetTriangleDensity(){var i;return((i=this._lodsManager)==null?void 0:i.targetTriangleDensity)??-1}set targetTriangleDensity(i){this._lodsManager&&(this._lodsManager.targetTriangleDensity=i)}setRenderer(i){var t;(t=this._lodsManager)==null||t.disable(),Xh.removePlugin(this),Xh.addPlugin(this),Xh.debugDrawLine=Pe.DrawLine,this._lodsManager=Xh.get(i),this._lodsManager.enable()}onAfterUpdatedLOD(i,t,n,r,o){I_&&this.onRenderDebug(n,r,o)}onRenderDebug(i,t,n){var l,c,u;if(!t.geometry||!pt.hasLODLevelAvailable(t.geometry)&&!pt.hasLODLevelAvailable(t.material))return;const r=Xh.getObjectLODState(t);if(!r)return;let o=n.mesh_lod;const a=n.mesh_lod!=r.lastLodLevel_Mesh||n.texture_lod!=r.lastLodLevel_Texture;if(I_&&t.geometry.boundingSphere){const d=t.geometry.boundingSphere;BA.copy(d),BA.applyMatrix4(t.matrixWorld);const f=BA.center,p=BA.radius,g=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(a)Pe.DrawWireSphere(f,p,g[o],.1);else{const m=((l=t.geometry.index)==null?void 0:l.count)??0,A=(c=pt.getMeshLODInformation(t.geometry))==null?void 0:c.lods;o=A?Math.min((A==null?void 0:A.length)-1,o):0;let y="";if(A&&r.lastScreenCoverage>0)for(let w=0;w<A.length;w++){const S=A[w].density,E=w==A.length-1;y+=S.toFixed(0)+">"+(S/r.lastScreenCoverage).toFixed(0)+(E?"":",")}const b=A?(u=A[o])==null?void 0:u.density:-1;let _="LOD "+n.mesh_lod+`
TEX `+n.texture_lod;if(I_=="density"&&(_+=`
`+m+` tris
`+(b/r.lastScreenCoverage).toFixed(0)+` dens
`+(r.lastScreenCoverage*100).toFixed(1)+`% cov
`+(r.lastCentrality*100).toFixed(1)+`% centr
`+(RA.min.x.toFixed(2)+"-"+RA.max.x.toFixed(2)+"x"+RA.min.y.toFixed(2)+"-"+RA.max.y.toFixed(2))+" scr"),r.lastScreenCoverage>.1){const w=i,S=w.worldForward,E=w.worldPosition,k=Be(S).multiplyScalar(p*.7).add(f),T=k.distanceTo(E),P=g[Math.min(g.length-1,Math.max(0,o))]+"88",B=this.context.domHeight>0?screen.height/this.context.domHeight:1,M=i.isPerspectiveCamera?Math.tan(i.fov*Math.PI/180/2):1;Pe.DrawLabel(k,_,T*.012*B*M,void 0,16777215,P)}}}}}const fH=Q("debugplayerview");var Yl;(function(s){s.Browser="browser",s.Headset="headset",s.Handheld="handheld"})(Yl||(Yl={}));class pH{constructor(i,t){h(this,"userId");h(this,"context");h(this,"viewDevice",Yl.Browser);h(this,"removed",!1);h(this,"_object");this.userId=i,this.context=t}get currentObject(){return this._object}set currentObject(i){this._object=i}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class gH{constructor(i){h(this,"context");h(this,"playerViews",new Map);this.context=i}setPlayerView(i,t,n){let r=this.playerViews.get(i);r||(r=new pH(i,this.context),this.playerViews.set(i,r)),r.viewDevice=n,r.currentObject=t,r.removed=!1}getPlayerView(i){if(!i)return;if(!this.context.connection.userIsInRoom(i)){this.playerViews.delete(i);return}return this.playerViews.get(i)}removePlayerView(i,t){const n=this.playerViews.get(i);(n==null?void 0:n.viewDevice)===t&&(fH&&console.log("REMOVE",i),n.removed=!0,this.playerViews.delete(i))}}new Lr;const Bm=new Uint8Array(4);Bm[0]=255;Bm[1]=255;Bm[2]=255;Bm[3]=255;const mH=new Uf(Bm,1,1,qi);function VS(s,i=1){const t="alpha"in s,n=i*i,r=new Uint8Array(4*n),o=Math.floor(s.r*255),a=Math.floor(s.g*255),l=Math.floor(s.b*255);for(let u=0;u<n;u++){const d=u*4;r[d+0]=o,r[d+1]=a,r[d+2]=l,t?r[d+3]=Math.floor(s.alpha*255):r[d+3]=255}const c=new Uf(r,i,i);return c.needsUpdate=!0,c}function AH(s,i,t,n=1,r=3){const a=n*r,l=[s,i,t],c=l.length,u=new Uint8Array(4*c*a),d=new xe;for(let p=0;p<r;p++){const g=Math.floor(p/r*c),m=ye.clamp(g+1,0,c-1),A=l[g],y=l[m],b=p/r*c%1;d.lerpColors(A,y,b);const _=Math.floor(d.r*255),w=Math.floor(d.g*255),S=Math.floor(d.b*255);for(let E=0;E<n;E++){const I=(p*n+E)*4;u[I+0]=_,u[I+1]=w,u[I+2]=S,u[I+3]=255}}const f=new Uf(u,n,r);return f.needsUpdate=!0,f}var FT;(function(s){s[s.Vertex=0]="Vertex",s[s.Fragment=1]="Fragment"})(FT||(FT={}));function dy(s,i){const t=s.elements;i||(i=[]),i.length=0;for(let n=0;n<16;n+=4){const r=t[n],o=t[n+1],a=t[n+2],l=t[n+3],c=new Ue(r,o,a,l);i.push(c)}return i}const T_=[],UT=[];function vH(s,i){if(T_.length===0)for(let t=0;t<27;t++)T_.push(0);i||(i=T_);for(let t=0;t<27;t++)UT[t]=i[t];i=UT,s.unity_SHAr={value:new Ue(i[9],i[3],i[6],i[0])},s.unity_SHBr={value:new Ue(i[12],i[15],i[18],i[21])},s.unity_SHAg={value:new Ue(i[10],i[4],i[7],i[1])},s.unity_SHBg={value:new Ue(i[13],i[16],i[19],i[22])},s.unity_SHAb={value:new Ue(i[11],i[5],i[8],i[2])},s.unity_SHBb={value:new Ue(i[14],i[17],i[20],i[23])},s.unity_SHC={value:new Ue(i[24],i[25],i[26],1)}}class yH{constructor(i,t,n){h(this,"vertexShader");h(this,"fragmentShader");h(this,"technique");this.vertexShader=i,this.fragmentShader=t,this.technique=n}}async function bH(s,i){if(!s)return console.error("Can not find technique: no shader data"),null;const t=s.programs[i],n=t.vertexShader,r=t.fragmentShader;if(n!==void 0&&r!==void 0){const o=s.shaders[n],a=s.shaders[r];if(o.uri&&a.uri||o.code&&a.code){if(!o.code&&o.uri&&await NT(o),!a.code&&a.uri&&await NT(a),!o.code||!a.code)return null;const l=s.techniques[i];return new yH(o.code,a.code,l)}}return console.error("Shader technique not found",i),null}async function NT(s){const i=s.uri;if(i)if(i.endsWith(".glsl")){const n=await new Lr().loadAsync(i);s.code=n.toString()}else s.code=_H(s.uri)}function _H(s){return decodeURIComponent(Array.prototype.map.call(atob(s),function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Uo=Q("debugenvlight");var La;(function(s){s[s.Skybox=0]="Skybox",s[s.Trilight=1]="Trilight",s[s.Flat=3]="Flat",s[s.Custom=4]="Custom"})(La||(La={}));var rm;(function(s){s[s.Skybox=0]="Skybox",s[s.Custom=1]="Custom"})(rm||(rm={}));class wH{constructor(i){h(this,"context");h(this,"_currentLightSettingsId");h(this,"_sceneLightSettings");h(this,"_timevec4",new Ue);h(this,"__currentReflectionId",null);h(this,"_lighting",{});this.context=i,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const i=this.context.time;this._timevec4.x=i.time,this._timevec4.y=Math.sin(i.time),this._timevec4.z=Math.cos(i.time),this._timevec4.w=i.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const i=this._sceneLightSettings.get(this._currentLightSettingsId);return i?i.ambientIntensity:1}get sceneLightSettings(){var i;return(i=this._sceneLightSettings)==null?void 0:i.values()}enable(i){var n;i instanceof tt&&(i=i.uri);const t=(n=this._sceneLightSettings)==null?void 0:n.get(i);return t?(Uo&&console.log("Enable scene light settings",i,t),i!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=i,t.enabled=!0,!0):(Uo&&console.warn("No light settings found for",i),!1)}disable(i){var n;if(i instanceof tt&&(i=i.uri),i==null)return!1;const t=(n=this._sceneLightSettings)==null?void 0:n.get(i);return t?(Uo&&console.log("Disable scene light settings",i,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const i=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),i}return null}internalRegisterSceneLightSettings(i){const t=i.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",i);return}Uo&&console.log("Register "+(i==null?void 0:i.sourceId)+" lighting",i),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,i)}internalUnregisterSceneLightSettings(i){const t=i.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",i);return}Uo&&console.log("Unregister "+(i==null?void 0:i.sourceId)+" lighting",i),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(i,t){Uo&&console.log("Register reflection",i,t);const n=new xH(this.context,t,1);this._lighting[i]=n}internalGetReflection(i){return this._lighting[i]}internalEnableReflection(i){var n;this.__currentReflectionId=i;const t=(n=this._sceneLightSettings)==null?void 0:n.get(i);switch(Uo&&console.log("Enable reflection",i,t?La[t.ambientMode]:"Unknown ambient mode",t),t==null?void 0:t.ambientMode){case La.Skybox:case La.Custom:const r=this.internalGetReflection(i);if(r&&r.Source){Uo&&console.log("Setting environment reflection",r);const o=this.context.scene,a=r.Source;a.mapping=Ya,o.environment=a;return}else Uo&&console.warn("Could not find reflection for source",i);break}if((t==null?void 0:t.environmentReflectionSource)===rm.Custom)switch(t==null?void 0:t.ambientMode){case La.Trilight:if(t.ambientTrilight){const r=t.ambientTrilight,o=AH(r[0],r[1],r[2],64,64);o.colorSpace=He,o.mapping=Ya,this.context.scene.environment=o}else console.error("Missing ambient trilight",t.sourceId);return;case La.Flat:if(t.ambientLight){const r=VS(t.ambientLight,64);r.colorSpace=He,r.mapping=Ya,this.context.scene.environment=r}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(i){if(i&&i!==this.__currentReflectionId){Uo&&console.log("Not disabling reflection for",i,"because it is not the current light settings id",this.__currentReflectionId);return}Uo&&console.log("Disable reflection",i);const t=this.context.scene;t.environment=null}}class xH{constructor(i,t,n=1){h(this,"_source");this._source=t,t.mapping=Ya}get Source(){return this._source}}const zT=Q("timescale");let Lx=1;typeof zT=="number"&&(Lx=zT);class CH{constructor(){h(this,"_time",0);h(this,"_deltaTime",0);h(this,"_deltaTimeUnscaled",0);h(this,"timeScale",1);h(this,"_frame",0);h(this,"clock",new MP);h(this,"_smoothedFps",0);h(this,"_smoothedDeltaTime",0);h(this,"_fpsSamples",[]);h(this,"_fpsSampleIndex",0);typeof Lx=="number"&&(this.timeScale=Lx)}get time(){return this._time}set time(i){this._time=i}get deltaTime(){return this._deltaTime}set deltaTime(i){this._deltaTime=i}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(i){this._frame=i}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let i=0;for(let t=0;t<this._fpsSamples.length;t++)i+=this._fpsSamples[t];this._smoothedDeltaTime=i/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let QT=!1;function wO(s){QT||(QT=!0,SH(),EH())}wO();function SH(){const s=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,i="vec3 NeutralToneMapping( vec3 color ) {",t=`return mix(color, vec3(1, 1, 1), g);
}`,n=Vs.tonemapping_pars_fragment.indexOf(i),r=Vs.tonemapping_pars_fragment.indexOf(t,n);if(n>=0&&r>=0){const o=Vs.tonemapping_pars_fragment.substring(n,r+t.length);Vs.tonemapping_pars_fragment=Vs.tonemapping_pars_fragment.replace(o,s)}}function EH(){const s=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,i="vec3 AgXToneMapping( vec3 color ) {",t=`	return color;
}`,n=Vs.tonemapping_pars_fragment.indexOf(i),r=Vs.tonemapping_pars_fragment.indexOf(t,n);if(n>=0&&r>=0){const o=Vs.tonemapping_pars_fragment.substring(n,r+t.length);Vs.tonemapping_pars_fragment=Vs.tonemapping_pars_fragment.replace(o,s)}}function ys(s){const i=document.createElement("span");return i.style.maxWidth="48px",i.style.maxHeight="48px",i.style.overflow="hidden",i.classList.add("material-symbols-outlined","notranslate"),i.setAttribute("translate","no"),i.innerText=s,i}function IH(s){var t;return((t=s.classList)==null?void 0:t.contains("material-symbols-outlined"))||!1}const PA=new Map;async function jT(s){const i="Material Symbols Outlined";if(document.fonts.check(`1em '${i}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),PA.has(s))return PA.get(s);const t=document.createElement("canvas"),n=48;t.width=n,t.height=n;const r=t.getContext("2d");if(r){r.font=`${n}px '${i}'`,r.fillStyle="black",r.fillText(s,0,n);const o=t.toDataURL(),a=new At;return a.name=s+" icon",a.image=new Image,a.image.src=o,a.needsUpdate=!0,PA.set(s,a),a}return PA.set(s,null),null}const qy=class{constructor(){h(this,"_fullscreenButton");h(this,"_muteButton");h(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new qy),this._instance}static create(){return new qy}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(i){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return be()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const t=document.createElement("button");this._fullscreenButton=t,t.classList.add("fullscreen-button"),t.title="Click to enter fullscreen mode";const n=ys("fullscreen"),r=ys("fullscreen_exit");return t.appendChild(n),t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in i.domElement&&typeof i.domElement.webkitRequestFullscreen=="function"?i.domElement.webkitRequestFullscreen():"requestFullscreen"in i.domElement&&i.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(n.remove(),t.appendChild(r),t.title="Click to enter fullscreen mode"):(r.remove(),t.appendChild(n),t.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{t.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{t.style.display=""}),t}get muteButton(){return this._muteButton}createMuteButton(i){if(this._muteButton)return this._muteButton;const t=document.createElement("button");this._muteButton=t,t.classList.add("mute-button"),t.title="Click to mute/unmute";const n=ys("volume_off"),r=ys("volume_up");return i.application.muted?t.appendChild(n):t.appendChild(r),t.onclick=()=>{i.application.muted?(n.remove(),t.appendChild(r),i.application.muted=!1):(r.remove(),t.appendChild(n),i.application.muted=!0)},t}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const i=document.createElement("button");this._qrButton=i,i.innerText="QR Code",i.prepend(ys("qr_code")),i.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(i);const t=document.createElement("div");t.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const n=document.createElement("div");n.classList.add("qr-code-container"),t.appendChild(n),i.addEventListener("click",()=>{if(t.parentNode)return o();window.location.href.includes("://localhost")&&Xt("To access your website from another device in the same local network you have to use the IP address instead of localhost."),r()});async function r(){await a(),document.body.appendChild(t);const l=n.getBoundingClientRect(),c=i.getBoundingClientRect();t.style.left=c.left+c.width*.5-l.width*.5+"px",c.top<l.height?t.style.top=`calc(${c.bottom}px + ${t.style.padding} * .6)`:t.style.top=`calc(${c.top-l.height}px - ${t.style.padding} * 2.5)`,t.style.opacity="0",t.style.pointerEvents="all",t.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{t.style.opacity="1",window.addEventListener("click",o,{once:!0})}),window.addEventListener("resize",o),window.addEventListener("scroll",o),document.fullscreenElement?document.fullscreenElement.appendChild(t):document.body.appendChild(t)}function o(){t.style.pointerEvents="none",t.style.transition="opacity 0.2s",t.style.opacity="0",setTimeout(()=>{var l;return(l=t.parentNode)==null?void 0:l.removeChild(t)},500),window.removeEventListener("click",o),window.removeEventListener("resize",o),window.removeEventListener("scroll",o)}async function a(){const c=await AU({text:window.location.href,width:200,height:200});n.innerHTML="",n.appendChild(c)}return i.addEventListener("pointerenter",()=>{a()},{once:!0}),i}hideElementDuringXRSession(i){xS(t=>{i["previous-display"]=i.style.display,i.style.display="none"}),Qk(t=>{i["previous-display"]!=null&&(i.style.display=i["previous-display"])})}};let Ha=qy;h(Ha,"_instance");function fy(s,i){const t=(i==null?void 0:i.element)||document.head,n=Array.from(t.querySelectorAll(`link[rel=stylesheet][href*='${s}']`));if(n.length<=0){const r=document.createElement("link");r.href=s,r.rel="stylesheet",t.appendChild(r),n.push(r)}if(i!=null&&i.loadedCallback)for(let r=0;r<n.length;r++)i!=null&&i.loadedCallback&&n[r].addEventListener("load",i.loadedCallback)}function xO(){fy("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const Fx="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",py="needle-logo-element";class CO extends HTMLElement{constructor(){super();h(this,"_root");h(this,"wrapper");h(this,"logoElement",document.createElement("img"));h(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const t=document.createElement("template");t.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
            margin: 0 0.3rem;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${jz} />
        </div>
        `,this._root.appendChild(t.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return py}static create(){return document.createElement(py)}setLogoVisible(t){this.logoElement.style.display=t?"block":"none"}}customElements.get(py)||customElements.define(py,CO);const R_=Q("debugspatialmenu");class TH{constructor(i,t){h(this,"_context");h(this,"needleMenu");h(this,"htmlButtonsMap",new Map);h(this,"enabled",!0);h(this,"uiisDirty",!1);h(this,"_showNeedleLogo");h(this,"_wasInXR",!1);h(this,"preRender",()=>{var t;if(!this.enabled){(t=this.menu)==null||t.removeFromParent();return}R_&&Gg()&&this.updateMenu();const i=this._context.xr;if(!(i!=null&&i.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});h(this,"_menuTarget",new ne);h(this,"positionFilter",new QM(90,.5));h(this,"familyName","Needle Spatial Menu");h(this,"menu");h(this,"_poweredByNeedleElement");var r;this._context=i,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=t;const n=(r=this.needleMenu.shadowRoot)==null?void 0:r.querySelector(".options");n?new MutationObserver(a=>{if(this.enabled&&!(this._context.isInXR==!1&&!R_))for(const l of a)l.type==="childList"&&(l.addedNodes.forEach(c=>{this.createButtonFromHTMLNode(c)}),l.removedNodes.forEach(c=>{const u=c,d=this.htmlButtonsMap.get(u);d&&(this.htmlButtonsMap.delete(u),d.remove(),qt.update())}))}).observe(n,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(i){var t;this.enabled=i,i||(t=this.menu)==null||t.removeFromParent()}onDestroy(){const i=this._context.pre_render_callbacks.indexOf(this.preRender);i>-1&&this._context.pre_render_callbacks.splice(i,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(i){this._showNeedleLogo=i}onEnterXR(){var t;const i=(t=this.needleMenu.shadowRoot)==null?void 0:t.querySelector(".options");i&&i.childNodes.forEach(n=>{this.createButtonFromHTMLNode(n)})}onExitXR(){var i;(i=this.menu)==null||i.removeFromParent()}createButtonFromHTMLNode(i){const t=this.getMenu(),n=this.htmlButtonsMap.get(i);if(n){n.add();return}if(i instanceof HTMLButtonElement){const r=this.createButton(t,i);this.htmlButtonsMap.set(i,r),r.add()}else i instanceof HTMLSlotElement&&i.assignedNodes().forEach(r=>{this.createButtonFromHTMLNode(r)})}updateMenu(){var o,a;performance.mark("NeedleSpatialMenu updateMenu start");const i=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(i);const t=this._context.mainCamera,n=this._context.xr,r=(n==null?void 0:n.rigScale)||1;if(t){const l=t.worldPosition,c=t.worldForward.multiplyScalar(-1),u=c.y>.6,d=c.y>.4,f=i.visible?d:u,p=!i.visible&&f;i.visible=f||Gg()&&R_,c.multiplyScalar(3*r),l.add(c),(p||!1)&&(i.position.copy(this._menuTarget.position),i.position.y+=1,this._menuTarget.position.copy(i.position),this.positionFilter.reset(i.position),i.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const m=this._menuTarget.position.distanceTo(l);(p||m>1.5*r)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(l),this._context.scene.add(this._menuTarget),g0(this._menuTarget,this._context.mainCamera,!1,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,i.position,this._context.time.time);const A=5;(o=this.menu)==null||o.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*A),(a=this.menu)==null||a.scale.setScalar(r)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,qt.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(i,t=0){i instanceof Z&&(i.material.depthTest=!1,i.material.depthWrite=!1),i.renderOrder=1e3+t*2;for(const n of i.children)this.ensureRenderOnTop(n,t+1)}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new qt.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:.04,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Ue(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const i=O.get("ObjectRaycaster");return i&&uf(this.menu,new i),this.menu}handleNeedleWatermark(){var i;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new qt.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const t=new GT(this._context,()=>globalThis.open("https://needle.tools","_self"));uf(this._poweredByNeedleElement,t);const n=new qt.Text({textContent:"Powered by",width:"auto",height:"auto"}),r=new qt.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Ue(0,0,0,.02)});this._poweredByNeedleElement.add(n),this._poweredByNeedleElement.add(r),(i=this.menu)==null||i.add(this._poweredByNeedleElement),this.markDirty(),new Xa().load("./include/needle/poweredbyneedle.webp",a=>{var c;t.allowModifyUI=!1,n.removeFromParent(),r.removeFromParent();const l=a.image.width/a.image.height;(c=this._poweredByNeedleElement)==null||c.set({backgroundImage:a,backgroundOpacity:1,width:.1*l,height:.1}),this.markDirty()})}if(this.menu){const t=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&pu())t>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const n=this.menu.children.indexOf(this._poweredByNeedleElement);t!==n&&this.markDirty()}}}ensureFont(){let i=qt.FontLibrary.getFontFamily(this.familyName);if(!i){i=qt.FontLibrary.addFontFamily(this.familyName);const t=i.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{this.markDirty()})}}createButton(i,t){const n=new qt.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),r=new qt.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});n.add(r),n["needle:use_eventsystem"]=!0;const o=new GT(this._context,()=>t.click());return uf(n,o),new RH(this,i,t,n,r)}}class RH{constructor(i,t,n,r,o){h(this,"menu");h(this,"root");h(this,"htmlbutton");h(this,"spatialContainer");h(this,"spatialText");h(this,"spatialIcon");h(this,"_lastText","");h(this,"_lastTexture");this.menu=i,this.root=t,this.htmlbutton=n,this.spatialContainer=r,this.spatialText=o,new MutationObserver(l=>{for(const c of l)c.type==="attributes"?c.attributeName==="style"&&this.updateVisible():c.type==="childList"&&this.updateText()}).observe(n,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const i=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",i!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let i="",t="";this.htmlbutton.childNodes.forEach(n=>{n.nodeType===Node.TEXT_NODE?i+=n.textContent:n instanceof HTMLElement&&IH(n)&&n.textContent&&(t=n.textContent)}),this._lastText!==i&&(this._lastText=i,this.spatialText.name=i,this.spatialText.set({textContent:i}),this.menu.markDirty()),i.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),t&&this.createIcon(t)}async createIcon(i){var n;if(!this.spatialIcon){const r=await jT(i);if(r&&!this.spatialIcon){const a=new qt.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:r,backgroundOpacity:1,margin:new Ue(0,.005,0,0)});this.spatialIcon=a,this.spatialContainer.add(a),this.menu.markDirty()}}if(i!=this._lastTexture){this._lastTexture=i;const r=await jT(i);r&&((n=this.spatialIcon)==null||n.set({backgroundImage:r}),this.menu.markDirty())}const t=this.spatialContainer.children.indexOf(this.spatialIcon);t>0&&(this.spatialContainer.children.splice(t,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class GT{constructor(i,t){h(this,"isComponent",!0);h(this,"enabled",!0);h(this,"gameObject");h(this,"allowModifyUI",!0);h(this,"context");h(this,"onclick");this.context=i,this.onclick=t}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),qt.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),qt.update())}onPointerDown(i){i.use()}onPointerUp(i){i.use()}onPointerClick(i){i.use(),this.onclick()}}const Fd="needle-menu",dg=Q("debugmenu"),HT=Q("debugnoncommercial");let BH=class{constructor(i){h(this,"_context");h(this,"_menu");h(this,"_spatialMenu");h(this,"onPostMessage",i=>{if(i.origin===globalThis.location.origin&&typeof i.data=="object"){const t=i.data,n=t.type;if(n==="needle:menu"){const r=t.button;if(r){if(!r.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!r.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const o=document.createElement("button");if(o.textContent=r.label,r.icon){const a=ys(r.icon);o.prepend(a)}r.priority&&o.setAttribute("priority",r.priority.toString()),o.onclick=()=>{if(r.onclick){const a=r.onclick.startsWith("http")||r.onclick.startsWith("www."),l=r.target||"_blank";a?globalThis.open(r.onclick,l):console.error("NeedleMenu: onclick is not a valid link",r.onclick)}},this._menu.appendChild(o)}else dg&&console.error("NeedleMenu: unknown postMessage event",t)}else dg&&console.warn("NeedleMenu: unknown postMessage type",n,t)}});h(this,"onStartXR",i=>{i.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),i.session.session.addEventListener("end",this.onExitXR))});h(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});h(this,"_muteButton");h(this,"_fullscreenButton");this._menu=gy.getOrCreate(i.domElement,i),this._context=i,this._spatialMenu=new TH(i,this._menu),window.addEventListener("message",this.onPostMessage),xS(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(i){this._menu.setPosition(i)}setVisible(i){this._menu.setVisible(i)}showNeedleLogo(i){var t;this._menu.showNeedleLogo(i),(t=this._spatialMenu)==null||t.showNeedleLogo(i)}showSpatialMenu(i){this._spatialMenu.setEnabled(i)}showQRCodeButton(i){if(i==="desktop-only"&&(i=!uc()),i){const t=Ha.getOrCreate().createQRCode();return t.style.display="",this._menu.appendChild(t),t}else{const t=Ha.getOrCreate().qrButton;return t&&(t.style.display="none"),t??null}}showAudioPlaybackOption(i){var t;if(!i){(t=this._muteButton)==null||t.remove();return}this._muteButton=Ha.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(i){var t;if(!i){(t=this._fullscreenButton)==null||t.remove();return}this._fullscreenButton=Ha.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(i){return this._menu.appendChild(i)}};var mm,Am,Ux;const $E=class extends HTMLElement{constructor(){var f,p,g,m,A,y;super();ji(this,Am);h(this,"_domElement",null);h(this,"_context",null);h(this,"_sizeChangeInterval");ji(this,mm,t=>{if(!t.defaultPrevented&&t.target==this._domElement&&t instanceof PointerEvent&&t.button===0&&this.root.classList.contains("open")){const n=this.foldout.getBoundingClientRect(),r=t;r.clientX>n.left&&r.clientX<n.right&&r.clientY>n.top&&r.clientY<n.bottom||this.root.classList.toggle("open",!1)}});h(this,"_userRequestedLogoVisible");h(this,"_userRequestedMenuVisible");h(this,"root");h(this,"wrapper");h(this,"options");h(this,"logoContainer");h(this,"compactMenuButton");h(this,"foldout");h(this,"_isHandlingChange",!1);h(this,"_didSort",new Map);h(this,"_lastAvailableWidthChange",0);h(this,"_timeoutHandle",0);h(this,"handleSizeChange",(t,n)=>{if(!this._domElement)return;const r=this._domElement.clientWidth;if(r<500){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const o=20*2,a=r-o;if(!n&&Math.abs(a-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=a,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const u=c();u<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):u>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),c()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const l=()=>this.options.clientWidth+this.logoContainer.clientWidth,c=()=>a-l()});const t=document.createElement("template");t.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 .3rem;
        }

        .wrapper > *, .options > button, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.1999999999999993rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.1999999999999993rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
        }

        .options > button, ::slotted(button) {
            height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > button, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 0.8rem;
        }
            
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > * {
            font-size: 1.2rem;
            padding: .6rem .5rem;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options > button {
            display: flex;
            flex-basis: 100%;
            min-height: 3rem;
        }
        .compact .options > button.row2 {
            //border: 1px solid red !important;
            display: flex;
            flex: 1;
            flex-basis: 30%;
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button"></button>
        </div>
        `;const n=this.attachShadow({mode:"open"});xO(),fy(Fx,{loadedCallback:()=>{this.handleSizeChange()}}),fy(Fx,{element:n});const r=t.content.cloneNode(!0);n==null||n.appendChild(r),this.root=n.querySelector("#root"),this.wrapper=(f=this.root)==null?void 0:f.querySelector(".wrapper"),this.options=(p=this.root)==null?void 0:p.querySelector(".options"),this.logoContainer=(g=this.root)==null?void 0:g.querySelector(".logo"),this.compactMenuButton=(m=this.root)==null?void 0:m.querySelector(".compact-menu-button"),this.compactMenuButton.append(ys("more_vert")),this.foldout=(A=this.root)==null?void 0:A.querySelector(".foldout"),(y=this.root)==null||y.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const o=CO.create();o.style.minHeight="1rem",this.logoContainer.append(o),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),OH(b=>{if(b==!0&&eh()&&!HT){let _=this._userRequestedLogoVisible;_===void 0&&(_=!1),Ph(this,Am,Ux).call(this,_)}}),this.compactMenuButton.addEventListener("click",b=>{b.preventDefault(),this.root.classList.toggle("open")});let a=this._context;setTimeout(()=>a=this._context);let l=0;const c=(b,_)=>{var w,S,E;dg&&console.log("Set menu visible",_),a!=null&&a.isInAR&&a.arOverlayElement?b!=a.arOverlayElement&&a.arOverlayElement.appendChild(this):this.parentNode!=((w=this._domElement)==null?void 0:w.shadowRoot)&&((E=(S=this._domElement)==null?void 0:S.shadowRoot)==null||E.appendChild(this)),this.style.display=_?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let u=!1;new MutationObserver(b=>{var _;if(!u)try{u=!0,this.onChangeDetected(b);const w=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||w!=((_=this._domElement)==null?void 0:_.shadowRoot))&&!eh()){const S=l++;fr()&&this._userRequestedMenuVisible===!1?(S===0&&c(w,this._userRequestedMenuVisible),S===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu â†’ The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):S===0?c(w,!0):setTimeout(()=>c(w,!0),5)}}finally{u=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),dg&&this.___insertDebugOptions()}static create(){return document.createElement(Fd,{is:Fd})}static getOrCreate(t,n){let r=t.querySelector(Fd);return!r&&t.shadowRoot&&(r=t.shadowRoot.querySelector(Fd)),r||(r=$E.create(),t.shadowRoot?t.shadowRoot.appendChild(r):t.appendChild(r)),r._domElement=t,r._context=n,r}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var t,n;(t=this._domElement)==null||t.addEventListener("resize",this.handleSizeChange),(n=this._domElement)==null||n.addEventListener("click",De(this,mm))},1)}disconnectedCallback(){var t,n;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(t=this._domElement)==null||t.removeEventListener("resize",this.handleSizeChange),(n=this._context)==null||n.domElement.removeEventListener("click",De(this,mm))}showNeedleLogo(t){this._userRequestedLogoVisible=t,!(!t&&(!eh()||HT)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!fr()))&&Ph(this,Am,Ux).call(this,t)}setPosition(t){if(t!=="top"&&t!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",t);this.root.classList.remove("top","bottom"),this.root.classList.add(t)}setVisible(t){this._userRequestedMenuVisible=t,this.style.display=t?"flex":"none"}append(...t){for(const n of t)if(typeof n=="string"){const r=document.createTextNode(n);this.options.appendChild(r)}else this.options.appendChild(n)}appendChild(t){var r;if(!(t instanceof Node)){const o=document.createElement("button");if(o.textContent=t.label,o.onclick=t.onClick,o.setAttribute("priority",((r=t.priority)==null?void 0:r.toString())??"0"),t.icon){const a=ys(t.icon);t.iconSide==="right"?o.appendChild(a):o.prepend(a)}t.class&&o.classList.add(t.class),t=o}return this.options.appendChild(t)}prepend(...t){for(const n of t)if(typeof n=="string"){const r=document.createTextNode(n);this.options.prepend(r)}else this.options.prepend(n)}onChangeDetected(t){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const n of t)n.target==this.options&&this.onOptionsChildrenChanged(n)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(t){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),t.type==="childList"){let n=!1;const r=Date.now();for(let o=0;o<t.addedNodes.length;o++){const a=t.addedNodes[o],l=this._didSort.get(a);typeof l=="number"&&r-l<100||(this._didSort.set(a,r),n=!0)}if(n){const o=Array.from(this.options.children);o.sort((a,l)=>{const c=parseInt(a.getAttribute("priority")||"0"),u=parseInt(l.getAttribute("priority")||"0");return c-u});for(const a of o)this.options.appendChild(a)}}}handleMenuVisible(){dg&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let t=0;t<this.options.children.length;t++){const n=this.options.children[t];if(n.tagName==="SLOT"){const o=n.assignedNodes();for(const a of o)if(a instanceof HTMLElement&&a.style.display!="none")return!0}else if(n.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",r=>{r.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const t=document.createElement("button");t.textContent="Hide Buttons",t.onclick=()=>{const r=new Array(this.options.children.length);for(let o=0;o<this.options.children.length;o++)r[o]=this.options.children[o];for(const o of r)this.options.removeChild(o);setTimeout(()=>{for(const o of r)this.options.appendChild(o)},1e3)},this.appendChild(t);const n=document.createElement("button");n.textContent="Toggle Logo",n.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(n)}};let gy=$E;mm=new WeakMap,Am=new WeakSet,Ux=function(t){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",t?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))};customElements.get(Fd)||customElements.define(Fd,gy);const nn=Q("debugcontext"),PH=Q("stats"),MH=Q("debugactive"),kH=Q("debugframerate"),DH=Q("debugcoroutine"),HK={};class VK{constructor(){h(this,"name");h(this,"alias");h(this,"hash");h(this,"runInBackground");h(this,"domElement");h(this,"renderer");h(this,"camera");h(this,"scene")}}var qe;(function(s){s[s.Start=-1]="Start",s[s.EarlyUpdate=0]="EarlyUpdate",s[s.Update=1]="Update",s[s.LateUpdate=2]="LateUpdate",s[s.OnBeforeRender=3]="OnBeforeRender",s[s.OnAfterRender=4]="OnAfterRender",s[s.PrePhysicsStep=9]="PrePhysicsStep",s[s.PostPhysicsStep=10]="PostPhysicsStep",s[s.Undefined=-1]="Undefined"})(qe||(qe={}));function WS(s,i){if(!s)return;if(!s.isComponent){(be()||nn)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,s);return}i||(i=Ge.Current,nn&&console.warn("> Registering component without context"));const t=i==null?void 0:i.new_scripts;t.includes(s)||t.push(s)}const Kt=class{constructor(i){h(this,"name");h(this,"alias");h(this,"isManagedExternally",!1);h(this,"isPaused",!1);h(this,"runInBackground",!1);h(this,"targetFrameRate");h(this,"physicsSteps",1);h(this,"hash");h(this,"domElement");h(this,"_resolutionScaleFactor",1);h(this,"_boundingClientRectFrame",-1);h(this,"_boundingClientRect",null);h(this,"_domX");h(this,"_domY");h(this,"xr",null);h(this,"_xrFrame",null);h(this,"_currentFrameEvent",qe.Undefined);h(this,"scene");h(this,"renderer");h(this,"composer",null);h(this,"scripts",[]);h(this,"scripts_pausedChanged",[]);h(this,"scripts_earlyUpdate",[]);h(this,"scripts_update",[]);h(this,"scripts_lateUpdate",[]);h(this,"scripts_onBeforeRender",[]);h(this,"scripts_onAfterRender",[]);h(this,"scripts_WithCorroutines",[]);h(this,"scripts_immersive_vr",[]);h(this,"scripts_immersive_ar",[]);h(this,"coroutines",{});h(this,"post_setup_callbacks",[]);h(this,"pre_update_callbacks",[]);h(this,"pre_render_callbacks",[]);h(this,"post_render_callbacks",[]);h(this,"pre_update_oneshot_callbacks",[]);h(this,"new_scripts",[]);h(this,"new_script_start",[]);h(this,"new_scripts_pre_setup_callbacks",[]);h(this,"new_scripts_post_setup_callbacks",[]);h(this,"new_scripts_xr",[]);h(this,"mainCameraComponent");h(this,"_mainCamera",null);h(this,"_fallbackCamera",null);h(this,"application");h(this,"animations");h(this,"time");h(this,"input");h(this,"physics");h(this,"connection");h(this,"assets");h(this,"mainLight",null);h(this,"sceneLighting");h(this,"addressables");h(this,"lightmaps");h(this,"players");h(this,"lodsManager");h(this,"menu");h(this,"_sizeChanged",!1);h(this,"_isCreated",!1);h(this,"_isCreating",!1);h(this,"_isVisible",!1);h(this,"_stats",PH?new ng:null);h(this,"_intersectionObserver",null);h(this,"_disposeCallbacks",[]);h(this,"maxRenderResolution");h(this,"_originalCreationArgs");h(this,"onUnhandledRejection",i=>{this.onError(i.reason)});h(this,"_cameraStack",[]);h(this,"_onBeforeRenderListeners",new Map);h(this,"_onAfterRenderListeners",new Map);h(this,"_requireDepthTexture",!1);h(this,"_requireColorTexture",!1);h(this,"_renderTarget");h(this,"_isRendering",!1);h(this,"_createId",0);h(this,"_renderlooperrors",0);h(this,"_lastTimestamp",0);h(this,"_accumulatedTime",0);h(this,"_dispatchReadyAfterFrame",!1);h(this,"_wasPaused",!1);this.name=(i==null?void 0:i.name)||"",this.alias=i==null?void 0:i.alias,this.domElement=(i==null?void 0:i.domElement)||document.body,this.hash=i==null?void 0:i.hash,i!=null&&i.renderer&&(this.renderer=i.renderer,this.isManagedExternally=!0),(i==null?void 0:i.runInBackground)!==void 0&&(this.runInBackground=i.runInBackground),i!=null&&i.scene?this.scene=i.scene:this.scene=new ws,i!=null&&i.camera&&(this._mainCamera=i.camera),this.application=new Ja(this),this.time=new CH,this.input=new n8(this),this.physics=new ag(this),this.connection=new J8(this),this.assets=new A5,this.sceneLighting=new wH(this),this.addressables=new F6(this),this.lightmaps=new uH(this),this.players=new gH(this),this.menu=new BH(this),this.lodsManager=new dH(this),this.animations=new j6(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const n=new ResizeObserver(r=>this._sizeChanged=!0);n.observe(this.domElement),this._disposeCallbacks.push(()=>n.disconnect()),this._intersectionObserver=new IntersectionObserver(r=>{this._isVisible=r[0].isIntersecting}),this._disposeCallbacks.push(()=>{var r;return(r=this._intersectionObserver)==null?void 0:r.disconnect()}),xt.register(this)}static get DefaultTargetFrameRate(){return Kt._defaultTargetFramerate.value}static set DefaultTargetFrameRate(i){Kt._defaultTargetFramerate.value=i}static get DefaultWebGLRendererParameters(){return Kt._defaultWebglRendererParameters}get version(){return Yo}static get Current(){return xt.Current}static set Current(i){xt.Current=i}appendHTMLElement(i){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(i):this.domElement.appendChild(i)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(i){if(i!==this._resolutionScaleFactor&&typeof i=="number"){if(i<=0){console.error("Invalid resolution scale factor",i);return}this._resolutionScaleFactor=i,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var i,t;return((t=(i=this.renderer)==null?void 0:i.xr)==null?void 0:t.isPresenting)||!1}get xrSessionMode(){var i;return(i=this.xr)==null?void 0:i.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var i,t;return(t=(i=this.renderer)==null?void 0:i.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var i,t;return this.renderer.xr.isPresenting?(t=(i=this.renderer)==null?void 0:i.xr)==null?void 0:t.getCamera():void 0}get arOverlayElement(){const i=this.domElement;return typeof i.getAROverlayContainer=="function"?i.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const i=this.mainCameraComponent;return i.cam||i.buildCamera(),i.cam}return this._fallbackCamera||(this._fallbackCamera=new bt(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(i){this._mainCamera=i}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(i){var t,n,r;if((t=this.renderer)==null||t.dispose(),i={...Kt.DefaultWebGLRendererParameters,...i},!i.canvas){const o=(r=(n=this.domElement)==null?void 0:n.shadowRoot)==null?void 0:r.querySelector("canvas");o&&(i.canvas=o,nn&&console.log("Using canvas from shadow root",o))}nn&&console.log("Using Renderer Parameters:",i,this.domElement),this.renderer=new Mu(i),this.renderer.debug.checkShaderErrors=be()||Q("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Cf,this.renderer.setClearColor(new xe("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=bF,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=He,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var i,t;(i=this._intersectionObserver)==null||i.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(i=!1){var t,n,r;if(i||!this.isManagedExternally&&((t=this.renderer.xr)==null?void 0:t.isPresenting)===!1){this._sizeChanged=!1;const o=this.resolutionScaleFactor;let a=this.domWidth*o,l=this.domHeight*o;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),a=Math.min(this.maxRenderResolution.x,a),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),l=Math.min(this.maxRenderResolution.y,l));const c=this.mainCamera;this.updateAspect(c),this.renderer.setSize(a,l,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((n=this.composer.setSize)==null||n.call(this.composer,a,l),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((r=this.composer.setPixelRatio)==null||r.call(this.composer,window.devicePixelRatio)))}}updateAspect(i,t,n){if(!i)return;t===void 0&&(t=this.domWidth),n===void 0&&(n=this.domHeight);const r=i.aspect;i.aspect=t/n,r!==i.aspect&&i.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(i){return this.create(i)}async create(i){try{this._isCreating=!0,i!==this._originalCreationArgs&&(this._originalCreationArgs=h0(i)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const t=await this.internalOnCreate(i);return this._isCreated=t,t}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(i){this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}clear(){var i,t,n,r;xt.dispatchCallback(ut.ContextClearing,this),ua(this,ut.ContextClearing),xo(this.scene,!0,!0),this.scene=new ws,(i=this.addressables)==null||i.dispose(),(t=this.lightmaps)==null||t.clear(),(r=(n=this.physics)==null?void 0:n.engine)==null||r.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),xt.dispatchCallback(ut.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var i,t;Kt.Current=this,xt.dispatchCallback(ut.ContextDestroying,this),ua(this,ut.ContextDestroying),this.clear(),(i=this.renderer)==null||i.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(nn&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const n of this._disposeCallbacks)try{n()}catch(r){console.error("Error in on dispose callback:",r,n)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,xt.dispatchCallback(ut.ContextDestroyed,this),ua(this,ut.ContextDestroyed),xt.unregister(this),Kt.Current===this&&(Kt.Current=null)}registerCoroutineUpdate(i,t,n){return typeof(t==null?void 0:t.next)!="function"?(console.error("Registered invalid coroutine function from "+i.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),t):(this.coroutines[n]||(this.coroutines[n]=[]),this.coroutines[n].push({comp:i,main:t}),t)}unregisterCoroutineUpdate(i,t){if(!this.coroutines[t])return;const n=this.coroutines[t].findIndex(r=>r.main===i);n>=0&&this.coroutines[t].splice(n,1)}stopAllCoroutinesFrom(i){for(const t in this.coroutines){const n=this.coroutines[t];for(let r=n.length-1;r>=0;r--)n[r].comp===i&&n.splice(r,1)}}setCurrentCamera(i){var r;if(!i)return;if(i.cam||i.buildCamera(),!i.cam){console.warn("Camera component is missing camera",i);return}const t=this._cameraStack.indexOf(i);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(i),this.mainCameraComponent=i;const n=i.cam;n.isPerspectiveCamera&&this.updateAspect(n),(r=this.mainCameraComponent)==null||r.applyClearFlagsIfIsActiveCamera()}removeCamera(i){if(!i)return;const t=this._cameraStack.indexOf(i);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===i&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const n=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(n)}}addBeforeRenderListener(i,t){this._onBeforeRenderListeners.has(i.uuid)||(this._onBeforeRenderListeners.set(i.uuid,[]),i.onBeforeRender=this._createRenderCallbackWrapper(i,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(i.uuid).push(t)}removeBeforeRenderListener(i,t){if(this._onBeforeRenderListeners.has(i.uuid)){const n=this._onBeforeRenderListeners.get(i.uuid),r=n.indexOf(t);r>=0&&n.splice(r,1)}}addAfterRenderListener(i,t){var n;this._onAfterRenderListeners.has(i.uuid)||(this._onAfterRenderListeners.set(i.uuid,[]),i.onAfterRender=this._createRenderCallbackWrapper(i,this._onAfterRenderListeners)),(n=this._onAfterRenderListeners.get(i.uuid))==null||n.push(t)}removeAfterRenderListener(i,t){if(this._onAfterRenderListeners.has(i.uuid)){const n=this._onAfterRenderListeners.get(i.uuid),r=n.indexOf(t);r>=0&&n.splice(r,1)}}_createRenderCallbackWrapper(i,t){return(n,r,o,a,l,c)=>{const u=t.get(i.uuid);if(u)for(let d=0;d<u.length;d++){const f=u[d];f(n,r,o,a,l,c)}}}get isRendering(){return this._isRendering}setRequireDepth(i){this._requireDepthTexture=i}setRequireColor(i){this._requireColorTexture=i}get depthTexture(){var i;return((i=this._renderTarget)==null?void 0:i.depthTexture)||null}get opaqueColorTexture(){var i;return((i=this._renderTarget)==null?void 0:i.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const i=getComputedStyle(this.domElement);return i.visibility!=="hidden"&&i.display!=="none"&&i.opacity!=="0"}async internalOnCreate(i){var l,c,u,d,f,p,g,m;const t=++this._createId;nn&&console.log("Creating context",this.name,i);const n=globalThis["needle:dependencies:ready"];n instanceof Promise&&(nn&&console.log("Waiting for dependencies to be ready"),await n.catch(A=>{if(nn||be()){if(dS("Needle Engine dependencies failed to load. Please check the console for more details"),A instanceof ReferenceError){let y="YourComponentName";const b=A.message.indexOf("'");if(b>0){const _=A.message.indexOf("'",b+1);if(_>0){const w=A.message.substring(b+1,_);w.length>3&&(y=w)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
â†’ Possible solution: Replace @serializable(${y}) in your script with @serializable(Behaviour)

---`,A);return}console.error("Needle Engine dependencies failed to load",A)}}).then(()=>{nn&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(l=this.renderer)==null||l.setAnimationLoop(null)),await nc(1),Kt.Current=this,await xt.dispatchCallback(ut.ContextCreationStart,this);let r=!0,o;try{Kt.Current=this,i?o=await this.internalLoadInitialContent(t,i):o=[]}catch(A){console.error(A),r=!1}if(!r)return this.onError("Failed to load initial content"),!1;if(t!==this._createId||(c=i==null?void 0:i.abortSignal)!=null&&c.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return nn&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Kt.Current=this,Kt.Current=this;for(let A=0;A<this.new_scripts.length;A++){const y=this.new_scripts[A];if(y.gameObject!==void 0&&y.gameObject!==null){y.gameObject.userData===void 0&&(y.gameObject.userData={}),y.gameObject.userData.components===void 0&&(y.gameObject.userData.components=[]);const b=y.gameObject.userData.components;b.includes(y)||b.push(y)}}if(this.post_setup_callbacks)for(let A=0;A<this.post_setup_callbacks.length;A++)Kt.Current=this,await this.post_setup_callbacks[A](this);if(!this._mainCamera){Kt.Current=this;let A=null;Df(this.scene,y=>{const b=y;if(b!=null&&b.isCamera){if(cg(b.gameObject),!b.activeAndEnabled)return;if(b.tag==="MainCamera")return A=b,!0;A=b}}),A?this.setCurrentCamera(A):!xt.dispatchCallback(ut.MissingCamera,this,{files:o})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),Kt.Current=this,ry(this),this.physics.engine&&((u=this.physics.engine)==null||u.step(0),(d=this.physics.engine)==null||d.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const A=new y0(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(A),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(f=this.domElement.shadowRoot)==null||f.appendChild(this._stats.dom)),nn&&Xw(this.scene,!0),this.targetFrameRate===void 0?(nn&&console.warn("No target framerate set, using default",Kt.DefaultTargetFrameRate),this.targetFrameRate=Kt._defaultTargetFramerate):nn&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const a=xt.dispatchCallback(ut.ContextCreated,this,{files:o});return a&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((p=this.domElement)==null||p.internalSetLoadingMessage("finish loading")),await a),(g=i==null?void 0:i.abortSignal)!=null&&g.aborted?!1:(ua(this,ut.ContextCreated),nn&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((m=i==null?void 0:i.abortSignal)!=null&&m.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(i,t){var c,u,d,f;const n=new Array;if(t.files.length===0)return n;const r=[...t.files],o={name:"",progress:null,index:0,count:r.length},a=nl(),l=0;for(let p=0;p<r.length;p++){if((c=t.abortSignal)!=null&&c.aborted){nn&&console.log("Aborting loading because of abort signal");break}if(i!==this._createId){nn&&console.log("Aborting loading because create id changed",i,this._createId);break}const g=r[p];(u=t==null?void 0:t.onLoadingStart)==null||u.call(this,p,g),nn&&console.log("Context Load "+g);const m=await a.loadSync(this,g,g,l,A=>{var y,b;(y=t.abortSignal)!=null&&y.aborted||(o.name=g,o.progress=A,o.index=p,o.count=r.length,(b=t.onLoadingProgress)==null||b.call(this,o))});(d=t==null?void 0:t.onLoadingFinished)==null||d.call(this,p,g,m??null),m?n.push({src:g,file:m}):console.warn("Could not load file: "+g)}if(i!==this._createId||(f=t.abortSignal)!=null&&f.aborted){for(const p of n)if(p&&p.file)for(const g of p.file.scenes)xo(g,!0,!0)}else{let p=!1;for(const g of n)g&&g.file&&(g.file.scene?(p=!0,this.scene.add(g.file.scene)):console.warn("No scene found in loaded file"));if(!p){for(const g of n)if(g&&g.file){let m=0;for(let A=0;A<g.file.parser.json.materials.length;A++){const y=await g.file.parser.getDependency("material",A),b=new ne;b.position.x=A*1.1,b.position.y=m,this.scene.add(b),Uu.createPrimitive("ShaderBall",{parent:b,material:y})}m+=1}}}return n}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((i,t)=>{this.isManagedExternally||this.update(i,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(i,t){if(t===void 0&&(t=null),be()||nn||x5())try{performance.mark("update.start"),this.internalStep(i,t),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(n){this._renderlooperrors+=1,(be()||nn)&&(n instanceof Error||n instanceof TypeError)&&bi("Caught unhandled exception during render-loop - see console for details.",Yi.Error),console.error("Frame #"+this.time.frame+`
`,n),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:n}))}else this.internalStep(i,t)}updatePhysics(i){this.internalUpdatePhysics(i)}internalStep(i,t){this.internalOnBeforeRender(i,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(i,t){var r;this.renderer.info.autoReset=!0;const n=t!==null&&this._xrFrame===null;if(this._xrFrame=t,n&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:t}})),this._currentFrameEvent=qe.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=i),this._accumulatedTime+=(i-this._lastTimestamp)/1e3,this._lastTimestamp=i;let o=this.targetFrameRate;if(typeof o=="object"&&(o=o.value),this._accumulatedTime<1/(o+1))return!1;this._accumulatedTime=0}if((r=this._stats)==null||r.begin(),Kt.Current=this,this.onHandlePaused())return!1;for(Kt.Current=this,this.time.update(),kH&&console.log("FPS",this.time.smoothedFps.toFixed(0)),ry(this),Cv(this.scene),qD(this),ua(this,qe.Start);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const o=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(o)}if(this.pre_update_oneshot_callbacks){for(const o in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[o]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const o in this.pre_update_callbacks)this.pre_update_callbacks[o]();this._currentFrameEvent=qe.EarlyUpdate;for(let o=0;o<this.scripts_earlyUpdate.length;o++){const a=this.scripts_earlyUpdate[o];a.activeAndEnabled&&a.earlyUpdate!==void 0&&(Kt.Current=this,a.earlyUpdate())}if(this.executeCoroutines(qe.EarlyUpdate),ua(this,qe.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=qe.Update;for(let o=0;o<this.scripts_update.length;o++){const a=this.scripts_update[o];a.activeAndEnabled&&a.update!==void 0&&(Kt.Current=this,a.update())}if(this.executeCoroutines(qe.Update),ua(this,qe.Update),this.onHandlePaused())return!1;this._currentFrameEvent=qe.LateUpdate;for(let o=0;o<this.scripts_lateUpdate.length;o++){const a=this.scripts_lateUpdate[o];a.activeAndEnabled&&a.lateUpdate!==void 0&&(Kt.Current=this,a.lateUpdate())}if(this.executeCoroutines(qe.LateUpdate),ua(this,qe.LateUpdate),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=qe.OnBeforeRender;for(let o=0;o<this.scripts_onBeforeRender.length;o++){const a=this.scripts_onBeforeRender[o];a.activeAndEnabled&&a.onBeforeRender!==void 0&&(Kt.Current=this,a.onBeforeRender(t))}if(this.executeCoroutines(qe.OnBeforeRender),ua(this,qe.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const o in this.pre_render_callbacks)this.pre_render_callbacks[o](t)}return!0}internalUpdatePhysics(i){if(!this.physics.engine)return!1;const t=i,n=this.time.deltaTime/t;for(let r=0;r<t;r++)this._currentFrameEvent=qe.PrePhysicsStep,this.executeCoroutines(qe.PrePhysicsStep),this.physics.engine.step(n),this._currentFrameEvent=qe.PostPhysicsStep,this.executeCoroutines(qe.PostPhysicsStep);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(I5(this),this._currentFrameEvent=qe.Undefined,this.renderNow(),this._currentFrameEvent=qe.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let i=0;i<this.scripts_onAfterRender.length;i++){const t=this.scripts_onAfterRender[i];t.activeAndEnabled&&t.onAfterRender!==void 0&&(Kt.Current=this,t.onAfterRender())}if(this.executeCoroutines(qe.OnAfterRender),ua(this,qe.OnAfterRender),this.post_render_callbacks)for(const i in this.post_render_callbacks)this.post_render_callbacks[i]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),xt.dispatchCallback(ut.ContextFirstFrameRendered,this))}renderNow(i){return!i&&(i=this.mainCamera,!i)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==Cf&&wO(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):i&&(this.isInXR&&S1()&&this.renderer.clearDepth(),this.renderer.render(this.scene,i)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const i=this.evaluatePaused();if(this._wasPaused!==i){MH&&console.log("Paused?",i,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const n=this.scripts_pausedChanged[t];n.activeAndEnabled&&n.onPausedChanged!==void 0&&(Kt.Current=this,n.onPausedChanged(i,this._wasPaused))}}return this._wasPaused=i,i}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Et(this.domWidth,this.domHeight),this._requireDepthTexture){const n=new EC(this.domWidth,this.domHeight);this._renderTarget.depthTexture=n}this._requireColorTexture&&(this._renderTarget.texture=new At,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Zt,this._renderTarget.texture.magFilter=Zt,this._renderTarget.texture.format=qi)}const i=this._renderTarget;i.texture&&(i.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(i),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(i){var n;if(this.coroutines[i]){const r=this.coroutines[i];for(let o=0;o<r.length;o++)try{const a=r[o];if(!a.comp||a.comp.destroyed||!a.main||a.comp.enabled===!1){DH&&console.log("Removing coroutine",a.comp,a.comp.enabled),r.splice(o,1),--o;continue}const c=a.chained;if(c&&c.length>0){const p=c[c.length-1].next();if(p.done&&c.pop(),t(p)&&(a.chained||(a.chained=[]),a.chained.push(p.value)),!p.done)continue}const u=a.main.next();if(u.done===!0){r.splice(o,1),--o;continue}const d=u.value;if(t(d)){if(d.next().done)continue;a.chained||(a.chained=[]),a.chained.push(d)}else if(d instanceof Promise){const f=d;a.chained||(a.chained=[]);const p=H6(f);(n=a.chained)==null||n.push(p);continue}}catch(a){console.error(a)}}function t(r){return!!(r&&r.next&&r.return)}}};let Ge=Kt;h(Ge,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),h(Ge,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:Cu()||S1()?"default":"high-performance"});const fo=Q("debuglicense");let fu="basic";fo&&console.log("License Type: "+fu);function pu(){switch(fu){case"pro":case"enterprise":return!0}return!1}function SO(){switch(fu){case"indie":return!0}return!1}function eh(){return pu()||SO()}const EO=[];function OH(s){if(pu()||SO())return s(!0);EO.push(s)}function LH(s){for(const i of EO)try{i(s)}catch{}}xt.registerCallback(ut.ContextRegistered,s=>{NH(s.context),QH(),UH(s.context)});let th,Nx=!1,qp="";async function FH(){if(th)return th;if(fu==="basic")try{const s="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+Yo+"&generator="+encodeURIComponent(fS),i=await fetch(s,{method:"GET"}).catch(t=>{fo&&console.error("License check failed",t)});(i==null?void 0:i.status)===200?(Nx=!1,fo&&console.log("License check succeeded"),fu="pro",LH(!0)):(i==null?void 0:i.status)===403?(Nx=!0,qp=await i.text()):fo&&console.log("License check failed with status "+(i==null?void 0:i.status))}catch(s){fo&&console.error("License check failed",s)}else fo&&console.log('Runtime license check is skipped because license is already applied as "'+fu+'"')}th=FH();async function UH(s){function i(){const r=document.createElement("div");r.className="needle-forbidden",r.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const o=r.style.cssText,a=document.createElement("div");r.appendChild(a),a.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const l=a.style.cssText,c=(qp==null?void 0:qp.length)>1?qp:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return a.innerHTML=c,setInterval(()=>{a.innerHTML!==c&&(a.innerHTML=c),a.parentNode!==r&&r.appendChild(a),r.style.cssText!==o&&(r.style.cssText=o),a.style.cssText!==l&&(a.style.cssText=l)},500),r}let t=i();const n=t.style.cssText;setInterval(()=>{var r;Nx===!0&&(t.style.cssText!==n&&(t=i()),s.domElement.shadowRoot?t.parentNode!==s.domElement.shadowRoot&&((r=s.domElement.shadowRoot)==null||r.appendChild(t)):t.parentNode!=document.body&&document.body.appendChild(t))},500)}async function NH(s){try{if(eh()!==!0)return B_(s)}catch(i){return fo&&console.log("License check failed",i),B_(s)}fo&&B_(s)}async function B_(s){s.domElement.addEventListener("ready",()=>!0),await(th==null?void 0:th.catch(()=>{})),!eh()&&zH()}let VT=0;async function zH(s){var a;const i=Date.now();if(i-VT<2e3)return;VT=i;const n=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,o=`Needle Engine â€” No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${Yo}`;(a=Ge.Current)!=null&&a.xr?console.log(o):console.log("%c "+o,n)}async function QH(){var s;try{const i="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(i){fo&&console.log("Analytics backend url",i);const t=window.location.href.split("?")[0];let n="api/v2/new/request";i.endsWith("/")||(n="/"+n);const r=fu,o=`${i}${n}`;fo&&console.log("Sending non-commercial usage message to analytics backend",o);const a={license:r,url:t,hostname:window.location.hostname,pathname:window.location.pathname,version:Yo,generator:fS,build_time:tk},l=(s=navigator.sendBeacon)==null?void 0:s.call(navigator,o,JSON.stringify(a));fo&&console.log("Send beacon result",l)}}catch(i){fo&&console.log("Failed to send non-commercial usage message to analytics backend",i)}}const Yh=Q("debugloading"),wp=Q("debugloadingrendering"),WT=Q("debuglicense");class WK{constructor(){h(this,"className");h(this,"additionalClasses")}}let xp=0,qT;function IO(s){Yh&&console.log(s.progress.loaded.toFixed(0)+"/"+s.progress.total.toFixed(0),s);const i=s.count,t=s.progress.total;t===0||t===void 0?(qT!==s.name&&(xp=0),qT=s.name,xp+=(1-xp)*.001,Yh&&Xt("Loading "+s.name+" did not report total size")):xp=s.progress.loaded/t;const n=s.index/i+xp/i;return ye.clamp01(n)}const Xy=class{constructor(i,t){h(this,"loadingProgress",0);h(this,"_element");h(this,"_progress",0);h(this,"_allowCustomLoadingElement",!0);h(this,"_loadingElement");h(this,"_loadingTextContainer",null);h(this,"_loadingBar",null);h(this,"_messageContainer",null);h(this,"_loadingElementOptions");h(this,"_progressLoop");this._element=i,this._loadingElementOptions=t}async onLoadingBegin(i){const t=this._element.shadowRoot||this._element;if(Yh&&console.warn("Begin Loading"),!this._loadingElement){for(let n=0;n<t.children.length;n++){const r=t.children[n];if(r.classList.contains(Xy.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){Yh&&console.warn("Remove custom loading container"),t.removeChild(r);continue}this._loadingElement=this.createLoadingElement(r)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(i??"")}onLoadingUpdate(i,t){var r;if(!((r=this._loadingElement)!=null&&r.parentNode))return;let n=0;typeof i=="number"?n=i:("index"in i&&(n=IO(i)),!t&&"name"in i&&this.setMessage("loading "+i.name)),this.loadingProgress=n,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){Yh&&console.warn("Finished Loading"),wp||(this.loadingProgress=1,this.onDoneLoading())}setMessage(i){this._messageContainer&&(this._messageContainer.innerText=i)}smoothProgressLoop(){if(this._progressLoop)return;let i=1/12;wp&&(i=1/500,typeof wp=="number"&&(i*=wp)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!wp&&(i=.9),this._progress=ye.lerp(this._progress,this.loadingProgress,i*this.loadingProgress),this.updateDisplay()},i)}onDoneLoading(){this._loadingElement&&(Yh&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const i=this._progress,t=(i*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=i*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(i){var m,A;Yh&&!i&&console.log("Creating loading element"),this._loadingElement=i||document.createElement("div");let t=this._element.getAttribute("loading-style");(!t||t==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const n=pu();if(!i&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",n&&this._element)){const y=this._element.getAttribute("loading-background-color");y&&(this._loadingElement.style.backgroundColor=y);const b=this._element.getAttribute("loading-text-color");b&&(this._loadingElement.style.color=b)}const r=((m=this._loadingElementOptions)==null?void 0:m.className)??Xy.LoadingContainerClassName;if(this._loadingElement.classList.add(r),(A=this._loadingElementOptions)!=null&&A.additionalClasses)for(const y of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(y);const o=document.createElement("div");this._loadingElement.appendChild(o);const a=document.createElement("img"),l=120;a.style.width=`${l}px`,a.style.height=`${l}px`,a.style.paddingTop="20px",a.style.paddingBottom="10px",a.style.margin="0px",a.style.userSelect="none",a.style.objectFit="contain",a.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",a.style.transform="translateY(30px)",a.style.opacity="0.05",setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0px)"},1),a.src=Fz;let c=!1;if(n&&this._element){const y=this._element.getAttribute("loading-logo-src");y&&(c=!0,a.src=y)}c||(a.style.cursor="pointer",a.style.pointerEvents="all",a.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),o.appendChild(a);const u=document.createElement("div");u.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{u.style.opacity="1"},1),this._loadingElement.appendChild(u);const d=document.createElement("div"),f=100;d.style.display="flex",d.style.width=f+"%",d.style.height="3px",d.style.position="absolute",d.style.left="0",d.style.bottom="0px",d.style.opacity="0",d.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{d.style.opacity="1"},1),t==="light"?d.style.backgroundColor="rgba(0,0,0,.2)":d.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(d),this._loadingBar=document.createElement("div"),d.appendChild(this._loadingBar);const p=function(y){return ye.lerp(0,f,y)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${p(0)}, #0BA398 ${p(.3)}, #66A22F ${p(.6)}, #D7DB0A ${p(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",n&&this._element){const y=this._element.getAttribute("primary-color"),b=this._element.getAttribute("secondary-color");y&&b?this._loadingBar.style.background=`linear-gradient(90deg, ${y} ${p(0)}, ${b} ${p(1)})`:y?this._loadingBar.style.background=y:b&&(this._loadingBar.style.background=b)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",u.appendChild(this._loadingTextContainer);const g=document.createElement("div");if(this._messageContainer=g,g.style.display="flex",g.style.fontSize=".8rem",g.style.paddingTop=".1rem",g.style.justifyContent="center",u.appendChild(g),n&&this._element){const y=this._element.getAttribute("loading-text-color");y&&(g.style.color=y)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(i){let t=eh();if(t)return;WT&&console.log("Loading UI has commercial license?",t);const n=document.createElement("div");n.style.paddingTop=".6em",n.style.fontSize=".8em",n.style.textTransform="uppercase",n.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,n.style.cursor="pointer",n.style.userSelect="none",n.style.textAlign="center",n.style.pointerEvents="all",n.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),n.style.opacity="0",i.appendChild(n),!be()&&th&&(WT&&console.log("Waiting for runtime license check"),await th,t=eh()),!t&&(n.style.transition="opacity .5s ease-in-out",n.style.opacity="1")}};let Dv=Xy;h(Dv,"LoadingContainerClassName","loading");const Cp=Q("debugoverlay"),TO="ar",jH="quit-ar";class GH{constructor(){h(this,"arContainer",null);h(this,"currentSession",null);h(this,"_createdAROnlyElements",[]);h(this,"_reparentedObjects",[]);h(this,"contentElement",null);h(this,"originalDomOverlayParent",null);h(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(i,t,n){var r;if(this.currentSession=n,this.arContainer=t,rf()){const o=i.domElement.children;for(let a=0;a<(o==null?void 0:o.length);a++){const l=o[a];if(!l||l===this.arContainer)return;this._reparentedObjects.push({el:l,previousParent:l.parentElement}),(r=this.arContainer)==null||r.appendChild(l)}t?(this.originalDomOverlayParent=t.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",t,t.style.display),t.style.display="",t.style.visibility="",document.body.appendChild(t))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(i){var t;for(const n of this._createdAROnlyElements)n.remove&&n.remove();for(const n of this._reparentedObjects){const r=n.el;(t=n.previousParent)==null||t.appendChild(r)}this._reparentedObjects.length=0,rf()&&setTimeout(()=>{var a;const n=i.renderer.domElement;n&&((a=i.domElement.shadowRoot)==null||a.prepend(n));const r=document.querySelectorAll("*");for(var o=0;o<r.length;o++){const l=r[o];l&&l._displayChanged!==void 0&&l._displayWas!==void 0&&(l.style.display=l._displayWas)}},10)}createOverlayContainer(i){if(this.contentElement)return this.contentElement;Cp&&console.log("Setup overlay container");const t=i.shadowRoot.querySelector(".content");this.contentElement=t;const n=i.shadowRoot.querySelector(".overlay-content");return n&&t.appendChild(n),Cp&&!uc()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(i){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,i),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const n=document.querySelector(`.${jH}`);if(n){n.addEventListener("click",this.requestEndAR),Cp&&n.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),Cp&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const r=document.createElement("div");r.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(r,t);var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.classList.add("quit-ar-button"),o.setAttribute("width","38px"),o.setAttribute("height","38px"),o.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,r.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),a.setAttribute("stroke","#fff"),a.setAttribute("stroke-width","3px"),a.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,o.appendChild(a),Cp&&console.log("Created fallback close button",o,i)}appendElement(i,t){return t.shadowRoot?t.shadowRoot.appendChild(i):t.appendChild(i)}}const P0=Q("debugdecoders");let P_="https://www.gstatic.com/draco/versioned/decoders/1.5.7/";fetch(P_+"draco_decoder.js",{method:"head"}).catch(s=>{be()&&console.warn('Failed to load draco decoder from "'+P_+`".
Falling back to local version at "./include/draco"`),P_="./include/draco/"});let M_,k_=null;function M0(){if(!k_){const s=wS(null);k_={dracoLoader:s.dracoLoader,ktx2Loader:s.ktx2Loader,meshoptDecoder:s.meshoptDecoder}}return k_}function XT(s){if(s!==void 0&&typeof s=="string"){const i=M0();P0&&console.log("Setting draco decoder path to",s),i.dracoLoader.setDecoderPath(s),OG(s)}}function YT(s){if(s!==void 0&&typeof s=="string"){const i=M0();P0&&console.log("Setting draco decoder type to",s),i.dracoLoader.setDecoderConfig({type:s})}}function KT(s){if(s!==void 0&&typeof s=="string"){const i=M0();P0&&console.log("Setting ktx2 transcoder path to",s),i.ktx2Loader.setTranscoderPath(s),LG(s)}}function k0(s,i){const t=M0();return M_||(M_=t.meshoptDecoder,P0&&console.log("Using the default meshopt decoder")),i.renderer?t.ktx2Loader.detectSupport(i.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),s.dracoLoader||s.setDRACOLoader(t.dracoLoader),s.ktx2Loader||s.setKTX2Loader(t.ktx2Loader),s.meshoptDecoder||s.setMeshoptDecoder(M_),s}function RO(s,i,t){const n=t.length-s-1;if(i>=t[n])return n-1;if(i<=t[s])return s;let r=s,o=n,a=Math.floor((r+o)/2);for(;i<t[a]||i>=t[a+1];)i<t[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function HH(s,i,t,n){const r=[],o=[],a=[];r[0]=1;for(let l=1;l<=t;++l){o[l]=i-n[s+1-l],a[l]=n[s+l]-i;let c=0;for(let u=0;u<l;++u){const d=a[u+1],f=o[l-u],p=r[u]/(d+f);r[u]=c+d*p,c=f*p}r[l]=c}return r}function VH(s,i,t,n){const r=RO(s,n,i),o=HH(r,n,s,i),a=new Ue(0,0,0,0);for(let l=0;l<=s;++l){const c=t[r-s+l],u=o[l],d=c.w*u;a.x+=c.x*d,a.y+=c.y*d,a.z+=c.z*d,a.w+=c.w*u}return a}function WH(s,i,t,n,r){const o=[];for(let f=0;f<=t;++f)o[f]=0;const a=[];for(let f=0;f<=n;++f)a[f]=o.slice(0);const l=[];for(let f=0;f<=t;++f)l[f]=o.slice(0);l[0][0]=1;const c=o.slice(0),u=o.slice(0);for(let f=1;f<=t;++f){c[f]=i-r[s+1-f],u[f]=r[s+f]-i;let p=0;for(let g=0;g<f;++g){const m=u[g+1],A=c[f-g];l[f][g]=m+A;const y=l[g][f-1]/l[f][g];l[g][f]=p+m*y,p=A*y}l[f][f]=p}for(let f=0;f<=t;++f)a[0][f]=l[f][t];for(let f=0;f<=t;++f){let p=0,g=1;const m=[];for(let A=0;A<=t;++A)m[A]=o.slice(0);m[0][0]=1;for(let A=1;A<=n;++A){let y=0;const b=f-A,_=t-A;f>=A&&(m[g][0]=m[p][0]/l[_+1][b],y=m[g][0]*l[b][_]);const w=b>=-1?1:-b,S=f-1<=_?A-1:t-f;for(let I=w;I<=S;++I)m[g][I]=(m[p][I]-m[p][I-1])/l[_+1][b+I],y+=m[g][I]*l[b+I][_];f<=_&&(m[g][A]=-m[p][A-1]/l[_+1][f],y+=m[g][A]*l[f][_]),a[A][f]=y;const E=p;p=g,g=E}}let d=t;for(let f=1;f<=n;++f){for(let p=0;p<=t;++p)a[f][p]*=d;d*=t-f}return a}function qH(s,i,t,n,r){const o=r<s?r:s,a=[],l=RO(s,n,i),c=WH(l,n,s,o,i),u=[];for(let d=0;d<t.length;++d){const f=t[d].clone(),p=f.w;f.x*=p,f.y*=p,f.z*=p,u[d]=f}for(let d=0;d<=o;++d){const f=u[l-s].clone().multiplyScalar(c[d][0]);for(let p=1;p<=s;++p)f.add(u[l-s+p].clone().multiplyScalar(c[d][p]));a[d]=f}for(let d=o+1;d<=r+1;++d)a[d]=new Ue(0,0,0);return a}function XH(s,i){let t=1;for(let r=2;r<=s;++r)t*=r;let n=1;for(let r=2;r<=i;++r)n*=r;for(let r=2;r<=s-i;++r)n*=r;return t/n}function YH(s){const i=s.length,t=[],n=[];for(let o=0;o<i;++o){const a=s[o];t[o]=new x(a.x,a.y,a.z),n[o]=a.w}const r=[];for(let o=0;o<i;++o){const a=t[o].clone();for(let l=1;l<=o;++l)a.sub(r[o-l].clone().multiplyScalar(XH(o,l)*n[l]));r[o]=a.divideScalar(n[0])}return r}function KH(s,i,t,n,r){const o=qH(s,i,t,n,r);return YH(o)}class JH extends _F{constructor(i,t,n,r,o){super(),this.degree=i,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<n.length;++a){const l=n[a];this.controlPoints[a]=new Ue(l.x,l.y,l.z,l.w)}}getPoint(i,t=new x){const n=t,r=this.knots[this.startKnot]+i*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=VH(this.degree,this.knots,this.controlPoints,r);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(i,t=new x){const n=t,r=this.knots[0]+i*(this.knots[this.knots.length-1]-this.knots[0]),o=KH(this.degree,this.knots,this.controlPoints,r,1);return n.copy(o[1]).normalize(),n}}let st,Li,zs;class BO extends ch{constructor(i){super(i)}load(i,t,n,r){const o=this,a=o.path===""?tf.extractUrlBase(i):o.path,l=new Lr(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(i,function(c){try{t(o.parse(c,a))}catch(u){r?r(u):console.error(u),o.manager.itemError(i)}},n,r)}parse(i,t){if(nV(i))st=new iV().parse(i);else{const r=DO(i);if(!sV(r))throw new Error("THREE.FBXLoader: Unknown format.");if(ZT(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ZT(r));st=new tV().parse(r)}const n=new Xa(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new ZH(n,this.manager).parse(st)}}class ZH{constructor(i,t){this.textureLoader=i,this.manager=t}parse(){Li=this.parseConnections();const i=this.parseImages(),t=this.parseTextures(i),n=this.parseMaterials(t),r=this.parseDeformers(),o=new $H().parse(r);return this.parseScene(r,o,n),zs}parseConnections(){const i=new Map;return"Connections"in st&&st.Connections.connections.forEach(function(n){const r=n[0],o=n[1],a=n[2];i.has(r)||i.set(r,{parents:[],children:[]});const l={ID:o,relationship:a};i.get(r).parents.push(l),i.has(o)||i.set(o,{parents:[],children:[]});const c={ID:r,relationship:a};i.get(o).children.push(c)}),i}parseImages(){const i={},t={};if("Video"in st.Objects){const n=st.Objects.Video;for(const r in n){const o=n[r],a=parseInt(r);if(i[a]=o.RelativeFilename||o.Filename,"Content"in o){const l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(l||c){const u=this.parseImage(n[r]);t[o.RelativeFilename||o.Filename]=u}}}}for(const n in i){const r=i[n];t[r]!==void 0?i[n]=t[r]:i[n]=i[n].split("\\").pop()}return i}parseImage(i){const t=i.Content,n=i.RelativeFilename||i.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+o+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(i){const t=new Map;if("Texture"in st.Objects){const n=st.Objects.Texture;for(const r in n){const o=this.parseTexture(n[r],i);t.set(parseInt(r),o)}}return t}parseTexture(i,t){const n=this.loadTexture(i,t);n.ID=i.id,n.name=i.attrName;const r=i.WrapModeU,o=i.WrapModeV,a=r!==void 0?r.value:0,l=o!==void 0?o.value:0;if(n.wrapS=a===0?ic:Gv,n.wrapT=l===0?ic:Gv,"Scaling"in i){const c=i.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in i){const c=i.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(i,t){let n;const r=this.textureLoader.path,o=Li.get(i.id).children;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const l=i.FileName.slice(-3).toLowerCase();if(l==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",i.RelativeFilename),a=new At):(c.setPath(this.textureLoader.path),a=c.load(n))}else if(l==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",i.RelativeFilename),a=new At):(c.setPath(this.textureLoader.path),a=c.load(n))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",i.RelativeFilename),a=new At):a=this.textureLoader.load(n);return this.textureLoader.setPath(r),a}parseMaterials(i){const t=new Map;if("Material"in st.Objects){const n=st.Objects.Material;for(const r in n){const o=this.parseMaterial(n[r],i);o!==null&&t.set(parseInt(r),o)}}return t}parseMaterial(i,t){const n=i.id,r=i.attrName;let o=i.ShadingModel;if(typeof o=="object"&&(o=o.value),!Li.has(n))return null;const a=this.parseParameters(i,t,n);let l;switch(o.toLowerCase()){case"phong":l=new pv;break;case"lambert":l=new wF;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new pv;break}return l.setValues(a),l.name=r,l}parseParameters(i,t,n){const r={};i.BumpFactor&&(r.bumpScale=i.BumpFactor.value),i.Diffuse?r.color=new xe().fromArray(i.Diffuse.value).convertSRGBToLinear():i.DiffuseColor&&(i.DiffuseColor.type==="Color"||i.DiffuseColor.type==="ColorRGB")&&(r.color=new xe().fromArray(i.DiffuseColor.value).convertSRGBToLinear()),i.DisplacementFactor&&(r.displacementScale=i.DisplacementFactor.value),i.Emissive?r.emissive=new xe().fromArray(i.Emissive.value).convertSRGBToLinear():i.EmissiveColor&&(i.EmissiveColor.type==="Color"||i.EmissiveColor.type==="ColorRGB")&&(r.emissive=new xe().fromArray(i.EmissiveColor.value).convertSRGBToLinear()),i.EmissiveFactor&&(r.emissiveIntensity=parseFloat(i.EmissiveFactor.value)),i.Opacity&&(r.opacity=parseFloat(i.Opacity.value)),r.opacity<1&&(r.transparent=!0),i.ReflectionFactor&&(r.reflectivity=i.ReflectionFactor.value),i.Shininess&&(r.shininess=i.Shininess.value),i.Specular?r.specular=new xe().fromArray(i.Specular.value).convertSRGBToLinear():i.SpecularColor&&i.SpecularColor.type==="Color"&&(r.specular=new xe().fromArray(i.SpecularColor.value).convertSRGBToLinear());const o=this;return Li.get(n).children.forEach(function(a){const l=a.relationship;switch(l){case"Bump":r.bumpMap=o.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(t,a.ID),r.map!==void 0&&(r.map.colorSpace=He);break;case"DisplacementColor":r.displacementMap=o.getTexture(t,a.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(t,a.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=He);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(t,a.ID);break;case"ReflectionColor":r.envMap=o.getTexture(t,a.ID),r.envMap!==void 0&&(r.envMap.mapping=Ya,r.envMap.colorSpace=He);break;case"SpecularColor":r.specularMap=o.getTexture(t,a.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=He);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(t,a.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),r}getTexture(i,t){return"LayeredTexture"in st.Objects&&t in st.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Li.get(t).children[0].ID),i.get(t)}parseDeformers(){const i={},t={};if("Deformer"in st.Objects){const n=st.Objects.Deformer;for(const r in n){const o=n[r],a=Li.get(parseInt(r));if(o.attrType==="Skin"){const l=this.parseSkeleton(a,n);l.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,i[r]=l}else if(o.attrType==="BlendShape"){const l={id:r};l.rawTargets=this.parseMorphTargets(a,n),l.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=l}}}return{skeletons:i,morphTargets:t}}parseSkeleton(i,t){const n=[];return i.children.forEach(function(r){const o=t[r.ID];if(o.attrType!=="Cluster")return;const a={ID:r.ID,indices:[],weights:[],transformLink:new le().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(i,t){const n=[];for(let r=0;r<i.children.length;r++){const o=i.children[r],a=t[o.ID],l={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;l.geoID=Li.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(l)}return n}parseScene(i,t,n){zs=new Fr;const r=this.parseModels(i.skeletons,t,n),o=st.Objects.Model,a=this;r.forEach(function(c){var f;const u=o[c.ID];a.setLookAtProperties(c,u);const d=(f=Li.get(c.ID))==null?void 0:f.parents;d==null||d.forEach(function(p){const g=r.get(p.ID);g!==void 0&&g.add(c)}),c.parent===null&&zs.add(c)}),this.bindSkeleton(i.skeletons,t,r),this.addGlobalSceneSettings(),zs.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=MO(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const l=new eV().parse();zs.children.length===1&&zs.children[0].isGroup&&(zs.children[0].animations=l,zs=zs.children[0]),zs.animations=l}parseModels(i,t,n){const r=new Map,o=st.Objects.Model;for(const a in o){const l=parseInt(a),c=o[a],u=Li.get(l);let d=this.buildSkeleton(u,i,l,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,t,n);break;case"NurbsCurve":d=this.createCurve(u,t);break;case"LimbNode":case"Root":d=new jv;break;case"Null":default:d=new Fr;break}d.name=c.attrName?Nr.sanitizeNodeName(c.attrName):"",d.userData.originalName=c.attrName,d.ID=l}this.getTransformData(d,c),r.set(l,d)}return r}buildSkeleton(i,t,n,r){let o=null;return i==null||i.parents.forEach(function(a){for(const l in t){const c=t[l];c.rawBones.forEach(function(u,d){if(u.ID===a.ID){const f=o;o=new jv,o.matrixWorld.copy(u.transformLink),o.name=r?Nr.sanitizeNodeName(r):"",o.userData.originalName=r,o.ID=n,c.bones[d]=o,f!==null&&o.add(f)}})}}),o}createCamera(i){let t,n;if(i.children.forEach(function(r){const o=st.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new ne;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(l=n.AspectWidth.value,c=n.AspectHeight.value);const u=l/c;let d=45;n.FieldOfView!==void 0&&(d=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new bt(d,u,o,a),f!==null&&t.setFocalLength(f);break;case 1:t=new ku(-l/2,l/2,c/2,-c/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new ne;break}}return t}createLight(i){let t,n;if(i.children.forEach(function(r){const o=st.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new ne;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new xe().fromArray(n.Color.value).convertSRGBToLinear());let a=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(a=0);let l=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?l=0:l=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new Ng(o,a,l,c);break;case 1:t=new zg(o,a);break;case 2:let u=Math.PI/3;n.InnerAngle!==void 0&&(u=ct.degToRad(n.InnerAngle.value));let d=0;n.OuterAngle!==void 0&&(d=ct.degToRad(n.OuterAngle.value),d=Math.max(d,1)),t=new RC(o,a,l,u,d,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Ng(o,a);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(i,t,n){let r,o=null,a=null;const l=[];return i.children.forEach(function(c){t.has(c.ID)&&(o=t.get(c.ID)),n.has(c.ID)&&l.push(n.get(c.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new pv({name:ch.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(a)),"color"in o.attributes&&l.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(r=new $o(o,a),r.normalizeSkinWeights()):r=new Z(o,a),r}createCurve(i,t){const n=i.children.reduce(function(o,a){return t.has(a.ID)&&(o=t.get(a.ID)),o},null),r=new Zo({name:ch.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new ms(n,r)}getTransformData(i,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=kO(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),i.userData.transformData=n}setLookAtProperties(i,t){"LookAtProperty"in t&&Li.get(i.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const o=st.Objects.Model[r.ID];if("Lcl_Translation"in o){const a=o.Lcl_Translation.value;i.target!==void 0?(i.target.position.fromArray(a),zs.add(i.target)):i.lookAt(new x().fromArray(a))}}})}bindSkeleton(i,t,n){const r=this.parsePoseNodes();for(const o in i){const a=i[o];Li.get(parseInt(a.ID)).parents.forEach(function(c){if(t.has(c.ID)){const u=c.ID;Li.get(u).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new BC(a.bones),r[f.ID])})}})}}parsePoseNodes(){const i={};if("Pose"in st.Objects){const t=st.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(o){i[o.Node]=new le().fromArray(o.Matrix.a)}):i[r.Node]=new le().fromArray(r.Matrix.a)}}return i}addGlobalSceneSettings(){if("GlobalSettings"in st){if("AmbientColor"in st.GlobalSettings){const i=st.GlobalSettings.AmbientColor.value,t=i[0],n=i[1],r=i[2];if(t!==0||n!==0||r!==0){const o=new xe(t,n,r).convertSRGBToLinear();zs.add(new FP(o,1))}}"UnitScaleFactor"in st.GlobalSettings&&(zs.userData.unitScaleFactor=st.GlobalSettings.UnitScaleFactor.value)}}}class $H{constructor(){this.negativeMaterialIndices=!1}parse(i){const t=new Map;if("Geometry"in st.Objects){const n=st.Objects.Geometry;for(const r in n){const o=Li.get(parseInt(r)),a=this.parseGeometry(o,n[r],i);t.set(parseInt(r),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(i,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(i,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(i,t,n){const r=n.skeletons,o=[],a=i.parents.map(function(f){return st.Objects.Model[f.ID]});if(a.length===0)return;const l=i.children.reduce(function(f,p){return r[p.ID]!==void 0&&(f=r[p.ID]),f},null);i.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&o.push(n.morphTargets[f.ID])});const c=a[0],u={};"RotationOrder"in c&&(u.eulerOrder=kO(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const d=MO(u);return this.genGeometry(t,l,o,d)}genGeometry(i,t,n,r){const o=new Vt;i.attrName&&(o.name=i.attrName);const a=this.parseGeoNode(i,t),l=this.genBuffers(a),c=new ln(l.vertex,3);if(c.applyMatrix4(r),o.setAttribute("position",c),l.colors.length>0&&o.setAttribute("color",new ln(l.colors,3)),t&&(o.setAttribute("skinIndex",new xF(l.weightsIndices,4)),o.setAttribute("skinWeight",new ln(l.vertexWeights,4)),o.FBX_Deformer=t),l.normal.length>0){const u=new za().getNormalMatrix(r),d=new ln(l.normal,3);d.applyNormalMatrix(u),o.setAttribute("normal",d)}if(l.uvs.forEach(function(u,d){const f=d===0?"uv":`uv${d}`;o.setAttribute(f,new ln(l.uvs[d],2))}),a.material&&a.material.mappingType!=="AllSame"){let u=l.materialIndex[0],d=0;if(l.materialIndex.forEach(function(f,p){f!==u&&(o.addGroup(d,p-d,u),u=f,d=p)}),o.groups.length>0){const f=o.groups[o.groups.length-1],p=f.start+f.count;p!==l.materialIndex.length&&o.addGroup(p,l.materialIndex.length-p,u)}o.groups.length===0&&o.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(o,i,n,r),o}parseGeoNode(i,t){const n={};if(n.vertexPositions=i.Vertices!==void 0?i.Vertices.a:[],n.vertexIndices=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],i.LayerElementColor&&(n.color=this.parseVertexColors(i.LayerElementColor[0])),i.LayerElementMaterial&&(n.material=this.parseMaterialIndices(i.LayerElementMaterial[0])),i.LayerElementNormal&&(n.normal=this.parseNormals(i.LayerElementNormal[0])),i.LayerElementUV){n.uv=[];let r=0;for(;i.LayerElementUV[r];)i.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(i.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,o){r.indices.forEach(function(a,l){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:o,weight:r.weights[l]})})})),n}genBuffers(i){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,o=!1,a=[],l=[],c=[],u=[],d=[],f=[];const p=this;return i.vertexIndices.forEach(function(g,m){let A,y=!1;g<0&&(g=g^-1,y=!0);let b=[],_=[];if(a.push(g*3,g*3+1,g*3+2),i.color){const w=MA(m,n,g,i.color);c.push(w[0],w[1],w[2])}if(i.skeleton){if(i.weightTable[g]!==void 0&&i.weightTable[g].forEach(function(w){_.push(w.weight),b.push(w.id)}),_.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const w=[0,0,0,0],S=[0,0,0,0];_.forEach(function(E,I){let k=E,T=b[I];S.forEach(function(P,B,M){if(k>P){M[B]=k,k=P;const U=w[B];w[B]=T,T=U}})}),b=w,_=S}for(;_.length<4;)_.push(0),b.push(0);for(let w=0;w<4;++w)d.push(_[w]),f.push(b[w])}if(i.normal){const w=MA(m,n,g,i.normal);l.push(w[0],w[1],w[2])}i.material&&i.material.mappingType!=="AllSame"&&(A=MA(m,n,g,i.material)[0],A<0&&(p.negativeMaterialIndices=!0,A=0)),i.uv&&i.uv.forEach(function(w,S){const E=MA(m,n,g,w);u[S]===void 0&&(u[S]=[]),u[S].push(E[0]),u[S].push(E[1])}),r++,y&&(p.genFace(t,i,a,A,l,c,u,d,f,r),n++,r=0,a=[],l=[],c=[],u=[],d=[],f=[])}),t}getNormalNewell(i){const t=new x(0,0,0);for(let n=0;n<i.length;n++){const r=i[n],o=i[(n+1)%i.length];t.x+=(r.y-o.y)*(r.z+o.z),t.y+=(r.z-o.z)*(r.x+o.x),t.z+=(r.x-o.x)*(r.y+o.y)}return t.normalize(),t}getNormalTangentAndBitangent(i){const t=this.getNormalNewell(i),r=(Math.abs(t.z)>.5?new x(0,1,0):new x(0,0,1)).cross(t).normalize(),o=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:o}}flattenVertex(i,t,n){return new ae(i.dot(t),i.dot(n))}genFace(i,t,n,r,o,a,l,c,u,d){let f;if(d>3){const p=[];for(let y=0;y<n.length;y+=3)p.push(new x(t.vertexPositions[n[y]],t.vertexPositions[n[y+1]],t.vertexPositions[n[y+2]]));const{tangent:g,bitangent:m}=this.getNormalTangentAndBitangent(p),A=[];for(const y of p)A.push(this.flattenVertex(y,g,m));f=CF.triangulateShape(A,[])}else f=[[0,1,2]];for(const[p,g,m]of f)i.vertex.push(t.vertexPositions[n[p*3]]),i.vertex.push(t.vertexPositions[n[p*3+1]]),i.vertex.push(t.vertexPositions[n[p*3+2]]),i.vertex.push(t.vertexPositions[n[g*3]]),i.vertex.push(t.vertexPositions[n[g*3+1]]),i.vertex.push(t.vertexPositions[n[g*3+2]]),i.vertex.push(t.vertexPositions[n[m*3]]),i.vertex.push(t.vertexPositions[n[m*3+1]]),i.vertex.push(t.vertexPositions[n[m*3+2]]),t.skeleton&&(i.vertexWeights.push(c[p*4]),i.vertexWeights.push(c[p*4+1]),i.vertexWeights.push(c[p*4+2]),i.vertexWeights.push(c[p*4+3]),i.vertexWeights.push(c[g*4]),i.vertexWeights.push(c[g*4+1]),i.vertexWeights.push(c[g*4+2]),i.vertexWeights.push(c[g*4+3]),i.vertexWeights.push(c[m*4]),i.vertexWeights.push(c[m*4+1]),i.vertexWeights.push(c[m*4+2]),i.vertexWeights.push(c[m*4+3]),i.weightsIndices.push(u[p*4]),i.weightsIndices.push(u[p*4+1]),i.weightsIndices.push(u[p*4+2]),i.weightsIndices.push(u[p*4+3]),i.weightsIndices.push(u[g*4]),i.weightsIndices.push(u[g*4+1]),i.weightsIndices.push(u[g*4+2]),i.weightsIndices.push(u[g*4+3]),i.weightsIndices.push(u[m*4]),i.weightsIndices.push(u[m*4+1]),i.weightsIndices.push(u[m*4+2]),i.weightsIndices.push(u[m*4+3])),t.color&&(i.colors.push(a[p*3]),i.colors.push(a[p*3+1]),i.colors.push(a[p*3+2]),i.colors.push(a[g*3]),i.colors.push(a[g*3+1]),i.colors.push(a[g*3+2]),i.colors.push(a[m*3]),i.colors.push(a[m*3+1]),i.colors.push(a[m*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(i.materialIndex.push(r),i.materialIndex.push(r),i.materialIndex.push(r)),t.normal&&(i.normal.push(o[p*3]),i.normal.push(o[p*3+1]),i.normal.push(o[p*3+2]),i.normal.push(o[g*3]),i.normal.push(o[g*3+1]),i.normal.push(o[g*3+2]),i.normal.push(o[m*3]),i.normal.push(o[m*3+1]),i.normal.push(o[m*3+2])),t.uv&&t.uv.forEach(function(A,y){i.uvs[y]===void 0&&(i.uvs[y]=[]),i.uvs[y].push(l[y][p*2]),i.uvs[y].push(l[y][p*2+1]),i.uvs[y].push(l[y][g*2]),i.uvs[y].push(l[y][g*2+1]),i.uvs[y].push(l[y][m*2]),i.uvs[y].push(l[y][m*2+1])})}addMorphTargets(i,t,n,r){if(n.length===0)return;i.morphTargetsRelative=!0,i.morphAttributes.position=[];const o=this;n.forEach(function(a){a.rawTargets.forEach(function(l){const c=st.Objects.Geometry[l.geoID];c!==void 0&&o.genMorphGeometry(i,t,c,r,l.name)})})}genMorphGeometry(i,t,n,r,o){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],u=i.attributes.position.count*3,d=new Float32Array(u);for(let m=0;m<c.length;m++){const A=c[m]*3;d[A]=l[m*3],d[A+1]=l[m*3+1],d[A+2]=l[m*3+2]}const f={vertexIndices:a,vertexPositions:d},p=this.genBuffers(f),g=new ln(p.vertex,3);g.name=o||n.attrName,g.applyMatrix4(r),i.morphAttributes.position.push(g)}parseNormals(i){const t=i.MappingInformationType,n=i.ReferenceInformationType,r=i.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in i?o=i.NormalIndex.a:"NormalsIndex"in i&&(o=i.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:t,referenceType:n}}parseUVs(i){const t=i.MappingInformationType,n=i.ReferenceInformationType,r=i.UV.a;let o=[];return n==="IndexToDirect"&&(o=i.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:t,referenceType:n}}parseVertexColors(i){const t=i.MappingInformationType,n=i.ReferenceInformationType,r=i.Colors.a;let o=[];n==="IndexToDirect"&&(o=i.ColorIndex.a);for(let a=0,l=new xe;a<r.length;a+=4)l.fromArray(r,a).convertSRGBToLinear().toArray(r,a);return{dataSize:4,buffer:r,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(i){const t=i.MappingInformationType,n=i.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=i.Materials.a,o=[];for(let a=0;a<r.length;++a)o.push(a);return{dataSize:1,buffer:r,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(i){const t=parseInt(i.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",i.Order,i.id),new Vt;const n=t-1,r=i.KnotVector.a,o=[],a=i.Points.a;for(let f=0,p=a.length;f<p;f+=4)o.push(new Ue().fromArray(a,f));let l,c;if(i.Form==="Closed")o.push(o[0]);else if(i.Form==="Periodic"){l=n,c=r.length-1-l;for(let f=0;f<n;++f)o.push(o[f])}const d=new JH(n,r,o,l,c).getPoints(o.length*12);return new Vt().setFromPoints(d)}}class eV{parse(){const i=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],o=this.addClip(r);i.push(o)}return i}parseClips(){if(st.Objects.AnimationCurve===void 0)return;const i=this.parseAnimationCurveNodes();this.parseAnimationCurves(i);const t=this.parseAnimationLayers(i);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const i=st.Objects.AnimationCurveNode,t=new Map;for(const n in i){const r=i[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:r.id,attr:r.attrName,curves:{}};t.set(o.id,o)}}return t}parseAnimationCurves(i){const t=st.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(rV),values:t[n].KeyValueFloat.a},o=Li.get(r.id);if(o!==void 0){const a=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?i.get(a).curves.x=r:l.match(/Y/)?i.get(a).curves.y=r:l.match(/Z/)?i.get(a).curves.z=r:l.match(/DeformPercent/)&&i.has(a)&&(i.get(a).curves.morph=r)}}}parseAnimationLayers(i){const t=st.Objects.AnimationLayer,n=new Map;for(const r in t){const o=[],a=Li.get(parseInt(r));a!==void 0&&(a.children.forEach(function(c,u){if(i.has(c.ID)){const d=i.get(c.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(o[u]===void 0){const f=Li.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(f!==void 0){const p=st.Objects.Model[f.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const g={modelName:p.attrName?Nr.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};zs.traverse(function(m){m.ID===p.id&&(g.transform=m.matrix,m.userData.transformData&&(g.eulerOrder=m.userData.transformData.eulerOrder))}),g.transform||(g.transform=new le),"PreRotation"in p&&(g.preRotation=p.PreRotation.value),"PostRotation"in p&&(g.postRotation=p.PostRotation.value),o[u]=g}}o[u]&&(o[u][d.attr]=d)}else if(d.curves.morph!==void 0){if(o[u]===void 0){const f=Li.get(c.ID).parents.filter(function(b){return b.relationship!==void 0})[0].ID,p=Li.get(f).parents[0].ID,g=Li.get(p).parents[0].ID,m=Li.get(g).parents[0].ID,A=st.Objects.Model[m],y={modelName:A.attrName?Nr.sanitizeNodeName(A.attrName):"",morphName:st.Objects.Deformer[f].attrName};o[u]=y}o[u][d.attr]=d}}}),n.set(parseInt(r),o))}return n}parseAnimStacks(i){const t=st.Objects.AnimationStack,n={};for(const r in t){const o=Li.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=i.get(o[0].ID);n[r]={name:t[r].attrName,layer:a}}return n}addClip(i){let t=[];const n=this;return i.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new ql(i.name,-1,t)}generateTracks(i){const t=[];let n=new x,r=new x;if(i.transform&&i.transform.decompose(n,new se,r),n=n.toArray(),r=r.toArray(),i.T!==void 0&&Object.keys(i.T.curves).length>0){const o=this.generateVectorTrack(i.modelName,i.T.curves,n,"position");o!==void 0&&t.push(o)}if(i.R!==void 0&&Object.keys(i.R.curves).length>0){const o=this.generateRotationTrack(i.modelName,i.R.curves,i.preRotation,i.postRotation,i.eulerOrder);o!==void 0&&t.push(o)}if(i.S!==void 0&&Object.keys(i.S.curves).length>0){const o=this.generateVectorTrack(i.modelName,i.S.curves,r,"scale");o!==void 0&&t.push(o)}if(i.DeformPercent!==void 0){const o=this.generateMorphTrack(i);o!==void 0&&t.push(o)}return t}generateVectorTrack(i,t,n,r){const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,n);return new Vv(i+"."+r,o,a)}generateRotationTrack(i,t,n,r,o){let a,l;if(t.x===void 0||t.y===void 0||t.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(t.x===void 0?"x ":"")+(t.y===void 0?"y ":"")+(t.z===void 0?"z ":"")+" for animation of "+i+". This is currently not supported.");return}if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const f=this.interpolateRotations(t.x,t.y,t.z,o);a=f[0],l=f[1]}n!==void 0&&(n=n.map(ct.degToRad),n.push(o),n=new Gt().fromArray(n),n=new se().setFromEuler(n)),r!==void 0&&(r=r.map(ct.degToRad),r.push(o),r=new Gt().fromArray(r),r=new se().setFromEuler(r).invert());const c=new se,u=new Gt,d=[];if(!(!l||!a)){for(let f=0;f<l.length;f+=3)u.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(u),n!==void 0&&c.premultiply(n),r!==void 0&&c.multiply(r),f>2&&new se().fromArray(d,(f-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(d,f/3*4);return new Wv(i+".quaternion",a,d)}}generateMorphTrack(i){const t=i.DeformPercent.curves.morph,n=t.values.map(function(o){return o/100}),r=zs.getObjectByName(i.modelName).morphTargetDictionary[i.morphName];return new Lw(i.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(i){let t=[];if(i.x!==void 0&&(t=t.concat(i.x.times)),i.y!==void 0&&(t=t.concat(i.y.times)),i.z!==void 0&&(t=t.concat(i.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let o=1;o<t.length;o++){const a=t[o];a!==r&&(t[n]=a,r=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(i,t,n){const r=n,o=[];let a=-1,l=-1,c=-1;return i.forEach(function(u){if(t.x&&(a=t.x.times.indexOf(u)),t.y&&(l=t.y.times.indexOf(u)),t.z&&(c=t.z.times.indexOf(u)),a!==-1){const d=t.x.values[a];o.push(d),r[0]=d}else o.push(r[0]);if(l!==-1){const d=t.y.values[l];o.push(d),r[1]=d}else o.push(r[1]);if(c!==-1){const d=t.z.values[c];o.push(d),r[2]=d}else o.push(r[2])}),o}interpolateRotations(i,t,n,r){const o=[],a=[];o.push(i.times[0]),a.push(ct.degToRad(i.values[0])),a.push(ct.degToRad(t.values[0])),a.push(ct.degToRad(n.values[0]));for(let l=1;l<i.values.length;l++){const c=[i.values[l-1],t.values[l-1],n.values[l-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(ct.degToRad),d=[i.values[l],t.values[l],n.values[l]];if(isNaN(d[0])||isNaN(d[1])||isNaN(d[2]))continue;const f=d.map(ct.degToRad),p=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],g=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(g[0]>=180||g[1]>=180||g[2]>=180){const A=Math.max(...g)/180,y=new Gt(...u,r),b=new Gt(...f,r),_=new se().setFromEuler(y),w=new se().setFromEuler(b);_.dot(w)&&w.set(-w.x,-w.y,-w.z,-w.w);const S=i.times[l-1],E=i.times[l]-S,I=new se,k=new Gt;for(let T=0;T<1;T+=1/A)I.copy(_.clone().slerp(w.clone(),T)),o.push(S+T*E),k.setFromQuaternion(I,r),a.push(k.x),a.push(k.y),a.push(k.z)}else o.push(i.times[l]),a.push(ct.degToRad(i.values[l])),a.push(ct.degToRad(t.values[l])),a.push(ct.degToRad(n.values[l]))}return[o,a]}}class tV{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(i){this.nodeStack.push(i),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(i,t){this.currentProp=i,this.currentPropName=t}parse(i){this.currentIndent=0,this.allNodes=new PO,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=i.split(/[\r\n]+/);return n.forEach(function(r,o){const a=r.match(/^[\s\t]*;/),l=r.match(/^[\s\t]*$/);if(a||l)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),d=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):u?t.parseNodeProperty(r,u,n[++o]):d?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(i,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},a=this.parseNodeAttr(r),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in l?(n==="PoseNode"?l.PoseNode.push(o):l[n].id!==void 0&&(l[n]={},l[n][l[n].id]=l[n]),a.id!==""&&(l[n][a.id]=o)):typeof a.id=="number"?(l[n]={},l[n][a.id]=o):n!=="Properties70"&&(n==="PoseNode"?l[n]=[o]:l[n]=o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(i){let t=i[0];i[0]!==""&&(t=parseInt(i[0]),isNaN(t)&&(t=i[0]));let n="",r="";return i.length>1&&(n=i[1].replace(/^(\w+)::/,""),r=i[2]),{id:t,name:n,type:r}}parseNodeProperty(i,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(i,r,o);return}if(r==="C"){const c=o.split(",").slice(1),u=parseInt(c[0]),d=parseInt(c[1]);let f=o.split(",").slice(3);f=f.map(function(p){return p.trim().replace(/^"/,"")}),r="connections",o=[u,d],aV(o,f),a[r]===void 0&&(a[r]=[])}r==="Node"&&(a.id=o),r in a&&Array.isArray(a[r])?a[r].push(o):r!=="a"?a[r]=o:a.a=o,this.setCurrentProp(a,r),r==="a"&&o.slice(-1)!==","&&(a.a=O_(o))}parseNodePropertyContinued(i){const t=this.getCurrentNode();t.a+=i,i.slice(-1)!==","&&(t.a=O_(t.a))}parseNodeSpecialProperty(i,t,n){const r=n.split('",').map(function(d){return d.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=r[0],a=r[1],l=r[2],c=r[3];let u=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=O_(u);break}this.getPrevNode()[o]={type:a,type2:l,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),o)}}class iV{parse(i){const t=new JT(i);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new PO;for(;!this.endOfContent(t);){const o=this.parseNode(t,n);o!==null&&r.add(o.name,o)}return r}endOfContent(i){return i.size()%16===0?(i.getOffset()+160+16&-16)>=i.size():i.getOffset()+160+16>=i.size()}parseNode(i,t){const n={},r=t>=7500?i.getUint64():i.getUint32(),o=t>=7500?i.getUint64():i.getUint32();t>=7500?i.getUint64():i.getUint32();const a=i.getUint8(),l=i.getString(a);if(r===0)return null;const c=[];for(let p=0;p<o;p++)c.push(this.parseProperty(i));const u=c.length>0?c[0]:"",d=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(n.singleProperty=o===1&&i.getOffset()===r;r>i.getOffset();){const p=this.parseNode(i,t);p!==null&&this.parseSubNode(l,n,p)}return n.propertyList=c,typeof u=="number"&&(n.id=u),d!==""&&(n.attrName=d),f!==""&&(n.attrType=f),l!==""&&(n.name=l),n}parseSubNode(i,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(i==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(o,a){a!==0&&r.push(o)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(o){t[o]=n[o]});else if(i==="Properties70"&&n.name==="P"){let r=n.propertyList[0],o=n.propertyList[1];const a=n.propertyList[2],l=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:o,type2:a,flag:l,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(i){const t=i.getString(1);let n;switch(t){case"C":return i.getBoolean();case"D":return i.getFloat64();case"F":return i.getFloat32();case"I":return i.getInt32();case"L":return i.getInt64();case"R":return n=i.getUint32(),i.getArrayBuffer(n);case"S":return n=i.getUint32(),i.getString(n);case"Y":return i.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=i.getUint32(),o=i.getUint32(),a=i.getUint32();if(o===0)switch(t){case"b":case"c":return i.getBooleanArray(r);case"d":return i.getFloat64Array(r);case"f":return i.getFloat32Array(r);case"i":return i.getInt32Array(r);case"l":return i.getInt64Array(r)}const l=Wp(new Uint8Array(i.getArrayBuffer(a))),c=new JT(l.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class JT{constructor(i,t){this.dv=new DataView(i),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(i){this.offset+=i}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(i){const t=[];for(let n=0;n<i;n++)t.push(this.getBoolean());return t}getUint8(){const i=this.dv.getUint8(this.offset);return this.offset+=1,i}getInt16(){const i=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,i}getInt32(){const i=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,i}getInt32Array(i){const t=[];for(let n=0;n<i;n++)t.push(this.getInt32());return t}getUint32(){const i=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,i}getInt64(){let i,t;return this.littleEndian?(i=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),i=this.getUint32()),t&2147483648?(t=~t&4294967295,i=~i&4294967295,i===4294967295&&(t=t+1&4294967295),i=i+1&4294967295,-(t*4294967296+i)):t*4294967296+i}getInt64Array(i){const t=[];for(let n=0;n<i;n++)t.push(this.getInt64());return t}getUint64(){let i,t;return this.littleEndian?(i=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),i=this.getUint32()),t*4294967296+i}getFloat32(){const i=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,i}getFloat32Array(i){const t=[];for(let n=0;n<i;n++)t.push(this.getFloat32());return t}getFloat64(){const i=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,i}getFloat64Array(i){const t=[];for(let n=0;n<i;n++)t.push(this.getFloat64());return t}getArrayBuffer(i){const t=this.dv.buffer.slice(this.offset,this.offset+i);return this.offset+=i,t}getString(i){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,i);this.skip(i);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(n)}}class PO{add(i,t){this[i]=t}}function nV(s){const i="Kaydara FBX Binary  \0";return s.byteLength>=i.length&&i===DO(s,0,i.length)}function sV(s){const i=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const o=s[r-1];return s=s.slice(t+r),t++,o}for(let r=0;r<i.length;++r)if(n(1)===i[r])return!1;return!0}function ZT(s){const i=/FBXVersion: (\d+)/,t=s.match(i);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function rV(s){return s/46186158e3}const oV=[];function MA(s,i,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=s;break;case"ByPolygon":r=i;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const o=r*n.dataSize,a=o+n.dataSize;return lV(oV,n.buffer,o,a)}const D_=new Gt,ud=new x;function MO(s){const i=new le,t=new le,n=new le,r=new le,o=new le,a=new le,l=new le,c=new le,u=new le,d=new le,f=new le,p=new le,g=s.inheritType?s.inheritType:0;if(s.translation&&i.setPosition(ud.fromArray(s.translation)),s.preRotation){const B=s.preRotation.map(ct.degToRad);B.push(s.eulerOrder||Gt.DEFAULT_ORDER),t.makeRotationFromEuler(D_.fromArray(B))}if(s.rotation){const B=s.rotation.map(ct.degToRad);B.push(s.eulerOrder||Gt.DEFAULT_ORDER),n.makeRotationFromEuler(D_.fromArray(B))}if(s.postRotation){const B=s.postRotation.map(ct.degToRad);B.push(s.eulerOrder||Gt.DEFAULT_ORDER),r.makeRotationFromEuler(D_.fromArray(B)),r.invert()}s.scale&&o.scale(ud.fromArray(s.scale)),s.scalingOffset&&l.setPosition(ud.fromArray(s.scalingOffset)),s.scalingPivot&&a.setPosition(ud.fromArray(s.scalingPivot)),s.rotationOffset&&c.setPosition(ud.fromArray(s.rotationOffset)),s.rotationPivot&&u.setPosition(ud.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(f.copy(s.parentMatrix),d.copy(s.parentMatrixWorld));const m=t.clone().multiply(n).multiply(r),A=new le;A.extractRotation(d);const y=new le;y.copyPosition(d);const b=y.clone().invert().multiply(d),_=A.clone().invert().multiply(b),w=o,S=new le;if(g===0)S.copy(A).multiply(m).multiply(_).multiply(w);else if(g===1)S.copy(A).multiply(_).multiply(m).multiply(w);else{const M=new le().scale(new x().setFromMatrixScale(f)).clone().invert(),U=_.clone().multiply(M);S.copy(A).multiply(m).multiply(U).multiply(w)}const E=u.clone().invert(),I=a.clone().invert();let k=i.clone().multiply(c).multiply(u).multiply(t).multiply(n).multiply(r).multiply(E).multiply(l).multiply(a).multiply(o).multiply(I);const T=new le().copyPosition(k),P=d.clone().multiply(T);return p.copyPosition(P),k=p.clone().multiply(S),k.premultiply(d.invert()),k}function kO(s){s=s||0;const i=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),i[0]):i[s]}function O_(s){return s.split(",").map(function(t){return parseFloat(t)})}function DO(s,i,t){return i===void 0&&(i=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,i,t))}function aV(s,i){for(let t=0,n=s.length,r=i.length;t<r;t++,n++)s[n]=i[t]}function lV(s,i,t,n){for(let r=t,o=0;r<n;r++,o++)s[o]=i[r];return s}const cV=/^[og]\s*(.+)?/,hV=/^mtllib /,uV=/^usemtl /,dV=/^usemap /,$T=/\s+/,eR=new x,L_=new x,tR=new x,iR=new x,Zr=new x,kA=new xe;function fV(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(i,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=i,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:i||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const l={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const u={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return u.clone=this.clone.bind(u),u}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},n&&n.name&&typeof n.clone=="function"){const r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(i,t){const n=parseInt(i,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(i,t){const n=parseInt(i,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(i,t){const n=parseInt(i,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(i,t,n){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[i+0],r[i+1],r[i+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(i){const t=this.vertices;this.object.geometry.vertices.push(t[i+0],t[i+1],t[i+2])},addVertexLine:function(i){const t=this.vertices;this.object.geometry.vertices.push(t[i+0],t[i+1],t[i+2])},addNormal:function(i,t,n){const r=this.normals,o=this.object.geometry.normals;o.push(r[i+0],r[i+1],r[i+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(i,t,n){const r=this.vertices,o=this.object.geometry.normals;eR.fromArray(r,i),L_.fromArray(r,t),tR.fromArray(r,n),Zr.subVectors(tR,L_),iR.subVectors(eR,L_),Zr.cross(iR),Zr.normalize(),o.push(Zr.x,Zr.y,Zr.z),o.push(Zr.x,Zr.y,Zr.z),o.push(Zr.x,Zr.y,Zr.z)},addColor:function(i,t,n){const r=this.colors,o=this.object.geometry.colors;r[i]!==void 0&&o.push(r[i+0],r[i+1],r[i+2]),r[t]!==void 0&&o.push(r[t+0],r[t+1],r[t+2]),r[n]!==void 0&&o.push(r[n+0],r[n+1],r[n+2])},addUV:function(i,t,n){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[i+0],r[i+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addDefaultUV:function(){const i=this.object.geometry.uvs;i.push(0,0),i.push(0,0),i.push(0,0)},addUVLine:function(i){const t=this.uvs;this.object.geometry.uvs.push(t[i+0],t[i+1])},addFace:function(i,t,n,r,o,a,l,c,u){const d=this.vertices.length;let f=this.parseVertexIndex(i,d),p=this.parseVertexIndex(t,d),g=this.parseVertexIndex(n,d);if(this.addVertex(f,p,g),this.addColor(f,p,g),l!==void 0&&l!==""){const m=this.normals.length;f=this.parseNormalIndex(l,m),p=this.parseNormalIndex(c,m),g=this.parseNormalIndex(u,m),this.addNormal(f,p,g)}else this.addFaceNormal(f,p,g);if(r!==void 0&&r!==""){const m=this.uvs.length;f=this.parseUVIndex(r,m),p=this.parseUVIndex(o,m),g=this.parseUVIndex(a,m),this.addUV(f,p,g),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(i){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=i.length;n<r;n++){const o=this.parseVertexIndex(i[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(i,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let o=0,a=i.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(i[o],n));for(let o=0,a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return s.startObject("",!1),s}class qS extends ch{constructor(i){super(i),this.materials=null}load(i,t,n,r){const o=this,a=new Lr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(l){try{t(o.parse(l))}catch(c){r?r(c):console.error(c),o.manager.itemError(i)}},n,r)}setMaterials(i){return this.materials=i,this}parse(i){const t=new fV;i.indexOf(`\r
`)!==-1&&(i=i.replace(/\r\n/g,`
`)),i.indexOf(`\\
`)!==-1&&(i=i.replace(/\\\n/g,""));const n=i.split(`
`);let r=[];for(let l=0,c=n.length;l<c;l++){const u=n[l].trimStart();if(u.length===0)continue;const d=u.charAt(0);if(d!=="#")if(d==="v"){const f=u.split($T);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(kA.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),t.colors.push(kA.r,kA.g,kA.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(d==="f"){const p=u.slice(1).trim().split($T),g=[];for(let A=0,y=p.length;A<y;A++){const b=p[A];if(b.length>0){const _=b.split("/");g.push(_)}}const m=g[0];for(let A=1,y=g.length-1;A<y;A++){const b=g[A],_=g[A+1];t.addFace(m[0],b[0],_[0],m[1],b[1],_[1],m[2],b[2],_[2])}}else if(d==="l"){const f=u.substring(1).trim().split(" ");let p=[];const g=[];if(u.indexOf("/")===-1)p=f;else for(let m=0,A=f.length;m<A;m++){const y=f[m].split("/");y[0]!==""&&p.push(y[0]),y[1]!==""&&g.push(y[1])}t.addLineGeometry(p,g)}else if(d==="p"){const p=u.slice(1).trim().split(" ");t.addPointGeometry(p)}else if((r=cV.exec(u))!==null){const f=(" "+r[0].slice(1).trim()).slice(1);t.startObject(f)}else if(uV.test(u))t.object.startMaterial(u.substring(7).trim(),t.materialLibraries);else if(hV.test(u))t.materialLibraries.push(u.substring(7).trim());else if(dV.test(u))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(d==="s"){if(r=u.split(" "),r.length>1){const p=r[1].trim().toLowerCase();t.object.smooth=p!=="0"&&p!=="off"}else t.object.smooth=!0;const f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(u==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+u+'"')}}t.finalize();const o=new Fr;if(o.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let l=0,c=t.objects.length;l<c;l++){const u=t.objects[l],d=u.geometry,f=u.materials,p=d.type==="Line",g=d.type==="Points";let m=!1;if(d.vertices.length===0)continue;const A=new Vt;A.setAttribute("position",new ln(d.vertices,3)),d.normals.length>0&&A.setAttribute("normal",new ln(d.normals,3)),d.colors.length>0&&(m=!0,A.setAttribute("color",new ln(d.colors,3))),d.hasUVIndices===!0&&A.setAttribute("uv",new ln(d.uvs,2));const y=[];for(let _=0,w=f.length;_<w;_++){const S=f[_],E=S.name+"_"+S.smooth+"_"+m;let I=t.materials[E];if(this.materials!==null){if(I=this.materials.create(S.name),p&&I&&!(I instanceof Zo)){const k=new Zo;mt.prototype.copy.call(k,I),k.color.copy(I.color),I=k}else if(g&&I&&!(I instanceof Fp)){const k=new Fp({size:10,sizeAttenuation:!1});mt.prototype.copy.call(k,I),k.color.copy(I.color),k.map=I.map,I=k}}I===void 0&&(p?I=new Zo:g?I=new Fp({size:1,sizeAttenuation:!1}):I=new pv,I.name=S.name,I.flatShading=!S.smooth,I.vertexColors=m,t.materials[E]=I),y.push(I)}let b;if(y.length>1){for(let _=0,w=f.length;_<w;_++){const S=f[_];A.addGroup(S.groupStart,S.groupCount,_)}p?b=new xf(A,y):g?b=new fv(A,y):b=new Z(A,y)}else p?b=new xf(A,y[0]):g?b=new fv(A,y[0]):b=new Z(A,y[0]);b.name=u.name,o.add(b)}else if(t.vertices.length>0){const l=new Fp({size:1,sizeAttenuation:!1}),c=new Vt;c.setAttribute("position",new ln(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(c.setAttribute("color",new ln(t.colors,3)),l.vertexColors=!0);const u=new fv(c,l);o.add(u)}return o}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(i,t){h(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=t,this.canvas.convertToBlob=(n,r)=>new Promise(o=>{this.canvas.toBlob(o,n,r)}),this.canvas}});const pV=Q("debugprogress");function gV(s){s=s||new Date;const i=s.getMonth()+1,t=s.getDate(),n=s.getHours(),r=s.getMinutes(),o=s.getSeconds(),a=(i<10?"0":"")+i,l=(t<10?"0":"")+t,c=(n<10?"0":"")+n,u=(r<10?"0":"")+r,d=(o<10?"0":"")+o;return s.getFullYear()+a+l+"-"+c+u+d}class at{static start(i,t){typeof t=="string"&&(t={parentScope:t});const n=new mV(i,t);Xp.set(i,n)}static report(i,t){const n=Xp.get(i);if(!n){console.warn("Reporting progress for non-existing scope",i);return}typeof t=="string"&&(t={message:t,autoStep:!0}),n.report(t)}static end(i){const t=Xp.get(i);t&&(t.end(),Xp.delete(i))}}const Xp=new Map;class mV{constructor(i,t){h(this,"scopeLabel");h(this,"parentScope");h(this,"childScopes",[]);h(this,"parentDepth",0);h(this,"lastStep",0);h(this,"lastAutoStepWeight",1);h(this,"lastTotalSteps",0);h(this,"onProgress");h(this,"showLogs",!1);h(this,"selfProgress",0);h(this,"totalProgress",0);h(this,"selfReports",0);h(this,"totalReports",0);this.parentScope=t!=null&&t.parentScope?Xp.get(t.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+i,this.showLogs=(t==null?void 0:t.logTimings)??!!pV,this.showLogs&&console.time(this.scopeLabel),this.onProgress=t==null?void 0:t.onProgress}report(i,t=!1){if(i){if(i.totalSteps!==void 0&&(this.lastTotalSteps=i.totalSteps),i.currentStep!==void 0&&(this.lastStep=i.currentStep),i.autoStep!==void 0){if(i.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const r=typeof i.autoStep=="number"?i.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=r,i.currentStep=this.lastStep}i.totalSteps=this.lastTotalSteps}i.progress!==void 0?this.selfProgress=i.progress:i.currentStep!==void 0&&i.totalSteps!==void 0&&(this.selfProgress=i.currentStep/i.totalSteps)}if(this.childScopes.length>0){let r=0,o=0;for(const l of this.childScopes)r+=l.selfProgress,o+=1;o>0&&(r/=o);const a=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+r*a}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let n=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(n+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),i!=null&&i.message&&(n=i.message+" â€“ "+n),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(n="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"â€“"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+n),t?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,n),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let i=!1;for(const t of this.childScopes)if(!(t.selfProgress>=1)){i=!0;break}i&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function ol(s){return s=s.replace(/[^a-zA-Z0-9_]/g,""),s.match(/^[a-zA-Z_]/)||(s="_"+s),s}function OO(s){if(s.length===0)return null;const i=s.map(n=>{const r=new Array;for(;n.parent;)r.unshift(n.parent),n=n.parent;return r});return i[0].findLast(n=>i.every(r=>r.includes(n)))||null}function LO(s){const i=OO(s),t=new Set;for(const n of s){let r=n.parent;for(;r&&r!==i;)s.includes(r)||t.add(r),r=r.parent}return t}const $h=class{constructor(i,t,n,r=null,o=null,a=null,l=null,c=null){h(this,"uuid");h(this,"name");h(this,"type");h(this,"extraSchemas",[]);h(this,"displayName");h(this,"visibility");h(this,"matrix");h(this,"_isDynamic");h(this,"geometry");h(this,"material");h(this,"camera");h(this,"parent");h(this,"skinnedMesh");h(this,"children",[]);h(this,"animations");h(this,"_eventListeners");this.uuid=i,this.name=ol(t),this.displayName=t,this.matrix=n.clone(),this.geometry=r,this.material=o,this.camera=a,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=l,this.animations=c}get isDynamic(){return this._isDynamic}set isDynamic(i){this._isDynamic=i}static createEmptyParent(i){const t=new $h(ct.generateUUID(),i.name+"_empty_"+$h.USDObject_export_id++,i.matrix),n=i.parent;return n&&n.add(t),t.add(i),t.isDynamic=!0,i.matrix=new le().identity(),t}static createEmpty(){const i=new $h(ct.generateUUID(),"Empty_"+$h.USDObject_export_id++,new le);return i.isDynamic=!0,i}is(i){return i?this.uuid===i.uuid:!1}isEmpty(){return!this.geometry}clone(){const i=new $h(ct.generateUUID(),this.name,this.matrix,this.geometry,this.material);return i.isDynamic=this.isDynamic,i}deepClone(){const i=this.clone();for(const t of this.children)t&&i.add(t.deepClone());return i}getPath(){let i=this.parent,t=this.name;for(;i;)t=(i.parent?i.name:i.name+"/Scenes/Scene")+"/"+t,i=i.parent;return"</"+t+">"}add(i){i.parent&&i.parent.remove(i),i.parent=this,this.children.push(i)}remove(i){const t=this.children.indexOf(i);t>=0&&(i.parent===this&&(i.parent=null),this.children.splice(t,1))}addEventListener(i,t){this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(t)}removeEventListener(i,t){if(!this._eventListeners[i])return;const n=this._eventListeners[i].indexOf(t);n>=0&&this._eventListeners[i].splice(n,1)}onSerialize(i,t){const n=this._eventListeners.serialize;n&&n.forEach(r=>r(i,t))}};let _s=$h;h(_s,"USDObject_export_id",0);class FO extends _s{constructor(){super(void 0,"StageRoot",new le,null,null,null);h(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const n=this.children.indexOf(t);n>=0&&(t.parent===this&&(t.parent=null),this.children.splice(n,1))}traverse(t,n=null){if(n!==null?t(n):n=this,n.children)for(const r of n.children)this.traverse(t,r)}findById(t){let n=!1;function r(o){if(!n){if(o.uuid===t)return n=!0,o;if(o.children)for(const a of o.children){if(!a)continue;const l=r(a);if(l)return l}}}return r(this)}buildHeader(t){var l,c;const n=(l=t.extensions)==null?void 0:l.find(u=>(u==null?void 0:u.extensionName)==="animation"),r=(c=t.extensions)==null?void 0:c.find(u=>(u==null?void 0:u.extensionName)==="Behaviour"),o=(n==null?void 0:n.getStartTimeCode())??0,a=(n==null?void 0:n.getEndTimeCode())??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${Yo}"
		dictionary Needle = {
			bool animations = ${n?1:0}
			bool interactive = ${r?1:0}
			bool quickLookCompatible = ${t.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${ol(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${o}
	endTimeCode = ${a}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${Yo}"""
)
`}}const dd=`
`,nr="</StageRoot/Materials";class AV{constructor(){h(this,"str");h(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(i=void 0,t="{",n=!0){i!==void 0?(i=this.applyIndent(i),this.str+=i,n?(this.str+=dd,this.str+=this.applyIndent(t)):this.str+=" "+t):this.str+=this.applyIndent(t),this.str+=dd,this.indent+=1}closeBlock(i="}"){this.indent-=1,this.str+=this.applyIndent(i)+dd}beginArray(i){i=this.applyIndent(i+" = ["),this.str+=i,this.str+=dd,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+dd}appendLine(i=""){i=this.applyIndent(i),this.str+=i,this.str+=dd}toString(){return this.str}applyIndent(i){let t="";for(let n=0;n<this.indent;n++)t+="	";return t+i}}class vV{constructor(i,t,n){h(this,"root");h(this,"exporter");h(this,"extensions",[]);h(this,"quickLookCompatible");h(this,"exportInvisible");h(this,"materials");h(this,"textures");h(this,"files");h(this,"document");h(this,"output");h(this,"animations");this.root=i,this.exporter=t,this.quickLookCompatible=n.quickLookCompatible,this.exportInvisible=n.exportInvisible,n.extensions&&(this.extensions=n.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new FO,this.output="",this.animations=[]}}class F_{constructor(){h(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});h(this,"quickLookCompatible",!1);h(this,"extensions",[]);h(this,"maxTextureSize",4096);h(this,"exportInvisible",!1)}}let yV=class{constructor(){h(this,"debug");h(this,"sceneAnchoringOptions",new F_);h(this,"extensions",[]);h(this,"keepObject");this.debug=!1}async parse(i,t=new F_){t=Object.assign(new F_,t),this.sceneAnchoringOptions=t;const n=new vV(i,this,t);this.extensions=n.extensions;const r=n.files,o="model.usda";r[o]=null;const a=n.materials,l=n.textures;at.report("export-usdz","Invoking onBeforeBuildDocument"),await Ov(n,"onBeforeBuildDocument"),at.report("export-usdz","Done onBeforeBuildDocument"),at.report("export-usdz","Reparent bones to common ancestor");const c=[];i==null||i.traverse(A=>{if(!(!t.exportInvisible&&!A.visible)&&A instanceof $o){const y=A.skeleton.bones,b=OO(y);b&&c.push({object:A,originalParent:A.parent,newParent:b})}});for(const A of c){const{object:y,originalParent:b,newParent:_}=A;_.add(y)}at.report("export-usdz","Traversing hierarchy"),i&&UO(i,n.document,n,this.keepObject),at.report("export-usdz","Invoking onAfterBuildDocument"),await Ov(n,"onAfterBuildDocument"),at.report("export-usdz",{message:"Parsing document",autoStep:10}),await bV(n,()=>(at.report("export-usdz","Building materials"),RV(a,l,t.quickLookCompatible))),at.report("export-usdz","Invoking onAfterSerialize"),await Ov(n,"onAfterSerialize");for(const A of c){const{object:y,originalParent:b,newParent:_}=A;b&&b.add(y)}const d=n.document.buildHeader(n)+`
`+n.output;this.debug&&console.log(d),r[o]=hy(d),n.output="",at.report("export-usdz",{message:"Exporting textures",autoStep:10}),at.start("export-usdz-textures","export-usdz");const f=new Mu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),p=Object.keys(l).length;at.report("export-usdz-textures",{totalSteps:p*3,currentStep:0});const g=async A=>{const y=l[A],b=y.texture,_=QO.includes(b.format);let w={imageData:b.image};at.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const S=y.scale!==void 0&&y.scale.x!==1&&y.scale.y!==1&&y.scale.z!==1&&y.scale.w!==1;(b.isCompressedTexture||b.isRenderTargetTexture||S)&&(w=await _V(b,t.maxTextureSize,f,y.scale)),at.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const E=await xV(w.imageBitmap||w.imageData,t.maxTextureSize).catch(I=>{console.error("Error converting texture to canvas",b,I)});if(E){at.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const I=await E.convertToBlob({type:_?"image/png":"image/jpeg",quality:.95});r[`textures/${A}.${_?"png":"jpg"}`]=new Uint8Array(await I.arrayBuffer())}else console.warn("Can`t export texture: ",b)};for(const A in l)await g(A);f.dispose(),at.end("export-usdz-textures");let m=0;for(const A in r){const y=r[A],b=34+A.length;m+=b;const _=m&63;if(_!==4){const w=64-_,S=new Uint8Array(w);r[A]=[y,{extra:{12345:S}}]}m=y.length}return at.report("export-usdz","zip archive"),aH(r,{level:0})}};function UO(s,i,t,n){if(!t.exportInvisible&&!s.visible)return;let r,o,a;if((s instanceof Z||s instanceof $o)&&(o=s.geometry,a=s.material),n&&!n(s)&&(o=void 0,a=void 0),(s instanceof Z||s instanceof $o)&&a&&(a instanceof Jn||a instanceof _t||a instanceof mt&&a.type==="MeshLineMaterial")){const l=LA(s),c=s instanceof $o?s:null;r=new _s(s.uuid,l,s.matrix,o,a,void 0,c,s.animations)}else if(s instanceof bt||s instanceof ku){const l=LA(s);r=new _s(s.uuid,l,s.matrix,void 0,void 0,s)}else{const l=LA(s);r=new _s(s.uuid,l,s.matrix,void 0,void 0,void 0,void 0,s.animations)}if(r){if(r.displayName=s.name,r.visibility=s.visible?void 0:"invisible",i&&i.add(r),i=r,t.extensions)for(const l of t.extensions)l.onExportObject&&l.onExportObject.call(l,s,r,t)}else{const l=LA(s),c=new _s(s.uuid,l,s.matrix);i&&i.add(c),i=c}for(const l of s.children)UO(l,i,t,n)}async function bV(s,i){at.start("export-usdz-resources","export-usdz");const t=[];for(const c of s.document.children)NO(c,s,t);const n=t.length;for(let c=0;c<n;c++)at.report("export-usdz-resources",{totalSteps:n,currentStep:c}),await new Promise((u,d)=>{t[c](),u()});at.end("export-usdz-resources");const r=new AV,o=s.exporter.sceneAnchoringOptions.ar;r.beginBlock(`def Xform "${s.document.name}"`),r.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),r.beginBlock('def Xform "Scene"',"(",!1),r.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),r.appendLine("customData = {"),r.appendLine("	bool preliminary_collidesWithEnvironment = 0"),r.appendLine('	string sceneName = "Scene"'),r.appendLine("}"),r.appendLine('sceneName = "Scene"'),r.closeBlock(")"),r.beginBlock(),r.appendLine(`token preliminary:anchoring:type = "${o.anchoring.type}"`),o.anchoring.type==="plane"&&r.appendLine(`token preliminary:planeAnchoring:alignment = "${o.planeAnchoring.alignment}"`),o.anchoring.type==="image"&&r.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${s.document.name}/Scenes/Scene/AnchoringReferenceImage>`),r.appendLine();const a=c=>{if(!c)return 0;let u=1;for(const d of c.children)u+=a(d);return u},l=a(s.document);at.start("export-usdz-xforms","export-usdz"),at.report("export-usdz-xforms",{totalSteps:l,currentStep:1});for(const c of s.document.children)zO(c,r,s);at.end("export-usdz-xforms"),at.report("export-usdz","invoke onAfterHierarchy"),Ov(s,"onAfterHierarchy",r),r.closeBlock(),r.closeBlock(),r.appendLine(i()),r.closeBlock(),at.report("export-usdz","write to string"),s.output+=r.toString()}function NO(s,i,t){if(!s)return;const n=s.geometry,r=s.material;if(n)if(r&&("isMeshStandardMaterial"in r&&r.isMeshStandardMaterial||"isMeshBasicMaterial"in r&&r.isMeshBasicMaterial||r.type==="MeshLineMaterial")){const o="geometries/"+zx(n,s.name)+".usda";if(!(o in i.files)){const a=()=>{var c,u;const l=IV(n,(u=(c=s.skinnedMesh)==null?void 0:c.skeleton)==null?void 0:u.bones,i.quickLookCompatible);i.files[o]=EV(l)};t.push(a)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);r&&(r.uuid in i.materials||(i.materials[r.uuid]=r));for(const o of s.children)NO(o,i,t)}async function Ov(s,i,t=null){if(s.extensions){for(const n of s.extensions)if(n&&typeof n[i]=="function"){const o=n[i].call(n,s,t);o instanceof Promise&&await o}}}let DA=null,Fs=null,U_,fd,OA;async function _V(s,i=1/0,t=null,n=void 0){U_||(U_=new pr(2,2,1,1)),fd||(fd=new et({uniforms:{blitTexture:new ee(s),flipY:new ee(!1),scale:new ee(new Ue(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const r=fd.uniforms;r.blitTexture.value=s,r.flipY.value=!1,r.scale.value=new Ue(1,1,1,1),n!==void 0&&r.scale.value.copy(n),fd.defines.IS_SRGB=s.colorSpace==He,fd.needsUpdate=!0,OA||(OA=new Z(U_,fd),OA.frustumCulled=!1);const o=new bt,a=new ws;a.add(OA),t||(t=DA=new Mu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const l=Math.min(s.image.width,i),c=Math.min(s.image.height,i);Fs&&(Fs.width!==l||Fs.height!==c)&&(Fs.dispose(),Fs=null),Fs||(Fs=new Et(l,c,{format:qi,type:mi,minFilter:Mt,magFilter:Mt})),t.setRenderTarget(Fs),t.setSize(l,c),t.clear(),t.render(a,o),DA&&(DA.dispose(),DA=null);const u=new Uint8ClampedArray(Fs.width*Fs.height*4);t.readRenderTargetPixels(Fs,0,0,Fs.width,Fs.height,u);const d=new ImageData(u,Fs.width,Fs.height,void 0),f=await createImageBitmap(d,{premultiplyAlpha:"none"});return{imageData:d,imageBitmap:f}}function wV(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}async function xV(s,i=4096){const t=i/Math.max(s.width,s.height),n=s.width*Math.min(1,t),r=s.height*Math.min(1,t),o=new OffscreenCanvas(n,r),a={premultiplyAlpha:"none"};s.width!==n&&(a.resizeWidth=n),s.height!==r&&(a.resizeHeight=r);const l=await createImageBitmap(s,a),c=o.getContext("bitmaprenderer");return c&&c.transferFromImageBitmap(l),o}async function CV(s,i=void 0,t=!1,n=4096){if(wV(s)){const r=n/Math.max(s.width,s.height),o=new OffscreenCanvas(s.width*Math.min(1,r),s.height*Math.min(1,r)),a=o.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!a)throw new Error("Could not get canvas 2D context");if(t===!0&&(a.translate(0,o.height),a.scale(1,-1)),a.drawImage(s,0,0,o.width,o.height),i!==void 0){const l=i.x,c=i.y,u=i.z,d=i.w,f=a.getImageData(0,0,o.width,o.height),p=f.data;for(let g=0;g<p.length;g+=4)p[g+0]=p[g+0]*l,p[g+1]=p[g+1]*c,p[g+2]=p[g+2]*u,p[g+3]=p[g+3]*d;a.putImageData(f,0,0)}return o}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const Ni=7;function SV(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function EV(s,i){let t=SV();return t+=s,hy(t)}function LA(s){return s.name.replace(/[-<>\(\)\[\]Â§$%&\/\\\=\?\,\;]/g,"")+"_"+s.id}function nR(s){return ol(s.name||"bone_"+s.uuid)}function zx(s,i){return ol(s.name||"Geometry")+"_"+s.id}function XS(s){return ol(s.name||"Material")+"_"+s.id}function df(s,i){let t=nR(s),n=s.parent;for(;n&&n!==i;)t=nR(n)+"/"+t,n=n.parent;return t}function zO(s,i,t){var p;if(s==null)return;at.report("export-usdz-xforms",{message:"buildXform "+s.displayName||s.name,autoStep:!0});const n=s.matrix,r=s.geometry,o=s.material,a=s.camera,l=s.name;if(s.animations)for(const g of s.animations)t.animations.push(g);const c=fg(n);n.determinant()<0&&console.warn("NeedleUSDZExporter: USDZ does not support negative scales",l);const u=r&&r.isBufferGeometry&&r.attributes.skinIndex!==void 0&&r.attributes.skinIndex.count>0,d=u?"SkelRoot":"Xform",f=new Array;if(i.appendLine(),r?(i.beginBlock(`def ${d} "${l}"`,"(",!1),t.quickLookCompatible&&o&&o.side===_i&&!u?i.appendLine(`prepend references = @./geometries/${zx(r)}.usda@</Geometry_doubleSided>`):i.appendLine(`prepend references = @./geometries/${zx(r)}.usda@</Geometry>`),f.push("MaterialBindingAPI"),u&&f.push("SkelBindingAPI")):a?i.beginBlock(`def Camera "${l}"`,"(",!1):s.type!==void 0?i.beginBlock(`def ${s.type} "${l}"`):i.beginBlock(`def Xform "${l}"`,"(",!1),s.displayName&&i.appendLine(`displayName = "${s.displayName}"`),s.type===void 0&&((p=s.extraSchemas)!=null&&p.length&&f.push(...s.extraSchemas),f.length&&i.appendLine(`prepend apiSchemas = [${f.map(g=>`"${g}"`).join(", ")}]`),i.closeBlock(")"),i.beginBlock()),r&&o){const g=XS(o);i.appendLine(`rel material:binding = </StageRoot/Materials/${g}>`),!t.quickLookCompatible&&o.side===_i&&(i.beginBlock('over "Geometry" '),i.appendLine("uniform bool doubleSided = 1"),i.closeBlock())}if(u?(i.appendLine("rel skel:skeleton = <Rig>"),i.appendLine("rel skel:animationSource = <Rig/_anim>"),i.appendLine(`matrix4d xformOp:transform = ${fg(new le)}`)):s.type===void 0&&i.appendLine(`matrix4d xformOp:transform = ${c}`),s.type===void 0&&i.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),s.visibility!==void 0&&i.appendLine(`token visibility = "${s.visibility}"`),a&&("isOrthographicCamera"in a&&a.isOrthographicCamera?(i.appendLine(`float2 clippingRange = (${a.near}, ${a.far})`),i.appendLine(`float horizontalAperture = ${((Math.abs(a.left)+Math.abs(a.right))*10).toPrecision(Ni)}`),i.appendLine(`float verticalAperture = ${((Math.abs(a.top)+Math.abs(a.bottom))*10).toPrecision(Ni)}`),i.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in a&&a.isPerspectiveCamera&&(i.appendLine(`float2 clippingRange = (${a.near.toPrecision(Ni)}, ${a.far.toPrecision(Ni)})`),i.appendLine(`float focalLength = ${a.getFocalLength().toPrecision(Ni)}`),i.appendLine(`float focusDistance = ${a.focus.toPrecision(Ni)}`),i.appendLine(`float horizontalAperture = ${a.getFilmWidth().toPrecision(Ni)}`),i.appendLine('token projection = "perspective"'),i.appendLine(`float verticalAperture = ${a.getFilmHeight().toPrecision(Ni)}`))),s.onSerialize&&s.onSerialize(i,t),s.children){i.appendLine();for(const g of s.children)zO(g,i,t)}i.closeBlock()}function jt(s){return Number.isInteger(s)?s.toString():s.toFixed(10)}function fg(s){const i=s.elements;return`( ${FA(i,0)}, ${FA(i,4)}, ${FA(i,8)}, ${FA(i,12)} )`}function FA(s,i){return`(${jt(s[i+0])}, ${jt(s[i+1])}, ${jt(s[i+2])}, ${jt(s[i+3])})`}function IV(s,i=[],t=!0){return`
def "Geometry"
${TV(s,i,t)}
`}function TV(s,i=[],t=!0){const n="Geometry",r=s.attributes,o=r.position.count,a=i&&i.length>0,l=[],c=[];let u=new Array,d=r.skinIndex;if(a){const p=[];for(const A of i)A.parent.type!=="Bone"&&(l.push({bone:A,index:i.indexOf(A)}),p.push(A.uuid));for(;p.length<i.length;)for(const A of l){const y=A.bone.children;for(const b of y)p.indexOf(b.uuid)===-1&&i.indexOf(b)!==-1&&(l.push({bone:b,index:i.indexOf(b)}),p.push(b.uuid))}for(const A of LO(i))l.push({bone:A,index:l.length});const g=l[0].bone.parent;l.sort((A,y)=>df(A.bone,g)>df(y.bone,g)?1:-1),l.map(A=>'"'+df(A.bone,g)+'"').join(", ");for(const A in l)c[l[A].index]=parseInt(A);const m=r.skinIndex;u=new Array;for(let A=0;A<m.count;A++){const y=m.getX(A),b=m.getY(A),_=m.getZ(A),w=m.getW(A);u.push(c[y],c[b],c[_],c[w])}d=new Je(new Uint16Array(u),4)}const f=r.skinWeight&&r.skinIndex;return`
{	
    def Mesh "${n}" ${f?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${N_(s)}]
        int[] faceVertexIndices = [${z_(s)}]
		${r.normal||t?`normal3f[] normals = [${sR(r.normal,o)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${sR(r.position,o)}]
        ${r.uv?`texCoord2f[] primvars:st = [${oR(r.uv,o)}] (
            interpolation = "vertex"
        )`:""}
		${r.uv2?`texCoord2f[] primvars:st2 = [${oR(r.uv2,o)}] (
            interpolation = "vertex"
        )`:""}
		${f?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${r.skinIndex?`int[] primvars:skel:jointIndices = [${rR(d,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r.skinWeight?`float[] primvars:skel:jointWeights = [${rR(r.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${t?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${n}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${N_(s)+", "+N_(s)}]
		int[] faceVertexIndices = [${z_(s)+", "+z_(s,!0)}]
	}
}
`:""}
`}function N_(s){const i=s.index!==null?s.index.count:s.attributes.position.count;return Array(i/3).fill(3).join(", ")}function z_(s,i=!1){const t=s.index,n=[];if(t!==null)for(let r=0;r<t.count;r++){let o=r;i&&(o=r%3===0?r+2:r%3===2?r-2:r),n.push(t.getX(o))}else{const r=s.attributes.position.count;for(let o=0;o<r;o++){let a=o;i&&(a=o%3===0?o+2:o%3===2?o-2:o),n.push(a)}}return n.join(", ")}function sR(s,i){if(s===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(i).fill("(0, 0, 1)").join(", ");const t=[];for(let n=0;n<s.count;n++){const r=s.getX(n),o=s.getY(n),a=s.getZ(n);t.push(`(${r.toPrecision(Ni)}, ${o.toPrecision(Ni)}, ${a.toPrecision(Ni)})`)}return t.join(", ")}function rR(s,i=!1){const t=[];for(let n=0;n<s.count;n++){const r=s.getX(n),o=s.getY(n),a=s.getZ(n),l=s.getW(n);t.push(`${i?r:r.toPrecision(Ni)}`),t.push(`${i?o:o.toPrecision(Ni)}`),t.push(`${i?a:a.toPrecision(Ni)}`),t.push(`${i?l:l.toPrecision(Ni)}`)}return t.join(", ")}function oR(s,i){if(s===void 0)return console.warn("USDZExporter: UVs missing."),Array(i).fill("(0, 0)").join(", ");const t=[];for(let n=0;n<s.count;n++){const r=s.getX(n),o=s.getY(n);t.push(`(${r.toPrecision(Ni)}, ${1-o.toPrecision(Ni)})`)}return t.join(", ")}function RV(s,i,t=!1){const n=[];for(const r in s){const o=s[r];n.push(BV(o,i,t))}return`
	def "Materials"
    {
${n.join("")}
    }`}function BV(s,i,t=!1){var g;const n="                ",r=[],o=[],a=XS(s),l=new Set;function c(m){var A;return ol(m.name)+"_"+(((A=m.source)==null?void 0:A.id)??m.id)}function u(m,A,y=void 0,b=void 0){const _=c(m),w=_+(b!==void 0&&b!==1?"_"+b:""),S=t&&b!==void 0&&b!==1,E=S?new Ue(1,1,1,b):void 0;b===void 0&&(b=1),S&&(b=1),E&&E.w<=.05&&(E.w=.05),i[w]={texture:m,scale:E};const I=m.channel>0?"st"+m.channel:"st";l.add(m.channel);const k=QO.includes(m.format),T={1e3:"repeat",1001:"clamp",1002:"mirror"},P=m.repeat.clone(),B=m.offset.clone(),M=m.rotation,U=Math.sin(M),G=Math.cos(M);B.y=1-B.y-P.y,t?(P.x===0&&(P.x=1e-4),P.y===0&&(P.y=1e-4),B.x=B.x/P.x,B.y=B.y/P.y,B.x+=U/P.x,B.y+=G-1):(B.x+=U*P.x,B.y+=(1-G)*P.y);const W=P.x!=1||P.y!=1||B.x!=0||B.y!=0||M!=0,Y=`${nr}/${a}/${"uvReader_"+I}.outputs:result>`,D=`${nr}/${a}/Transform2d_${A}.outputs:result>`,L=A!=="normal"&&y&&(y.r!==1||y.g!==1||y.b!==1||b!==1)||!1,V=A==="normal",te=s instanceof Jn&&s.normalScale?s.normalScale.x*2:2,K=te.toFixed(Ni),ue=(-1*(te/2)).toFixed(Ni),de=(1-te).toFixed(Ni);return`
			${W?`def Shader "Transform2d_${A}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${Y}
				float2 inputs:scale = ${lR(P)}
				float2 inputs:translation = ${lR(B)}
				float inputs:rotation = ${(M/Math.PI*180).toFixed(Ni)}
				float2 outputs:result
			}
			`:""}
			def Shader "${_}_${A}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${w}.${k?"png":"jpg"}@
				token inputs:sourceColorSpace = "${m.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${W?D:Y}
				${L?`
				float4 inputs:scale = (${y?y.r+", "+y.g+", "+y.b:"1, 1, 1"}, ${b})
				`:""}
				${V?`
				float4 inputs:scale = (${K}, ${K}, ${K}, 1)
				float4 inputs:bias = (${ue}, ${ue}, ${de}, 0)
				`:""}
				token inputs:wrapS = "${T[m.wrapS]}"
				token inputs:wrapT = "${T[m.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${s.transparent||s.alphaTest>0?"float outputs:a":""}
			}`}let d=s.transparent||s.alphaTest?s.opacity:1,f=!1,p=!1;if(s instanceof _o&&s.transmission!==void 0&&(d*=1-s.transmission*(1-s.roughness*.5)),s.map?(r.push(`${n}color3f inputs:diffuseColor.connect = ${nr}/${a}/${c(s.map)}_diffuse.outputs:rgb>`),s instanceof _t&&s.transparent&&s.alphaTest==0&&t?(r.push(`${n}float inputs:opacity.connect = ${nr}/${a}/${c(s.map)}_diffuse.outputs:a>`),f=!0,r.push(`${n}float inputs:opacityThreshold = ${1e-10}`),p=!0):s.transparent?(r.push(`${n}float inputs:opacity.connect = ${nr}/${a}/${c(s.map)}_diffuse.outputs:a>`),f=!0):s.alphaTest>0&&(r.push(`${n}float inputs:opacity.connect = ${nr}/${a}/${c(s.map)}_diffuse.outputs:a>`),f=!0,r.push(`${n}float inputs:opacityThreshold = ${s.alphaTest}`),p=!0),o.push(u(s.map,"diffuse",s.color,d))):r.push(`${n}color3f inputs:diffuseColor = ${aR(s.color)}`),s.alphaHash&&t&&(p?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping alphaHash opacity threshold."):(r.push(`${n}float inputs:opacityThreshold = 0.0000000001`),p=!0)),s.aoMap&&(r.push(`${n}float inputs:occlusion.connect = ${nr}/${a}/${c(s.aoMap)}_occlusion.outputs:r>`),o.push(u(s.aoMap,"occlusion"))),s.alphaMap?(r.push(`${n}float inputs:opacity.connect = ${nr}/${a}/${c(s.alphaMap)}_opacity.outputs:r>`),r.push(`${n}float inputs:opacityThreshold = 0.0000000001`),f=!0,p=!0,o.push(u(s.alphaMap,"opacity",new xe(1,1,1),d))):(f?console.warn("Opacity for "+s.name+" was already connected. Skipping default opacity."):(r.push(`${n}float inputs:opacity = ${d}`),f=!0),s.alphaTest>0&&(p?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping default opacity threshold."):(r.push(`${n}float inputs:opacityThreshold = ${s.alphaTest}`),p=!0))),s instanceof Jn){if(s.emissiveMap){r.push(`${n}color3f inputs:emissiveColor.connect = ${nr}/${a}/${c(s.emissiveMap)}_emissive.outputs:rgb>`);const m=s.emissive.clone();m.multiplyScalar(s.emissiveIntensity),o.push(u(s.emissiveMap,"emissive",m))}else if(((g=s.emissive)==null?void 0:g.getHex())>0){const m=s.emissive.clone();m.multiplyScalar(s.emissiveIntensity),r.push(`${n}color3f inputs:emissiveColor = ${aR(m)}`)}s.normalMap&&(r.push(`${n}normal3f inputs:normal.connect = ${nr}/${a}/${c(s.normalMap)}_normal.outputs:rgb>`),o.push(u(s.normalMap,"normal"))),s.roughnessMap&&s.roughness===1?(r.push(`${n}float inputs:roughness.connect = ${nr}/${a}/${c(s.roughnessMap)}_roughness.outputs:g>`),o.push(u(s.roughnessMap,"roughness"))):r.push(`${n}float inputs:roughness = ${s.roughness!==void 0?s.roughness:1}`),s.metalnessMap&&s.metalness===1?(r.push(`${n}float inputs:metallic.connect = ${nr}/${a}/${c(s.metalnessMap)}_metallic.outputs:b>`),o.push(u(s.metalnessMap,"metallic"))):r.push(`${n}float inputs:metallic = ${s.metalness!==void 0?s.metalness:0}`)}return s instanceof _o&&(r.push(`${n}float inputs:clearcoat = ${s.clearcoat}`),r.push(`${n}float inputs:clearcoatRoughness = ${s.clearcoatRoughness}`),r.push(`${n}float inputs:ior = ${s.ior}`),!s.transparent&&!(s.alphaTest>0)&&s.transmissionMap&&(r.push(`${n}float inputs:opacity.connect = ${nr}/${a}/${c(s.transmissionMap)}_transmission.outputs:r>`),o.push(u(s.transmissionMap,"transmission")))),l.size>2?console.warn("USDZExporter: Material "+s.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):l.size===2&&(!l.has(0)||!l.has(1))&&console.warn("USDZExporter: Material "+s.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${a}" ${s.name?`(
			displayName = "${s.name}"
		)`:""}
		{
			token outputs:surface.connect = ${nr}/${a}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${r.join(`
`)}
				int inputs:useSpecularWorkflow = ${s instanceof _t?"1":"0"}
				token outputs:surface
			}
${o.length>0?`
${l.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${l.has(1)?`
			def Shader "uvReader_st2"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st2"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${o.join(`
`)}`:""}
		}`}function aR(s){return`(${s.r}, ${s.g}, ${s.b})`}function lR(s){return`(${s.x}, ${s.y})`}const QO=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];Q("debugusdz");const e1=class{constructor(i,t,n){h(this,"id");h(this,"trigger");h(this,"action");h(this,"exclusive",!1);this.id="Behavior_"+ol(i)+"_"+e1.global_id++,this.trigger=t,this.action=n}makeExclusive(i){return this.exclusive=i,this}writeTo(i,t,n){if(!this.trigger||!this.action)return;n.beginBlock(`def Preliminary_Behavior "${this.id}"`);let r="";if(Array.isArray(this.trigger)){r="[";for(let o=0;o<this.trigger.length;o++){const a=this.trigger[o];r+="<"+a.id+">",o+1<this.trigger.length&&(r+=", ")}r+="]"}else r=`<${this.trigger.id}>`;if(n.appendLine(`rel triggers = ${r}`),n.appendLine(`rel actions = <${this.action.id}>`),n.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),n.appendLine(),Array.isArray(this.trigger))for(const o of this.trigger)o.writeTo(t,n),n.appendLine();else this.trigger.writeTo(t,n);n.appendLine(),this.action.writeTo(t,n),n.closeBlock()}};let cn=e1;h(cn,"global_id",0);const pd=new Set;function Qx(s,i){var n,r;let t="";if(Array.isArray(s)){pd.clear();let o="[ ";for(let a=0;a<s.length;a++){let l=s[a];if(!l){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}if(typeof l=="string"){if(pd.has(l))continue;o+=l,pd.add(l)}else if(typeof l=="object"){if(l.isObject3D&&(l=i.findById(l.uuid),!l)){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}const c=(n=l.getPath)==null?void 0:n.call(l);if(pd.has(c))continue;o+=c,pd.add(c)}a+1<s.length&&(o+=", ")}o+=" ]",t=o,pd.clear()}else typeof s=="object"&&(s.isObject3D&&(s=i.findById(s.uuid)),t=(r=s.getPath)==null?void 0:r.call(s));return t}const t1=class{constructor(i,t){h(this,"id");h(this,"targetId");h(this,"tokenId");h(this,"type");h(this,"distance");i&&(this.targetId=i),t?this.id=t:this.id="Trigger_"+t1.global_id++}writeTo(i,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=Qx(this.targetId,i)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let ih=t1;h(ih,"global_id",0);function cR(s,i={direct:!0,indirect:!0}){const t=_s.createEmpty();t.name="InputTarget_"+t.name,t.displayName=void 0,t.type="RealityKitComponent",t.onSerialize=n=>{n.appendLine("bool allowsDirectInput = "+(i.direct?1:0)),n.appendLine("bool allowsIndirectInput = "+(i.indirect?1:0)),n.appendLine('uniform token info:id = "RealityKit.InputTarget"')},s.add(t)}class es{static sceneStartTrigger(){const i=new ih;return i.targetId=void 0,i.tokenId="SceneTransition",i.type="enter",i}static tapTrigger(i,t={direct:!0,indirect:!0}){const n=new ih(i);if(Array.isArray(i)&&i.length>1)for(const r of i)r instanceof _s&&cR(r,t);else i instanceof _s&&cR(i,t);return n.tokenId="TapGesture",n}static isTapTrigger(i){return(i==null?void 0:i.tokenId)==="TapGesture"}static proximityToCameraTrigger(i,t){const n=new ih(i);return n.tokenId="ProximityToCamera",n.distance=t,n}}class nu{constructor(i,t){h(this,"id");h(this,"actions");h(this,"loops",0);h(this,"performCount",1);h(this,"type","serial");h(this,"multiplePerformOperation");this.id=i,this.actions=t}static getId(){return this.global_id++}addAction(i){return this.actions.push(i),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(i){return this.performCount=i,this}writeTo(i,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const n of this.actions){if(!n)continue;const r=n===this.actions[this.actions.length-1];t.appendLine("<"+n.id+">"+(r?"":", "))}t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops}`),t.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),t.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.appendLine();for(const n of this.actions)n&&(n.writeTo(i,t),t.appendLine());t.closeBlock()}}h(nu,"global_id",0);const Yy=class{constructor(i,t){h(this,"id");h(this,"tokenId");h(this,"affectedObjects");h(this,"easeType");h(this,"motionType");h(this,"duration");h(this,"moveDistance");h(this,"style");h(this,"type");h(this,"front");h(this,"up");h(this,"start");h(this,"animationSpeed");h(this,"reversed");h(this,"pingPong");h(this,"xFormTarget");h(this,"audio");h(this,"gain");h(this,"auralMode");h(this,"multiplePerformOperation");h(this,"velocity");i&&(this.affectedObjects=i),t?this.id=t:this.id="Action",this.id+="_"+Yy.global_id++}clone(){const i=new Yy,t=i.id;return Object.assign(i,this),i.id=t,i}writeTo(i,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=Qx(this.affectedObjects,i)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?t.appendLine(`double duration = ${this.duration/this.animationSpeed} `):t.appendLine(`double duration = ${this.duration} `)),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&t.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=Qx(this.xFormTarget,i)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&t.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),t.closeBlock()}};let Br=Yy;h(Br,"global_id",0);let Ud=class Ed{constructor(i,t,n){h(this,"x",0);h(this,"y",0);h(this,"z",0);this.x=i,this.y=t,this.z=n}static get up(){return new Ed(0,1,0)}static get right(){return new Ed(1,0,0)}static get forward(){return new Ed(0,0,1)}static get back(){return new Ed(0,0,-1)}static get zero(){return new Ed(0,0,0)}};class Ct{static sequence(...i){return new nu("Group_"+nu.getId(),i).makeSequence()}static parallel(...i){return new nu("Group_"+nu.getId(),i).makeParallel()}static fadeAction(i,t,n){const r=new Br(i);return r.tokenId="Visibility",r.type=n?"show":"hide",r.duration=t,r.style="basic",r.motionType="none",r.moveDistance=0,r.easeType="none",r}static startAnimationAction(i,t,n=0,r=1,o=!1,a=!1){const l=new Br(i);if(l.tokenId="StartAnimation",l.start=t,l.duration=n,l.animationSpeed=r,l.reversed=o,l.pingPong=a,l.multiplePerformOperation="allow",o&&(l.start-=n),a){l.pingPong=!1;const c=l.clone();return c.reversed=!o,c.start=l.start,c.reversed&&(c.start-=n),Ct.sequence(l,c)}return l}static waitAction(i){const t=new Br;return t.tokenId="Wait",t.duration=i,t.motionType=void 0,t}static lookAtCameraAction(i,t,n,r){const o=new Br(i);return o.tokenId="LookAtCamera",o.duration=t===void 0?9999999999999:t,o.front=n??Ud.forward,o.up=r??Ud.up,o}static emphasize(i,t,n="bounce",r=1,o="basic"){const a=new Br(i);return a.tokenId="Emphasize",a.duration=t,a.style=o??"basic",a.motionType=n,a.moveDistance=r,a}static transformAction(i,t,n,r,o="inout"){const a=new Br(i);return a.tokenId="Transform",a.duration=n,a.duration=Math.max(1e-6,n),a.type=r,a.easeType=n>0?o:"none",Array.isArray(t)&&console.error("Transform target must not be an array",t),a.xFormTarget=t,a}static playAudioAction(i,t,n="play",r=1,o="spatial"){const a=new Br(i);return a.tokenId="Audio",a.type=n,a.audio=t,a.gain=r,a.auralMode=o,a.multiplePerformOperation="allow",a}static impulseAction(i,t){const n=new Br(i);return n.tokenId="Impulse",n.velocity=t,n}}class PV{constructor(i){h(this,"object");h(this,"model");this.object=i}get id(){return this.object.uuid}apply(i){if(!this.model&&(this.model=i.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(i)}}class jO extends PV{constructor(t,n,r,o){super(t);h(this,"matrix");h(this,"material");h(this,"geometry");h(this,"_enableAction");h(this,"_disableAction");this.matrix=n,this.material=r,this.geometry=o}onApply(t){var o,a;const n=this.model;if(!n)return;(o=n.parent)!=null&&o.isDynamic||_s.createEmptyParent(n);const r=n.clone();this.matrix&&(r.matrix=this.matrix),this.material&&(r.material=this.material),this.geometry&&(r.geometry=this.geometry),(a=n.parent)==null||a.add(r)}enable(){return this._enableAction?this._enableAction:(this._enableAction=Ct.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=Ct.fadeAction(this.object,0,!1),this._disableAction)}}class GO{constructor(i){h(this,"actions");h(this,"sortedActions");this.actions=[...i]}organize(){this.sortedActions={};for(const i of this.actions){const t=i.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(i)}}getActions(i){return this.sortedActions||this.organize(),this.sortedActions[i.uuid]}}const Pm=function(s){return v(s)},v=function(s){if(s===void 0&&(s=null),!Array.isArray(s))s=hR(s);else for(let i=0;i<s.length;i++){const t=s[i];s[i]=hR(t)}return function(i,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(i,"$serializedTypes")||(i.$serializedTypes={});const n=i.$serializedTypes=i.$serializedTypes||{};n[t]=s}};function hR(s){var i,t;switch((t=(i=s==null?void 0:s.prototype)==null?void 0:i.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return s}class j extends ne{constructor(){super(...arguments);h(this,"guid")}static isDestroyed(t){return kf(t)}static setActive(t,n,r=!0){t&&(Bv(t,n),Cv(t),n&&r&&qD(Ge.Current,t))}static isActiveSelf(t){return Tm(t)}static isActiveInHierarchy(t){return S6(t)}static markAsInstancedRendered(t,n){E6(t,n)}static isUsingInstancing(t){return zS(t)}static foreachComponent(t,n,r=!0){return Df(t,n,r)}static instantiateSynced(t,n){return t?JD(t,n):null}static instantiate(t,n=null){return Rm(t,n)}static destroySynced(t,n,r=!0){if(!t)return;const o=t;n=n??Ge.Current,C0(o,n.connection,r)}static destroy(t,n=!0){return xo(t,n)}static add(t,n,r){if(!(!t||!n)){if(t===n){console.warn("Can not add object to self",t);return}r||(r=Ge.Current),n.add(t),Bv(t,!0),Cv(t),r?j.foreachComponent(t,o=>{MS(o,r),!o.__internalDidAwakeAndStart&&r.new_script_start.includes(o)===!1&&r.new_script_start.push(o)},!0):console.warn("Missing context")}}static remove(t){var n;t&&((n=t.parent)==null||n.remove(t),Bv(t,!1),Cv(t),j.foreachComponent(t,r=>{C5(r)},!0))}static invokeOnChildren(t,n,...r){this.invoke(t,n,!0,r)}static invoke(t,n,r=!1,...o){t&&this.foreachComponent(t,a=>{const l=a[n];l&&typeof l=="function"&&(l==null||l.call(a,...o))},r)}static addNewComponent(t,n,r,o=!0){return vo(t,n,r,{callAwake:o})}static addComponent(t,n,r,o){return vo(t,n,r,o)}static moveComponent(t,n){return vo(t,n)}static removeComponent(t){return rO(t.gameObject,t),t}static getOrAddComponent(t,n){return S0(t,n)}static getComponent(t,n){return t===null?null:Qf(t,n)}static getComponents(t,n,r=null){return t===null?r??[]:E0(t,n,r)}static findByGuid(t,n){return T0(t,n)}static findObjectOfType(t,n,r=!0){return US(t,n??Ge.Current,r)}static findObjectsOfType(t,n){const r=[];return C6(t,r,n),r}static getComponentInChildren(t,n){return I0(t,n)}static getComponentsInChildren(t,n,r=null){return Im(t,n,r??void 0)}static getComponentInParent(t,n){return ly(t,n)}static getComponentsInParent(t,n,r=null){return FS(t,n,r)}static getAllComponents(t){var o;return[...(o=t.userData)==null?void 0:o.components]}static*iterateComponents(t){var r;const n=(r=t==null?void 0:t.userData)==null?void 0:r.components;if(n&&Array.isArray(n))for(let o=0;o<n.length;o++)yield n[o]}}var Na;let oe=(Na=class{constructor(i){h(this,"__context");h(this,"__name");h(this,"gameObject");h(this,"guid","invalid");h(this,"sourceId");h(this,"__didAwake",!1);h(this,"__didStart",!1);h(this,"__didEnable",!1);h(this,"__isEnabled");h(this,"__destroyed",!1);h(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(i)}get isComponent(){return!0}get context(){return this.__context??Ge.Current}set context(i){this.__context=i}get scene(){return this.context.scene}get layer(){var i,t;return(t=(i=this.gameObject)==null?void 0:i.userData)==null?void 0:t.layer}get name(){var i,t;return(i=this.gameObject)!=null&&i.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(i){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=i,this.__name=i):this.__name=i}get tag(){var i;return(i=this.gameObject)==null?void 0:i.userData.tag}set tag(i){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=i)}get static(){var i;return(i=this.gameObject)==null?void 0:i.userData.static}set static(i){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=i)}get hideFlags(){var i;return(i=this.gameObject)==null?void 0:i.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const i=this.gameObject[$c];return i===void 0?!0:i}set __isActiveInHierarchy(i){this.gameObject&&(this.gameObject[$c]=i)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(i,t=qe.Update){return this.context.registerCoroutineUpdate(this,i,t)}stopCoroutine(i,t=qe.Update){this.context.unregisterCoroutineUpdate(i,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(i){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(i),this}_internalInit(i){if(typeof i=="object")for(const t of Object.keys(i)){const n=i[t];typeof n!="function"&&(this[t]=n)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(i){return this.__destroyed?(be()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(i!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(i){if(this.__didAwake){if(!this.__didEnable){i!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var i;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((i=this.onDestroy)==null||i.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),x6(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(i){if(this.__destroyed){be()&&console.warn(`[Needle Engine Dev] Trying to ${i?"enable":"disable"} destroyed component`);return}if(typeof i=="number"&&(i>=.5?i=!0:i=!1),!this.__didAwake){this.__isEnabled=i;return}i?this.__internalEnable():this.__internalDisable()}get worldPosition(){return Ve(this.gameObject)}set worldPosition(i){Sn(this.gameObject,i)}setWorldPosition(i,t,n){Tf(this.gameObject,i,t,n)}get worldQuaternion(){return Ht(this.gameObject)}set worldQuaternion(i){na(this.gameObject,i)}setWorldQuaternion(i,t,n,r){jM(this.gameObject,i,t,n,r)}get worldEuler(){return HM(this.gameObject)}set worldEuler(i){VM(this.gameObject,i)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(i){this.setWorldRotation(i.x,i.y,i.z,!0)}setWorldRotation(i,t,n,r=!0){A0(this.gameObject,i,t,n,r)}get forward(){return Na._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return Na._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return Na._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(i,t){this._eventListeners[i]=this._eventListeners[i]||[],this._eventListeners[i].push(t)}removeEventListener(i,t){if(!this._eventListeners[i])return;const n=this._eventListeners[i].indexOf(t);n>=0&&this._eventListeners[i].splice(n,1)}dispatchEvent(i){if(!i||!this._eventListeners[i.type])return!1;const t=this._eventListeners[i.type];for(let n=0;n<t.length;n++)t[n](i);return!1}},h(Na,"_forward",new x),h(Na,"_right",new x),h(Na,"_up",new x),Na);const MV=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:oe,Component:oe,GameObject:j},Symbol.toStringTag,{value:"Module"}));var HO=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class D0 extends oe{constructor(){super(...arguments);h(this,"from");h(this,"to");h(this,"width",0);h(this,"centered",!0);h(this,"_centerPos")}awake(){this._centerPos=new x}update(){if(!this.from||!this.to)return;const t=Ve(this.from).clone(),n=Ve(this.to).clone(),r=t.distanceTo(n);this._centerPos.copy(t),this._centerPos.add(n),this._centerPos.multiplyScalar(.5),Sn(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(Ve(this.to).clone()),this.gameObject.scale.set(this.width,this.width,r)}}HO([v(j)],D0.prototype,"from",void 0);HO([v(j)],D0.prototype,"to",void 0);var Qu=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Ic=Q("debuganimation");let VO=class{constructor(){h(this,"x");h(this,"y")}};class qs extends oe{constructor(){super(...arguments);h(this,"playAutomatically",!0);h(this,"randomStartTime",!0);h(this,"minMaxSpeed");h(this,"minMaxOffsetNormalized");h(this,"loop",!0);h(this,"clampWhenFinished",!1);h(this,"_tempAnimationClipBeforeGameObjectExisted",null);h(this,"_tempAnimationsArray");h(this,"mixer");h(this,"_actions");h(this,"_handles")}get isAnimationComponent(){return!0}addClip(t){this.animations||(this.animations=[]),this.animations.push(t)}get time(){if(this.actions){for(const t of this.actions)if(t.isRunning())return t.time}return 0}set time(t){if(this.actions)for(const n of this.actions)n.time=t}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){Ic&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(t){this._actions=t}awake(){Ic&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0){const n=Math.floor(Math.random()*this.animations.length),r=this.animations[n];this.play(n,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*r.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(t=>t.update()))}onDisable(){this.mixer&&(this.mixer.stopAllAction(),this.mixer=void 0)}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(t){var n;return((n=this.actions)==null?void 0:n.find(r=>r.getClip().name===t))||null}get isPlaying(){if(this.actions){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0}return!1}stopAll(t){if(this.actions)for(const n of this.actions)t!=null&&t.fadeDuration?n.fadeOut(t.fadeDuration):n.stop()}stop(t,n){if(t===void 0){this.stopAll();return}else if(typeof t=="number"){if(t>=this.animations.length){Ic&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(o=>o.name===t));if(!t){console.error("Could not find clip",t);return}const r=this.actions.find(o=>o.getClip()===t);if(!r){console.error("Could not find action",t);return}n!=null&&n.fadeDuration?r.fadeOut(n.fadeDuration):r.stop()}pause(t,n=!1){if(t===void 0){for(const o of this.actions)o.paused=!n;return}else if(typeof t=="number"){if(t>=this.animations.length){Ic&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(o=>o.name===t));if(!t){console.error("Could not find clip",t);return}const r=this.actions.find(o=>o.getClip()===t);if(!r){console.error("Could not find action",t);return}r.paused=!n}resume(){for(const t of this.actions)t.paused=!1}play(t=0,n){if(Ic&&console.log("PLAY",t),this.ensureMixer(),!this.mixer){Ic&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let r=t;if(typeof t=="number"){if(t>=this.animations.length){Ic&&console.log("No animation at index",t);return}r=this.animations[t]}else typeof t=="string"&&(r=this.animations.find(a=>a.name===t));if(!r){console.error("Could not find clip",t);return}n||(n={});for(const a of this.actions)if(a.getClip()===r)return this.internalOnPlay(a,n);if(!r.tracks){console.warn("Clip is no AnimationClip",r);return}const o=this.mixer.clipAction(r);return this.actions.push(o),this.internalOnPlay(o,n)}internalOnPlay(t,n){var r=this.actions.find(l=>l===t);if(r===t&&r.isRunning()&&r.time<r.getClip().duration){const l=this.tryFindHandle(t);if(r.paused&&(r.paused=!1),l)return l.waitForFinish()}if(n.loop===void 0&&(n.loop=this.loop),n.clampWhenFinished===void 0&&(n.clampWhenFinished=this.clampWhenFinished),n.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(n.minMaxOffsetNormalized=this.minMaxOffsetNormalized),n.minMaxSpeed===void 0&&(n.minMaxSpeed=this.minMaxSpeed),(n==null?void 0:n.exclusive)??!0)for(const l of this.actions)l!=r&&(n.fadeDuration?l.fadeOut(n.fadeDuration):l.stop());if(n!=null&&n.fadeDuration&&t.fadeIn(n.fadeDuration),t.enabled=!0,(n==null?void 0:n.startTime)!=null)t.time=n.startTime;else if(n!=null&&n.minMaxOffsetNormalized&&n.minMaxOffsetNormalized.x!=0&&n.minMaxOffsetNormalized.y!=0){const l=t.getClip();t.time=ye.lerp(n.minMaxOffsetNormalized.x,n.minMaxOffsetNormalized.y,Math.random())*l.duration}else t.time>=t.getClip().duration&&(t.time=0);n!=null&&n.minMaxSpeed?t.timeScale=ye.lerp(n.minMaxSpeed.x,n.minMaxSpeed.y,Math.random()):t.timeScale=(n==null?void 0:n.speed)??1,(n==null?void 0:n.loop)!=null?t.loop=n.loop?SF:Fw:t.loop=Fw,n!=null&&n.clampWhenFinished&&(t.clampWhenFinished=!0),t.paused=!1,t.play(),Ic&&console.log("PLAY",t.getClip().name,t);const a=new kV(t,this.mixer,n,l=>{this._handles.splice(this._handles.indexOf(a),1)});return this._handles.push(a),a.waitForFinish()}tryFindHandle(t){for(const n of this._handles)if(n.action===t)return n}ensureMixer(){if(!this.mixer){const t="animationMixer";this.gameObject[t]&&(this.mixer=this.gameObject[t]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new MC(this.gameObject),this.gameObject[t]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}Qu([v()],qs.prototype,"playAutomatically",void 0);Qu([v()],qs.prototype,"randomStartTime",void 0);Qu([v(VO)],qs.prototype,"minMaxSpeed",void 0);Qu([v(VO)],qs.prototype,"minMaxOffsetNormalized",void 0);Qu([v()],qs.prototype,"loop",void 0);Qu([v()],qs.prototype,"clampWhenFinished",void 0);Qu([v(ql)],qs.prototype,"clips",null);class kV{constructor(i,t,n,r){h(this,"mixer");h(this,"action");h(this,"promise",null);h(this,"_options");h(this,"_resolveCallback",null);h(this,"_resolvedOrRejectedCallback");h(this,"onLoop",i=>{});h(this,"onFinished",i=>{i.action===this.action&&this.onResolve()});this.action=i,this.mixer=t,this._resolvedOrRejectedCallback=r,this._options=n}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(i=>{this._resolveCallback=i}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var i,t;this.dispose(),(i=this._resolvedOrRejectedCallback)==null||i.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var vh=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class ur{constructor(i=0,t=0){h(this,"time",0);h(this,"value",0);h(this,"inTangent",1/0);h(this,"inWeight");h(this,"outTangent",1/0);h(this,"outWeight");h(this,"weightedMode");this.time=i,this.value=t}}vh([v()],ur.prototype,"time",void 0);vh([v()],ur.prototype,"value",void 0);vh([v()],ur.prototype,"inTangent",void 0);vh([v()],ur.prototype,"inWeight",void 0);vh([v()],ur.prototype,"outTangent",void 0);vh([v()],ur.prototype,"outWeight",void 0);vh([v()],ur.prototype,"weightedMode",void 0);class Jo{constructor(){h(this,"keys",[])}static linearFromTo(i,t,n){const r=new Jo,o=new ur;o.time=0,o.value=i;const a=new ur;return a.time=n,a.value=t,r.keys.push(o,a),r}static constant(i){const t=new Jo,n=new ur;return n.time=0,n.value=i,t.keys.push(n),t}clone(){var t;const i=new Jo;return i.keys=((t=this.keys)==null?void 0:t.map(n=>{const r=new ur;return r.time=n.time,r.value=n.value,r.inTangent=n.inTangent,r.inWeight=n.inWeight,r.outTangent=n.outTangent,r.outWeight=n.outWeight,r.weightedMode=n.weightedMode,r}))||[],i}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(i){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=i)return this.keys[0].value;for(let t=0;t<this.keys.length;t++){const n=this.keys[t];if(n.time<=i)if(t+1<this.keys.length){const o=this.keys[t+1];if(o.time<i)continue;return!isFinite(n.outTangent)||!isFinite(o.inTangent)?n.value:Jo.interpolateValue(i,n,o)}else return n.value}return this.keys[this.keys.length-1].value}static interpolateValue(i,t,n){const r=t.time,o=t.value,a=t.outTangent,l=n.time,c=n.value,u=n.inTangent,d=l-r,f=d*d,p=f*d,g=((a+u)*d-2*(c-o))/p,m=(3*(c-o)-(u+2*a)*d)/f,A=a,y=o,b=i-r,_=b*b,w=_*b;return g*w+m*_+A*b+y}}vh([v(ur)],Jo.prototype,"keys",void 0);const bl=new Array;class Nl{constructor(i,t,n,r){h(this,"enabled",!0);h(this,"target");h(this,"methodName");h(this,"arguments");this.target=i,this.methodName=t||null,this.arguments=n,r!=null&&(this.enabled=r)}get canClone(){return this.target instanceof Object}invoke(...i){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(bl.length=0,i!==void 0&&i.length>0&&bl.push(...i),bl.push(...this.arguments),this.target(...this.arguments),bl.length=0):this.target(...i);else if(this.methodName!=null){const t=this.target[this.methodName];typeof t=="function"?this.arguments?(bl.length=0,i!==void 0&&i.length>0&&bl.push(...i),bl.push(...this.arguments),t.call(this.target,...bl),bl.length=0):t.call(this.target,...i):this.arguments?this.target[this.methodName]=this.arguments[0]||i[0]:this.target[this.methodName]=i[0]}}}}const DV=s=>/^[A-Z]*$/.test(s);class YS extends Event{constructor(){super(...arguments);h(this,"args")}}class ti{constructor(i){h(this,"isEventList",!0);h(this,"target");h(this,"key");h(this,"_isInvoking",!1);h(this,"methods",[]);h(this,"_methodsCopy",[]);if(this.methods=[],Array.isArray(i))for(const t of i)t instanceof Nl?this.methods.push(t):typeof t=="function"&&this.methods.push(new Nl(t));else typeof i=="function"&&this.methods.push(new Nl(i))}__internalOnInstantiate(i){var r;const t=new Array;for(let o=0;o<this.methods.length;o++){const a=this.methods[o];if(!(a.target instanceof Function)){const l=a.target;let c=l==null?void 0:l.uuid;if(l&&(c=l.guid),c){const u=i[c];if(u){const d=(r=a.arguments)==null?void 0:r.map(f=>f instanceof Object&&f.uuid?i[f.uuid]:f!=null&&f.isComponent?i[f.guid]:f);t.push(new Nl(u.clone,a.methodName,d,a.enabled))}else be()&&console.warn("Could not find target for event listener")}}}return new ti(t)}setEventTarget(i,t){if(this.key=i,this.target=t,this.key!==void 0){let n="",r=!1;for(const o of this.key)r&&DV(o)&&(n+="-"),r=!0,n+=o.toLowerCase();this.key=n}}get listenerCount(){var i;return((i=this.methods)==null?void 0:i.length)??0}get isInvoking(){return this._isInvoking}static from(...i){return new ti(i)}invoke(...i){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const n of this._methodsCopy)n.invoke(...i);if(typeof this.target=="object"&&typeof this.key=="string"){const n=this.target.dispatchEvent;if(typeof n=="function"){const r=new YS(this.key);r.args=i,n.call(this.target,r)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(i){return this.methods.push(new Nl(i)),i}removeEventListener(i){if(i)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].target===i&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}const uR=Symbol("previous-visibility"),Xd=class extends Et{render(i,t,n){if(n instanceof pS)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const r=n.getRenderTarget(),o=n.xr.enabled;n.xr.enabled=!1,n.setRenderTarget(this),n.clear(!0,!0,!0),n.render(i,t),n.setRenderTarget(r),n.xr.enabled=o,this.onAfterRender()}}onBeforeRender(){Xd._userSet.clear();const i=HD(this.texture,!0,null,Xd._userSet);for(const t of i)t instanceof Z&&(t[uR]=t.visible,t.visible=!1)}onAfterRender(){for(const i of Xd._userSet)i instanceof Z&&(i.visible=i[uR]);Xd._userSet.clear()}};let gu=Xd;h(gu,"_userSet",new Set);class OV extends Eo{constructor(){super([xe,Ut],"ColorSerializer")}onDeserialize(i){if(i!=null)return i.a!==void 0?new Ut(i.r,i.g,i.b,i.a):i.alpha!==void 0?new Ut(i.r,i.g,i.b,i.alpha):new xe(i.r,i.g,i.b)}onSerialize(i){if(i!=null)return i.a!==void 0?{r:i.r,g:i.g,b:i.b,a:i.a}:{r:i.r,g:i.g,b:i.b}}}const KK=new OV;class LV extends Eo{constructor(){super([Gt],"EulerSerializer")}onDeserialize(i,t){if(i!=null){if(i.order)return new Gt(i.x,i.y,i.z,i.order);if(i.x!=null)return new Gt(i.x,i.y,i.z)}}onSerialize(i,t){return{x:i.x,y:i.y,z:i.z,order:i.order}}}const JK=new LV;class FV extends Eo{constructor(){super(ne,"ObjectSerializer")}onSerialize(i,t){if(t.objectToNode!==void 0&&i.uuid){const n=t.objectToNode[i.uuid];return bn&&console.log(n,i.name,i.uuid),{node:n}}}onDeserialize(i,t){var n,r,o;if(typeof i=="string"){if(i.endsWith(".glb")||i.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(tt))return;be()&&Xt("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const a=(r=(n=t.target)==null?void 0:n.constructor)==null?void 0:r.name;console.warn(`Wrong usage of @serializable detected in your script "${a}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(i){if(i.node!==void 0&&t.nodeToObject){const a=t.nodeToObject[i.node];return bn&&console.log("Deserialized object reference?",i,a,t==null?void 0:t.nodeToObject),a||console.warn("Did not find node: "+i.node,t.nodeToObject,t.object),a}else if(i.guid){if(!t.context){console.error("Missing context");return}let a;const l=(o=t.gltf)==null?void 0:o.scene;return l&&(a=j.findByGuid(i.guid,l)),a||(a=j.findByGuid(i.guid,t.context.scene)),a?(a&&a.isComponent===!0&&(bn&&console.warn("Deserialized object reference is a component"),a=a.gameObject),bn&&console.log("Deserialized object reference?",i,a,t==null?void 0:t.nodeToObject)):((be()||bn)&&console.warn("Could not resolve object reference",t.path,i,t.target,t.context.scene),i.could_not_resolve=!0),a}}}}const UV=new FV;class NV extends Eo{constructor(){super([oe,oe],"ComponentSerializer")}onSerialize(i,t){if(i!=null&&i.guid)return{guid:i.guid}}onDeserialize(i,t){var n;if(i!=null&&i.guid){if(i.___persistentAsset){bn&&console.log("Skipping component deserialization because it's a persistent asset",i);return}const r=t.path;bn&&console.log(i.guid,t.root,t.object,t.target);let o=this.findObjectForGuid(i.guid,t.root);if(o||t.context&&(o=this.findObjectForGuid(i.guid,(n=t.context)==null?void 0:n.scene),o))return o;(be()||bn)&&console.warn('Could not resolve component reference: "'+r+'" using guid '+i.guid,t.target),i.could_not_resolve=!0;return}}findObjectForGuid(i,t){if(t.guid===i)return t;const n=j.foreachComponent(t,r=>{if(r.guid===i)return r},!1);if(n!==void 0)return n;for(let r=0;r<t.children.length;r++){const o=t.children[r],a=this.findObjectForGuid(i,o);if(a)return a}}}const Q_=new NV;class zV extends Eo{constructor(){super([ti])}onSerialize(i,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(i,t){var n,r,o;if(typeof i=="function")return new ti([new Nl(i,null,[],!0)]);if(i&&i.type==="EventList"){bn&&console.log("DESERIALIZE EVENT",i);const a=new Array;if(i.calls&&Array.isArray(i.calls))for(const u of i.calls){let p=function(g){if(typeof g=="object"){let m=UV.onDeserialize(g,t);if(m||(m=Q_.onDeserialize(g,t)),m)return m}return g};bn&&console.log(u);let d=Q_.findObjectForGuid(u.target,t.root);!d&&((n=t.context)!=null&&n.scene)&&(d=Q_.findObjectForGuid(u.target,(r=t.context)==null?void 0:r.scene));const f=((o=u.method)==null?void 0:o.length)>0;if(d&&f){const g=()=>{const A=u.method[0].toUpperCase()+u.method.slice(1);if(typeof d[A]=="function"){console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}. Please rename ${u.method} to ${A}?
`,d[A],`
 in script: `,d),Xt("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}`,d,typeof d[u.method])};if(typeof d[u.method]!="function"){let A=!1,y=d;for(;y;){const b=Object.getOwnPropertyDescriptor(y,u.method);if(b&&(b.writable===!0||b.set)){A=!0;break}y=Object.getPrototypeOf(y)}!A&&(be()||bn)&&g()}}if(d){let g=u.argument;if(g!==void 0?g=p(g):u.arguments!==void 0&&(g=u.arguments.map(p)),!d[u.method])console.warn(`EventList method not found: "${u.method}" on ${d==null?void 0:d.name}`);else{g!==void 0&&!Array.isArray(g)&&(g=[g]);const A=new Nl(d,u.method,g,u.enabled);a.push(A)}}else be()&&console.warn("[Debug] EventList: Could not find event listener in scene",u)}const l=new ti(a);bn&&console.log(l);const c=t.target;return c!==void 0&&t.path!==void 0&&l.setEventTarget(t.path,c),l}}}const ZK=new zV,my=new WeakMap,QV=At.prototype.clone;At.prototype.clone=function(){const s=QV.call(this);return my.has(s)||my.set(s,this),s};class jV extends Eo{constructor(){super([gu,Et])}onSerialize(i,t){}onDeserialize(i,t){if(i instanceof At&&t.type===gu){let n=i;my.has(n)&&(n=my.get(n)),n.isRenderTargetTexture=!0,n.flipY=!0,n.offset.y=1,n.repeat.y=-1,n.needsUpdate=!0,n.mipmaps=[],n instanceof nf&&(n.isCompressedTexture=!1,n.format=qi);const r=new gu(n.image.width,n.image.height,{colorSpace:zi});return r.texture=n,r}}}new jV;class GV extends Eo{constructor(){super([URL])}onSerialize(i,t){return null}onDeserialize(i,t){if(typeof i=="string"&&i.length>0)return Ou(t.gltfId,i)}}new GV;const dR={type:"change"},j_={type:"start"},fR={type:"end"},UA=new gh,pR=new tc,HV=Math.cos(70*ct.DEG2RAD);let WO=class extends cc{constructor(i,t){super(),this.object=i,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new x,this.cursor=new x,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ad.ROTATE,MIDDLE:ad.DOLLY,RIGHT:ad.PAN},this.touches={ONE:ld.ROTATE,TWO:ld.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(z){z.addEventListener("keydown",Zi),this._domElementKeyEvents=z},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Zi),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(dR),n.update(),o=r.NONE},this.update=function(){const z=new x,J=new se().setFromUnitVectors(i.up,new x(0,1,0)),it=J.clone().invert(),Qt=new x,Ds=new se,br=new x,ir=2*Math.PI;return function(Eb=null){const rd=n.object.getWorldPosition(i.position);z.copy(rd).sub(n.target),z.applyQuaternion(J),l.setFromVector3(z),n.autoRotate&&o===r.NONE&&G(M(Eb)),n.enableDamping?(l.theta+=c.theta*n.dampingFactor,l.phi+=c.phi*n.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let Po=n.minAzimuthAngle,Mo=n.maxAzimuthAngle;isFinite(Po)&&isFinite(Mo)&&(Po<-Math.PI?Po+=ir:Po>Math.PI&&(Po-=ir),Mo<-Math.PI?Mo+=ir:Mo>Math.PI&&(Mo-=ir),Po<=Mo?l.theta=Math.max(Po,Math.min(Mo,l.theta)):l.theta=l.theta>(Po+Mo)/2?Math.max(Po,l.theta):Math.min(Mo,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let Bh=!1;if(n.zoomToCursor&&k||n.object.isOrthographicCamera)l.radius=ue(l.radius);else{n.enableDamping?d=ct.lerp(d,u,n.dampingFactor):d=u;const ko=l.radius;l.radius=ue(l.radius*d),Bh=ko!=l.radius}if(z.setFromSpherical(l),z.applyQuaternion(it),rd.copy(n.target).add(z),n.object.parent?n.object.parent.worldToLocal(rd):n.object.position.copy(rd),n.object.lookAt(n.target),n.enableDamping===!0?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),f.set(0,0,0)),n.zoomToCursor&&k){let ko=null;if(n.object.isPerspectiveCamera){const ca=z.length();ko=ue(ca*u);const od=ca-ko;n.object.position.addScaledVector(E,od),n.object.updateMatrixWorld(),Bh=!!od}else if(n.object.isOrthographicCamera){const ca=new x(I.x,I.y,0);ca.unproject(n.object);const od=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),n.object.updateProjectionMatrix(),Bh=od!==n.object.zoom;const _c=new x(I.x,I.y,0);_c.unproject(n.object),n.object.position.sub(_c).add(ca),n.object.updateMatrixWorld(),ko=z.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;ko!==null&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(ko).add(n.object.position):(UA.origin.copy(n.object.position),UA.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(UA.direction))<HV?i.lookAt(n.target):(pR.setFromNormalAndCoplanarPoint(n.object.up,n.target),UA.intersectPlane(pR,n.target))))}else if(n.object.isOrthographicCamera){const ko=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),ko!==n.object.zoom&&(n.object.updateProjectionMatrix(),Bh=!0)}return u=1,k=!1,Bh||Qt.distanceToSquared(n.object.position)>a||8*(1-Ds.dot(n.object.quaternion))>a||br.distanceToSquared(n.target)>a?(n.dispatchEvent(dR),Qt.copy(n.object.position),Ds.copy(n.object.quaternion),br.copy(n.target),!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",as),n.domElement.removeEventListener("pointerdown",Yr),n.domElement.removeEventListener("pointercancel",Dn),n.domElement.removeEventListener("wheel",rs),n.domElement.removeEventListener("pointermove",vr),window.removeEventListener("pointerup",Dn),n.domElement.getRootNode().removeEventListener("keydown",ks,{capture:!0}),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",Zi),n._domElementKeyEvents=null)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const a=1e-6,l=new A1,c=new A1;let u=1,d=1;const f=new x,p=new ae,g=new ae,m=new ae,A=new ae,y=new ae,b=new ae,_=new ae,w=new ae,S=new ae,E=new x,I=new ae;let k=!1;const T=[],P={};let B=!1;function M(z){return z!==null?2*Math.PI/60*n.autoRotateSpeed*z:2*Math.PI/60/60*n.autoRotateSpeed}function U(z){const J=Math.abs(z*.01);return Math.pow(.95,n.zoomSpeed*J)}function G(z){c.theta-=z}function W(z){c.phi-=z}const Y=function(){const z=new x;return function(it,Qt){z.setFromMatrixColumn(Qt,0),z.multiplyScalar(-it),f.add(z)}}(),D=function(){const z=new x;return function(it,Qt){n.screenSpacePanning===!0?z.setFromMatrixColumn(Qt,1):(z.setFromMatrixColumn(Qt,0),z.crossVectors(n.object.up,z)),z.multiplyScalar(it),f.add(z)}}(),L=function(){const z=new x,J=new x;return function(Qt,Ds){const br=n.domElement;if(n.object.isPerspectiveCamera){n.object.getWorldPosition(J),z.copy(J).sub(n.target);let ir=z.length();ir*=Math.tan(n.object.fov/2*Math.PI/180),Y(2*Qt*ir/br.clientHeight,n.object.matrixWorld),D(2*Ds*ir/br.clientHeight,n.object.matrixWorld)}else n.object.isOrthographicCamera?(Y(Qt*(n.object.right-n.object.left)/n.object.zoom/br.clientWidth,n.object.matrixWorld),D(Ds*(n.object.top-n.object.bottom)/n.object.zoom/br.clientHeight,n.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function V(z){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u/=z:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function te(z){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u*=z:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function K(z,J){if(!n.zoomToCursor)return;k=!0;const it=n.domElement.getBoundingClientRect(),Qt=z-it.left,Ds=J-it.top,br=it.width,ir=it.height;I.x=Qt/br*2-1,I.y=-(Ds/ir)*2+1,E.set(I.x,I.y,1).unproject(n.object).sub(n.object.position).normalize()}function ue(z){return Math.max(n.minDistance,Math.min(n.maxDistance,z))}function de(z){p.set(z.clientX,z.clientY)}function _e(z){K(z.clientX,z.clientX),_.set(z.clientX,z.clientY)}function Ee(z){A.set(z.clientX,z.clientY)}function Xe(z){g.set(z.clientX,z.clientY),m.subVectors(g,p).multiplyScalar(n.rotateSpeed);const J=n.domElement;G(2*Math.PI*m.x/J.clientHeight),W(2*Math.PI*m.y/J.clientHeight),p.copy(g),n.update()}function Me(z){w.set(z.clientX,z.clientY),S.subVectors(w,_),S.y>0?V(U(S.y)):S.y<0&&te(U(S.y)),_.copy(w),n.update()}function Ke(z){y.set(z.clientX,z.clientY),b.subVectors(y,A).multiplyScalar(n.panSpeed),L(b.x,b.y),A.copy(y),n.update()}function Pt(z){K(z.clientX,z.clientY),z.deltaY<0?te(U(z.deltaY)):z.deltaY>0&&V(U(z.deltaY)),n.update()}function Tt(z){let J=!1;switch(z.code){case n.keys.UP:z.ctrlKey||z.metaKey||z.shiftKey?W(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):L(0,n.keyPanSpeed),J=!0;break;case n.keys.BOTTOM:z.ctrlKey||z.metaKey||z.shiftKey?W(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):L(0,-n.keyPanSpeed),J=!0;break;case n.keys.LEFT:z.ctrlKey||z.metaKey||z.shiftKey?G(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):L(n.keyPanSpeed,0),J=!0;break;case n.keys.RIGHT:z.ctrlKey||z.metaKey||z.shiftKey?G(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):L(-n.keyPanSpeed,0),J=!0;break}J&&(z.preventDefault(),n.update())}function hi(z){if(T.length===1)p.set(z.pageX,z.pageY);else{const J=$i(z),it=.5*(z.pageX+J.x),Qt=.5*(z.pageY+J.y);p.set(it,Qt)}}function Ei(z){if(T.length===1)A.set(z.pageX,z.pageY);else{const J=$i(z),it=.5*(z.pageX+J.x),Qt=.5*(z.pageY+J.y);A.set(it,Qt)}}function Ps(z){const J=$i(z),it=z.pageX-J.x,Qt=z.pageY-J.y,Ds=Math.sqrt(it*it+Qt*Qt);_.set(0,Ds)}function Wr(z){n.enableZoom&&Ps(z),n.enablePan&&Ei(z)}function ss(z){n.enableZoom&&Ps(z),n.enableRotate&&hi(z)}function Ar(z){if(T.length==1)g.set(z.pageX,z.pageY);else{const it=$i(z),Qt=.5*(z.pageX+it.x),Ds=.5*(z.pageY+it.y);g.set(Qt,Ds)}m.subVectors(g,p).multiplyScalar(n.rotateSpeed);const J=n.domElement;G(2*Math.PI*m.x/J.clientHeight),W(2*Math.PI*m.y/J.clientHeight),p.copy(g)}function qr(z){if(T.length===1)y.set(z.pageX,z.pageY);else{const J=$i(z),it=.5*(z.pageX+J.x),Qt=.5*(z.pageY+J.y);y.set(it,Qt)}b.subVectors(y,A).multiplyScalar(n.panSpeed),L(b.x,b.y),A.copy(y)}function Xr(z){const J=$i(z),it=z.pageX-J.x,Qt=z.pageY-J.y,Ds=Math.sqrt(it*it+Qt*Qt);w.set(0,Ds),S.set(0,Math.pow(w.y/_.y,n.zoomSpeed)),V(S.y),_.copy(w);const br=(z.pageX+J.x)*.5,ir=(z.pageY+J.y)*.5;K(br,ir)}function Ro(z){n.enableZoom&&Xr(z),n.enablePan&&qr(z)}function Bo(z){n.enableZoom&&Xr(z),n.enableRotate&&Ar(z)}function Yr(z){n.enabled!==!1&&(T.length===0&&(n.domElement.setPointerCapture(z.pointerId),n.domElement.addEventListener("pointermove",vr),window.addEventListener("pointerup",Dn)),!yt(z)&&(un(z),z.pointerType==="touch"?os(z):er(z)))}function vr(z){n.enabled!==!1&&(z.pointerType==="touch"?tr(z):yr(z))}function Dn(z){switch(zt(z),T.length){case 0:n.domElement.releasePointerCapture(z.pointerId),n.domElement.removeEventListener("pointermove",vr),n.domElement.removeEventListener("pointerup",Dn),n.dispatchEvent(fR),o=r.NONE;break;case 1:const J=T[0],it=P[J];os({pointerId:J,pageX:it.x,pageY:it.y});break}}function er(z){let J;switch(z.button){case 0:J=n.mouseButtons.LEFT;break;case 1:J=n.mouseButtons.MIDDLE;break;case 2:J=n.mouseButtons.RIGHT;break;default:J=-1}switch(J){case ad.DOLLY:if(n.enableZoom===!1)return;_e(z),o=r.DOLLY;break;case ad.ROTATE:if(z.ctrlKey||z.metaKey||z.shiftKey){if(n.enablePan===!1)return;Ee(z),o=r.PAN}else{if(n.enableRotate===!1)return;de(z),o=r.ROTATE}break;case ad.PAN:if(z.ctrlKey||z.metaKey||z.shiftKey){if(n.enableRotate===!1)return;de(z),o=r.ROTATE}else{if(n.enablePan===!1)return;Ee(z),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(j_)}function yr(z){switch(o){case r.ROTATE:if(n.enableRotate===!1)return;Xe(z);break;case r.DOLLY:if(n.enableZoom===!1)return;Me(z);break;case r.PAN:if(n.enablePan===!1)return;Ke(z);break}}function rs(z){n.enabled===!1||n.enableZoom===!1||o!==r.NONE||(z.preventDefault(),n.dispatchEvent(j_),Pt(Ms(z)),n.dispatchEvent(fR))}function Ms(z){const J=z.deltaMode,it={clientX:z.clientX,clientY:z.clientY,deltaY:z.deltaY};switch(J){case 1:it.deltaY*=16;break;case 2:it.deltaY*=100;break}return z.ctrlKey&&!B&&(it.deltaY*=10),it}function ks(z){z.key==="Control"&&(B=!0,n.domElement.getRootNode().addEventListener("keyup",On,{passive:!0,capture:!0}))}function On(z){z.key==="Control"&&(B=!1,n.domElement.getRootNode().removeEventListener("keyup",On,{passive:!0,capture:!0}))}function Zi(z){n.enabled===!1||n.enablePan===!1||Tt(z)}function os(z){switch(pl(z),T.length){case 1:switch(n.touches.ONE){case ld.ROTATE:if(n.enableRotate===!1)return;hi(z),o=r.TOUCH_ROTATE;break;case ld.PAN:if(n.enablePan===!1)return;Ei(z),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(n.touches.TWO){case ld.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Wr(z),o=r.TOUCH_DOLLY_PAN;break;case ld.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ss(z),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(j_)}function tr(z){switch(pl(z),o){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;Ar(z),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;qr(z),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Ro(z),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Bo(z),n.update();break;default:o=r.NONE}}function as(z){n.enabled!==!1&&z.preventDefault()}function un(z){T.push(z.pointerId)}function zt(z){delete P[z.pointerId];for(let J=0;J<T.length;J++)if(T[J]==z.pointerId){T.splice(J,1);return}}function yt(z){for(let J=0;J<T.length;J++)if(T[J]==z.pointerId)return!0;return!1}function pl(z){let J=P[z.pointerId];J===void 0&&(J=new ae,P[z.pointerId]=J),J.set(z.pageX,z.pageY)}function $i(z){const J=z.pointerId===T[0]?T[1]:T[0];return P[J]}n.domElement.addEventListener("contextmenu",as),n.domElement.addEventListener("pointerdown",Yr),n.domElement.addEventListener("pointercancel",Dn),n.domElement.addEventListener("wheel",rs,{passive:!1}),n.domElement.getRootNode().addEventListener("keydown",ks,{passive:!0,capture:!0}),this.update()}};var Mm=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const gR=Q("debuggroundprojection");class yh extends oe{constructor(){super(...arguments);h(this,"applyOnAwake",!1);h(this,"autoFit",!0);h(this,"_radius",50);h(this,"_height",3);h(this,"_arblending",0);h(this,"_lastEnvironment");h(this,"_lastRadius");h(this,"_lastHeight");h(this,"_projection");h(this,"_watcher");h(this,"_needsTextureUpdate",!1);h(this,"_blurrynessShader",null);h(this,"_lastBlurriness",-1)}set radius(t){this._radius=t,this.updateProjection()}get radius(){return this._radius}set height(t){this._height=t,this.updateProjection()}get height(){return this._height}set arBlending(t){this._arblending=t,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Zc(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,n;(t=this._watcher)==null||t.revoke(),(n=this._projection)==null||n.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await LC(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var n,r,o,a,l;if(!this.context.scene.environment){(n=this._projection)==null||n.removeFromParent();return}if(((r=this.context.xr)!=null&&r.isPassThrough||(o=this.context.xr)!=null&&o.isAR)&&this.arBlending===0){(a=this._projection)==null||a.removeFromParent();return}if(!this.gameObject||this.destroyed)return;const t=0;if((!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius)&&(gR&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(l=this._projection)==null||l.removeFromParent(),this._projection=new If(this.context.scene.environment,this._height,this.radius,64),this._projection.position.y=this._height-t,this._projection.name="GroundProjection",qM(this._projection,!1)),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._projection.parent||this.gameObject.add(this._projection),this.autoFit){this._projection.updateWorldMatrix(!0,!0);const c=sl(this.context.scene.children,[this._projection]),u=c.min.y;if(u<1/0){const d=Ve(this._projection);d.x=c.min.x+(c.max.x-c.min.x)*.5,d.y=u+this._height-t,d.z=c.min.z+(c.max.z-c.min.z)*.5,Sn(this._projection,d)}}(this.context.scene.backgroundBlurriness>.001||this._needsTextureUpdate)&&this.updateBlurriness(),this._needsTextureUpdate=!1}updateBlurriness(){var n;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,gR&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new et({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:VV,fragmentShader:WV})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const t=this._projection.material.transparent;this._projection.material.transparent=(((n=this.context.xr)==null?void 0:n.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,t!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Ho.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}Mm([v()],yh.prototype,"applyOnAwake",void 0);Mm([v()],yh.prototype,"autoFit",void 0);Mm([v()],yh.prototype,"radius",null);Mm([v()],yh.prototype,"height",null);Mm([v()],yh.prototype,"arBlending",null);const VV=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,WV=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var KS=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class jf extends oe{constructor(){super(...arguments);h(this,"constraintActive",!0);h(this,"locked",!1);h(this,"sources",[])}}KS([v()],jf.prototype,"constraintActive",void 0);KS([v()],jf.prototype,"locked",void 0);KS([v(ne)],jf.prototype,"sources",void 0);function eJ(s,i){return mh(s,ut.ContextCreated,i),()=>Ah(s,ut.ContextCreated)}function tJ(s,i){return mh(s,ut.ContextClearing,i),()=>Ah(s,ut.ContextClearing)}function iJ(s,i){return mh(s,ut.ContextDestroying,i),()=>Ah(s,ut.ContextDestroying)}function qO(s,i){return mh(s,qe.Start,i),()=>Ah(s,qe.Start)}function XO(s,i){return mh(s,qe.Update,i),()=>Ah(s,qe.Update)}function qV(s,i){return mh(s,qe.OnBeforeRender,i),()=>Ah(s,qe.OnBeforeRender)}function nJ(s,i){return mh(s,qe.OnAfterRender,i),()=>Ah(s,qe.OnAfterRender)}class mu{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(i,t){return this.bb_pos=i,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(i,t,n,r){return i.prep(4,12),i.writeFloat32(r),i.writeFloat32(n),i.writeFloat32(t),i.offset()}}class YO{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(i,t){return this.bb_pos=i,this.bb=t,this}position(i){return(i||new mu).__init(this.bb_pos,this.bb)}rotation(i){return(i||new mu).__init(this.bb_pos+12,this.bb)}scale(i){return(i||new mu).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(i,t,n,r,o,a,l,c,u,d){return i.prep(4,36),i.prep(4,12),i.writeFloat32(d),i.writeFloat32(u),i.writeFloat32(c),i.prep(4,12),i.writeFloat32(l),i.writeFloat32(a),i.writeFloat32(o),i.prep(4,12),i.writeFloat32(r),i.writeFloat32(n),i.writeFloat32(t),i.offset()}}class zl{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(i,t){return this.bb_pos=i,this.bb=t,this}static getRootAsSyncedTransformModel(i,t){return(t||new zl).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSyncedTransformModel(i,t){return i.setPosition(i.position()+CS),(t||new zl).__init(i.readInt32(i.position())+i.position(),i)}guid(i){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,i):null}fast(){const i=this.bb.__offset(this.bb_pos,6);return i?!!this.bb.readInt8(this.bb_pos+i):!1}transform(i){const t=this.bb.__offset(this.bb_pos,8);return t?(i||new YO).__init(this.bb_pos+t,this.bb):null}dontSave(){const i=this.bb.__offset(this.bb_pos,10);return i?!!this.bb.readInt8(this.bb_pos+i):!1}static startSyncedTransformModel(i){i.startObject(4)}static addGuid(i,t){i.addFieldOffset(0,t,0)}static addFast(i,t){i.addFieldInt8(1,+t,0)}static addTransform(i,t){i.addFieldStruct(2,t,0)}static addDontSave(i,t){i.addFieldInt8(3,+t,0)}static endSyncedTransformModel(i){return i.endObject()}static finishSyncedTransformModelBuffer(i,t){i.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(i,t){i.finish(t,void 0,!0)}}var mn;(function(s){s[s.Average=0]="Average",s[s.Multiply=1]="Multiply",s[s.Minimum=2]="Minimum",s[s.Maximum=3]="Maximum"})(mn||(mn={}));var Ay;(function(s){s[s.Discrete=0]="Discrete",s[s.Continuous=1]="Continuous"})(Ay||(Ay={}));var ki;(function(s){s[s.None=0]="None",s[s.FreezePositionX=2]="FreezePositionX",s[s.FreezePositionY=4]="FreezePositionY",s[s.FreezePositionZ=8]="FreezePositionZ",s[s.FreezePosition=14]="FreezePosition",s[s.FreezeRotationX=16]="FreezeRotationX",s[s.FreezeRotationY=32]="FreezeRotationY",s[s.FreezeRotationZ=64]="FreezeRotationZ",s[s.FreezeRotation=112]="FreezeRotation",s[s.FreezeAll=126]="FreezeAll"})(ki||(ki={}));var Nd;(function(s){s[s.None=0]="None",s[s.X=2]="X",s[s.Y=4]="Y",s[s.Z=8]="Z",s[s.All=-1]="All"})(Nd||(Nd={}));const Ss=function(s,i){return function(t,n,r){XV(t,n,r,s,i)}};function XV(s,i,t,n,r){if(!r&&!n&&!s.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",s,i,t),bi("Invalid usage of validate decorator. Only fields can be validated. Property: "+i,Yi.Error);return}let o="";if(typeof i=="string"?o=i:o=i.name,s.__internalAwake){const a=Symbol(o),l=s.__internalAwake;s.__internalAwake=function(){var c;if(!this.onValidate){be()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((c=s.constructor)==null?void 0:c.name)+'"');return}if(this[a]===void 0){this[a]=this[o];const u=this[o];if(u instanceof ae||u instanceof x||u instanceof Ue||u instanceof se){const d=this[o];FC(d,()=>{this.onValidate(o)})}Object.defineProperty(this,o,{set:function(d){var f;if(this[Ix]===!0)this[a]=d;else{n==null||n.call(this,d);const p=this[a];this[a]=d,(f=this.onValidate)==null||f.call(this,o,p)}},get:function(){return r==null||r.call(this),this[a]}})}l.call(this)}}}const sJ=function(s){return function(i,t,n){let r="";typeof t=="string"?r=t:r=t.name;const o=s.prototype,a=Object.getOwnPropertyDescriptor(o,r);if(!(a!=null&&a.value)){console.warn("Can not apply prefix: type does not have method named",t,s);return}const l=a.value,c=i[r];Object.defineProperty(o,r,{value:function(...u){const d=c==null?void 0:c.call(this,...u);if(d instanceof Promise){d.then(f=>{if(f!==!1)return l.call(this,...u)});return}if(d!==!1)return l.call(this,...u)}})}};var zr=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class YV{constructor(i,t){h(this,"positionChanged",!1);h(this,"rotationChanged",!1);h(this,"position");h(this,"quaternion");h(this,"_positionKeys",["x","y","z"]);h(this,"_quaternionKeys",["_x","_y","_z","_w"]);h(this,"mute",!1);h(this,"context");h(this,"obj");h(this,"_positionWatch");h(this,"_rotationWatch");this.context=t,this.obj=i}get isDirty(){return this.positionChanged||this.rotationChanged}reset(i=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,i){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const i of this._positionKeys)this.position[i]=this.obj.position[i];for(const i of this._quaternionKeys)this.quaternion[i]=this.obj.quaternion[i]}applyValues(){if(this.positionChanged&&this.position)for(const i of this._positionKeys){const t=this.position[i];t!==void 0&&(this.obj.position[i]=t)}if(this.rotationChanged&&this.quaternion)for(const i of this._quaternionKeys){const t=this.quaternion[i];t!==void 0&&(this.obj.quaternion[i]=t)}}start(i,t){this.reset(),i&&(this._positionWatch||(this._positionWatch=new Zc(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((o,a)=>{var c;if((c=this.context.physics.engine)!=null&&c.isUpdating||this.mute)return;const l=this.position[a];Math.abs(l-o)<1e-5||(this.position[a]=o,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new Zc(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((o,a)=>{var c;if((c=this.context.physics.engine)!=null&&c.isUpdating||this.mute)return;const l=this.quaternion[a];Math.abs(l-o)<1e-5||(this.quaternion[a]=o,this.rotationChanged=!0)}));const n=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),r=new le;this.obj.matrixWorld.multiplyMatrices=(o,a)=>{var l;return(l=this.context.physics.engine)!=null&&l.isUpdating||this.mute||r.equals(o)||(this.positionChanged=!0,this.rotationChanged=!0,r.copy(o)),n(o,a)}}stop(){var i,t;(i=this._positionWatch)==null||i.revoke(),(t=this._rotationWatch)==null||t.revoke()}}const Ky=class extends oe{constructor(){super(...arguments);h(this,"autoMass",!0);h(this,"_mass",0);h(this,"useGravity",!0);h(this,"centerOfMass",new x(0,0,0));h(this,"constraints",ki.None);h(this,"isKinematic",!1);h(this,"drag",0);h(this,"angularDrag",1);h(this,"detectCollisions",!0);h(this,"sleepThreshold",.01);h(this,"collisionDetectionMode",Ay.Discrete);h(this,"_gravityScale",1);h(this,"dominanceGroup",0);h(this,"_propertiesChanged",!1);h(this,"_currentVelocity",new x);h(this,"_smoothedVelocity",new x);h(this,"_smoothedVelocityGetter",new x);h(this,"_lastPosition",new x);h(this,"_watch")}set mass(t){t!==this._mass&&(this._mass=t,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var t,n;return this.autoMass?((n=(t=this.context.physics.engine)==null?void 0:t.getBody(this))==null?void 0:n.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&ki.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&ki.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&ki.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&ki.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&ki.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&ki.FreezeRotationZ)!==0}set lockPositionX(t){t?this.constraints|=ki.FreezePositionX:this.constraints&=~ki.FreezePositionX}set lockPositionY(t){t?this.constraints|=ki.FreezePositionY:this.constraints&=~ki.FreezePositionY}set lockPositionZ(t){t?this.constraints|=ki.FreezePositionZ:this.constraints&=~ki.FreezePositionZ}set lockRotationX(t){t?this.constraints|=ki.FreezeRotationX:this.constraints&=~ki.FreezeRotationX}set lockRotationY(t){t?this.constraints|=ki.FreezeRotationY:this.constraints&=~ki.FreezeRotationY}set lockRotationZ(t){t?this.constraints|=ki.FreezeRotationZ:this.constraints&=~ki.FreezeRotationZ}set gravityScale(t){this._gravityScale=t}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new YV(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),qe.LateUpdate)}onDisable(){var t,n;(t=this._watch)==null||t.stop(),(n=this.context.physics.engine)==null||n.removeBody(this)}onDestroy(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var t,n,r,o;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(t=this.context.physics.engine)==null||t.updateProperties(this)),(n=this._watch)!=null&&n.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(r=this.context.physics.engine)==null||r.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(o=this._watch)==null||o.syncValues(),this.captureVelocity(),yield}teleport(t,n=!0){var r;(r=this._watch)==null||r.reset(!0),n?this.gameObject.position.set(t.x,t.y,t.z):this.setWorldPosition(t.x,t.y,t.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(t=!0){var n;(n=this.context.physics.engine)==null||n.resetForces(this,t)}resetTorques(t=!0){var n;(n=this.context.physics.engine)==null||n.resetTorques(this,t)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var t;(t=this.context.physics.engine)==null||t.wakeup(this)}get isSleeping(){var t;return(t=this.context.physics.engine)==null?void 0:t.isSleeping(this)}updateProperties(){var t;return this._propertiesChanged=!1,(t=this.context.physics.engine)==null?void 0:t.updateProperties(this)}applyForce(t,n,r=!0){var o;this._propertiesChanged&&this.updateProperties(),(o=this.context.physics.engine)==null||o.addForce(this,t,r)}applyImpulse(t,n=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.applyImpulse(this,t,n)}setForce(t,n,r,o=!0){var a,l,c;(a=this.context.physics.engine)==null||a.resetForces(this,o),typeof t=="number"?(n??(n=0),r??(r=0),(l=this.context.physics.engine)==null||l.addForce(this,{x:t,y:n,z:r},o)):(c=this.context.physics.engine)==null||c.addForce(this,t,o)}getVelocity(){var n;const t=(n=this.context.physics.engine)==null?void 0:n.getLinearVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(t,n,r,o=!0){var a,l;if(t instanceof x){const c=t;(a=this.context.physics.engine)==null||a.setLinearVelocity(this,c,o);return}n===void 0||r===void 0||(l=this.context.physics.engine)==null||l.setLinearVelocity(this,{x:t,y:n,z:r},o)}getAngularVelocity(){var n;const t=(n=this.context.physics.engine)==null?void 0:n.getAngularVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(t,n,r,o=!0){var a,l;if(typeof t=="object"){const c=t;(a=this.context.physics.engine)==null||a.setAngularVelocity(this,c,o);return}if(n===void 0||r===void 0||typeof n=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(l=this.context.physics.engine)==null||l.setAngularVelocity(this,{x:t,y:n,z:r},o)}setTorque(t,n,r){typeof t=="number"?this.setAngularVelocity(t,n,r):this.setAngularVelocity(t)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(t=null){}captureVelocity(){const t=Ve(this.gameObject);this.gameObject.matrixWorld.decompose(Ky.tempPosition,KV,JV);const n=t.sub(this._lastPosition);this._lastPosition.copy(Ky.tempPosition),this._smoothedVelocity.lerp(n,this.context.time.deltaTime/.1)}};let It=Ky;h(It,"tempPosition",new x);zr([Ss()],It.prototype,"autoMass",void 0);zr([v()],It.prototype,"mass",null);zr([Ss(),v()],It.prototype,"useGravity",void 0);zr([v(x)],It.prototype,"centerOfMass",void 0);zr([Ss(),v()],It.prototype,"constraints",void 0);zr([Ss(),v()],It.prototype,"isKinematic",void 0);zr([Ss(),v()],It.prototype,"drag",void 0);zr([Ss(),v()],It.prototype,"angularDrag",void 0);zr([Ss(),v()],It.prototype,"detectCollisions",void 0);zr([Ss(),v()],It.prototype,"sleepThreshold",void 0);zr([Ss(),v()],It.prototype,"collisionDetectionMode",void 0);zr([Ss()],It.prototype,"_gravityScale",void 0);zr([Ss()],It.prototype,"dominanceGroup",void 0);new x;const KV=new se,JV=new x,Oc=Q("debugsync"),om="STRS";Wk(om,zl.getRootAsSyncedTransformModel);const fa=new Cm;function KO(s,i,t=!0){fa.clear();const n=fa.createString(s);zl.startSyncedTransformModel(fa),zl.addGuid(fa,n),zl.addFast(fa,t);const r=i.worldPosition,o=i.worldEuler,a=i.gameObject.scale;zl.addTransform(fa,YO.createTransform(fa,r.x,r.y,r.z,o.x,o.y,o.z,a.x,a.y,a.z));const l=zl.endSyncedTransformModel(fa);return fa.finish(l,om),fa.asUint8Array()}let jx=0,pg=0;XO(s=>{var n;const t=((n=s.connection.currentServerUrl)==null?void 0:n.includes("glitch"))?10:40;pg=Math.floor(jx/t),jx=0,Oc&&pg>0&&console.log("Sync Transform Fast Interval",pg)});class rc extends oe{constructor(){super(...arguments);h(this,"overridePhysics",!0);h(this,"interpolatePosition",!0);h(this,"interpolateRotation",!0);h(this,"fastMode",!1);h(this,"syncDestroy",!1);h(this,"_model",null);h(this,"_needsUpdate",!0);h(this,"rb",null);h(this,"_wasKinematic",!1);h(this,"_receivedDataBefore",!1);h(this,"_targetPosition");h(this,"_targetRotation");h(this,"_receivedFastUpdate",!1);h(this,"_shouldRequestOwnership",!1);h(this,"joinedRoomCallback",null);h(this,"receivedDataCallback",null);h(this,"tempEuler",new Gt);h(this,"receivedUpdate",!1);h(this,"lastWorldPos");h(this,"lastWorldRotation")}requestOwnership(){Oc&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){Oc&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new x,this._targetRotation=new se,this.lastWorldPos=new x,this.lastWorldRotation=new se,this.rb=j.getComponentInChildren(this.gameObject,It),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new LD(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(je.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(om,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&KD(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(je.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(om,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var n;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){Oc&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const r=t.transform();if(r){ta.markDirty(this.gameObject,!0);const o=r.position();o&&(this.interpolatePosition&&((n=this._targetPosition)==null||n.set(o.x(),o.y(),o.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(o.x(),o.y(),o.z()));const a=r.rotation();a&&(this.tempEuler.set(a.x(),a.y(),a.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&VM(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Oc&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,n=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const a=t.distanceTo(this.lastWorldPos),l=n.angleTo(this.lastWorldRotation),c=this._model.hasOwnership||this.fastMode?1e-4:.001;(a>c||l>c)&&(this._model.hasOwnership?this._needsUpdate=!0:(Oc&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,n.copy(this.lastWorldRotation),ta.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const l=this._receivedFastUpdate||this.fastMode?.5:.3;let c=!1;if(this.interpolatePosition&&this._targetPosition){const u=this.worldPosition;u.lerp(this._targetPosition,l),this.worldPosition=u,c=!0}if(this.interpolateRotation&&this._targetRotation){const u=this.worldQuaternion;u.slerp(this._targetRotation,l),this.worldQuaternion=u,c=!0}c&&ta.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(n),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(Oc&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const r=10,o=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%r===0||o)){if(jx++,o&&pg>0&&this.context.time.frameCount%pg!==0)return;Oc&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const a=KO(this.guid,this,!!o);this.context.connection.sendBinary(a)}}}const ZV=Q("debugshadowcomponents");cS.prototype.interactable={get(){return this.interactive},set(s){this.interactable=s}};const po=Symbol("shadowDomOwner");class sa extends oe{constructor(){super(...arguments);h(this,"_shadowComponent",null);h(this,"_controlsChildLayout",!0);h(this,"_root");h(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}get Canvas(){return this.canvas}markDirty(){Dr.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(t){this._shadowComponent=t}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=j.getComponentInParent(this.gameObject,O0)),this._root}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(t,n){var a;if(!t)return;this.removeShadowComponent();const r=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=j.getComponentInParent(r,sa),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[po]=this,this.setShadowComponentOwner(t);let o=!1;if(((a=this.Root)==null?void 0:a.gameObject)===this.gameObject)this.gameObject.add(t);else{const l=this._parentComponent.shadowComponent;l&&(l==null||l.add(t),o=!0)}this.shadowComponent=t,n&&n.shadowComponent&&this.shadowComponent&&n.shadowComponent.add(this.shadowComponent),Em&&t.add(new dr(.5)),this.onAfterAddedToScene(),o&&zM(),ZV&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(t){if(t&&(t[po]===void 0||t[po]===this)&&(t[po]=this,t.children))for(const n of t.children)this.setShadowComponentOwner(n)}traverseOwnedShadowComponents(t,n,r){if(t&&t[po]===n){r(t);for(const o of t.children)this.traverseOwnedShadowComponents(o,n,r)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class O0 extends sa{awake(){super.awake()}}class km{constructor(i,t){h(this,"event");h(this,"button");h(this,"buttonName");h(this,"_used",!1);h(this,"_propagationStopped",!1);h(this,"z__pointer_ctured",!1);h(this,"z__pointer_cture_rleased",!1);h(this,"inputSource");h(this,"object");h(this,"point");h(this,"normal");h(this,"face");h(this,"distance");h(this,"instanceId");h(this,"intersection");h(this,"isDown");h(this,"isUp");h(this,"isPressed");h(this,"isClick");h(this,"isDoubleClick");h(this,"input");this.event=t,this.input=i,this.button=t.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const i=new km(this.input,this.event);return Object.assign(i,this),i}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function Gx(s,i){return j.foreachComponent(s,n=>{if(!n.enabled)return;const r=n;if(i)switch(i){case"pointerdown":if(r.onPointerDown)return!0;break;case"pointerup":if(r.onPointerUp||r.onPointerClick)return!0;break;case"pointermove":if(r.onPointerEnter||r.onPointerExit||r.onPointerMove)return!0;break}else if(r.onPointerDown||r.onPointerUp||r.onPointerEnter||r.onPointerExit||r.onPointerClick)return!0},!1)===!0}var $V=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Dm extends oe{awake(){Dr.createIfNoneExists(this.context)}onEnable(){var i;(i=Dr.get(this.context))==null||i.register(this)}onDisable(){var i;(i=Dr.get(this.context))==null||i.unregister(this)}}class Co extends Dm{constructor(){super(...arguments);h(this,"targets",null);h(this,"raycastHits",[]);h(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(t=null){if(!this.targets)return null;t??(t=new sc),t.targets=this.targets,t.results=this.raycastHits,t.useAcceleratedRaycast=!0;const n=t.testObject;this.ignoreSkinnedMeshes&&(t.testObject=o=>o instanceof $o?"continue in children":n?n(o):!0);const r=this.context.physics.raycast(t);return t.testObject=n,r}}$V([v()],Co.prototype,"ignoreSkinnedMeshes",void 0);class JS extends Co{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const i1=class extends Dm{performRaycast(i){if(!Fe.active||!i1.allow||!(i!=null&&i.ray))return null;const t=i.ray.origin,n=.015;return this.context.physics.sphereOverlap(t,n,!1,!0)}};let Au=i1;h(Au,"allow",!0);class ZS{static getObject(i){const t=i[po];return t&&(t.isComponent===!0?i=t.gameObject:i=t),i}static isInteractable(i,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),i==null||!i.visible||(i=this.getObject(i),!i.visible))return!1;const n=this.tryFindCanvasGroup(i);if((n==null?void 0:n.isCanvasGroup)===!0&&(t&&(t.canvasGroup=n),n.blocksRaycasts===!1||n.interactable===!1))return!1;const r=Df(i,o=>{if(o.isGraphic===!0)return o},!1);return t&&(r==null?void 0:r.isGraphic)===!0&&(t.graphic=r),!((r==null?void 0:r.raycastTarget)===!1||(r==null?void 0:r.layer)===2)}static tryFindCanvasGroup(i){if(!i)return null;const t=Df(i,n=>{const r=n;if(r.blocksRaycasts!==void 0&&r.interactable!==void 0)return r},!1);return t!==void 0?t:this.tryFindCanvasGroup(i.parent)}}function $S(s){const i=s[po];return i||(s.parent?$S(s.parent):null)}function e9(s){return s.isUI===!0||typeof s[po]=="object"}function vy(s,i){if(!s)return;const t=s.material;if((t==null?void 0:t.isMaterial)===!0){const n=s.parent;n&&n.isText,t.side=i.doubleSided??!0?_i:il,t.shadowSide=i.doubleSided?_i:il,s.castShadow=i.castShadows?i.castShadows:!1,s.receiveShadow=i.receiveShadows?i.receiveShadows:!1}for(const n of s.children)vy(n,i)}function Id(s,i,t){s[i]===void 0&&console.warn("Field",i,"is undefined on",s);const n=Proxy.revocable(s[i],{set(a,l,c,u){const d=a[l],f=Reflect.set(a,l,c,u);return t(c,d),f}}),r=n.revoke,o=s[i];return n.revoke=()=>{s[i]=o,r()},s[i]=n.proxy,n}const mR=Symbol("Scheduled action");function t9(s,i,t=qe.OnBeforeRender){let n=s[mR];n||(n=s[mR]={});const r=i.name;n[t]||(n[t]={});const o=n[t];if(o[r])return;function*l(){i==null||i.call(s),o[r]=null}const c=s.startCoroutine(l(),t);o[r]=c}const Sl=Q("debugeventsystem");var Lf;(function(s){s.BeforeHandleInput="BeforeHandleInput",s.AfterHandleInput="AfterHandleInput"})(Lf||(Lf={}));const xa=class extends oe{constructor(){super();h(this,"raycaster",[]);h(this,"pressedByID",new Map);h(this,"hoveredByID",new Map);h(this,"onPointerEvent",t=>{if(t===void 0||t.propagationStopped||t.defaultPrevented||t.used)return;const n=new km(this.context.input,t);this._currentPointerEventName=t.type,n.inputSource=this.context.input,n.isClick=t.isClick,n.isDoubleClick=t.isDoubleClick,n.isDown=t.type==dt.PointerDown,n.isUp=t.type==dt.PointerUp,n.isPressed=this.context.input.getPointerPressed(t.pointerId),Sl&&(n.isDown?console.log("DOWN",n.pointerId):n.isUp&&console.log("UP",n.pointerId),n.isClick&&console.log("CLICK",n.pointerId));const r=new sc;t.hasRay?r.ray=t.ray:r.screenPoint=this.context.input.getPointerPositionRC(t.pointerId);const o=this.performRaycast(r);if(o){for(const l of o)l.event=t,t.intersections.push(l);t.origin.onPointerHits&&t.origin.onPointerHits({sender:this,event:t,hits:o})}Sl&&n.isClick&&bi("EventSystem: "+n.pointerId+" - "+this.context.time.frame+" - Up:"+n.isUp+", Down:"+n.isDown);const a={sender:this,args:n,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent(Lf.BeforeHandleInput,{detail:a})),this.handleIntersections(o,n),this.dispatchEvent(new CustomEvent(Lf.AfterHandleInput,{detail:a}))});h(this,"_sortedHits",[]);h(this,"_testObjectsCache",new Map);h(this,"_currentlyActiveRaycaster",null);h(this,"_currentPointerEventName",null);h(this,"shouldRaycastObject",t=>{var o;let n=null;if(e9(t)&&(n=(o=t[po])==null?void 0:o.gameObject),this._testObjectsCache.has(t)||n&&this._testObjectsCache.has(n))return this._testObjectsCache.get(t)===!1?"continue in children":!0;{let a=Gx(t,this._currentPointerEventName);if(!a&&n&&(a=Gx(n,this._currentPointerEventName)),a){this._testObjectsCache.set(t,!0);for(const l of t.children)this.shouldRaycastObject_AddToYesCache(l);return!0}return this._testObjectsCache.set(t,!1),"continue in children"}});h(this,"_sortingBuffer",[]);h(this,"_noDepthTestingResults",[]);h(this,"out",{});h(this,"_capturedPointer",{});h(this,"pointerEnterSymbol",Symbol("pointerEnter"));h(this,"pointerExitSymbol",Symbol("pointerExit"));h(this,"currentActiveMeshUIComponents",[]);xa.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,xa.systems.length<=0&&xa.systems.push(...j.findObjectsOfType(xa,t)));for(const r of xa.systems)if(r.context===t)return;const n=new ne;j.addNewComponent(n,xa),t.scene.add(n)}static get systems(){const t=Ge.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const n=this._eventSystemMap.get(t);return n&&n.length>0?n[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,n,r=!1){Hc.update(t,n,r)}static markUIDirty(t){Hc.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){xa.systems.splice(xa.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!j.findObjectOfType(Dm,this.context)){const n=j.addNewComponent(this.context.scene,Co);this.raycaster.push(n),(be()||Sl)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(t){var n;t&&this.raycaster&&!this.raycaster.includes(t)&&((n=this.raycaster)==null||n.push(t))}unregister(t){var r,o;const n=(r=this.raycaster)==null?void 0:r.indexOf(t);n!==void 0&&n!==-1&&((o=this.raycaster)==null||o.splice(n,1))}onEnable(){this.context.input.addEventListener(dt.PointerDown,this.onPointerEvent),this.context.input.addEventListener(dt.PointerUp,this.onPointerEvent),this.context.input.addEventListener(dt.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(dt.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(dt.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(dt.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(t){this._testObjectsCache.set(t,!0);for(const n of t.children)this.shouldRaycastObject_AddToYesCache(n)}performRaycast(t){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,t||(t=new sc),t.testObject=this.shouldRaycastObject;for(const n of this.raycaster){if(!n.activeAndEnabled)continue;this._currentlyActiveRaycaster=n;const r=n.performRaycast(t);this._currentlyActiveRaycaster=null,r&&r.length>0&&this._sortedHits.push(...r)}return this._sortedHits.sort((n,r)=>n.distance-r.distance),this._sortedHits}assignHitInformation(t,n){n?(t.intersection=n,t.point=n.point,t.normal=n.normal,t.face=n.face,t.distance=n.distance,t.instanceId=n.instanceId):(t.intersection=void 0,t.point=void 0,t.normal=void 0,t.face=void 0,t.distance=void 0,t.instanceId=void 0)}handleIntersections(t,n){var o;if(t!=null&&t.length){t=this.sortCandidates(t);for(const a of t){if(n.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(n,a),this.handleEventOnObject(a.object,n))return!0}}this.assignHitInformation(n,t==null?void 0:t[0]),this.invokePointerCapture(n);const r=this.hoveredByID.get(n.pointerId);return r&&this.propagatePointerExit(r.obj,r.data,null),this.hoveredByID.delete(n.pointerId),n.isUp&&((o=this.pressedByID.get(n.pointerId))==null||o.handlers.forEach(a=>this.invokeOnPointerUp(n,a)),this.pressedByID.delete(n.pointerId)),!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let n=0;n<t.length;n++){const r=t[n],o=r.object;if(o.material&&o.material.depthTest===!1){this._noDepthTestingResults.push(r);continue}this._sortingBuffer.push(r)}for(const n of this._sortingBuffer)this._noDepthTestingResults.push(n);return this._noDepthTestingResults}handleEventOnObject(t,n){if(!this.testIsVisible(t))return n.isClick&&Sl&&console.log("not allowed",t),!1;if(n.pointerId===void 0)return Sl&&console.error("Event without pointer can't be handled",n),!1;n.object=t;const r=t.parent,o=n.isClick??!1;let a=null;if(r&&r.isUI){const f=(n.isPressed||n.isClick)??!1;if(r[po]){const p=r[po].gameObject;if(p){if(!ZS.isInteractable(p,this.out))return!1;a=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,f),t=p}}}o&&Sl&&console.log(this.context.time.frame,t);const l=this.hoveredByID.get(n.pointerId),c=l==null?void 0:l.obj;c!==t&&c&&this.propagatePointerExit(c,l.data,t);const d=this.hoveredByID.get(n.pointerId);if(d?(d.obj=t,d.data=n):this.hoveredByID.set(n.pointerId,{obj:t,data:n}),n.isDown){const f=this.pressedByID.get(n.pointerId);f?(f.obj=t,f.data=n):this.pressedByID.set(n.pointerId,{obj:t,data:n,handlers:new Set})}return(a===null||a.interactable)&&this.handleMainInteraction(t,n,c??null),!0}propagate(t,n){for(;t;)j.foreachComponent(t,r=>{n(r)},!1),t=t.parent}handleMainInteraction(t,n,r){const o=this.pressedByID.get(n.pointerId),a=r!==t;let l=!0;switch(n.event.pointerType){case"mouse":case"touch":const c=this.context.input.getPointerPositionLastFrame(n.pointerId),u=this.context.input.getPointerPosition(n.pointerId);l=c&&!ye.approximately(c,u);break}this.propagate(t,c=>{var d;const u=c;u.interactable!==!1&&(!u.activeAndEnabled||!u.enabled||(u.onPointerEnter&&a&&this.handlePointerEnter(u,n),n.isDown&&u.onPointerDown&&(u.onPointerDown(n),o==null||o.handlers.add(u),this.handlePointerCapture(n,u)),u.onPointerMove&&(l&&u.onPointerMove(n),this.handlePointerCapture(n,u)),n.isUp&&(u.onPointerUp&&(this.invokeOnPointerUp(n,u),o==null||o.handlers.delete(u)),u.onPointerExit&&((d=n.event)==null?void 0:d.pointerType)===Kc.Touch&&(this.handlePointerExit(u,n),this.hoveredByID.delete(n.pointerId))),n.isClick&&u.onPointerClick&&u.onPointerClick(n)))}),n.isUp&&(o==null||o.handlers.forEach(c=>{this.invokeOnPointerUp(n,c)}),this.pressedByID.delete(n.pointerId))}propagatePointerExit(t,n,r){this.propagate(t,o=>{if(!o.gameObject||o.destroyed)return;const a=o;if(a.onPointerExit||a.onPointerEnter){if(r&&this.isChild(r,o.gameObject))return;this.handlePointerExit(a,n)}})}invokeOnPointerUp(t,n){var r;(r=n.onPointerUp)==null||r.call(n,t),this.releasePointerCapture(t,n)}handlePointerEnter(t,n){t.onPointerEnter&&this.updatePointerState(t,n.pointerId,this.pointerEnterSymbol,!0)&&t.onPointerEnter(n),this.updatePointerState(t,n.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(t,n){t.onPointerExit&&this.updatePointerState(t,n.pointerId,this.pointerExitSymbol,!0)&&t.onPointerExit(n),this.updatePointerState(t,n.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(t,n,r,o){let a=t[r];if(o)return a&&a.includes(n)?!1:(a=a||[],a.push(n),t[r]=a,!0);{if(!a||!a.includes(n))return!1;const l=a.indexOf(n);return l!==-1&&a.splice(l,1),!0}}handlePointerCapture(t,n){if(t.z__pointer_ctured){t.z__pointer_ctured=!1;const r=t.pointerId;if(n.onPointerMove){const o=this._capturedPointer[r]||[];o.push(n),this._capturedPointer[r]=o}else be()&&!n.z__warned_no_pointermove&&(n.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else t.z__pointer_cture_rleased&&(t.z__pointer_cture_rleased=!1,this.releasePointerCapture(t,n))}releasePointerCapture(t,n){const r=t.pointerId;if(this._capturedPointer[r]){const o=this._capturedPointer[r].indexOf(n);o!==-1&&(this._capturedPointer[r].splice(o,1),Sl&&console.log("released pointer capture",r,n,this._capturedPointer))}}invokePointerCapture(t){var n;if(t.event.type===dt.PointerMove){const r=t.pointerId,o=this._capturedPointer[r];if(o){Sl&&console.log("Captured",r,o);for(let a=0;a<o.length;a++){const l=o[a];if(l.destroyed){o.splice(a,1),a--;continue}(n=l.onPointerMove)==null||n.call(l,t)}}}}isChild(t,n){return!t||!n?!1:t===n?!0:t.parent?this.isChild(t.parent,n):!1}handleMeshUiObjectWithoutShadowDom(t,n){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,n)}handleMeshUIIntersection(t,n){const r=Hc.updateState(t,n);return r&&this.currentActiveMeshUIComponents.push(r),r!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Hc.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const n=this.currentActiveMeshUIComponents[t];Hc.resetState(n)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?j.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let Dr=xa;h(Dr,"_eventSystemMap",new Map),h(Dr,"didSearchEventSystem",!1);class Hc{static markDirty(){this.needsUpdate=!0}static update(i,t,n=!1){if(n){i.update();return}const r=t.time.frameCount;for(const o of this.lastUpdateFrame)if(o.context===t){if(r===o.frame)return;o.frame=r;let a=this.needsUpdate||r<1;o.nextUpdate<=r&&(a=!0),a&&(Sl&&console.log("Update threemeshui"),this.needsUpdate=!1,o.nextUpdate=r+60,i.update());return}this.lastUpdateFrame=[{context:t,frame:r,nextUpdate:r+60}],i.update(),this.needsUpdate=!1}static updateState(i,t){let n=null;if(i&&(n=this.findBlockInParent(i),n&&n!==this.lastSelected)){if(n.interactable===!1)return null;this.needsUpdate=!0}return n}static resetLastSelected(){const i=this.lastSelected;i&&(this.lastSelected=null,this.resetState(i))}static resetState(i){i&&(this.needsUpdate=!0)}static findBlockInParent(i){return i?i.isBlock?i:this.findBlockInParent(i.parent):null}}h(Hc,"lastSelected",null),h(Hc,"lastUpdateFrame",[]),h(Hc,"needsUpdate",!1);var yi=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const G_=Q("debugorbit"),H_=Q("freecam"),NA=Q("debugcamerafit"),zA=Q("smoothcam"),i9={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let V_;var Hx;(function(s){s.CameraTargetReached="target-reached"})(Hx||(Hx={}));class yy extends CustomEvent{constructor(i,t){super(Hx.CameraTargetReached,{detail:{controls:i,type:t}})}}class Lt extends oe{constructor(){super(...arguments);h(this,"autoTarget",!0);h(this,"autoFit",!1);h(this,"enableRotate",!0);h(this,"autoRotate",!1);h(this,"autoRotateSpeed",1);h(this,"minAzimuthAngle",1/0);h(this,"maxAzimuthAngle",1/0);h(this,"minPolarAngle",0);h(this,"maxPolarAngle",Math.PI);h(this,"enableKeys",!0);h(this,"enableDamping",!0);h(this,"dampingFactor",.1);h(this,"enableZoom",!0);h(this,"minZoom",0);h(this,"maxZoom",1/0);h(this,"zoomSpeed",1);h(this,"zoomToCursor",!1);h(this,"enablePan",!0);h(this,"lookAtConstraint",null);h(this,"lookAtConstraint01",1);h(this,"allowInterrupt",!0);h(this,"middleClickToFocus",!0);h(this,"doubleClickToFocus",!0);h(this,"clickBackgroundToFitScene",2);h(this,"debugLog",!1);h(this,"targetLerpDuration",1);h(this,"_controls",null);h(this,"_cameraObject",null);h(this,"_lookTargetLerpActive",!1);h(this,"_lookTargetStartPosition",new x);h(this,"_lookTargetEndPosition",new x);h(this,"_lookTargetLerp01",0);h(this,"_lookTargetLerpDuration",0);h(this,"_cameraLerpActive",!1);h(this,"_cameraStartPosition",new x);h(this,"_cameraEndPosition",new x);h(this,"_cameraLerp01",0);h(this,"_cameraLerpDuration",0);h(this,"_inputs",0);h(this,"_enableTime",0);h(this,"_startedListeningToKeyEvents",!1);h(this,"_eventSystem");h(this,"_afterHandleInputFn");h(this,"_camera",null);h(this,"_syncedTransform");h(this,"_didSetTarget",0);h(this,"targetElement",null);h(this,"_activePointerEvents");h(this,"_lastTimeClickOnBackground",-1);h(this,"_clickOnBackgroundCount",0);h(this,"_onPointerDown",t=>{this._activePointerEvents.push(t)});h(this,"_onPointerUp",t=>{for(let n=this._activePointerEvents.length-1;n>=0;n--){const r=this._activePointerEvents[n];if(r.pointerId===t.pointerId&&r.button===t.button){this._activePointerEvents.splice(n,1);break}}if(this.clickBackgroundToFitScene>0&&t.isClick&&t.button===0){if(t.hasRay||t.intersections.push(...this.context.physics.raycast()),t.intersections.length<=0){const n=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||n<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}G_&&console.log(this.clickBackgroundToFitScene,t.intersections.length,this._clickOnBackgroundCount)}});h(this,"_onPointerUpLate",t=>{this.doubleClickToFocus&&t.isDoubleClick&&!t.used&&this.setTargetFromRaycast()});h(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});h(this,"_shouldDisable",!1);h(this,"__onPreRender",()=>{const t=this.context.pre_render_callbacks.indexOf(this.__onPreRender);t>=0&&this.context.pre_render_callbacks.splice(t,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))});h(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var n;(n=this.controls)==null||n.addEventListener("start",t)}get targetLerpSpeed(){return 5}set targetLerpSpeed(t){this.targetLerpDuration=1/t}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=Dr.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(Lf.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,n;(t=this._controls)==null||t.dispose(),(n=this._eventSystem)==null||n.removeEventListener(Lf.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const t=j.getComponent(this.gameObject,Bt);this._camera=t;let n=t==null?void 0:t.cam;if(!n&&this.gameObject instanceof bt&&(n=this.gameObject),n&&U1(n,this,!0),!this._controls&&n instanceof bt){this._cameraObject=n;const r=this.targetElement??this.context.renderer.domElement,o=n==null?void 0:n.quaternion.clone();this._controls=new WO(n,r),n==null||n.quaternion.copy(o),V_===void 0&&(V_={...this._controls.keys})}this._controls&&(H_&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,uc()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=j.getComponent(this.gameObject,rc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Pr.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Pr.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:Pr.Late})}onDisable(){var t;(t=this._camera)!=null&&t.cam&&U1(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var n,r,o,a;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((n=this.context.input.getPointerPositionDelta(0))!=null&&n.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const l=j.getComponent(this.gameObject,Bt);if(l&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const c=Ve(l.cam),u=Math.max(.01,c.length()),d=new x(0,0,-u).applyMatrix4(l.cam.matrixWorld);this.setLookTargetPosition(d,!0)}if(!this.setLookTargetFromConstraint()){const c=new sc;c.screenPoint=new ae(0,0),c.lineThreshold=.1;const u=this.context.physics.raycast(c);u.length>0&&this.setLookTargetPosition(u[0].point,!0),NA&&console.log("OrbitControls hits",...u)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new yy(this,"camera"));else{const l=ye.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,l)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new yy(this,"lookat"));else{const l=ye.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,l)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(l=>l.used),this._controls.keys=this.enableKeys?V_:i9,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,H_||(((o=(r=this._camera)==null?void 0:r.cam)==null?void 0:o.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof zA=="number"||zA===!0){this._controls.enableDamping=!0;const l=typeof zA=="number"?zA:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,l))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!H_&&((a=this.lookAtConstraint)!=null&&a.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),G_&&Pe.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(t){if(!t||!(t instanceof ne))return;const n=Ve(t),r=GM(t);this.setTargetFromRaycast(new gh(n,r)),this.setCameraTargetPosition(n)}setCameraTargetPosition(t,n=!1){var r,o;t&&(t instanceof ne&&(t=Ve(t)),this._cameraEndPosition||(this._cameraEndPosition=new x),this._cameraEndPosition.copy(t),n===!0?(this._cameraLerpActive=!1,(r=this.controllerObject)==null||r.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((o=this._cameraObject)==null?void 0:o.position),typeof n=="number"?this._cameraLerpDuration=n:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(t=null,n=!1){this._controls&&t&&(t instanceof ne&&(t=Ve(t)),this._lookTargetEndPosition.copy(t),this._didSetTarget++,G_&&(console.warn("OrbitControls: setLookTargetPosition",t,n),Pe.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),n===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof n=="number"?this._lookTargetLerpDuration=n:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(t=0,n=1){var o;if(!this._controls)return!1;const r=(o=this.lookAtConstraint)==null?void 0:o.sources;if(r&&r.length>0){const a=r[t];if(a)return a.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,n),!0}return!1}lerpTarget(t,n){return this.lerpLookTarget(t,n)}lerpLookTarget(t,n){this._controls&&(n>=1?this._controls.target.copy(t):this._controls.target.lerp(t,n))}setTargetFromRaycast(t){if(!this.controls)return;const n=t?this.context.physics.raycastFromRay(t):this.context.physics.raycast();for(const r of n)if(r.distance>0&&j.isActiveInHierarchy(r.object)){const o=$S(r.object);if(o){const a=o.canvas;if(a!=null&&a.screenspace)break}this.setLookTargetPosition(r.point);break}}fitCamera(t,n){if(this.context.isInXR)return;let r;if(Array.isArray(t)?r=t:t&&"type"in t?r=t.children:t&&"objects"in t&&(r=t==null?void 0:t.objects,n=t),r&&!Array.isArray(r)&&(r=r.children),(!Array.isArray(r)||r&&r.length<=0)&&(r=this.context.scene.children),!Array.isArray(r)||r.length<=0){console.warn("No objects to fit camera to...");return}n||(n={});const{immediate:o=!1,centerCamera:a="y",cameraNearFar:l="auto",fitOffset:c=1.1}=n,u=this._cameraObject,d=this._controls;if(!u||!d){console.warn("No camera or controls found to fit camera to objects...");return}const f=new x,p=new x,g=sl(r,void 0);u.updateMatrixWorld(),u.updateProjectionMatrix(),g.getCenter(p);const m=new x;if(g.getSize(m),g.applyMatrix4(u.matrixWorldInverse),g.getSize(f),g.setFromCenterAndSize(p,f),Number.isNaN(f.x)||Number.isNaN(f.y)||Number.isNaN(f.z)){console.warn("Camera fit size resultet in NaN",u,g,[...r]);return}if(f.length()<=1e-10){NA&&console.warn("Camera fit size is zero",g,[...r]);return}const A=u.fov,y=2*Math.atan(Math.tan(A*Math.PI/360/2)*u.aspect)/Math.PI*360,b=f.y/(2*Math.atan(Math.PI*A/360)),_=f.x/(2*Math.atan(Math.PI*y/360)),w=c*Math.max(b,_)+f.z/2;NA&&console.log("Fit camera to objects",b,_,"distance",w),d.maxDistance=w*10,d.minDistance=w*.01;const S=.05,E=p.clone();if(E.y-=f.y*S,this.setLookTargetPosition(E,o),this.autoTarget=!1,l==null||l=="auto"){const T=j.findObjectOfType(yh),P=T?T.radius:0,B=Math.max(m.x,m.y,m.z,P);u.near=w/100,u.far=B+w*10}u.updateMatrixWorld(),u.updateProjectionMatrix();const I=Ve(u),k=p.clone();if(k.sub(I),a==="y"&&(k.y=0),k.normalize(),k.multiplyScalar(w),a==="y"&&(k.y+=-S*4*f.y),u.parent){const T=u.parent.worldToLocal(p.clone().sub(k));this.setCameraTargetPosition(T,o)}else console.error(`Can not fit camera ${u.name} because it has no parent`);if(NA){const T=new AP(g);this.context.scene.add(T),WM(T,m0(u)),setTimeout(()=>{this.context.scene.remove(T)},1e4),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",P=>{P.code==="KeyF"&&this.fitCamera({objects:r,fitOffset:c,immediate:o})}))}d.update()}}yi([v()],Lt.prototype,"autoTarget",void 0);yi([v()],Lt.prototype,"autoFit",void 0);yi([v()],Lt.prototype,"enableRotate",void 0);yi([v()],Lt.prototype,"autoRotate",void 0);yi([v()],Lt.prototype,"autoRotateSpeed",void 0);yi([v()],Lt.prototype,"minAzimuthAngle",void 0);yi([v()],Lt.prototype,"maxAzimuthAngle",void 0);yi([v()],Lt.prototype,"minPolarAngle",void 0);yi([v()],Lt.prototype,"maxPolarAngle",void 0);yi([v()],Lt.prototype,"enableKeys",void 0);yi([v()],Lt.prototype,"enableDamping",void 0);yi([v()],Lt.prototype,"dampingFactor",void 0);yi([v()],Lt.prototype,"enableZoom",void 0);yi([v()],Lt.prototype,"minZoom",void 0);yi([v()],Lt.prototype,"maxZoom",void 0);yi([v()],Lt.prototype,"zoomSpeed",void 0);yi([v()],Lt.prototype,"enablePan",void 0);yi([v(jf)],Lt.prototype,"lookAtConstraint",void 0);yi([v()],Lt.prototype,"lookAtConstraint01",void 0);yi([v()],Lt.prototype,"allowInterrupt",void 0);yi([v()],Lt.prototype,"middleClickToFocus",void 0);yi([v()],Lt.prototype,"doubleClickToFocus",void 0);yi([v()],Lt.prototype,"clickBackgroundToFitScene",void 0);yi([v()],Lt.prototype,"targetLerpDuration",void 0);var Zs=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},hr;(function(s){s[s.None=0]="None",s[s.Skybox=1]="Skybox",s[s.SolidColor=2]="SolidColor",s[s.Uninitialized=4]="Uninitialized"})(hr||(hr={}));const Lc=Q("debugcam"),AR=Q("debugscreenpointtoray"),Yd=class extends oe{constructor(){super(...arguments);h(this,"_nearClipPlane",.1);h(this,"_farClipPlane",1e3);h(this,"orthographic",!1);h(this,"orthographicSize",5);h(this,"ARBackgroundAlpha",0);h(this,"_cullingMask",4294967295);h(this,"_backgroundBlurriness");h(this,"_backgroundIntensity");h(this,"_backgroundRotation");h(this,"_environmentIntensity");h(this,"_targetTexture",null);h(this,"_backgroundColor");h(this,"_fov");h(this,"_cam",null);h(this,"_clearFlags",hr.SolidColor);h(this,"_skybox");h(this,"_frustum");h(this,"_projScreenMatrix",new le)}get isCamera(){return!0}get aspect(){return this._cam instanceof bt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(t){this._cam instanceof bt&&this._cam.aspect!==t&&(this._cam.aspect=t,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof bt?this._cam.fov:this._fov}set fieldOfView(t){const n=this.fieldOfView!=t;if(this._fov=t,n&&this._cam&&this._cam instanceof bt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const n=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&(n||this._cam.near!=t)&&(this._cam.near=t,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const n=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&(n||this._cam.far!=t)&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(t){this._cullingMask=t,this._cam&&(this._cam.layers.mask=t)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(t){this.cullingMask=(1<<t|0)>>>0}set backgroundBlurriness(t){t!==this._backgroundBlurriness&&(t===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(t,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(t){t!==this._backgroundIntensity&&(t===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(t,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(t){t!==this._backgroundRotation&&(t===void 0?this._backgroundRotation=void 0:this._backgroundRotation=t,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(t){this._environmentIntensity=t}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(t){if(t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}t.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(t){this._targetTexture=t}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(t,n,r){const o=this.cam,a=Yd._origin;a.set(t,n,-1),this.context.input.convertScreenspaceToRaycastSpace(a),AR&&console.log("screenPointToRay",t.toFixed(2),n.toFixed(2),"now:",a.x.toFixed(2),a.y.toFixed(2),"isInXR:"+this.context.isInXR),a.z=-1,a.unproject(o);const l=Yd._direction.set(a.x,a.y,a.z),c=Ve(o);return l.sub(c),l.normalize(),r?(r.set(c,l),r):new gh(c.clone(),l.clone())}getFrustum(){return this._frustum||(this._frustum=new v1,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new v1),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(t,n){return n&&this._projScreenMatrix.multiplyMatrices(this.cam.projectionMatrix,this.cam.matrixWorldInverse),t===this._projScreenMatrix?t:t.copy(this._projScreenMatrix)}awake(){AR&&window.addEventListener("pointerdown",t=>{const n=t.clientX,r=t.clientY;console.log("touch",n.toFixed(2),r.toFixed(2));const o=this.screenPointToRay(n,r),a="#"+Math.floor(Math.random()*16777215).toString(16);Pe.DrawRay(o.origin,o.direction,a,10)})}onEnable(){Lc&&console.log(`Camera enabled: "${this.name}". ClearFlags=${hr[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),s9(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===hr.SolidColor&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const t=this.context.renderer;if(t){const n=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,t),n==null||n.applyClearFlags()}}}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let n=null;if(t?(n=this.gameObject,n==null||n.layers.enableAll(),n instanceof bt&&(this._fov=n.fov)):n=this.gameObject.children[0],n&&n.isCamera)n instanceof bt&&(this._fov&&(n.fov=this._fov),n.near=this._nearClipPlane,n.far=this._farClipPlane,n.updateProjectionMatrix());else if(!this.orthographic)n=new bt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(n.fov=this.fieldOfView),this.gameObject.add(n);else{const r=this.orthographicSize*100;n=new ku(window.innerWidth/-r,window.innerWidth/r,window.innerHeight/r,window.innerHeight/-r,this._nearClipPlane,this._farClipPlane),this.gameObject.add(n)}this._cam=n,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(t){this.context.mainCameraComponent===this&&this.applyClearFlags(t)}applyClearFlags(t){var n;if(!this._cam){Lc&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Lc){const r=`Camera "${this.name}" clear flags: ${hr[this._clearFlags]}`;console.debug(r)}switch(this._clearFlags){case hr.None:return;case hr.Skybox:if(Yd.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(t==null?void 0:t.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Lc&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Lc&&console.warn(`Camera "${this.name}" has no background intensity`);break;case hr.SolidColor:if(this._backgroundColor){let r=this._backgroundColor.alpha;Yd.backgroundShouldBeTransparent(this.context)&&(r=this.ARBackgroundAlpha??0),this.context.scene.background=null,(n=this.context.xr)!=null&&n.isVR?this.context.renderer.setClearColor(az(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,r)}else Lc&&console.warn(`Camera "${this.name}" has no background color`,this);break;case hr.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new n9(this)),this._skybox.apply()}static backgroundShouldBeTransparent(t){var a,l,c,u;const n=(a=t.renderer.xr)==null?void 0:a.getSession();if(!n)return!1;if(typeof n._transparent=="boolean")return n._transparent;const r=n.environmentBlendMode;Lc&&bi("Environment blend mode: "+r+" on "+navigator.userAgent);let o=r==="additive"||r==="alpha-blend";return t.isInAR&&r==="opaque"&&((l=navigator.userAgent)!=null&&l.includes("OculusBrowser")||(c=navigator.userAgent)!=null&&c.includes("Mozilla")&&((u=navigator.userAgent)!=null&&u.includes("Mobile WebXRViewer/v2")))&&(o=!0),n._transparent=o,o}};let Bt=Yd;h(Bt,"_origin",new x),h(Bt,"_direction",new x);Zs([v()],Bt.prototype,"aspect",null);Zs([v()],Bt.prototype,"fieldOfView",null);Zs([v()],Bt.prototype,"nearClipPlane",null);Zs([v()],Bt.prototype,"farClipPlane",null);Zs([v()],Bt.prototype,"clearFlags",null);Zs([v()],Bt.prototype,"orthographic",void 0);Zs([v()],Bt.prototype,"orthographicSize",void 0);Zs([v()],Bt.prototype,"ARBackgroundAlpha",void 0);Zs([v()],Bt.prototype,"cullingMask",null);Zs([v()],Bt.prototype,"backgroundBlurriness",null);Zs([v()],Bt.prototype,"backgroundIntensity",null);Zs([v(Gt)],Bt.prototype,"backgroundRotation",null);Zs([v()],Bt.prototype,"environmentIntensity",null);Zs([v(Ut)],Bt.prototype,"backgroundColor",null);Zs([v(gu)],Bt.prototype,"targetTexture",null);class n9{constructor(i){h(this,"_camera");h(this,"_skybox");this._camera=i}get context(){var i;return(i=this._camera)==null?void 0:i.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Lc&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=Ya,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function s9(s){Q("freecam")&&s.context.mainCameraComponent===s&&j.getOrAddComponent(s.gameObject,Lt)}class vu extends oe{constructor(){super(...arguments);h(this,"_listener",null);h(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new EF),this._listener}onEnable(){Ja.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Ja.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const t=this._listener;if(!t||t!=null&&t.parent)return;const n=this.context.mainCameraComponent||j.getComponentInParent(this.gameObject,Bt);n!=null&&n.cam?n.cam.add(t):this.gameObject.add(t),t.filter?(t.gain.connect(t.filter),t.filter.connect(t.context.destination)):t.gain.connect(t.context.destination)}removeListenerIfItExists(){const t=this._listener;t&&(t.removeFromParent(),t.filter&&t.filter.disconnect(),t.gain&&t.gain.disconnect())}}class r9 extends ms{constructor(i,t=1,n=16,r=2){const o=new Vt,a=n+r*2,l=new Float32Array((a*3+3)*3);o.setAttribute("position",new Je(l,3));const c=new Zo({color:65280}),u=new Zo({color:16776960});super(o,[u,c]),this.audio=i,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=r,this.type="PositionalAudioHelper",this.update()}update(){const i=this.audio,t=this.range,n=this.divisionsInnerAngle,r=this.divisionsOuterAngle,o=ct.degToRad(i.panner.coneInnerAngle),a=ct.degToRad(i.panner.coneOuterAngle),l=o/2,c=a/2;let u=0,d=0,f,p;const g=this.geometry,m=g.attributes.position;g.clearGroups();function A(y,b,_,w){const S=(b-y)/_;for(m.setXYZ(u,0,0,0),d++,f=y;f<b;f+=S)p=u+d,m.setXYZ(p,Math.sin(f)*t,0,Math.cos(f)*t),m.setXYZ(p+1,Math.sin(Math.min(f+S,b))*t,0,Math.cos(Math.min(f+S,b))*t),m.setXYZ(p+2,0,0,0),d+=3;g.addGroup(u,d,w),u+=d,d=0}A(-c,-l,r,0),A(-l,l,n,1),A(l,c,r,0),m.needsUpdate=!0,o===a&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var ra=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const hs=Q("debugaudio");var gg;(function(s){s[s.Logarithmic=0]="Logarithmic",s[s.Linear=1]="Linear",s[s.Custom=2]="Custom"})(gg||(gg={}));class kt extends oe{constructor(){super(...arguments);h(this,"clip","");h(this,"playOnAwake",!1);h(this,"preload",!1);h(this,"playInBackground",!0);h(this,"_spatialBlend",0);h(this,"_minDistance",1);h(this,"_maxDistance",100);h(this,"_volume",1);h(this,"rollOffMode",0);h(this,"_loop",!1);h(this,"sound",null);h(this,"helper",null);h(this,"wasPlaying",!1);h(this,"audioLoader",null);h(this,"shouldPlay",!1);h(this,"_lastClipStartedLoading",null);h(this,"_audioElement",null);h(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||uc())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":hs&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,kt.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&kt.userInteractionRegistered&&this.wasPlaying&&this.play();break}});h(this,"onApplicationMuteChanged",()=>{var t,n;this.context.application.muted?(t=this.sound)==null||t.setVolume(0):(n=this.sound)==null||n.setVolume(this.volume)});h(this,"createAudio",t=>{hs&&console.log("AudioBuffer finished loading",t);const n=this.Sound;if(!n){hs&&console.warn("Failed getting sound?",this.name);return}n.isPlaying&&n.stop(),t&&n.setBuffer(t),n.loop=this._loop,this.context.application.muted?n.setVolume(0):n.setVolume(this.volume),n.autoplay=this.shouldPlay&&kt.userInteractionRegistered,this.applySpatialDistanceSettings(),n.isPlaying&&n.stop(),kt.registerWaitForAllowAudio(this.__onAllowAudioCallback)});h(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});h(this,"_lastContextTime",0);h(this,"_hasEnded",!0);h(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Ja.userInteractionRegistered}static registerWaitForAllowAudio(t){Ja.registerWaitForInteraction(t)}get isPlaying(){var t;return((t=this.sound)==null?void 0:t.isPlaying)??!1}get duration(){var t,n;return(n=(t=this.sound)==null?void 0:t.buffer)==null?void 0:n.duration}get time01(){var n;const t=this.duration;return t&&this.sound?((n=this.sound)==null?void 0:n.context.currentTime)/t:0}set time01(t){const n=this.duration;n&&this.sound&&(this.time=t*n)}get time(){var t,n;return(t=this.sound)!=null&&t.source?((n=this.sound.source)==null?void 0:n.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(t){if(this.sound){if(t===this.sound.offset)return;const n=this.isPlaying;this.stop(),this.sound.offset=t,n&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(t){this._loop=t,this.sound&&this.sound.setLoop(t)}get spatialBlend(){return this._spatialBlend}set spatialBlend(t){t!==this._spatialBlend&&(this._spatialBlend=t,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance!==t&&(this._minDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance!==t&&(this._maxDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.sound&&!this.context.application.muted&&(hs&&console.log(this.name,"audio set volume",t),this.sound.setVolume(t))}set pitch(t){this.sound&&this.sound.setPlaybackRate(t)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var t;if(!this.sound&&kt.userInteractionRegistered){let n=j.getComponent(this.context.mainCamera,vu)??j.findObjectOfType(vu,this.context);!n&&this.context.mainCamera&&(n=j.addNewComponent(this.context.mainCamera,vu)),n!=null&&n.listener?(this.sound=new IF(n.listener),(t=this.gameObject)==null||t.add(this.sound)):hs&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var t;return(t=this.sound)==null?void 0:t.context}awake(){hs&&console.log(this),this.audioLoader=new Uw,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),kt.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():kt.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(du.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(du.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const t=this.sound;if(!t)return;this._needUpdateSpatialDistanceSettings=!1;const n=ye.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(hs&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+n),t.setRefDistance(n),t.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case gg.Logarithmic:t.setDistanceModel("exponential");break;case gg.Linear:t.setDistanceModel("linear");break;case gg.Custom:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?hs&&!this.helper&&(this.helper=new r9(t,t.getRefDistance()),t.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(t){if(t&&(this.clip=t),typeof t=="string")if(hs&&console.log(t),t.endsWith(".mp3")||t.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new Uw),this.shouldPlay=!0,this._lastClipStartedLoading===t){hs&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=t,hs&&console.log("load audio",t);const n=await this.audioLoader.loadAsync(t).catch(console.error);this._lastClipStartedLoading=null,n&&this.createAudio(n)}else console.warn("Unsupported audio clip type",t);else this.shouldPlay=!0,this.createAudio()}play(t=void 0){var r,o,a;!t&&this.clip&&(t=this.clip),t!==void 0&&typeof t!="string"&&!(t instanceof MediaStream)&&(be()&&console.warn("Called play on AudioSource with unknown argument type:",t+`
Using the assigned clip instead:`,this.clip),t=this.clip);let n=!this.sound||t&&t!==this.clip;if(typeof t=="string"&&!this.audioLoader&&(n=!0),(t instanceof MediaStream||typeof t=="string")&&(this.clip=t),n){this.shouldPlay=!0,this.onNewClip(t);return}if(this.shouldPlay=!0,this._hasEnded=!1,hs&&console.log("play",(r=this.sound)==null?void 0:r.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const l=this.context.application.muted;l&&this.sound.setVolume(0),(o=this.gameObject)==null||o.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(a=this.context.domElement.shadowRoot)==null||a.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(l?.1:0))}}pause(){var t,n;hs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,this.sound.pause()),(n=this._audioElement)==null||n.remove()}stop(){var t,n;hs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,hs&&console.log(this._lastContextTime),this.sound.stop()),(n=this._audioElement)==null||n.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,hs&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}}ra([v(URL)],kt.prototype,"clip",void 0);ra([v()],kt.prototype,"playOnAwake",void 0);ra([v()],kt.prototype,"preload",void 0);ra([v()],kt.prototype,"playInBackground",void 0);ra([v()],kt.prototype,"loop",null);ra([v()],kt.prototype,"spatialBlend",null);ra([v()],kt.prototype,"minDistance",null);ra([v()],kt.prototype,"maxDistance",null);ra([v()],kt.prototype,"volume",null);ra([v()],kt.prototype,"pitch",null);ra([v()],kt.prototype,"rollOffMode",void 0);var L0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const o9=Q("debugsignals");class F0{constructor(){h(this,"guid")}}L0([v()],F0.prototype,"guid",void 0);class Om{constructor(){h(this,"signal");h(this,"reaction")}}L0([v(F0)],Om.prototype,"signal",void 0);L0([v(ti)],Om.prototype,"reaction",void 0);const Ca=class extends oe{constructor(){super(...arguments);h(this,"events")}static invoke(t){if(Ca.receivers[t]){const n=Ca.receivers[t];if(!n)return;for(const r of n)r.invoke(t)}}awake(){o9&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const t of this.events)Ca.receivers[t.signal.guid]||(Ca.receivers[t.signal.guid]=[]),Ca.receivers[t.signal.guid].push(this)}onDisable(){if(this.events){for(const t of this.events)if(Ca.receivers[t.signal.guid]){const n=Ca.receivers[t.signal.guid].indexOf(this);n>=0&&Ca.receivers[t.signal.guid].splice(n,1)}}}invoke(t){if(!this.events||!Array.isArray(this.events))return;const n=typeof t=="object"?t.guid:t;for(const r of this.events)if(r.signal.guid===n)try{if(r.reaction){if(!r.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",r,this);continue}}else{console.warn("Missing reaction for signal",r,this);continue}r.reaction.invoke()}catch(o){console.error(o)}}};let nh=Ca;h(nh,"receivers",{});L0([v(Om)],nh.prototype,"events",void 0);var xr;(function(s){s.Activation="ActivationTrack",s.Animation="AnimationTrack",s.Audio="AudioTrack",s.Control="ControlTrack",s.Marker="MarkerTrack",s.Signal="SignalTrack"})(xr||(xr={}));var ya;(function(s){s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue"})(ya||(ya={}));var Vx;(function(s){s.Signal="SignalEmitter"})(Vx||(Vx={}));const Va=Q("debugtimeline");class U0{constructor(){h(this,"director");h(this,"track")}get muted(){return this.track.muted}set muted(i){var t;i!==this.track.muted&&(this.track.muted=i,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(i=!1){var t;if((t=this.track)!=null&&t.clips)if(i)for(let n=this.track.clips.length-1;n>=0;n--)yield this.track.clips[n];else for(const n of this.track.clips)yield n}getClipTime(i,t){return t.clipIn+(i-t.start)*t.timeScale}getClipTimeNormalized(i,t){return(i-t.start)/t.duration}evaluateWeight(i,t,n,r=!0){if(t<0||t>=n.length)return 0;const o=n[t];if(r||i>=o.start&&i<=o.end){let a=1;const l=!1;if(o.easeInDuration>0){const c=Math.min((i-o.start)/o.easeInDuration,1);a*=c}if(o.easeOutDuration>0&&!l){const c=Math.min((o.end-i)/o.easeOutDuration,1);a*=c}return a}return 0}}class a9{constructor(i){h(this,"clip");h(this,"rootPositionOffset");h(this,"rootQuaternionOffset");h(this,"rootStartPosition");h(this,"rootEndPosition");h(this,"rootStartQuaternion");h(this,"rootEndQuaternion");const t=i.getClip();this.clip=t;const n=i.getRoot(),r=n.name+".position",o=n.name+".quaternion";Va&&console.log(t.name,t.tracks,r);for(const a of t.tracks)if(!(a.times.length<=0)){if(a.name.endsWith(r))this.rootStartPosition=new x().fromArray(a.values,0),this.rootEndPosition=new x().fromArray(a.values,a.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Va&&console.log(this.rootPositionOffset);else if(a.name.endsWith(o)&&(this.rootStartQuaternion=new se().fromArray(a.values,0),this.rootEndQuaternion=new se().fromArray(a.values,a.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Va)){const l=new Gt().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class eE extends U0{constructor(){super(...arguments);h(this,"models",[]);h(this,"trackOffset");h(this,"target");h(this,"mixer");h(this,"clips",[]);h(this,"actions",[]);h(this,"_actionOffsets",[]);h(this,"_didBind",!1);h(this,"_animator",null);h(this,"_useclipOffsets",!0);h(this,"_totalOffsetPosition",new x);h(this,"_totalOffsetRotation",new se);h(this,"_totalOffsetPosition2",new x);h(this,"_totalOffsetRotation2",new se);h(this,"_summedPos",new x);h(this,"_tempPos",new x);h(this,"_summedRot",new se);h(this,"_tempRot",new se);h(this,"_clipRotQuat",new se)}onDisable(){var t;(t=this.mixer)==null||t.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&yR(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,n){var d,f;if(((d=n.tracks)==null?void 0:d.length)<=0){console.warn("No tracks in AnimationClip",n);return}const r=n.tracks[0].name.split("."),o=r[r.length-2],a=o+".position",l=o+".quaternion";let c=!1,u=!1;for(const p of n.tracks)p.name.endsWith(a)?(c=!0,this.createPositionInterpolant(n,t,p)):p.name.endsWith(l)&&(u=!0,this.createRotationInterpolant(n,t,p));if(!c||!u){const p=(f=this.mixer)==null?void 0:f.getRoot(),g=n.tracks[0],m=g.name.lastIndexOf("."),A=g.name.substring(0,m),y=A.substring(A.lastIndexOf(".")+1),b=p.getObjectByName(y);if(b)if(c){if(!u){const _=n.tracks[0].name.substring(0,m)+".quaternion";Va&&console.warn("Create quaternion track",y,b);const w=b.quaternion,S=new Wv(_,[0,n.duration],[w.x,w.y,w.z,w.w,w.x,w.y,w.z,w.w]);n.tracks.push(S),this.createRotationInterpolant(n,t,S)}}else{const _=A+".position";Va&&console.warn("Create position track",y,b);const w=b.position,S=new Vv(_,[0,n.duration],[w.x,w.y,w.z,w.x,w.y,w.z]);n.tracks.push(S),this.createPositionInterpolant(n,t,S)}}}bind(){if(!this._didBind){this._didBind=!0,Va&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const n=new a9(t);this._actionOffsets.push(n)}this.target&&(this._animator=j.getComponent(this.target,Cs)??null,this._animator&&yR(this._animator.gameObject,this,!0));for(const t of this.models){const n=t.asset,r=n.position,o=n.rotation;r&&r.x!==void 0&&(r.isVector3||(n.position=new x(r.x,r.y,r.z)),o.isQuaternion||(n.rotation=new se(o.x,o.y,o.z,o.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new x(t.x,t.y,t.z)));const n=this.trackOffset.rotation;n&&(n.isQuaternion||(this.trackOffset.rotation=new se(n.x,n.y,n.z,n.w)))}}evaluate(t){var c,u,d,f,p,g,m;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let n=0,r=0,o=!1,a=!1,l=0;for(let A=0;A<this.clips.length;A++){const y=this.models[A],b=this.actions[A],_=y.asset;b.weight=0;const w=t>=y.start&&t<=y.end,S=y.preExtrapolationMode,E=y.postExtrapolationMode,I=A<this.clips.length-1?this.models[A+1]:null;let k=w,T=!1;if(!k&&!o&&y.end<t&&E!==ya.None?(!I||I.start>t)&&(k=!0,o=!0):A==0&&!k&&!a&&y.start>t&&S!==ya.None&&(!I||I.start<t)&&(k=!0,T=!0,a=!0),k){let P=1;P*=this.evaluateWeight(t,A,this.models,k),P*=this.director.weight;let B=w;if(T)switch(S){case ya.Hold:break;case ya.Loop:t+=y.start,B=!0;break;default:t+=y.start,B=!0;break}let M=this.getClipTime(t,y),U=0;const G=_.duration;if(T&&S===ya.Hold&&(M=0),B){if(_.loop)for(U+=Math.floor(M/(G+1e-6));M>G;)M-=G}else if(!w&&o)switch(E){case ya.Hold:M=this.getClipTime(y.end,y);break;case ya.Loop:M%=G;break;case ya.PingPong:const D=Math.floor(M/G)%2!==0;M%=G,D&&(M=G-M);break}y.reversed===!0?b.time=b.getClip().duration-M:b.time=M,b.timeScale=0;const W=Math.max(0,P);if(b.weight=W,l+=W,b.clampWhenFinished=!1,b.isRunning()||b.play(),this._useclipOffsets){const Y=n==0?this._totalOffsetPosition:this._totalOffsetPosition2,D=n==0?this._totalOffsetRotation:this._totalOffsetRotation2;n<1&&(r=1-P),n+=1;const L=this._summedPos.set(0,0,0),V=this._tempPos.set(0,0,0),te=this._summedRot.identity(),K=this._tempRot.identity(),ue=_.rotation;ue&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(ue,P));const de=this._actionOffsets[A];if(de.hasOffsets)for(let _e=0;_e<U;_e++)de.rootPositionOffset?V.copy(de.rootPositionOffset):V.set(0,0,0),V.applyQuaternion(te),this._clipRotQuat&&V.applyQuaternion(this._clipRotQuat),de.rootQuaternionOffset&&(K.copy(de.rootQuaternionOffset),te.multiply(K)),L.add(V);this._clipRotQuat&&D.multiply(this._clipRotQuat),D.multiply(te),_.position&&L.add(_.position),Y.add(L)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,r),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,r)),this.__mixerError===void 0&&(Va||be())&&((u=(c=this._animator)==null?void 0:c.runtimeAnimatorController)!=null&&u.mixer)&&this.mixer!==((f=(d=this._animator)==null?void 0:d.runtimeAnimatorController)==null?void 0:f.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(p=this._animator)!=null&&p.runtimeAnimatorController){const A=Math.max(0,1-l);(m=(g=this._animator)==null?void 0:g.runtimeAnimatorController)==null||m.update(A)}else this.mixer.update(t)}createRotationInterpolant(t,n,r){var c;const o=r.createInterpolant.bind(r),a=new se;this.ensureTrackOffsets();const l=(c=this.trackOffset)==null?void 0:c.rotation;r.createInterpolant=()=>{const u=o(),d=u.evaluate.bind(u);return u.evaluate=f=>{var g;const p=d(f);if(a.set(p[0],p[1],p[2],p[3]),a.premultiply(this._totalOffsetRotation),l&&a.premultiply(l),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(g=m==null?void 0:m.onTimelineRotation)==null||g.call(m,this.director,this.target,f,a);return p[0]=a.x,p[1]=a.y,p[2]=a.z,p[3]=a.w,p},u}}createPositionInterpolant(t,n,r){var d,f;const o=r.createInterpolant.bind(r),a=new x;this.ensureTrackOffsets();const l=(d=this.trackOffset)==null?void 0:d.rotation,c=(f=this.trackOffset)==null?void 0:f.position;let u;r.createInterpolant=()=>{const p=o(),g=p.evaluate.bind(p);return p.evaluate=m=>{var y,b,_;const A=g(m);if(a.set(A[0],A[1],A[2]),n.removeStartOffset&&(u===void 0?(u=null,u=(b=(y=this._actionOffsets.find(w=>w.clip===t))==null?void 0:y.rootStartPosition)==null?void 0:b.clone()):u!=null&&u.isVector3&&a.sub(u)),a.applyQuaternion(this._totalOffsetRotation),a.add(this._totalOffsetPosition),l&&a.applyQuaternion(l),c&&(a.x-=c.x,a.y+=c.y,a.z+=c.z),this.director.animationCallbackReceivers)for(const w of this.director.animationCallbackReceivers)(_=w==null?void 0:w.onTimelinePosition)==null||_.call(w,this.director,this.target,m,a);return A[0]=a.x,A[1]=a.y,A[2]=a.z,A},p}}}const l9=Q("mutetimeline"),Kd=class extends U0{constructor(){super(...arguments);h(this,"models",[]);h(this,"listener");h(this,"audio",[]);h(this,"audioContextTimeOffset",[]);h(this,"lastTime",0);h(this,"audioSource");h(this,"_audioLoader",null);h(this,"_playableDirectorResumed",!1)}getAudioFilePath(t){const n=this.director.sourceId;return Ou(n,t)}onAllowAudioChanged(t){for(let n=0;n<this.models.length;n++){const r=this.models[n];this.audio[n].setVolume(t?r.asset.volume:0)}}addModel(t){const n=new TF(this.listener);this.audio.push(n);const r=t;r._didTriggerPlay=!1,this.models.push(r)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop();for(const t of this.models)t._didTriggerPlay=!1}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const n=this.audio[t];n!=null&&n.isPlaying&&n.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const n=this.audio[t];n!=null&&n.isPlaying&&n.stop()}for(const t of this.models)t._didTriggerPlay=!1}onPauseChanged(){for(let t=0;t<this.audio.length;t++){const n=this.audio[t];n!=null&&n.isPlaying&&n.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(t){if(l9||this.track.muted||this.director.speed<0)return;const n=this.director.context.application.muted,r=this._playableDirectorResumed;this._playableDirectorResumed=!1;const o=n?.1:0;for(let a=0;a<this.models.length;a++){const l=this.models[a],c=this.audio[a],u=l.asset;if((!c||!c.buffer)&&this.isInTimeRange(l,t-1,t+1)&&this.handleAudioLoading(l,c),kt.userInteractionRegistered!==!1&&!(c===null||!c.buffer))if(c.playbackRate=this.director.context.time.timeScale*this.director.speed,c.loop=u.loop,t>=l.start&&t<=l.end&&t<this.director.duration){if(!c.isPlaying||!this.director.isPlaying)(r||!l._didTriggerPlay&&this.lastTime<t)&&(l.duration*l.timeScale>.3?c.offset=l.clipIn+(t-l.start)*l.timeScale:c.offset=0,Va&&console.log("Timeline Audio ("+this.track.name+") play with offset "+c.offset+" - "+l.asset.clip),c.play(o),l._didTriggerPlay=!0);else{const f=l.clipIn+(t-l.start)*l.timeScale,p=c.context.currentTime-c._startedAt+c.offset;Math.abs(f-p)>.3&&(c.offset=f,c.stop(),c.play(o))}let d=u.volume;if(this.track.volume!==void 0&&(d*=this.track.volume),n&&(d=0),l.easeInDuration>0){const f=Math.min((t-l.start)/l.easeInDuration,1);d*=f}if(l.easeOutDuration>0){const f=Math.min((l.end-t)/l.easeOutDuration,1);d*=f}c.setVolume(d*this.director.weight)}else l._didTriggerPlay=!1,this.director.isPlaying&&c.isPlaying&&c.stop()}this.lastTime=t}loadAudio(t,n=0,r=0){let o=null;const a=t-r,l=t+n;for(const c of this.models)if(this.isInTimeRange(c,a,l)){const u=this.audio[this.models.indexOf(c)],d=this.handleAudioLoading(c,u);d!==null&&(o===null&&(o=[]),o.push(d))}return o!==null?Promise.all(o):null}isInTimeRange(t,n,r){return n<=t.start&&r>=t.end||n>=t.start&&n<=t.end||r>=t.start&&r<=t.end}static dispose(){Kd._audioBuffers.clear()}handleAudioLoading(t,n){this._audioLoader||(this._audioLoader=new Uw);const r=this.getAudioFilePath(t.asset.clip);if(Kd._audioBuffers.get(r)){const a=Kd._audioBuffers.get(r);return a.then(l=>{l&&n.setBuffer(l)}),a}Va&&console.warn("LOAD audio track",r,this.director.sourceId);const o=new Promise((a,l)=>{this._audioLoader.load(r,c=>{n.setBuffer(c),a(c)},void 0,c=>{console.error("Error loading audio",c),a(null)})});return Kd._audioBuffers.set(r,o),o}};let ff=Kd;h(ff,"_audioBuffers",new Map);class by extends U0{constructor(){super(...arguments);h(this,"models",[]);h(this,"didTrigger",[]);h(this,"receivers",[])}evaluate(t){var r;if(this.track.muted)return;const n=this.director.context.time.deltaTime*1.5;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.didTrigger[o],c=a.time-t;let u=!1;if(a.retroActive)u=c<=1e-6;else{const d=Math.abs(c);(d===0||d>=1e-5&&d<n)&&(u=!0)}if(u){if(!l)if(Va&&console.log("Trigger signal",t,a.time,a),this.didTrigger[o]=!0,((r=this.receivers)==null?void 0:r.length)<=0)nh.invoke(a.asset);else for(const d of this.receivers)d&&d.invoke(a.asset)}else a.emitOnce||(this.didTrigger[o]=!1)}}}class tE extends U0{constructor(){super(...arguments);h(this,"models",[]);h(this,"timelines",[]);h(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let n=this.models.length-1;n>=0;n--){const o=this.models[n].asset;if(!o.sourceObject||typeof o.sourceObject!="object"){console.log("no source object, removing model",n,o),this.models.splice(n,1);continue}else{const a=j.getComponent(o.sourceObject,$a);this.timelines.push(a),a&&o.updateDirector&&(a.playOnAwake=!1)}}}evaluate(t){var n;this._previousActiveModel=null;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=o.asset;if(t>=o.start&&t<=o.end){this._previousActiveModel=o;const l=this.getClipTime(t,o);if(a.controlActivation){const c=a.sourceObject;c.visible=!0}if(a.updateDirector){const c=this.timelines[r];c&&(c.isPlaying&&c.pause(),c.time=l,c.evaluate())}}else{const l=(n=this._previousActiveModel)==null?void 0:n.asset;if(a.controlActivation){const c=a.sourceObject;(l==null?void 0:l.sourceObject)!==c&&(c.visible=!1)}}}}}var JO=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const _l=Q("debugtimeline");var zd;(function(s){s[s.Hold=0]="Hold",s[s.Loop=1]="Loop",s[s.None=2]="None"})(zd||(zd={}));var vR;(function(s){s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue"})(vR||(vR={}));const Jy=class extends oe{constructor(){super(...arguments);h(this,"playableAsset");h(this,"playOnAwake");h(this,"extrapolationMode",zd.Loop);h(this,"waitForAudio",!0);h(this,"_visibilityChangeEvt");h(this,"_clonedPlayableAsset",!1);h(this,"_speed",1);h(this,"_guidsMap");h(this,"_isPlaying",!1);h(this,"_internalUpdateRoutine");h(this,"_isPaused",!1);h(this,"_isStopping",!1);h(this,"_time",0);h(this,"_duration",0);h(this,"_weight",1);h(this,"_animationTracks",[]);h(this,"_audioTracks",[]);h(this,"_signalTracks",[]);h(this,"_controlTracks",[]);h(this,"_customTracks",[]);h(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);h(this,"animationCallbackReceivers",[])}static registerCreateTrack(t,n){this.createTrackFunctions[t]=n}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){typeof t=="number"&&!Number.isNaN(t)?this._time=t:(_l||fr())&&console.error("INVALID TIMELINE.TIME VALUE",t,this.name)}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}get speed(){return this._speed}set speed(t){this._speed=t}awake(){var t,n,r,o,a;_l&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),!this.isValid()&&(_l||be())&&(_l?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(n=this.playableAsset)==null?void 0:n.tracks,"IsArray?",Array.isArray((r=this.playableAsset)==null?void 0:r.tracks),this):(a=(o=this.playableAsset)==null?void 0:o.tracks)!=null&&a.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var t,n,r;for(const o of this._audioTracks)(t=o.onEnable)==null||t.call(o);for(const o of this._customTracks)(n=o.onEnable)==null||n.call(o);for(const o of this._animationTracks)(r=o.onEnable)==null||r.call(o);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,n,r;this.stop();for(const o of this._audioTracks)(t=o.onDisable)==null||t.call(o);for(const o of this._customTracks)(n=o.onDisable)==null||n.call(o);for(const o of this._animationTracks)(r=o.onDisable)==null||r.call(o);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const n of this._allTracks)for(const r of n)(t=r.onDestroy)==null||t.call(r)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const t=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,t&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const n=[];for(const r of this._audioTracks){const o=r.loadAudio(this._time,1,0);o&&n.push(o)}if(n.length>0&&(await Promise.all(n),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!kt.userInteractionRegistered&&this.waitForAudio;)await nc(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),qe.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const r of this._audioTracks)r.stop();const t=this._isPaused==!0,n=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),t&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,t&&!n&&this.invokePauseChangedMethodsOnTracks(),n&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const n of t)yield n}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}invokePauseChangedMethodsOnTracks(){var t;for(const n of this.forEachTrack())(t=n.onPauseChanged)==null||t.call(n)}invokeStateChangedMethodsOnTracks(){var t;for(const n of this.forEachTrack())(t=n.onStateChanged)==null||t.call(n,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(t=!1){if(!this.isValid())return;let n=this._time;switch(this.extrapolationMode){case zd.Hold:this._speed>0?n=Math.min(n,this._duration):this._speed<0&&(n=Math.max(n,0)),this._time=n;break;case zd.Loop:n%=this._duration,this._time=n;break;case zd.None:if(n>this._duration){this.stop();return}break}const r=this._time;for(const o of this.playableAsset.tracks)if(!o.muted)switch(o.type){case xr.Activation:if(!t&&!this._isPlaying)continue;for(let a=0;a<o.outputs.length;a++){const l=o.outputs[a];if(typeof l=="object"){let c=!1;if(o.clips)for(const d of o.clips)d.start<=r&&r<=d.end&&(c=!0);const u=l;u.visible!==void 0&&u.visible!==c&&(u.visible=c,_l&&console.warn(this.name,"set ActivationTrack-"+a,u.name,c,r))}}break}if(!this._isStopping)for(const o of this._animationTracks)o.evaluate(r);for(const o of this._audioTracks)o.evaluate(r);for(const o of this._signalTracks)o.evaluate(r);for(const o of this._controlTracks)o.evaluate(r);for(const o of this._customTracks)o.evaluate(r)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=h0(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const n of this.playableAsset.tracks){for(let r=n.outputs.length-1;r>=0;r--){let o=n.outputs[r];if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=j.findByGuid(o,t);a===null||typeof a!="object"?(n.outputs.splice(r,1),console.warn("Failed to resolve binding",o,n.name,n.type)):(_l&&console.log("Resolved binding",o,"to",a),n.outputs[r]=a)}else if(o===null){if(n.outputs.splice(r,1),Jy.createTrackFunctions[n.type])continue;n.type!==xr.Audio&&n.type!==xr.Control&&n.type!==xr.Marker&&n.type!==xr.Signal&&console.warn("Missing binding",o,n.name,n.type,this.name,this.playableAsset.name)}}if(n.type===xr.Control&&n.clips)for(let r=0;r<n.clips.length;r++){const o=n.clips[r];let a=o.asset.sourceObject;if(typeof a=="string"){this._guidsMap&&this._guidsMap[a]&&(a=this._guidsMap[a]);const l=j.findByGuid(a,t);l===null||typeof l!="object"?console.warn("Failed to resolve sourceObject binding",a,n.name,o):(_l&&console.log("Resolved binding",a,"to",l),o.asset.sourceObject=l)}}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0){if(t.clips)for(const n of t.clips)n.end>this._duration&&(this._duration=n.end);if(t.markers)for(const n of t.markers)n.time>this._duration&&(this._duration=n.time+.001)}}}setupAndCreateTrackHandlers(){var n,r,o;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let t=j.findObjectOfType(vu,this.context);for(const a of this.playableAsset.tracks){const l=a.type,c=Jy.createTrackFunctions[l];if(c!=null){const u=c(this,a);if(typeof u.evaluate=="function"){u.director=this,u.track=a,this._customTracks.push(u);continue}}if(a.type===xr.Animation){if(!a.clips||a.clips.length<=0){_l&&console.warn("Animation track has no clips",a);continue}for(let u=a.outputs.length-1;u>=0;u--){let d=a.outputs[u];if(d instanceof ne){const p=j.getOrAddComponent(d,Cs);p&&(d=p)}const f=(n=d==null?void 0:d.gameObject)==null?void 0:n.animations;if(f){const p=new eE;p.trackOffset=a.trackOffset,p.director=this,p.track=a;for(let g=0;g<a.clips.length;g++){const m=a.clips[g],A=m.asset;if(!A){console.error(`Timeline ${this.name}: clip #${g} on track "${a.name}" has no animation data`);continue}const y=A.clip;let b=y;if((typeof b=="string"||typeof b=="number")&&(b=f.find(w=>w.name===y)),_l&&console.log(A,y,"â†’",b),!b){console.warn("Could not find animationClip for model",m,a.name,this.name,(r=this.playableAsset)==null?void 0:r.name,f,d);continue}d instanceof Cs&&d.runtimeAnimatorController&&(d.__internalDidAwakeAndStart||d.initializeRuntimeAnimatorController(),d.runtimeAnimatorController.mixer||d.runtimeAnimatorController.bind(d),p.mixer=d.runtimeAnimatorController.mixer),p.mixer||(p.mixer=new MC(d.gameObject),this.context.animations.registerAnimationMixer(p.mixer)),p.clips.push(b),p.mixer.uncacheAction(b),p.createHooks(m.asset,b);const _=p.mixer.clipAction(b);p.actions.push(_),p.models.push(m)}this._animationTracks.push(p)}}}else if(a.type===xr.Audio){if(!a.clips||a.clips.length<=0)continue;const u=new ff;u.director=this,u.track=a,u.audioSource=a.outputs.find(d=>d instanceof kt),this._audioTracks.push(u),t||(t=(o=this.context.mainCameraComponent)==null?void 0:o.gameObject.addNewComponent(vu)),u.listener=t.listener;for(let d=0;d<a.clips.length;d++){const f=a.clips[d];u.addModel(f)}}else if(a.type===xr.Marker){const u=new by;if(u.director=this,u.track=a,a.markers)for(const d of a.markers)switch(d.type){case Vx.Signal:u.models.push(d),u.didTrigger.push(!1);break}if(u!==null&&u.models.length>0){const d=j.getComponent(this.gameObject,nh);d&&(u.receivers.push(d),this._signalTracks.push(u))}}else if(a.type===xr.Signal){const u=new by;if(u.director=this,u.track=a,a.markers)for(const d of a.markers)u.models.push(d),u.didTrigger.push(!1);for(const d of a.outputs)u.receivers.push(d);this._signalTracks.push(u)}else if(a.type===xr.Control){const u=new tE;if(u.director=this,u.track=a,a.clips)for(const d of a.clips)u.models.push(d);u.resolveSourceObjects(this.context),this._controlTracks.push(u)}}}setAudioTracksAllowPlaying(t){for(const n of this._audioTracks)n.onAllowAudioChanged(t)}registerAnimationCallback(t){this.animationCallbackReceivers.push(t)}unregisterAnimationCallback(t){const n=this.animationCallbackReceivers.indexOf(t);n!==-1&&this.animationCallbackReceivers.splice(n,1)}};let $a=Jy;h($a,"createTrackFunctions",{});JO([v()],$a.prototype,"playOnAwake",void 0);JO([v()],$a.prototype,"extrapolationMode",void 0);const Lv=Symbol("objectIsAnimatedData");function yR(s,i,t){if(!s)return;if(s[Lv]===void 0){if(!t)return;s[Lv]=new Set}const n=s[Lv];t?n.add(i):n.has(i)&&n.delete(i)}function c9(s){if(!s)return!1;const i=s[Lv];return i!==void 0&&i.size>0}xt.registerCallback(ut.ContextCreated,s=>{const i=s.context.domElement.getAttribute("autoplay");if(i!==void 0&&(i===""||i==="true"||i==="1")&&s.files)for(const t of s.files)j.foreachComponent(t.file.scene,r=>{if(r.enabled!==!1){if(r instanceof qs&&r.playAutomatically||r instanceof Cs||r instanceof $a&&r.playOnAwake===!0)return!0;if(r instanceof qs)return r.playAutomatically=!0,!0;if(r instanceof $a)return r.playOnAwake=!0,!0}},!0)!==!0&&im.assignAnimationsFromFile(t.file,{createAnimationComponent:(r,o)=>vo(r,qs)})});class rJ{constructor(){h(this,"_context")}get context(){return this._context??Ge.Current}get isStateMachineBehaviour(){return!0}}class QA{constructor(i,t,n,r){h(this,"name");h(this,"nameHash");h(this,"normalizedTime");h(this,"length");h(this,"speed");h(this,"action");h(this,"hasTransitions");var o;this.name=i.name,this.nameHash=i.hash,this.normalizedTime=t,this.length=n,this.speed=r,this.action=i.motion.action||null,this.hasTransitions=((o=i.transitions)==null?void 0:o.length)>0||!1}}function h9(s,i){return{name:"Empty",isLooping:!1,guid:(i==null?void 0:i.generateUUID())??ct.generateUUID(),index:-1,clip:new ql(s,0,[])}}var zc;(function(s){s[s.If=1]="If",s[s.IfNot=2]="IfNot",s[s.Greater=3]="Greater",s[s.Less=4]="Less",s[s.Equals=6]="Equals",s[s.NotEqual=7]="NotEqual"})(zc||(zc={}));var Wx;(function(s){s[s.Float=1]="Float",s[s.Int=3]="Int",s[s.Bool=4]="Bool",s[s.Trigger=9]="Trigger"})(Wx||(Wx={}));const fn=Q("debuganimatorcontroller"),jA=Q("debugrootmotion");class yo{constructor(i){h(this,"_speed",1);h(this,"normalizedStartOffset",0);h(this,"animator");h(this,"model");h(this,"_mixer");h(this,"_activeState");h(this,"_activeStates",[]);h(this,"_heldActions",[]);h(this,"rootMotionHandler");this.model=i,fn&&console.log(this)}static createFromClips(i,t={looping:!1,autoTransition:!0,transitionDuration:0}){const n=[];for(let a=0;a<i.length;a++){const l=i[a],c=[];if(t.autoTransition!==!1){const d=t.transitionDuration??0,f=d/l.duration;let p=a;(t.autoTransition===void 0||t.autoTransition===!0)&&(p=(a+1)%i.length),c.push({exitTime:1-f,offset:0,duration:d,hasExitTime:!0,destinationState:p,conditions:[]})}const u={name:l.name,hash:a,motion:{name:l.name,clip:l,isLooping:(t==null?void 0:t.looping)??!1},transitions:c,behaviours:[]};n.push(u)}const r={name:"AnimatorController",guid:new En(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:n}}]};return new yo(r)}play(i,t=-1,n=Number.NEGATIVE_INFINITY,r=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const a=this.model.layers[t].stateMachine;for(const l of a.states)if(l.name===i||l.hash===i){fn&&console.log("transition to ",l),this.transitionTo(l,r,n);return}console.warn("Could not find "+i+" to play")}reset(){this.setStartTransition()}setBool(i,t){var r,o;const n=typeof i=="string"?"name":"hash";return(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[n]===i).forEach(a=>a.value=t)}getBool(i){var n,r,o;const t=typeof i=="string"?"name":"hash";return((o=(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.find(a=>a[t]===i))==null?void 0:o.value)??!1}setFloat(i,t){var o,a;const n=typeof i=="string"?"name":"hash",r=(a=(o=this.model)==null?void 0:o.parameters)==null?void 0:a.filter(l=>l[n]===i);return r.forEach(l=>l.value=t),(r==null?void 0:r.length)>0}getFloat(i){var n,r,o;const t=typeof i=="string"?"name":"hash";return((o=(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.find(a=>a[t]===i))==null?void 0:o.value)??0}setInteger(i,t){var r,o;const n=typeof i=="string"?"name":"hash";return(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[n]===i).forEach(a=>a.value=t)}getInteger(i){var n,r,o;const t=typeof i=="string"?"name":"hash";return((o=(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.find(a=>a[t]===i))==null?void 0:o.value)??0}setTrigger(i){var n,r;fn&&console.log("SET TRIGGER",i);const t=typeof i=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[t]===i).forEach(o=>o.value=!0)}resetTrigger(i){var n,r;const t=typeof i=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[t]===i).forEach(o=>o.value=!1)}getTrigger(i){var n,r,o;const t=typeof i=="string"?"name":"hash";return((o=(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.find(a=>a[t]===i))==null?void 0:o.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(i){this._speed=i}FindState(i){return this.findState(i)}findState(i){if(!i)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const n of t.stateMachine.states)if(n.name===i||n.hash==i)return n}return null}getCurrentStateInfo(){if(!this._activeState)return null;const i=this._activeState.motion.action;if(!i)return null;const t=this._activeState.motion.clip.duration,n=t<=0?0:Math.abs(i.time/t);return new QA(this._activeState,n,t,this._speed)}get currentAction(){if(!this._activeState)return null;const i=this._activeState.motion.action;return i||null}get context(){var i;return(i=this.animator)==null?void 0:i.context}get mixer(){return this._mixer}dispose(){var i;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const t of this._activeStates)t.motion.clip&&this.mixer.uncacheAction(t.motion.clip,this.animator.gameObject)}(i=this.context)==null||i.animations.unregisterAnimationMixer(this._mixer)}bind(i){var t,n;i?this.animator!==i&&(this._mixer&&(this._mixer.stopAllAction(),(t=this.context)==null||t.animations.unregisterAnimationMixer(this._mixer)),this.animator=i,this._mixer=new MC(this.animator.gameObject),(n=this.context)==null||n.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;fn&&console.warn("AnimatorController clone()",this.model);const i=h0(this.model,(n,r,o)=>o==null?!0:!(o.type==="Object3D"||o.isObject3D===!0||pz(o)||o.tracks!==void 0||o instanceof yo));return console.assert(i!==this.model),new yo(i)}update(i){var n,r;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(i);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onBeforeUpdate(i)),this._mixer.update(t),this.animator.applyRootMotion&&((r=this.rootMotionHandler)==null||r.onAfterUpdate(i))}get activeState(){return this._activeState}updateActiveStates(i){for(let t=0;t<this._activeStates.length;t++){const n=this._activeStates[t],r=n.motion;if(!r.action)this._activeStates.splice(t,1),t--;else{const o=r.action;o.weight=i,o.getEffectiveWeight()<=0&&!o.isRunning()&&(fn&&console.debug("REMOVE",n.name,o.getEffectiveWeight(),o.isRunning(),o.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){var i;this.model.layers.length>1&&(fn||be())&&console.warn("Multiple layers are not supported yet "+((i=this.animator)==null?void 0:i.name));for(const t of this.model.layers){const n=t.stateMachine;n.defaultState===void 0&&(fn&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",t),n.defaultState=0);const r=n.states[n.defaultState];this.transitionTo(r,0,this.normalizedStartOffset);break}}evaluateTransitions(){var o;let i=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;i=!0}const t=this._activeState,n=t.motion.action;for(const a of t.transitions){if(!a.hasExitTime&&a.conditions.length<=0)continue;let l=!0;for(const c of a.conditions)if(!this.evaluateCondition(c)){l=!1;break}if(l)if(n){const c=t.motion.clip.duration,u=c<=0?1:Math.abs(n.time/c);let d=a.exitTime;n.timeScale<0&&(d=1-d);let f=!1;if(a.hasExitTime?n.timeScale>0?f=u>=a.exitTime:n.timeScale<0&&(f=1-u>=a.exitTime):f=!0,f){for(const p of a.conditions){const g=this.model.parameters.find(m=>m.name===p.parameter);(g==null?void 0:g.type)===Wx.Trigger&&g.value&&(g.value=!1)}if(n.clampWhenFinished=!0,fn){const p=this.getState(a.destinationState,0);console.log(`Transition to ${a.destinationState} / ${p==null?void 0:p.name}`,a,`
Timescale: `+n.timeScale,`
Normalized time: `+u.toFixed(3),`
Exit Time: `+d,a.hasExitTime)}this.transitionTo(a.destinationState,a.duration,a.offset);return}}else{this.transitionTo(a.destinationState,a.duration,a.offset);return}}n&&this.setTimescale(n,t);let r=!1;if(t.motion.isLooping&&n&&(n.time>=n.getClip().duration?(r=!0,n.reset(),n.time=0,n.play()):n.time<=0&&n.timeScale<0&&(r=!0,n.reset(),n.time=n.getClip().duration,n.play())),!r&&t&&!i&&n&&this.animator&&t.behaviours){const a=n==null?void 0:n.getClip().duration,l=n.time/a,c=new QA(this._activeState,l,a,this._speed);for(const u of t.behaviours)u.instance&&((o=u.instance.onStateUpdate)==null||o.call(u.instance,this.animator,c,0))}}setTimescale(i,t){let n=t.speed??1;t.speedParameter&&(n*=this.getFloat(t.speedParameter)),n!==void 0&&(i.timeScale=n*this._speed)}getState(i,t){return typeof i=="number"&&(i==-1&&(i=this.model.layers[t].stateMachine.defaultState,i===void 0&&(fn&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),i=0)),i=this.model.layers[t].stateMachine.states[i]),i}releaseHeldActions(i){for(const t of this._heldActions)t.fadeOut(i);this._heldActions.length=0}transitionTo(i,t,n){var d,f,p,g,m,A,y,b;if(!this.animator)return;const r=0;if(i=this.getState(i,r),!(i!=null&&i.motion)||!i.motion.clip||!(i.motion.clip instanceof ql))return;const o=this._activeState===i;if(o){const _=i.motion;if(!_.action_loopback&&_.clip){const w=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(_.clip,this.animator.gameObject),w&&w.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),_.action_loopback=this.createAction(_.clip)}}if((d=this._activeState)!=null&&d.behaviours&&this._activeState.motion.action){const _=(f=this._activeState)==null?void 0:f.motion.clip.duration,w=this._activeState.motion.action.time/_,S=new QA(this._activeState,w,_,this._speed);for(const E of this._activeState.behaviours)(g=(p=E.instance)==null?void 0:p.onStateExit)==null||g.call(E.instance,this.animator,S,r)}const a=(m=this._activeState)==null?void 0:m.motion.action;o&&(i.motion.action=i.motion.action_loopback,i.motion.action_loopback=a);const l=this._activeState;this._activeState=i;const c=(A=i.motion)==null?void 0:A.action,u=i.motion.clip;if((u==null?void 0:u.duration)<=0&&u.tracks.length<=0?a&&this._heldActions.push(a):a&&(a.fadeOut(t),this.releaseHeldActions(t)),c){if(n=Math.max(0,Math.min(1,n)),i.cycleOffsetParameter){let w=this.getFloat(i.cycleOffsetParameter);typeof w=="number"?(w<0&&(w+=1),n+=w,n%=1):fn&&console.warn("AnimatorController cycle offset parameter is not a number",i.cycleOffsetParameter)}else typeof i.cycleOffset=="number"&&(n+=i.cycleOffset,n%=1);c.isRunning()&&c.stop(),c.reset(),c.enabled=!0,this.setTimescale(c,i);const _=i.motion.clip.duration;if(c.time=o?0:n*_,c.timeScale<0&&(c.time=_-c.time),c.clampWhenFinished=!0,c.setLoop(Fw,0),t>0?c.fadeIn(t):c.weight=1,c.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(c),this._activeStates.includes(i)||this._activeStates.push(i),this._activeState.behaviours){const w=new QA(i,n,_,this._speed);for(const S of this._activeState.behaviours)(b=(y=S.instance)==null?void 0:y.onStateEnter)==null||b.call(S.instance,this.animator,w,r)}}else fn&&(i.__warned_no_motion||(i.__warned_no_motion=!0,console.warn("No action",i.motion,this)));fn&&console.log("TRANSITION FROM "+(l==null?void 0:l.name)+" TO "+i.name,t,a,c,c==null?void 0:c.getEffectiveTimeScale(),c==null?void 0:c.getEffectiveWeight(),c==null?void 0:c.isRunning(),c==null?void 0:c.isScheduled(),c==null?void 0:c.paused)}createAction(i){var n,r;if(this._mixer.existingAction(i)&&this._mixer.uncacheAction(i,(n=this.animator)==null?void 0:n.gameObject),(r=this.animator)!=null&&r.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new u9(this));const o=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,o,i)}else return this._mixer.clipAction(i)}evaluateCondition(i){const t=this.model.parameters.find(n=>n.name===i.parameter);if(!t)return!1;switch(i.mode){case zc.If:return t.value===!0;case zc.IfNot:return t.value===!1;case zc.Greater:return t.value>i.threshold;case zc.Less:return t.value<i.threshold;case zc.Equals:return t.value===i.threshold;case zc.NotEqual:return t.value!==i.threshold}return!1}createActions(i){var t,n,r,o;fn&&console.log("AnimatorController createActions",this.model);for(const a of this.model.layers){const l=a.stateMachine;for(let c=0;c<l.states.length;c++){const u=l.states[c];u.transitions||(u.transitions=[]);for(const d of u.transitions)d.conditions||(d.conditions=[]);if(u.motion||(fn&&console.warn("No motion",u),u.motion=h9(u.name)),this.animator&&u.motion.clips){const d=(t=u.motion.clips)==null?void 0:t.find(f=>{var p,g;return f.node.name===((g=(p=this.animator)==null?void 0:p.gameObject)==null?void 0:g.name)});d?u.motion.clip=d.clip:(fn||be())&&console.warn('Could not find clip for animator "'+((r=(n=this.animator)==null?void 0:n.gameObject)==null?void 0:r.name)+'"',u.motion.clips.map(f=>f.node.name))}if(!u.motion.clip){fn&&console.warn("No clip assigned to state",u);const d=new ql(void 0,void 0,[]);u.motion.clip=d}if((o=u.motion)!=null&&o.clip){const d=u.motion.clip;if(d instanceof ql){const f=this.createAction(d);u.motion.action=f}else(fn||be())&&console.warn("No valid animationclip assigned",u)}if(u.behaviours&&Array.isArray(u.behaviours))for(const d of u.behaviours){if(!(d!=null&&d.typeName))continue;const f=O.get(d.typeName),p=new f;p.isStateMachineBehaviour&&(p._context=this.context??void 0,Mf(p,d.properties),d.instance=p),fn&&console.log("Created animator controller behaviour",u.name,d.typeName,d.properties,p)}}}}*enumerateActions(){if(this.model.layers)for(const i of this.model.layers){const t=i.stateMachine;for(let n=0;n<t.states.length;n++){const r=t.states[n];r!=null&&r.motion&&(r.motion.action&&(yield r.motion.action),r.motion.action_loopback&&(yield r.motion.action_loopback))}}}}class bR{constructor(i,t){h(this,"track");h(this,"createdInterpolant");h(this,"originalEvaluate");h(this,"customEvaluate");this.track=i;const n=i,r=n.createInterpolant.bind(i);n.createInterpolant=()=>(n.createInterpolant=r,this.createdInterpolant=r(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=o=>{if(!this.originalEvaluate)return;const a=this.originalEvaluate(o);return t(o,a)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const rn=class{constructor(i,t,n,r,o){h(this,"_action");h(this,"root");h(this,"clip");h(this,"positionWrapper",null);h(this,"rotationWrapper",null);h(this,"context");h(this,"positionChange",new x);h(this,"rotationChange",new se);h(this,"_prevTime",0);if(this.context=i,this.root=t,this.clip=n,rn.firstKeyframeRotation[this.cacheId]||(rn.firstKeyframeRotation[this.cacheId]=new se),o){const a=o.values;rn.firstKeyframeRotation[this.cacheId].set(a[0],a[1],a[2],a[3])}rn.spaceRotation[this.cacheId]||(rn.spaceRotation[this.cacheId]=new se),rn.effectiveSpaceRotation[this.cacheId]||(rn.effectiveSpaceRotation[this.cacheId]=new se),rn.clipOffsetRotation[this.cacheId]=new se,o&&rn.clipOffsetRotation[this.cacheId].set(o.values[0],o.values[1],o.values[2],o.values[3]).invert(),this.handlePosition(n,r),this.handleRotation(n,o)}set action(i){this._action=i}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(i){if(i.getClip()!==this.clip)return;rn.lastObjRotation[this.cacheId]||(rn.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=rn.lastObjRotation[this.cacheId];if(rn.spaceRotation[this.cacheId].copy(t),jA){const n=new Gt().setFromQuaternion(t);console.log("START",this.clip.name,ye.toDegrees(n.y),this.root.position.z)}}getClipRotationOffset(){return rn.clipOffsetRotation[this.cacheId]}handlePosition(i,t){if(t){const n=this.root;jA&&n.add(new dr),rn.lastObjPosition[this.cacheId]||(rn.lastObjPosition[this.cacheId]=this.root.position.clone());const r=new x,o=new x;this.positionWrapper=new bR(t,(a,l)=>{const c=this.action.getEffectiveWeight();return jA&&n.position.length()>8&&n.position.set(0,n.position.y,0),a>this._prevTime&&(r.set(l[0],l[1],l[2]),r.sub(o),r.multiplyScalar(c),r.applyQuaternion(this.getClipRotationOffset()),r.applyQuaternion(n.quaternion),this.positionChange.copy(r)),o.fromArray(l),this._prevTime=a,l[0]=0,l[1]=0,l[2]=0,l})}}handleRotation(i,t){if(t){if(jA){const a=t.values,l=new Gt().setFromQuaternion(new se(a[0],a[1],a[2],a[3]));console.log(i.name,t.name,"FIRST ROTATION IN TRACK",ye.toDegrees(l.y));const c=t.values.length-4,u=new se().set(a[c],a[c+1],a[c+2],a[c+3]),d=new Gt().setFromQuaternion(u);console.log(i.name,t.name,"LAST ROTATION IN TRACK",ye.toDegrees(d.y))}let n=0;const r=new se,o=new se;this.rotationWrapper=new bR(t,(a,l)=>(a>n&&(o.set(l[0],l[1],l[2],l[3]),r.invert(),o.multiply(r),this.rotationChange.copy(o)),r.fromArray(l),n=a,l[0]=0,l[1]=0,l[2]=0,l[3]=1,l))}}onBeforeUpdate(i){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(i){return!this.action||(i*=this.action.getEffectiveWeight(),i<=0)?!1:(this.positionChange.multiplyScalar(i),this.rotationChange.slerp(rn.identityQuaternion,1-i),!0)}};let va=rn;h(va,"lastObjPosition",{}),h(va,"lastObjRotation",{}),h(va,"firstKeyframeRotation",{}),h(va,"spaceRotation",{}),h(va,"effectiveSpaceRotation",{}),h(va,"clipOffsetRotation",{}),h(va,"identityQuaternion",new se);class u9{constructor(i){h(this,"controller");h(this,"handler",[]);h(this,"root");h(this,"basePosition",new x);h(this,"baseQuaternion",new se);h(this,"baseRotation",new Gt);h(this,"summedPosition",new x);h(this,"summedRotation",new se);this.controller=i}createClip(i,t,n){this.root=t,t&&"name"in t&&t.name;const r=this.findRootTrack(n,".position"),o=this.findRootTrack(n,".quaternion"),a=new va(this.controller.context,t,n,r,o);this.handler.push(a);const l=i.clipAction(n);return a.action=l,l}onStart(i){for(const t of this.handler)t.onStart(i)}onBeforeUpdate(i){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(i)}onAfterUpdate(i){if(!(i<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(i)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(i,t){const n=i.tracks;if(!n)return null;for(const r of n)if(r.name.endsWith(t))return r;return null}}class d9 extends Eo{onSerialize(i,t){}onDeserialize(i,t){if(t.type===yo&&(i==null?void 0:i.__type)==="AnimatorController")return new yo(i)}}new d9(yo);var N0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const $r=Q("debuganimator");class Cs extends oe{constructor(){super(...arguments);h(this,"applyRootMotion",!1);h(this,"hasRootMotion",!1);h(this,"keepAnimatorControllerStateOnDisable",!1);h(this,"_parametersAreDirty",!1);h(this,"_isDirty",!1);h(this,"_speed",1);h(this,"_normalizedStartOffset",0);h(this,"_animatorController",null);h(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(t){var n;this._animatorController&&this._animatorController.model===t||(t?t instanceof yo?(t.animator&&t.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(n=t.model)==null?void 0:n.name),t.model||console.error("AnimatorController has no model"),t=new yo(t.model)),this._animatorController=t,this._animatorController.bind(this)):($r&&console.log("Assign animator controller",t,this),this._animatorController=new yo(t),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var t;return(t=this.runtimeAnimatorController)==null?void 0:t.getCurrentStateInfo()}get currentAction(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,n=-1,r=Number.NEGATIVE_INFINITY,o=0){this.play(t,n,r,o)}play(t,n=-1,r=Number.NEGATIVE_INFINITY,o=0){var a;(a=this.runtimeAnimatorController)==null||a.play(t,n,r,o),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,n){this.setBool(t,n)}setBool(t,n){var r,o;$r&&console.log("setBool",t,n),((r=this.runtimeAnimatorController)==null?void 0:r.getBool(t))!==n&&(this._parametersAreDirty=!0),(o=this.runtimeAnimatorController)==null||o.setBool(t,n)}GetBool(t){return this.getBool(t)}getBool(t){var r;const n=((r=this.runtimeAnimatorController)==null?void 0:r.getBool(t))??!1;return $r&&console.log("getBool",t,n),n}toggleBool(t){this.setBool(t,!this.getBool(t))}SetFloat(t,n){this.setFloat(t,n)}setFloat(t,n){var r,o;((r=this.runtimeAnimatorController)==null?void 0:r.getFloat(t))!==n&&(this._parametersAreDirty=!0),$r&&console.log("setFloat",t,n),(o=this.runtimeAnimatorController)==null||o.setFloat(t,n)}GetFloat(t){return this.getFloat(t)}getFloat(t){var r;const n=((r=this.runtimeAnimatorController)==null?void 0:r.getFloat(t))??-1;return $r&&console.log("getFloat",t,n),n}SetInteger(t,n){this.setInteger(t,n)}setInteger(t,n){var r,o;((r=this.runtimeAnimatorController)==null?void 0:r.getInteger(t))!==n&&(this._parametersAreDirty=!0),$r&&console.log("setInteger",t,n),(o=this.runtimeAnimatorController)==null||o.setInteger(t,n)}GetInteger(t){return this.getInteger(t)}getInteger(t){var r;const n=((r=this.runtimeAnimatorController)==null?void 0:r.getInteger(t))??-1;return $r&&console.log("getInteger",t,n),n}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var n;this._parametersAreDirty=!0,$r&&console.log("setTrigger",t),(n=this.runtimeAnimatorController)==null||n.setTrigger(t)}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var n;this._parametersAreDirty=!0,$r&&console.log("resetTrigger",t),(n=this.runtimeAnimatorController)==null||n.resetTrigger(t)}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var r;const n=(r=this.runtimeAnimatorController)==null?void 0:r.getTrigger(t);return $r&&console.log("getTrigger",t,n),n}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var n;t!==this._speed&&($r&&console.log("setSpeed",t),this._speed=t,((n=this._animatorController)==null?void 0:n.animator)==this&&this._animatorController.setSpeed(t))}set minMaxSpeed(t){var n;this._speed=ye.lerp(t.x,t.y,Math.random()),((n=this._animatorController)==null?void 0:n.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(t){var n;this._normalizedStartOffset=ye.lerp(t.x,t.y,Math.random()),((n=this.runtimeAnimatorController)==null?void 0:n.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){$r&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const n=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&n){const r=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=r,r?(console.assert(this.runtimeAnimatorController!==r),this.runtimeAnimatorController=r,console.assert(this.runtimeAnimatorController===r),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!c9(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}N0([v()],Cs.prototype,"applyRootMotion",void 0);N0([v()],Cs.prototype,"hasRootMotion",void 0);N0([v()],Cs.prototype,"keepAnimatorControllerStateOnDisable",void 0);N0([v()],Cs.prototype,"runtimeAnimatorController",null);const Pa=Q("debugusdzanimation"),qx=Q("debugusdzanimationserialization");class iE{constructor(i,t,n){h(this,"_start");h(this,"ext");h(this,"root");h(this,"clip");h(this,"speed");this.ext=i,this.root=t,this.clip=n}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var i;return((i=this.clip)==null?void 0:i.duration)??an.restPoseClipDuration}}const n1=class{constructor(i,t,n){h(this,"clip");h(this,"pos");h(this,"rot");h(this,"scale");h(this,"root");h(this,"target");h(this,"duration",0);h(this,"useRootMotion",!1);this.root=i,this.target=t,this.clip=n,n?this.duration=n.duration:this.duration=n1.restPoseClipDuration;const r=j.getComponent(i,Cs);r&&(this.useRootMotion=r.applyRootMotion)}get frameRate(){return 60}addTrack(i){var t,n;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it â€“ this is likely a bug");return}i.name.endsWith("position")?this.pos=i:i.name.endsWith("quaternion")?this.rot=i:i.name.endsWith("scale")?this.scale=i:(i.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+i.name+" on "+(((t=this.root)==null?void 0:t.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+i.name+" on "+(((n=this.root)==null?void 0:n.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),be()&&Xt("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var i,t,n,r,o,a;return this.clip?Math.max(((t=(i=this.pos)==null?void 0:i.times)==null?void 0:t.length)??0,((r=(n=this.rot)==null?void 0:n.times)==null?void 0:r.length)??0,((a=(o=this.scale)==null?void 0:o.times)==null?void 0:a.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(i=!0,t=!0,n=!0){var c,u,d;if(!this.clip)return[0,this.duration];const r=(c=this.pos)==null?void 0:c.times,o=(u=this.rot)==null?void 0:u.times,a=(d=this.scale)==null?void 0:d.times,l=[];if(i&&r)for(const f of r)l.push(f);if(t&&o)for(const f of o)l.push(f);if(n&&a)for(const f of a)l.push(f);return l.includes(0)||l.push(0),l.sort((f,p)=>f-p),[...new Set(l)]}*getValues(i,t=!0,n=!0,r=!0){var p,g,m;const o=new x,a=new se,l=new x(1,1,1),c=this.target,u=t?(p=this.pos)==null?void 0:p.createInterpolant():void 0,d=n?(g=this.rot)==null?void 0:g.createInterpolant():void 0,f=r?(m=this.scale)==null?void 0:m.createInterpolant():void 0;u||o.set(c.position.x,c.position.y,c.position.z),d||a.set(c.quaternion.x,c.quaternion.y,c.quaternion.z,c.quaternion.w),f||l.set(c.scale.x,c.scale.y,c.scale.z);for(let A=0;A<i.length;A++){const y=i[A];if(u){const b=u.evaluate(y);o.set(b[0],b[1],b[2])}if(d){const b=d.evaluate(y);a.set(b[0],b[1],b[2],b[3])}if(f){const b=f.evaluate(y);l.set(b[0],b[1],b[2])}if(this.useRootMotion&&c===this.root){const b=new le;b.compose(o,a,l),b.multiply(c.matrix),b.decompose(o,a,l)}yield{time:y,translation:o,rotation:a,scale:l,index:A}}}};let an=n1;h(an,"animationDurationPadding",1/60),h(an,"restPoseClipDuration",1/60);class z0{constructor(i){h(this,"dict",new Map);h(this,"rootTargetMap",new Map);h(this,"rootAndClipToRegisteredAnimationMap",new Map);h(this,"rootToRegisteredClip",new Map);h(this,"serializers",[]);h(this,"injectRestPoses",!1);h(this,"injectImplicitBehaviours",!1);this.injectRestPoses=i,this.injectImplicitBehaviours=i}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(an.restPoseClipDuration+an.animationDurationPadding)*60}getEndTimeCode(){let i=0;for(const[t,n]of this.rootAndClipToRegisteredAnimationMap){const r=n.start+n.duration;r>i&&(i=r)}return i*60}getClipCount(i){var n;return((n=this.rootToRegisteredClip.get(i))==null?void 0:n.length)??0??0}getStartTime01(i,t){if(!t)return 0;const n=this.rootTargetMap.get(i);if(!n)return 0;const r=this.dict.get(n[0]);if(!r)return console.error("Trying to get start time for root that has no animation data",i,t,...this.dict),0;let o=0;for(let a=0;a<r.length&&r[a].clip!==t;a++)o+=r[a].getDuration()+an.animationDurationPadding;return o}registerAnimation(i,t){var u;if(!i)return null;this.rootTargetMap.has(i)||this.rootTargetMap.set(i,[]);const n=i.uuid+((t==null?void 0:t.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(n))return this.rootAndClipToRegisteredAnimationMap.get(n);Pa&&console.log("registerAnimation",i,t);const r=this.injectRestPoses?1:0,o=(((u=this.rootToRegisteredClip.get(i))==null?void 0:u.length)??0)+r,a=this.rootTargetMap.get(i),l=new Set(a);if(t&&t.tracks)for(const d of t.tracks){const f=Nr.parseTrackName(d.name),p=Nr.findNode(i,f.nodeName);if(!p){console.warn("no object found for track",d.name,"using "+i.name+" instead");continue}this.dict.has(p)||this.dict.set(p,[]);const g=this.dict.get(p);if(!g){console.warn("no transform data found for target ",p,"at slot "+o+", this is likely a bug");continue}l.delete(p),this.injectRestPoses&&!g[0]&&(g[0]=new an(null,p,null));let m=g[o];m||(m=new an(i,p,t),g[o]=m),m.addTrack(d),a!=null&&a.includes(p)||a==null||a.push(p)}Pa&&console.log("Unregistered nodes for this clip",l,"clip",t,"at slot",o,"for root",i,"targets",a);for(const d of l){const f=this.dict.get(d);if(!f)continue;if(this.injectRestPoses&&!f[0]){console.warn("Adding rest pose for ",d,t,"at slot",o,"This is likely a bug, should have been added earlier.");const g=new an(null,d,null);f[0]=g}let p=f[o];p||(Pa&&console.log("Adding padding clip for ",d,t,"at slot",o),p=new an(i,d,t),f[o]=p)}const c=new iE(this,i,t);if(this.rootAndClipToRegisteredAnimationMap.set(n,c),Pa&&console.log({root:i,clip:t,info:c}),t){const d=this.rootToRegisteredClip.get(i);d?d.push(t):this.rootToRegisteredClip.set(i,[t])}return c}onAfterHierarchy(i){Pa&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(i){var t,n;Pa&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const r of this.rootTargetMap.keys()){const o=this.rootTargetMap.get(r);if(!o)continue;let a;const l=[];for(const c of o){const u=this.dict.get(c);if(!u){console.error("No data found for target on USDZ export â€“ please report a bug!",c);continue}a===void 0&&(a=u==null?void 0:u.length),a!==(u==null?void 0:u.length)&&console.error("Different array lengths for targets â€“ please report a bug!",u);for(let d=0;d<u.length;d++){let f=u[d];if(!f){const g=d-(this.injectRestPoses?1:0);u[d]=new an(null,c,this.rootToRegisteredClip.get(r)[g]),f=u[d]}const p=f.getDuration();if(l[d]===void 0)l[d]=p;else if(l[d]!==p){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:u,target:c}),l[d]=p;continue}}}}for(const r of this.serializers){const o=(t=r.model)==null?void 0:t.parent,a=(o==null?void 0:o.isDynamic)===!0;qx&&console.log(a,(n=r.model)==null?void 0:n.parent),a&&r.registerCallback(o)}}onExportObject(i,t,n){j.foreachComponent(i,o=>{const a=o;typeof a.createAnimation=="function"&&a.createAnimation(this,t,n)},!1);const r=new f9(i,this.dict);this.serializers.push(r),r.registerCallback(t)}}class f9{constructor(i,t){h(this,"object");h(this,"dict");h(this,"model");h(this,"callback");this.object=i,this.dict=t}registerCallback(i){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),qx&&console.log("REPARENT",i),this.model=i,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(i,t){var o;const n=this.model,r=this.dict;if(n&&n.skinnedMesh){let f=function(M){const U=[];for(const[G,W]of M){let Y=`${G} : [`;const D=[];for(const L of W)D.push(`(${jt(L.x)}, ${jt(L.y)}, ${jt(L.z)})`);Y=Y.concat(D.join(", ")),Y=Y.concat("],"),U.push(Y)}return U},p=function(M){const U=[];for(const[G,W]of M){let Y=`${G} : [`;const D=[];for(const L of W)D.push(`(${jt(L.w)}, ${jt(L.x)}, ${jt(L.y)}, ${jt(L.z)})`);Y=Y.concat(D.join(", ")),Y=Y.concat("],"),U.push(Y)}return U},g=function(M){let U,G=!0;const W=new Map;for(const[D,L]of M){U===void 0&&(U=L.length),U!==L.length&&(G=!1);let V=0;for(const te of L)V++,te||(W.has(D)||W.set(D,[]),W.get(D).push(V))}Pa&&console.log("Bone count: ",M.size,"TransformData entries per bone: ",U,"Undefined bone entries: ",W),console.assert(G,"All bones should have the same number of TransformData entries",M),console.assert(W.size===0,"All TransformData entries should be set",W);const Y=[];for(const[D,L]of M){const V=new Array;let te=0;for(let K=0;K<L.length;K++)V.push(te),te+=L[K].getDuration()+an.animationDurationPadding;for(let K=0;K<L.length;K++){const ue=L[K],de=V[K];Y.length<=K&&Y.push({pos:[],rot:[],scale:[],timeOffset:de});const _e=Y[K];_e.pos.push(...ue.getSortedTimesArray(!0,!1,!1)),_e.rot.push(...ue.getSortedTimesArray(!1,!0,!1)),_e.scale.push(...ue.getSortedTimesArray(!1,!1,!0))}}for(const D of Y)D.pos.sort((L,V)=>L-V),D.rot.sort((L,V)=>L-V),D.scale.sort((L,V)=>L-V),D.pos=[...new Set(D.pos)],D.rot=[...new Set(D.rot)],D.scale=[...new Set(D.scale)];return Y},m=function(M,U,G){const W=new Map,Y=new Map,D=new Map,L=U.length;for(const V of G){const te=M.get(V);let K;te?console.assert(te.length===L,"We should have the same number of TransformData entries for each bone",te,U):K=new an(null,V,null);for(let ue=0;ue<L;ue++){const de=te?te[ue]:K,_e=U[ue];for(const{time:Ee,translation:Xe}of de.getValues(_e.pos,!0,!1,!1)){const Ke=(Ee+_e.timeOffset)*60;W.has(Ke)||W.set(Ke,new Array),W.get(Ke).push(Xe.clone())}for(const{time:Ee,rotation:Xe}of de.getValues(_e.rot,!1,!0,!1)){const Ke=(Ee+_e.timeOffset)*60;Y.has(Ke)||Y.set(Ke,new Array),Y.get(Ke).push(Xe.clone())}for(const{time:Ee,scale:Xe}of de.getValues(_e.scale,!1,!1,!0)){const Ke=(Ee+_e.timeOffset)*60;D.has(Ke)||D.set(Ke,new Array),D.get(Ke).push(Xe.clone())}}}return{position:W.size==0?void 0:W,quaternion:Y.size==0?void 0:Y,scale:D.size==0?void 0:D}},A=function(M){const U=[];for(const G of M)U.push(`(${jt(G.x)}, ${jt(G.y)}, ${jt(G.z)})`);return U.join(", ")},y=function(M){const U=[];for(const G of M)U.push(`(${jt(G.w)}, ${jt(G.x)}, ${jt(G.y)}, ${jt(G.z)})`);return U.join(", ")},b=function(M){const U=new Map;if(Pa){const G=new Array;for(const[W,Y]of r)G.push(W.uuid+": "+Y.length+" "+Y.map(D=>{var L;return(L=D.clip)==null?void 0:L.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+G.join(`
`))}for(const G of M){const W=r.get(G);W&&U.set(G,W)}return U},_=function(M){const U=b(M),G=g(U);return m(U,G,M)};const a=n.skinnedMesh.skeleton,l=new Array,c=[],u=[];for(const M of a.bones)if(M.parent.type!=="Bone"){c.push(M);const U=a.boneInverses[a.bones.indexOf(M)];l.push({bone:M,inverse:U}),u.push(M.uuid)}for(;u.length<a.bones.length;)for(const M of c){const U=M.children;for(const G of U)if(u.indexOf(G.uuid)===-1&&a.bones.indexOf(G)!==-1){c.push(G);const W=a.boneInverses[a.bones.indexOf(G)];l.push({bone:G,inverse:W}),u.push(G.uuid)}}for(const M of LO(a.bones))l.push({bone:M,inverse:M.matrixWorld.clone().invert()});const d=l[0].bone.parent;d||console.error("No bone parent found for skinned mesh during USDZ export",n.skinnedMesh),l.sort((M,U)=>df(M.bone,d)>df(U.bone,d)?1:-1);const w=t.quickLookCompatible,S=[],E=[],I=[],k=[];for(const{bone:M}of l){if(w){const U=M.scale;U.x==0&&(U.x=1e-5),U.y==0&&(U.y=1e-5),U.z==0&&(U.z=1e-5),S.push(new le().compose(M.position,M.quaternion,M.scale))}else S.push(M.matrix.clone());E.push(M.position),I.push(M.quaternion),k.push(M.scale)}const T=l.map(M=>'"'+df(M.bone,d)+'"').join(", "),P=l.map(M=>fg(M.inverse.clone().invert())).join(", ");i.beginBlock('def Skeleton "Rig"'),i.appendLine(`uniform matrix4d[] bindTransforms = [${P}]`),i.appendLine(`uniform token[] joints = [${T}]`),i.appendLine('uniform token purpose = "guide"'),i.appendLine(`uniform matrix4d[] restTransforms = [${S.map(M=>fg(M)).join(", ")}]`),i.appendLine(`matrix4d xformOp:transform = ${fg(new le)}`),i.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]');const B=_(l.map(M=>M.bone));if(Pa){let M=1e7,U=0;for(const G of((o=B.position)==null?void 0:o.keys())??[])M=Math.min(M,G),U=Math.max(U,G);console.log("Time samples",M,U,B)}if(i.beginBlock('def SkelAnimation "_anim"'),i.appendLine(`uniform token[] joints = [${T}]`),i.appendLine(`quatf[] rotations = [${y(I)}]`),B&&B.quaternion){i.beginBlock("quatf[] rotations.timeSamples = {","");const M=p(B.quaternion);for(const U of M)i.appendLine(U);i.closeBlock()}if(i.appendLine(`half3[] scales = [${A(k)}]`),B&&B.scale){i.beginBlock("half3[] scales.timeSamples = {","");const M=f(B.scale);for(const U of M)i.appendLine(U);i.closeBlock()}if(i.appendLine(`float3[] translations = [${A(E)}]`),B&&B.position){i.beginBlock("float3[] translations.timeSamples = {","");const M=f(B.position);for(const U of M)i.appendLine(U);i.closeBlock()}i.closeBlock(),i.closeBlock()}}onSerialize(i,t){if(!this.model)return;const n=this.dict.get(this.object);if(n)for(let f=0;f<n.length;f++)n[f]===void 0&&(n[f]=new an(null,this.object,null));this.skinnedMeshExport(i,t);const r=this.object,o=this.dict.get(r);if(!o||r.isSkinnedMesh)return;qx&&console.log("SERIALIZE",this.model.name,this.object.type,o);const a=new Array;let l=0;for(let f=0;f<o.length;f++){if(a.push(l),o[f]===void 0){console.error("Got an undefined transform data, this is likely a bug.",r,o);continue}l+=o[f].getDuration()+an.animationDurationPadding}const c=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1}),u=[];function d(f,p){var m;if(f.some(A=>A&&{position:A.pos,rotation:A.rot,scale:A.scale}[p])){switch(p){case"position":u.push("xformOp:translate"),i.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":u.push("xformOp:orient"),i.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":u.push("xformOp:scale"),i.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let A=0;A<f.length;A++){const y=f[A];if(!y)continue;const b=a[A],_=y.getSortedTimesArray(p==="position",p==="rotation",p==="scale");if(!_||_.length===0){console.error("got an animated object but no time values?",r,y);continue}{const w=((m=y.clip)==null?void 0:m.name)??"rest",S=y.getDuration();Pa&&console.log("Write .timeSamples:",w,b,S,f),i.appendLine("# "+w+": start="+c.format(b*y.frameRate)+", length="+c.format(S*y.frameRate)+", frames="+y.getFrames())}if(p==="position"&&y.pos)for(const{time:w,translation:S}of y.getValues(_,!0,!1,!1)){const I=`${c.format((b+w)*y.frameRate)}: (${jt(S.x)}, ${jt(S.y)}, ${jt(S.z)}),`;i.appendLine(I)}if(p==="rotation"&&y.rot)for(const{time:w,rotation:S}of y.getValues(_,!1,!0,!1)){const I=`${c.format((b+w)*y.frameRate)}: (${jt(S.w)}, ${jt(S.x)}, ${jt(S.y)}, ${jt(S.z)}),`;i.appendLine(I)}if(p==="scale"&&y.scale)for(const{time:w,scale:S}of y.getValues(_,!1,!1,!0)){const I=`${c.format((b+w)*y.frameRate)}: (${jt(S.x)}, ${jt(S.y)}, ${jt(S.z)}),`;i.appendLine(I)}}i.closeBlock()}}if(d(o,"position"),d(o,"rotation"),d(o,"scale"),u.length>0){const f=[...new Set(u)];i.appendLine(`uniform token[] xformOpOrder = [${f.map(p=>`"${p}"`).join(", ")}]`)}}}const p9=Q("debugpost");let Xx=null;function g9(s){Xx=s}function ZO(s){let i=s.gameObject;for(;i;){for(const t of QS(i))if(t.isPostProcessingManager===!0)return t;i=i.parent}return null}function m9(s){let i=ZO(s);if(!i)if(Xx){p9&&console.warn("Adding postprocessing manager to the scene.");const t=s.scene;i=vo(t,Xx)}else be()&&console.warn("No post processing manager found");return i}var $O=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const A9=Q("debugpost");class Ae{constructor(i){h(this,"isVolumeParameter",!0);h(this,"_isInitialized",!1);h(this,"_active",!0);h(this,"_value");h(this,"_valueRaw");h(this,"_defaultValue");h(this,"valueProcessor");h(this,"onValueChanged");i!==void 0&&this.initialize(i)}get isInitialized(){return this._isInitialized}initialize(i){i!==void 0&&(this._value=i,this._defaultValue=i,this._valueRaw=i,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(i){if(this._active===i)return;this._active=i;const t=i?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(i){this.isInitialized||this.initialize(i),this.processValue(i,!1)}set defaultValue(i){this._defaultValue=i}__init(){this.processValue(this._valueRaw,!0)}processValue(i,t){if(i==null||!t&&this.testIfValueChanged(i)===!1)return;const n=this._value;A9&&typeof n=="number"&&typeof i=="number"&&(n==null||n.toFixed(4),i==null||i.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,i=this._defaultValue,this._valueRaw=i):(this._valueRaw=i,this._active&&this.valueProcessor&&(i=this.valueProcessor(i)),this._value=i),this.onValueChanged&&this.onValueChanged(i,n,this)}testIfValueChanged(i){return this._valueRaw!==i}}$O([v()],Ae.prototype,"overrideState",null);$O([v()],Ae.prototype,"value",null);class v9 extends Eo{constructor(){super([Ae])}onSerialize(i,t){}onDeserialize(i,t){const n=t.target,r=t.path;let o;if(n&&r&&(o=n[r]),(typeof o!="object"||typeof o=="object"&&o.isVolumeParameter!==!0)&&(o=new Ae),typeof i=="object"&&"value"in i){const a=i.value;o.initialize(a),o.overrideState=i.overrideState}else o.value=i;return o}}new v9;var y9=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const b9=Q("debugpost");class Es extends oe{constructor(t=void 0){super();h(this,"active",!0);h(this,"_manager",null);h(this,"_result");h(this,"_postprocessingContext",null);if(t)for(const n of Object.keys(t)){const r=t[n],o=this[n];o instanceof Ae?o.initialize(r):o!==void 0&&(this[n]=r)}}get isPostProcessingEffect(){return!0}onEnable(){this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var t;(t=this._manager)==null||t.removeEffect(this),this.active=!1}onEffectEnabled(t){var n;t&&t.isPostProcessingManager===!0?this._manager=t:this._manager||(this._manager=m9(this)),(n=this._manager)==null||n.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(t){var n;return this._postprocessingContext=t,this._result||(this.initParameters(),this._result=(n=this.onCreateEffect)==null?void 0:n.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){b9&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const n of t){const r=this[n];r instanceof Ae&&r.__init()}}onEditorModification(t){const n=t.propertyName;if(this[n]instanceof Ae){const r=t.value;return this[n].value=r,!0}}}y9([v()],Es.prototype,"active",void 0);var _9=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const w9=Q("debugpost"),Yx={};function oa(s,i){Yx[s]=i}function x9(s){return s.__type in Yx?Yx[s.__type]:(w9&&s.__type&&console.warn("Unknown postprocessing type",s.__type,s),Es)}class Q0{constructor(){h(this,"components",[])}init(){var i;(i=this.components)==null||i.forEach(t=>t.init())}addEffect(i){this.components.push(i)}removeEffect(i){const t=this.components.indexOf(i);t>=0&&this.components.splice(t,1)}}_9([Pm([s=>x9(s),Es])],Q0.prototype,"components",void 0);var C9=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},_R;(function(s){s[s.LOW=0]="LOW",s[s.MEDIUM=1]="MEDIUM",s[s.HIGH=2]="HIGH",s[s.ULTRA=3]="ULTRA"})(_R||(_R={}));class j0 extends Es{constructor(){super(...arguments);h(this,"preset",new Ae(qh.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new pk({preset:qh.HIGH,edgeDetectionMode:AS.DEPTH});return this.preset.onValueChanged=n=>{t.applyPreset(n)},t}}C9([v(Ae)],j0.prototype,"preset",void 0);oa("Antialiasing",j0);const S9=Q("debugusdz");class ju{constructor(){h(this,"files",new Array)}static getName(i){var o;const t=i.split(".").pop();let r=(o=i.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:o.replace(".","_");return r||(r="Audio_"+Math.random().toString(36).substring(2,15)),ol(r)+"."+t}get extensionName(){return"Audio"}onExportObject(i,t,n){const r=j.getComponents(i,kt);if(r.length)for(const o of r){if(!o.clip||typeof o.clip!="string"||!o.playOnAwake)continue;const a=o.clip.split("/").pop()||"Audio",l=ju.getName(o.clip),c=ol(l);if(!this.files.some(u=>u.path===o.clip)){this.files.push({path:o.clip,name:l});const u=l.toLowerCase();n.quickLookCompatible&&!u.endsWith(".mp3")&&!u.endsWith(".wav")&&!u.endsWith(".m4a")&&console.error("Audio file "+o.clip+" from "+o.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}n.quickLookCompatible||t.addEventListener("serialize",(u,d)=>{u.appendLine(),u.beginBlock(`def SpatialAudio "${c}"`,"(",!1),u.appendLine(`displayName = "${a}"`),u.closeBlock(")"),u.beginBlock(),u.appendLine(`uniform asset filePath = @audio/${l}@`),u.appendLine(`uniform token auralMode = "${o.spatialBlend>0?"spatial":"nonSpatial"}"`),u.appendLine(`uniform token playbackMode = "${o.loop?"loopFromStage":"onceFromStart"}"`),u.appendLine(`uniform float gain = ${o.volume}`),u.closeBlock()})}}async onAfterSerialize(i){for(const t of this.files){const n="audio/"+t.name;if(i.files[n]){S9&&console.warn("Audio file with name "+n+" already exists in the context. Skipping.");continue}const a=await(await(await fetch(t.path)).blob()).arrayBuffer(),l=new Uint8Array(a);i.files[n]=l}}}const su=Q("debugautosync"),W_=Symbol("syncerId");class E9{constructor(){h(this,"_syncers",{})}getOrCreateSyncer(i){if(!i.guid)return null;if(this._syncers[i.guid])return this._syncers[i.guid];const t=new I9(i);return t[W_]=i.guid,this._syncers[t[W_]]=t,t}removeSyncer(i){delete this._syncers[i[W_]]}}const nE=new E9;class I9{constructor(i){h(this,"comp");h(this,"hasChanges",!1);h(this,"changedProperties",{});h(this,"data",{});h(this,"_isReceiving",!1);h(this,"_isInit",!1);h(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const i=this.comp.context.connection;if(!i||!i.isConnected||!i.isInRoom){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const n=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=n}i.send(this.networkingKey,this.data,Vo.Queued)});h(this,"onHandleReceiving",i=>{if(su&&console.log("RECEIVE",this.comp.name,this.comp.guid,i),!this._isInit||!this.comp)return;const t=i.guid;if(!(t&&t!==this.comp.guid)){su&&console.log("RECEIVED",this.comp.name,this.comp.guid,i);try{this._isReceiving=!0;for(const n in i){if(n==="guid")continue;const r=i[n];this.comp[n]=r,su&&console.log("SET",n,r)}}catch(n){console.error(n)}finally{this._isReceiving=!1}}});this.comp=i}get networkingKey(){return this.comp.guid}init(i){if(this._isInit)return;this._isInit=!0,this.comp=i,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(i,t){this._isReceiving||(su&&console.log("Property changed: "+i,t),this.hasChanges=!0,this.changedProperties[i]=t)}}function T9(s,i){let t=i!==s;return!t&&s&&i&&(Array.isArray(s)&&Array.isArray(i)||typeof s=="object"&&typeof i=="object")&&(t=!0),t}const mg=Symbol("AutoSyncHandler");function R9(s){if(s[mg])return s[mg];const i=nE.getOrCreateSyncer(s);return i==null||i.init(s),s[mg]=i,i}function B9(s){const i=s[mg];i&&(nE.removeSyncer(i),i.destroy(),delete s[mg])}const e2=function(s){return function(i,t){var d;let n="";typeof t=="string"?n=t:n=t.name;let r=null,o;typeof s=="string"?o=i[s]:typeof s=="function"&&(o=s);const a=i,l=a.__internalAwake;if(typeof l!="function"){(su||be())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((d=i==null?void 0:i.constructor)==null?void 0:d.name)+'" is not supported',i);return}su&&console.log(n);const c=Symbol(n);a.__internalAwake=function(){if(this[c]!==void 0)return;this[c]=this[n],r=nE.getOrCreateSyncer(this);const f=Object.getOwnPropertyDescriptor(this,n);if((f==null?void 0:f.set)===void 0){let p=!1;Object.defineProperty(this,n,{set:function(g){var A;const m=this[c];if(this[c]=g,p){be()&&console.warn("Recursive call detected",n);return}p=!0;try{const y=T9(g,m);su&&console.log("SyncField assignment",n,"changed?",y,g),y&&(o==null?void 0:o.call(this,g,m))!==!1&&((A=R9(this))==null||A.notifyChanged(n,g))}finally{p=!1}},get:function(){return this[c]},configurable:!0,enumerable:!0})}r==null||r.init(this),l.call(this)};const u=a.__internalDestroy;a.__internalDestroy=function(){B9(this),u.call(this)}}};var G0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Ir=Q("debugplayersync");class Gu extends oe{constructor(){super(...arguments);h(this,"autoSync",!0);h(this,"asset");h(this,"onPlayerSpawned");h(this,"_localInstance");h(this,"onJoinedRoom",()=>{Ir&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()});h(this,"destroyInstance",()=>{var t;(t=this._localInstance)==null||t.then(n=>{Ir&&console.log("PlayerSync.destroyInstance",n),C0(n,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(t,n){const r=tt.getOrCreateFromUrl(t);if(!r.asset){const l=await r.loadAssetAsync();j.getOrAddComponent(l,Zn)}const o=new Gu;o._internalInit(n),o.asset=r;const a=new ne;return a.guid=t,j.addComponent(a,o),o}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new ti)}onEnable(){this.context.connection.beginListen(je.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(je.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(je.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(je.LeftRoom,this.destroyInstance)}async getInstance(){var n,r,o,a,l,c;if(this._localInstance)return this._localInstance;if(Ir&&console.log("PlayerSync.createInstance",(n=this.asset)==null?void 0:n.uri),!((r=this.asset)!=null&&r.asset)&&!((o=this.asset)!=null&&o.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(a=this.asset)==null?void 0:a.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const t=await this._localInstance;if(t){const u=j.getComponentsInChildren(t,Zn);if(u!=null&&u.length){for(const d of u)d.owner=this.context.connection.connectionId;(l=this.onPlayerSpawned)==null||l.invoke(t)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((c=this.asset)==null?void 0:c.uri)+"</strong>: please make sure the asset has a PlayerState component!"),j.destroySynced(t)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let n=Zn.all.length-1;n>=0;n--){const r=Zn.all[n];(!r.owner||!this.context.connection.userIsInRoom(r.owner))&&r.doDestroy()}})}}G0([v()],Gu.prototype,"autoSync",void 0);G0([v(tt)],Gu.prototype,"asset",void 0);G0([v(ti)],Gu.prototype,"onPlayerSpawned",void 0);var Kx;(function(s){s.OwnerChanged="ownerChanged"})(Kx||(Kx={}));const An=class extends oe{constructor(){super(...arguments);h(this,"onOwnerChangeEvent",new ti);h(this,"onFirstOwnerChangeEvent",new ti);h(this,"hasOwner",!1);h(this,"owner");h(this,"dontDestroy",!1);h(this,"onUserLeftRoom",t=>{if(t.userId===this.owner){Ir&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return An._all}static get local(){return An._local}static getFor(t){if(t instanceof ne)return j.getComponentInParent(t,An);if(t instanceof oe)return j.getComponentInParent(t.gameObject,An)}static isLocalPlayer(t){const n=An.getFor(t);return(n==null?void 0:n.isLocalPlayer)??!1}static addEventListener(t,n){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(n),n}static removeEventListener(t,n){if(!this._callbacks[t])return;const r=this._callbacks[t].indexOf(n);r>=0&&this._callbacks[t].splice(r,1)}static dispatchEvent(t,n){if(this._callbacks[t])for(const r of this._callbacks[t])r(n)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(t,n){var l,c;Ir&&console.log("PlayerSync.onOwnerChange",this,"newOwner",t,"oldOwner",n);const r=An._local.indexOf(this);r>=0&&An._local.splice(r,1);const o={playerState:this,oldValue:n,newValue:t};if(this.hasOwner||(this.hasOwner=!0,(l=this.onFirstOwnerChangeEvent)==null||l.invoke(o)),(c=this.onOwnerChangeEvent)==null||c.invoke(o),this.owner===this.context.connection.connectionId){An._local.push(this);const u=new CustomEvent("local-owner-changed",{detail:o});this.dispatchEvent(u)}const a=new CustomEvent("owner-changed",{detail:o});this.dispatchEvent(a),An.dispatchEvent(Kx.OwnerChanged,a)}awake(){An.all.push(this),Ir&&console.log("Registered new PlayerState",this.guid,An.all.length-1,An.all),this.context.connection.beginListen(je.UserLeftRoom,this.onUserLeftRoom)}async start(){Ir&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await nc(300),this.context.connection.userIsInRoom(this.owner)==!1&&(Ir&&console.log(`PlayerSync.start â†’ doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(Ir&&console.warn("PlayerState.start â†’ owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?Ir&&console.warn("PlayerState.start â†’ owner is still undefined but dontDestroy is set to true",this.name):(Ir&&console.warn(`PlayerState.start â†’ owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):Ir&&console.log("PlayerState.start â†’ owner is assigned",this.owner)},2e3))}doDestroy(){Ir&&console.log("PlayerSync.doDestroy â†’ syncDestroy",this.name),C0(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(je.UserLeftRoom,this.onUserLeftRoom),An.all.splice(An.all.indexOf(this),1),this.isLocalPlayer){const t=An._local.indexOf(this);t>=0&&An._local.splice(t,1)}}};let Zn=An;h(Zn,"_all",[]),h(Zn,"_local",[]),h(Zn,"_callbacks",{});G0([e2(Zn.prototype.onOwnerChange)],Zn.prototype,"owner",void 0);const P9=Q("debugavatar"),Qo=class extends oe{constructor(){super(...arguments);h(this,"connectionId");h(this,"avatar")}static getAvatar(t){return t>=0&&t<Qo.instances.length?Qo.instances[t]:null}static onAvatarMarkerCreated(t){return Qo._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return Qo._onAvatarMarkerDestroyed.push(t),t}awake(){Qo.instances.push(this),P9&&console.log(this);for(const t of Qo._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){Qo.instances.splice(Qo.instances.indexOf(this),1);for(const t of Qo._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let _n=Qo;h(_n,"instances",[]),h(_n,"_onNewAvatarMarkerAdded",[]),h(_n,"_onAvatarMarkerDestroyed",[]);var M9=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Td=Q("debugxrflags"),t2=Q("disablexrflags");t2&&console.warn("XRFlags are disabled");var go;(function(s){s[s.Never=0]="Never",s[s.Browser=1]="Browser",s[s.AR=2]="AR",s[s.VR=4]="VR",s[s.FirstPerson=8]="FirstPerson",s[s.ThirdPerson=16]="ThirdPerson",s[s.All=4294967295]="All"})(go||(go={}));const s1=class{constructor(){h(this,"Mask",go.Browser|go.ThirdPerson)}Has(i){return(this.Mask&i)!==0}Set(i){Td&&console.warn("Set XR flag state to",i),this.Mask=i,Kn.Apply()}Enable(i){this.Mask|=i,Kn.Apply()}Disable(i){this.Mask&=~i,Kn.Apply()}Toggle(i){this.Mask^=i,Kn.Apply()}EnableAll(){this.Mask=-1,Kn.Apply()}DisableAll(){this.Mask=0,Kn.Apply()}};let bs=s1;h(bs,"Global",new s1);const Sa=class extends oe{constructor(){super(...arguments);h(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(bs.Global)}awake(){Sa.registry.push(this)}onEnable(){Sa.firstApply?this.UpdateVisible(bs.Global):(Sa.firstApply=!0,Sa.Apply())}onDestroy(){const t=Sa.registry.indexOf(this);t>=0&&Sa.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){if(t2)return;let n;const r=t;if(r&&typeof r=="number"&&(console.assert(typeof r=="number","XRFlag.UpdateVisible: state must be a number",r),Td&&console.log(r),Sa.buffer.Mask=r,t=Sa.buffer),t instanceof bs?(Td&&console.warn(this.name,"use passed in mask",t.Mask,this.visibleIn),n=t.Has(this.visibleIn)):(Td&&console.log(this.name,"use global mask"),bs.Global.Has(this.visibleIn)),n!==void 0)if(n)Td&&console.log(this.name,"is visible",this.gameObject.uuid),j.setActive(this.gameObject,!0);else{if(Td&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let Kn=Sa;h(Kn,"registry",[]),h(Kn,"firstApply"),h(Kn,"buffer",new bs);M9([v()],Kn.prototype,"visibleIn",void 0);var sE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Sp=Q("debugwebxr"),wR=new se().setFromAxisAngle(new x(0,1,0),Math.PI);class Eu extends oe{constructor(){super(...arguments);h(this,"head");h(this,"leftHand");h(this,"rightHand");h(this,"_leftHandMeshes");h(this,"_rightHandMeshes");h(this,"_syncTransforms")}async onEnterXR(t){if(!this.activeAndEnabled)return;Sp&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const n=Zn.getFor(this);if(n!=null&&n.owner){const r=this.gameObject.addComponent(_n);r.avatar=this.gameObject,r.connectionId=n.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):n&&!this.context.connection.isConnected&&(n.dontDestroy=!0)}onLeaveXR(t){const n=this.gameObject.getComponent(_n);n&&n.destroy()}onUpdateXR(t){var u,d;if(!this.activeAndEnabled)return;const n=Zn.isLocalPlayer(this);if(!n)return;const r=t.xr;if(r.rig&&r.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),r.rig.gameObject.add(this.gameObject)),this._syncTransforms&&n)for(const f of this._syncTransforms)f.fastMode=!0,f.isOwned()||f.requestOwnership();if(this.head&&this.context.mainCamera){const f=this.head.asset;if(f.position.copy(this.context.mainCamera.position),f.position.x*=-1,f.position.z*=-1,f.quaternion.copy(this.context.mainCamera.quaternion),f.quaternion.x*=-1,this.context.time.frameCount%10===0){const p=j.getComponentsInChildren(this.head.asset,Kn);for(const g of p)g.enabled=!1,g.gameObject.visible=!1}}const o=t.xr.leftController,a=(u=this.leftHand)==null?void 0:u.asset;o&&a?(a.position.copy(o.gripPosition),a.quaternion.copy(o.gripQuaternion),a.quaternion.multiply(wR),a.visible=o.isTracking,this.updateHandVisibility(o,a,this._leftHandMeshes)):a&&a.visible&&(a.visible=!1);const l=t.xr.rightController,c=(d=this.rightHand)==null?void 0:d.asset;l&&c?(c.position.copy(l.gripPosition),c.quaternion.copy(l.gripQuaternion),c.quaternion.multiply(wR),c.visible=l.isTracking,this.updateHandVisibility(l,c,this._rightHandMeshes)):c&&c.visible&&(c.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(t,n,r){if(r){const o=t.model&&t.model.visible&&t.model!==n;r.forEach(a=>{Gc(a,!o)})}}updateRemoteAvatarVisibility(){var t,n,r;if(this.context.connection.isConnected){const o=Zn.getFor(this);if(o&&o.isLocalPlayer==!1){const a=Fe.getXRSync(this.context);if(a&&a.hasState(o.owner)){this.tryFindAvatarObjectsIfMissing();const l=(t=this.leftHand)==null?void 0:t.asset;l&&(l.visible=(a==null?void 0:a.isTracking(o.owner,"left"))??!1);const c=(n=this.rightHand)==null?void 0:n.asset;c&&(c.visible=(a==null?void 0:a.isTracking(o.owner,"right"))??!1)}if((r=this.head)!=null&&r.asset){const l=j.getComponentsInChildren(this.head.asset,Kn);for(const c of l)c.enabled=!1,c.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const t={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};u5.tryFindAvatarObjects(this.gameObject,this.sourceId||"",t),t.head&&(this.head=t.head),t.leftHand&&(this.leftHand=t.leftHand),t.rightHand&&(this.rightHand=t.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ne&&(this.head=new tt("",this.sourceId,this.head));else{const t=new ne;t.name="Head";const n=Uu.createPrimitive(Ko.Cube);t.add(n),this.gameObject.add(t),this.head=new tt("",this.sourceId,t),Sp&&console.log("Create head",t)}if(this.rightHand)this.rightHand instanceof ne&&(this.rightHand=new tt("",this.sourceId,this.rightHand));else{const t=new ne;t.name="Right Hand",this.gameObject.add(t),this.rightHand=new tt("",this.sourceId,t),Sp&&console.log("Create right hand",t)}if(this.leftHand)this.leftHand instanceof ne&&(this.leftHand=new tt("",this.sourceId,this.leftHand));else{const t=new ne;t.name="Left Hand",this.gameObject.add(t),this.leftHand=new tt("",this.sourceId,t),Sp&&console.log("Create left hand",t)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._leftHandMeshes.push(t)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._rightHandMeshes.push(t)}),Zn.isLocalPlayer(this.gameObject)&&(this._syncTransforms=j.getComponentsInChildren(this.gameObject,rc))}async loadAvatarObjects(t,n,r){const o=t.loadAssetAsync(),a=n.loadAssetAsync(),l=r.loadAssetAsync(),c=new Array;o&&c.push(o),a&&c.push(a),l&&c.push(l);const u=await NC(c);Sp&&console.log("Avatar loaded results:",u)}}sE([v(tt)],Eu.prototype,"head",void 0);sE([v(tt)],Eu.prototype,"leftHand",void 0);sE([v(tt)],Eu.prototype,"rightHand",void 0);class Kl{static Add(i,t,n=null){if(t){for(const r of this.Pois)if(r.obj===t)return;this.Pois.push({obj:t,avatar:n}),this.LastChangeTime=i.time.time}}static Remove(i,t){var n;if(t){for(const r of this.Pois)if(r.obj===t){this.Pois.splice(this.Pois.indexOf(r),1),this.LastChangeTime=(i==null?void 0:i.time.time)??((n=Ge.Current)==null?void 0:n.time.time);return}}}}h(Kl,"Pois",[]),h(Kl,"LastChangeTime",0);var _y;(function(s){s.TargetChanged="avatar-look-target-changed"})(_y||(_y={}));class k9{constructor(){h(this,"guid");h(this,"position",new x)}}class wy extends oe{constructor(){super(...arguments);h(this,"target",null);h(this,"avatar",null);h(this,"_model",null);h(this,"_targetModel",new k9);h(this,"_currentTargetObject",null);h(this,"_lastUpdateTime",0);h(this,"_lookDuration",0);h(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const n=O.get("MoveRandom");if(n&&this.target){const r=j.getComponent(this.target,n);r&&r.destroy()}}awake(){if(this.avatar=j.getComponentInParent(this.gameObject,_n),this.avatar){const t=j.getComponentInParent(this.gameObject,_n);this._model=new LD(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(_y.TargetChanged,t=>{var n;this.target&&t&&t.guid===((n=this.avatar)==null?void 0:n.guid)&&Sn(this.target,t.position)})}update(){var n;if((!this.context.connection.isConnected||(n=this._model)!=null&&n.hasOwnership)&&(Kl.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Kl.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const r=Ve(this._currentTargetObject);Sn(this.target,r),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(_y.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(r))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const n=Kl.Pois;if(n.length>0){const r=n[Math.floor(Math.random()*n.length)];if(r&&r.obj){if(r.avatar&&r.avatar===this.avatar)return;this._currentTargetObject=r.obj}}}}}const Di=Q("debugnetworkingstreams");var Bi;(function(s){s.Connected="peer-user-connected",s.StreamReceived="receive-stream",s.StreamEnded="call-ended",s.Disconnected="peer-user-disconnected",s.UserJoined="user-joined"})(Bi||(Bi={}));class i2{constructor(i,t){h(this,"type",Bi.StreamEnded);h(this,"userId");h(this,"direction");this.userId=i,this.direction=t}}class D9{constructor(i,t,n){h(this,"type",Bi.StreamReceived);h(this,"userId");h(this,"stream");h(this,"target");this.userId=i,this.stream=t,this.target=n}}class O9{constructor(i,t){h(this,"guid");h(this,"peerId");h(this,"dontSave",!0);this.guid=i.id,this.peerId=t}}var Ql;(function(s){s.Incoming="incoming",s.Outgoing="outgoing"})(Ql||(Ql={}));class L9 extends cc{constructor(t,n,r,o=null){super();h(this,"peerId");h(this,"userId");h(this,"direction");h(this,"call");h(this,"_stream",null);h(this,"_isDisposed",!1);this.peerId=n.peer,this.userId=t,this.call=n,this.direction=r,this._stream=o,n.on("stream",a=>{if(Di&&console.log("Receive stream",`
Audio:`,a.getAudioTracks(),`
Video:`,a.getVideoTracks()),this._stream=a,r===Ql.Incoming){const l=new D9(t,a,this);this.dispatchEvent(l)}}),n.on("close",()=>{this.dispatchEvent(new i2(t,r))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Hl(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function xR(s){return s=s.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),s}const Jd=class extends cc{constructor(t,n){super();h(this,"updateCalls",()=>{var t;for(let n=this._incomingCalls.length-1;n>=0;n--){const r=this._incomingCalls[n];r.isClosed&&!r.isOpening&&this._incomingCalls.splice(n,1)}for(let n=this._outgoingCalls.length-1;n>=0;n--){const r=this._outgoingCalls[n];let o=!1;r.isClosed&&!r.isOpening&&((t=r.stream)!=null&&t.active?Di&&console.warn("!!! Stream is still active, don't remove call",r.userId,"Your id: "+this.context.connection.connectionId):(Di&&console.warn("!!! Remove closed call",r.userId),o=!0)),this.context.connection.userIsInRoom(r.userId)===!1&&(Di&&console.warn("!!! User is not in room anymore, remove call",r.userId),o=!0),o&&(r.close(),this._outgoingCalls.splice(n,1))}});h(this,"id");h(this,"context");h(this,"_incomingCalls",[]);h(this,"_outgoingCalls",[]);h(this,"_peer");h(this,"_enabled",!1);h(this,"_enabledPeer",!1);h(this,"onConnectRoomFn",this.onConnectRoom.bind(this));h(this,"onPeerConnect",t=>{if(Di&&console.log("PEER opened as",t),t===null){console.error("Peer connection failed",t);return}this.context.connection.send(Bi.Connected,new O9(this,t))});h(this,"onPeerClose",()=>{Di&&console.log("PEER closed"),this.updateCalls()});h(this,"onPeerDisconnected",()=>{Di&&console.log("PEER disconnected"),this.updateCalls()});h(this,"onPeerError",t=>{Di&&console.error("PEER error",t)});h(this,"onPeerReceivingCall",t=>{t.answer(void 0,{sdpTransform:n=>xR(n)}),this.registerCall(t,Ql.Incoming,null)});this.context=t,this.id=n,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,n){if(Jd.instances.has(n))return Jd.instances.get(n);const r=new Jd(t,n);return Jd.instances.set(n,r),r}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,n){var a;if(!(n!=null&&n.id)){Di?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const r={metadata:{userId:this.context.connection.connectionId,streamId:n.id},sdpTransform:l=>xR(l)},o=(a=this._peer)==null?void 0:a.call(t,n,r);if(o){const l=this.registerCall(o,Ql.Outgoing,n);return Di&&console.warn(`ðŸ“ž CALL ${t}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),l}else Di&&console.error("Failed to make call",t,n,this._peer)}closeAll(){for(const t of this._incomingCalls)t.close();for(const t of this._outgoingCalls)t.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(je.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(je.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=q8(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(t,n,r){const o=t.metadata;(!o||!o.userId)&&console.error("Missing call metadata",t);const a=o.userId;n===Ql.Incoming&&Di?console.warn("â† Receive call from",t.metadata,t.connectionId):Di&&console.warn("â†’ Make call to",t.metadata);const l=n===Ql.Incoming?this._incomingCalls:this._outgoingCalls,c=new L9(a,t,n,r);return l.push(c),t.on("error",u=>{console.error("Call error",u)}),t.on("close",()=>{Di&&console.log("Call ended",t.metadata);const u=l.indexOf(c);u!==-1&&l.splice(u,1),c.close(),this.dispatchEvent(new i2(a,n))}),c.addEventListener(Bi.StreamEnded,u=>{this.dispatchEvent(u)}),n===Ql.Incoming&&(c.addEventListener(Bi.StreamReceived,u=>{this.dispatchEvent(u)}),t.on("stream",()=>{Di&&console.log("Received stream for call",t.metadata);let u=0;const d=setInterval(()=>{const f=u===0;!c.isOpen&&f&&(Di&&console.warn("Close call because stream is not active",t.metadata),u+=1,clearInterval(d),c.close())},2e3)})),c}};let Ag=Jd;h(Ag,"instances",new Map);class H0 extends cc{constructor(t,n){super();h(this,"context");h(this,"peer");h(this,"_sendingStreams",new Map);h(this,"debug",!1);h(this,"_enabled",!1);h(this,"_tickIntervalId");h(this,"tick",()=>{this.updateSendingCalls()});h(this,"onJoinedRoom",t=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${t!=null&&t.userId?`User ${t.userId}`:"You"} joined room`,t,this._sendingStreams.size),this.updateSendingCalls())});h(this,"onLeftRoom",t=>{this.debug&&console.warn(`${(t==null?void 0:t.userId)||"You"} left room`,t),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()});h(this,"onCallStreamReceived",t=>{this.debug&&console.log("Call with "+t.userId+" started"),this.dispatchEvent({type:Bi.StreamReceived,target:this,stream:t.stream,userId:t.userId}),this.debug&&this.debugLogCurrentState()});h(this,"onCallEnded",t=>{this.debug&&console.log("Call with "+t.userId+" ended"),this.dispatchEvent(t),this.debug&&this.debugLogCurrentState()});h(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("PEER USER CONNECTED",t.guid,t,this._sendingStreams.size);const n=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,n)}else Di&&console.log("Unknown user connected",t.guid,t.peerId)});h(this,"onUserLeft",t=>{this.debug&&console.log("User left room: "+t.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()});this.context=t,this.peer=n,Di&&(this.debug=!0)}static create(t,n){const r=Ag.getOrCreate(t.context,n||t.context.connection.connectionId||t.guid);return new H0(t.context,r)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const n=this._sendingStreams.get(t);if(n){for(const r of n)r.close();n.length=0}this._sendingStreams.delete(t),n&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener(Bi.StreamReceived,this.onCallStreamReceived),this.peer.addEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Bi.Connected,this.onUserConnected),this.context.connection.beginListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(je.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(je.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(je.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener(Bi.StreamReceived,this.onCallStreamReceived),this.peer.removeEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Bi.Connected,this.onUserConnected),this.context.connection.stopListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(je.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(je.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(je.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const t=this.context.connection.connectionId;for(const n of this._sendingStreams.keys()){const r=this._sendingStreams.get(n)||[];for(const o of this.context.connection.usersInRoom()){if(o===t)continue;const a=this.peer.getPeerIdFromUserId(o);if(r.find(c=>{var u;return c.peerId===a&&c.direction===Ql.Outgoing&&!c.isClosed&&((u=c.stream)==null?void 0:u.active)}))Di&&console.debug("Already have a call with user "+o+" / peer "+a);else{const c=this.peer.makeCall(a,n);c&&r.push(c)}}this._sendingStreams.set(n,r)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const n=this._sendingStreams.get(t);if(n)for(let r=n.length-1;r>=0;r--){const o=n[r];this.context.connection.userIsInRoom(o.userId)?Di&&(this.context.connection.connectionId===o.userId?console.warn(`You are still in the room [${r}] ${o.userId}`):console.log(`User is still in room [${r}] ${o.userId}`)):(Di&&console.log(`Remove call ${[r]} to user that is not in room anymore ${o.userId}`),o.close(),n.splice(r,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(t=>t.userId).join(", ")})`,this.peer.incomingCalls)}}function Hl(s){if(s&&s instanceof MediaStream)for(const i of s.getTracks())i.stop()}var rE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const F9="noVoip",U9=Q("debugvoip");class Hu extends oe{constructor(){super(...arguments);h(this,"autoConnect",!0);h(this,"runInBackground",!0);h(this,"createMenuButton",!0);h(this,"debug",!1);h(this,"_net");h(this,"_menubutton");h(this,"_allowSending",!0);h(this,"_outputStream",null);h(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await nc(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()});h(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const t of this._incomingStreams.values())Hl(t.srcObject);this._incomingStreams.clear()});h(this,"_incomingStreams",new Map);h(this,"onReceiveStream",t=>{const n=t.target.userId,r=t.stream;let o=this._incomingStreams.get(n);o||(o=new Audio,this._incomingStreams.set(n,o)),o.srcObject=r,o.setAttribute("autoplay","true"),Ja.registerWaitForInteraction(()=>{o==null||o.play().catch(a=>{console.error("VOIP: Failed to play audio",a)})})});h(this,"onStreamEnded",t=>{const n=this._incomingStreams.get(t.userId);Hl(n==null?void 0:n.srcObject),this._incomingStreams.delete(t.userId)});h(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const n=t[1];n.muted=!this.enabled}});h(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const n=!(document.visibilityState==="visible");this.setMuted(n);for(const r of this._incomingStreams){const o=r[1];o.muted=n}})}awake(){U9&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async t=>{switch(t.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=H0.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Bi.StreamReceived,this.onReceiveStream),this._net.addEventListener(Bi.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(je.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Bi.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Bi.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable()),this.context.connection.stopListen(je.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(je.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var t;(t=this._menubutton)==null||t.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){var n,r;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await lA())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(n=this._net)==null||n.stopSendingStream(this._outputStream),Hl(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(r=this._net)==null||r.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await lA()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):dS("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||be())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(t){var n;t!=null&&t.remember&&(this._allowSending=!1),(n=this._net)==null||n.stopSendingStream(this._outputStream),Hl(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(t){var r;const n=(r=this._outputStream)==null?void 0:r.getAudioTracks();if(n)for(const o of n)o.enabled=!t}get isMuted(){var n;if(this._outputStream===null)return!1;const t=(n=this._outputStream)==null?void 0:n.getAudioTracks();if(t){for(const r of t)if(!r.enabled)return!0}return!1}async updateButton(){var t;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),lA().then(n=>{n||Xt("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let n=(this.isSending,""),r=this.isSending?"mic":"mic_off";await lA()||(n="No Permission",r="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=n,this._menubutton.prepend(ys(r)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(t=this._menubutton)==null||t.remove()}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,be()&&Xt("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:t??!0,video:!1}).catch(r=>(console.warn("VOIP failed getting audio stream",r),null)):(console.error("No getDisplayMedia support"),null)}}rE([v()],Hu.prototype,"autoConnect",void 0);rE([v()],Hu.prototype,"runInBackground",void 0);rE([v()],Hu.prototype,"createMenuButton",void 0);var n2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const N9=Q("debugmouth");class V0 extends oe{constructor(){super(...arguments);h(this,"idle",[]);h(this,"talking",[]);h(this,"marker",null);h(this,"voip",null);h(this,"lastMouthChangeTime",0);h(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=j.findObjectOfType(Hu,this.context),this.marker||(this.marker=j.getComponentInParent(this.gameObject,_n))},3e3)}update(){var r;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((r=this.marker)==null?void 0:r.connectionId)??null;if(!t){N9&&(t=null);return}const n=this.voip.getFrequency(t)??0;this.updateLips(n)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,n)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,n)}}}setMouthShapeActive(t,n){if(t){t!=this.idle?this.idle.map(r=>r.visible=!1):this.talking.map(r=>r.visible=!1);for(let r=0;r<t.length;r++){const o=t[r];o&&(o.visible=r===n)}}}}n2([v(ne)],V0.prototype,"idle",void 0);n2([v(ne)],V0.prototype,"talking",void 0);class s2 extends oe{constructor(){super(...arguments);h(this,"voip",null);h(this,"marker",null);h(this,"_startPosition",null)}awake(){this.voip=j.findObjectOfType(Hu,this.context),this.marker=j.getComponentInParent(this.gameObject,_n)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,n=this.voip.getFrequency(t);if(n==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const r=n/100;this.gameObject.position.y=this._startPosition.y+r*.07}}var W0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Gf extends oe{constructor(){super(...arguments);h(this,"eyes",[]);h(this,"lastBlinkTime",0);h(this,"blinkLength",0);h(this,"eyesOpen",!0);h(this,"state",null)}awake(){this.state=j.getComponentInParent(this.gameObject,Kn)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const n of this.eyes)n&&(n.visible=this.eyesOpen)}}}W0([v(ne)],Gf.prototype,"eyes",void 0);W0([v()],Gf.prototype,"lastBlinkTime",void 0);W0([v()],Gf.prototype,"blinkLength",void 0);W0([v()],Gf.prototype,"eyesOpen",void 0);var oE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const r1=class extends oe{constructor(){super(...arguments);h(this,"head",null);h(this,"eyes",null);h(this,"target",null);h(this,"brain",null);h(this,"vec",new x);h(this,"currentTargetPoint",new x)}awake(){this.brain||(this.brain=j.getComponentInParent(this.gameObject,wy)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=j.addNewComponent(this.gameObject,wy)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const t=this.target;if(t&&this.head){const n=this.eyes;if(n){const r=Ve(t);this.currentTargetPoint.lerp(r,this.context.time.deltaTime/.1);const o=Ve(this.head),a=this.vec.copy(this.currentTargetPoint).sub(o).normalize();if(a.length()<.1)return;const l=r1.forward;if(l.set(0,0,1),l.applyQuaternion(Ht(this.head)),l.dot(a)>.45)for(let u=0;u<n.length;u++)n[u].lookAt(this.currentTargetPoint)}}}};let sh=r1;h(sh,"forward",new x(0,0,1));oE([v(ne)],sh.prototype,"head",void 0);oE([v(ne)],sh.prototype,"eyes",void 0);oE([v(ne)],sh.prototype,"target",void 0);const Ep=Q("debugavatar");class aE{constructor(i,t,n,r){h(this,"root");h(this,"head");h(this,"leftHand");h(this,"rigthHand");var o;this.root=i,this.head=t,this.leftHand=n,this.rigthHand=r,(o=this.root)==null||o.traverse(a=>a.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class r2{constructor(){h(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(i,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let n=null;if(typeof t=="string"){if(n=await this.loadAvatar(i,t),!n){const o=new ll;n=j.instantiate(jg(t,i.scene),o)}}else n=t;if(!n)return null;const r=this.findAvatar(n);return r.isValid?(Ep&&console.log("[Custom Avatar] valid config",t,Ep?r:""),r):(console.warn("[Custom Avatar] config isn't valid",t,Ep?r:""),null)}async loadAvatar(i,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(Ep&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const r=await fetch("./"+t);let o=null;if(r.ok){const l=await r.blob();l&&(o=await l.arrayBuffer())}if(!o&&(o=await gO(t,t,0,"no url here go away",!0),!o))return null;const a=await nl().parseSync(i,o,null,0);return(a==null?void 0:a.scene)??null}const n=new rl;return k0(n,i),new Promise((r,o)=>{const a=this.avatarRegistryUrl+"/"+t;n.load(a,async l=>{await nl().createBuiltinComponents(i,a,l,null,void 0),r(l.scene)},l=>{Ep&&console.log("[Custom Avatar] "+l.loaded/l.total*100+"% loaded of "+l.total/1024+"kB")},l=>{console.error("[Custom Avatar] Error when loading: "+l),r(null)})})}cacheModel(i,t){}findAvatar(i){const t=i;let n=t;n.children.length==1&&(n=i.children[0]);let r=this.findAvatarPart(n,["head"]);const o=this.findAvatarPart(n,["left","hand"]),a=this.findAvatarPart(n,["right","hand"]);if(!r){r=t;const c=new x;new Cn().setFromObject(r).getSize(c);const u=Math.max(c.x,c.y,c.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+u+" meters! Should be < 0.3m"),u>.3&&r.scale.multiplyScalar(1/u*.3)}return new aE(t,r,o,a)}findAvatarPart(i,t){const n=i.name.toLowerCase();let r=!0;for(const o of t){if(!r)break;n.indexOf(o)===-1&&(r=!1)}if(r)return i;if(i.children)for(const o of i.children){const a=this.findAvatarPart(o,t);if(a)return a}return null}handleCustomAvatarErrors(i){if(!i.ok)throw Error(i.statusText);return i}}var lE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Lm extends oe{constructor(){super(...arguments);h(this,"length",1);h(this,"depthTest",!0);h(this,"isGizmo",!1);h(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Em)return;this._axes||(this._axes=new dr(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}lE([v()],Lm.prototype,"length",void 0);lE([v()],Lm.prototype,"depthTest",void 0);lE([v()],Lm.prototype,"isGizmo",void 0);class o2 extends oe{constructor(){super(...arguments);h(this,"from");h(this,"to");h(this,"hint");h(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=Ve(this.to).clone(),n=Ve(this.from).clone(),r=t.distanceTo(n),o=t.clone();o.sub(n);const a=n.clone();a.add(t),a.multiplyScalar(.5);const l=Ve(this.hint).clone();l.sub(a);const c=new x;c.crossVectors(l,o),c.crossVectors(o,c),c.normalize();const u=r*.5,d=Math.max(this.desiredDistance,u),f=Math.sqrt(d*d-u*u),p=c.clone();p.multiplyScalar(f),p.add(a),Sn(this.gameObject,p);const g=a.clone();g.sub(c),this.gameObject.lookAt(g)}}const q_=Q("debugusdzbehaviours");class cE{constructor(){h(this,"behaviours",[]);h(this,"behaviourComponents",[]);h(this,"behaviourComponentsCopy",[]);h(this,"audioClips",[]);h(this,"audioClipsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(i){this.behaviours.push(i)}addAudioClip(i){if(!i||typeof i!="string")return"";const n="audio/"+ju.getName(i);return this.audioClips.push({clipUrl:i,filesKey:n}),n}onBeforeBuildDocument(i){if(!i.root)return Promise.resolve();const t=[];return i.root.traverse(n=>{j.foreachComponent(n,r=>{var a;const o=r;if(typeof o.createBehaviours=="function"||typeof o.beforeCreateDocument=="function"||typeof o.afterCreateDocument=="function"||typeof o.afterSerialize=="function"){this.behaviourComponents.push(o);const l=(a=o.beforeCreateDocument)==null?void 0:a.call(o,this,i);l instanceof Promise&&t.push(l)}},!1)}),q_&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(t)}onExportObject(i,t,n){var r;for(const o of this.behaviourComponents)q_&&console.log("onExportObject: createBehaviours",o),(r=o.createBehaviours)==null||r.call(o,this,t,n)}onAfterBuildDocument(i){for(const t of this.behaviourComponents)typeof t.afterCreateDocument=="function"&&t.afterCreateDocument(this,i);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0}onAfterHierarchy(i,t){var n;if((n=this.behaviours)!=null&&n.length){t.beginBlock('def Scope "Behaviors"');for(const r of this.behaviours)r.writeTo(this,i.document,t);t.closeBlock()}}async onAfterSerialize(i){q_&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,i):t.afterSerialize(this,i));for(const{clipUrl:t,filesKey:n}of this.audioClipsCopy){if(i.files[n])return;const a=await(await(await fetch(t)).blob()).arrayBuffer(),l=new Uint8Array(a);i.files[n]=l}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var hE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const o1=class extends Es{constructor(){super(...arguments);h(this,"threshold",new Ae(.9));h(this,"intensity",new Ae(1));h(this,"scatter",new Ae(.3));h(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>t}onCreateEffect(){let t;if(this.selectiveBloom==null&&(this.selectiveBloom=o1.useSelectiveBloom),this.selectiveBloom){const n=t=new fk(this.context.scene,this.context.mainCamera,{blendFunction:Ze.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});n.inverted=!0}else t=new mS({blendFunction:Ze.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=n=>{t.intensity=n},this.threshold.onValueChanged=n=>{t.luminanceMaterial.threshold=Math.pow(n,2.2)},this.scatter.onValueChanged=n=>{t.luminancePass.enabled=!0,t.luminanceMaterial.smoothing=n,t.mipmapBlurPass&&(t.mipmapBlurPass.radius=ct.lerp(.1,.9,n))},t}};let Jl=o1;h(Jl,"useSelectiveBloom",!1);hE([v(Ae)],Jl.prototype,"threshold",void 0);hE([v(Ae)],Jl.prototype,"intensity",void 0);hE([v(Ae)],Jl.prototype,"scatter",void 0);oa("Bloom",Jl);var gr=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Io extends oe{constructor(){super(...arguments);h(this,"attachedRigidbody",null);h(this,"isTrigger",!1);h(this,"sharedMaterial");h(this,"membership",[0]);h(this,"filter");h(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}updatePhysicsMaterial(){var t;(t=this.context.physics.engine)==null||t.updatePhysicsMaterial(this)}}gr([v(It)],Io.prototype,"attachedRigidbody",void 0);gr([v()],Io.prototype,"isTrigger",void 0);gr([v()],Io.prototype,"sharedMaterial",void 0);gr([v()],Io.prototype,"membership",void 0);gr([v()],Io.prototype,"filter",void 0);class Fm extends Io{constructor(){super(...arguments);h(this,"radius",.5);h(this,"center",new x(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this),FC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),WP(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}gr([Ss(),v()],Fm.prototype,"radius",void 0);gr([v(x)],Fm.prototype,"center",void 0);class Vu extends Io{constructor(){super(...arguments);h(this,"size",new x(1,1,1));h(this,"center",new x(0,0,0))}static add(t,n){const r=new Vu;t.geometry.boundingBox||t.geometry.computeBoundingBox();const o=t.geometry.boundingBox;return r.size=o.getSize(new x)||new x(1,1,1),r.center=o.getCenter(new x)||new x(0,0,0),vo(t,r),(n==null?void 0:n.rigidbody)===!0&&vo(t,It,{isKinematic:!1}),r}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addBoxCollider(this,this.size),FC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),WP(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}gr([Ss(),v(x)],Vu.prototype,"size",void 0);gr([v(x)],Vu.prototype,"center",void 0);class Hf extends Io{constructor(){super(...arguments);h(this,"sharedMesh");h(this,"convex",!1)}onEnable(){var n,r,o;if(super.onEnable(),!this.context.physics.engine)return;(n=this.sharedMesh)!=null&&n.isMesh||this.gameObject instanceof Z&&(this.sharedMesh=this.gameObject);const t=0;if((r=this.sharedMesh)!=null&&r.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,oi(this.gameObject)),pt.assignMeshLOD(this.sharedMesh,t).then(a=>{a&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=a,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,oi(this.gameObject)))});else{const a=this.sharedMesh;if(a!=null&&a.isGroup){console.warn(`MeshCollider mesh is a group "${((o=this.sharedMesh)==null?void 0:o.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const l=new Array;for(const c in a.children){const u=a.children[c];u.isMesh&&(this.context.physics.engine.addMeshCollider(this,u,this.convex,oi(this.gameObject)),l.push(pt.assignMeshLOD(u,t)))}Promise.all(l).then(c=>{var d,f;if(c.some(p=>p)==!1)return;(d=this.context.physics.engine)==null||d.removeBody(this);const u=new Z;for(const p of c)p&&this.activeAndEnabled&&(u.geometry=p,(f=this.context.physics.engine)==null||f.addMeshCollider(this,u,this.convex,oi(this.gameObject)))})}}}}gr([v(Z)],Hf.prototype,"sharedMesh",void 0);gr([v()],Hf.prototype,"convex",void 0);class dh extends Io{constructor(){super(...arguments);h(this,"center",new x(0,0,0));h(this,"radius",.5);h(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.height,this.radius)}}gr([v(x)],dh.prototype,"center",void 0);gr([v()],dh.prototype,"radius",void 0);gr([v()],dh.prototype,"height",void 0);var uE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Vf extends oe{constructor(){super(...arguments);h(this,"objectBounds",!1);h(this,"color");h(this,"isGizmo",!0);h(this,"_gizmoObject",null);h(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!Em||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new UP(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=PS(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),qe.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}uE([v()],Vf.prototype,"objectBounds",void 0);uE([v(xe)],Vf.prototype,"color",void 0);uE([v()],Vf.prototype,"isGizmo",void 0);const z9=Q("gizmos"),Q9=Q("debugboxhelper"),so=class extends oe{constructor(){super(...arguments);h(this,"box",null);h(this,"_lastMatrixUpdateFrame",-1);h(this,"_helper",null);h(this,"_color",null)}isInBox(t,n){var o;if(!t)return;if(this.box||(this.box=new Cn),t.type==="Mesh")so.testBox.setFromObject(t);else if(t.type==="Group"){if(so.testBox.makeEmpty(),t.children.length>0)for(let a=0;a<t.children.length;a++)t.children[a].type==="Mesh"&&so.testBox.expandByObject(t)}else{const a=Ve(t,so._position),l=oi(t,so._size);n!==void 0&&l.multiplyScalar(n),so.testBox.setFromCenterAndSize(a,l)}this.updateBox();const r=(o=this.box)==null?void 0:o.intersectsBox(so.testBox);return r&&Q9&&Pe.DrawWireBox3(so.testBox,16711680,5),r}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new Cn),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const n=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const r=n,o=Ve(this.gameObject,so._position,r),a=oi(this.gameObject,so._size);this.box.setFromCenterAndSize(o,a)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,n=!1){var r;if(!(!z9&&!n)){if(this._helper){t&&((r=this._color)==null||r.set(t)),this.gameObject.add(this._helper);return}this._helper=PS(t),this.gameObject.add(this._helper)}}};let Xo=so;h(Xo,"testBox",new Cn),h(Xo,"_position",new x),h(Xo,"_size",new x(.01,.01,.01));class j9 extends NM{constructor(i,t={}){super(i),i._simpleState__activeStates=[],i._simpleState__normalStyles={},i._simpleState__states=t,i._simpleState__statesProperties={};for(const n in t)for(const r in t[n])i._simpleState__statesProperties[r]||(i._simpleState__statesProperties[r]=[]),i._simpleState__statesProperties[r].push(n);for(const n of i._components)i._simpleState__statesProperties[n.id]&&(i._simpleState__normalStyles[n.id]=n.inline?n.inline:n._value);i.__overridedSet=i.set,i.set=this.storeSet.bind(i),i.renderStates=this.renderStates.bind(i),i.setupState=this.setupState.bind(i),i.setState=this.setState.bind(i),i.activatePseudoState=this.activatePseudoState.bind(i),i.deactivatePseudoState=this.deactivatePseudoState.bind(i),i.togglePseudoState=this.togglePseudoState.bind(i)}act(){}attach(){}detach(){}setupState(i,t){this._simpleState__states[i]=t;const n=[];for(const r in t)this._simpleState__statesProperties[r]||(this._simpleState__statesProperties[r]=[],n.push(r)),this._simpleState__statesProperties[r].push(i);for(const r of this._components)n.indexOf(r.id)>-1&&(this._simpleState__normalStyles[r.id]=r.inline?r.inline:r._value)}renderStates(){let i={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(i={...i,...this._simpleState__states[t]});this.set(i,!1)}storeSet(i,t=!0){if(t)for(const n in i)this._simpleState__statesProperties[n]&&(this._simpleState__normalStyles[n]=i[n]);this.__overridedSet(i)}activatePseudoState(i){this._simpleState__activeStates.indexOf(i)===-1&&(this._simpleState__activeStates.push(i),this.renderStates())}deactivatePseudoState(i){const t=this._simpleState__activeStates.indexOf(i);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(i){const t=this._simpleState__activeStates.indexOf(i);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(i),this.renderStates()}setState(i){Array.isArray(i)?this._simpleState__activeStates=i:this._simpleState__activeStates=[i],this.renderStates()}}var a2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Um extends oe{constructor(){super(...arguments);h(this,"effectColor");h(this,"effectDistance")}}a2([v(Ut)],Um.prototype,"effectColor",void 0);a2([v(ae)],Um.prototype,"effectDistance",void 0);var Nm=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const X_=Q("debugui"),Y_=Q("debuguilayout");class l2{constructor(){h(this,"width");h(this,"height")}}class c2{constructor(){h(this,"x");h(this,"y");h(this,"width");h(this,"height")}}const No=new x,Ip=new le,GA=new se;class ts extends sa{constructor(){super(...arguments);h(this,"_anchoredPosition");h(this,"sizeDelta",new ae(100,100));h(this,"pivot",new ae(.5,.5));h(this,"anchorMin",new ae(0,0));h(this,"anchorMax",new ae(1,1));h(this,"minWidth");h(this,"minHeight");h(this,"lastMatrix");h(this,"rectBlock");h(this,"_transformNeedsUpdate",!1);h(this,"_initialPosition");h(this,"_parentRectTransform");h(this,"_lastUpdateFrame",-1);h(this,"_lastAnchoring");h(this,"_createdBlocks",[]);h(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new ae),this._anchoredPosition}set anchoredPosition(t){this._anchoredPosition=t}get width(){let t=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const n=this._parentRectTransform.width,r=this.anchorMax.x-this.anchorMin.x;t=n*r,t+=this.sizeDelta.x}return this.minWidth!==void 0&&t<this.minWidth?this.minWidth:t}get height(){let t=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const n=this._parentRectTransform.height,r=this.anchorMax.y-this.anchorMin.y;t=n*r,t+=this.sizeDelta.y}return this.minHeight!==void 0&&t<this.minHeight?this.minHeight:t}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new ae),this.lastMatrix=new le,this.rectBlock=new ne,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,Id(this,"_anchoredPosition",()=>{this.markDirty()}),Id(this,"sizeDelta",()=>{this.markDirty()}),Id(this,"pivot",()=>{this.markDirty()}),Id(this,"anchorMin",()=>{this.markDirty()}),Id(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var t;super.onEnable(),this.rectBlock||(this.rectBlock=new ne),this.lastMatrix||(this.lastMatrix=new le),this._lastAnchoring||(this._lastAnchoring=new ae),this._initialPosition||(this._initialPosition=new x),this._anchoredPosition||(this._anchoredPosition=new ae),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(t=this.canvas)==null||t.registerTransform(this)}onDisable(){var t;super.onDisable(),this.removeShadowComponent(),(t=this.canvas)==null||t.unregisterTransform(this)}onParentRectTransformChanged(t){this._transformNeedsUpdate||this.onApplyTransform(Y_?`${t.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(Y_&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(t){var o;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const n=this.shadowComponent;if(!n)return;this.gameObject.parent?this._parentRectTransform=j.getComponentInParent(this.gameObject.parent,ts):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,Y_&&console.warn("RectTransform â†’ ApplyTransform",this.name+" because "+t),this.isRoot()?this.Root.screenspace||(n.rotation.y=Math.PI):(n.matrix.identity(),n.matrixAutoUpdate=!1,No.set(0,0,0),this.applyPivot(No),n.matrix.setPosition(No.x,No.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(GA.copy(this.gameObject.quaternion),GA.x*=-1,GA.z*=-1,Ip.makeRotationFromQuaternion(GA),n.matrix.premultiply(Ip)),No.set(0,0,0),this.applyAnchoring(No),(o=this.canvas)!=null&&o.screenspace?No.z+=.1:No.z+=.01,Ip.identity(),Ip.setPosition(No.x,No.y,No.z),n.matrix.premultiply(Ip),n.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const r=!0;for(const a of QS(this.gameObject,sa,r,1)){if(a===this||!a.activeAndEnabled)continue;const l=a;l.onParentRectTransformChanged&&l.onParentRectTransformChanged(this)}}applyAnchoring(t){this._lastAnchoring||(this._lastAnchoring=new ae);const n=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=n.x,this.gameObject.position.y+=n.y,this._lastAnchoring.copy(this._anchoredPosition),t.x+=this._initialPosition.x-this.gameObject.position.x,t.y+=this._initialPosition.y-this.gameObject.position.y,t.z+=this._initialPosition.z-this.gameObject.position.z;const r=this._parentRectTransform;if(r){let o=0;const a=1-this.anchorMax.y-this.anchorMin.y;o-=r.height*.5*a,t.y+=o;let l=0;const c=1-this.anchorMax.x-this.anchorMin.x;l-=r.width*.5*c,t.x+=l}}applyPivot(t){if(this.pivot&&!this.isRoot()){const n=this.pivot.x-.5;t.x-=n*this.sizeDelta.x*this.gameObject.scale.x;const r=this.pivot.y-.5;t.y-=r*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const t={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(t),t}ensureValidSize(t,n=1e-4){return t.width<=0&&(t.width=n),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},X_&&console.log(this.name,t);const n=new cS(t);return this._createdBlocks.push(n),n}createNewText(t){X_&&console.log(t),t={...this.getBasicOptions(),...t},X_&&console.log(this.name,t);const n=new hS(t);return this._createdTextBlocks.push(n),n}}Nm([v(ae)],ts.prototype,"anchoredPosition",null);Nm([v(ae)],ts.prototype,"sizeDelta",void 0);Nm([v(ae)],ts.prototype,"pivot",void 0);Nm([v(ae)],ts.prototype,"anchorMin",void 0);Nm([v(ae)],ts.prototype,"anchorMax",void 0);var h2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const HA={backgroundColor:new xe(1,1,1),backgroundOpacity:1,borderColor:new xe(1,1,1),borderOpacity:1},Zd=class extends sa{constructor(){super(...arguments);h(this,"_alphaFactor",1);h(this,"sRGBColor",new xe(1,0,1));h(this,"raycastTarget",!0);h(this,"uiObject",null);h(this,"_color",null);h(this,"_rect",null);h(this,"_stateManager",null);h(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ut(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new Ut(1,1,1,1)),this._color.copy(t),this.onColorChanged())}setAlphaFactor(t){this._alphaFactor=t,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),HA.backgroundColor=this.sRGBColor,HA.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(HA,this._alphaFactor),this.uiObject.set(HA),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=j.getComponent(this.gameObject,ts)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var t;(t=this.uiObject)==null||t.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(t){this.makePanel(),this.uiObject&&(this.uiObject.setState(t),this==null||this.markDirty())}setupState(t){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new j9(this.uiObject)),this.uiObject.setupState(t.state,t.attributes))}setOptions(t){this.makePanel(),this.uiObject&&this.uiObject.set(t)}awake(){super.awake(),this.makePanel(),Id(this,"_color",()=>t9(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t=.015,n={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:t};this.onBeforeCreate(n),this.applyEffects(n),this.onCreate(n),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(t,n=1){var o;const r=(o=this.gameObject)==null?void 0:o.getComponent(Um);r&&(r.effectDistance&&(t.borderWidth=Math.max(Math.abs(r.effectDistance.x),Math.abs(r.effectDistance.y))),r.effectColor&&(t.borderColor=r.effectColor,t.borderOpacity=r.effectColor.alpha*n))}async setTexture(t){if(this.setOptions({backgroundOpacity:0}),t){if(Zd.textureCache.has(t))t=Zd.textureCache.get(t);else if(!t.isRenderTargetTexture){const n=t.clone();n.colorSpace=zi,Zd.textureCache.set(t,n),t=n}this.setOptions({backgroundImage:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),pt.assignTextureLOD(t,0).then(n=>{n instanceof At&&(t&&Zd.textureCache.set(t,n),this.setOptions({backgroundImage:n}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let Zl=Zd;h(Zl,"textureCache",new Map);h2([v(Ut)],Zl.prototype,"color",null);h2([v()],Zl.prototype,"raycastTarget",void 0);class q0 extends Zl{constructor(){super(...arguments);h(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var X0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};let dE=class{constructor(){h(this,"texture",null);h(this,"rect")}};X0([v(At)],dE.prototype,"texture",void 0);let zm=class extends q0{constructor(){super(...arguments);h(this,"_sprite");h(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new dE),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var n,r,o,a,l,c,u;const t=this.sprite;switch((n=t==null?void 0:t.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((o=(r=t==null?void 0:t.texture)==null?void 0:r.name)!=null&&o.length)&&((l=(a=t==null?void 0:t.texture)==null?void 0:a.image)==null?void 0:l.width)===32&&((u=(c=t==null?void 0:t.texture)==null?void 0:c.image)==null?void 0:u.height)===32}onBeforeCreate(t){var n,r;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((r=(n=this.sprite)==null?void 0:n.texture)==null?void 0:r.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};X0([v(dE)],zm.prototype,"sprite",null);X0([v()],zm.prototype,"pixelsPerUnitMultiplier",void 0);class fE extends q0{constructor(){super(...arguments);h(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}X0([v(At)],fE.prototype,"mainTexture",null);var Qr=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Fh=Q("debugbutton");var ba;(function(s){s[s.None=0]="None",s[s.ColorTint=1]="ColorTint",s[s.SpriteSwap=2]="SpriteSwap",s[s.Animation=3]="Animation"})(ba||(ba={}));class bh{constructor(){h(this,"colorMultiplier");h(this,"disabledColor");h(this,"fadeDuration");h(this,"highlightedColor");h(this,"normalColor");h(this,"pressedColor");h(this,"selectedColor")}}Qr([v()],bh.prototype,"colorMultiplier",void 0);Qr([v(Ut)],bh.prototype,"disabledColor",void 0);Qr([v()],bh.prototype,"fadeDuration",void 0);Qr([v(Ut)],bh.prototype,"highlightedColor",void 0);Qr([v(Ut)],bh.prototype,"normalColor",void 0);Qr([v(Ut)],bh.prototype,"pressedColor",void 0);Qr([v(Ut)],bh.prototype,"selectedColor",void 0);class G9{constructor(){h(this,"disabledTrigger");h(this,"highlightedTrigger");h(this,"normalTrigger");h(this,"pressedTrigger");h(this,"selectedTrigger")}}class _h extends oe{constructor(){super(...arguments);h(this,"onClick",new ti);h(this,"_isHovered",0);h(this,"colors");h(this,"transition");h(this,"animationTriggers");h(this,"animator");h(this,"_interactable",!0);h(this,"_requestedAnimatorTrigger");h(this,"_isInit",!1);h(this,"_image")}click(){var t;(t=this.onClick)==null||t.invoke()}onPointerEnter(t){var r,o;const n=t.event.pointerType==="mouse"&&t.button===0;n&&(this._isHovered+=1),Fh&&console.warn("Button Enter",n,this._isHovered,(r=this.animationTriggers)==null?void 0:r.highlightedTrigger,this.animator),this.interactable&&(this.transition==ba.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===ba.ColorTint&&this.colors&&((o=this._image)==null||o.setState("hovered")),n&&this.context.input.setCursorPointer())}onPointerExit(){var t,n;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Fh&&console.log("Button Exit",this._isHovered,(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==ba.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===ba.ColorTint&&this.colors&&((n=this._image)==null||n.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(t){var n,r;Fh&&console.log("Button Down",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.interactable&&(this.transition==ba.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===ba.ColorTint&&this.colors&&((r=this._image)==null||r.setState("pressed")))}onPointerUp(t){var n,r;Fh&&console.warn("Button Up",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==ba.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===ba.ColorTint&&this.colors&&((r=this._image)==null||r.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){if(this.interactable&&!(t.button!==0&&t.event.pointerType===Kc.Mouse)&&(Fh&&(console.warn("Button Click",this.onClick),bi("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use(),Fh))){const n=this.gameObject.worldPosition;n.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),Pe.DrawLabel(n,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Fh&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable),this.gameObject.getComponentInParent(Dm)||this.gameObject.addComponent(JS)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var n;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((n=this.animator)==null||n.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=j.getComponent(this.gameObject,zm),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var g,m,A,y,b;t.setInteractable(this.interactable);const n=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.normalColor),r={state:"normal",attributes:{backgroundColor:n,backgroundOpacity:n.alpha}};t.setupState(r);const o=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.highlightedColor),a={state:"hovered",attributes:{backgroundColor:o,backgroundOpacity:o.alpha}};t.setupState(a);const l=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.pressedColor),c={state:"pressed",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};t.setupState(c);const u=this.getFinalColor(t.color,(y=this.colors)==null?void 0:y.selectedColor),d={state:"selected",attributes:{backgroundColor:u,backgroundOpacity:u.alpha}};t.setupState(d);const f=this.getFinalColor(t.color,(b=this.colors)==null?void 0:b.disabledColor),p={state:"disabled",attributes:{backgroundColor:f,backgroundOpacity:f.alpha}};t.setupState(p)}getFinalColor(t,n){return n?t.clone().multiply(n).convertLinearToSRGB():t.clone().convertLinearToSRGB()}}Qr([v(ti)],_h.prototype,"onClick",void 0);Qr([v(bh)],_h.prototype,"colors",void 0);Qr([v()],_h.prototype,"transition",void 0);Qr([v(G9)],_h.prototype,"animationTriggers",void 0);Qr([v(Cs)],_h.prototype,"animator",void 0);Qr([v()],_h.prototype,"interactable",null);var Ji=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const CR=Q("debuguilayout");class Wu{constructor(){h(this,"left",0);h(this,"right",0);h(this,"top",0);h(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}Ji([v()],Wu.prototype,"left",void 0);Ji([v()],Wu.prototype,"right",void 0);Ji([v()],Wu.prototype,"top",void 0);Ji([v()],Wu.prototype,"bottom",void 0);var Jx;(function(s){s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight",s[s.Custom=9]="Custom"})(Jx||(Jx={}));var yu;(function(s){s.Horizontal="x",s.Vertical="y"})(yu||(yu={}));class jr extends oe{constructor(){super(...arguments);h(this,"_rectTransform",null);h(this,"_needsUpdate",!1);h(this,"childAlignment",Jx.UpperLeft);h(this,"reverseArrangement",!1);h(this,"spacing",0);h(this,"padding");h(this,"minWidth",0);h(this,"minHeight",0);h(this,"flexibleHeight",0);h(this,"flexibleWidth",0);h(this,"preferredHeight",0);h(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(CR&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){CR&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(ts);const t=this.gameObject.getComponentInParent(In);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(In);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}Ji([v()],jr.prototype,"childAlignment",void 0);Ji([v()],jr.prototype,"reverseArrangement",void 0);Ji([v()],jr.prototype,"spacing",void 0);Ji([v(Wu)],jr.prototype,"padding",void 0);Ji([v()],jr.prototype,"minWidth",void 0);Ji([v()],jr.prototype,"minHeight",void 0);Ji([v()],jr.prototype,"flexibleHeight",void 0);Ji([v()],jr.prototype,"flexibleWidth",void 0);Ji([v()],jr.prototype,"preferredHeight",void 0);Ji([v()],jr.prototype,"preferredWidth",void 0);class wh extends jr{constructor(){super(...arguments);h(this,"childControlHeight",!0);h(this,"childControlWidth",!0);h(this,"childForceExpandHeight",!1);h(this,"childForceExpandWidth",!1);h(this,"childScaleHeight",!1);h(this,"childScaleWidth",!1)}onCalculateLayout(t){var T;const n=this.primaryAxis,r=t.width;let o=r;const a=t.height;let l=a;o-=this.padding.horizontal,l-=this.padding.vertical,n===yu.Horizontal?this.padding.horizontal:this.padding.vertical;const c=n===yu.Horizontal,u=c?"y":"x",d=c?this.childControlWidth:this.childControlHeight,f=c?this.childControlHeight:this.childControlWidth,p=c?this.childForceExpandWidth:this.childForceExpandHeight,g=c?this.childForceExpandHeight:this.childForceExpandWidth,m=c?l:o,A=c?r:a,y=.5*(c?this.childAlignment%3:Math.floor(this.childAlignment/3));let b=0;c?b+=this.padding.left:b+=this.padding.top;let _=0,w=0;for(let P=0;P<this.gameObject.children.length;P++){const B=this.gameObject.children[P],M=j.getComponent(B,ts);M!=null&&M.activeAndEnabled&&(w+=1,c?_+=M.width:_+=M.height)}let S=0;const E=this.spacing*(w-1);if(p||d){let P=0;c?P=o-=E:P=l-=E,w>0&&(S=P/w)}let I=0;I+=this.padding.left,I-=this.padding.right,y!==0&&(b=A-_,b*=y,b-=E*y,c?(b-=this.padding.right*y,b+=this.padding.left*(1-y),b<this.padding.left&&(b=this.padding.left)):(b-=this.padding.bottom*y,b+=this.padding.top*(1-y),b<this.padding.top&&(b=this.padding.top)));let k=1;for(let P=0;P<this.gameObject.children.length;P++){const B=this.gameObject.children[P],M=j.getComponent(B,ts);if(M!=null&&M.activeAndEnabled){(T=M.pivot)==null||T.set(.5,.5),M.anchorMin.set(0,1),M.anchorMax.set(0,1);const U=r*.5+I*.5;M.anchoredPosition.x!==U&&(M.anchoredPosition.x=U);const G=a*-.5;M.anchoredPosition.y!==G&&(M.anchoredPosition.y=G),g&&f&&M.sizeDelta[u]!==m&&(M.sizeDelta[u]=m),p&&d&&M.sizeDelta[n]!==S&&(M.sizeDelta[n]=S);const W=c?M.width:M.height,Y=W*.5;if(b+=Y,p){const L=S*k-S*.5;L>b&&(b=L-S*.5+W+this.padding.left,b-=Y)}let D=b;n===yu.Vertical&&(D=-D),M.anchoredPosition[n]!==D&&(M.anchoredPosition[n]=D),b+=Y,b+=this.spacing,k+=1}}}}Ji([v()],wh.prototype,"childControlHeight",void 0);Ji([v()],wh.prototype,"childControlWidth",void 0);Ji([v()],wh.prototype,"childForceExpandHeight",void 0);Ji([v()],wh.prototype,"childForceExpandWidth",void 0);Ji([v()],wh.prototype,"childScaleHeight",void 0);Ji([v()],wh.prototype,"childScaleWidth",void 0);class u2 extends wh{get primaryAxis(){return yu.Vertical}}class d2 extends wh{get primaryAxis(){return yu.Horizontal}}class f2 extends jr{onCalculateLayout(){}}var cl=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Ta;(function(s){s[s.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",s[s.ScreenSpaceCamera=1]="ScreenSpaceCamera",s[s.WorldSpace=2]="WorldSpace",s[s.Undefined=-1]="Undefined"})(Ta||(Ta={}));const K_=Q("debuguilayout");class In extends O0{constructor(){super(...arguments);h(this,"_renderOnTop");h(this,"_depthWrite",!1);h(this,"_doubleSided",!0);h(this,"_castShadows",!1);h(this,"_receiveShadows",!1);h(this,"_renderMode",Ta.Undefined);h(this,"_rootCanvas");h(this,"_scaleFactor",1);h(this,"worldCamera");h(this,"planeDistance",-1);h(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));h(this,"previousParent",null);h(this,"_lastMatrixWorld",null);h(this,"_rectTransforms",[]);h(this,"_layoutGroups",new Map);h(this,"_receivers",[]);h(this,"onBeforeRenderRoutine",()=>{var t,n,r,o;if(this.previousParent=this.gameObject.parent,((t=this.context.xr)!=null&&t.isVR||(n=this.context.xr)!=null&&n.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),(o=this.shadowComponent)==null||o.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),Dr.ensureUpdateMeshUI(L1,this.context))});h(this,"onAfterRenderRoutine",()=>{var t,n,r,o,a;if(((t=this.context.xr)!=null&&t.isVR||(n=this.context.xr)!=null&&n.isPassThrough)&&this.screenspace){(r=this.previousParent)==null||r.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const u=this.context.mainCamera;u==null||u.add(this.gameObject)}else this.previousParent.add(this.gameObject);const l=this.context.renderer.autoClear,c=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(o=this.shadowComponent)==null||o.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),Dr.ensureUpdateMeshUI(L1,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=l,this.context.renderer.autoClearColor=c,this.previousParent.add(this.gameObject)}(a=this._lastMatrixWorld)==null||a.copy(this.gameObject.matrixWorld)});h(this,"_updateRenderSettingsRoutine");h(this,"_activeRenderMode",-1);h(this,"_lastWidth",-1);h(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==Ta.WorldSpace}set renderOnTop(t){t!==this._renderOnTop&&(this._renderOnTop=t,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===Ta.ScreenSpaceOverlay)}set depthWrite(t){this._depthWrite!==t&&(this._depthWrite=t,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(t){this._doubleSided!==t&&(this._doubleSided=t,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(t){this._receiveShadows!==t&&(this._receiveShadows=t,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t,this.onRenderSettingsChanged())}set rootCanvas(t){this._rootCanvas instanceof In||(this._rootCanvas=t)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){this._scaleFactor=t}awake(){var t;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,K_&&console.log("Canvas.Awake()",((t=this.previousParent)==null?void 0:t.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new le,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);t!==-1&&this.context.pre_render_callbacks.splice(t,1);const n=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);n!==-1&&this.context.post_render_callbacks.splice(n,1)}registerTransform(t){this._rectTransforms.push(t)}unregisterTransform(t){const n=this._rectTransforms.indexOf(t);n!==-1&&this._rectTransforms.splice(n,1)}registerLayoutGroup(t){const n=t.gameObject;this._layoutGroups.set(n,t)}unregisterLayoutGroup(t){const n=t.gameObject;this._layoutGroups.delete(n)}registerEventReceiver(t){this._receivers.push(t)}unregisterEventReceiver(t){const n=this._receivers.indexOf(t);n!==-1&&this._receivers.splice(n,1)}async onEnterXR(t){this.screenspace?(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await LC(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(t){this.screenspace&&(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var t;for(const n of this._receivers)(t=n.onBeforeCanvasRender)==null||t.call(n,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new le);const t=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);K_&&t&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const n=!1;for(const r of this._rectTransforms){t&&r.markDirty();let o=this._layoutGroups.get(r.gameObject);r.isDirty&&!o&&(o=r.gameObject.getComponentInParent(jr)),(r.isDirty||o!=null&&o.isDirty)&&(K_&&!n&&console.log("CANVAS UPDATE ### "+r.name+" ##################################### "+this.context.time.frame),o==null||o.updateLayout(),r.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),qe.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),vy(this.shadowComponent,this);for(const t of j.getComponentsInChildren(this.gameObject,sa))vy(t.shadowComponent,this)}}onUpdateRenderMode(t=!1){if(!t&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let n=this.context.mainCameraComponent,r=10;switch(n&&n.nearClipPlane>0&&n.farClipPlane>0&&(r=ye.lerp(n.nearClipPlane,n.farClipPlane,.01)),this._renderMode===Ta.ScreenSpaceCamera&&(this.worldCamera&&(n=this.worldCamera),this.planeDistance>0&&(r=this.planeDistance)),this._renderMode){case Ta.ScreenSpaceOverlay:case Ta.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!n)return;const o=r+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-o,this.gameObject.quaternion.identity();const a=this.gameObject.getComponent(ts);let l=!1;a.sizeDelta.x!==this.context.domWidth&&(l=!0),a.sizeDelta.y!==this.context.domHeight&&(l=!0);const c=n.fieldOfView*Math.PI/180,u=2*Math.tan(c/2)*Math.abs(o);this.gameObject.scale.x=u/this.context.domHeight,this.gameObject.scale.y=u/this.context.domHeight,this.gameObject.scale.z=.01,l&&(a.sizeDelta.x=this.context.domWidth,a.sizeDelta.y=this.context.domHeight,a==null||a.markDirty());break;case Ta.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}cl([v()],In.prototype,"renderOnTop",null);cl([v()],In.prototype,"depthWrite",null);cl([v()],In.prototype,"doubleSided",null);cl([v()],In.prototype,"castShadows",null);cl([v()],In.prototype,"receiveShadows",null);cl([v()],In.prototype,"renderMode",null);cl([v(In)],In.prototype,"rootCanvas",null);cl([v()],In.prototype,"scaleFactor",null);cl([v(Bt)],In.prototype,"worldCamera",void 0);cl([v()],In.prototype,"planeDistance",void 0);var pE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Iu extends oe{constructor(){super(...arguments);h(this,"_alpha",1);h(this,"interactable",!0);h(this,"blocksRaycasts",!0);h(this,"_isDirty",!1);h(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),qe.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const t of j.getComponentsInChildren(this.gameObject,sa,this._buffer)){const n=t;n.setAlphaFactor&&n.setAlphaFactor(this._alpha)}}}pE([v()],Iu.prototype,"alpha",null);pE([v()],Iu.prototype,"interactable",void 0);pE([v()],Iu.prototype,"blocksRaycasts",void 0);var xi=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const SR=Q("debugusdzbehaviours");function Qm(s){s&&(s.getComponentInParent(Dm)||(be()&&console.warn("Create Raycaster on "+s.name+" because no raycaster was found in the hierarchy"),s.addNewComponent(Co)))}class Wf extends oe{constructor(){super(...arguments);h(this,"object");h(this,"target");h(this,"duration",1);h(this,"relativeMotion",!1);h(this,"coroutine",null);h(this,"targetPos",new x);h(this,"targetRot",new se);h(this,"targetScale",new x)}start(){Qm(this.gameObject)}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const t=Ve(this.object).clone(),n=Ve(this.target).clone(),r=Ht(this.object).clone(),o=Ht(this.target).clone(),a=oi(this.object).clone(),l=oi(this.target).clone(),c=t.distanceTo(n),u=r.angleTo(o),d=a.distanceTo(l);if(c<.01&&u<.01&&d<.01){Sn(this.object,n),na(this.object,o),Kg(this.object,l),this.coroutine=null;return}let f=0,p=0;for(;f<1;)f+=this.context.time.deltaTime/this.duration,f>1&&(f=1),p=f<.5?4*f*f*f:1-Math.pow(-2*f+2,3)/2,this.targetPos.lerpVectors(t,n,p),this.targetRot.slerpQuaternions(r,o,p),this.targetScale.lerpVectors(a,l,p),Sn(this.object,this.targetPos),na(this.object,this.targetRot),Kg(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),n=this.object.quaternion.clone(),r=this.object.scale.clone(),o=this.target.position.clone(),a=this.target.quaternion.clone(),l=this.target.scale.clone();o.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(o),this.targetRot.copy(this.object.quaternion).multiply(a),this.targetScale.copy(this.object.scale).multiply(l);let c=0,u=0;for(;c<1;)c+=this.context.time.deltaTime/this.duration,c>1&&(c=1),u=c<.5?4*c*c*c:1-Math.pow(-2*c+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,u),this.object.quaternion.slerpQuaternions(n,this.targetRot,u),this.object.scale.lerpVectors(r,this.targetScale,u),yield;this.coroutine=null}beforeCreateDocument(t){var n;if(this.target&&this.object&&this.gameObject){const r=new cn("Move to "+((n=this.target)==null?void 0:n.name),es.tapTrigger(this.gameObject),Ct.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));t.addBehavior(r)}}}xi([v(ne)],Wf.prototype,"object",void 0);xi([v(ne)],Wf.prototype,"target",void 0);xi([v()],Wf.prototype,"duration",void 0);xi([v()],Wf.prototype,"relativeMotion",void 0);const jo=class extends oe{constructor(){super(...arguments);h(this,"materialToSwitch");h(this,"variantMaterial");h(this,"fadeDuration",0);h(this,"_objectsWithThisMaterial",null);h(this,"selfModel");h(this,"targetModels")}start(){var t;this._objectsWithThisMaterial=this.objectsWithThisMaterial,Qm(this.gameObject),be()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((t=this.materialToSwitch)==null?void 0:t.name)+'"')}onPointerEnter(t){this.context.input.setCursorPointer()}onPointerExit(t){this.context.input.setCursorNormal()}onPointerClick(t){if(t.use(),!!this.variantMaterial)for(let n=0;n<this.objectsWithThisMaterial.length;n++){const r=this.objectsWithThisMaterial[n];r.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(t=>{if(t instanceof Z)if(Array.isArray(t.material)){for(const n of t.material)if(n===this.materialToSwitch){this.objectsWithThisMaterial.push(t);break}}else t.material===this.materialToSwitch?this.objectsWithThisMaterial.push(t):K5(t.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(t)}),this._objectsWithThisMaterial)}async beforeCreateDocument(t,n){this.targetModels=[],jo._materialTriggersPerId={},jo.variantSwitchIndex=0,this.materialToSwitch&&await pt.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await pt.assignTextureLOD(this.variantMaterial,0)}createBehaviours(t,n,r){this.objectsWithThisMaterial.find(a=>a.uuid===n.uuid)&&this.targetModels.push(n),this.gameObject.uuid===n.uuid&&(this.selfModel=n,this.materialToSwitch&&(jo._materialTriggersPerId[this.materialToSwitch.uuid]||(jo._materialTriggersPerId[this.materialToSwitch.uuid]=[]),jo._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(t,n){if(!this.materialToSwitch)return;const r=jo._materialTriggersPerId[this.materialToSwitch.uuid];if(r){const o={};for(const a of r){const l=a.createVariants();l&&l.length>0&&(o[a.selfModel.uuid]=l)}for(const a of r){const l=[];for(const c in o)c!==a.selfModel.uuid&&l.push(...o[c]);a.createAndAttachBehaviors(t,o[a.selfModel.uuid],l)}}delete jo._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(t,n,r){const o=[],a=[],l=Math.max(0,this.fadeDuration);a.push(Ct.fadeAction([...this.targetModels,...r],l,!1)),o.push(Ct.fadeAction(n,l,!1)),a.push(Ct.fadeAction(n,l,!0)),t.addBehavior(new cn("Select_"+this.selfModel.name,es.tapTrigger(this.selfModel),Ct.parallel(...a))),t.addBehavior(new cn("StartHidden_"+this.selfModel.name,es.sceneStartTrigger(),Ct.parallel(...o)))}static getMaterialName(t){return ol(t.name||"Material")+"_"+t.id}createVariants(){if(!this.variantMaterial)return null;const t=[];for(const n of this.targetModels){const r=n.clone();r.name+="_Variant_"+jo.variantSwitchIndex+++"_"+jo.getMaterialName(this.variantMaterial),r.displayName=r.displayName+": Variant with material "+this.variantMaterial.name,r.material=this.variantMaterial,r.geometry=n.geometry,r.matrix=n.matrix,(!n.parent||!n.parent.isEmpty())&&_s.createEmptyParent(n),n.parent&&n.parent.add(r),t.push(r)}return t}};let Vl=jo;h(Vl,"_materialTriggersPerId",{}),h(Vl,"variantSwitchIndex",0);xi([v(mt)],Vl.prototype,"materialToSwitch",void 0);xi([v(mt)],Vl.prototype,"variantMaterial",void 0);xi([v()],Vl.prototype,"fadeDuration",void 0);const di=class extends oe{constructor(){super(...arguments);h(this,"target");h(this,"toggleOnClick",!1);h(this,"targetState",!0);h(this,"hideSelf",!0);h(this,"selfModel");h(this,"selfModelClone");h(this,"targetModel");h(this,"toggleModel");h(this,"stateBeforeCreatingDocument",!1);h(this,"targetStateBeforeCreatingDocument",!1)}start(){Qm(this.gameObject)}onPointerClick(t){t.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(t,n,r){n.uuid===this.gameObject.uuid&&(this.selfModel=n,this.selfModelClone=n.clone())}beforeCreateDocument(){this.target&&(this.gameObject[di.wasVisible]===void 0&&(this.gameObject[di.wasVisible]=this.gameObject.activeSelf),this.target[di.wasVisible]===void 0&&(this.target[di.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[di.wasVisible],this.targetStateBeforeCreatingDocument=this.target[di.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(t,n){if(!this.target)return;this.targetModel=n.document.findById(this.target.uuid);const r=this.selfModel;if(this.selfModel&&this.targetModel){let o=this.selfModel,a=this.targetState;if(this.toggleOnClick)if(a=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&FO.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[di.toggleClone]){const u=this.selfModelClone.clone();u.matrix.identity(),u.name+="_toggle"+di.clonedToggleIndex++,r.add(u),this.gameObject[di.toggleClone]=u,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const c=this.gameObject[di.toggleClone];if(!this.gameObject[di.reverseToggleClone]){const u=this.selfModelClone.clone();u.matrix.identity(),u.name+="_toggleReverse"+di.clonedToggleIndex++,r.add(u),this.gameObject[di.reverseToggleClone]=u}this.toggleModel=this.gameObject[di.reverseToggleClone],(!this.toggleModel.geometry||!c.geometry)&&console.error("triggers without childs and without geometry won't work!",this,r.geometry),o=c,r.geometry=null,r.material=null}if(this.toggleModel){if(this.toggleOnClick){const c=[];c.push(Ct.fadeAction(o,0,!1)),c.push(Ct.fadeAction(this.toggleModel,0,!0)),c.push(Ct.fadeAction(this.targetModel,0,a)),t.addBehavior(new cn("Toggle_"+o.name+"_toggleTo"+(a?"On":"Off"),es.tapTrigger(o),Ct.parallel(...c)));const u=[];u.push(Ct.fadeAction(this.toggleModel,0,!1)),u.push(Ct.fadeAction(o,0,!0)),u.push(Ct.fadeAction(this.targetModel,0,!a)),t.addBehavior(new cn("Toggle_"+o.name+"_toggleTo"+(a?"Off":"On"),es.tapTrigger(this.toggleModel),Ct.parallel(...u)))}}else{const c=[];this.hideSelf&&c.push(Ct.fadeAction(o,0,!1)),c.push(Ct.fadeAction(this.targetModel,0,a)),t.addBehavior(new cn("Toggle_"+o.name+"_toggleTo"+(a?"On":"Off"),es.tapTrigger(o),Ct.parallel(...c)))}const l=new Array;this.targetStateBeforeCreatingDocument||l.push(this.targetModel),this.stateBeforeCreatingDocument||l.push(r),this.toggleModel&&l.push(this.toggleModel),t.addBehavior(new cn("HideOnStart_"+this.gameObject.name,es.sceneStartTrigger(),Ct.fadeAction(l,0,!1)))}}afterSerialize(t,n){this.gameObject[di.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[di.wasVisible],delete this.gameObject[di.wasVisible]),this.target&&this.target[di.wasVisible]!==void 0&&(this.target.visible=this.target[di.wasVisible],delete this.target[di.wasVisible]),delete this.gameObject[di.toggleClone],delete this.gameObject[di.reverseToggleClone]}};let ho=di;h(ho,"clonedToggleIndex",0),h(ho,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),h(ho,"toggleClone",Symbol("clone for toggling")),h(ho,"reverseToggleClone",Symbol("clone for reverse toggling"));xi([v(ne)],ho.prototype,"target",void 0);xi([v()],ho.prototype,"toggleOnClick",void 0);xi([v()],ho.prototype,"targetState",void 0);xi([v()],ho.prototype,"hideSelf",void 0);class p2 extends oe{constructor(){super(...arguments);h(this,"wasVisible",!1)}start(){j.setActive(this.gameObject,!1)}createBehaviours(t,n,r){n.uuid===this.gameObject.uuid&&(this.wasVisible||t.addBehavior(new cn("HideOnStart_"+this.gameObject.name,es.sceneStartTrigger(),Ct.fadeAction(n,0,!1))))}beforeCreateDocument(){this.wasVisible=j.isActiveSelf(this.gameObject)}}class jm extends oe{constructor(){super(...arguments);h(this,"target");h(this,"duration",.5);h(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(t,n,r){if(this.target&&n.uuid===this.gameObject.uuid){const o=new cn("emphasize "+this.name,es.tapTrigger(this.gameObject),Ct.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(o)}}afterCreateDocument(t,n){}}xi([v()],jm.prototype,"target",void 0);xi([v()],jm.prototype,"duration",void 0);xi([v()],jm.prototype,"motionType",void 0);class Tu extends oe{constructor(){super(...arguments);h(this,"target");h(this,"clip","");h(this,"toggleOnClick",!1);h(this,"trigger","tap")}start(){Qm(this.gameObject)}ensureAudioSource(){if(!this.target){const t=this.gameObject.addNewComponent(kt);t&&(this.target=t,t.spatialBlend=1,t.volume=1,t.loop=!1,t.preload=!0)}}onPointerClick(t){var n;t.use(),!(!((n=this.target)!=null&&n.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(t,n,r){if(!(!this.target&&!this.clip)&&n.uuid===this.gameObject.uuid){const o=this.clip?this.clip:this.target?this.target.clip:void 0;if(!o||typeof o!="string")return;const a=this.target?this.target.gameObject:this.gameObject;ju.getName(o);const l=this.target?this.target.volume:1,c=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let u=!1;this.gameObject.traverse(g=>{g instanceof Z&&g.visible&&(u=!0)}),u=!0;const d=t.addAudioClip(o);let f=Ct.playAudioAction(a,d,"play",l,c);this.target&&this.target.loop&&(f=Ct.sequence(f).makeLooping());const p=this.name?"_"+this.name:"";if(u&&this.trigger==="tap"){this.toggleOnClick&&(f.multiplePerformOperation="stop");const g=new cn("playAudio"+p,es.tapTrigger(n),f);t.addBehavior(g)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(u&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const g=new cn("playAudioOnStart"+p,es.sceneStartTrigger(),f);t.addBehavior(g)}}}}xi([v(kt)],Tu.prototype,"target",void 0);xi([v(URL)],Tu.prototype,"clip",void 0);xi([v()],Tu.prototype,"toggleOnClick",void 0);const Go=class extends oe{constructor(){super(...arguments);h(this,"animator");h(this,"stateName");h(this,"trigger","tap");h(this,"animation");h(this,"selfModel");h(this,"stateAnimationModel");h(this,"animationSequence",new Array);h(this,"animationLoopAfterSequence",new Array)}get target(){var t,n;return((t=this.animator)==null?void 0:t.gameObject)||((n=this.animation)==null?void 0:n.gameObject)}start(){Qm(this.gameObject)}onPointerClick(t){var n;t.use(),this.target&&this.stateName&&((n=this.animator)==null||n.play(this.stateName,0,0,.1))}createBehaviours(t,n,r){n.uuid===this.gameObject.uuid&&(this.selfModel=n)}afterSerialize(){if(Go.rootsWithExclusivePlayback.size>1){const t='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';be()&&Xt(t),console.warn(t,...Go.rootsWithExclusivePlayback)}Go.animationActions=[],Go.rootsWithExclusivePlayback=new Set}afterCreateDocument(t,n){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const r=n.document,o=n.extensions.find(c=>c instanceof z0);if(!o)return;const a=o.getClipCount(this.target)>1;a&&(be()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+o.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Go.rootsWithExclusivePlayback.add(this.target));const l=this.name?this.name:"";r.traverse(c=>{var u,d;if(c.uuid===((u=this.target)==null?void 0:u.uuid)){const f=Go.getActionForSequences(c,this.animationSequence,this.animationLoopAfterSequence),p=new cn(this.trigger+"_"+l+"_toPlayAnimation_"+this.stateName+"_on_"+((d=this.target)==null?void 0:d.name),this.trigger=="tap"?es.tapTrigger(this.selfModel):es.sceneStartTrigger(),f);a&&p.makeExclusive(!0),t.addBehavior(p)}})}static getActionForSequences(t,n,r){const o=(l,c)=>{let u=Go.animationActions.find(d=>d.affectedObjects==l&&d.start==c.start&&d.duration==c.duration&&d.animationSpeed==c.speed);return u||(u=Ct.startAnimationAction(l,c.start,c.duration,c.speed),Go.animationActions.push(u)),u},a=Ct.sequence();if(n&&n.length>0)for(const l of n)a.addAction(o(t,l));if(r&&r.length>0){const l=a.actions.length==0?a:Ct.sequence();for(const c of r)l.addAction(o(t,c));l.makeLooping(),a!==l&&a.addAction(l)}return a}static getAndRegisterAnimationSequences(t,n,r){var m,A,y,b,_;if(!n)return;const o=n.getComponent(Cs),a=n.getComponent(qs);if(!o&&!a)return;if(o&&!r)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+o.name+" on "+n.name);let l=[],c=[];if(a){const w=t.registerAnimation(n,a.clip);return w&&(a.loop?c.push(w):l.push(w)),{animationSequence:l,animationLoopAfterSequence:c}}const u=o==null?void 0:o.runtimeAnimatorController;let d=u==null?void 0:u.findState(r),f=[],p=[];if(u&&d){const w=new Array;w.push(d);let S=!1;for(;w.length<100;){if(!d||d===null||!d.transitions||d.transitions.length===0){(m=d.motion)!=null&&m.isLooping&&(S=!0);break}const E=d.transitions.find(k=>k.conditions.length===0),I=E?u.getState(E.destinationState,0):null;if(I&&w.includes(I)){d=I,S=!0;break}else if(E){if(d=I,!d)break;w.push(d)}else{S=((A=d.motion)==null?void 0:A.isLooping)??!1;break}}if(S&&d){const E=w.indexOf(d);f=w.slice(0,E),p=w.slice(E),SR&&console.log("found loop from "+r,"states until loop",f,"states looping",p)}else f=w,p=[],SR&&console.log("found no loop from "+r,"states",f)}if(f.length===1&&(!((y=f[0].motion)!=null&&y.clip)||((_=(b=f[0].motion)==null?void 0:b.clip.tracks)==null?void 0:_.length)===0)){l=new Array;const w=t.registerAnimation(n,null);w&&l.push(w);return}if(f=f.filter(w=>{var S,E,I;return((S=w.motion)==null?void 0:S.clip)&&((I=(E=w.motion)==null?void 0:E.clip.tracks)==null?void 0:I.length)>0}),p=p.filter(w=>{var S,E,I;return((S=w.motion)==null?void 0:S.clip)&&((I=(E=w.motion)==null?void 0:E.clip.tracks)==null?void 0:I.length)>0}),f.length===0&&p.length===0){console.warn("No clips found for state "+r+" on "+(o==null?void 0:o.name)+", can't export animation data");return}const g=(w,S)=>{if(!n)return;const E=t.registerAnimation(n,w.motion.clip??null);E?(E.speed=w.speed,S.push(E)):console.warn("Couldn't register animation for state "+w.name+" on "+(o==null?void 0:o.name))};if(f.length>0){l=new Array;for(const w of f)g(w,l)}if(p.length>0){c=new Array;for(const w of p)g(w,c)}return{animationSequence:l,animationLoopAfterSequence:c}}createAnimation(t,n,r){if(!this.target||!this.animator&&!this.animation)return;const o=Go.getAndRegisterAnimationSequences(t,this.target,this.stateName);o&&(this.animationSequence=o.animationSequence,this.animationLoopAfterSequence=o.animationLoopAfterSequence,this.stateAnimationModel=n)}};let Wa=Go;h(Wa,"animationActions",[]),h(Wa,"rootsWithExclusivePlayback",new Set);xi([v(Cs)],Wa.prototype,"animator",void 0);xi([v()],Wa.prototype,"stateName",void 0);class Gm extends oe{constructor(){super(...arguments);h(this,"target")}getType(){}getDuration(){}}xi([v(ne)],Gm.prototype,"target",void 0);class Y0 extends oe{constructor(){super(...arguments);h(this,"target")}}xi([v(Gm)],Y0.prototype,"target",void 0);class K0 extends Gm{constructor(){super(...arguments);h(this,"type",vg.Hide);h(this,"duration",1)}getType(){switch(this.type){case vg.Hide:return"hide";case vg.Show:return"show"}}getDuration(){return this.duration}}xi([v()],K0.prototype,"type",void 0);xi([v()],K0.prototype,"duration",void 0);class g2 extends Y0{}var vg;(function(s){s[s.Show=0]="Show",s[s.Hide=1]="Hide"})(vg||(vg={}));var dc=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const ER=Q("debugcharactercontroller");class qf extends oe{constructor(){super(...arguments);h(this,"center",new x(0,0,0));h(this,"radius",.5);h(this,"height",2);h(this,"_rigidbody",null);h(this,"_activeGroundCollisions");h(this,"_contactVelocity",new x)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(It),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(It)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let n=this.gameObject.getComponent(dh);n||(n=this.gameObject.addNewComponent(dh)),n.center.copy(this.center),n.radius=this.radius,n.height=this.height;const r=new x(0,0,1),o=new x(1,0,0),a=new x(0,1,0),l=this.gameObject.getWorldDirection(new x);l.y=0;const c=o.dot(l)<0?-1:1,u=r.angleTo(l)*c;this.gameObject.setRotationFromAxisAngle(a,u),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(n=>n.normal.y>.2))&&(this._activeGroundCollisions.add(t),ER&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(n=>n.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),ER&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var t;this._contactVelocity.set(0,0,0);for(const n of this._activeGroundCollisions){const r=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(n.collider);r&&(this._contactVelocity.x+=r.x,this._contactVelocity.y+=r.y,this._contactVelocity.z+=r.z)}return this._contactVelocity}}dc([v(x)],qf.prototype,"center",void 0);dc([v()],qf.prototype,"radius",void 0);dc([v()],qf.prototype,"height",void 0);class xh extends oe{constructor(){super(...arguments);h(this,"controller");h(this,"movementSpeed",2);h(this,"rotationSpeed",2);h(this,"jumpForce",1);h(this,"doubleJumpForce",2);h(this,"animator");h(this,"lookForward",!0);h(this,"lookInput",new ae(0,0));h(this,"moveInput",new ae(0,0));h(this,"jumpInput",!1);h(this,"_currentSpeed",new x(0,0,0));h(this,"_currentAngularSpeed",new x(0,0,0));h(this,"_temp",new x(0,0,0));h(this,"_jumpCount",0);h(this,"_currentRotation");h(this,"_raycastOptions",new sc)}awake(){this._currentRotation=new se}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,n,r){var o,a,l,c,u,d,f,p,g,m,A;if((o=this.controller)!=null&&o.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((a=this.animator)==null||a.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(l=this.animator)==null||l.setBool("running",t.length()>.01),(u=this.animator)==null||u.setBool("jumping",((c=this.controller)==null?void 0:c.isGrounded)===!0&&r),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=ye.toRadians(-n.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const y=this.context.mainCameraComponent.forward;y.y=0,y.normalize(),this._currentRotation.setFromUnitVectors(new x(0,0,1),y),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&r&&this.jumpForce>0){let y=(d=this.controller)==null?void 0:d.isGrounded;if(this.doubleJumpForce>0&&!((f=this.controller)!=null&&f.isGrounded)&&this._jumpCount===1&&(y=!0,(p=this.animator)==null||p.setBool("doubleJump",!0)),y){this._jumpCount+=1;const b=this.controller.rigidbody,_=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;b.applyImpulse(new x(0,1,0).multiplyScalar(_))}}if(this.controller){const y=(g=this.controller)==null?void 0:g.rigidbody.getVelocity().y;if(y<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new gh),this._raycastOptions.ray.origin.copy(Ve(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const b=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const _=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(b),(_.length&&_[0].distance>2||y<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(A=this.animator)==null||A.setBool("falling",!1)}}}dc([v(qf)],xh.prototype,"controller",void 0);dc([v()],xh.prototype,"movementSpeed",void 0);dc([v()],xh.prototype,"rotationSpeed",void 0);dc([v()],xh.prototype,"jumpForce",void 0);dc([v()],xh.prototype,"doubleJumpForce",void 0);dc([v(Cs)],xh.prototype,"animator",void 0);var H9=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class J0 extends Es{constructor(){super(...arguments);h(this,"intensity",new Ae(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const t=new ak;return t.offset=new ae(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=n=>n*.02,this.intensity.onValueChanged=n=>{t.offset.x=-n,t.offset.y=n},t}}H9([v(Ae)],J0.prototype,"intensity",void 0);oa("ChromaticAberration",J0);var m2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const IR=Q("debugpost");var vs;(function(s){s[s.None=0]="None",s[s.Neutral=1]="Neutral",s[s.ACES=2]="ACES",s[s.AgX=3]="AgX",s[s.KhronosNeutral=4]="KhronosNeutral"})(vs||(vs={}));function J_(s){switch(s){case vs.None:return o0;case vs.Neutral:return DC;case vs.ACES:return kC;case vs.AgX:return r0;case vs.KhronosNeutral:return Qg;default:return Qg}}function V9(s){switch(s){case o0:return vs.None;case kC:return vs.ACES;case r0:return vs.AgX;case Qg:return vs.Neutral;case DC:return vs.Neutral;default:return vs.None}}function TR(s){switch(s){case o0:return vn.LINEAR;case kC:return vn.ACES_FILMIC;case r0:return vn.AGX;case Qg:return vn.NEUTRAL;case DC:return vn.REINHARD;default:return vn.LINEAR}}class oc extends Es{constructor(){super(...arguments);h(this,"mode",new Ae(void 0));h(this,"exposure",new Ae(1))}get typeName(){return"ToneMapping"}setMode(t){const n=vs[t];return n===void 0?(console.error("Invalid ToneMapping mode",t),this):(this.mode.value=n,this)}get isToneMapping(){return!0}onEffectEnabled(){const t=ZO(this);t&&super.onEffectEnabled(t)}onCreateEffect(){if(this.postprocessingContext)for(const r of this.postprocessingContext.components){if(r===this)break;if(r!=this&&r instanceof oc){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:r,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const r=V9(this.context.renderer.toneMapping);this.mode.initialize(r)}const t=J_(this.mode.value),n=new $v({mode:TR(t)});return this.mode.onValueChanged=r=>{const o=J_(r);n.mode=TR(o),IR&&console.log("ToneMapping mode changed to",vs[r],o,n.mode)},IR&&console.log("Use ToneMapping",vs[this.mode.value],t,n.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=r=>{this.context.renderer.toneMappingExposure=r},n}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=J_(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}}m2([v(Ae)],oc.prototype,"mode",void 0);m2([v(Ae)],oc.prototype,"exposure",void 0);oa("Tonemapping",oc);var Z0=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class qu extends Es{constructor(){super(...arguments);h(this,"postExposure",new Ae(0));h(this,"contrast",new Ae(0));h(this,"hueShift",new Ae(0));h(this,"saturation",new Ae(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.contrast.valueProcessor=t=>{let n=1;return t>0?n=200:t<0&&(n=100),t/n},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var a,l;const t=[];this.context.renderer.toneMapping!==Cf&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Cf);let n=(a=this.postprocessingContext)==null?void 0:a.components.find(c=>c instanceof oc);n||(n=new oc,(l=this.postprocessingContext)==null||l.components.push(n)),this.postExposure.onValueChanged=c=>{this.postExposure.overrideState&&(n.exposure.value=c)};const r=new ok;this.contrast.onValueChanged=c=>r.contrast=c;const o=new uk;return t.push(r),t.push(o),this.hueShift.onValueChanged=c=>o.hue=c,this.saturation.onValueChanged=c=>o.saturation=c,t}}Z0([v(Ae)],qu.prototype,"postExposure",void 0);Z0([v(Ae)],qu.prototype,"contrast",void 0);Z0([v(Ae)],qu.prototype,"hueShift",void 0);Z0([v(Ae)],qu.prototype,"saturation",void 0);oa("ColorAdjustments",qu);const A2=Math.sqrt(5),W9=(A2-1)/4,Fn=(5-A2)/20,VA=s=>Math.floor(s)|0,WA=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function q9(s=Math.random){const i=X9(s),t=new Float64Array(i).map(a=>WA[a%32*4]),n=new Float64Array(i).map(a=>WA[a%32*4+1]),r=new Float64Array(i).map(a=>WA[a%32*4+2]),o=new Float64Array(i).map(a=>WA[a%32*4+3]);return function(l,c,u,d){let f,p,g,m,A;const y=(l+c+u+d)*W9,b=VA(l+y),_=VA(c+y),w=VA(u+y),S=VA(d+y),E=(b+_+w+S)*Fn,I=b-E,k=_-E,T=w-E,P=S-E,B=l-I,M=c-k,U=u-T,G=d-P;let W=0,Y=0,D=0,L=0;B>M?W++:Y++,B>U?W++:D++,B>G?W++:L++,M>U?Y++:D++,M>G?Y++:L++,U>G?D++:L++;const V=W>=3?1:0,te=Y>=3?1:0,K=D>=3?1:0,ue=L>=3?1:0,de=W>=2?1:0,_e=Y>=2?1:0,Ee=D>=2?1:0,Xe=L>=2?1:0,Me=W>=1?1:0,Ke=Y>=1?1:0,Pt=D>=1?1:0,Tt=L>=1?1:0,hi=B-V+Fn,Ei=M-te+Fn,Ps=U-K+Fn,Wr=G-ue+Fn,ss=B-de+2*Fn,Ar=M-_e+2*Fn,qr=U-Ee+2*Fn,Xr=G-Xe+2*Fn,Ro=B-Me+3*Fn,Bo=M-Ke+3*Fn,Yr=U-Pt+3*Fn,vr=G-Tt+3*Fn,Dn=B-1+4*Fn,er=M-1+4*Fn,yr=U-1+4*Fn,rs=G-1+4*Fn,Ms=b&255,ks=_&255,On=w&255,Zi=S&255;let os=.6-B*B-M*M-U*U-G*G;if(os<0)f=0;else{const yt=Ms+i[ks+i[On+i[Zi]]];os*=os,f=os*os*(t[yt]*B+n[yt]*M+r[yt]*U+o[yt]*G)}let tr=.6-hi*hi-Ei*Ei-Ps*Ps-Wr*Wr;if(tr<0)p=0;else{const yt=Ms+V+i[ks+te+i[On+K+i[Zi+ue]]];tr*=tr,p=tr*tr*(t[yt]*hi+n[yt]*Ei+r[yt]*Ps+o[yt]*Wr)}let as=.6-ss*ss-Ar*Ar-qr*qr-Xr*Xr;if(as<0)g=0;else{const yt=Ms+de+i[ks+_e+i[On+Ee+i[Zi+Xe]]];as*=as,g=as*as*(t[yt]*ss+n[yt]*Ar+r[yt]*qr+o[yt]*Xr)}let un=.6-Ro*Ro-Bo*Bo-Yr*Yr-vr*vr;if(un<0)m=0;else{const yt=Ms+Me+i[ks+Ke+i[On+Pt+i[Zi+Tt]]];un*=un,m=un*un*(t[yt]*Ro+n[yt]*Bo+r[yt]*Yr+o[yt]*vr)}let zt=.6-Dn*Dn-er*er-yr*yr-rs*rs;if(zt<0)A=0;else{const yt=Ms+1+i[ks+1+i[On+1+i[Zi+1]]];zt*=zt,A=zt*zt*(t[yt]*Dn+n[yt]*er+r[yt]*yr+o[yt]*rs)}return 27*(f+p+g+m+A)}}function X9(s){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const r=n+~~(s()*(256-n)),o=t[n];t[n]=t[r],t[r]=o}for(let n=256;n<512;n++)t[n]=t[n-256];return t}const Z_=Q("debugstencil");function Y9(s,i){return(s&1<<i.layer)!=0}const K9=Symbol("stencils"),eu=class{constructor(i,t){h(this,"parser");h(this,"source");this.parser=i,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(i){if(!i)return;const t=i.sourceId;if(Z_&&console.log(t,eu.stencils),!t)return;const n=eu.stencils[t];if(n)for(let r=n.length-1;r>=0;r--){const o=n[r];if(Y9(o.layer,i)){Z_&&console.log(o),setTimeout(()=>{fr()&&zS(i.gameObject)&&(Xt("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",i))},500);for(let a=0;a<i.sharedMaterials.length;a++){let l=i.sharedMaterials[a];l&&(l=l.clone(),l[K9]=!0,l.stencilWrite=!0,l.stencilWriteMask=255,l.stencilFuncMask=255,l.stencilRef=o.value,l.stencilFunc=o.compareFunc,l.stencilZPass=o.passOp,l.stencilFail=o.failOp,l.stencilZFail=o.zFailOp,i.sharedMaterials[a]=l)}i.gameObject.renderOrder=o.event*1e3+o.index*50;break}}}afterRoot(i){const t=this.parser.json.extensions;if(t){const n=t[Z9];if(n){Z_&&console.log(n);const r=n.stencil;if(r&&Array.isArray(r))for(const o of r){const a={...o};a.compareFunc=J9(a.compareFunc),a.passOp=$_(a.passOp),a.failOp=$_(a.failOp),a.zFailOp=$_(a.zFailOp),eu.stencils[this.source]||(eu.stencils[this.source]=[]),eu.stencils[this.source].push(a)}}}return null}};let yg=eu;h(yg,"stencils",{});var _a;(function(s){s[s.Keep=0]="Keep",s[s.Zero=1]="Zero",s[s.Replace=2]="Replace",s[s.IncrementSaturate=3]="IncrementSaturate",s[s.DecrementSaturate=4]="DecrementSaturate",s[s.Invert=5]="Invert",s[s.IncrementWrap=6]="IncrementWrap",s[s.DecrementWrap=7]="DecrementWrap"})(_a||(_a={}));var wa;(function(s){s[s.Disabled=0]="Disabled",s[s.Never=1]="Never",s[s.Less=2]="Less",s[s.Equal=3]="Equal",s[s.LessEqual=4]="LessEqual",s[s.Greater=5]="Greater",s[s.NotEqual=6]="NotEqual",s[s.GreaterEqual=7]="GreaterEqual",s[s.Always=8]="Always"})(wa||(wa={}));function $_(s){switch(s){case _a.Keep:return LF;case _a.Zero:return OF;case _a.Replace:return DF;case _a.IncrementSaturate:return kF;case _a.DecrementSaturate:return MF;case _a.IncrementWrap:return PF;case _a.DecrementWrap:return BF;case _a.Invert:return RF}return 0}function J9(s){switch(s){case wa.Never:return y1;case wa.Less:return GF;case wa.Equal:return jF;case wa.LessEqual:return QF;case wa.Greater:return zF;case wa.NotEqual:return NF;case wa.GreaterEqual:return UF;case wa.Always:return FF}return y1}const Z9="NEEDLE_render_objects";var v2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Tp=Q("debugreflectionprobe"),RR=Q("noreflectionprobe"),$9=Symbol("reflectionProbeKey"),eW=Symbol("original material"),Ea=class extends oe{constructor(){var t;super();h(this,"_texture");h(this,"center");h(this,"size");h(this,"_boxHelper");Ea._probes.has(this.context)||Ea._probes.set(this.context,[]),(t=Ea._probes.get(this.context))==null||t.push(this)}static get(t,n,r,o){if(!t||t.isObject3D!==!0||RR)return null;const a=Ea._probes.get(n);if(a){for(const l of a)if(l.__didAwake||l.__internalAwake(),l.enabled){if(o){if(l.gameObject===o)return l}else if(l.isInBox(t,void 0))return Tp&&console.log("Found reflection probe",t.name,l.name),l}}return Tp&&console.debug("Did not find reflection probe",t.name,r,t),null}set texture(t){if(t&&!(t instanceof At)){console.error("ReflectionProbe.texture must be a Texture",t);return}this._texture=t,t&&(t.mapping=Ya,t.colorSpace=He,t.needsUpdate=!0)}get texture(){return this._texture}isInBox(t,n){var r;return(r=this._boxHelper)==null?void 0:r.isInBox(t,n)}awake(){this._boxHelper=this.gameObject.addNewComponent(Xo),this._boxHelper.updateBox(!0),Tp&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=Ya,this.texture.colorSpace=He,this.texture.needsUpdate=!0)}onDestroy(){const t=Ea._probes.get(this.context);if(t){const n=t.indexOf(this);n>=0&&t.splice(n,1)}}onSet(t){var r;if(RR||!this.enabled||((r=t.sharedMaterials)==null?void 0:r.length)<=0||!this.texture)return;let n=Ea._rendererMaterialsCache.get(t);n||(n=[],Ea._rendererMaterialsCache.set(t,n));for(let o=0;o<t.sharedMaterials.length;o++){const a=t.sharedMaterials[o];if(!a||a.envMap===void 0||a instanceof _t)continue;let l=n[o];const c=a===(l==null?void 0:l.copy),u=!l||l.material.uuid!==a.uuid||l.copy.version!==a.version;if(!c&&u){if(Tp){let p="";l?l.material!==a?p="reference changed; cached instance?: "+c:l.copy.version!==a.version&&(p="version changed"):p="not cached",console.warn("Cloning material",a.name,a.version,"Reason:",p,`
`,a.uuid,`
`,l==null?void 0:l.copy.uuid,`
`,t.name)}const f=a.clone();f.version=a.version,l?(l.copy=f,l.material=a):(l={material:a,copy:f},n.push(l)),f[$9]=this,f[eW]=a,Tp&&console.log("Set reflection",t.name,t.guid)}l&&l.copy&&(l.copy.onBeforeCompile=a.onBeforeCompile);const d=l==null?void 0:l.copy;d.envMap=this.texture,t.sharedMaterials[o]=d}}onUnset(t){const n=Ea._rendererMaterialsCache.get(t);if(n)for(let r=0;r<n.length;r++){const o=n[r];t.sharedMaterials[r]=o.material}}};let Wl=Ea;h(Wl,"_probes",new Map),h(Wl,"_rendererMaterialsCache",new Map);v2([v(x)],Wl.prototype,"center",void 0);v2([v(x)],Wl.prototype,"size",void 0);const ew=Q("debugexr");class tW{constructor(i){h(this,"parser");this.parser=i,ew&&console.log(i)}get name(){return"EXT_texture_exr"}loadTexture(i){const t=this.name,n=this.parser,o=n.json.textures[i];if(ew&&console.log("EXT_texture_exr.loadTexture",i,o),!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],l=new sm(n.options.manager);return ew&&console.log("EXT_texture_exr.loadTexture",a),n.loadTextureImage(i,a.source,l)}}typeof window<"u"&&window.addEventListener("unhandledrejection",s=>{});const wl=bn,qA="$___Export_Components",iW="NEEDLE_components";var jY;class nW{constructor(){h(this,jY)}}jY=xd;class sW{constructor(i,t,n){h(this,"node");h(this,"nodeIndex");h(this,"nodeDef");this.node=i,this.nodeIndex=t,this.nodeDef=n}}class rW{constructor(){h(this,"parser");h(this,"nodeToObjectMap",{});h(this,"exportContext");h(this,"objectToNodeMap",{});h(this,"context");h(this,"writer")}get name(){return iW}registerExport(i){i.register(t=>{if("serializeUserData"in t){const n=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(r,o)=>{try{this.serializeUserData(r,o),n(r,o)}finally{this.afterSerializeUserData(r,o)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(i,t){var r;const n=(r=i.userData)==null?void 0:r.components;!n||n.length<=0||(delete i.userData.components,i[qA]=n)}afterSerializeUserData(i,t){if(i.type==="Scene"&&wl&&console.log("DONE",JSON.stringify(t)),i[qA]===void 0)return;const n=i[qA];delete i[qA],n!==null&&(i.userData.components=n)}writeNode(i,t){const n=this.writer.json.nodes.length;wl&&console.log(i.name,n,i.uuid);const r=new sW(i,n,t);this.exportContext[n]=r,this.objectToNodeMap[i.uuid]=n}afterParse(i){var t;wl&&console.log("AFTER",i);for(const n in this.exportContext){const r=this.exportContext[n],o=r.node,a=r.nodeDef,l=r.nodeIndex,c=(t=o.userData)==null?void 0:t.components;if(!c||c.length<=0)continue;const u=new nW;a.extensions=a.extensions||{},a.extensions[this.name]=u,this.context.object=o,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const d=[];for(const f of c){this.context.target=f;const p=nl().writeBuiltinComponentData(f,this.context);p!==null&&d.push(p)}d.length>0&&(u[xd]=d,wl&&console.log("DID WRITE",o,"nodeIndex",l,d))}}beforeRoot(){return wl&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(i){const t=i.parser,n=t==null?void 0:t.extensions;if(!n)return;const r=n[this.name];wl&&console.log("After root",i,this.parser,n);const o=[];if(r===!0){const a=t.json.nodes;if(a){for(let l=0;l<a.length;l++){const c=await t.getDependency("node",l);this.nodeToObjectMap[l]=c}for(let l=0;l<a.length;l++){const c=a[l],u=l,d=c.extensions;if(!d)continue;const f=d[this.name];if(!f)continue;wl&&console.log("NODE",c);const p=this.nodeToObjectMap[u];if(!p){console.error("Could not find object for node index: "+u,c,t);continue}NS(p),o.push(this.createComponents(p,f))}}}await Promise.all(o);for(const a of t.associations.keys()){const l=t.associations.get(a);if((l==null?void 0:l.materials)!=null){const c="/materials/"+l.materials;J5(a,c)}}}async createComponents(i,t){if(!t)return;const n=t[xd];if(n){const r=new Array;wl&&console.log(i.name,n);for(const o in n){const a=n[o];wl&&console.log("Serialized data",JSON.parse(JSON.stringify(a))),a&&this.parser&&r.push(OS(this.parser,a).catch(l=>console.error(`Error while resolving references (see console for details)
`,l,i,a))),i.userData=i.userData||{},i.userData[xd]=i.userData[xd]||[],i.userData[xd].push(a)}await Promise.all(r).catch(o=>{console.error("Error while loading components",o)})}}}const BR="NEEDLE_gameobject_data";class oW{constructor(i){h(this,"parser");this.parser=i}get name(){return BR}afterRoot(i){var n;const t=[];for(let r=0;r<((n=this.parser.json.nodes)==null?void 0:n.length);r++){const o=this.parser.json.nodes[r];if(o&&o.extensions){const a=o.extensions[BR];if(a){const l=this.findAndApplyExtensionData(r,a);t.push(l)}}}return Promise.all(t).then(()=>null)}async findAndApplyExtensionData(i,t){const n=await this.parser.getDependency("node",i);n&&this.applyExtensionData(n,t)}applyExtensionData(i,t){t.layers===void 0&&(t.layers=0),i.userData.layer=t.layers,i.layers.disableAll(),i.layers.set(t.layers),i.userData.tag=t.tag??"none",i.userData.hideFlags=t.hideFlags??0,i.userData.static=t.static??!1,i.visible=t.activeSelf??!0,i.guid=t.guid}}const PR="NEEDLE_lighting_settings",Rd=Q("debugenvlight");class aW{constructor(i,t,n){h(this,"parser");h(this,"sourceId");h(this,"context");this.parser=i,this.sourceId=t,this.context=n}get name(){return PR}afterRoot(i){const t=this.parser.json.extensions;if(t){const n=t[PR];if(n){Rd&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',n);let r;if(i.scene.children.length===1){const o=i.scene.children[0];r=j.addNewComponent(o,Zx,{},!1)}else{const o=new ne;o.name="LightSettings "+this.sourceId,i.scene.add(o),r=j.addNewComponent(o,Zx,{},!1)}r.sourceId=this.sourceId,r.ambientIntensity=n.ambientIntensity,r.ambientLight=new xe().fromArray(n.ambientLight),Array.isArray(n.ambientTrilight)&&(r.ambientTrilight=n.ambientTrilight.map(o=>new xe().fromArray(o))),r.ambientMode=n.ambientMode,r.environmentReflectionSource=n.environmentReflectionSource}}return null}}xt.registerCallback(ut.ContextCreated,s=>{const i=s.context,t=j.findObjectOfType(Zx,i);t!=null&&t.sourceId&&(t.enabled=!0)});class Zx extends oe{constructor(){super(...arguments);h(this,"ambientMode",La.Skybox);h(this,"ambientLight");h(this,"ambientTrilight");h(this,"ambientIntensity",1);h(this,"environmentReflectionSource",rm.Skybox);h(this,"_hasReflection",!1);h(this,"_ambientLightObj");h(this,"_hemisphereLightObj")}awake(){var n;if(this.sourceId){const r=this.environmentReflectionSource===rm.Skybox?Gl.Skybox:Gl.Reflection,o=this.context.lightmaps.tryGet(this.sourceId,r,0);this._hasReflection=o!=null,o&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,o)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Rd&&window.addEventListener("keydown",r=>{if(!this.destroyed)switch(r.key){case"l":this.enabled=!this.enabled;break}});const t=(n=this.gameObject.userData)==null?void 0:n.components;if(t){const r=t.indexOf(this);t.splice(r,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const n=Math.max(t.r,t.g,t.b);return 2.2*ye.lerp(0,1.33,n)}onEnable(){if(Rd&&console.warn("ðŸ’¡ðŸŸ¡ >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==La.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new FP(this.ambientLight,this.ambientIntensity*t),Rd&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===La.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],n=this.ambientTrilight[this.ambientTrilight.length-1],r=this.calculateIntensityFactor(n);this._hemisphereLightObj=new HF(n,t,this.ambientIntensity*r),this.gameObject.add(this._hemisphereLightObj),Rd&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,r)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Rd&&console.warn("ðŸ’¡âš« <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var MR;(function(s){s[s.Fragment=35632]="Fragment",s[s.Vertex=35633]="Vertex"})(MR||(MR={}));var $x;(function(s){s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN"})($x||($x={}));const Qc=Q("debugcustomshader"),gd="NEEDLE_techniques_webgl";var kR;(function(s){s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN"})(kR||(kR={}));class lW{constructor(){h(this,"objectToWorldMatrix",new le);h(this,"worldToObjectMatrix",new le);h(this,"objectToWorld",new Array);h(this,"worldToObject",new Array)}updateFrom(i){this.objectToWorldMatrix.copy(i.matrixWorld),dy(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(i.matrixWorld).invert(),dy(this.worldToObjectMatrix,this.worldToObject)}}var bg;(function(s){s[s.Off=0]="Off",s[s.Front=1]="Front",s[s.Back=2]="Back"})(bg||(bg={}));var Il;(function(s){s[s.Never=1]="Never",s[s.Less=2]="Less",s[s.Equal=3]="Equal",s[s.LEqual=4]="LEqual",s[s.Greater=5]="Greater",s[s.NotEqual=6]="NotEqual",s[s.GEqual=7]="GEqual",s[s.Always=8]="Always"})(Il||(Il={}));const fi=class extends NP{constructor(t,...n){super(...n);h(this,"identifier");h(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));h(this,"_sphericalHarmonicsName","unity_SpecCube0");h(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");h(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");h(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");h(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");h(this,"_rendererData",new lW);this.identifier=t,Qc&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Ge.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return y2(t),t}dispose(){super.dispose();const t=Ge.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Ge.Current.pre_render_callbacks.splice(t,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Ge.Current.setRequireColor(!0),this.depthTextureUniform&&Ge.Current.setRequireDepth(!0)}onBeforeRender(t,n,r,o,a,l){o.attributes.tangent||o.computeTangents(),this.onUpdateUniforms(r,a)}onUpdateUniforms(t,n){const r=Ge.Current;if(t&&(fi.viewProjection&&this.uniforms[this._viewProjectionName]&&(fi.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),dy(fi.viewProjection,fi._viewProjectionValues)),fi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(fi.viewMatrix.copy(t.matrixWorldInverse),dy(fi.viewMatrix,fi._viewMatrixValues)),this.uniforms[fi._worldSpaceCameraPosName]&&fi._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=r.sceneLighting.timeVec4),this.uniforms._Time){const c=this.uniforms._Time.value;c.x=r.sceneLighting.timeVec4.x/20,c.y=r.sceneLighting.timeVec4.x,c.z=r.sceneLighting.timeVec4.x*2,c.w=r.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const c=this.uniforms._SinTime.value;c.x=Math.sin(r.sceneLighting.timeVec4.x/8),c.y=Math.sin(r.sceneLighting.timeVec4.x/4),c.z=Math.sin(r.sceneLighting.timeVec4.x/2),c.w=Math.sin(r.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const c=this.uniforms._CosTime.value;c.x=Math.cos(r.sceneLighting.timeVec4.x/8),c.y=Math.cos(r.sceneLighting.timeVec4.x/4),c.z=Math.cos(r.sceneLighting.timeVec4.x/2),c.w=Math.cos(r.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const c=this.uniforms.unity_DeltaTime.value;c.x=r.time.deltaTime,c.y=1/r.time.deltaTime,c.z=r.time.smoothedDeltaTime,c.w=1/r.time.smoothedDeltaTime}const o=r.mainLight;if(o){const c=Ve(o.gameObject,fi._mainLightPosition);this.uniforms._MainLightPosition={value:c.normalize()},fi._mainLightColor.set(o.color.r,o.color.g,o.color.b,0),this.uniforms._MainLightColor={value:fi._mainLightColor};const u=o.intensity;fi._lightData.z=u,this.uniforms.unity_LightData={value:fi._lightData}}if(t&&(fi.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=fi._viewProjectionValues),fi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=fi._viewMatrixValues),this.uniforms[fi._worldSpaceCameraPosName]&&(this.uniforms[fi._worldSpaceCameraPosName]={value:fi._worldSpaceCameraPos}),r.mainCameraComponent)){if(this.uniforms._ProjectionParams){const c=this.uniforms._ProjectionParams.value;c.x=1,c.y=r.mainCameraComponent.nearClipPlane,c.z=r.mainCameraComponent.farClipPlane,c.w=1/c.z,this.uniforms._ProjectionParams.value=c}if(this.uniforms._ZBufferParams){const c=this.uniforms._ZBufferParams.value,u=r.mainCameraComponent;c.x=1-u.farClipPlane/u.nearClipPlane,c.y=u.farClipPlane/u.nearClipPlane,c.z=c.x/u.farClipPlane,c.w=c.y/u.farClipPlane,this.uniforms._ZBufferParams.value=c}if(this.uniforms._ScreenParams){const c=this.uniforms._ScreenParams.value;c.x=r.domWidth,c.y=r.domHeight,c.z=1+1/c.x,c.w=1+1/c.y,this.uniforms._ScreenParams.value=c}if(this.uniforms._ScaledScreenParams){const c=this.uniforms._ScaledScreenParams.value;c.x=r.domWidth,c.y=r.domHeight,c.z=1+1/c.x,c.w=1+1/c.y,this.uniforms._ScaledScreenParams.value=c}}const a=this.depthTextureUniform;a&&(a.value=r.depthTexture);const l=this.opaqueTextureUniform;if(l&&(l.value=r.opaqueColorTexture),n){const c=this._rendererData;c.updateFrom(n),this.uniforms[this._worldToObjectName].value=c.worldToObject,this.uniforms[this._objToWorldName].value=c.objectToWorld}this.uniformsNeedUpdate=!0}};let to=fi;h(to,"viewProjection",new le),h(to,"_viewProjectionValues",[]),h(to,"viewMatrix",new le),h(to,"_viewMatrixValues",[]),h(to,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),h(to,"_worldSpaceCameraPos",new x),h(to,"_mainLightColor",new Ue),h(to,"_mainLightPosition",new x),h(to,"_lightData",new Ue);class cW{constructor(i,t){h(this,"parser");h(this,"identifier");this.parser=i,this.identifier=t}get name(){return gd}loadMaterial(i){const t=this.parser.json.materials[i];if(!t)return Qc&&console.log(i,this.parser.json.materials),null;if(!t.extensions||!t.extensions[gd])return Qc&&console.log("material "+i+" does not use NEEDLE_techniques_webgl"),null;const n=t.extensions[gd].technique;if(n<0)return null;const r=this.parser.json.extensions[gd];if(!r)return null;Qc&&console.log(r);const o=r.techniques[n];return o?new Promise(async(a,l)=>{var b,_,w;const c=await bH(r,o.program),u=c==null?void 0:c.fragmentShader,d=c==null?void 0:c.vertexShader;if(!u||!d)return l();Qc&&console.log("loadMaterial",t,c);const f={},p=o.uniforms;(d.includes("_Time")||u.includes("_Time"))&&(f._Time={value:new Ue(0,0,0,0)}),(d.includes("_SinTime")||u.includes("_SinTime"))&&(f._SinTime={value:new Ue(0,0,0,0)}),(d.includes("_CosTime")||u.includes("_CosTime"))&&(f._CosTime={value:new Ue(0,0,0,0)}),(d.includes("unity_DeltaTime")||u.includes("unity_DeltaTime"))&&(f.unity_DeltaTime={value:new Ue(0,0,0,0)});for(const S in p){const E=S;switch(E){case"_TimeParameters":const I=new Ue;f[E]={value:I};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":f[E]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":f[E]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":f[E]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":f[E]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":f[E]={value:null};break}}let g=!1;if(t.extensions&&t.extensions[gd]){const S=t.extensions[gd];if(S.technique===n){Qc&&console.log(t.name,"Material Properties",S);for(const E in S.values){const I=S.values[E];if(typeof I=="string"){if(I.startsWith("/textures/")){const k=I.substring(10),T=Number.parseInt(k);if(T>=0){const P=await this.parser.getDependency("texture",T);P instanceof At&&(P.colorSpace=zi,P.needsUpdate=!0),f[E]={value:P};continue}}switch(E){case"alphaMode":I==="BLEND"&&(g=!0);continue}}if(Array.isArray(I)&&I.length===4){f[E]={value:new Ue(I[0],I[1],I[2],I[3])};continue}f[E]={value:I}}}}const m=new to(this.identifier,{name:t.name??"",uniforms:f,vertexShader:d,fragmentShader:u,lights:!1});switch(m.glslVersion=VF,m.vertexShader=m.vertexShader.replace("#version 300 es",""),m.fragmentShader=m.fragmentShader.replace("#version 300 es",""),(b=f._Cull)==null?void 0:b.value){case bg.Off:m.side=_i;break;case bg.Front:m.side=Wc;break;case bg.Back:m.side=il;break;default:m.side=il;break}switch((_=f._ZTest)==null?void 0:_.value){case Il.Equal:m.depthTest=!0,m.depthFunc=Qv;break;case Il.NotEqual:m.depthTest=!0,m.depthFunc=IC;break;case Il.Less:m.depthTest=!0,m.depthFunc=Dw;break;case Il.LEqual:m.depthTest=!0,m.depthFunc=SP;break;case Il.Greater:m.depthTest=!0,m.depthFunc=xP;break;case Il.GEqual:m.depthTest=!0,m.depthFunc=CP;break;case Il.Always:m.depthTest=!1,m.depthFunc=EP;break}m.transparent=g,g&&(m.depthWrite=!1),vH(f),m.onUpdateUniforms();for(const S in p){const E=S,I=p[S].type;if(((w=f[E])==null?void 0:w.value)===void 0)switch(I){case $x.SAMPLER_2D:f[E]={value:mH},console.warn("Missing/unassigned texture, fallback to white: "+E);break;default:E==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+E,p[S]);break}}Qc&&console.log(m.uuid,f),y2(m),a(m)}):null}}function y2(s){if(s.uniforms){Qc&&console.log("Uniforms:",s.uniforms);for(const t in s.uniforms)switch(i(t,t),t){case"_Color":i("color",t);break}}function i(t,n){Object.getOwnPropertyDescriptor(s,t)||Object.defineProperty(s,t,{get:()=>s.uniforms[n].value,set:r=>{s.uniforms[n].value=r,s.needsUpdate=!0}})}}const hW=Q("debugextensions");let xy;const uW=hh(()=>import("./GLTFLoaderAnimationPointer-6433c7fb.js"),["./GLTFLoaderAnimationPointer-6433c7fb.js","./three.module-19edce0d.js"],import.meta.url).then(async s=>(xy=s.GLTFAnimationPointerExtension,xy)).catch(s=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",s)}),Ru=new Array;function lJ(s){Ru.includes(s)||Ru.push(s)}function cJ(s){const i=Ru.indexOf(s);i>=0&&Ru.splice(i,1)}function b2(s){const i=new rW;return s.register(t=>(i.parser=t,i)),i}class dW{resolvePath(i){return i.includes("/extensions/builtin_components/")?i.replace("/extensions/builtin_components/","/userData/components/"):i.includes("extensions/builtin_components/")?i.replace("extensions/builtin_components/","/userData/components/"):i}}async function _2(s,i,t){const n=t.indexOf("?");n>=0&&(t=t.substring(0,n)),s.register(r=>new oW(r)),s.register(r=>new $5(r)),s.register(r=>new hH(r,i.lightmaps,t)),s.register(r=>new aW(r,t,i)),s.register(r=>new cW(r,t)),s.register(r=>new yg(r,t)),s.register(r=>new pt(r,t)),s.register(r=>new tW(r)),v5()&&s.register(r=>new lg(r)),await uW.catch(r=>{}),s.register(r=>{if(xy){const o=new xy(r);return o.setAnimationPointerResolver.bind(o)(new dW),o}else return(hW||be())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const r of Ru)r.onImport&&r.onImport(s,t,i)}function w2(s,i){for(const t of Ru)t.onExport&&t.onExport(s,i)}function x2(s,i,t){for(const n of Ru)n.onLoaded&&n.onLoaded(s,i,t)}const zo=Q("debuginstancing"),a1=class{constructor(){h(this,"objs",[])}setup(i,t,n,r,o,a=0){i.applySettings(t);const l=this.tryCreateOrAddInstance(t,n,o);if(l)pt.assignTextureLOD(l.renderer.material,0),r===null&&(r=[]),r.push(l);else if(a<=0&&t.type!=="Mesh"){const c=a+1;for(const u of t.children)r=this.setup(i,u,n,r,o,c)}return a===0&&o.useMatrixWorldAutoUpdate&&r&&r.length>=0&&this.autoUpdateInstanceMatrix(t),r}tryCreateOrAddInstance(i,t,n){if(i.type==="Mesh"){const r=n.foundMeshes;if(n.foundMeshes+=1,!n.rend.enableInstancing)return null;if(n.rend.enableInstancing!==!0){if(r>=n.rend.enableInstancing.length)return zo&&console.error("Something is wrong with instance setup",i,n.rend.enableInstancing,r),null;if(!n.rend.enableInstancing[r])return null}const o=i,a=o.material;for(const f of this.objs){if(!f.canAdd(o.geometry,a))continue;return f.addInstance(o)}const l=16;let c=i.name;c!=null&&c.length||(c=aU());const u=new C2(c,o.geometry,a,l,t);return this.objs.push(u),u.addInstance(o)}return null}autoUpdateInstanceMatrix(i){const t=i.matrixWorld.multiplyMatrices.bind(i.matrixWorld),n=i.matrixWorld.clone(),r=(o,a)=>{const l=t(o,a);return(i[tm]||n.equals(l)===!1)&&(n.copy(l),i[tm]=!0),l};i.matrixWorld.multiplyMatrices=r}};let pf=a1;h(pf,"instance",new a1);const Lg=class{constructor(i,t){h(this,"object");h(this,"renderer");h(this,"__instanceIndex",-1);h(this,"__reservedVertexRange",0);h(this,"__reservedIndexRange",0);h(this,"meshInformation");this.__instanceIndex=-1,this.object=i,this.renderer=t,i[WD]=t,this.meshInformation=Bd(i.geometry),Lg.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(i=!1,t=!0){this.__instanceIndex<0||(t&&this.object.updateWorldMatrix(!0,i),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(i){this.__instanceIndex<0||this.renderer.updateInstance(i,this.__instanceIndex)}setGeometry(i){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(i,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),j.markAsInstancedRendered(this.object,!0))}remove(i){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,i),j.markAsInstancedRendered(this.object,!1),i)){const t=Lg.all.indexOf(this);t>=0&&Lg.all.splice(t,1)}}};let gf=Lg;h(gf,"all",[]);class C2{constructor(i,t,n,r,o){h(this,"allowResize",!0);h(this,"name","");h(this,"geometry");h(this,"material");h(this,"_context");h(this,"_batchedMesh");h(this,"_handles",[]);h(this,"_maxInstanceCount");h(this,"_currentInstanceCount",0);h(this,"_currentVertexCount",0);h(this,"_currentIndexCount",0);h(this,"_maxVertexCount");h(this,"_maxIndexCount");h(this,"_needUpdateBounds",!1);h(this,"_debugMaterial",null);h(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[Gp]===!0&&(zo&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())});h(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()});h(this,"_availableBuckets",new Array);h(this,"_usedBuckets",new Array);this.name=i,this.geometry=t,this.material=n,this._context=o,this._maxInstanceCount=Math.max(2,r),zo&&(this._debugMaterial=DR());const a=this.tryEstimateVertexCountSize(this._maxInstanceCount,[t],r);this._maxVertexCount=a.vertexCount,this._maxIndexCount=a.indexCount,this._batchedMesh=new b1(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[Gp]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),n instanceof NP&&(n.defines.USE_INSTANCING=!0,n.needsUpdate=!0),o.pre_render_callbacks.push(this.onBeforeRender),o.post_render_callbacks.push(this.onAfterRender),zo&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${i}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(i){this._batchedMesh.visible=i}get castShadow(){return this._batchedMesh.castShadow}set castShadow(i){this._batchedMesh.castShadow=i}set receiveShadow(i){this._batchedMesh.receiveShadow=i}get count(){return this._currentInstanceCount}updateBounds(i=!0,t=!0){this._needUpdateBounds=!1,i&&this._batchedMesh.computeBoundingBox(),t&&this._batchedMesh.computeBoundingSphere()}canAdd(i,t){return this._maxVertexCount>1e7||t!==this.material?!1:!!(!this.mustGrow(i)||this.allowResize)}dispose(){zo&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(i){const t=new gf(i,this);i.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),i.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(t)}catch(n){return console.error(`Failed adding mesh to instancing
`,n),be()&&dS("Failed instancing mesh. See the browser console for details."),null}return t}add(i){const t=i.object.geometry;if(!this.validateGeometry(t)){zo&&console.error("Cannot add instance, invalid geometry",this.name,t);return}if(this.mustGrow(t))if(this.allowResize)this.grow(t);else{console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount);return}i.object.updateWorldMatrix(!0,!0),this.addGeometry(i),this._handles[i.__instanceIndex]=i,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0)}remove(i,t){i&&(i.__instanceIndex<0||this._handles[i.__instanceIndex]!=i||this._currentInstanceCount<=0||(this.removeGeometry(i,t),this._handles[i.__instanceIndex]=null,i.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(i,t){this._batchedMesh.setMatrixAt(t,i),this.markNeedsUpdate()}updateGeometry(i,t){return this.validateGeometry(i)?(this.mustGrow()&&this.grow(i),zo&&console.debug("UPDATE MESH",t,i.name,Bd(i),i.attributes.position.count,i.index?i.index.count:0),this._batchedMesh.setGeometryAt(t,i),this.markNeedsUpdate(),!0):!1}validateGeometry(i){return this.geometry,!0}markNeedsUpdate(){this._needUpdateBounds=!0}mustGrow(i){if(this.count>=this._maxInstanceCount)return!0;if(!i)return!1;const t=Bd(i),n=t.vertexCount,r=t.indexCount;return this._currentVertexCount+n>this._maxVertexCount||this._currentIndexCount+r>this._maxIndexCount}grow(i){const t=this._maxInstanceCount*2,n=this.tryEstimateVertexCountSize(t,[i]),r=Math.max(this._maxVertexCount,n.vertexCount),o=Math.max(this._maxIndexCount,n.indexCount,this._maxVertexCount*2);if(zo){const l=Bd(i);console.warn(`Growing batched mesh for "${this.name}/${i.name}" ${l.vertexCount} vertices, ${l.indexCount} indices
Max count ${this._maxInstanceCount} â†’ ${t}
Max vertex count ${this._maxVertexCount} -> ${r}
Max index count ${this._maxIndexCount} -> ${o}`),this._debugMaterial=DR()}this._maxVertexCount=r,this._maxIndexCount=o;const a=new b1(t,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);a.layers=this._batchedMesh.layers,a.castShadow=this._batchedMesh.castShadow,a.receiveShadow=this._batchedMesh.receiveShadow,a.visible=this._batchedMesh.visible,a[Gp]=this._batchedMesh[Gp],a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorld.copy(this._batchedMesh.matrixWorld),a.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._batchedMesh=a,this._maxInstanceCount=t;for(const l of this._handles)l&&l.__instanceIndex>=0&&this.addGeometry(l);this._context.scene.add(a)}tryEstimateVertexCountSize(i,t,n=1){const r=new Map;for(const f of this._handles)if(f&&f.__instanceIndex>=0)if(r.has(f.object.geometry)){const p=r.get(f.object.geometry);p.count+=1}else{const p={count:1,...Bd(f.object.geometry)};r.set(f.object.geometry,p)}let o=0,a=0;for(const[f,p]of r)o+=p.vertexCount*p.count,a+=p.indexCount*p.count;let c=Math.ceil(o/Math.max(1,this._currentInstanceCount))*i,d=Math.ceil(a/Math.max(1,this._currentInstanceCount))*i*2;if(t)for(const f of t){const p=Bd(f);c+=p.vertexCount*n,d+=p.indexCount*n}return{vertexCount:c,indexCount:d}}addGeometry(i){let t=null,n=-1;for(let a=this._availableBuckets.length-1;a>=0;a--){const l=this._availableBuckets[a];l.vertexCount>=i.maxVertexCount&&l.indexCount>=i.maxIndexCount&&(t==null||l.vertexCount<t.vertexCount)&&(t=l,n=a)}if(t!=null){const a=t;zo&&console.debug(`RE-USE SPACE #${a.index}, ${i.maxVertexCount} vertices, ${i.maxIndexCount} indices, ${i.name}`),this._batchedMesh.setGeometryAt(a.index,i.object.geometry),this._batchedMesh.setMatrixAt(a.index,i.object.matrixWorld),this._batchedMesh.setVisibleAt(a.index,!0),i.__instanceIndex=a.index,this._usedBuckets[a.index]=a,this._availableBuckets.splice(n,1);return}const r=i.object.geometry;zo&&console.debug("ADD GEOMETRY",r.name,`
vertex:`,`${this._currentVertexCount} + ${i.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,i.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const o=this._batchedMesh.addGeometry(r,i.maxVertexCount,i.maxIndexCount);i.__instanceIndex=o,i.__reservedVertexRange=i.maxVertexCount,i.__reservedIndexRange=i.maxIndexCount,this._currentVertexCount+=i.maxVertexCount,this._currentIndexCount+=i.maxIndexCount,this._usedBuckets[o]={index:o,vertexCount:i.maxVertexCount,indexCount:i.maxIndexCount},this._batchedMesh.setMatrixAt(o,i.object.matrixWorld),zo&&console.debug(`ADD MESH & RESERVE SPACE #${o}, ${i.maxVertexCount} vertices, ${i.maxIndexCount} indices, ${i.name} ${i.object.uuid}`)}removeGeometry(i,t){i.__instanceIndex<0||(this._usedBuckets.splice(i.__instanceIndex,1),this._batchedMesh.setVisibleAt(i.__instanceIndex,!1),this._availableBuckets.push({index:i.__instanceIndex,vertexCount:i.reservedVertexCount,indexCount:i.reservedIndexCount}))}}h(C2,"nullMatrix",new le);function Bd(s){let i=s.attributes.position.count,t=s.index?s.index.count:0;const n=pt.getMeshLODInformation(s);if(n){const r=n.lods[0];let o=r.vertexCount,a=r.indexCount;o+=10,o+=o*.05,a+=20,i=Math.max(i,o),t=Math.max(t,a)}return i=Math.ceil(i),t=Math.ceil(t),{vertexCount:i,indexCount:t}}function DR(){const s=new Jn({color:new xe(Math.random(),Math.random(),Math.random())});return s.emissive=s.color,s.emissiveIntensity=.3,Q("wireframe")&&(s.wireframe=!0),s}const md=Q("debuglightmaps");class Cy{constructor(i,t){h(this,"lightmapIndex",-1);h(this,"lightmapScaleOffset",new Ue(1,1,0,0));h(this,"context");h(this,"gameObject");h(this,"lightmapTexture",null);h(this,"lightmapScaleOffsetUniform",{value:new Ue(1,1,0,0)});h(this,"lightmapUniform",{value:null});h(this,"onBeforeCompile",(i,t)=>{md&&console.log(`Lightmaps, before compile
`,i),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,i.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=i,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(i){i!==this.lightmapTexture&&(this.lightmapTexture=i,this.applyLightmap(),this.lightmapTexture&&pt.assignTextureLOD(this.lightmapTexture,0).then(t=>{t!=null&&t.isTexture&&(this.lightmapTexture=t)}))}init(i,t,n){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=i,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=n,pt.assignTextureLOD(n,0).then(r=>{r!=null&&r.isTexture&&(this.lightmapTexture=r)}),md=="show"?(console.log("Lightmap:",this.gameObject.name,i,`
ScaleOffset:`,t,`
Texture:`,n),this.setLightmapDebugMaterial()):md&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(i){const t=i.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){md&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const i=this.gameObject;if(i.geometry.getAttribute("uv1")||i.geometry.setAttribute("uv1",i.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let n=0;n<t.length;n++)t[n]=this.ensureLightmapMaterial(t[n])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const t=this.gameObject.material;if(Array.isArray(t))for(const n of t)this.assignLightmapTexture(n);else t&&this.assignLightmapTexture(t)}}ensureLightmapMaterial(i){return i.userData||(i.userData={}),i["NEEDLE:lightmap-material-version"]!=i.version&&i["NEEDLE:lightmap-material-version"]==null&&(md&&console.warn("Cloning material for lightmap "+i.name),i=i.clone(),i.onBeforeCompile=this.onBeforeCompile),i}assignLightmapTexture(i){!i||i instanceof _o&&i.transmission>0||!(i.lightMap!==this.lightmapTexture||i["NEEDLE:lightmap-material-version"]!==i.version)||(md&&console.log("Assigning lightmap",i.name,i.version),i.lightMap=this.lightmapTexture,i["NEEDLE:lightmap-material-version"]=i.version)}setLightmapDebugMaterial(){this.gameObject.material=new et({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var fc=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Yp=Q("debugrenderer"),OR=Q("debugskinnedmesh"),LR=Q("noinstancing"),fW=Q("wireframe");var Qd;(function(s){s[s.Off=0]="Off",s[s.BlendProbes=1]="BlendProbes",s[s.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",s[s.Simple=3]="Simple"})(Qd||(Qd={}));class S2{constructor(){h(this,"path",null);h(this,"asset",null);h(this,"default")}}var FR;(function(s){s[s.Both=0]="Both",s[s.Back=1]="Back",s[s.Front=2]="Front"})(FR||(FR={}));class pW{constructor(i,t){h(this,"_renderer");h(this,"_targets",[]);h(this,"_indexMapMaxIndex");h(this,"_indexMap");h(this,"_changed",!1);this._renderer=i;const n=this.setMaterial.bind(this),r=this.getMaterial.bind(this),o=i.gameObject;if(this._targets=[],o)switch(o.type){case"Group":this._targets=[...o.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(o);break}let a=!1,l,c=0;for(let u=0;u<this._targets.length;u++){const d=this._targets[u];if(!d)continue;const f=d.material;if(f){f.shadowSide=f.side;for(let p=0;p<t.length;p++){const g=t[p];if(!g){a=!0;continue}if(f.name===g.name){l===void 0&&(l=new Map),l.set(p,u),c=Math.max(c,p);break}}}}if(a){this._indexMapMaxIndex=c,this._indexMap=l;const u=`Renderer ${i.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(u),fr()&&Xt("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(u,d){if(typeof d=="string"){const f=parseInt(d);if(!isNaN(f))return r(f)}return u[d]},set(u,d,f){return typeof d=="string"&&n(f,Number.parseInt(d)),Reflect.set(u,d,f)?(f instanceof mt&&(u.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(i){i===!0&&Yp&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=i}is(i){return this._renderer===i}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let i=0;i<this.length;i++)yield this.getMaterial(i)}resolveIndex(i){const t=this._indexMap;return t&&t.has(i)?t.get(i):i}setMaterial(i,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const n=this._targets[t];!n||n.material===void 0||(n.material=i,this.changed=!0)}getMaterial(i){if(i=this.resolveIndex(i),i<0)return null;const t=this._targets;if(i>=t.length)return null;const n=t[i];return n?n.material:null}}class ci extends oe{constructor(){super(...arguments);h(this,"receiveShadows",!1);h(this,"shadowCastingMode",Sy.Off);h(this,"lightmapIndex",-1);h(this,"lightmapScaleOffset",new Ue(1,1,0,0));h(this,"enableInstancing");h(this,"renderOrder");h(this,"allowOcclusionWhenDynamic",!0);h(this,"probeAnchor");h(this,"reflectionProbeUsage",Qd.Off);h(this,"_lightmaps");h(this,"_sharedMeshes",[]);h(this,"_sharedMaterials");h(this,"_originalMaterials");h(this,"_probeAnchorLastFrame");h(this,"_lightmapTextureOverride");h(this,"allowProgressiveLoading",!0);h(this,"_firstFrame",-1);h(this,"_isInstancingEnabled",!1);h(this,"_handles");h(this,"_handlesTempArray",[]);h(this,"onBeforeRenderThree",(t,n,r,o,a,l)=>{var c;if(a.envMapIntensity!==void 0){const u=this.hasLightmap?Math.PI:1,d=((c=this.context.mainCameraComponent)==null?void 0:c.environmentIntensity)??1;a.envMapIntensity=Math.max(0,d*this.context.sceneLighting.environmentIntensity/u)}if(this._lightmaps)for(const u of this._lightmaps)u.updateLightmapUniforms(a),u.applyLightmap()});h(this,"_reflectionProbe",null)}static setInstanced(t,n){const r=S0(t,ci);return r.setInstancingEnabled(n),r}static isInstanced(t){const n=Qf(t,ci);return n?n.isInstancingActive:ta.isUsingInstancing(t)}static setVisible(t,n){Gc(t,n)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const t of this.gameObject.children)(t.type==="Mesh"||t.type==="SkinnedMesh")&&this._sharedMeshes.push(t);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(t){this.sharedMaterials[0]!==t&&(this.sharedMaterials[0]=t,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(t){this.sharedMaterial=t}set sharedMaterials(t){if(!this._originalMaterials)this._originalMaterials=t;else if(t){let n=!1;for(let r=0;r<this._sharedMaterials.length;r++){const o=r<t.length?t[r]:null;o&&o instanceof mt?this.sharedMaterials[r]=o:n||(n=!0,console.warn("Can not assign null as material: "+this.name,o))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new pW(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return LR}get lightmap(){var t;return(t=this._lightmaps)!=null&&t.length?this._lightmaps[0].lightmap:null}set lightmap(t){var n;if(this._lightmapTextureOverride=t,t===void 0&&(t=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(n=this._lightmaps)!=null&&n.length)for(const r of this._lightmaps)r.lightmap=t}get hasLightmap(){const t=this.lightmap;return t!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,Yp&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&Yp&&this.probeAnchor.add(new dr(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const t of this.gameObject.children)this.context.addBeforeRenderListener(t,this.onBeforeRenderThree),t.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let t=0;for(let n=0;n<this.gameObject.children.length;n++){const r=this.gameObject.children[n];if(!(!this.isMeshOrSkinnedMesh(r)||j.getComponent(r,ci))){if(this.renderOrder.length<=t){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+t,"ChildElement:",r);continue}r.renderOrder=this.renderOrder[t],t+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),fW)for(let t=0;t<this.sharedMaterials.length;t++){const n=this.sharedMaterials[t];n&&(n.wireframe=!0)}}applyLightmapping(){var t;if(this.lightmapIndex>=0){const n=this.gameObject.type,r=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(r){if(this._lightmaps||(this._lightmaps=[]),n==="Mesh"){const o=this.gameObject.material;if(o!=null&&o.isMeshBasicMaterial)o&&console.warn("Lightmapping is not supported on MeshBasicMaterial",o.name);else{if(this._lightmaps.length<=0){const l=new Cy(this.gameObject,this.context);this._lightmaps.push(l)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,r)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let o=0;o<this.gameObject.children.length;o++){const a=this.gameObject.children[o];if(!((t=a.material)!=null&&t.isMeshBasicMaterial)){let l;o>=this._lightmaps.length?(l=new Cy(a,this.context),this._lightmaps.push(l)):l=this._lightmaps[o],l.init(this.lightmapIndex,this.lightmapScaleOffset,r)}}}else Yp&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const t of this._handles)this._handlesTempArray.push(t);return this._handlesTempArray}setInstancingEnabled(t){if(this._isInstancingEnabled===t)return t&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=t,t){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=pf.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return j.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const n of this._handles)n.updateInstanceMatrix(!0),n.add();return j.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const n of this._handles)n.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!LR&&(this.setInstancingEnabled(!0),ta.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let t=0;t<this.gameObject.children.length;t++){const n=this.gameObject.children[t];n.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(n=>n)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const t of this.gameObject.children)this.context.removeBeforeRenderListener(t,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var t,n,r;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((t=this._reflectionProbe)==null||t.onUnset(this),this.updateReflectionProbe()),Yp==this.name&&this.gameObject instanceof Z){this.gameObject.geometry.computeBoundingSphere();const o=Be(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);Pe.DrawWireSphere(o,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((n=this.gameObject.children)==null?void 0:n.length)>0)for(const o of this.gameObject.children)this.applySettings(o);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(r=this._handles)!=null&&r.length&&this.gameObject[tm]===!0){this.gameObject[tm]=!1;for(let a=this._handles.length-1;a>=0;a--)this._handles[a].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&j.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let o=0;o<this._handles.length;o++){const a=this._handles[o];Gc(a.object,!1)}this.reflectionProbeUsage!==Qd.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let t=0;t<this._handles.length;t++){const n=this._handles[t];Gc(n.object,!0)}this.reflectionProbeUsage!==Qd.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){yg.applyStencil(this)}applySettings(t){t.receiveShadow=this.receiveShadows,this.shadowCastingMode==Sy.On?t.castShadow=!0:t.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==Qd.Off&&(this.startCoroutine(this._updateReflectionProbe(),qe.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const t=this.probeAnchor||this.gameObject,n=!!this.probeAnchor;this._reflectionProbe=Wl.get(t,this.context,n,this.probeAnchor)}setVisibility(t){if(!this.isMultiMaterialObject(this.gameObject))Gc(this.gameObject,t);else for(const n of this.gameObject.children)this.isMeshOrSkinnedMesh(n)&&Gc(n,t)}isMultiMaterialObject(t){return t.type==="Group"}isMeshOrSkinnedMesh(t){return t.type==="Mesh"||t.type==="SkinnedMesh"}}fc([v()],ci.prototype,"receiveShadows",void 0);fc([v()],ci.prototype,"shadowCastingMode",void 0);fc([v()],ci.prototype,"lightmapIndex",void 0);fc([v(Ue)],ci.prototype,"lightmapScaleOffset",void 0);fc([v()],ci.prototype,"enableInstancing",void 0);fc([v()],ci.prototype,"renderOrder",void 0);fc([v()],ci.prototype,"allowOcclusionWhenDynamic",void 0);fc([v(ne)],ci.prototype,"probeAnchor",void 0);fc([v()],ci.prototype,"reflectionProbeUsage",void 0);class $0 extends ci{}class E2 extends $0{constructor(){super(...arguments);h(this,"_needUpdateBoundingSphere",!1)}awake(){var t;super.awake(),OR&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const n of this.sharedMeshes)(t=n.parent)==null||t.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const t of this.sharedMeshes)if(t instanceof $o){this._needUpdateBoundingSphere=!1;const n=t.geometry,r=xm(t);r&&(t.geometry=r),t.computeBoundingSphere(),t.geometry=n}}if(OR){for(const t of this.sharedMeshes)if(t instanceof $o&&t.boundingSphere){const n=Be(t.boundingSphere.center).applyMatrix4(t.matrixWorld);Pe.DrawWireSphere(n,t.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var Sy;(function(s){s[s.Off=0]="Off",s[s.On=1]="On",s[s.TwoSided=2]="TwoSided",s[s.ShadowsOnly=3]="ShadowsOnly"})(Sy||(Sy={}));var H=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const XA=Q("debugparticles");var Ma;(function(s){s[s.Billboard=0]="Billboard",s[s.Stretch=1]="Stretch",s[s.HorizontalBillboard=2]="HorizontalBillboard",s[s.VerticalBillboard=3]="VerticalBillboard",s[s.Mesh=4]="Mesh"})(Ma||(Ma={}));let Xu=class{constructor(){h(this,"alphaKeys",[]);h(this,"colorKeys",[])}get duration(){return 1}evaluate(i,t){let n,r=0,o=null,a=0;for(let l=0;l<this.alphaKeys.length;l++){const c=this.alphaKeys[l];(c.time<i||!n)&&(n=c,r=l)}for(let l=0;l<this.colorKeys.length;l++){const c=this.colorKeys[l];(c.time<i||!o)&&(o=c,a=l)}if(o)if(a+1<this.colorKeys.length){const c=this.colorKeys[a+1],u=ye.remap(i,o.time,c.time,0,1);t.r=ye.lerp(o.color.r,c.color.r,u),t.g=ye.lerp(o.color.g,c.color.g,u),t.b=ye.lerp(o.color.b,c.color.b,u)}else t.r=o.color.r,t.g=o.color.g,t.b=o.color.b;if(n)if(r+1<this.alphaKeys.length){const c=this.alphaKeys[r+1],u=ye.remap(i,n.time,c.time,0,1);t.alpha=ye.lerp(n.alpha,c.alpha,u)}else t.alpha=n.alpha;return t}};H([v()],Xu.prototype,"alphaKeys",void 0);H([v()],Xu.prototype,"colorKeys",void 0);var Fi;(function(s){s[s.Constant=0]="Constant",s[s.Curve=1]="Curve",s[s.TwoCurves=2]="TwoCurves",s[s.TwoConstants=3]="TwoConstants"})(Fi||(Fi={}));var Tl;(function(s){s[s.Color=0]="Color",s[s.Gradient=1]="Gradient",s[s.TwoColors=2]="TwoColors",s[s.TwoGradients=3]="TwoGradients",s[s.RandomColor=4]="RandomColor"})(Tl||(Tl={}));var ia;(function(s){s[s.Local=0]="Local",s[s.World=1]="World",s[s.Custom=2]="Custom"})(ia||(ia={}));var Qs;(function(s){s[s.Sphere=0]="Sphere",s[s.SphereShell=1]="SphereShell",s[s.Hemisphere=2]="Hemisphere",s[s.HemisphereShell=3]="HemisphereShell",s[s.Cone=4]="Cone",s[s.Box=5]="Box",s[s.Mesh=6]="Mesh",s[s.ConeShell=7]="ConeShell",s[s.ConeVolume=8]="ConeVolume",s[s.ConeVolumeShell=9]="ConeVolumeShell",s[s.Circle=10]="Circle",s[s.CircleEdge=11]="CircleEdge",s[s.SingleSidedEdge=12]="SingleSidedEdge",s[s.MeshRenderer=13]="MeshRenderer",s[s.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",s[s.BoxShell=15]="BoxShell",s[s.BoxEdge=16]="BoxEdge",s[s.Donut=17]="Donut",s[s.Rectangle=18]="Rectangle",s[s.Sprite=19]="Sprite",s[s.SpriteRenderer=20]="SpriteRenderer"})(Qs||(Qs={}));var Kh;(function(s){s[s.Random=0]="Random",s[s.Loop=1]="Loop",s[s.PingPong=2]="PingPong",s[s.BurstSpread=3]="BurstSpread"})(Kh||(Kh={}));class Se{constructor(){h(this,"mode","Constant");h(this,"constant");h(this,"constantMin");h(this,"constantMax");h(this,"curve");h(this,"curveMin");h(this,"curveMax");h(this,"curveMultiplier")}static constant(i){const t=new Se;return t.setConstant(i),t}static betweenTwoConstants(i,t){const n=new Se;return n.setMinMaxConstant(i,t),n}static curve(i,t=1){const n=new Se;return n.setCurve(i,t),n}setConstant(i){this.mode=Fi.Constant,this.constant=i}setMinMaxConstant(i,t){this.mode=Fi.TwoConstants,this.constantMin=i,this.constantMax=t}setCurve(i,t=1){this.mode=Fi.Curve,this.curve=i,this.curveMultiplier=t}clone(){var t,n,r;const i=new Se;return i.mode=this.mode,i.constant=this.constant,i.constantMin=this.constantMin,i.constantMax=this.constantMax,i.curve=(t=this.curve)==null?void 0:t.clone(),i.curveMin=(n=this.curveMin)==null?void 0:n.clone(),i.curveMax=(r=this.curveMax)==null?void 0:r.clone(),i.curveMultiplier=this.curveMultiplier,i}evaluate(i,t){const n=t===void 0?Math.random():t;switch(this.mode){case Fi.Constant:case"Constant":return this.constant;case Fi.Curve:case"Curve":return i=ye.clamp01(i),this.curve.evaluate(i)*this.curveMultiplier;case Fi.TwoCurves:case"TwoCurves":const r=i*this.curveMin.duration,o=i*this.curveMax.duration;return ye.lerp(this.curveMin.evaluate(r),this.curveMax.evaluate(o),n%1)*this.curveMultiplier;case Fi.TwoConstants:case"TwoConstants":return ye.lerp(this.constantMin,this.constantMax,n%1);default:this.curveMax.evaluate(i)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case Fi.Constant:case"Constant":return this.constant;case Fi.Curve:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case Fi.TwoCurves:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case Fi.TwoConstants:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(i){if(!i)return 0;let t=Number.MIN_VALUE;for(let n=0;n<i.keys.length;n++){const r=i.keys[n];r.value>t&&(t=r.value)}return t}}H([v()],Se.prototype,"mode",void 0);H([v()],Se.prototype,"constant",void 0);H([v()],Se.prototype,"constantMin",void 0);H([v()],Se.prototype,"constantMax",void 0);H([v(Jo)],Se.prototype,"curve",void 0);H([v(Jo)],Se.prototype,"curveMin",void 0);H([v(Jo)],Se.prototype,"curveMax",void 0);H([v()],Se.prototype,"curveMultiplier",void 0);const ar=class{constructor(){h(this,"mode",Tl.Color);h(this,"color");h(this,"colorMin");h(this,"colorMax");h(this,"gradient");h(this,"gradientMin");h(this,"gradientMax")}static constant(i){const t=new ar;return t.constant(i),t}static betweenTwoColors(i,t){const n=new ar;return n.betweenTwoColors(i,t),n}constant(i){return this.mode=Tl.Color,this.color=i,this}betweenTwoColors(i,t){return this.mode=Tl.TwoColors,this.colorMin=i,this.colorMax=t,this}evaluate(i,t){const n=t===void 0?Math.random():t;switch(this.mode){case Tl.Color:case"Color":return this.color;case Tl.Gradient:case"Gradient":return this.gradient.evaluate(i,ar._temp),ar._temp;case Tl.TwoColors:case"TwoColors":return ar._temp.lerpColors(this.colorMin,this.colorMax,n);case Tl.TwoGradients:case"TwoGradients":return this.gradientMin.evaluate(i,ar._temp),this.gradientMax.evaluate(i,ar._temp2),ar._temp.lerp(ar._temp2,n)}return ar._temp.set(16711935),ar._temp.alpha=1,ar._temp}};let xn=ar;h(xn,"_temp",new Ut(0,0,0,1)),h(xn,"_temp2",new Ut(0,0,0,1));H([v()],xn.prototype,"mode",void 0);H([v(Ut)],xn.prototype,"color",void 0);H([v(Ut)],xn.prototype,"colorMin",void 0);H([v(Ut)],xn.prototype,"colorMax",void 0);H([v(Xu)],xn.prototype,"gradient",void 0);H([v(Xu)],xn.prototype,"gradientMin",void 0);H([v(Xu)],xn.prototype,"gradientMax",void 0);var Ey;(function(s){s[s.Hierarchy=0]="Hierarchy",s[s.Local=1]="Local",s[s.Shape=2]="Shape"})(Ey||(Ey={}));class Is{constructor(){h(this,"cullingMode");h(this,"duration");h(this,"emitterVelocityMode");h(this,"flipRotation");h(this,"gravityModifier");h(this,"gravityModifierMultiplier");h(this,"loop");h(this,"maxParticles");h(this,"playOnAwake");h(this,"prewarm");h(this,"ringBufferLoopRange");h(this,"ringBufferMode");h(this,"scalingMode");h(this,"simulationSpace");h(this,"simulationSpeed");h(this,"startColor");h(this,"startDelay");h(this,"startDelayMultiplier");h(this,"startLifetime");h(this,"startLifetimeMultiplier");h(this,"startRotation");h(this,"startRotationMultiplier");h(this,"startRotation3D");h(this,"startRotationX");h(this,"startRotationXMultiplier");h(this,"startRotationY");h(this,"startRotationYMultiplier");h(this,"startRotationZ");h(this,"startRotationZMultiplier");h(this,"startSize");h(this,"startSize3D");h(this,"startSizeMultiplier");h(this,"startSizeX");h(this,"startSizeXMultiplier");h(this,"startSizeY");h(this,"startSizeYMultiplier");h(this,"startSizeZ");h(this,"startSizeZMultiplier");h(this,"startSpeed");h(this,"startSpeedMultiplier");h(this,"stopAction");h(this,"useUnscaledTime")}}H([v(Se)],Is.prototype,"gravityModifier",void 0);H([v(xn)],Is.prototype,"startColor",void 0);H([v(Se)],Is.prototype,"startDelay",void 0);H([v(Se)],Is.prototype,"startLifetime",void 0);H([v(Se)],Is.prototype,"startRotation",void 0);H([v(Se)],Is.prototype,"startRotationX",void 0);H([v(Se)],Is.prototype,"startRotationY",void 0);H([v(Se)],Is.prototype,"startRotationZ",void 0);H([v(Se)],Is.prototype,"startSize",void 0);H([v(Se)],Is.prototype,"startSizeX",void 0);H([v(Se)],Is.prototype,"startSizeY",void 0);H([v(Se)],Is.prototype,"startSizeZ",void 0);H([v(Se)],Is.prototype,"startSpeed",void 0);class Iy{constructor(){h(this,"cycleCount");h(this,"maxCount");h(this,"minCount");h(this,"probability");h(this,"repeatInterval");h(this,"time");h(this,"count");h(this,"_performed",0)}reset(){this._performed=0}run(i){if(i<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const n=this.time+this.repeatInterval*this._performed;if(i>=n&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case Fi.Constant:t=this.count.constant;break;case Fi.TwoConstants:t=ye.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case Fi.Curve:t=this.count.curve.evaluate(Math.random());break;case Fi.TwoCurves:const r=Math.random();t=ye.lerp(this.count.curveMin.evaluate(r),this.count.curveMax.evaluate(r),Math.random());break}}return t}}class pc{constructor(){h(this,"enabled");h(this,"bursts");h(this,"rateOverTime");h(this,"rateOverTimeMultiplier");h(this,"rateOverDistance");h(this,"rateOverDistanceMultiplier");h(this,"system")}get burstCount(){var i;return((i=this.bursts)==null?void 0:i.length)??0}reset(){var i;(i=this.bursts)==null||i.forEach(t=>t.reset())}getBurst(){let i=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const n=this.bursts[t];this.system.main.loop&&n.time>=this.system.time&&n.reset(),i+=Math.round(n.run(this.system.time))}return i}}H([v()],pc.prototype,"enabled",void 0);H([v()],pc.prototype,"bursts",void 0);H([v(Se)],pc.prototype,"rateOverTime",void 0);H([v()],pc.prototype,"rateOverTimeMultiplier",void 0);H([v(Se)],pc.prototype,"rateOverDistance",void 0);H([v()],pc.prototype,"rateOverDistanceMultiplier",void 0);class eb{constructor(){h(this,"enabled");h(this,"color")}}H([v(xn)],eb.prototype,"color",void 0);class Yu{constructor(){h(this,"enabled");h(this,"separateAxes");h(this,"size");h(this,"sizeMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier");h(this,"_time",0);h(this,"_temp",new x)}evaluate(i,t,n){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(i,n)*this.xMultiplier,t.y=this.y.evaluate(i,n)*this.yMultiplier,t.z=this.z.evaluate(i,n)*this.zMultiplier;else{const r=this.size.evaluate(i,n)*this.sizeMultiplier;t.x=r}return t}}H([v(Se)],Yu.prototype,"size",void 0);H([v(Se)],Yu.prototype,"x",void 0);H([v(Se)],Yu.prototype,"y",void 0);H([v(Se)],Yu.prototype,"z",void 0);var jc;(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Triangle=2]="Triangle"})(jc||(jc={}));const $d=class{constructor(){h(this,"shapeType",Qs.Box);h(this,"enabled",!0);h(this,"alignToDirection",!1);h(this,"angle",0);h(this,"arc",360);h(this,"arcSpread");h(this,"arcSpeedMultiplier");h(this,"arcMode");h(this,"boxThickness");h(this,"position");h(this,"rotation");h(this,"_rotation",new Gt);h(this,"scale");h(this,"radius");h(this,"radiusThickness");h(this,"sphericalDirectionAmount");h(this,"randomDirectionAmount");h(this,"randomPositionAmount");h(this,"meshShapeType");h(this,"meshRenderer");h(this,"_meshObj");h(this,"_meshGeometry");h(this,"system");h(this,"_space");h(this,"_worldSpaceMatrix",new le);h(this,"_worldSpaceMatrixInverse",new le);h(this,"_vector",new x(0,0,0));h(this,"_temp",new x(0,0,0));h(this,"_triangle",new zP);h(this,"_dir",new x);h(this,"_loopTime",0);h(this,"_loopDirection",1);XA&&console.log(this)}get type(){return Qs[this.shapeType]}initialize(i){this.onInitialize(i),i.position.copy(this._vector)}toJSON(){return this}clone(){return new $d}setMesh(i){this.meshRenderer=i,i?(this._meshObj=i.sharedMeshes[Math.floor(Math.random()*i.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(i,t,n,r){this.system=i,this._space=n,n===ia.World&&(this._worldSpaceMatrix.copy(r.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(i){const t=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return t&&(this._rotation.x=ye.toRadians(this.rotation.x),this._rotation.y=ye.toRadians(this.rotation.y),this._rotation.z=ye.toRadians(this.rotation.z),this._rotation.order="ZYX",i.applyEuler(this._rotation)),t}onInitialize(i){this._vector.set(0,0,0),i.mesh=void 0,i.mesh_geometry=void 0;const t=this._temp.copy(this.position),n=this._space===ia.World;n&&t.applyQuaternion(this.system.worldQuaternion);let r=this.radius;if(n&&(r*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case Qs.Box:XA&&Pe.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(t);break;case Qs.Cone:this.randomConePoint(this.position,this.angle,r,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case Qs.Sphere:this.randomSpherePoint(this.position,r,this.radiusThickness,this.arc,this._vector);break;case Qs.Circle:this.randomCirclePoint(this.position,r,this.radiusThickness,this.arc,this._vector);break;case Qs.MeshRenderer:const o=this.meshRenderer;(o==null?void 0:o.destroyed)==!1&&this.setMesh(o);const a=i.mesh=this._meshObj,l=i.mesh_geometry=this._meshGeometry;if(a&&l)switch(this.meshShapeType){case jc.Vertex:{const c=l.getAttribute("position"),u=Math.floor(Math.random()*c.count);this._vector.fromBufferAttribute(c,u),this._vector.applyMatrix4(a.matrixWorld),i.mesh_normal=u}break;case jc.Edge:break;case jc.Triangle:{const c=l.index;if(c){let u=Math.random(),d=Math.random();u+d>1&&(u=1-u,d=1-d);const f=Math.floor(Math.random()*(c.count/3));let p=f*3,g=f*3+1,m=f*3+2;p=c.getX(p),g=c.getX(g),m=c.getX(m);const A=l.getAttribute("position");this._triangle.a.fromBufferAttribute(A,p),this._triangle.b.fromBufferAttribute(A,g),this._triangle.c.fromBufferAttribute(A,m),this._vector.set(0,0,0).addScaledVector(this._triangle.a,u).addScaledVector(this._triangle.b,d).addScaledVector(this._triangle.c,1-(u+d)),this._vector.applyMatrix4(a.matrixWorld),i.mesh_normal=f}}break}break;default:this._vector.set(0,0,0),be()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",Qs[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),n&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),XA&&Pe.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(i,t){var n;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case Qs.Box:this._dir.set(0,0,1);break;case Qs.Cone:this._dir.set(0,0,1);break;case Qs.Circle:case Qs.Sphere:const r=t.x,o=t.y,a=t.z;this._dir.set(r,o,a),(n=this.system)!=null&&n.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case Qs.MeshRenderer:const l=i.mesh,c=i.mesh_geometry;if(l&&c)switch(this.meshShapeType){case jc.Vertex:{const u=c.getAttribute("normal"),d=i.mesh_normal;this._dir.fromBufferAttribute(u,d)}break;case jc.Edge:break;case jc.Triangle:{const u=c.index;if(u){const d=i.mesh_normal,f=u.getX(d*3),p=u.getX(d*3+1),g=u.getX(d*3+2),m=c.getAttribute("position"),A=Be(),y=Be(),b=Be();A.fromBufferAttribute(m,f),y.fromBufferAttribute(m,p),b.fromBufferAttribute(m,g),A.sub(y),b.sub(y),A.cross(b),this._dir.copy(A).multiplyScalar(-1);const _=Ht(l);this._dir.applyQuaternion(_)}}break}break;default:this._dir.set(0,0,1);break}return this._space===ia.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),XA&&(Pe.DrawSphere(t,.01,8925952,.5,!0),Pe.DrawDirection(t,this._dir,8925952,.5,!0)),this._dir}randomizePosition(i,t){if(t<=0)return;const n=$d._tempVec;n.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),n.x*=t*this.scale.x,n.y*=t*this.scale.y,n.z*=t*this.scale.z,i.add(n)}randomizeDirection(i,t){if(t===0)return;const n=$d._randomQuat,r=$d._tempVec;r.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),n.setFromAxisAngle(r,t*Math.random()*Math.PI),i.applyQuaternion(n)}spherizeDirection(i,t){if(t===0)return;const n=Math.random()*Math.PI*2,r=Math.acos(1-Math.random()*2),o=Math.sin(r)*Math.cos(n),a=Math.sin(r)*Math.sin(n),l=Math.cos(r),c=new x(o,a,l);i.lerp(c,t)}randomSpherePoint(i,t,n,r,o){const a=Math.random(),l=Math.random(),c=2*Math.PI*a*(r/360),u=Math.acos(2*l-1),d=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),n)*t,f=i.x+this.scale.x*(-d*Math.sin(u)*Math.cos(c)),p=i.y+this.scale.y*(d*Math.sin(u)*Math.sin(c)),g=i.z+this.scale.z*(d*Math.cos(u));o.x=f,o.y=p,o.z=g}randomCirclePoint(i,t,n,r,o){const a=Math.random(),l=2*Math.PI*a*(r/360),c=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),n)*t,u=i.x+this.scale.x*c*Math.cos(l),d=i.y+this.scale.y*c*Math.sin(l),f=i.z;o.x=u,o.y=d,o.z=f}randomConePoint(i,t,n,r,o,a,l){let c=0,u=0;switch(a){case Kh.Random:c=Math.random(),u=Math.random();break;case Kh.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case Kh.Loop:c=.5,u=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let d=2*Math.PI*c*(o/360);switch(a){case Kh.PingPong:case Kh.Loop:d+=Math.PI+.5,d+=this._loopTime*Math.PI*2,d%=ye.toRadians(o);break}const f=Math.acos(2*u-1),p=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),r)*n,g=i.x+-p*Math.sin(f)*Math.cos(d),m=i.y+p*Math.sin(f)*Math.sin(d),A=i.z;l.x=g*this.scale.x,l.y=m*this.scale.y,l.z=A*this.scale.z}};let ei=$d;h(ei,"_randomQuat",new se),h(ei,"_tempVec",new x);H([v()],ei.prototype,"shapeType",void 0);H([v()],ei.prototype,"enabled",void 0);H([v()],ei.prototype,"alignToDirection",void 0);H([v()],ei.prototype,"angle",void 0);H([v()],ei.prototype,"arc",void 0);H([v()],ei.prototype,"arcSpread",void 0);H([v()],ei.prototype,"arcSpeedMultiplier",void 0);H([v()],ei.prototype,"arcMode",void 0);H([v(x)],ei.prototype,"boxThickness",void 0);H([v(x)],ei.prototype,"position",void 0);H([v(x)],ei.prototype,"rotation",void 0);H([v(x)],ei.prototype,"scale",void 0);H([v()],ei.prototype,"radius",void 0);H([v()],ei.prototype,"radiusThickness",void 0);H([v()],ei.prototype,"sphericalDirectionAmount",void 0);H([v()],ei.prototype,"randomDirectionAmount",void 0);H([v()],ei.prototype,"randomPositionAmount",void 0);H([v()],ei.prototype,"meshShapeType",void 0);H([v($0)],ei.prototype,"meshRenderer",void 0);class Nt{constructor(){h(this,"damping");h(this,"enabled");h(this,"frequency");h(this,"octaveCount");h(this,"octaveMultiplier");h(this,"octaveScale");h(this,"positionAmount");h(this,"quality");h(this,"remap");h(this,"remapEnabled");h(this,"remapMultiplier");h(this,"remapX");h(this,"remapXMultiplier");h(this,"remapY");h(this,"remapYMultiplier");h(this,"remapZ");h(this,"remapZMultiplier");h(this,"scrollSpeedMultiplier");h(this,"separateAxes");h(this,"strengthMultiplier");h(this,"strengthX");h(this,"strengthXMultiplier");h(this,"strengthY");h(this,"strengthYMultiplier");h(this,"strengthZ");h(this,"strengthZMultiplier");h(this,"_noise");h(this,"_time",0);h(this,"_temp",new x)}update(i){this._time+=i.time.deltaTime*this.scrollSpeedMultiplier}apply(i,t,n,r,o,a){if(!this.enabled)return;this._noise||(this._noise=q9(()=>0));const l=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),c=this._noise(l.x,l.y,l.z,this._time),u=this._noise(l.x,l.y,l.z,this._time+1e3*this.frequency),d=this._noise(l.x,l.y,l.z,this._time+2e3*this.frequency);this._temp.set(c,u,d).normalize();const f=o/a;let p=this.positionAmount.evaluate(f);this.separateAxes?(this._temp.x*=p*this.strengthXMultiplier,this._temp.y*=p*this.strengthYMultiplier,this._temp.z*=p*this.strengthZMultiplier):(this.strengthX&&(p*=this.strengthX.evaluate(f)*1.5),this._temp.multiplyScalar(p)),n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z}}H([v()],Nt.prototype,"damping",void 0);H([v()],Nt.prototype,"enabled",void 0);H([v()],Nt.prototype,"frequency",void 0);H([v()],Nt.prototype,"octaveCount",void 0);H([v()],Nt.prototype,"octaveMultiplier",void 0);H([v()],Nt.prototype,"octaveScale",void 0);H([v(Se)],Nt.prototype,"positionAmount",void 0);H([v()],Nt.prototype,"quality",void 0);H([v(Se)],Nt.prototype,"remap",void 0);H([v()],Nt.prototype,"remapEnabled",void 0);H([v()],Nt.prototype,"remapMultiplier",void 0);H([v(Se)],Nt.prototype,"remapX",void 0);H([v()],Nt.prototype,"remapXMultiplier",void 0);H([v(Se)],Nt.prototype,"remapY",void 0);H([v()],Nt.prototype,"remapYMultiplier",void 0);H([v(Se)],Nt.prototype,"remapZ",void 0);H([v()],Nt.prototype,"remapZMultiplier",void 0);H([v()],Nt.prototype,"scrollSpeedMultiplier",void 0);H([v()],Nt.prototype,"separateAxes",void 0);H([v()],Nt.prototype,"strengthMultiplier",void 0);H([v(Se)],Nt.prototype,"strengthX",void 0);H([v()],Nt.prototype,"strengthXMultiplier",void 0);H([v(Se)],Nt.prototype,"strengthY",void 0);H([v()],Nt.prototype,"strengthYMultiplier",void 0);H([v(Se)],Nt.prototype,"strengthZ",void 0);H([v()],Nt.prototype,"strengthZMultiplier",void 0);var eC;(function(s){s[s.PerParticle=0]="PerParticle",s[s.Ribbon=1]="Ribbon"})(eC||(eC={}));var tC;(function(s){s[s.Stretch=0]="Stretch",s[s.Tile=1]="Tile",s[s.DistributePerSegment=2]="DistributePerSegment",s[s.RepeatPerSegment=3]="RepeatPerSegment"})(tC||(tC={}));class Ci{constructor(){h(this,"enabled");h(this,"attachRibbonToTransform",!1);h(this,"colorOverLifetime");h(this,"colorOverTrail");h(this,"dieWithParticles",!0);h(this,"inheritParticleColor",!0);h(this,"lifetime");h(this,"lifetimeMultiplier");h(this,"minVertexDistance",.2);h(this,"mode",eC.PerParticle);h(this,"ratio",1);h(this,"ribbonCount",1);h(this,"shadowBias",0);h(this,"sizeAffectsLifetime",!1);h(this,"sizeAffectsWidth",!1);h(this,"splitSubEmitterRibbons",!1);h(this,"textureMode",tC.Stretch);h(this,"widthOverTrail");h(this,"widthOverTrailMultiplier");h(this,"worldSpace",!1)}getWidth(i,t,n,r){const o=this.widthOverTrail.evaluate(n,r);return i*=o,i}getColor(i,t,n){const r=this.colorOverTrail.evaluate(n),o=this.colorOverLifetime.evaluate(t);i.x*=r.r*o.r,i.y*=r.g*o.g,i.z*=r.b*o.b,"alpha"in r&&"alpha"in o&&(i.w*=r.alpha*o.alpha)}}H([v()],Ci.prototype,"enabled",void 0);H([v()],Ci.prototype,"attachRibbonToTransform",void 0);H([v(xn)],Ci.prototype,"colorOverLifetime",void 0);H([v(xn)],Ci.prototype,"colorOverTrail",void 0);H([v()],Ci.prototype,"dieWithParticles",void 0);H([v()],Ci.prototype,"inheritParticleColor",void 0);H([v(Se)],Ci.prototype,"lifetime",void 0);H([v()],Ci.prototype,"lifetimeMultiplier",void 0);H([v()],Ci.prototype,"minVertexDistance",void 0);H([v()],Ci.prototype,"mode",void 0);H([v()],Ci.prototype,"ratio",void 0);H([v()],Ci.prototype,"ribbonCount",void 0);H([v()],Ci.prototype,"shadowBias",void 0);H([v()],Ci.prototype,"sizeAffectsLifetime",void 0);H([v()],Ci.prototype,"sizeAffectsWidth",void 0);H([v()],Ci.prototype,"splitSubEmitterRibbons",void 0);H([v()],Ci.prototype,"textureMode",void 0);H([v(Se)],Ci.prototype,"widthOverTrail",void 0);H([v()],Ci.prototype,"widthOverTrailMultiplier",void 0);H([v()],Ci.prototype,"worldSpace",void 0);class Pi{constructor(){h(this,"enabled");h(this,"space",ia.Local);h(this,"orbitalX");h(this,"orbitalY");h(this,"orbitalZ");h(this,"orbitalXMultiplier");h(this,"orbitalYMultiplier");h(this,"orbitalZMultiplier");h(this,"orbitalOffsetX");h(this,"orbitalOffsetY");h(this,"orbitalOffsetZ");h(this,"speedModifier");h(this,"speedModifierMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier");h(this,"_system");h(this,"_temp",new x);h(this,"_temp2",new x);h(this,"_temp3",new x);h(this,"_hasOrbital",!1);h(this,"_index",0);h(this,"_orbitalMatrix",new le)}update(i){this._system=i}init(i){this._index==0&&(i.debug=!0),this._index+=1,i.orbitx=this.orbitalX.evaluate(Math.random()),i.orbity=this.orbitalY.evaluate(Math.random()),i.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=i.orbitx!=0||i.orbity!=0||i.orbitz!=0}apply(i,t,n,r,o,a,l){var g;if(!this.enabled)return;const c=a/l,u=this.speedModifier.evaluate(c)*this.speedModifierMultiplier,d=this.x.evaluate(c),f=this.y.evaluate(c),p=this.z.evaluate(c);if(this._temp.set(-d,f,p),this._system&&this._system.main.simulationSpace===ia.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((g=this._system)==null?void 0:g.worldPos)){const A=this._temp2.set(n.x,n.y,n.z),y=this.orbitalXMultiplier,b=this.orbitalYMultiplier,_=this.orbitalZMultiplier,w=u*Math.PI*2*10,S=Math.cos(w*y),E=Math.sin(w*y),I=Math.cos(w*b),k=Math.sin(w*b),T=Math.cos(w*_),P=Math.sin(w*_),B=A.x*(I*T)+A.y*(I*P)+A.z*-k,M=A.x*(E*k*T-S*P)+A.y*(E*k*P+S*T)+A.z*(E*I),U=A.x*(S*k*T+E*P)+A.y*(S*k*P-E*T)+A.z*(S*I),G=this._temp3.set(A.x-B,A.y-M,A.z-U);G.normalize(),G.multiplyScalar(.2/o*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),r.x+=G.x,r.y+=G.y,r.z+=G.z}r.x+=this._temp.x,r.y+=this._temp.y,r.z+=this._temp.z,r.x*=u,r.y*=u,r.z*=u}}H([v()],Pi.prototype,"enabled",void 0);H([v()],Pi.prototype,"space",void 0);H([v(Se)],Pi.prototype,"orbitalX",void 0);H([v(Se)],Pi.prototype,"orbitalY",void 0);H([v(Se)],Pi.prototype,"orbitalZ",void 0);H([v()],Pi.prototype,"orbitalXMultiplier",void 0);H([v()],Pi.prototype,"orbitalYMultiplier",void 0);H([v()],Pi.prototype,"orbitalZMultiplier",void 0);H([v()],Pi.prototype,"orbitalOffsetX",void 0);H([v()],Pi.prototype,"orbitalOffsetY",void 0);H([v()],Pi.prototype,"orbitalOffsetZ",void 0);H([v(Se)],Pi.prototype,"speedModifier",void 0);H([v()],Pi.prototype,"speedModifierMultiplier",void 0);H([v(Se)],Pi.prototype,"x",void 0);H([v()],Pi.prototype,"xMultiplier",void 0);H([v(Se)],Pi.prototype,"y",void 0);H([v()],Pi.prototype,"yMultiplier",void 0);H([v(Se)],Pi.prototype,"z",void 0);H([v()],Pi.prototype,"zMultiplier",void 0);var iC;(function(s){s[s.Lifetime=0]="Lifetime",s[s.Speed=1]="Speed",s[s.FPS=2]="FPS"})(iC||(iC={}));var UR;(function(s){s[s.Grid=0]="Grid",s[s.Sprites=1]="Sprites"})(UR||(UR={}));var NR;(function(s){s[s.Custom=0]="Custom",s[s.Random=1]="Random",s[s.MeshIndex=2]="MeshIndex"})(NR||(NR={}));var zR;(function(s){s[s.WholeSheet=0]="WholeSheet",s[s.SingleRow=1]="SingleRow"})(zR||(zR={}));class Ts{constructor(){h(this,"animation");h(this,"enabled");h(this,"cycleCount");h(this,"frameOverTime");h(this,"frameOverTimeMultiplier");h(this,"numTilesX");h(this,"numTilesY");h(this,"startFrame");h(this,"startFrameMultiplier");h(this,"rowMode");h(this,"rowIndex");h(this,"spriteCount");h(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===iC.Lifetime)switch(this.frameOverTime.mode){case Fi.Constant:case Fi.TwoConstants:case Fi.TwoCurves:case Fi.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(i){if(!this.sampleOnceAtStart())return this.getIndex(i)}getIndex(i){const t=this.numTilesX*this.numTilesY;i=i*this.cycleCount;let n=this.frameOverTime.evaluate(i%1);return n*=this.frameOverTimeMultiplier,n*=t,n=n%t,n=Math.floor(n),n}}H([v()],Ts.prototype,"animation",void 0);H([v()],Ts.prototype,"enabled",void 0);H([v()],Ts.prototype,"cycleCount",void 0);H([v(Se)],Ts.prototype,"frameOverTime",void 0);H([v()],Ts.prototype,"frameOverTimeMultiplier",void 0);H([v()],Ts.prototype,"numTilesX",void 0);H([v()],Ts.prototype,"numTilesY",void 0);H([v(Se)],Ts.prototype,"startFrame",void 0);H([v()],Ts.prototype,"startFrameMultiplier",void 0);H([v()],Ts.prototype,"rowMode",void 0);H([v()],Ts.prototype,"rowIndex",void 0);H([v()],Ts.prototype,"spriteCount",void 0);H([v()],Ts.prototype,"timeMode",void 0);class aa{constructor(){h(this,"enabled");h(this,"separateAxes");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(i,t){return this.enabled?this.separateAxes?0:this.z.evaluate(i,t)*-1:0}}H([v()],aa.prototype,"enabled",void 0);H([v()],aa.prototype,"separateAxes",void 0);H([v(Se)],aa.prototype,"x",void 0);H([v()],aa.prototype,"xMultiplier",void 0);H([v(Se)],aa.prototype,"y",void 0);H([v()],aa.prototype,"yMultiplier",void 0);H([v(Se)],aa.prototype,"z",void 0);H([v()],aa.prototype,"zMultiplier",void 0);class To{constructor(){h(this,"enabled");h(this,"range");h(this,"separateAxes");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(i,t){if(!this.enabled)return 0;if(!this.separateAxes){const n=ye.lerp(this.range.x,this.range.y,t);return this.z.evaluate(n)*-1}return 0}}H([v()],To.prototype,"enabled",void 0);H([v()],To.prototype,"range",void 0);H([v()],To.prototype,"separateAxes",void 0);H([v(Se)],To.prototype,"x",void 0);H([v()],To.prototype,"xMultiplier",void 0);H([v(Se)],To.prototype,"y",void 0);H([v()],To.prototype,"yMultiplier",void 0);H([v(Se)],To.prototype,"z",void 0);H([v()],To.prototype,"zMultiplier",void 0);class hn{constructor(){h(this,"enabled");h(this,"dampen");h(this,"drag");h(this,"dragMultiplier");h(this,"limit");h(this,"limitMultiplier");h(this,"separateAxes");h(this,"limitX");h(this,"limitXMultiplier");h(this,"limitY");h(this,"limitYMultiplier");h(this,"limitZ");h(this,"limitZMultiplier");h(this,"multiplyDragByParticleSize",!1);h(this,"multiplyDragByParticleVelocity",!1);h(this,"space");h(this,"_temp",new x);h(this,"_temp2",new x)}apply(i,t,n,r,o,a,l){if(this.enabled){const c=this.limit.evaluate(o)*this.limitMultiplier;if(t.length()>c){this._temp.copy(t).normalize().multiplyScalar(c);const d=this.dampen*.5;t.x=ye.lerp(t.x,this._temp.x,d),t.y=ye.lerp(t.y,this._temp.y,d),t.z=ye.lerp(t.z,this._temp.z,d),n.x=ye.lerp(n.x,this._temp.x,d),n.y=ye.lerp(n.y,this._temp.y,d),n.z=ye.lerp(n.z,this._temp.z,d)}}}}H([v()],hn.prototype,"enabled",void 0);H([v()],hn.prototype,"dampen",void 0);H([v(Se)],hn.prototype,"drag",void 0);H([v()],hn.prototype,"dragMultiplier",void 0);H([v(Se)],hn.prototype,"limit",void 0);H([v()],hn.prototype,"limitMultiplier",void 0);H([v()],hn.prototype,"separateAxes",void 0);H([v(Se)],hn.prototype,"limitX",void 0);H([v()],hn.prototype,"limitXMultiplier",void 0);H([v(Se)],hn.prototype,"limitY",void 0);H([v()],hn.prototype,"limitYMultiplier",void 0);H([v(Se)],hn.prototype,"limitZ",void 0);H([v()],hn.prototype,"limitZMultiplier",void 0);H([v()],hn.prototype,"multiplyDragByParticleSize",void 0);H([v()],hn.prototype,"multiplyDragByParticleVelocity",void 0);H([v()],hn.prototype,"space",void 0);var Ty;(function(s){s[s.Initial=0]="Initial",s[s.Current=1]="Current"})(Ty||(Ty={}));class gc{constructor(){h(this,"enabled");h(this,"curve");h(this,"curveMultiplier");h(this,"mode");h(this,"system");h(this,"_temp",new x);h(this,"_firstUpdate",!0);h(this,"_frames",0)}clone(){var t;const i=new gc;return i.enabled=this.enabled,i.curve=(t=this.curve)==null?void 0:t.clone(),i.curveMultiplier=this.curveMultiplier,i.mode=this.mode,i}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new x),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new x),this.system._iv_velocity}awake(i){this.system=i,this.reset()}reset(){this._firstUpdate=!0}update(i){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(i){if(this.enabled&&this.system.worldspace!==!1&&this.mode===Ty.Initial){const t=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(t),i.add(this._temp)}}applyCurrent(i,t,n){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===Ty.Current){const r=this.curve.evaluate(t,n);this._temp.copy(this._velocity).multiplyScalar(r),i.add(this._temp)}}}H([v()],gc.prototype,"enabled",void 0);H([v(Se)],gc.prototype,"curve",void 0);H([v()],gc.prototype,"curveMultiplier",void 0);H([v()],gc.prototype,"mode",void 0);class mr{constructor(){h(this,"enabled");h(this,"range");h(this,"separateAxes");h(this,"size");h(this,"sizeMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(i,t,n,r){const o=i.length(),a=ye.remap(o,this.range.x,this.range.y,0,1),l=this.size.evaluate(a,n);return r*l}}H([v()],mr.prototype,"enabled",void 0);H([v(ae)],mr.prototype,"range",void 0);H([v()],mr.prototype,"separateAxes",void 0);H([v(Se)],mr.prototype,"size",void 0);H([v()],mr.prototype,"sizeMultiplier",void 0);H([v(Se)],mr.prototype,"x",void 0);H([v()],mr.prototype,"xMultiplier",void 0);H([v(Se)],mr.prototype,"y",void 0);H([v()],mr.prototype,"yMultiplier",void 0);H([v(Se)],mr.prototype,"z",void 0);H([v()],mr.prototype,"zMultiplier",void 0);class Xf{constructor(){h(this,"enabled");h(this,"range");h(this,"color")}evaluate(i,t,n){const r=i.length(),o=ye.remap(r,this.range.x,this.range.y,0,1),a=this.color.evaluate(o,t);n.x*=a.r,n.y*=a.g,n.z*=a.b,"alpha"in a&&(n.w*=a.alpha)}}H([v()],Xf.prototype,"enabled",void 0);H([v(ae)],Xf.prototype,"range",void 0);H([v(xn)],Xf.prototype,"color",void 0);const gW={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},mW={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Yf=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const YA=Q("debugcontactshadows");qO(s=>{const i=s.domElement.getAttribute("contactshadows");i!=null&&i!="0"&&i!="false"&&bo.auto(s)});const l1=class extends oe{constructor(){super(...arguments);h(this,"autoFit",!1);h(this,"darkness",.5);h(this,"opacity",.5);h(this,"blur",4);h(this,"occludeBelowGround",!1);h(this,"backfaceShadows",!0);h(this,"minSize");h(this,"shadowsRoot",new ne);h(this,"shadowCamera");h(this,"shadowGroup",new Fr);h(this,"renderTarget");h(this,"renderTargetBlur");h(this,"plane");h(this,"occluderMesh");h(this,"blurPlane");h(this,"depthMaterial");h(this,"horizontalBlurMaterial");h(this,"verticalBlurMaterial");h(this,"textureSize",512)}static auto(t){if(t||(t=Ge.Current),!t)throw new Error("No context provided and no current context set.");let n=this._instances.get(t);if(!n||n.destroyed){const r=new ne;n=vo(r,l1,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(t,n)}return t.scene.add(n.gameObject),n.fitShadows(),n}fitShadows(){YA&&console.log("Fitting shadows to scene"),N1(this.gameObject,!1);const t=sl(this.context.scene.children,[this.gameObject]),n=Math.max(1,this.blur/32),r=t.max.x-t.min.x,o=t.max.z-t.min.z;t.expandByVector(new x(n*r,0,n*o)),YA&&Pe.DrawWireBox3(t,16776960,60),this.gameObject.parent&&t.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const a=t.min,l=Math.max(1e-5,(t.max.y-a.y)*.002);t.max.y+=l,this.shadowsRoot.position.set((a.x+t.max.x)/2,a.y-l,(a.z+t.max.z)/2),this.shadowsRoot.scale.set(t.max.x-a.x,t.max.y-a.y,t.max.z-a.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0}awake(){N1(this.gameObject,!1)}start(){YA&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new Et(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Et(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const t=new pr(1,1).rotateX(Math.PI/2);this.gameObject instanceof Z&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),Gc(this.gameObject,!1));const n=new _t({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:il});this.plane=new Z(t,n),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new Z(this.plane.geometry,new _t({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:Wc})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new Z(t),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const r=0,o=1;this.shadowCamera=new ku(-1/2,1/2,1/2,-1/2,r,o),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new wP,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=WF,this.depthMaterial.blendEquation=qF,this.depthMaterial.onBeforeCompile=a=>{this.depthMaterial&&(a.uniforms.darkness=this.depthMaterial.userData.darkness,a.fragmentShader=`
                uniform float darkness;
                ${a.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new et(gW),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new et(mW),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var t,n,r,o,a,l,c,u;(t=this.renderTarget)==null||t.dispose(),(n=this.renderTargetBlur)==null||n.dispose(),(r=this.depthMaterial)==null||r.dispose(),(o=this.horizontalBlurMaterial)==null||o.dispose(),(a=this.verticalBlurMaterial)==null||a.dispose(),(l=this.blurPlane)==null||l.geometry.dispose(),(c=this.plane)==null||c.geometry.dispose(),(u=this.occluderMesh)==null||u.geometry.dispose()}onBeforeRender(t){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){YA&&console.error("ContactShadows: not initialized yet");return}const n=this.context.scene,r=this.context.renderer,o=r.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const a=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof Z&&Gc(this.gameObject,!1);const l=n.background;n.background=null,n.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=_i:this.depthMaterial.side=il;const c=r.getClearAlpha();r.setClearAlpha(0);const u=r.xr.enabled;r.xr.enabled=!1;const d=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const f=r.renderLists.get(n,0),p=f.transparent;QR.length=0,f.transparent=QR,tw.length=0;for(const m of f.opaque){if(!m.object.visible)continue;const A=m.material;let y=m.material.colorWrite==!1||A.wireframe===!0||vz(m.object)===!1;!y&&m.material.linewidth!=null&&(y=!0),y&&(tw.push(m.object),m.object["needle:visible"]=m.object.visible,m.object.visible=!1)}r.setRenderTarget(this.renderTarget),r.clear(),r.render(n,this.shadowCamera),f.transparent=p;for(const m of tw)m["needle:visible"]!=null&&(m.visible=m["needle:visible"]);n.overrideMaterial=null;const g=Math.max(this.blur,.05);this.blurShadow(g*2),this.blurShadow(g*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=a,r.setRenderTarget(o),r.setClearAlpha(c),n.background=l,r.xr.enabled=u,this.context.scene.matrixWorldAutoUpdate=d}blurShadow(t){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const n=this.shadowsRoot.worldScale,r=(n.x+n.z)/2,o=n.z/r,a=n.x/r;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=t*1/this.textureSize*o;const l=this.context.renderer,c=l.getRenderTarget();l.setRenderTarget(this.renderTargetBlur),l.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=t*1/this.textureSize*a,l.setRenderTarget(this.renderTarget),l.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,l.setRenderTarget(c)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}};let bo=l1;h(bo,"_instances",new Map);Yf([v()],bo.prototype,"autoFit",void 0);Yf([v()],bo.prototype,"darkness",void 0);Yf([v()],bo.prototype,"opacity",void 0);Yf([v()],bo.prototype,"blur",void 0);Yf([v()],bo.prototype,"occludeBelowGround",void 0);Yf([v()],bo.prototype,"backfaceShadows",void 0);const QR=[],tw=new Array,c1=class{constructor(){h(this,"_quicklookButton");h(this,"_arButton");h(this,"_vrButton");h(this,"_sendToQuestButton")}static create(){return new c1}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Ha.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const i=document.createElement("button");this._quicklookButton=i,i.dataset.needle="quicklook-button",i.innerText="Open in Quicklook",i.prepend(ys("view_in_ar"));let t=!1,n=null;return i.addEventListener("click",()=>{n=US(li),n||(t=!0,n=new li),t&&(n.objectToExport=Ge.Current.scene),n?(i.classList.add("this-mode-is-requested"),n.exportAndOpen().then(()=>{i.classList.remove("this-mode-is-requested")}).catch(r=>{i.classList.remove("this-mode-is-requested"),console.error(r)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(i),i}createARButton(i){var r;if(this._arButton)return this._arButton;const t="immersive-ar",n=document.createElement("button");return this._arButton=n,n.classList.add("webxr-button"),n.dataset.needle="webxr-ar-button",n.innerText="Enter AR",n.prepend(ys("view_in_ar")),n.title="Click to start an AR session",n.addEventListener("click",()=>Fe.start(t,i)),this.updateSessionSupported(n,t),this.listenToXRSessionState(n,t),this.hideElementDuringXRSession(n),this.isSecureConnection||(n.disabled=!0,n.title="WebXR requires a secure connection (HTTPS)"),rf()||(r=navigator.xr)==null||r.addEventListener("devicechange",()=>this.updateSessionSupported(n,t)),n}createVRButton(i){var r;if(this._vrButton)return this._vrButton;const t="immersive-vr",n=document.createElement("button");return this._vrButton=n,n.classList.add("webxr-button"),n.dataset.needle="webxr-vr-button",n.innerText="Enter VR",n.prepend(ys("panorama_photosphere")),n.title="Click to start a VR session",n.addEventListener("click",()=>Fe.start(t,i)),this.updateSessionSupported(n,t),this.listenToXRSessionState(n,t),this.hideElementDuringXRSession(n),this.isSecureConnection||(n.disabled=!0,n.title="WebXR requires a secure connection (HTTPS)"),rf()||(r=navigator.xr)==null||r.addEventListener("devicechange",()=>this.updateSessionSupported(n,t)),n}createSendToQuestButton(){var n;if(this._sendToQuestButton)return this._sendToQuestButton;const i="https://oculus.com/open_url/?url=",t=document.createElement("button");return this._sendToQuestButton=t,t.dataset.needle="webxr-sendtoquest-button",t.innerText="Open on Quest",t.prepend(ys("share_windows")),t.title="Click to send this page to the Oculus Browser on your Quest",t.addEventListener("click",()=>{const r=encodeURIComponent(window.location.href),o=i+r;window.open(o)==null&&bi("This page doesn't allow popups. Please paste "+o+" into your browser.")}),this.listenToXRSessionState(t),this.hideElementDuringXRSession(t),rf()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>{var r;(r=navigator.xr)!=null&&r.isSessionSupported("immersive-vr")?t.style.display="none":t.style.display=""}),t}createQRCode(){return Ha.getOrCreate().createQRCode()}updateSessionSupported(i,t){if(!("xr"in navigator)){i.style.display="none";return}Fe.isSessionSupported(t).then(n=>{i.style.display=n?"":"none",be()&&!n&&console.log('[WebXR] "'+t+'" is not supported on this device â€“ make sure your server runs using HTTPS and you have a device connected that supports '+t)})}hideElementDuringXRSession(i){xS(t=>{i["previous-display"]=i.style.display,i.style.display="none"}),Qk(t=>{i["previous-display"]!=null&&(i.style.display=i["previous-display"])})}listenToXRSessionState(i,t){t&&(Fe.onSessionRequestStart(n=>{n.mode===t?i.classList.add("this-mode-is-requested"):(i["was-disabled"]=i.disabled,i.disabled=!0,i.classList.add("other-mode-is-requested"))}),Fe.onSessionRequestEnd(n=>{i.classList.remove("this-mode-is-requested"),i.classList.remove("other-mode-is-requested"),i.disabled=i["was-disabled"]}))}};let rh=c1;h(rh,"_instance");var Bn=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Ry=Q("debugspriterenderer"),AW=Q("wireframe"),Zy=class{static getOrCreateGeometry(i){if(i.__cached_geometry)return i.__cached_geometry;if(i.guid&&Zy.cache[i.guid])return Ry&&console.log("Take cached geometry for sprite",i.guid),Zy.cache[i.guid];const t=new Vt;i.__cached_geometry=t;const n=new Float32Array(i.triangles.length*3),r=new Float32Array(i.triangles.length*2);for(let o=0;o<i.triangles.length;o+=1){const a=i.triangles[o];n[o*3]=-i.vertices[a].x,n[o*3+1]=i.vertices[a].y,n[o*3+2]=0;const l=i.uv[a];r[o*2]=l.x,r[o*2+1]=1-l.y}return t.setAttribute("position",new Je(n,3)),t.setAttribute("uv",new Je(r,2)),i.guid&&(this.cache[i.guid]=t),Ry&&console.log("Built sprite geometry",i,t),t}};let bu=Zy;h(bu,"cache",{});var By;(function(s){s[s.Simple=0]="Simple",s[s.Sliced=1]="Sliced",s[s.Tiled=2]="Tiled"})(By||(By={}));class vW{constructor(){h(this,"x");h(this,"y")}}class mc{constructor(i){h(this,"guid");h(this,"texture");h(this,"triangles");h(this,"uv");h(this,"vertices");h(this,"__cached_geometry");h(this,"_mesh");h(this,"_material");i&&(this.texture=i,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new Z(bu.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&(this.texture.colorSpace=He,this.texture.minFilter==Zt&&this.texture.magFilter==Zt&&(this.texture.anisotropy=1),this.texture.needsUpdate=!0),this._material=new _t({map:this.texture,color:16777215,side:_i,transparent:!0})),this._material}getGeometry(){return bu.getOrCreateGeometry(this)}}Bn([v()],mc.prototype,"guid",void 0);Bn([v(At)],mc.prototype,"texture",void 0);Bn([Pm()],mc.prototype,"triangles",void 0);Bn([Pm()],mc.prototype,"uv",void 0);Bn([Pm()],mc.prototype,"vertices",void 0);const iw=Symbol("spriteOwner");class Bu{constructor(){h(this,"sprites")}}Bn([v(mc)],Bu.prototype,"sprites",void 0);class el{constructor(){h(this,"spriteSheet");h(this,"index",0)}static create(){const i=new el;return i.spriteSheet=new Bu,i}set sprite(i){i&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=i):(this.spriteSheet=new Bu,this.spriteSheet.sprites=[i],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(i){if(!this.spriteSheet)return;const t=this.index;if(t<0||t>=this.spriteSheet.sprites.length)return;const n=this.spriteSheet.sprites[t],r=n==null?void 0:n.texture;if(r&&(r.colorSpace=He,r.minFilter==Zt&&r.magFilter==Zt&&(r.anisotropy=1),r.needsUpdate=!0,!n.__hasLoadedProgressive)){n.__hasLoadedProgressive=!0;const o=r;pt.assignTextureLOD(r,0).then(a=>{a instanceof At&&(n.texture=a,(i==null?void 0:i.map)===o&&(i.map=a,i.needsUpdate=!0))})}}}Bn([v(Bu)],el.prototype,"spriteSheet",void 0);Bn([v()],el.prototype,"index",void 0);class Gr extends oe{constructor(){super(...arguments);h(this,"drawMode",By.Simple);h(this,"size",{x:1,y:1});h(this,"color");h(this,"sharedMaterial");h(this,"transparent",!0);h(this,"cutoutThreshold",0);h(this,"castShadows",!1);h(this,"renderOrder",0);h(this,"toneMapped",!0);h(this,"_spriteSheet");h(this,"_currentSprite")}set texture(t){var r;if(!this._spriteSheet)return;const n=(r=this._spriteSheet.spriteSheet)==null?void 0:r.sprites[this.spriteIndex];n&&(n.texture=t,this.updateSprite())}addSprite(t,n=!1){var o,a;if(this._spriteSheet||(this._spriteSheet=el.create()),!this._spriteSheet.spriteSheet)return-1;(o=this._spriteSheet.spriteSheet)==null||o.sprites.push(t);const r=((a=this._spriteSheet.spriteSheet)==null?void 0:a.sprites.length)-1;return n&&(this.spriteIndex=r),r}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const n=Math.floor(t);this.spriteIndex=n;return}else t instanceof mc?(this._spriteSheet||(this._spriteSheet=el.create()),this._spriteSheet.sprite=t,this.updateSprite()):(this._spriteSheet=t,this.updateSprite())}set spriteIndex(t){this._spriteSheet&&t!==this.spriteIndex&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,n;return((n=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:n.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new el,this._spriteSheet.spriteSheet=new Bu),Ry&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(t=!1){var o;if(!this.__didAwake&&!t)return!1;const n=this._spriteSheet;if(!((o=n==null?void 0:n.spriteSheet)!=null&&o.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const r=n.spriteSheet.sprites[this.spriteIndex];if(!r)return Ry&&console.warn("Sprite not found",this.spriteIndex,n.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=bu.getOrCreateGeometry(r),this._currentSprite.material.map=r.texture;else{const a=new _t({color:16777215,side:_i});if(AW&&(a.wireframe=!0),this.color&&(a.color||(a.color=new xe),a.color.copy(this.color),a.opacity=this.color.alpha),a.transparent=!0,a.toneMapped=this.toneMapped,r.texture&&!a.wireframe){let l=r.texture;l[iw]!==void 0&&l[iw]!==this&&this.spriteFrames>1&&(l=r.texture=l.clone()),l[iw]=this,a.map=l}this.sharedMaterial=a,this._currentSprite=new Z(bu.getOrCreateGeometry(r),a),this._currentSprite.renderOrder=Math.round(this.renderOrder),pt.assignTextureLOD(a,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===By.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,n==null||n.update(this.sharedMaterial),!0}}Bn([v()],Gr.prototype,"drawMode",void 0);Bn([v(vW)],Gr.prototype,"size",void 0);Bn([v(Ut)],Gr.prototype,"color",void 0);Bn([v(mt)],Gr.prototype,"sharedMaterial",void 0);Bn([v()],Gr.prototype,"transparent",void 0);Bn([v()],Gr.prototype,"cutoutThreshold",void 0);Bn([v()],Gr.prototype,"castShadows",void 0);Bn([v()],Gr.prototype,"renderOrder",void 0);Bn([v()],Gr.prototype,"toneMapped",void 0);Bn([v(el)],Gr.prototype,"sprite",null);const jR=Q("debugwebxr"),yW=new le().makeRotationY(Math.PI);class fh extends oe{constructor(){super(...arguments);h(this,"_arScale",1);h(this,"invertForward",!1);h(this,"customReticle");h(this,"arTouchTransform",!0);h(this,"autoPlace",!1);h(this,"autoCenter",!1);h(this,"useXRAnchor",!1);h(this,"_isPlacing",!0);h(this,"_startOffset",new le);h(this,"_createdPlacementObject",null);h(this,"_reparentedComponents",[]);h(this,"_placementScene",new ws);h(this,"_reticle",[]);h(this,"_hits",[]);h(this,"_placementStartTime",-1);h(this,"_rigPlacementMatrix");h(this,"_anchor",null);h(this,"userInput");h(this,"onPlaceScene",t=>{var o;if(this._isPlacing==!1||t!=null&&t.used)return;let n=this._reticle[0];if(!n){console.warn("No reticle to place...");return}if(!n.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((o=Fe.active)!=null&&o.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let r=this._hits[0];if(t&&t.origin instanceof Gk){const a=this._reticle[t.origin.index];a&&(n=a,r=this._hits[t.origin.index])}if(t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),n.position.copy(n.lastPos),n.quaternion.copy(n.lastQuat),this.onApplyPose(n),this.useXRAnchor&&this.onCreateAnchor(Fe.active,r),this.context.xr)for(const a of this.context.xr.controllers)a.cancelHitTestSource()});h(this,"upVec",new x(0,1,0));h(this,"lookPoint",new x);h(this,"worldUpVec",new x(0,1,0))}static onPlaced(t){const n="placed";return this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(t),()=>{const r=this._eventListeners[n].indexOf(t);r>=0&&this._eventListeners[n].splice(r,1)}}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.onScaleChanged())}onEnable(){var t;(t=this.customReticle)==null||t.preload()}supportsXR(t){return t==="immersive-ar"}onEnterXR(t){jR&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const n=new ne;this._createdPlacementObject=n,n.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let r=this.context.scene.children.length-1;r>=0;r--){const o=this.context.scene.children[r];this._placementScene.add(o)}if(this.context.scene.add(n),this.autoCenter){const r=sl(this._placementScene.children),o=r.getCenter(new x),a=r.getSize(new x),l=new le;l.makeTranslation(o.x,o.y-a.y*.5,o.z),this._startOffset.multiply(l)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),j.addComponent(n,this);for(const r of this._reticle)xo(r);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Pr.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Pr.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(t){var n,r,o,a;if(t.xr.isTrackingImages){for(const l of this._reticle)l.visible=!1;return}if(this._isPlacing){const l=(n=t.xr.rig)==null?void 0:n.gameObject;l&&l.parent!==this.context.scene&&this.context.scene.add(l);let c=!1;if(t.xr.isPassThrough&&t.xr.controllers.length>0&&!this.autoPlace)for(const u of t.xr.controllers){const d=u.getHitTest();d&&(c=!0,this.updateReticleAndHits(t.xr,u.index,d,t.xr.rigScale))}if(!c){const u=t.xr.getHitTest();u&&this.updateReticleAndHits(t.xr,0,u,t.xr.rigScale)}}else{if(this._anchor&&t.xr.referenceSpace){const l=t.xr.frame.getPose(this._anchor.anchorSpace,t.xr.referenceSpace);if(l&&this.context.time.frame%20===0){const c=t.xr.convertSpace(l.transform),u=this._reticle[0];u&&(u.position.copy(c.position),u.quaternion.copy(c.quaternion),this.onApplyPose(u))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new Pd(this.context)),(r=this.userInput)==null||r.enable()):(o=this.userInput)==null||o.disable(),this.arTouchTransform&&((a=this.userInput)!=null&&a.hasChanged)){if(t.xr.rig){const l=t.xr.rig.gameObject;this.userInput.applyMatrixTo(l.matrix,!0),l.matrix.decompose(l.position,l.quaternion,l.scale),this.userInput.factor=l.scale.x}this.userInput.reset()}}}updateReticleAndHits(t,n,r,o){this._hits[n]=r.hit;let a=this._reticle[n];if(!a){if(this.customReticle)if(this.customReticle.asset)a=Rm(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else a=new Z(new XF(.07,.09,32).rotateX(-Math.PI/2),new _t({side:_i,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),a.name="AR Placement Reticle";if(jR){const l=new dr(1);l.position.y+=.01,a.add(l)}this._reticle[n]=a,a.matrixAutoUpdate=!1,a.visible=!1}if(a.lastPos=a.lastPos||r.position.clone(),a.lastQuat=a.lastQuat||r.quaternion.clone(),a.position.copy(a.lastPos.lerp(r.position,this.context.time.deltaTime/.1)),a.lastPos.copy(a.position),a.quaternion.copy(a.lastQuat.slerp(r.quaternion,this.context.time.deltaTime/.05)),a.lastQuat.copy(a.quaternion),a.scale.set(o,o,o),this.customReticle&&this.applyViewBasedTransform(a),a.updateMatrix(),a.visible=!0,a.parent!==this.context.scene&&this.context.scene.add(a),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(a.quaternion),this.upVec.dot(Be(0,1,0))>.9){let c=a["autoplace:timer"]||0;c>=1?(a.visible=!1,this.onPlaceScene(null)):(c+=this.context.time.deltaTime,a["autoplace:timer"]=c)}else a["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var t;for(const n of this._reticle)n&&(n.visible=!1,n==null||n.removeFromParent());this._reticle.length=0;for(let n=this._placementScene.children.length-1;n>=0;n--){const r=this._placementScene.children[n];this.context.scene.add(r)}(t=this._createdPlacementObject)==null||t.removeFromParent();for(const n of this._reparentedComponents)j.addComponent(n.originalObject,n.comp)}async onCreateAnchor(t,n){if(n.createAnchor===void 0){console.warn("Hit does not support creating an anchor",n),be()&&Xt("Hit does not support creating an anchor");return}else{const r=await n.createAnchor(t.viewerPose.transform);t.running&&r&&(this._anchor=r)}}applyViewBasedTransform(t){const n=this.context.mainCamera,r=t,o=n.worldPosition,a=r.worldPosition;this.upVec.set(0,1,0).applyQuaternion(t.quaternion);const l=n.worldPosition;l&&t.position.clone().sub(l).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const c=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,u=30;c>u&&c<180-u||c<-u&&c>-180+u?(this.lookPoint.copy(t.position).add(this.upVec),this.lookPoint.y=t.position.y,t.lookAt(this.lookPoint)):(o.y=a.y,t.lookAt(o))}onApplyPose(t){var o,a,l,c;const n=(a=(o=Fe.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!n){console.warn("No rig object to place");return}(l=Fe.active)!=null&&l.rigScale;const r=n.parent||this.context.scene;this._rigPlacementMatrix?(c=this._rigPlacementMatrix)==null||c.decompose(n.position,n.quaternion,n.scale):this._rigPlacementMatrix=n.matrix.clone(),this.applyViewBasedTransform(t),t.updateMatrix(),this.context.scene.add(t),t.attach(n),t.removeFromParent(),n.scale.set(this.arScale,this.arScale,this.arScale),n.position.multiplyScalar(this.arScale),n.updateMatrix(),this.invertForward&&n.matrix.premultiply(yW),n.matrix.premultiply(this._startOffset),n.matrix.decompose(n.position,n.quaternion,n.scale),r.add(n)}}h(fh,"_eventListeners",{});const $y=class{constructor(i){h(this,"oneFingerDrag",!0);h(this,"twoFingerRotate",!0);h(this,"twoFingerScale",!0);h(this,"factor",1);h(this,"context");h(this,"offset");h(this,"plane");h(this,"_scale",1);h(this,"_hasChanged",!1);h(this,"_enabled",!1);h(this,"currentlyUsedPointerIds",new Set);h(this,"currentlyUnusedPointerIds",new Set);h(this,"onPointerDownEarly",i=>{this.isActive&&i.stopPropagation()});h(this,"onPointerDownLate",i=>{i.used?this.currentlyUsedPointerIds.add(i.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(i.pointerId)});h(this,"onPointerUpEarly",i=>{this.currentlyUsedPointerIds.delete(i.pointerId),this.currentlyUnusedPointerIds.delete(i.pointerId)});h(this,"prev",new Map);h(this,"_didMultitouch",!1);h(this,"touchStart",i=>{for(let t=0;t<i.changedTouches.length;t++){const n=i.changedTouches[t],r=uU()&&n.clientY<window.innerHeight*.1;this.prev.has(n.identifier)||this.prev.set(n.identifier,{ignore:r,x:0,z:0,screenx:0,screeny:0});const o=this.prev.get(n.identifier);if(o){const a=this.getPositionOnPlane(n.clientX,n.clientY);o.x=a.x,o.z=a.z,o.screenx=n.clientX,o.screeny=n.clientY}}});h(this,"touchEnd",i=>{i.touches.length<=0&&(this._didMultitouch=!1);for(let t=0;t<i.changedTouches.length;t++){const n=i.changedTouches[t];this.prev.delete(n.identifier)}});h(this,"touchMove",i=>{if(!i.defaultPrevented&&this.isActive){if(i.touches.length===1){if(this._didMultitouch)return;const t=i.touches[0],n=this.prev.get(t.identifier);if(!n||n.ignore)return;const r=this.getPositionOnPlane(t.clientX,t.clientY),o=r.x-n.x,a=r.z-n.z;if(o===0&&a===0)return;this.oneFingerDrag&&this.addMovement(o,a),n.x=r.x,n.z=r.z,n.screenx=t.clientX,n.screeny=t.clientY;return}else if(i.touches.length===2){this._didMultitouch=!0;const t=i.touches[0],n=i.touches[1],r=this.prev.get(t.identifier),o=this.prev.get(n.identifier);if(!r||!o)return;if(this.twoFingerRotate){const a=Math.atan2(t.clientY-n.clientY,t.clientX-n.clientX),l=Math.atan2(r.screeny-o.screeny,r.screenx-o.screenx),c=a-l;Math.abs(c)>.001&&this.addRotation(c)}if(this.twoFingerScale){const a=t.clientX-n.clientX,l=t.clientY-n.clientY,c=Math.sqrt(a*a+l*l),u=r.screenx-o.screenx,d=r.screeny-o.screeny,f=Math.sqrt(u*u+d*d),p=c-f;Math.abs(p)>2&&this.addScale(p)}r.screenx=t.clientX,r.screeny=t.clientY,o.screenx=n.clientX,o.screeny=n.clientY}}});h(this,"_raycaster",new Du);h(this,"_intersection",new x);h(this,"_screenPos",new x);h(this,"_tempMatrix",new le);this.context=i,this.offset=new le,this.plane=new tc,this.plane.setFromNormalAndCoplanarPoint($y.up,$y.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(i,t){this._hasChanged=!1,t?(this.offset.invert(),i.premultiply(this.offset)):i.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Pr.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Pr.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Pr.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Pr.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Pr.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Pr.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(i,t){const n=this.context.mainCamera;return this._screenPos.x=i/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(n),this._raycaster.set(n.position,this._screenPos.sub(n.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(i,t){i/=this._scale,t/=this._scale,i*=this.factor,t*=this.factor,this.offset.elements[12]+=i,this.offset.elements[14]+=t,(i!==0||t!==0)&&(this._hasChanged=!0)}addScale(i){i/=window.innerWidth,i*=-1,this._scale*=1+i,this._tempMatrix.makeScale(1-i,1-i,1-i),this.offset.premultiply(this._tempMatrix),i!==0&&(this._hasChanged=!0)}addRotation(i){i*=-1,this._tempMatrix.makeRotationY(i),this.offset.premultiply(this._tempMatrix),i!==0&&(this._hasChanged=!0)}};let Pd=$y;h(Pd,"up",new x(0,1,0)),h(Pd,"zero",new x(0,0,0)),h(Pd,"one",new x(1,1,1));var Kf=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Ac extends oe{constructor(){super(...arguments);h(this,"position","bottom");h(this,"showNeedleLogo",!0);h(this,"showSpatialMenu");h(this,"createFullscreenButton");h(this,"createMuteButton");h(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(uc()||this.context.menu.showQRCodeButton(!0))}}Kf([v()],Ac.prototype,"position",void 0);Kf([v()],Ac.prototype,"showNeedleLogo",void 0);Kf([v()],Ac.prototype,"showSpatialMenu",void 0);Kf([v()],Ac.prototype,"createFullscreenButton",void 0);Kf([v()],Ac.prototype,"createMuteButton",void 0);Kf([v()],Ac.prototype,"createQRCodeButton",void 0);const Ri={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function I2(s){const i=await fetch(s);if(i.ok)return i.json();throw new Error(i.statusText)}async function bW(s){if(!s)throw new Error("No basePath supplied");return await I2(`${s}/profilesList.json`)}async function _W(s,i,t=null,n=!0){if(!s)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No basePath supplied");const r=await bW(i);let o;if(s.profiles.some(c=>{const u=r[c];return u&&(o={profileId:c,profilePath:`${i}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");const c=r[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${i}/${c.path}`,deprecated:!!c.deprecated}}const a=await I2(o.profilePath);let l;if(n){let c;if(s.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[s.handedness],!c)throw new Error(`No matching handedness, ${s.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const wW={xAxis:0,yAxis:0,button:0,state:Ri.ComponentState.DEFAULT};function xW(s=0,i=0){let t=s,n=i;if(Math.sqrt(s*s+i*i)>1){const a=Math.atan2(i,s);t=Math.cos(a),n=Math.sin(a)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class CW{constructor(i){this.componentProperty=i.componentProperty,this.states=i.states,this.valueNodeName=i.valueNodeName,this.valueNodeProperty=i.valueNodeProperty,this.valueNodeProperty===Ri.VisualResponseProperty.TRANSFORM&&(this.minNodeName=i.minNodeName,this.maxNodeName=i.maxNodeName),this.value=0,this.updateFromComponent(wW)}updateFromComponent({xAxis:i,yAxis:t,button:n,state:r}){const{normalizedXAxis:o,normalizedYAxis:a}=xW(i,t);switch(this.componentProperty){case Ri.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case Ri.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?a:.5;break;case Ri.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case Ri.ComponentProperty.STATE:this.valueNodeProperty===Ri.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class SW{constructor(i,t){if(!i||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=i,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const r=new CW(t.visualResponses[n]);this.visualResponses[n]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Ri.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(i){if(this.values.state=Ri.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&i.buttons.length>this.gamepadIndices.button){const t=i.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Ri.ComponentState.PRESSED:(t.touched||this.values.button>Ri.ButtonTouchThreshold)&&(this.values.state=Ri.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&i.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=i.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ri.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ri.AxisTouchThreshold&&(this.values.state=Ri.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&i.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=i.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ri.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ri.AxisTouchThreshold&&(this.values.state=Ri.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class EW{constructor(i,t,n){if(!i)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=i,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[i.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const o=this.layoutDescription.components[r];this.components[r]=new SW(r,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const i=[];return Object.values(this.components).forEach(t=>{i.push(t.data)}),i}updateFromGamepad(){Object.values(this.components).forEach(i=>{i.updateFromGamepad(this.xrInputSource.gamepad)})}}const IW="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",TW="generic-trigger";let RW=class extends ne{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(i){return this.envMap==i?this:(this.envMap=i,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(i){super.updateMatrixWorld(i),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:r,minNode:o,maxNode:a,value:l,valueNodeProperty:c}=n;r&&(c===Ri.VisualResponseProperty.VISIBILITY?r.visible=l:c===Ri.VisualResponseProperty.TRANSFORM&&(r.quaternion.slerpQuaternions(o.quaternion,a.quaternion,l),r.position.lerpVectors(o.position,a.position,l)))})}))}};function BW(s,i){Object.values(s.components).forEach(t=>{const{type:n,touchPointNodeName:r,visualResponses:o}=t;if(n===Ri.ComponentType.TOUCHPAD)if(t.touchPointNode=i.getObjectByName(r),t.touchPointNode){const a=new Pu(.001),l=new _t({color:255}),c=new Z(a,l);t.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach(a=>{const{valueNodeName:l,minNodeName:c,maxNodeName:u,valueNodeProperty:d}=a;if(d===Ri.VisualResponseProperty.TRANSFORM){if(a.minNode=i.getObjectByName(c),a.maxNode=i.getObjectByName(u),!a.minNode){console.warn(`Could not find ${c} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${u} in the model`);return}}a.valueNode=i.getObjectByName(l),a.valueNode||console.warn(`Could not find ${l} in the model`)})})}function GR(s,i){BW(s.motionController,i),s.envMap&&i.traverse(t=>{t.isMesh&&(t.material.envMap=s.envMap,t.material.needsUpdate=!0)}),s.layers.mask!=0&&i.traverse(t=>{t.layers.mask=s.layers.mask}),s.add(i)}class PW{constructor(i=null,t=null){this.gltfLoader=i,this.path=IW,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new rl)}setPath(i){return this.path=i,this}createControllerModel(i){const t=new RW;let n=null;return i.addEventListener("connected",r=>{const o=r.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||_W(o,this.path,TW).then(({profile:a,assetPath:l})=>{t.motionController=new EW(o,a,l);const c=this._assetCache[t.motionController.assetUrl];if(c)n=c.scene.clone(),GR(t,n),this.onLoad&&this.onLoad(n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,u=>{this._assetCache[t.motionController.assetUrl]=u,n=u.scene.clone(),GR(t,n),this.onLoad&&this.onLoad(n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),i.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}const MW="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class kW{constructor(i,t,n,r,o=null,a=null){this.controller=t,this.handModel=i,this.bones=[],o===null&&(o=new rl,o.setPath(n||MW)),o.load(`${r}.glb`,l=>{const c=l.scene.children[0];this.handModel.add(c),c.layers.mask=this.handModel.layers.mask;const u=c.getObjectByProperty("type","SkinnedMesh");u.frustumCulled=!1,u.castShadow=!0,u.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(f=>{const p=c.getObjectByName(f);p!==void 0?p.jointName=f:console.warn(`Couldn't find ${f} in ${r} hand mesh`),this.bones.push(p)}),a&&a(c)})}updateMesh(){const i=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const r=i[n.jointName];if(r.visible){const o=r.position;n.position.copy(o),n.quaternion.copy(r.quaternion)}}}}}var tb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const pa=Q("debugwebxr"),Tc=new Array;class ac extends oe{constructor(){super(...arguments);h(this,"createControllerModel",!0);h(this,"createHandModel",!0);h(this,"customLeftHand");h(this,"customRightHand");h(this,"_models",new Array)}supportsXR(t){return t==="immersive-vr"||t==="immersive-ar"}async onXRControllerAdded(t){var o,a,l;if(!(t.xr.isVR||t.xr.isPassThrough))return;const{controller:r}=t;if(pa&&console.warn("Add Controller Model for",r.side,r.index),this.createControllerModel||this.createHandModel){if(r.hand){if(this.createHandModel){const c=await this.loadHandModel(r);if(!c||!r.connected||!r.isHand){(o=c==null?void 0:c.handObject)==null||o.removeFromParent(),(l=(a=c==null?void 0:c.handmesh)==null?void 0:a.controller)==null||l.removeFromParent();return}this._models.push({controller:r,model:c.handObject,handmesh:c.handmesh}),this._models.sort((u,d)=>u.controller.index-d.controller.index),this.scene.add(c.handObject),r.model=c.handObject}}else if(this.createControllerModel){const c=await r.getModelUrl();if(c){const u=await this.loadModel(r,c);if(!u||!r.connected||r.isHand)return;this._models.push({controller:r,model:u}),this._models.sort((d,f)=>d.controller.index-f.controller.index),this.scene.add(u),u.traverse(d=>{d.layers.set(2),d.matrixWorldAutoUpdate=!1,d.matrixAutoUpdate=!1,d.updateMatrix()}),r.model=u}else r.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+r.side)}}}onXRControllerRemoved(t){var o;const n=this._models.findIndex(a=>a.controller===t.controller),r=this._models[n];r&&(this._models.splice(n,1),r.handmesh&&((o=r.handmesh.handModel)==null||o.removeFromParent(),r.handmesh=void 0),r.model&&(r.model.removeFromParent(),r.model=void 0))}onBeforeRender(){if(Fe.active&&(pa&&(Tc[0]=Date.now()),this.updateRendering(Fe.active),pa)){const t=Date.now()-Tc[0];Tc.push(t),Tc.length>=30&&(Tc[0]=0,Tc.reduce((n,r)=>n+r,0)/Tc.length,Tc.length=0)}}onLeaveXR(t){var n;for(const r of this._models)r&&((n=r.model)==null||n.removeFromParent(),r.controller.model===r.model&&(r.controller.model=null));this._models.length=0}updateRendering(t){var n,r,o,a,l;for(let c=0;c<this._models.length;c++){const u=this._models[c];if(!u)continue;const d=u.controller;if(!d.connected){pa&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",d.side,d.hand);continue}if(u.model&&!u.handmesh)u.model.matrixAutoUpdate=!1,u.model.matrixWorldAutoUpdate=!1,u.model.matrix.copy(d.gripMatrix),u.model.visible=d.isTracking,(n=t.rig)==null||n.gameObject.add(u.model);else if(d.inputSource.hand&&u.handmesh){const f=t.referenceSpace,p=this.context.renderer.xr.getHand(d.index);if(f&&t.frame.getJointPose){for(const g of d.inputSource.hand.values()){const m=p.joints[g.jointName];if(m){const A=d.getHandJointPose(g);if(A){const y=A.transform.position,b=A.transform.orientation;m.position.copy(y),m.quaternion.copy(b),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1}m.visible=A!=null}}u.model&&(u.model.visible=d.isTracking,u.model.visible&&u.model.parent!==((r=t.rig)==null?void 0:r.gameObject)&&((o=t.rig)==null||o.gameObject.add(u.model))),(a=u.model)!=null&&a.visible&&((l=u.handmesh)==null||l.updateMesh(),u.model.matrixWorldAutoUpdate=!1,u.model.matrixAutoUpdate=!1,u.model.matrix.identity(),u.model.applyMatrix4(lf))}}}}async loadModel(t,n){var a;if(!t.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",t.side),null;const o=await tt.getOrCreate("",n).instantiate();return ST(o),(a=Fe.active)!=null&&a.isPassThrough&&o.traverseVisible(l=>{this.makeOccluder(l)}),o}async loadHandModel(t){const n=this.context,r=n.renderer.xr.getHand(t.index);r||(pa?Pe.DrawLabel(t.rayWorldPosition,"No hand found for index "+t.index,.05,5):console.warn("No hand found for index "+t.index));const o=new rl;k0(o,n),await _2(o,n,this.sourceId??""),o.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const a=t.side==="left"?"left.":"right.",l=t.side==="left"?this.customLeftHand:this.customRightHand;if(l)if(!l.uri.includes(a))console.warn("XRControllerModel: custom hand model must be named "+a),Xt("Custom Hand: unexpected name, please see the console for details");else{const d=l.uri.substring(0,l.uri.indexOf(a));o.setPath(d),pa&&console.log("XRControllerModel: loading custom hand model from "+d)}const c=new ne;ST(c);const u=new kW(c,r,o.path,t.inputSource.handedness,o,d=>{d.traverse(f=>{var p;f.layers.set(2),(p=Fe.active)!=null&&p.isPassThrough&&this.makeOccluder(f),f instanceof Z&&pt.assignMeshLOD(f,0)}),t.connected||(pa&&Pe.DrawLabel(t.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),d.removeFromParent())});if(pa&&c.add(new dr(.5)),t.inputSource.hand){pa&&console.log(t.inputSource.hand);for(const d of t.inputSource.hand.values())if(r.joints[d.jointName]===void 0){const f=new Fr;f.matrixAutoUpdate=!1,f.visible=!0,r.joints[d.jointName]=f,r.add(f)}}else pa&&Pe.DrawLabel(t.rayWorldPosition,"No inputSource.hand found for index "+t.index,.05,5);return{handObject:c,handmesh:u}}makeOccluder(t){if(t instanceof Z){let n=t.material;n instanceof mt&&(n=t.material=n.clone(),n.depthWrite=!0,n.depthTest=!0,n.colorWrite=!1,t.receiveShadow=!1,t.renderOrder=-100)}}}h(ac,"factory",new PW);tb([v()],ac.prototype,"createControllerModel",void 0);tb([v()],ac.prototype,"createHandModel",void 0);tb([v(tt)],ac.prototype,"customLeftHand",void 0);tb([v(tt)],ac.prototype,"customRightHand",void 0);const HR=new Cn,KA=new x;class T2 extends QP{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const i=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new ln(i,3)),this.setAttribute("uv",new ln(t,2))}applyMatrix4(i){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(i),n.applyMatrix4(i),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(i){let t;i instanceof Float32Array?t=i:Array.isArray(i)&&(t=new Float32Array(i));const n=new Nw(t,6,1);return this.setAttribute("instanceStart",new Xc(n,3,0)),this.setAttribute("instanceEnd",new Xc(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(i){let t;i instanceof Float32Array?t=i:Array.isArray(i)&&(t=new Float32Array(i));const n=new Nw(t,6,1);return this.setAttribute("instanceColorStart",new Xc(n,3,0)),this.setAttribute("instanceColorEnd",new Xc(n,3,3)),this}fromWireframeGeometry(i){return this.setPositions(i.attributes.position.array),this}fromEdgesGeometry(i){return this.setPositions(i.attributes.position.array),this}fromMesh(i){return this.fromWireframeGeometry(new YF(i.geometry)),this}fromLineSegments(i){const t=i.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Cn);const i=this.attributes.instanceStart,t=this.attributes.instanceEnd;i!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(i),HR.setFromBufferAttribute(t),this.boundingBox.union(HR))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new hc),this.boundingBox===null&&this.computeBoundingBox();const i=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(i!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let o=0,a=i.count;o<a;o++)KA.fromBufferAttribute(i,o),r=Math.max(r,n.distanceToSquared(KA)),KA.fromBufferAttribute(t,o),r=Math.max(r,n.distanceToSquared(KA));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(i){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(i)}}Vn.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ae(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};sf.line={uniforms:a0.merge([Vn.common,Vn.fog,Vn.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class gE extends et{constructor(i){super({type:"LineMaterial",uniforms:a0.clone(sf.line.uniforms),vertexShader:sf.line.vertexShader,fragmentShader:sf.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(i)}get color(){return this.uniforms.diffuse.value}set color(i){this.uniforms.diffuse.value=i}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(i){this.uniforms.linewidth&&(this.uniforms.linewidth.value=i)}get dashed(){return"USE_DASH"in this.defines}set dashed(i){i===!0!==this.dashed&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(i){this.uniforms.dashScale.value=i}get dashSize(){return this.uniforms.dashSize.value}set dashSize(i){this.uniforms.dashSize.value=i}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(i){this.uniforms.dashOffset.value=i}get gapSize(){return this.uniforms.gapSize.value}set gapSize(i){this.uniforms.gapSize.value=i}get opacity(){return this.uniforms.opacity.value}set opacity(i){this.uniforms&&(this.uniforms.opacity.value=i)}get resolution(){return this.uniforms.resolution.value}set resolution(i){this.uniforms.resolution.value.copy(i)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(i){this.defines&&(i===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const VR=new x,WR=new x,Un=new Ue,Nn=new Ue,ga=new Ue,nw=new x,sw=new le,qn=new OC,qR=new x,JA=new Cn,ZA=new hc,ma=new Ue;let Fa,_u;function XR(s,i,t){return ma.set(0,0,-i,1).applyMatrix4(s.projectionMatrix),ma.multiplyScalar(1/ma.w),ma.x=_u/t.width,ma.y=_u/t.height,ma.applyMatrix4(s.projectionMatrixInverse),ma.multiplyScalar(1/ma.w),Math.abs(Math.max(ma.x,ma.y))}function DW(s,i){const t=s.matrixWorld,n=s.geometry,r=n.attributes.instanceStart,o=n.attributes.instanceEnd,a=Math.min(n.instanceCount,r.count);for(let l=0,c=a;l<c;l++){qn.start.fromBufferAttribute(r,l),qn.end.fromBufferAttribute(o,l),qn.applyMatrix4(t);const u=new x,d=new x;Fa.distanceSqToSegment(qn.start,qn.end,d,u),d.distanceTo(u)<_u*.5&&i.push({point:d,pointOnLine:u,distance:Fa.origin.distanceTo(d),object:s,face:null,faceIndex:l,uv:null,uv1:null})}}function OW(s,i,t){const n=i.projectionMatrix,o=s.material.resolution,a=s.matrixWorld,l=s.geometry,c=l.attributes.instanceStart,u=l.attributes.instanceEnd,d=Math.min(l.instanceCount,c.count),f=-i.near;Fa.at(1,ga),ga.w=1,ga.applyMatrix4(i.matrixWorldInverse),ga.applyMatrix4(n),ga.multiplyScalar(1/ga.w),ga.x*=o.x/2,ga.y*=o.y/2,ga.z=0,nw.copy(ga),sw.multiplyMatrices(i.matrixWorldInverse,a);for(let p=0,g=d;p<g;p++){if(Un.fromBufferAttribute(c,p),Nn.fromBufferAttribute(u,p),Un.w=1,Nn.w=1,Un.applyMatrix4(sw),Nn.applyMatrix4(sw),Un.z>f&&Nn.z>f)continue;if(Un.z>f){const w=Un.z-Nn.z,S=(Un.z-f)/w;Un.lerp(Nn,S)}else if(Nn.z>f){const w=Nn.z-Un.z,S=(Nn.z-f)/w;Nn.lerp(Un,S)}Un.applyMatrix4(n),Nn.applyMatrix4(n),Un.multiplyScalar(1/Un.w),Nn.multiplyScalar(1/Nn.w),Un.x*=o.x/2,Un.y*=o.y/2,Nn.x*=o.x/2,Nn.y*=o.y/2,qn.start.copy(Un),qn.start.z=0,qn.end.copy(Nn),qn.end.z=0;const A=qn.closestPointToPointParameter(nw,!0);qn.at(A,qR);const y=ct.lerp(Un.z,Nn.z,A),b=y>=-1&&y<=1,_=nw.distanceTo(qR)<_u*.5;if(b&&_){qn.start.fromBufferAttribute(c,p),qn.end.fromBufferAttribute(u,p),qn.start.applyMatrix4(a),qn.end.applyMatrix4(a);const w=new x,S=new x;Fa.distanceSqToSegment(qn.start,qn.end,S,w),t.push({point:S,pointOnLine:w,distance:Fa.origin.distanceTo(S),object:s,face:null,faceIndex:p,uv:null,uv1:null})}}}class LW extends Z{constructor(i=new T2,t=new gE({color:Math.random()*16777215})){super(i,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const i=this.geometry,t=i.attributes.instanceStart,n=i.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let a=0,l=0,c=t.count;a<c;a++,l+=2)VR.fromBufferAttribute(t,a),WR.fromBufferAttribute(n,a),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+VR.distanceTo(WR);const o=new Nw(r,2,1);return i.setAttribute("instanceDistanceStart",new Xc(o,1,0)),i.setAttribute("instanceDistanceEnd",new Xc(o,1,1)),this}raycast(i,t){const n=this.material.worldUnits,r=i.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=i.params.Line2!==void 0&&i.params.Line2.threshold||0;Fa=i.ray;const a=this.matrixWorld,l=this.geometry,c=this.material;_u=c.linewidth+o,l.boundingSphere===null&&l.computeBoundingSphere(),ZA.copy(l.boundingSphere).applyMatrix4(a);let u;if(n)u=_u*.5;else{const f=Math.max(r.near,ZA.distanceToPoint(Fa.origin));u=XR(r,f,c.resolution)}if(ZA.radius+=u,Fa.intersectsSphere(ZA)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),JA.copy(l.boundingBox).applyMatrix4(a);let d;if(n)d=_u*.5;else{const f=Math.max(r.near,JA.distanceToPoint(Fa.origin));d=XR(r,f,c.resolution)}JA.expandByScalar(d),Fa.intersectsBox(JA)!==!1&&(n?DW(this,t):OW(this,r,t))}}class R2 extends T2{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(i){const t=i.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=i[r],n[2*r+1]=i[r+1],n[2*r+2]=i[r+2],n[2*r+3]=i[r+3],n[2*r+4]=i[r+4],n[2*r+5]=i[r+5];return super.setPositions(n),this}setColors(i){const t=i.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=i[r],n[2*r+1]=i[r+1],n[2*r+2]=i[r+2],n[2*r+3]=i[r+3],n[2*r+4]=i[r+4],n[2*r+5]=i[r+5];return super.setColors(n),this}fromLine(i){const t=i.geometry;return this.setPositions(t.attributes.position.array),this}}class FW extends LW{constructor(i=new R2,t=new gE({color:Math.random()*16777215})){super(i,t),this.isLine2=!0,this.type="Line2"}}class mE extends oe{}var Ch=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const rw=Q("debugwebxr");class So extends oe{constructor(){super(...arguments);h(this,"movementSpeed",1.5);h(this,"rotationStep",30);h(this,"useTeleport",!0);h(this,"usePinchToTeleport",!0);h(this,"useTeleportTarget",!1);h(this,"useTeleportFade",!1);h(this,"showRays",!0);h(this,"showHits",!0);h(this,"isXRMovementHandler",!0);h(this,"xrSessionMode","immersive-vr");h(this,"_didApplyRotation",!1);h(this,"_didTeleport",!1);h(this,"_teleportBuffer",new Array);h(this,"_plane",null);h(this,"_lines",[]);h(this,"_hitDiscs",[]);h(this,"_hitDistances",[]);h(this,"_lastHitDistances",[]);h(this,"hitPointRaycastFilter",t=>t.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(t){const n=t.xr.rig;if(!(n!=null&&n.gameObject)||t.xr.isPassThrough)return;const r=t.xr.leftController,o=t.xr.rightController;r&&this.onHandleMovement(r,n.gameObject),o&&(this.onHandleRotation(o,n.gameObject),this.useTeleport&&this.onHandleTeleport(o,n.gameObject))}onLeaveXR(t){for(const n of this._lines)n.removeFromParent();for(const n of this._hitDiscs)n==null||n.removeFromParent()}onBeforeRender(){var t;(t=this.context.xr)!=null&&t.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(t,n){const r=t.getStick("xr-standard-thumbstick");if(r.x!=0||r.y!=0){const o=Be(r.x,0,r.y);o.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const a=oi(n);o.multiplyScalar(a.x),o.applyQuaternion(t.xr.poseOrientation),o.y=0,o.applyQuaternion(n.worldQuaternion),n.position.add(o),n.updateWorldMatrix(!1,!1);for(const l of n.children)l.updateWorldMatrix(!1,!1)}}onHandleRotation(t,n){if(t._isMxInk)return;const o=t.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(o)<.3&&(this._didApplyRotation=!1);else if(Math.abs(o)>.5){this._didApplyRotation=!0;const a=o>0?1:-1,l=Ve(this.context.mainCamera).clone();n.rotateY(a*ye.toRadians(this.rotationStep));const u=Ve(this.context.mainCamera).clone().sub(l);u.y=0,n.position.sub(u)}}onHandleTeleport(t,n){var o,a,l,c,u;let r=0;if(t.hand&&this.usePinchToTeleport&&t.isTeleportGesture){const d=t.getPointerId("primary");if(d!=null&&this.context.input.getIsPointerIdInUse(d))return;const f=t.getGesture("pinch");f&&(r=f.value)}else r=(o=t.getStick("xr-standard-thumbstick"))==null?void 0:o.y;if(this._didTeleport)r>=0&&r<.4?this._didTeleport=!1:r<0&&r>-.4&&(this._didTeleport=!1);else if(r>.8){this._didTeleport=!0;const d=this.context.physics.raycastFromRay(t.ray)[0];if(d&&d.object instanceof If){const p=(a=d.normal)==null?void 0:a.dot(Be(0,1,0));if(p!==void 0&&p<.4)return}let f=d==null?void 0:d.point;if(!f&&!this.useTeleportTarget){this._plane||(this._plane=new tc(new x(0,1,0),0));const p=n.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new x(0,1,0),p);const g=t.ray;f=p.clone(),this._plane.intersectLine(new OC(g.origin,Be(g.direction).multiplyScalar(1e4).add(g.origin)),f),f.distanceTo(p)>n.scale.x*10&&(f=null)}if(f){if(this.useTeleportTarget&&!j.getComponentInParent(d.object,mE))return;const p=f.clone();if(rw&&Pe.DrawSphere(f,.025,16711680,5),(l=this.context.mainCamera)==null?void 0:l.position){const m=(c=this.context.xr)==null?void 0:c.getUserOffsetInRig();m&&(m.y=0,p.sub(m),rw&&Pe.DrawWireSphere(m.add(p),.025,65280,5))}this._teleportBuffer.push(n.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(u=t.xr.fadeTransition())==null||u.then(()=>{n.worldPosition=p}):n.worldPosition=p}}else if(r<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const d=this._teleportBuffer.pop();d&&d.decompose(n.position,n.quaternion,n.scale)}}renderRays(t){var n;for(let r=0;r<this._lines.length;r++){const o=this._lines[r];o&&(o.visible=!1)}for(let r=0;r<t.controllers.length;r++){const o=t.controllers[r];let a=this._lines[r];if(!o.connected||!o.isTracking||!o.ray||o.targetRayMode==="transient-pointer"||!o.hasSelectEvent){a&&(a.visible=!1);continue}a||(a=this.createRayLineObject(),a.scale.z=.5,this._lines[r]=a),o.updateRayWorldPosition(),o.updateRayWorldQuaternion();const l=o.rayWorldPosition,c=o.rayWorldQuaternion;a.position.copy(l),a.quaternion.copy(c);const u=t.rigScale,d=this.usePinchToTeleport&&o.isTeleportGesture,f=this._lastHitDistances[r],p=this._hitDistances[r]!=null,g=f??u;a.scale.set(u,u,g),a.visible=!0,a.layers.disableAll(),a.layers.enable(2);let m=a.material.opacity;d?m=1:this.showHits&&g<t.rigScale*.5?m=0:(n=o.getButton("primary"))!=null&&n.pressed?m=.5:m=p?.2:.1,a.material.opacity=ye.lerp(a.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),a.parent!==this.context.scene&&this.context.scene.add(a)}}renderHits(t){var n;for(const r of this._hitDiscs){if(!r)continue;const o=r.controller;if(!o||!o.connected||!o.isTracking){r.visible=!1;continue}}for(let r=0;r<t.controllers.length;r++){const o=t.controllers[r];if(!o.connected||!o.isTracking||!o.ray||!o.hasSelectEvent)continue;let a=this._hitDiscs[r],l=!0;const c=o.getPointerId("primary");c!=null&&this.context.input.getIsPointerIdInUse(c)&&(a&&(a.visible=!1),this._hitDistances[r]=null,this._lastHitDistances[r]=0,l=!1);const u=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+o.index)%u!==0&&(l=!1),!l){const p=this._hitDiscs[r];p&&p.visible&&p.hit&&this.updateHitPointerPosition(o,p,p.hit.distance);continue}const d=this.context.physics.raycastFromRay(o.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let f=d.find(p=>this.usePinchToTeleport&&o.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(p.object));if(f||(f=d[0]),a&&(a.controller=o,a.hit=f),this._hitDistances[r]=(f==null?void 0:f.distance)||null,f){this._lastHitDistances[r]=f.distance;const p=t.rigScale??1;rw&&(Pe.DrawWireSphere(f.point,.025*p,16711680),Pe.DrawLabel(Be(0,.2,0).add(f.point),f.object.name,.02,0)),a||(a=this.createHitPointObject(),this._hitDiscs[r]=a),a.hit=f,a.visible=f.distance>p*.05;let g=.01*(p+f.distance);const m=(n=o.getButton("primary"))==null?void 0:n.pressed;m&&(g*=1.1),a.scale.set(g,g,g),a.layers.set(2);let A=a.material.opacity;if(m?A=1:A=f.distance<.15*p?.2:.6,a.material.opacity=ye.lerp(a.material.opacity,A,this.context.time.deltaTimeUnscaled/.1),a.visible){if(f.normal){this.updateHitPointerPosition(o,a,f.distance);const y=f.normal.applyQuaternion(Ht(f.object));a.quaternion.setFromUnitVectors(UW,y)}else this.updateHitPointerPosition(o,a,f.distance);a.parent!==this.context.scene&&this.context.scene.add(a)}}else this._hitDiscs[r]&&(this._hitDiscs[r].visible=!1)}}isObjectWithInteractiveComponent(t,n=0){return Gx(t)||t.isUI===!0?!0:t.isScene?!1:t.parent?this.isObjectWithInteractiveComponent(t.parent,n+1):!1}updateHitPointerPosition(t,n,r){const o=Be(t.rayWorldPosition);o.add(Be(0,0,r-.01).applyQuaternion(t.rayWorldQuaternion)),n.position.lerp(o,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const t=new Z(new Pu(.3,6,6),new _t({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:_i}));return t.layers.disableAll(),t.layers.enable(2),t}createRayLineObject(){const t=new FW;t.layers.disableAll(),t.layers.enable(2);const n=new R2;t.geometry=n;const r=new Float32Array(9);r.set([0,0,.02,0,0,.4,0,0,1]),n.setPositions(r);const o=new Float32Array(9);o.set([1,1,1,.1,.1,.1,0,0,0]),n.setColors(o);const a=new gE({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:l0,dashed:!1});return t.material=a,t}}Ch([v()],So.prototype,"movementSpeed",void 0);Ch([v()],So.prototype,"rotationStep",void 0);Ch([v()],So.prototype,"useTeleport",void 0);Ch([v()],So.prototype,"usePinchToTeleport",void 0);Ch([v()],So.prototype,"useTeleportTarget",void 0);Ch([v()],So.prototype,"useTeleportFade",void 0);Ch([v()],So.prototype,"showRays",void 0);Ch([v()],So.prototype,"showHits",void 0);const UW=new x(0,1,0);var Pn=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const $A=Q("debugwebxr"),NW=Q("debugusdz"),tu=class extends oe{constructor(){super(...arguments);h(this,"createVRButton",!0);h(this,"createARButton",!0);h(this,"createSendToQuestButton",!0);h(this,"createQRCode",!0);h(this,"useDefaultControls",!0);h(this,"showControllerModels",!0);h(this,"showHandModels",!0);h(this,"usePlacementReticle",!0);h(this,"customARPlacementReticle");h(this,"usePlacementAdjustment",!0);h(this,"arScale",1);h(this,"useXRAnchor",!1);h(this,"autoPlace",!0);h(this,"autoCenter",!0);h(this,"useQuicklookExport",!1);h(this,"useDepthSensing",!1);h(this,"useSpatialGrab",!0);h(this,"defaultAvatar");h(this,"_playerSync");h(this,"_createdComponentsInSession",[]);h(this,"_usdzExporter");h(this,"_exitXRMenuButton");h(this,"_previousXRState",0);h(this,"_spatialGrabRaycaster");h(this,"onAvatarSpawned",t=>{$A&&console.log("WebXR.onAvatarSpawned",t),j.getComponentInChildren(t,Eu)??(n=j.addComponent(t,Eu))});h(this,"_buttonFactory");h(this,"_buttons",[])}awake(){Fe.getXRSync(this.context)}onEnable(){var t,n;window.location.protocol!=="https:"&&Xt('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(j.findObjectOfType(li)||($A&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=j.addComponent(this.gameObject,li),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&($A&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new tt("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(Gu),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(t=this._playerSync.onPlayerSpawned)==null||t.removeEventListener(this.onAvatarSpawned),(n=this._playerSync.onPlayerSpawned)==null||n.addEventListener(this.onAvatarSpawned))}onDisable(){var t;(t=this._usdzExporter)==null||t.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Fe.isVRSupported()&&this.createVRButton?Fe.offerSession("immersive-vr","default",this.context):this.createARButton&&await Fe.isARSupported()&&this.createARButton?Fe.offerSession("immersive-ar","default",this.context):!1}get session(){return Fe.active??null}get sessionMode(){return Fe.activeMode??null}async enterVR(t){return Fe.start("immersive-vr",t,this.context)}async enterAR(t){return Fe.start("immersive-ar",t,this.context)}exitXR(){Fe.stop()}get isActiveWebXR(){return!tu.activeWebXRComponent||tu.activeWebXRComponent===this}onBeforeXR(t,n){var r;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(r=tu.activeWebXRComponent)==null?void 0:r.name}). This is ignored: ${this.name}`);return}tu.activeWebXRComponent=this,t=="immersive-ar"&&this.useDepthSensing&&(n.optionalFeatures=n.optionalFeatures||[],n.optionalFeatures.push("depth-sensing"))}async onEnterXR(t){if(!this.isActiveWebXR)return;$A&&console.log("WebXR onEnterXR"),this._previousXRState=bs.Global.Mask;const n=t.xr.isVR;if(bs.Global.Set(n?go.VR:go.AR),this.usePlacementReticle&&t.xr.isAR){let r=j.findObjectOfType(fh);if(!r){const o=new ne;for(const a of this.context.scene.children)o.add(a);this.context.scene.add(o),r=j.addComponent(o,fh),this._createdComponentsInSession.push(r)}r.customReticle=this.customARPlacementReticle,r.arScale=this.arScale,r.arTouchTransform=this.usePlacementAdjustment,r.autoPlace=this.autoPlace,r.autoCenter=this.autoCenter,r.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=j.findObjectOfType(Au)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(Au))),this.createLocalAvatar(t.xr),this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4})}onUpdateXR(t){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(t){var n,r;if((n=this._exitXRMenuButton)==null||n.remove(),!!this.isActiveWebXR){bs.Global.Set(this._previousXRState),(r=this._playerSync)==null||r.destroyInstance();for(const o of this._createdComponentsInSession)o.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),LC(1).then(()=>tu.activeWebXRComponent=null)}}setDefaultMovementEnabled(t){let n=this.gameObject.getComponent(So);return!n&&t&&(n=this.gameObject.addComponent(So),this._createdComponentsInSession.push(n)),n&&(n.enabled=t),n}setDefaultControllerRenderingEnabled(t){let n=this.gameObject.getComponent(ac);return!n&&t&&(n=this.gameObject.addComponent(ac),this._createdComponentsInSession.push(n),n.createControllerModel=this.showControllerModels,n.createHandModel==this.showHandModels),n&&(n.enabled=t),n}async createLocalAvatar(t){this._playerSync&&t.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=rh.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((Cu()&&$p()||NW)&&this.useQuicklookExport){const n=j.findObjectOfType(li);if(!n||n&&n.allowCreateQuicklookButton){const r=this.getButtonsFactory().createQuicklookButton();this.addButton(r,50)}}if(this.createARButton){const n=this.getButtonsFactory().createARButton();this.addButton(n,50)}if(this.createVRButton){const n=this.getButtonsFactory().createVRButton();this.addButton(n,50)}}if(this.createSendToQuestButton&&!UC()&&Fe.isVRSupported().then(n=>{if(!n){const r=this.getButtonsFactory().createSendToQuestButton();this.addButton(r,50)}}),this.createQRCode){const n=US(Ac);if(n&&n.createQRCodeButton===!1)be()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else{const r=Ha.getOrCreate().createQRCode();this.addButton(r,50)}}}addButton(t,n){this._buttons.push(t),t.setAttribute("priority",n.toString()),this.context.menu.appendChild(t)}removeButtons(){for(const t of this._buttons)t.remove();this._buttons.length=0}};let Ai=tu;h(Ai,"activeWebXRComponent",null);Pn([v()],Ai.prototype,"createVRButton",void 0);Pn([v()],Ai.prototype,"createARButton",void 0);Pn([v()],Ai.prototype,"createSendToQuestButton",void 0);Pn([v()],Ai.prototype,"createQRCode",void 0);Pn([v()],Ai.prototype,"useDefaultControls",void 0);Pn([v()],Ai.prototype,"showControllerModels",void 0);Pn([v()],Ai.prototype,"showHandModels",void 0);Pn([v()],Ai.prototype,"usePlacementReticle",void 0);Pn([v(tt)],Ai.prototype,"customARPlacementReticle",void 0);Pn([v()],Ai.prototype,"usePlacementAdjustment",void 0);Pn([v()],Ai.prototype,"arScale",void 0);Pn([v()],Ai.prototype,"useXRAnchor",void 0);Pn([v()],Ai.prototype,"autoPlace",void 0);Pn([v()],Ai.prototype,"autoCenter",void 0);Pn([v()],Ai.prototype,"useQuicklookExport",void 0);Pn([v()],Ai.prototype,"useDepthSensing",void 0);Pn([v()],Ai.prototype,"useSpatialGrab",void 0);Pn([v(tt)],Ai.prototype,"defaultAvatar",void 0);class AE{get extensionName(){return"Physics"}onExportObject(i,t,n){const r=j.getComponents(i,It).filter(c=>c.enabled),o=j.getComponents(i,Io).filter(c=>c.enabled&&!c.isTrigger);let a=r.length>0?r[0]:null;const l=o.length>0?o[0]:null;l&&!a&&(a=new It,a.isKinematic=!0),a&&t.addEventListener("serialize",(c,u)=>{var d,f,p;if(a){if(c.appendLine(),c.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),a.useGravity||c.appendLine("bool gravityEnabled = 0"),c.appendLine('uniform token info:id = "RealityKit.RigidBody"'),a.isKinematic&&c.appendLine('token motionType = "Kinematic"'),c.beginBlock('def RealityKitStruct "massFrame"',"{",!0),c.appendLine(`float m_mass = ${a.mass}`),c.beginBlock('def RealityKitStruct "m_pose"',"{",!0),c.appendLine(`float3 position = (${a.centerOfMass.x}, ${a.centerOfMass.y}, ${a.centerOfMass.z})`),c.closeBlock("}"),c.closeBlock("}"),o.length>0){const g=o[0];c.beginBlock('def RealityKitStruct "material"',"{",!0);const m=g.sharedMaterial;m&&m.dynamicFriction!==void 0&&c.appendLine(`double dynamicFriction = ${(d=g.sharedMaterial)==null?void 0:d.dynamicFriction}`),m&&m.bounciness!==void 0&&c.appendLine(`double restitution = ${(f=g.sharedMaterial)==null?void 0:f.bounciness}`),m&&m.staticFriction!==void 0&&c.appendLine(`double staticFriction = ${(p=g.sharedMaterial)==null?void 0:p.staticFriction}`),c.closeBlock("}")}c.closeBlock("}")}}),l&&(t.addEventListener("serialize",(c,u)=>{var p;c.beginBlock('def RealityKitComponent "Collider"',"{",!0),c.appendLine("uint group = 1"),c.appendLine('uniform token info:id = "RealityKit.Collider"'),c.appendLine("uint mask = 4294967295");const f=l.isTrigger?"Trigger":"Default";if(c.appendLine(`token type = "${f}"`),c.beginBlock('def RealityKitStruct "Shape"',"{",!0),l instanceof Fm){const g=l;c.appendLine('token shapeType = "Sphere"'),c.appendLine(`float radius = ${g.radius}`)}else if(l instanceof Vu){const g=l;c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${g.size.x}, ${g.size.y}, ${g.size.z})`)}else if(l instanceof dh){const g=l;c.appendLine('token shapeType = "Capsule"'),c.appendLine(`float radius = ${g.radius}`),c.appendLine(`float height = ${g.height}`)}else if(l instanceof Hf&&((p=l.sharedMesh)!=null&&p.geometry)){const g=l.sharedMesh.geometry;g.boundingBox||g.computeBoundingBox();const m=l.sharedMesh.geometry.boundingBox;m&&(c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${m.max.x-m.min.x}, ${m.max.y-m.min.y}, ${m.max.z-m.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",l))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",l);c.beginBlock('def RealityKitStruct "pose"',"{",!0),c.closeBlock("}"),c.closeBlock("}"),c.closeBlock("}")}),o.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",l))}}var vc=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Uh=Q("debugtext");var rt;(function(s){s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight"})(rt||(rt={}));var _g;(function(s){s[s.Truncate=0]="Truncate",s[s.Overflow=1]="Overflow"})(_g||(_g={}));var wg;(function(s){s[s.Wrap=0]="Wrap",s[s.Overflow=1]="Overflow"})(wg||(wg={}));var rr;(function(s){s[s.Normal=0]="Normal",s[s.Bold=1]="Bold",s[s.Italic=2]="Italic",s[s.BoldAndItalic=3]="BoldAndItalic"})(rr||(rr={}));class $s extends Zl{constructor(){super(...arguments);h(this,"alignment",rt.UpperLeft);h(this,"verticalOverflow",_g.Truncate);h(this,"horizontalOverflow",wg.Wrap);h(this,"lineSpacing",1);h(this,"supportRichText",!1);h(this,"font");h(this,"fontStyle",rr.Normal);h(this,"sRGBTextColor",new xe(1,0,1));h(this,"_text","");h(this,"_fontSize",12);h(this,"_textMeshUi",null);h(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var n;super.setAlphaFactor(t),(n=this.uiObject)==null||n.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var n;this._fontSize=t,(n=this.uiObject)==null||n.set({fontSize:t})}onColorChanged(){var t;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(t=this.uiObject)==null||t.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var n;const t=(n=this.uiObject)==null?void 0:n._overflow;t&&(t._needsUpdate=!0)}onCreate(t){Uh&&console.log(this),this.horizontalOverflow==wg.Overflow&&(t.whiteSpace="pre"),this.verticalOverflow==_g.Truncate&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==wg.Overflow&&this.verticalOverflow==_g.Truncate,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,Uh&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const n=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),Uh&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=n.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,n={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(n,this.fontStyle),n}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case rt.UpperLeft:case rt.MiddleLeft:case rt.LowerLeft:t.textAlign="left";break;case rt.UpperCenter:case rt.MiddleCenter:case rt.LowerCenter:t.textAlign="center";break;case rt.UpperRight:case rt.MiddleRight:case rt.LowerRight:t.textAlign="right";break}switch(this.alignment){default:case rt.UpperLeft:case rt.UpperCenter:case rt.UpperRight:t.alignItems="start";break;case rt.MiddleLeft:case rt.MiddleCenter:case rt.MiddleRight:t.alignItems="center";break;case rt.LowerLeft:case rt.LowerCenter:case rt.LowerRight:t.alignItems="end";break}return t}feedText(t,n){var r,o,a;if(Uh&&console.log("feedText",this.uiObject,t,n),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!n||t.length===0)this.uiObject.textContent=t;else{let l=this.getNextTag(t);if(l){if(l.startIndex>0){for(let d=this.uiObject.children.length-1;d>=0;d--){const f=this.uiObject.children[d];f.isUI&&(this.uiObject.remove(f),f.clear())}const u=new mv({textContent:t.substring(0,l.startIndex),color:"inherit"});this.uiObject.add(u)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const c=[];for(;l;){const u=this.getNextTag(t,l.endIndex),d={fontFamily:(r=this.uiObject)==null?void 0:r.get("fontFamily"),color:"inherit",textContent:""};if(u){d.textContent=this.getText(t,l,u),this.handleTag(l,d,c);const f=new mv(d);(o=this.uiObject)==null||o.add(f)}else{d.textContent=t.substring(l.endIndex),this.handleTag(l,d,c);const f=new mv(d);(a=this.uiObject)==null||a.add(f)}l=u}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],n=this.canvas,r={renderOnTop:n.renderOnTop,depthWrite:n.depthWrite,doubleSided:n.doubleSided};for(;;){let o=!1;if(this._textMeshUi)for(let a=0;a<this._textMeshUi.length;a++){if(t[a]===!0)continue;o=!0;const l=this._textMeshUi[a];l.textContent&&(vy(l,r),t[a]=!0)}if(!o)break;yield}}handleTag(t,n,r){if(!t.isEndTag){if(t.type.includes("color")){const o=new ow(t,{color:n.color});if(r.push(o),t.type.length>6){const a=parseInt("0x"+t.type.substring(7));n.color=a}else n.color=new xe(1,1,1)}else if(t.type=="b"){this.setFont(n,rr.Bold);const o=new ow(t,{fontWeight:700});r.push(o)}else if(t.type=="i"){this.setFont(n,rr.Italic);const o=new ow(t,{fontStyle:"italic"});r.push(o)}}}getText(t,n,r){return t.substring(n.endIndex,r.startIndex)}getNextTag(t,n=0){const r=t.indexOf("<",n),o=t.indexOf(">",r);if(r>=0&&o>=0){const a=t.substring(r+1,o);return{type:a,startIndex:r,endIndex:o+1,isEndTag:a.startsWith("/")}}return null}setFont(t,n){if(!this.font)return;const r=this.font,o=this.getFamilyNameWithCorrectSuffix(r,n);Uh&&console.log("Selected font family:"+o);let a=Ww.getFontFamily(o);switch(a||(a=Ww.addFontFamily(o)),t.fontFamily=a,n){default:case rr.Normal:t.fontWeight=400,t.fontStyle="normal";break;case rr.Bold:t.fontWeight=700,t.fontStyle="normal";break;case rr.Italic:t.fontWeight=400,t.fontStyle="italic";break;case rr.BoldAndItalic:t.fontStyle="italic",t.fontWeight=400}let l=a.getVariant(t.fontWeight,t.fontStyle);if(!l){let c=o;c!=null&&c.endsWith("-msdf.json")||(c+="-msdf.json");let u=o;u!=null&&u.endsWith(".png")||(u+=".png"),l=a.addVariant(t.fontWeight,t.fontStyle,c,u),l==null||l.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,n){var d;const r=t.lastIndexOf("-");if(r<0)return t;const o=(d=t.substring(r+1))==null?void 0:d.toLowerCase();if(zW.includes(o))return Uh&&console.warn("Unsupported font style: "+o),t;const a=t.lastIndexOf("/");let l=t;a>=0&&(l=l.substring(a+1));const c=l[0]===l[0].toUpperCase(),u=t.substring(0,r);switch(Uh&&console.log("Select font: ",t,rr[n],l,c,u),n){case rr.Normal:return c?u+"-Regular":u+"-regular";case rr.Bold:return c?u+"-Bold":u+"-bold";case rr.Italic:return c?u+"-Italic":u+"-italic";case rr.BoldAndItalic:return c?u+"-BoldItalic":u+"-bolditalic";default:return t}}}vc([v()],$s.prototype,"alignment",void 0);vc([v()],$s.prototype,"verticalOverflow",void 0);vc([v()],$s.prototype,"horizontalOverflow",void 0);vc([v()],$s.prototype,"lineSpacing",void 0);vc([v()],$s.prototype,"supportRichText",void 0);vc([v(URL)],$s.prototype,"font",void 0);vc([v()],$s.prototype,"fontStyle",void 0);vc([v()],$s.prototype,"text",null);vc([v()],$s.prototype,"fontSize",null);class ow{constructor(i,t){h(this,"tag");h(this,"previousValues");this.tag=i,this.previousValues=t}}const zW=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var xg;(function(s){s.singleLine="singleLine",s.hardBreaks="hardBreaks",s.flowing="flowing"})(xg||(xg={}));var jd;(function(s){s.left="left",s.center="center",s.right="right",s.justified="justified"})(jd||(jd={}));var Gd;(function(s){s.top="top",s.middle="middle",s.lowerMiddle="lowerMiddle",s.baseline="baseline",s.bottom="bottom"})(Gd||(Gd={}));class ru{constructor(i){h(this,"id");h(this,"content","");h(this,"font",[]);h(this,"pointSize",144);h(this,"width");h(this,"height");h(this,"depth");h(this,"wrapMode");h(this,"horizontalAlignment");h(this,"verticalAlignment");h(this,"material");this.id=i}static getId(){return this.global_id++}setDepth(i){return this.depth=i,this}setPointSize(i){return this.pointSize=i,this}setHorizontalAlignment(i){return this.horizontalAlignment=i,this}setVerticalAlignment(i){return this.verticalAlignment=i,this}writeTo(i,t){var r;t.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),t.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),t.closeBlock(")"),t.beginBlock(),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(r=this.font)==null||r.push("sans-serif"));const n=this.font.map(o=>`"${o}"`).join(", ");t.appendLine(`string[] font = [ ${n} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </StageRoot/Materials/${XS(this.material)}>`),t.closeBlock()}}h(ru,"global_id",0);class vE{static singleLine(i,t,n){const r=new ru("text_"+ru.getId());return r.content=i,t&&(r.pointSize=t),n&&(r.depth=n),r}static multiLine(i,t,n,r,o,a){const l=new ru("text_"+ru.getId());return l.content=i,l.width=t,l.height=n,l.horizontalAlignment=r,l.verticalAlignment=o,a!==void 0&&(l.wrapMode=a),l}}const QW=new le().makeRotationY(Math.PI),jW=new le().makeScale(-1,1,-1);class ib{get extensionName(){return"text"}exportText(i,t,n){const r=j.getComponent(i,$s);if(!r)return;const o=j.getComponent(i,ts);let a=100,l=100;o&&(a=o.width,l=o.height),t.matrix=QW.clone(),o&&t.matrix.premultiply(jW);const c=r.color.clone();t.material=new Jn({color:c,emissive:c}),t.addEventListener("serialize",(u,d)=>{let f=r.text;f=f.replace(/\r/g,""),f=f.replace(/\n/g,"\\n");const p=vE.multiLine(f,a,l,jd.center,Gd.bottom,xg.flowing);this.setTextAlignment(p,r.alignment),this.setOverflow(p,r),t.material&&(p.material=t.material),p.pointSize=this.convertToTextSize(r.fontSize),p.depth=.001,p.writeTo(void 0,u)})}convertToTextSize(i){return 1/.0502*144*i}setOverflow(i,t){t.horizontalOverflow?i.wrapMode=xg.singleLine:i.wrapMode=xg.flowing}setTextAlignment(i,t){switch(t){case rt.LowerLeft:case rt.MiddleLeft:case rt.UpperLeft:i.horizontalAlignment=jd.left;break;case rt.LowerCenter:case rt.MiddleCenter:case rt.UpperCenter:i.horizontalAlignment=jd.center;break;case rt.LowerRight:case rt.MiddleRight:case rt.UpperRight:i.horizontalAlignment=jd.right;break}switch(t){case rt.LowerLeft:case rt.LowerCenter:case rt.LowerRight:i.verticalAlignment=Gd.bottom;break;case rt.MiddleLeft:case rt.MiddleCenter:case rt.MiddleRight:i.verticalAlignment=Gd.middle;break;case rt.UpperLeft:case rt.UpperCenter:case rt.UpperRight:i.verticalAlignment=Gd.top;break}}}class yE{get extensionName(){return"tmui"}onExportObject(i,t,n){const r=j.getComponent(i,In);if(r&&r.enabled&&r.renderMode===Ta.WorldSpace){const o=new ib,a=j.getComponent(i,ts),l=j.getComponent(i,Iu),c=new Array;if(a){if(!j.isActiveSelf(i)){const f=j.isActiveSelf(i);j.setActive(i,!0),a.onEnable(),a.updateTransform(),c.push(()=>{a.onDisable(),j.setActive(i,f)})}i.traverse(f=>{if(!j.isActiveInHierarchy(f)){const p=j.isActiveSelf(f);j.setActive(f,!0);const g=j.getComponent(f,sa);g&&(g.onEnable(),c.push(()=>{g.onDisable()}));const m=j.getComponent(f,ts);m&&(m.onEnable(),m.updateTransform(),m.onApplyTransform(),c.push(()=>{m.onDisable()}));const A=j.getComponent(f,$s);A&&(A.onEnable(),c.push(()=>{A.onDisable()})),c.push(()=>{j.setActive(f,p)})}}),a.width,a.height;const u=_s.createEmpty(),d=a.shadowComponent;if(t.add(u),d){const f=d.matrix;u.matrix.copy(f);const p=new Map,g=new Map;p.set(d,u),g.set(d,l?l.alpha:1),d.traverse(m=>{if(m===d)return;const A=_s.createEmpty();A.matrix.copy(m.matrix);const y=m.parent,b=!!y&&typeof y.textContent=="string"&&y.textContent.length>0;let _=g.get(y)||1;const w=j.getComponent(m,Iu);if(w&&(_*=w.alpha),m instanceof Z&&b){const E=m[po];E?o.exportText(E.gameObject,A,n):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",m)}if(m instanceof Z&&!b){const E=m.geometry.clone();E.scale(1,1,-1),this.flipWindingOrder(E),A.geometry=E;const I=new xe,k=m.material.opacity;I.copy(m.material.color),A.material=new _t({color:I,opacity:k*_,map:m.material.map,transparent:!0})}p.set(m,A),g.set(m,_);const S=p.get(y);if(!S){console.error("Error when exporting UI: shadow component parent not found!",m,m.parent);return}S.add(A)})}}for(const u of c)u()}}flipWindingOrder(i){const t=i.index.array;for(let n=0,r=t.length/3;n<r;n++){const o=t[n*3];t[n*3]=t[n*3+2],t[n*3+2]=o}i.index.needsUpdate=!0}}const Kp=Q("debugusdz");function GW(s,i){var l;const t=[],n=j.getComponentsInChildren(s,Cs),r=j.getComponentsInChildren(s,qs),o=new Array,a=new Array;if(i.injectImplicitBehaviours)for(const c of n){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;const u=c.runtimeAnimatorController.activeState;if(!u||!u.motion||!u.motion.clip||((l=u.motion.clip.tracks)==null?void 0:l.length)<1||o.includes(c))continue;const d=new Wa;d.animator=c,d.stateName=u.name,d.trigger="start",d.name="PlayAnimationOnClick_implicitAtStart_"+d.stateName;const f=new ne;j.addComponent(f,d),a.push(f),o.push(c),s.add(f)}else for(const c of n){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;Kp&&console.log(c);const u=[];for(const d of c.runtimeAnimatorController.enumerateActions()){Kp&&console.log(d);const f=d.getClip();u.includes(f)||u.push(f)}t.push({root:c.gameObject,clips:u})}if(i.injectImplicitBehaviours)for(const c of r){if(!c||!c.clip||!c.enabled||!c.playAutomatically||o.includes(c))continue;const u=new Wa;u.animation=c,u.stateName=c.clip.name,u.trigger="start",u.name="PlayAnimationOnClick_implicitAtStart_"+u.stateName;const d=new ne;j.addComponent(d,u),a.push(d),o.push(c),s.add(d)}else for(const c of r){Kp&&console.log(c);const u=[];for(const d of c.animations)u.includes(d)||u.push(d);t.push({root:c.gameObject,clips:u})}Kp&&(t==null?void 0:t.length)>0&&console.log("USDZ Animation Clips without behaviours",t);for(const c of t)for(const u of c.clips)i.registerAnimation(c.root,u);return a}function HW(s,i){const t=j.getComponentsInChildren(s,kt),n=j.getComponentsInChildren(s,Tu),r=new Array,o=new Array;Kp&&console.log({audioSources:t,playAudioOnClicks:n});for(const a of n){if(!a.target)continue;const l=t.indexOf(a.target);l>-1&&t.splice(l,1)}for(const a of t){if(!a||!a.clip||a.volume<=0||r.includes(a))continue;const l=new Tu;l.target=a,l.name="PlayAudioOnClick_implicitAtStart_",l.trigger="start";const c=new ne;j.addComponent(c,l),console.log("implicit PlayAudioOnStart",c,l),o.push(c),r.push(a),s.add(c)}return o}function VW(s){return new cn("DisableAtStart",es.sceneStartTrigger(),Ct.fadeAction(s,0,!1))}function YR(s){const i=s.domElement.shadowRoot.querySelector("link[rel='ar']");if(i)return i;const t=document.createElement("div");t.classList.add("menu"),t.classList.add("quicklook-menu"),t.style.display="none",t.style.visibility="hidden";const n=document.createElement("button");n.id="open-in-ar",n.innerText="Open in QuickLook",t.appendChild(n);const r=document.createElement("a");r.id="needle-usdz-link",r.style.display="none",r.rel="ar",r.href="",t.appendChild(r);const o=document.createElement("img");return o.id="button",r.appendChild(o),s.domElement.shadowRoot.appendChild(t),r}var Rs=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const eo=Q("debugusdz");class Ku{constructor(){h(this,"callToAction");h(this,"checkoutTitle");h(this,"checkoutSubtitle");h(this,"callToActionURL")}}Rs([v()],Ku.prototype,"callToAction",void 0);Rs([v()],Ku.prototype,"checkoutTitle",void 0);Rs([v()],Ku.prototype,"checkoutSubtitle",void 0);Rs([v()],Ku.prototype,"callToActionURL",void 0);const e0=class extends oe{constructor(){super(...arguments);h(this,"objectToExport");h(this,"autoExportAnimations",!0);h(this,"autoExportAudioSources",!0);h(this,"exportFileName");h(this,"customUsdzFile");h(this,"customBranding");h(this,"anchoringType","plane");h(this,"maxTextureSize",2048);h(this,"planeAnchoringAlignment","horizontal");h(this,"interactive",!0);h(this,"allowCreateQuicklookButton",!0);h(this,"quickLookCompatible",!0);h(this,"extensions",[]);h(this,"link");h(this,"button");h(this,"onClickedOpenInARElement",t=>{t.preventDefault(),this.exportAndOpen()});h(this,"_currentExportTasks",new Map);h(this,"_previousTimeScale",1);h(this,"lastCallback");h(this,"_rootSessionRootWasAppliedTo",null);h(this,"_rootPositionBeforeExport",new x);h(this,"_rootRotationBeforeExport",new se);h(this,"_rootScaleBeforeExport",new x)}start(){var t,n,r;eo&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",o=>{switch(o.key){case"t":this.exportAsync();break}}),uc()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((n=(t=this.objectToExport)==null?void 0:t.children)!=null&&n.length)&&!((r=this.objectToExport)!=null&&r.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new cE),this.extensions.push(new ju),this.extensions.push(new AE),this.extensions.push(new ib),this.extensions.push(new yE))}onEnable(){var r;const t=Cu(),n=$p();(eo||t&&n)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=YR(this.context),this.link.addEventListener("message",this.lastCallback)),eo&&bi("USDZ Exporter enabled: "+this.name),(r=document.getElementById("open-in-ar"))==null||r.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var t,n,r;(t=this.button)==null||t.remove(),(n=this.link)==null||n.removeEventListener("message",this.lastCallback),eo&&bi("USDZ Exporter disabled: "+this.name),(r=document.getElementById("open-in-ar"))==null||r.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var r;let t=this.exportFileName??((r=this.objectToExport)==null?void 0:r.name)??this.name;if(t+="-"+gV(),pu()||(t!==""&&(t+="-"),t+="MadeWithNeedle"),this.link||(this.link=YR(this.context)),this.customUsdzFile)return eo&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,t),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const n=await this.export(this.objectToExport);return n?(eo&&console.log("USDZ generation done. Downloading as "+t),this.openInQuickLook(n,t),n):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(t){if(!t)return console.warn("No object to export"),null;const n=this._currentExportTasks.get(t);if(n)return n;const r=this.internalExport(t);return r instanceof Promise?(this._currentExportTasks.set(t,r),r.then(o=>(this._currentExportTasks.delete(t),o)).catch(o=>(this._currentExportTasks.delete(t),console.error("Error during USDZ export â€“ please report a bug!",o),null))):r}async internalExport(t){at.start("export-usdz",{onProgress:w=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:w}}))}}),at.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),at.report("export-usdz",{message:"Load progressive textures",autoStep:5}),at.start("export-usdz-textures","export-usdz");const n=j.getComponentsInChildren(t,Gr);for(const w of n)w&&w.enabled&&w.updateSprite(!0);const r=j.getComponentsInChildren(t,ci),o=new Array;let a=0;for(const w of r){for(const S of w.sharedMeshes)if(S){const E=pt.assignMeshLOD(S,0);E instanceof Promise&&o.push(new Promise((I,k)=>{E.then(()=>{a++,at.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:a,totalSteps:o.length}),I()}).catch(T=>k(T))}))}for(const S of w.sharedMaterials)if(S){const E=pt.assignTextureLOD(S,0);E instanceof Promise&&o.push(new Promise((I,k)=>{E.then(()=>{a++,at.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:a,totalSteps:o.length}),I()}).catch(T=>k(T))}))}}eo&&bi("Progressive Loading: "+o.length),await Promise.all(o),eo&&bi("Progressive Loading: done"),at.end("export-usdz-textures");const l=bs.Global.Mask;bs.Global.Set(go.AR);const c=new yV,u=new z0(this.quickLookCompatible),d=[u,...this.extensions],f={self:this,exporter:c,extensions:d,object:t};at.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:f})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,at.report("export-usdz","auto export animations and audio sources");const p=new Array;this.autoExportAnimations&&p.push(...GW(t,u)),this.extensions.find(w=>w.extensionName==="Audio")&&this.autoExportAudioSources&&p.push(...HW(t)),c.debug=eo,c.keepObject=w=>{const S=j.getComponent(w,ci);return!(S&&!S.enabled)};const m=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(w=>{w.visible||m.push(w)});const A=this.extensions.find(w=>w.extensionName==="Behaviour");this.interactive&&A&&m.length>0&&A.addBehavior(VW(m));let y=!0;this.quickLookCompatible&&!this.interactive&&(y=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),at.report("export-usdz","Invoking exporter.parse");const b=await c.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:d,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:y}),_=new Blob([b],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,at.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:f}));for(const w of p)j.destroy(w);return bs.Global.Set(l),at.end("export-usdz"),_}openInQuickLook(t,n){const r=t instanceof Blob?URL.createObjectURL(t):t,o=this.buildQuicklookOverlay();eo&&console.log("QuickLook Overlay",o);const a=o.callToAction?encodeURIComponent(o.callToAction):"",l=o.checkoutTitle?encodeURIComponent(o.checkoutTitle):"",c=o.checkoutSubtitle?encodeURIComponent(o.checkoutSubtitle):"";this.link.href=r+`#callToAction=${a}&checkoutTitle=${l}&checkoutSubtitle=${c}&callToActionURL=${o.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=n+".usdz",this.link.click()}download(t,n){e0.save(t,n)}static save(t,n){const r=document.createElement("a");r.style.display="none",document.body.appendChild(r),typeof t=="string"?r.href=t:r.href=URL.createObjectURL(t),r.download=n,r.click(),r.remove()}quicklookCallback(t){if((t==null?void 0:t.data)=="_apple_ar_quicklook_button_tapped"){eo&&Xt("Quicklook closed via call to action button");var n=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(n),!n.defaultPrevented){const r=new URLSearchParams(this.link.href);if(r){const o=r.get("callToActionURL");eo&&bi("Quicklook url: "+o),o&&(pu()?globalThis.open(o,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",o))}}}}buildQuicklookOverlay(){var r,o,a,l,c,u;const t={};return this.customBranding&&Object.assign(t,this.customBranding),pu()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),t.callToAction="Close",t.checkoutTitle="ðŸŒµ Made with Needle",t.checkoutSubtitle="_"),(((r=t.callToAction)==null?void 0:r.length)||((o=t.checkoutTitle)==null?void 0:o.length)||((a=t.checkoutSubtitle)==null?void 0:a.length))&&((l=t.callToAction)!=null&&l.length||(t.callToAction="\0"),(c=t.checkoutTitle)!=null&&c.length||(t.checkoutTitle="\0"),(u=t.checkoutSubtitle)!=null&&u.length||(t.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:t})),t}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};let t=j.getComponentInParent(this.objectToExport,fh);t||(t=j.getComponentInChildren(this.objectToExport,fh));let n=1,r=!1;const o=this.objectToExport;if(t)n=t.arScale,r=t.invertForward;else{const c=j.findObjectOfType(Ai);c&&(n=c.arScale)}return{scale:1/n,_invertForward:r,target:o,sessionRoot:(t==null?void 0:t.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:t,_invertForward:n,target:r,sessionRoot:o}=this.getARScaleAndTarget(),a=o==null?void 0:o.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=r,this._rootPositionBeforeExport.copy(r.position),this._rootRotationBeforeExport.copy(r.quaternion),this._rootScaleBeforeExport.copy(r.scale),r.scale.multiplyScalar(t),n&&r.quaternion.multiply(e0.invertForwardQuaternion),r.updateMatrix(),r.updateMatrixWorld(!0),o&&a&&r.matrix.premultiply(a)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const t=this._rootSessionRootWasAppliedTo;t.position.copy(this._rootPositionBeforeExport),t.quaternion.copy(this._rootRotationBeforeExport),t.scale.copy(this._rootScaleBeforeExport),t.updateMatrix(),t.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const n=rh.getOrCreate().createQuicklookButton();return n.parentNode||this.context.menu.appendChild(n),n}};let li=e0;h(li,"invertForwardMatrix",new le().makeRotationY(Math.PI)),h(li,"invertForwardQuaternion",new se().setFromEuler(new Gt(0,Math.PI,0)));Rs([v(ne)],li.prototype,"objectToExport",void 0);Rs([v()],li.prototype,"autoExportAnimations",void 0);Rs([v()],li.prototype,"autoExportAudioSources",void 0);Rs([v()],li.prototype,"exportFileName",void 0);Rs([v(URL)],li.prototype,"customUsdzFile",void 0);Rs([v(Ku)],li.prototype,"customBranding",void 0);Rs([v()],li.prototype,"anchoringType",void 0);Rs([v()],li.prototype,"maxTextureSize",void 0);Rs([v()],li.prototype,"planeAnchoringAlignment",void 0);Rs([v()],li.prototype,"interactive",void 0);Rs([v()],li.prototype,"allowCreateQuicklookButton",void 0);Rs([v()],li.prototype,"quickLookCompatible",void 0);class nb extends oe{constructor(){super(...arguments);h(this,"isUsed",!0);h(this,"usedBy",null)}}class B2 extends oe{}const KR=Q("debugdeletable");class bE extends Xo{}class P2 extends oe{constructor(){super(...arguments);h(this,"deleteBoxes",[])}awake(){this.deleteBoxes=j.findObjectsOfType(bE,this.context)}update(){for(const t of this.deleteBoxes){const n=this.gameObject;if(t.isInBox(n)===!0){const o=j.getComponentInParent(this.gameObject,nb);o?KR&&console.warn("Can not delete object with usage marker",this.guid,o):(KR&&console.log("DESTROY",this.gameObject),C0(this.gameObject,this.context.connection))}}}}var Ju=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},nC;(function(s){s[s.Off=0]="Off",s[s.Gaussian=1]="Gaussian",s[s.Bokeh=2]="Bokeh"})(nC||(nC={}));const WW=Q("debugpost");class hl extends Es{constructor(){super(...arguments);h(this,"mode");h(this,"focusDistance",new Ae(1));h(this,"focalLength",new Ae(.2));h(this,"aperture",new Ae(20));h(this,"gaussianMaxRadius",new Ae);h(this,"resolutionScale",new Ae(1*1/window.devicePixelRatio));h(this,"bokehScale",new Ae)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=n=>{const r=n/300,o=2;return ye.lerp(o,.01,r)};const t=20;this.aperture.valueProcessor=n=>{const r=1-n/32;return ye.lerp(1,t,r)}}onCreateEffect(){if(this.mode===nC.Off){WW&&console.warn("DepthOfField: Mode is set to Off");return}const t=new hk(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=n=>{t.cocMaterial.worldFocusDistance=n},this.focalLength.onValueChanged=n=>t.cocMaterial.worldFocusRange=n,this.aperture.onValueChanged=n=>t.bokehScale=n,this.resolutionScale&&(this.resolutionScale.onValueChanged=n=>t.resolution.scale=n),[t]}unapply(){}}Ju([v()],hl.prototype,"mode",void 0);Ju([v(Ae)],hl.prototype,"focusDistance",void 0);Ju([v(Ae)],hl.prototype,"focalLength",void 0);Ju([v(Ae)],hl.prototype,"aperture",void 0);Ju([v(Ae)],hl.prototype,"gaussianMaxRadius",void 0);Ju([v(Ae)],hl.prototype,"resolutionScale",void 0);Ju([v(Ae)],hl.prototype,"bokehScale",void 0);oa("DepthOfField",hl);var qW=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Py;(function(s){s[s.Never=0]="Never",s[s.Desktop=1]="Desktop",s[s.Mobile=2]="Mobile"})(Py||(Py={}));class _E extends oe{constructor(){super(...arguments);h(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||j.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:uc()?(this.visibleOn&Py.Mobile)!==0:(this.visibleOn&Py.Desktop)!==0}}qW([v()],_E.prototype,"visibleOn",void 0);class M2{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(i){}}var Zu=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const qa=Q("debugdrag"),aw=[];var gs;(function(s){s[s.XZPlane=0]="XZPlane",s[s.Attached=1]="Attached",s[s.HitNormal=2]="HitNormal",s[s.DynamicViewAngle=3]="DynamicViewAngle",s[s.SnapToSurfaces=4]="SnapToSurfaces",s[s.None=5]="None"})(gs||(gs={}));const Er=class extends oe{constructor(){super(...arguments);h(this,"dragMode",gs.DynamicViewAngle);h(this,"snapGridResolution",0);h(this,"keepRotation",!0);h(this,"xrDragMode",gs.Attached);h(this,"xrKeepRotation",!1);h(this,"xrDistanceDragFactor",1);h(this,"showGizmo",!1);h(this,"_rigidbody",null);h(this,"_targetObject",null);h(this,"_dragHelper",null);h(this,"_draggingRigidbodies",[]);h(this,"_potentialDragStartEvt",null);h(this,"_dragHandlers",new Map);h(this,"_totalMovement",new x);h(this,"_marker",null);h(this,"_isDragging",!1);h(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){aw.length=0;for(const t of this._instances)t._isDragging&&aw.push(t);return aw}get draggedObject(){return this._targetObject}setTargetObject(t){var r,o;this._targetObject=t;for(const a of this._dragHandlers.values())a.setTargetObject(t);const n="_rigidbody-was-kinematic";((r=this._rigidbody)==null?void 0:r[n])===!1&&(this._rigidbody.isKinematic=!1),this._rigidbody=null,t&&(this._rigidbody=j.getComponentInChildren(t,It),((o=this._rigidbody)==null?void 0:o.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[n]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new x,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(Co)||this.gameObject.addComponent(Co)}onEnable(){Er._instances.push(this)}onDisable(){Er._instances=Er._instances.filter(t=>t!==this)}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||t.mode!=="screen"||(t.event.mode==="tracked-pointer"||t.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===gs.None)return;const o=j.getComponentInParent(t.object,Er);!o||o!==this||(Er.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){this.allowEdit(this.gameObject)&&t.mode==="screen"&&Er.lastHovered===t.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(t){if(!(!this.allowEdit(this.gameObject)||t.used||(t.mode==="tracked-pointer"||t.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===gs.None)&&(Er.lastHovered=t.object,t.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=t),this._targetObject||this.setTargetObject(this.gameObject),Er._active+=1;const o=new YW(this,this._targetObject);if(this._dragHandlers.set(t.event.space,o),o.onDragStart(t),this._dragHandlers.size===2){const a=this._dragHandlers.values(),l=a.next().value,c=a.next().value,u=new XW(this,this._targetObject,l,c);this._dragHandlers.set(this.gameObject,u),u.onDragStart(t)}t.use()}}onPointerMove(t){(this._isDragging||this._potentialDragStartEvt!==null)&&t.use()}onPointerUp(t){if(qa&&Pe.DrawLabel(t.point??this.gameObject.worldPosition,"POINTERUP:"+t.pointerId+", "+t.button,.03,3),!this.allowEdit(this.gameObject)||t.button!==0)return;this._potentialDragStartEvt=null;const n=this._dragHandlers.get(t.event.space),r=this._dragHandlers.get(this.gameObject);r&&(r.handlerA===n||r.handlerB===n)&&(this._dragHandlers.delete(this.gameObject),r.onDragEnd(t)),n&&(Er._active>0&&(Er._active-=1),this.setTargetObject(null),n.onDragEnd&&n.onDragEnd(t),this._dragHandlers.delete(t.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(t),t.use())}update(){for(const t of this._dragHandlers.values())t.collectMovementInfo&&t.collectMovementInfo(),t.getTotalMovement&&this._totalMovement.add(t.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const t=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(t)}for(const t of this._dragHandlers.values())t.onDragUpdate&&t.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(t){if(!t||!t.object)return;const n=j.getComponentInParent(t.object,Er);if(!n||n!==this&&n._isDragging)return;const r=this._targetObject||this.gameObject;if(!r)return;this._isDragging=!0;const o=j.getComponentInChildren(r,rc);qa&&console.log("DRAG START",o,r),o&&(o.fastMode=!0,o==null||o.requestOwnership()),this._marker=j.addComponent(r,nb),this._draggingRigidbodies.length=0;const a=j.getComponentsInChildren(r,It);a&&this._draggingRigidbodies.push(...a)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const n of this._draggingRigidbodies)n.wakeUp(),n.resetVelocities(),n.resetForcesAndTorques();const t=this._targetObject||this.gameObject;ta.markDirty(t)}onLastDragEnd(t){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const r of this._draggingRigidbodies)r.setVelocity(r.smoothedVelocity);this._draggingRigidbodies.length=0;const n=this._dragHelper.selected;if(qa&&console.log("DRAG END",n,n==null?void 0:n.visible),this._dragHelper.setSelected(null,this.context),this._targetObject=null,t!=null&&t.object){const r=j.getComponentInChildren(t.object,rc);r&&(r.fastMode=!1)}this._marker&&this._marker.destroy()}};let wn=Er;h(wn,"_active",0),h(wn,"_instances",[]),h(wn,"lastHovered");Zu([v()],wn.prototype,"dragMode",void 0);Zu([v()],wn.prototype,"snapGridResolution",void 0);Zu([v()],wn.prototype,"keepRotation",void 0);Zu([v()],wn.prototype,"xrDragMode",void 0);Zu([v()],wn.prototype,"xrKeepRotation",void 0);Zu([v()],wn.prototype,"xrDistanceDragFactor",void 0);Zu([v()],wn.prototype,"showGizmo",void 0);class XW{constructor(i,t,n,r){h(this,"handlerA");h(this,"handlerB");h(this,"context");h(this,"settings");h(this,"gameObject");h(this,"_handlerAAttachmentPoint",new x);h(this,"_handlerBAttachmentPoint",new x);h(this,"_followObject");h(this,"_manipulatorObject");h(this,"_deviceMode");h(this,"_followObjectStartWorldQuaternion",new se);h(this,"_manipulatorPosOffset",new x);h(this,"_manipulatorRotOffset",new se);h(this,"_manipulatorScaleOffset",new x);h(this,"_tempVec1",new x);h(this,"_tempVec2",new x);h(this,"_tempVec3",new x);h(this,"tempLookMatrix",new le);h(this,"_initialScale",new x);h(this,"_initialDistance",0);var a,l;this.context=i.context,this.settings=i,this.gameObject=t,this.handlerA=n,this.handlerB=r,this._followObject=new ne,this._manipulatorObject=new ne,this.context.scene.add(this._manipulatorObject);const o=(l=(a=Fe.active)==null?void 0:a.rig)==null?void 0:l.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),o&&(o.worldToLocal(this._tempVec1),o.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(qa&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now â€“ controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(t.scale),qa){this._followObject.add(new dr(2)),this._manipulatorObject.add(new dr(5));const c=u=>`${u.x.toFixed(2)}, ${u.y.toFixed(2)}, ${u.z.toFixed(2)}`;Pe.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),Pe.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+c(this._tempVec1)+`
`+c(this._tempVec2),.03,5)}}onDragStart(i){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=i.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(i){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const i=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,i.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const t=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(t/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),qa&&(Pe.DrawLabel(this._tempVec3.clone().add(new x(0,.2,0)),"A:B "+t.toFixed(2),.03),Pe.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const i=30,t=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const n=this.gameObject,r=this._followObject;r.updateMatrix(),r.updateMatrixWorld(!0);const a=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const f=this._followObject.worldPosition,p=this.settings.snapGridResolution;f.x=Math.round(f.x/p)*p,f.y=Math.round(f.y/p)*p,f.z=Math.round(f.z/p)*p,this._followObject.worldPosition=f,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const l=ye.clamp01(this.context.time.deltaTime*i*t),c=n.worldPosition;c.lerp(r.worldPosition,l),n.worldPosition=c;const u=n.worldQuaternion;u.slerp(r.worldQuaternion,l),n.worldQuaternion=u;const d=n.worldScale;d.lerp(r.worldScale,l),n.worldScale=d}setTargetObject(i){this.gameObject=i}}class YW{constructor(i,t){h(this,"context");h(this,"gameObject");h(this,"settings");h(this,"_lastRig");h(this,"_followObject");h(this,"_totalMovement",new x);h(this,"_totalMovementAlongRayDirection",0);h(this,"_grabStartDistance",0);h(this,"_deviceMode");h(this,"_followObjectStartPosition",new x);h(this,"_followObjectStartQuaternion",new se);h(this,"_followObjectStartWorldQuaternion",new se);h(this,"_lastDragPosRigSpace");h(this,"_tempVec",new x);h(this,"_tempMat",new le);h(this,"_hitPointInLocalSpace",new x);h(this,"_hitNormalInLocalSpace",new x);h(this,"_bottomCenter",new x);h(this,"_backCenter",new x);h(this,"_backBottomCenter",new x);h(this,"_bounds",new Cn);h(this,"_dragPlane",new tc(new x(0,1,0)));h(this,"_draggedOverObject",null);h(this,"_draggedOverObjectLastSetUp",null);h(this,"_draggedOverObjectLastNormal",new x);h(this,"_draggedOverObjectDuration",0);h(this,"_hasLastSurfaceHitPoint",!1);h(this,"_lastSurfaceHitPoint",new x);this.settings=i,this.context=i.context,this.gameObject=t,this._followObject=new ne}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(i){this.gameObject=i}recenter(){var o,a;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const i=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),i.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const t=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(t),this._grabStartDistance=t.distanceTo(i.worldPosition);const n=(a=(o=Fe.active)==null?void 0:o.rig)==null?void 0:a.gameObject,r=(n==null?void 0:n.worldScale.x)||1;this._grabStartDistance/=r,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,qa&&(Pe.DrawLine(t,i.worldPosition,65280,.5,!1),Pe.DrawLabel(i.worldPosition.add(new x(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(i){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(i.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,i.point&&i.normal)this._hitPointInLocalSpace.copy(i.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(i.normal);else if(i){const A=i.event.space,y=A.worldPosition;this.gameObject.worldToLocal(y),this._hitPointInLocalSpace.copy(y);const b=A.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),b.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(b)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=i.mode;const n=this._followObject.parent.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,a=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(a),o){case gs.XZPlane:const A=new x(0,1,0);this.gameObject.parent&&A.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(A,a);break;case gs.HitNormal:const y=this._hitNormalInLocalSpace.clone();y.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(y,a);break;case gs.Attached:this._dragPlane.setFromNormalAndCoplanarPoint(n,a);break;case gs.DynamicViewAngle:this.setPlaneViewAligned(a,!0);break;case gs.SnapToSurfaces:this.setPlaneViewAligned(a,!1);break;case gs.None:break}const l=this.gameObject.parent,c=this.gameObject.position.clone(),u=this.gameObject.quaternion.clone(),d=this.gameObject.scale.clone(),f=this.gameObject.matrixWorld.clone();l&&l.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const p=sl([this.gameObject]);p.expandByPoint(this.gameObject.worldPosition);const g=new x;p.getCenter(g);const m=new x;p.getSize(m),this._bottomCenter.copy(g.clone().add(new x(0,-m.y/2,0))),this._backCenter.copy(g.clone().add(new x(0,0,m.z/2))),this._backBottomCenter.copy(g.clone().add(new x(0,-m.y/2,m.z/2))),this._bounds.copy(p),l&&l.add(this.gameObject),this.gameObject.position.copy(c),this.gameObject.quaternion.copy(u),this.gameObject.scale.copy(d),this.gameObject.matrixWorld.copy(f),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var o,a;if(!this._followObject.parent)return;const i=this._followObject.parent;this._followObject.updateMatrix();const t=i.worldPosition,n=(a=(o=Fe.active)==null?void 0:o.rig)==null?void 0:a.gameObject;n&&n.worldToLocal(t),(this._lastDragPosRigSpace===void 0||n!=this._lastRig)&&(this._lastDragPosRigSpace=t.clone(),this._lastRig=n),this._tempVec.copy(t).sub(this._lastDragPosRigSpace);const r=i.worldForward;if(n&&(this._tempMat.copy(n.matrixWorld).invert(),r.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=r.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(t),qa){let l=t;n&&(l=l.clone(),l.transformDirection(n.matrixWorld)),Pe.DrawRay(l,r,255)}}onDragUpdate(i){if(i>1)return;const t=this.gameObject,n=this._followObject.parent;this._followObject.updateMatrix();const r=n.worldPosition,o=n.worldForward,a=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",l=a?this.settings.xrKeepRotation:this.settings.keepRotation,c=a?this.settings.xrDragMode:this.settings.dragMode;if(c===gs.None)return;const u=10;l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let d=1,f=2;if(a&&this._grabStartDistance>.5){const b=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);d=Math.max(0,b),d=d*d*d}else this._grabStartDistance<=.5&&(f=3);this._followObject.position.copy(this._followObjectStartPosition),l||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(d),this._followObject.updateMatrix();const p=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const g=new gh(r,o);if(c==gs.SnapToSurfaces){const b=this.context.physics.raycastFromRay(g,{testObject:_=>_!==this.followObject&&_!==n&&_!==t});if(b.length>0){const _=b[0];if(this._draggedOverObject===_.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=_.object,this._draggedOverObjectDuration=0),_.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(_.point);const w=.15,S=this._draggedOverObjectDuration>=w,E=.001,I=this._totalMovement.length()>=E;if((S||I)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(_.face.normal)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(_.face.normal);const k=Be(),T=Be();this._bounds.getCenter(k),this._bounds.getSize(T),k.sub(T.multiplyScalar(.5).multiply(_.face.normal)),this._hitPointInLocalSpace.copy(k),this._hitNormalInLocalSpace.copy(_.face.normal),this._bounds.getCenter(k),this._bounds.getSize(T),k.add(T.multiplyScalar(.5).multiply(_.face.normal));const P=Be(this._hitPointInLocalSpace).add(k);this._followObject.localToWorld(P);const B=_.point;this._dragPlane.setFromNormalAndCoplanarPoint(_.face.normal,B)}else if(!(S||I))return}}else p&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(c!==gs.Attached&&g.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const b=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(b),qa&&Pe.DrawLine(b,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(b),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const b=this._followObject.worldPosition,_=this.settings.snapGridResolution;b.x=Math.round(b.x/_)*_,b.y=Math.round(b.y/_)*_,b.z=Math.round(b.z/_)*_,this._followObject.worldPosition=b,this._followObject.updateMatrix()}l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const m=ye.clamp01(this.context.time.deltaTime*u*f),A=t.worldPosition;A.lerp(this._followObject.worldPosition,m),t.worldPosition=A;const y=t.worldQuaternion;if(y.slerp(this._followObject.worldQuaternion,m),t.worldQuaternion=y,qa){const b=this._hitPointInLocalSpace.clone();t.localToWorld(b),Pe.DrawSphere(b,.02,16711680);const _=this._hitNormalInLocalSpace.clone();_.applyQuaternion(y),Pe.DrawRay(b,_,16711680),Pe.DrawLabel(A.add(new x(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Fe.active}

                Device: ${this._deviceMode}

                `,.03);const w=this._bottomCenter.clone(),S=this._backCenter.clone(),E=this._backBottomCenter.clone();t.localToWorld(w),t.localToWorld(S),t.localToWorld(E),Pe.DrawSphere(w,.01,65280,0,!1),Pe.DrawSphere(S,.01,255,0,!1),Pe.DrawSphere(E,.01,16711935,0,!1),Pe.DrawLine(w,E,65535,0,!1),Pe.DrawLine(E,S,65535,0,!1)}}onDragEnd(i){console.assert(this._followObject.parent===i.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(i,t){if(!this._followObject.parent)return!1;const n=this._followObject.parent.worldForward,r=Be(0,1,0),o=n,a=r.angleTo(o),l=.5;return t&&(a>Math.PI/2+l||a<Math.PI/2-l)?this._dragPlane.setFromNormalAndCoplanarPoint(r,i):this._dragPlane.setFromNormalAndCoplanarPoint(n,i),!0}}const h1=class{constructor(i){h(this,"showGizmo",!0);h(this,"useViewAngle",!0);h(this,"_selected",null);h(this,"_context",null);h(this,"_camera");h(this,"_cameraPlane",new tc);h(this,"_hasGroundPlane",!1);h(this,"_groundPlane",new tc);h(this,"_groundOffset",new x);h(this,"_groundOffsetFactor",0);h(this,"_groundDistance",0);h(this,"_groundPlanePoint",new x);h(this,"_raycaster",new Du);h(this,"_cameraPlaneOffset",new x);h(this,"_intersection",new x);h(this,"_worldPosition",new x);h(this,"_inverseMatrix",new le);h(this,"_rbs",[]);h(this,"_groundLine");h(this,"_groundMarker");h(this,"_groundOffsetVector",new x(0,1,0));h(this,"_requireUpdateGroundPlane",!0);h(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=i;const t=new ms(h1.geometry),n=t.material;n.color=new xe(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const r=new Pu(.5,22,22),o=new _t({color:n.color}),a=new Z(r,o);a.visible=!1,a.layers.set(2),this._groundMarker=a}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(i,t){if(this._selected&&t)for(const n of this._rbs)n.wakeUp(),n.setVelocity(0,0,0);if(this._selected&&Kl.Remove(t,this._selected),this._selected=i,this._context=t,this._rbs.length=0,i?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}Kl.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(i){this._selected}onUpdateWorldPosition(i,t,n){if(this._selected){if(n){const r=Ve(this._selected);r.y=i.y,i=r}if(Sn(this._selected,i),Sn(this._groundLine,i),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const r=Ve(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(r,r,r),Sn(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const i=this._context.input.getPointerPositionRC(0);i&&(this._raycaster.setFromCamera(i,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const i=Ve(this._selected),t=new gh(Be(0,.1,0).add(i),Be(0,-1,0)),n=new sc;n.testObject=o=>o!==this._selected;const r=this._context.physics.raycastFromRay(t,n);for(let o=0;o<r.length;o++){const a=r[o];if(!a.face||this.contains(this._selected,a.object))continue;const l=Be(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(l,a.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(i),this._groundOffset.copy(this._intersection).sub(i)}contains(i,t){if(i===t)return!0;if(i.children){for(const n of i.children)if(this.contains(n,t))return!0}return!1}};let lw=h1;h(lw,"geometry",new Vt().setFromPoints([new x(0,0,0),new x(0,-1,0)]));var My;(function(s){s.File_Spawned="file-spawned"})(My||(My={}));class KW{constructor(i,t,n,r,o,a,l,c){h(this,"guid");h(this,"file_name");h(this,"file_hash");h(this,"file_size");h(this,"position");h(this,"seed");h(this,"sender");h(this,"serverUrl");h(this,"parentGuid");h(this,"boundsSize");this.seed=t,this.guid=n,this.file_name=r,this.file_hash=o,this.file_size=a,this.position=l,this.sender=i,this.serverUrl=c}}async function JW(s,i,t){const n=s.name;return n.endsWith(".gltf")||n.endsWith(".glb")||s.type==="model/gltf+json"||s.type==="model/gltf-binary"?new Promise((r,o)=>{const a=new FileReader;a.readAsArrayBuffer(s),a.onloadend=async l=>{const c=a.result,u=kS(),d=new En(u),f=await nl().parseSync(i,c,s.name,d);if(f&&f.scene){const p=f.scene;if(!p.guid){const g=new En(u);p.guid=g.generateUUID()}t&&e7(i.connection,s,u,p,t),r(f)}}}):(console.warn("Unsupported file type: "+n,s),null)}async function ZW(s,i){return new Promise(async(t,n)=>{const r=kS(),o=new En(r),a=s.toString(),l=await nl().loadSync(i,a,a,o);l&&l.scene?(l.scene,t(l)):console.warn("Unsupported file type: "+s.toString())})}xt.registerCallback(ut.ContextCreated,s=>{$W(s.context)});function $W(s){s.connection.beginListen(My.File_Spawned,async i=>{if(i.sender!==s.connection.connectionId){console.log("received file event",i),t7(i,s);let t=null;try{t=await gO(i.file_name,i.file_hash,i.file_size,i.serverUrl)}finally{i7(i)}if(t){const n=new En(i.seed),r=await nl().parseSync(s,t,i.file_name,n);if(r&&r.scene){const o=r.scene;if(i.parentGuid){const a=T0(i.parentGuid,s.scene);a&&"add"in a&&a.add(o)}o.parent||s.scene.add(o),i.position!==null&&o.position.copy(i.position)}}else console.error("download didnt return file")}})}async function e7(s,i,t,n,r){if(!s.connectionId){console.error("Can not upload file - no connection id");return}if(!n.guid){console.error("Can not upload file - no guid",n,n.guid);return}const o=await O6(i,r);if(!o)return;if(!o.filename){console.error("Can not send upload event - no filename",i.name);return}if(!o.hash){console.error("Can not send upload event - no hash",i.name);return}const a=new KW(s.connectionId,t,n.guid,o.filename,o.hash,i.size,n.position,o.url??r);n.parent&&(a.parentGuid=n.parent.guid),s.send(My.File_Spawned,a)}const sC={};function t7(s,i){const t=new on,n=new Z(t,new _t({color:65280})),r=new UP(n,5592405);if(sC[s.guid]=r,i.scene.add(r),s.parentGuid){const o=T0(s.parentGuid,i.scene);o&&o.add(r)}s.position&&r.position.copy(s.position)}function i7(s,i){const t=s.guid,n=sC[t];n&&(delete sC[t],n.removeFromParent())}var Hm=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Rc=Q("debugdroplistener");var ky;(function(s){s.FileDropped="file-dropped",s.ObjectAdded="object-added"})(ky||(ky={}));class $u extends oe{constructor(){super(...arguments);h(this,"dropArea");h(this,"fitIntoVolume",!1);h(this,"fitVolumeSize",new x(1,1,1));h(this,"placeAtHitPosition",!0);h(this,"onDropped",new ti);h(this,"onNetworkEvent",t=>{var n;if((n=t.guid)!=null&&n.startsWith(this.guid)){const r=t.url;if(r)if(Array.isArray(r))for(const o of r)this.addFromUrl(o,{screenposition:new ae},!0).then(a=>{a==null||a.position.set(t.point.x,t.point.y,t.point.z)});else this.addFromUrl(r,{screenposition:new ae},!0).then(o=>{o==null||o.position.set(t.point.x,t.point.y,t.point.z)})}});h(this,"handlePaste",async t=>{if(this.context.connection.allowEditing===!1)return;if((t.ctrlKey||t.metaKey)&&t.key==="v"){const o=await navigator.clipboard.readText().catch(console.warn);if(o&&(o.startsWith("http")||o.startsWith("https")||o.startsWith("blob"))){const l={screenposition:new ae(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(l)&&this.addFromUrl(o,l,!1)}}});h(this,"onDrag",t=>{this.context.connection.allowEditing!==!1&&t.preventDefault()});h(this,"onDrop",async t=>{if(this.context.connection.allowEditing===!1||(Rc&&console.log(t),!(t!=null&&t.dataTransfer))||t["droplistener:handled"])return;t.preventDefault();const n={screenposition:new ae(t.offsetX,t.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(n)===!1)return;t["droplistener:handled"]=!0;const r=t.dataTransfer.items;if(r)for(const o in r){const a=r[o];if(a.kind==="file"){const l=a.getAsFile();if(!l)continue;await this.addFiles([l],n)}else a.kind==="string"&&a.type=="text/plain"&&a.getAsString(l=>{this.addFromUrl(l,n,!1)})}});h(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(t,n,r){Rc&&console.log("dropped url",t);try{if(t.startsWith("https://github.com/")){const l=t.split("/"),c=l[3],u=l[4],d=l[6],f=l.slice(7).join("/");t=`https://raw.githubusercontent.com/${c}/${u}/${d}/${f}`}else t.startsWith("https://polyhaven.com/a")&&(t=n7(t));if(!t)return null;const o=t.toLowerCase();if(o.endsWith(".hdr")||o.endsWith(".hdri")||o.endsWith(".exr")||o.endsWith(".png")||o.endsWith(".jpg")||o.endsWith(".jpeg"))return null;const a=await ZW(new URL(t),this.context);if(a)return n.url=t,this.addObject(a,n,r)}catch{console.warn("String is not a valid URL",t)}return null}async addFiles(t,n){if(Rc&&console.log("Add files",t),!!Array.isArray(t)&&t.length)for(const r of t){if(!r)continue;Rc&&console.log("Register file "+r.name,r);const o=await JW(r,this.context);this.dispatchEvent(new CustomEvent(ky.FileDropped,{detail:r})),o&&this.addObject(o,n,!1)}}addObject(t,n,r){var l,c;if(Rc&&console.log(`Dropped ${this.gameObject.name}`,t),!(t!=null&&t.scene))return console.warn("No object specified to add to scene",t),null;for(const u of this._addedObjects)u.parent===this.gameObject&&xo(u,!0,!0);this._addedObjects.length=0;const o=t.scene;this.gameObject.attach(o),o.position.set(0,0,0),o.quaternion.identity(),this._addedObjects.push(o),Rc&&o.add(new dr(1));const a=new Cn().setFromCenterAndSize(new x(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(Rc&&Pe.DrawWireBox3(a,255,5),this.fitIntoVolume&&yz(o,a,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&n&&n.screenposition){o.visible=!1;const u=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(n.screenposition.clone())});if(o.visible=!0,u&&u.length>0)for(const d of u){const f=d.point.clone();Rc&&console.log("Place object at hit",d),bz(o,f);break}}if(im.assignAnimationsFromFile(t,{createAnimationComponent:u=>vo(u,qs)}),this.dispatchEvent(new CustomEvent(ky.ObjectAdded,{detail:t})),(l=this.onDropped)==null||l.invoke({sender:this,gltf:t}),!r&&((c=n.url)!=null&&c.startsWith("http"))&&this.context.connection.isConnected&&o){const u={guid:this.guid,url:n.url,point:o.position.clone()};this.context.connection.send("droplistener",u)}return o}testIfIsInDropArea(t){if(this.dropArea){const n=this.context.input.convertScreenspaceToRaycastSpace(t.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:n,recursive:!0,testObject:o=>!this._addedObjects.includes(o)}).length)return be()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}Hm([v(ne)],$u.prototype,"dropArea",void 0);Hm([v()],$u.prototype,"fitIntoVolume",void 0);Hm([v(x)],$u.prototype,"fitVolumeSize",void 0);Hm([v()],$u.prototype,"placeAtHitPosition",void 0);Hm([v(ti)],$u.prototype,"onDropped",void 0);function n7(s){if(!s.startsWith("https://polyhaven.com/"))return s;const i="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",r=new URL(s).pathname.split("/").pop(),o=`${i}${r}/${r}_4k.gltf`;return console.log("Resolved polyhaven asset url",s,"â†’",o),o}var sb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Sh extends oe{constructor(){super(...arguments);h(this,"parent",null);h(this,"object",null);h(this,"limitCount",10);h(this,"limitInterval",60);h(this,"_currentCount",0);h(this,"_startPosition",null);h(this,"_startQuaternion",null);h(this,"_forwardPointerEvents",new Map)}start(){var t,n;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const o=new En(this.guid);this.object=j.instantiate(this.object,{idProvider:o,keepWorldPosition:!1});const a=j.getComponent(this.object,Sh);a==null||a.destroy();let l=this.object.getComponentInChildren(wn);l||(l=this.object.addComponent(wn,{dragMode:gs.SnapToSurfaces}),l.guid=o.generateUUID());let c=j.getComponent(l.gameObject,rc);c||(c=l.gameObject.addComponent(rc),c.guid=o.generateUUID())}this.object.visible=!1;const r=this.gameObject.getComponent(wn);r&&(r.enabled=!1),this._startPosition=((t=this.object.position)==null?void 0:t.clone())??new x(0,0,0),this._startQuaternion=((n=this.object.quaternion)==null?void 0:n.clone())??new se(0,0,0,1)}this.gameObject.getComponentInParent(Co)||this.gameObject.addComponent(Co),this.cloneLimitIntervalFn()}onPointerEnter(t){t.used||this.object&&this.context.connection.allowEditing&&t.button===0&&this.context.input.setCursorPointer()}onPointerExit(t){t.used||this.object&&this.context.connection.allowEditing&&t.button===0&&this.context.input.setCursorNormal()}onPointerDown(t){if(t.used||!this.object||!this.context.connection.allowEditing||t.button!==0)return;const n=this.handleDuplication();if(n){const r=j.getComponent(n,wn);r?(r.onPointerDown(t),this._forwardPointerEvents.set(t.event.space,r)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(t){if(t.used)return;const n=this._forwardPointerEvents.get(t.event.space);n&&(n.onPointerUp(t),this._forwardPointerEvents.delete(t.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var r;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const t=new ll;this.parent||(this.parent=this.gameObject.parent),this.parent&&(t.parent=this.parent.guid??((r=this.parent.userData)==null?void 0:r.guid),t.keepWorldPosition=!0),t.position=this.worldPosition,t.rotation=this.worldQuaternion,t.context=this.context,this._currentCount+=1;const n=j.instantiateSynced(this.object,t);return console.assert(n!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),n}}sb([v(ne)],Sh.prototype,"parent",void 0);sb([v(ne)],Sh.prototype,"object",void 0);sb([v()],Sh.prototype,"limitCount",void 0);sb([v()],Sh.prototype,"limitInterval",void 0);class Dy extends Es{constructor(t){super();h(this,"effect");this.effect=t}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var Jh;(function(s){s[s.PointerEnter=0]="PointerEnter",s[s.PointerExit=1]="PointerExit",s[s.PointerDown=2]="PointerDown",s[s.PointerUp=3]="PointerUp",s[s.PointerClick=4]="PointerClick",s[s.Drag=5]="Drag",s[s.Drop=6]="Drop",s[s.Scroll=7]="Scroll",s[s.UpdateSelected=8]="UpdateSelected",s[s.Select=9]="Select",s[s.Deselect=10]="Deselect",s[s.Move=11]="Move",s[s.InitializePotentialDrag=12]="InitializePotentialDrag",s[s.BeginDrag=13]="BeginDrag",s[s.EndDrag=14]="EndDrag",s[s.Submit=15]="Submit",s[s.Cancel=16]="Cancel"})(Jh||(Jh={}));var wE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class xE{constructor(){h(this,"eventID");h(this,"callback",new ti)}}wE([v()],xE.prototype,"eventID",void 0);wE([v(ti)],xE.prototype,"callback",void 0);class CE extends oe{constructor(){super(...arguments);h(this,"triggers",[])}invoke(t){if(this.triggers)for(const n of this.triggers)n.eventID===t&&n.callback.invoke()}onPointerClick(t){this.invoke(Jh.PointerClick)}onPointerEnter(t){this.invoke(Jh.PointerEnter)}onPointerExit(t){this.invoke(Jh.PointerExit)}onPointerDown(t){this.invoke(Jh.PointerDown)}onPointerUp(t){this.invoke(Jh.PointerUp)}}wE([v(xE)],CE.prototype,"triggers",void 0);var SE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class EE extends oe{constructor(){super(...arguments);h(this,"connectedBody");h(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(It)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}SE([v(It)],EE.prototype,"connectedBody",void 0);class k2 extends EE{createJoint(i,t){var n;(n=this.context.physics.engine)==null||n.addFixedJoint(i,t)}}class rb extends EE{constructor(){super(...arguments);h(this,"anchor");h(this,"axis")}createJoint(t,n){var r;this.axis&&this.anchor&&((r=this.context.physics.engine)==null||r.addHingeJoint(t,n,this.anchor,this.axis))}}SE([v(x)],rb.prototype,"anchor",void 0);SE([v(x)],rb.prototype,"axis",void 0);const s7={type:"change"};let r7=class extends cc{constructor(i,t){super(),this.object=i,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const n=this,r=1e-6,o=new se,a=new x;this.tmpQuaternion=new se,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new x(0,0,0),this.rotationVector=new x(0,0,0),this.keydown=function(m){if(!(m.altKey||this.enabled===!1)){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){if(this.enabled!==!1){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(m){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const A=this.getContainerDimensions(),y=A.size[0]/2,b=A.size[1]/2;this.moveState.yawLeft=-(m.pageX-A.offset[0]-y)/y,this.moveState.pitchDown=(m.pageY-A.offset[1]-b)/b,this.updateRotationVector()}},this.pointerup=function(m){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(m){this.enabled!==!1&&m.preventDefault()},this.update=function(m){if(this.enabled===!1)return;const A=m*n.movementSpeed,y=m*n.rollSpeed;n.object.translateX(n.moveVector.x*A),n.object.translateY(n.moveVector.y*A),n.object.translateZ(n.moveVector.z*A),n.tmpQuaternion.set(n.rotationVector.x*y,n.rotationVector.y*y,n.rotationVector.z*y,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(a.distanceToSquared(n.object.position)>r||8*(1-o.dot(n.object.quaternion))>r)&&(n.dispatchEvent(s7),o.copy(n.object.quaternion),a.copy(n.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",l),this.domElement.removeEventListener("pointerdown",u),this.domElement.removeEventListener("pointermove",c),this.domElement.removeEventListener("pointerup",d),this.domElement.removeEventListener("pointercancel",f),window.removeEventListener("keydown",p),window.removeEventListener("keyup",g)};const l=this.contextMenu.bind(this),c=this.pointermove.bind(this),u=this.pointerdown.bind(this),d=this.pointerup.bind(this),f=this.pointercancel.bind(this),p=this.keydown.bind(this),g=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",l),this.domElement.addEventListener("pointerdown",u),this.domElement.addEventListener("pointermove",c),this.domElement.addEventListener("pointerup",d),this.domElement.addEventListener("pointercancel",f),window.addEventListener("keydown",p),window.addEventListener("keyup",g),this.updateMovementVector(),this.updateRotationVector()}};class D2 extends oe{constructor(){super(...arguments);h(this,"_controls",null)}onEnable(){var n;const t=(n=j.getComponent(this.gameObject,Bt))==null?void 0:n.cam;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new r7(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var IE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},rC;(function(s){s[s.Linear=1]="Linear",s[s.Exponential=2]="Exponential",s[s.ExponentialSquared=3]="ExponentialSquared"})(rC||(rC={}));class Vm extends oe{constructor(){super(...arguments);h(this,"_fog")}get fog(){return this._fog||(this._fog=new DP(0,0,50)),this._fog}get mode(){return rC.Linear}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}IE([v()],Vm.prototype,"near",null);IE([v()],Vm.prototype,"far",null);IE([v(xe)],Vm.prototype,"color",null);let Rp,cw,Ad,ev;function hw(s,i=1/0,t=null){cw||(cw=new pr(2,2,1,1)),Ad||(Ad=new et({uniforms:{blitTexture:new ee(s)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Ad.uniforms.blitTexture.value=s,Ad.defines.IS_SRGB=s.colorSpace==He,Ad.needsUpdate=!0,ev||(ev=new Z(cw,Ad),ev.frustrumCulled=!1);const n=new bt,r=new ws;r.add(ev),t===null&&(t=Rp=new Mu({antialias:!1}));const o=Math.min(s.image.width,i),a=Math.min(s.image.height,i);t.setSize(o,a),t.clear(),t.render(r,n);const l=document.createElement("canvas"),c=l.getContext("2d");l.width=o,l.height=a,c.drawImage(t.domElement,0,0,o,a);const u=new jP(l);return u.minFilter=s.minFilter,u.magFilter=s.magFilter,u.wrapS=s.wrapS,u.wrapT=s.wrapT,u.name=s.name,Rp&&(Rp.forceContextLoss(),Rp.dispose(),Rp=null),u}const JR={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class ob{constructor(){this.pluginCallbacks=[],this.register(function(i){return new g7(i)}),this.register(function(i){return new m7(i)}),this.register(function(i){return new y7(i)}),this.register(function(i){return new b7(i)}),this.register(function(i){return new _7(i)}),this.register(function(i){return new w7(i)}),this.register(function(i){return new A7(i)}),this.register(function(i){return new v7(i)}),this.register(function(i){return new x7(i)}),this.register(function(i){return new C7(i)}),this.register(function(i){return new S7(i)}),this.register(function(i){return new E7(i)}),this.register(function(i){return new I7(i)})}register(i){return this.pluginCallbacks.indexOf(i)===-1&&this.pluginCallbacks.push(i),this}unregister(i){return this.pluginCallbacks.indexOf(i)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(i),1),this}parse(i,t,n,r){const o=new p7,a=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)a.push(this.pluginCallbacks[l](o));o.setPlugins(a),o.write(i,t,r).catch(n)}parseAsync(i,t){const n=this;return new Promise(function(r,o){n.parse(i,r,o,t)})}}const ht={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},uw="KHR_mesh_quantization",Or={};Or[Zt]=ht.NEAREST;Or[TP]=ht.NEAREST_MIPMAP_NEAREST;Or[BP]=ht.NEAREST_MIPMAP_LINEAR;Or[Mt]=ht.LINEAR;Or[RP]=ht.LINEAR_MIPMAP_NEAREST;Or[ym]=ht.LINEAR_MIPMAP_LINEAR;Or[Gv]=ht.CLAMP_TO_EDGE;Or[ic]=ht.REPEAT;Or[Hv]=ht.MIRRORED_REPEAT;const ZR={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},o7=new xe,$R=12,a7=1179937895,l7=2,eB=8,c7=1313821514,h7=5130562;function Jp(s,i){return s.length===i.length&&s.every(function(t,n){return t===i[n]})}function u7(s){return new TextEncoder().encode(s).buffer}function d7(s){return Jp(s.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function f7(s,i,t){const n={min:new Array(s.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(s.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=i;r<i+t;r++)for(let o=0;o<s.itemSize;o++){let a;s.itemSize>4?a=s.array[r*s.itemSize+o]:(o===0?a=s.getX(r):o===1?a=s.getY(r):o===2?a=s.getZ(r):o===3&&(a=s.getW(r)),s.normalized===!0&&(a=ct.normalize(a,s.array))),n.min[o]=Math.min(n.min[o],a),n.max[o]=Math.max(n.max[o],a)}return n}function O2(s){return Math.ceil(s/4)*4}function dw(s,i=0){const t=O2(s.byteLength);if(t!==s.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(s)),i!==0)for(let r=s.byteLength;r<t;r++)n[r]=i;return n.buffer}return s}function tB(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function iB(s,i){if(s.toBlob!==void 0)return new Promise(n=>s.toBlob(n,i));let t;return i==="image/jpeg"?t=.92:i==="image/webp"&&(t=.8),s.convertToBlob({type:i,quality:t})}class p7{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(i){this.plugins=i}async write(i,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(i),await Promise.all(this.pending);const r=this,o=r.buffers,a=r.json;n=r.options;const l=r.extensionsUsed,c=r.extensionsRequired,u=new Blob(o,{type:"application/octet-stream"}),d=Object.keys(l),f=Object.keys(c);if(d.length>0&&(a.extensionsUsed=d),f.length>0&&(a.extensionsRequired=f),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=u.size),n.binary===!0){const p=new FileReader;p.readAsArrayBuffer(u),p.onloadend=function(){const g=dw(p.result),m=new DataView(new ArrayBuffer(eB));m.setUint32(0,g.byteLength,!0),m.setUint32(4,h7,!0);const A=dw(u7(JSON.stringify(a)),32),y=new DataView(new ArrayBuffer(eB));y.setUint32(0,A.byteLength,!0),y.setUint32(4,c7,!0);const b=new ArrayBuffer($R),_=new DataView(b);_.setUint32(0,a7,!0),_.setUint32(4,l7,!0);const w=$R+y.byteLength+A.byteLength+m.byteLength+g.byteLength;_.setUint32(8,w,!0);const S=new Blob([b,y,A,m,g],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(S),E.onloadend=function(){t(E.result)}}}else if(a.buffers&&a.buffers.length>0){const p=new FileReader;p.readAsDataURL(u),p.onloadend=function(){const g=p.result;a.buffers[0].uri=g,t(a)}}else t(a)}serializeUserData(i,t){if(Object.keys(i.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(i.userData));if(n.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in o.gltfExtensions)t.extensions[a]=o.gltfExtensions[a],r[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+i.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(i,t=!1){if(this.uids.has(i)===!1){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(i,r)}return this.uids.get(i).get(t)}isNormalizedNormalAttribute(i){if(this.cache.attributesNormalized.has(i))return!1;const n=new x;for(let r=0,o=i.count;r<o;r++)if(Math.abs(n.fromBufferAttribute(i,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(i){const t=this.cache;if(t.attributesNormalized.has(i))return t.attributesNormalized.get(i);const n=i.clone(),r=new x;for(let o=0,a=n.count;o<a;o++)r.fromBufferAttribute(n,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(o,r.x,r.y,r.z);return t.attributesNormalized.set(i,n),n}applyTextureTransform(i,t){let n=!1;const r={};(t.offset.x!==0||t.offset.y!==0)&&(r.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(r.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(r.scale=t.repeat.toArray(),n=!0),n&&(i.extensions=i.extensions||{},i.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(i,t){if(i===t)return i;function n(g){return g.colorSpace===He?function(A){return A<.04045?A*.0773993808:Math.pow(A*.9478672986+.0521327014,2.4)}:function(A){return A}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),i instanceof nf&&(i=hw(i)),t instanceof nf&&(t=hw(t));const r=i?i.image:null,o=t?t.image:null,a=Math.max(r?r.width:0,o?o.width:0),l=Math.max(r?r.height:0,o?o.height:0),c=tB();c.width=a,c.height=l;const u=c.getContext("2d");u.fillStyle="#00ffff",u.fillRect(0,0,a,l);const d=u.getImageData(0,0,a,l);if(r){u.drawImage(r,0,0,a,l);const g=n(i),m=u.getImageData(0,0,a,l).data;for(let A=2;A<m.length;A+=4)d.data[A]=g(m[A]/256)*256}if(o){u.drawImage(o,0,0,a,l);const g=n(t),m=u.getImageData(0,0,a,l).data;for(let A=1;A<m.length;A+=4)d.data[A]=g(m[A]/256)*256}u.putImageData(d,0,0);const p=(i||t).clone();return p.source=new OP(c),p.colorSpace=xu,p.channel=(i||t).channel,i&&t&&i.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),p}processBuffer(i){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(i),0}processBufferView(i,t,n,r,o){const a=this.json;a.bufferViews||(a.bufferViews=[]);let l;switch(t){case ht.BYTE:case ht.UNSIGNED_BYTE:l=1;break;case ht.SHORT:case ht.UNSIGNED_SHORT:l=2;break;default:l=4}const c=O2(r*i.itemSize*l),u=new DataView(new ArrayBuffer(c));let d=0;for(let g=n;g<n+r;g++)for(let m=0;m<i.itemSize;m++){let A;i.itemSize>4?A=i.array[g*i.itemSize+m]:(m===0?A=i.getX(g):m===1?A=i.getY(g):m===2?A=i.getZ(g):m===3&&(A=i.getW(g)),i.normalized===!0&&(A=ct.normalize(A,i.array))),t===ht.FLOAT?u.setFloat32(d,A,!0):t===ht.INT?u.setInt32(d,A,!0):t===ht.UNSIGNED_INT?u.setUint32(d,A,!0):t===ht.SHORT?u.setInt16(d,A,!0):t===ht.UNSIGNED_SHORT?u.setUint16(d,A,!0):t===ht.BYTE?u.setInt8(d,A):t===ht.UNSIGNED_BYTE&&u.setUint8(d,A),d+=l}const f={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:c};return o!==void 0&&(f.target=o),o===ht.ARRAY_BUFFER&&(f.byteStride=i.itemSize*l),this.byteOffset+=c,a.bufferViews.push(f),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(i){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(r){const o=new FileReader;o.readAsArrayBuffer(i),o.onloadend=function(){const a=dw(o.result),l={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,r(n.bufferViews.push(l)-1)}})}processAccessor(i,t,n,r){const o=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let l;if(i.array.constructor===Float32Array)l=ht.FLOAT;else if(i.array.constructor===Int32Array)l=ht.INT;else if(i.array.constructor===Uint32Array)l=ht.UNSIGNED_INT;else if(i.array.constructor===Int16Array)l=ht.SHORT;else if(i.array.constructor===Uint16Array)l=ht.UNSIGNED_SHORT;else if(i.array.constructor===Int8Array)l=ht.BYTE;else if(i.array.constructor===Uint8Array)l=ht.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+i.array.constructor.name);if(n===void 0&&(n=0),(r===void 0||r===1/0)&&(r=i.count),r===0)return null;const c=f7(i,n,r);let u;t!==void 0&&(u=i===t.index?ht.ELEMENT_ARRAY_BUFFER:ht.ARRAY_BUFFER);const d=this.processBufferView(i,l,n,r,u),f={bufferView:d.id,byteOffset:d.byteOffset,componentType:l,count:r,max:c.max,min:c.min,type:a[i.itemSize]};return i.normalized===!0&&(f.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(f)-1}processImage(i,t,n,r="image/png"){if(i!==null){const o=this,a=o.cache,l=o.json,c=o.options,u=o.pending;a.images.has(i)||a.images.set(i,{});const d=a.images.get(i),f=r+":flipY/"+n.toString();if(d[f]!==void 0)return d[f];l.images||(l.images=[]);const p={mimeType:r},g=tB();g.width=Math.min(i.width,c.maxTextureSize),g.height=Math.min(i.height,c.maxTextureSize);const m=g.getContext("2d");if(n===!0&&(m.translate(0,g.height),m.scale(1,-1)),i.data!==void 0){t!==qi&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(i.width>c.maxTextureSize||i.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",i);const y=new Uint8ClampedArray(i.height*i.width*4);for(let b=0;b<y.length;b+=4)y[b+0]=i.data[b+0],y[b+1]=i.data[b+1],y[b+2]=i.data[b+2],y[b+3]=i.data[b+3];m.putImageData(new ImageData(y,i.width,i.height),0,0)}else if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)m.drawImage(i,0,0,g.width,g.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?u.push(iB(g,r).then(y=>o.processBufferViewImage(y)).then(y=>{p.bufferView=y})):g.toDataURL!==void 0?p.uri=g.toDataURL(r):u.push(iB(g,r).then(y=>new FileReader().readAsDataURL(y)).then(y=>{p.uri=y}));const A=l.images.push(p)-1;return d[f]=A,A}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(i){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Or[i.magFilter],minFilter:Or[i.minFilter],wrapS:Or[i.wrapS],wrapT:Or[i.wrapT]};return t.samplers.push(n)-1}processTexture(i){const n=this.options,r=this.cache,o=this.json;if(r.textures.has(i))return r.textures.get(i);const a={keep:!0,newTexture:null};if(this._invokeAll(function(d){d.beforeWriteTexture&&d.beforeWriteTexture(i,a)}),a.keep===!1)return null;a.newTexture!=null&&(i=a.newTexture),o.textures||(o.textures=[]),i instanceof nf&&(i=hw(i,n.maxTextureSize));let l=i.userData.mimeType;l==="image/webp"&&(l="image/png");const c={sampler:this.processSampler(i),source:this.processImage(i.image,i.format,i.flipY,l)};i.name&&(c.name=i.name),this._invokeAll(function(d){d.writeTexture&&d.writeTexture(i,c)});const u=o.textures.push(c)-1;return r.textures.set(i,u),u}processMaterial(i){var u,d,f,p,g;const t=this.cache,n=this.json;if(t.materials.has(i))return t.materials.get(i);if(i.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};i.isMeshStandardMaterial!==!0&&i.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=i.color.toArray().concat([i.opacity]);Jp(o,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=o),i.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=i.metalness,r.pbrMetallicRoughness.roughnessFactor=i.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5);const a=(u=i.metalnessMap)!=null&&u.image?i.metalnessMap:void 0,l=(d=i.roughnessMap)!=null&&d.image?i.roughnessMap:void 0;if(a||l){const m=this.buildMetalRoughTexture(a,l),A={index:this.processTexture(m),channel:m.channel};this.applyTextureTransform(A,m),r.pbrMetallicRoughness.metallicRoughnessTexture=A}if(i.map){const m={index:this.processTexture(i.map),texCoord:i.map.channel};this.applyTextureTransform(m,i.map),r.pbrMetallicRoughness.baseColorTexture=m}if(i.emissive){const m=i.emissive;if(Math.max(m.r,m.g,m.b)>0&&(r.emissiveFactor=i.emissive.toArray()),(f=i.emissiveMap)!=null&&f.image){const y={index:this.processTexture(i.emissiveMap),texCoord:i.emissiveMap.channel};this.applyTextureTransform(y,i.emissiveMap),r.emissiveTexture=y}}if((p=i.normalMap)!=null&&p.image){const m={index:this.processTexture(i.normalMap),texCoord:i.normalMap.channel};i.normalScale&&i.normalScale.x!==1&&(m.scale=i.normalScale.x),this.applyTextureTransform(m,i.normalMap),r.normalTexture=m}if((g=i.aoMap)!=null&&g.image){const m={index:this.processTexture(i.aoMap),texCoord:i.aoMap.channel};i.aoMapIntensity!==1&&(m.strength=i.aoMapIntensity),this.applyTextureTransform(m,i.aoMap),r.occlusionTexture=m}i.transparent?r.alphaMode="BLEND":i.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=i.alphaTest),i.side===_i&&(r.doubleSided=!0),i.name!==""&&(r.name=i.name),this.serializeUserData(i,r),this._invokeAll(function(m){m.writeMaterial&&m.writeMaterial(i,r)});const c=n.materials.push(r)-1;return t.materials.set(i,c),c}processMesh(i){const t={keep:!0};if(this._invokeAll(function(E){E.beforeWriteMesh&&E.beforeWriteMesh(i,t)}),t.keep!=!0)return null;const n=this.cache,r=this.json,o=[i.geometry.uuid];if(Array.isArray(i.material))for(let E=0,I=i.material.length;E<I;E++)o.push(i.material[E].uuid);else o.push(i.material.uuid);const a=o.join(":");if(n.meshes.has(a))return n.meshes.get(a);const l=i.geometry;let c;i.isLineSegments?c=ht.LINES:i.isLineLoop?c=ht.LINE_LOOP:i.isLine?c=ht.LINE_STRIP:i.isPoints?c=ht.POINTS:c=i.material.wireframe?ht.LINES:ht.TRIANGLES;const u={},d={},f=[],p=[],g={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=l.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let A=null;for(let E in l.attributes){if(E.slice(0,5)==="morph")continue;const I=l.attributes[E];if(E=g[E]||E.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(E)||(E="_"+E),n.attributes.has(this.getUID(I))){d[E]=n.attributes.get(this.getUID(I));continue}A=null;const T=I.array;E==="JOINTS_0"&&!(T instanceof Uint16Array)&&!(T instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),A=new Je(new Uint16Array(T),I.itemSize,I.normalized));const P=this.processAccessor(A||I,l);P!==null&&(E.startsWith("_")||this.detectMeshQuantization(E,I),d[E]=P,n.attributes.set(this.getUID(I),P))}if(m!==void 0&&l.setAttribute("normal",m),Object.keys(d).length===0)return null;if(i.morphTargetInfluences!==void 0&&i.morphTargetInfluences.length>0){const E=[],I=[],k={};if(i.morphTargetDictionary!==void 0)for(const T in i.morphTargetDictionary)k[i.morphTargetDictionary[T]]=T;for(let T=0;T<i.morphTargetInfluences.length;++T){const P={};let B=!1;for(const M in l.morphAttributes){if(M!=="position"&&M!=="normal"){B||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),B=!0);continue}const U=l.morphAttributes[M][T],G=M.toUpperCase(),W=l.attributes[M];if(n.attributes.has(this.getUID(U,!0))){P[G]=n.attributes.get(this.getUID(U,!0));continue}const Y=U.clone();if(!l.morphTargetsRelative)for(let D=0,L=U.count;D<L;D++)for(let V=0;V<U.itemSize;V++)V===0&&Y.setX(D,U.getX(D)-W.getX(D)),V===1&&Y.setY(D,U.getY(D)-W.getY(D)),V===2&&Y.setZ(D,U.getZ(D)-W.getZ(D)),V===3&&Y.setW(D,U.getW(D)-W.getW(D));P[G]=this.processAccessor(Y,l),n.attributes.set(this.getUID(W,!0),P[G])}p.push(P),E.push(i.morphTargetInfluences[T]),i.morphTargetDictionary!==void 0&&I.push(k[T])}u.weights=E,I.length>0&&(u.extras={},u.extras.targetNames=I)}const y=Array.isArray(i.material);if(y&&l.groups.length===0)return null;let b=!1;if(y&&l.index===null){const E=[];for(let I=0,k=l.attributes.position.count;I<k;I++)E[I]=I;l.setIndex(E),b=!0}const _=y?i.material:[i.material],w=y?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let E=0,I=w.length;E<I;E++){const k={mode:c,attributes:d};if(this.serializeUserData(l,k),p.length>0&&(k.targets=p),l.index!==null){let P=this.getUID(l.index);(w[E].start!==void 0||w[E].count!==void 0)&&(P+=":"+w[E].start+":"+w[E].count),n.attributes.has(P)?k.indices=n.attributes.get(P):(k.indices=this.processAccessor(l.index,l,w[E].start,w[E].count),n.attributes.set(P,k.indices)),k.indices===null&&delete k.indices}const T=this.processMaterial(_[w[E].materialIndex]);T!==null&&(k.material=T),f.push(k)}b===!0&&l.setIndex(null),u.primitives=f,r.meshes||(r.meshes=[]),this._invokeAll(function(E){E.writeMesh&&E.writeMesh(i,u)});const S=r.meshes.push(u)-1;return n.meshes.set(a,S),S}detectMeshQuantization(i,t){if(this.extensionsUsed[uw])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const r=i.split("_",1)[0];JR[r]&&JR[r].includes(n)&&(this.extensionsUsed[uw]=!0,this.extensionsRequired[uw]=!0)}processCamera(i){const t=this.json;t.cameras||(t.cameras=[]);const n=i.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:i.right*2,ymag:i.top*2,zfar:i.far<=0?.001:i.far,znear:i.near<0?0:i.near}:r.perspective={aspectRatio:i.aspect,yfov:ct.degToRad(i.fov),zfar:i.far<=0?.001:i.far,znear:i.near<0?0:i.near},i.name!==""&&(r.name=i.type),t.cameras.push(r)-1}processAnimation(i,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]),i=ob.Utils.mergeMorphTargetTracks(i.clone(),t);const o=i.tracks,a=[],l=[];for(let c=0;c<o.length;++c){const u=o[c],d=Nr.parseTrackName(u.name);let f=Nr.findNode(t,d.nodeName);const p=ZR[d.propertyName];if(d.objectName==="bones"&&(f.isSkinnedMesh===!0?f=f.skeleton.getBoneByName(d.objectIndex):f=void 0),!f||!p)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;const g=1;let m=u.values.length/u.times.length;p===ZR.morphTargetInfluences&&(m/=f.morphTargetInfluences.length);let A;u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(A="CUBICSPLINE",m/=3):u.getInterpolation()===PP?A="STEP":A="LINEAR",l.push({input:this.processAccessor(new Je(u.times,g)),output:this.processAccessor(new Je(u.values,m)),interpolation:A}),a.push({sampler:l.length-1,target:{node:r.get(f),path:p}})}return n.animations.push({name:i.name||"clip_"+n.animations.length,samplers:l,channels:a}),n.animations.length-1}processSkin(i){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(i)],o=i.skeleton;if(o===void 0)return null;const a=i.skeleton.bones[0];if(a===void 0)return null;const l=[],c=new Float32Array(o.bones.length*16),u=new le;for(let f=0;f<o.bones.length;++f)l.push(n.get(o.bones[f])),u.copy(o.boneInverses[f]),u.multiply(i.bindMatrix).toArray(c,f*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Je(c,16)),joints:l,skeleton:n.get(a)}),r.skin=t.skins.length-1}processNode(i){const t={keep:!0};if(this._invokeAll(function(c){c.beforeWriteNode&&c.beforeWriteNode(i,t)}),t.keep!=!0)return null;const n=this.json,r=this.options,o=this.nodeMap;n.nodes||(n.nodes=[]);const a={};if(r.trs){const c=i.quaternion.toArray(),u=i.position.toArray(),d=i.scale.toArray();Jp(c,[0,0,0,1])||(a.rotation=c),Jp(u,[0,0,0])||(a.translation=u),Jp(d,[1,1,1])||(a.scale=d)}else i.matrixAutoUpdate&&i.updateMatrix(),d7(i.matrix)===!1&&(a.matrix=i.matrix.elements);if(i.name!==""&&(a.name=String(i.name)),this.serializeUserData(i,a),i.isMesh||i.isLine||i.isPoints){const c=this.processMesh(i);c!==null&&(a.mesh=c)}else i.isCamera&&(a.camera=this.processCamera(i));if(i.isSkinnedMesh&&this.skins.push(i),i.children.length>0){const c=[];for(let u=0,d=i.children.length;u<d;u++){const f=i.children[u];if(f.visible||r.onlyVisible===!1){const p=this.processNode(f);p!==null&&c.push(p)}}c.length>0&&(a.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(i,a)});const l=n.nodes.push(a)-1;return o.set(i,l),l}processScene(i){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};i.name!==""&&(r.name=i.name),t.scenes.push(r);const o=[];for(let a=0,l=i.children.length;a<l;a++){const c=i.children[a];if(c.visible||n.onlyVisible===!1){const u=this.processNode(c);u!==null&&o.push(u)}}o.length>0&&(r.nodes=o),this.serializeUserData(i,r)}processObjects(i){const t=new ws;t.name="AuxScene";for(let n=0;n<i.length;n++)t.children.push(i[n]);this.processScene(t)}processInput(i){const t=this.options;i=i instanceof Array?i:[i],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(i)});const n=[];for(let r=0;r<i.length;r++)i[r]instanceof ws?this.processScene(i[r]):n.push(i[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],i[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(i)})}_invokeAll(i){for(let t=0,n=this.plugins.length;t<n;t++)i(this.plugins[t])}}class g7{constructor(i){this.writer=i,this.name="KHR_lights_punctual"}writeNode(i,t){if(!i.isLight)return;if(!i.isDirectionalLight&&!i.isPointLight&&!i.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",i);return}const n=this.writer,r=n.json,o=n.extensionsUsed,a={};i.name&&(a.name=i.name),a.color=i.color.toArray(),a.intensity=i.intensity,i.isDirectionalLight?a.type="directional":i.isPointLight?(a.type="point",i.distance>0&&(a.range=i.distance)):i.isSpotLight&&(a.type="spot",i.distance>0&&(a.range=i.distance),a.spot={},a.spot.innerConeAngle=(1-i.penumbra)*i.angle,a.spot.outerConeAngle=i.angle),i.decay!==void 0&&i.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),i.target&&(i.target.parent!==i||i.target.position.x!==0||i.target.position.y!==0||i.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);const l=r.extensions[this.name].lights;l.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:l.length-1}}}class m7{constructor(i){this.writer=i,this.name="KHR_materials_unlit"}writeMaterial(i,t){if(!i.isMeshBasicMaterial)return;const r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class A7{constructor(i){this.writer=i,this.name="KHR_materials_clearcoat"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.clearcoat===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.clearcoatFactor=i.clearcoat,i.clearcoatMap){const a={index:n.processTexture(i.clearcoatMap),texCoord:i.clearcoatMap.channel};n.applyTextureTransform(a,i.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=i.clearcoatRoughness,i.clearcoatRoughnessMap){const a={index:n.processTexture(i.clearcoatRoughnessMap),texCoord:i.clearcoatRoughnessMap.channel};n.applyTextureTransform(a,i.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(i.clearcoatNormalMap){const a={index:n.processTexture(i.clearcoatNormalMap),texCoord:i.clearcoatNormalMap.channel};n.applyTextureTransform(a,i.clearcoatNormalMap),o.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class v7{constructor(i){this.writer=i,this.name="KHR_materials_iridescence"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.iridescence===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.iridescenceFactor=i.iridescence,i.iridescenceMap){const a={index:n.processTexture(i.iridescenceMap),texCoord:i.iridescenceMap.channel};n.applyTextureTransform(a,i.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=i.iridescenceIOR,o.iridescenceThicknessMinimum=i.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=i.iridescenceThicknessRange[1],i.iridescenceThicknessMap){const a={index:n.processTexture(i.iridescenceThicknessMap),texCoord:i.iridescenceThicknessMap.channel};n.applyTextureTransform(a,i.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class y7{constructor(i){this.writer=i,this.name="KHR_materials_transmission"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.transmissionFactor=i.transmission,i.transmissionMap){const a={index:n.processTexture(i.transmissionMap),texCoord:i.transmissionMap.channel};n.applyTextureTransform(a,i.transmissionMap),o.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class b7{constructor(i){this.writer=i,this.name="KHR_materials_volume"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.thicknessFactor=i.thickness,i.thicknessMap){const a={index:n.processTexture(i.thicknessMap),texCoord:i.thicknessMap.channel};n.applyTextureTransform(a,i.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=i.attenuationDistance,o.attenuationColor=i.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class _7{constructor(i){this.writer=i,this.name="KHR_materials_ior"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.ior===1.5)return;const r=this.writer.extensionsUsed,o={};o.ior=i.ior,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class w7{constructor(i){this.writer=i,this.name="KHR_materials_specular"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.specularIntensity===1&&i.specularColor.equals(o7)&&!i.specularIntensityMap&&!i.specularColorMap)return;const n=this.writer,r=n.extensionsUsed,o={};if(i.specularIntensityMap){const a={index:n.processTexture(i.specularIntensityMap),texCoord:i.specularIntensityMap.channel};n.applyTextureTransform(a,i.specularIntensityMap),o.specularTexture=a}if(i.specularColorMap){const a={index:n.processTexture(i.specularColorMap),texCoord:i.specularColorMap.channel};n.applyTextureTransform(a,i.specularColorMap),o.specularColorTexture=a}o.specularFactor=i.specularIntensity,o.specularColorFactor=i.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class x7{constructor(i){this.writer=i,this.name="KHR_materials_sheen"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.sheen==0)return;const n=this.writer,r=n.extensionsUsed,o={};if(i.sheenRoughnessMap){const a={index:n.processTexture(i.sheenRoughnessMap),texCoord:i.sheenRoughnessMap.channel};n.applyTextureTransform(a,i.sheenRoughnessMap),o.sheenRoughnessTexture=a}if(i.sheenColorMap){const a={index:n.processTexture(i.sheenColorMap),texCoord:i.sheenColorMap.channel};n.applyTextureTransform(a,i.sheenColorMap),o.sheenColorTexture=a}o.sheenRoughnessFactor=i.sheenRoughness,o.sheenColorFactor=i.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class C7{constructor(i){this.writer=i,this.name="KHR_materials_anisotropy"}writeMaterial(i,t){if(!i.isMeshPhysicalMaterial||i.anisotropy==0)return;const n=this.writer,r=n.extensionsUsed,o={};if(i.anisotropyMap){const a={index:n.processTexture(i.anisotropyMap)};n.applyTextureTransform(a,i.anisotropyMap),o.anisotropyTexture=a}o.anisotropyStrength=i.anisotropy,o.anisotropyRotation=i.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class S7{constructor(i){this.writer=i,this.name="KHR_materials_emissive_strength"}writeMaterial(i,t){if(!i.isMeshStandardMaterial||i.emissiveIntensity===1)return;const r=this.writer.extensionsUsed,o={};o.emissiveStrength=i.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class E7{constructor(i){this.writer=i,this.name="EXT_materials_bump"}writeMaterial(i,t){if(!i.isMeshStandardMaterial||i.bumpScale===1&&!i.bumpMap)return;const n=this.writer,r=n.extensionsUsed,o={};if(i.bumpMap){const a={index:n.processTexture(i.bumpMap),texCoord:i.bumpMap.channel};n.applyTextureTransform(a,i.bumpMap),o.bumpTexture=a}o.bumpFactor=i.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class I7{constructor(i){this.writer=i,this.name="EXT_mesh_gpu_instancing"}writeNode(i,t){if(!i.isInstancedMesh)return;const n=this.writer,r=i,o=new Float32Array(r.count*3),a=new Float32Array(r.count*4),l=new Float32Array(r.count*3),c=new le,u=new x,d=new se,f=new x;for(let g=0;g<r.count;g++)r.getMatrixAt(g,c),c.decompose(u,d,f),u.toArray(o,g*3),d.toArray(a,g*4),f.toArray(l,g*3);const p={TRANSLATION:n.processAccessor(new Je(o,3)),ROTATION:n.processAccessor(new Je(a,4)),SCALE:n.processAccessor(new Je(l,3))};r.instanceColor&&(p._COLOR_0=n.processAccessor(r.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:p},n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0}}ob.Utils={insertKeyframe:function(s,i){const n=s.getValueSize(),r=new s.TimeBufferType(s.times.length+1),o=new s.ValueBufferType(s.values.length+n),a=s.createInterpolant(new s.ValueBufferType(n));let l;if(s.times.length===0){r[0]=i;for(let c=0;c<n;c++)o[c]=0;l=0}else if(i<s.times[0]){if(Math.abs(s.times[0]-i)<.001)return 0;r[0]=i,r.set(s.times,1),o.set(a.evaluate(i),0),o.set(s.values,n),l=0}else if(i>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-i)<.001)return s.times.length-1;r[r.length-1]=i,r.set(s.times,0),o.set(s.values,0),o.set(a.evaluate(i),s.values.length),l=r.length-1}else for(let c=0;c<s.times.length;c++){if(Math.abs(s.times[c]-i)<.001)return c;if(s.times[c]<i&&s.times[c+1]>i){r.set(s.times.slice(0,c+1),0),r[c+1]=i,r.set(s.times.slice(c+1),c+2),o.set(s.values.slice(0,(c+1)*n),0),o.set(a.evaluate(i),(c+1)*n),o.set(s.values.slice((c+1)*n),(c+2)*n),l=c+1;break}}return s.times=r,s.values=o,l},mergeMorphTargetTracks:function(s,i){const t=[],n={},r=s.tracks;for(let o=0;o<r.length;++o){let a=r[o];const l=Nr.parseTrackName(a.name),c=Nr.findNode(i,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(PC)}const u=c.morphTargetInfluences.length,d=c.morphTargetDictionary[l.propertyIndex];if(d===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let f;if(n[c.uuid]===void 0){f=a.clone();const g=new f.ValueBufferType(u*f.times.length);for(let m=0;m<f.times.length;m++)g[m*u+d]=f.values[m];f.name=(l.nodeName||"")+".morphTargetInfluences",f.values=g,n[c.uuid]=f,t.push(f);continue}const p=a.createInterpolant(new a.ValueBufferType(1));f=n[c.uuid];for(let g=0;g<f.times.length;g++)f.values[g*u+d]=p.evaluate(f.times[g]);for(let g=0;g<a.times.length;g++){const m=this.insertKeyframe(f,a.times[g]);f.values[m*u+d]=a.values[g]}}return s.tracks=t,s}};class L2{constructor(i){this.writer=i,this.name="EXT_mesh_gpu_instancing"}writeNode(i,t){if(i.constructor.name!=="InstancedMesh")return;const n=this.writer,r=n.extensionsUsed,o={};t.extensions=t.extensions||{},t.extensions[this.name]=o;let a=new le;const l=new Array,c=new Array,u=new Array;for(let g=0;g<i.count;g++){i.getMatrixAt(g,a);let m=new x,A=new se,y=new x;a.decompose(m,A,y),l.push(m.x,m.y,m.z),c.push(A.x,A.y,A.z,A.w),u.push(y.x,y.y,y.z)}const d=new Float32Array(l),f=new Float32Array(c),p=new Float32Array(u);o.attributes={TRANSLATION:n.processAccessor(new Je(d,3)),ROTATION:n.processAccessor(new Je(f,4)),SCALE:n.processAccessor(new Je(p,3))},r[this.name]=!0}}var F2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const tv=Q("debuggltfexport");class U2 extends Xo{constructor(){super(...arguments);h(this,"sceneRoot")}}class Ua extends oe{constructor(){super(...arguments);h(this,"binary",!0);h(this,"objects",[]);h(this,"ext")}async exportNow(t){tv&&console.log("Exporting objects as glTF",this.objects),t||(t="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const n={binary:this.binary,pivot:Ua.calculateCenter(this.objects)},r=await this.export(this.objects,n).catch(o=>(console.error(o),!1));return r===!1?!1:(this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Ua.saveArrayBuffer(r,t):Ua.saveJson(r,t),!0)}async export(t,n){if(!t||t.length<=0){console.warn("No objects set to export");return}const r=new ob;r.register(u=>new L2(u)),w2(r,this.context),Ua.filterTopmostParent(t);const o={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(n==null?void 0:n.animations)||Ua.collectAnimations(t),...n},a=new ne;n!=null&&n.pivot&&a.position.sub(n.pivot),tv&&console.log("EXPORT",t),t.forEach(u=>{u&&(a.children.push(u),u.matrixAutoUpdate=!1,u.matrix.copy(u.matrixWorld),j.getComponentsInChildren(u,ci).forEach(d=>{j.isActiveInHierarchy(d.gameObject)&&d.setInstancingEnabled(!1)}))});const l=new tO(a);return this.ext&&(this.ext.context=l),new Promise((u,d)=>{tv&&console.log("Starting glTF export.");try{r==null||r.parse(a,f=>{c(),u(f)},f=>{c(),d(f)},o)}catch(f){console.error(f),d(f)}finally{tv&&console.log("Finished glTF export.")}});function c(){t.forEach(u=>{u&&(u.matrixAutoUpdate=!0,j.getComponentsInChildren(u,ci).forEach(d=>{j.isActiveInHierarchy(d.gameObject)&&d.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,n){this.save(new Blob([t],{type:"application/octet-stream"}),n)}static saveJson(t,n){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n)}static save(t,n){const r=document.createElement("a");r.style.display="none",document.body.appendChild(r),typeof t=="string"?r.href=t:r.href=URL.createObjectURL(t),r.download=n,r.click(),r.remove()}static collectAnimations(t,n){n=n||[];for(const r of t)r&&r.traverseVisible(o=>{o.animations&&o.animations.length>0&&n.push(...o.animations)});return n}static calculateCenter(t,n){const r=n||new x;return r.set(0,0,0),t.forEach(o=>{r.add(Ve(o))}),console.log(r),r.divideScalar(t.length),r}static filterTopmostParent(t){if(!(t.length<=0))for(let n=0;n<t.length;n++){let r=t[n];if(!r){t.splice(n,1),n--;continue}for(;r.parent;){if(t.includes(r.parent)){t.splice(n,1),n--;break}r=r.parent}}}}F2([v()],Ua.prototype,"binary",void 0);F2([v(ne)],Ua.prototype,"objects",void 0);var TE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Wm extends oe{constructor(){super(...arguments);h(this,"isGizmo",!1);h(this,"color0");h(this,"color1");h(this,"gridHelper");h(this,"size");h(this,"divisions");h(this,"offset")}onEnable(){if(this.isGizmo&&!Em)return;const t=this.size,n=this.divisions;this.gridHelper||(this.gridHelper=new SC(t,n,this.color0??new xe(.4,.4,.4),this.color1??new xe(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}TE([v()],Wm.prototype,"isGizmo",void 0);TE([v(xe)],Wm.prototype,"color0",void 0);TE([v(xe)],Wm.prototype,"color1",void 0);var ab=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Bc=Q("debuginputfield"),Oe=class extends oe{constructor(){super(...arguments);h(this,"textComponent");h(this,"placeholder");h(this,"onValueChanged");h(this,"onEndEdit");h(this,"inputEventFn");h(this,"_iosEventFn")}get text(){var t;return((t=this.textComponent)==null?void 0:t.text)??""}get isFocused(){return Oe.active===this}start(){Bc&&console.log(this.name,this)}onEnable(){var t;Oe.htmlField||(Oe.htmlField=document.createElement("input"),Oe.htmlField.style.width="0px",Oe.htmlField.style.height="0px",Oe.htmlField.style.padding="0px",Oe.htmlField.style.border="none",Oe.htmlField.style.overflow="hidden",Oe.htmlField.style.caretColor="transparent",Oe.htmlField.style.outline="none",Oe.htmlField.classList.add("ar"),Oe.htmlField.onfocus=()=>Oe.htmlFieldFocused=!0,Oe.htmlField.onblur=()=>Oe.htmlFieldFocused=!1,document.body.append(Oe.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Oe.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((t=this.textComponent)!=null&&t.text.length)&&j.setActive(this.placeholder.gameObject,!1),Cu()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var t;(t=Oe.htmlField)==null||t.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Oe.active===this&&Oe.htmlField?(Oe.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&j.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(t){Bc&&console.log("CLICK",t,Oe.active),Oe.activeTime=this.context.time.time,Oe.active!==this&&this.startCoroutine(this.activeLoop(),qe.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Oe.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Oe.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var t,n,r,o;if(Oe.active!==this&&(Bc&&console.log("Select",this.name,this,Oe.htmlField,this.context.isInXR,this.context.arOverlayElement,(t=this.textComponent)==null?void 0:t.text,(n=Oe.htmlField)==null?void 0:n.value),(r=Oe.active)==null||r.onDeselected(),Oe.active=this,this.placeholder&&j.setActive(this.placeholder.gameObject,!1),Oe.htmlField)){if(Oe.htmlField.value=((o=this.textComponent)==null?void 0:o.text)||"",Bc&&console.log("set input field value",Oe.htmlField.value),this.context.isInXR){const a=this.context.arOverlayElement;a&&a.append(Oe.htmlField)}this.selectInputField()}}onDeselected(){var t;Oe.active===this&&(Oe.active=null,Bc&&console.log("Deselect",this.name,this),Oe.htmlField&&(Oe.htmlField.blur(),document.body.append(Oe.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&j.setActive(this.placeholder.gameObject,!0),Oe.htmlField&&((t=this.onEndEdit)==null||t.invoke(Oe.htmlField.value)))}update(){var t;Oe.active===this&&((t=this.textComponent)==null||t.markDirty())}onInput(t){var n,r;if(Oe.active===this){if(Bc&&console.log(t.code,t,(n=Oe.htmlField)==null?void 0:n.value,(r=this.textComponent)==null?void 0:r.text),t.code==="Escape"||t.code==="Enter"){this.onDeselected();return}Oe.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&j.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var t;if(this.textComponent&&Oe.htmlField){if(this.textComponent.text!==Oe.htmlField.value){Bc&&console.log("VALUE CHANGED");const n=this.textComponent.text,r=Oe.htmlField.value;(t=this.onValueChanged)==null||t.invoke(r,n)}this.textComponent.text=Oe.htmlField.value}}selectInputField(){Oe.htmlField&&(Bc&&console.log("Focus Inputfield",Oe.htmlFieldFocused),Oe.htmlField.setSelectionRange(Oe.htmlField.value.length,Oe.htmlField.value.length),Cu()?Oe.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var t;return(t=Oe.htmlField)==null?void 0:t.focus()},1))}processInputOniOS(){const t=this.context.physics.raycast();if(!t.length)return;const r=t[0].object,o=$S(r);((o==null?void 0:o.gameObject)===this.gameObject||(o==null?void 0:o.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let uo=Oe;h(uo,"active",null),h(uo,"activeTime",-1),h(uo,"htmlField",null),h(uo,"htmlFieldFocused",!1);ab([v($s)],uo.prototype,"textComponent",void 0);ab([v($s)],uo.prototype,"placeholder",void 0);ab([v(ti)],uo.prototype,"onValueChanged",void 0);ab([v(ti)],uo.prototype,"onEndEdit",void 0);var ul=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};function fw(s){return s*Math.PI/180}const nB=300,Pc=Q("debuglights");var Rl;(function(s){s[s.Spot=0]="Spot",s[s.Directional=1]="Directional",s[s.Point=2]="Point",s[s.Area=3]="Area",s[s.Rectangle=3]="Rectangle",s[s.Disc=4]="Disc"})(Rl||(Rl={}));var Oy;(function(s){s[s.Realtime=4]="Realtime",s[s.Baked=2]="Baked",s[s.Mixed=1]="Mixed"})(Oy||(Oy={}));var Cg;(function(s){s[s.None=0]="None",s[s.Hard=1]="Hard",s[s.Soft=2]="Soft"})(Cg||(Cg={}));class Hr extends oe{constructor(){super(...arguments);h(this,"type",0);h(this,"range",1);h(this,"spotAngle",1);h(this,"innerSpotAngle",1);h(this,"_color",new xe(16777215));h(this,"_shadowNearPlane",.1);h(this,"_shadowBias",0);h(this,"_shadowNormalBias",0);h(this,"_overrideShadowBiasSettings",!1);h(this,"_shadows",1);h(this,"lightmapBakeType",Oy.Realtime);h(this,"_intensity",-1);h(this,"_shadowDistance");h(this,"shadowWidth");h(this,"shadowHeight");h(this,"_shadowResolution");h(this,"light");h(this,"_webXRStartedListener");h(this,"_webXREndedListener");h(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var n,r;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((r=(n=this.light)==null?void 0:n.shadow)==null?void 0:r.camera)!==void 0)){const o=this.light.shadow.camera;o.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var n,r;t!==this._shadowBias&&(this._shadowBias=t,((r=(n=this.light)==null?void 0:n.shadow)==null?void 0:r.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var n,r;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((r=(n=this.light)==null?void 0:n.shadow)==null?void 0:r.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==Cg.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var n;if(this._intensity=t,this.light){let r=1;if(this.context.isInXR&&this._webARRoot){const o=(n=this._webARRoot)==null?void 0:n.arScale;typeof o=="number"&&o>0&&(r/=o)}this.light.intensity=t*r}Pc&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const n=this.light;if(n!=null&&n.shadow){const r=n.shadow.camera;r.far=t,r.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const n=this.light;n!=null&&n.shadow&&(n.shadow.mapSize.set(t,t),n.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===Oy.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===Rl.Directional?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new xe(this.color??16777215),Pc&&console.log(this.name,this)}onEnable(){Pc&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Pc&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===Rl.Directional&&this.startCoroutine(this.updateMainLightRoutine(),qe.LateUpdate))}onDisable(){Pc&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(t){this._webARRoot=j.getComponentInParent(this.gameObject,fh)??void 0}onLeaveXR(t){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case Rl.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case Rl.Directional:const n=new zg(this.color,this.intensity*Math.PI);if(n.position.set(0,0,-nB*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(n.target),Tf(n.target,0,0,0),this.light=n,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Pc){const l=new KF(this.light,.2,this.color);this.context.scene.add(l)}break;case Rl.Spot:const r=new RC(this.color,this.intensity*Math.PI,this.range,fw(this.spotAngle/2),1-fw(this.innerSpotAngle/2)/fw(this.spotAngle/2),2);r.position.set(0,0,0),r.rotation.set(0,0,0),this.light=r;const o=r.target;r.add(o),o.position.set(0,0,this.range),o.rotation.set(0,0,0);break;case Rl.Point:const a=new Ng(this.color,this.intensity*Math.PI,this.range);this.light=a;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==Cg.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Pc&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const n=this.light.shadow.camera;if(n.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?n.far=this._shadowDistance:n.far=nB*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)n.left=-this.shadowWidth/2,n.right=this.shadowWidth/2;else{const r=this.gameObject.scale.x;n.left*=r,n.right*=r}if(this.shadowHeight!==void 0)n.top=this.shadowHeight/2,n.bottom=-this.shadowHeight/2;else{const r=this.gameObject.scale.y;n.top*=r,n.bottom*=r}this.light.shadow.needsUpdate=!0,Pc&&this.context.scene.add(new JF(n))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===Rl.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===Cg.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}h(Hr,"allowChangingRendererShadowMapType",!0);ul([v()],Hr.prototype,"type",void 0);ul([v(xe)],Hr.prototype,"color",null);ul([v()],Hr.prototype,"shadowNearPlane",null);ul([v()],Hr.prototype,"shadowBias",null);ul([v()],Hr.prototype,"shadowNormalBias",null);ul([v()],Hr.prototype,"shadows",null);ul([v()],Hr.prototype,"lightmapBakeType",void 0);ul([v()],Hr.prototype,"intensity",null);ul([v()],Hr.prototype,"shadowDistance",null);ul([v()],Hr.prototype,"shadowResolution",null);new x(0,0,0);var qm=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const pw=Q("debuglods"),T7=Q("nolods");var oC;(function(s){s[s.None=0]="None",s[s.CrossFade=1]="CrossFade",s[s.SpeedTree=2]="SpeedTree"})(oC||(oC={}));class Jf{constructor(){h(this,"screenRelativeTransitionHeight");h(this,"distance");h(this,"renderers")}}qm([v()],Jf.prototype,"screenRelativeTransitionHeight",void 0);qm([v()],Jf.prototype,"distance",void 0);qm([v(ci)],Jf.prototype,"renderers",void 0);class R7{constructor(i){h(this,"model");this.model=i}get renderers(){return this.model.renderers}}class lb extends oe{constructor(){super(...arguments);h(this,"fadeMode",oC.None);h(this,"localReferencePoint");h(this,"lodCount",0);h(this,"size",0);h(this,"animateCrossFading",!1);h(this,"lodModels");h(this,"_lods",[]);h(this,"_settings",[]);h(this,"_lodsHandler");h(this,"_distanceFactor",1)}start(){if(pw&&console.log("LODGROUP",this.name,this.lodModels,this),!T7&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const r of this.lodModels){const o=new R7(r);this._lods.push(o);for(const a of o.renderers)t.includes(a)||t.push(a)}this._lodsHandler=new Array;for(let r=0;r<t.length;r++){const o=new ZF;this._lodsHandler.push(o),this.gameObject.add(o)}const n=new ne;n.name="Cull "+this.name;for(let r=0;r<t.length;r++){const o=t[r],a=this._lodsHandler[r],l=o.gameObject;pw&&console.log(r,l.name);for(const c of this._lods){const u=c.model.distance;let d=null;if(c.renderers.includes(o)?d=l:d=n,d.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${d.name}`);continue}pw&&console.log("LEVEL",d.name,u),a.autoUpdate=!1,this.onAddLodLevel(a,d,c.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const n of this._lodsHandler){n.update(t);const r=n.getCurrentLevel(),o=n.levels[r];n.layers.mask=o.object.layers.mask}}onAddLodLevel(t,n,r){if(n===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",n.name,n);return}t.addLevel(n,r*this._distanceFactor,.01);const o={lod:t,levelIndex:t.levels.length-1,distance:r};this._settings.push(o)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const n of this._settings){const r=n.lod.levels[n.levelIndex];r.distance=n.distance*t}}}}qm([v(x)],lb.prototype,"localReferencePoint",void 0);qm([v(Jf)],lb.prototype,"lodModels",void 0);const B7=Q("logstats");class N2 extends oe{onEnable(){console.log(this),B7&&this.startCoroutine(this.run(),qe.OnAfterRender)}*run(){for(;this.enabled;){const i=this.context.renderer.info;console.log(i.memory,i.render,i.programs),yield}}}var cb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const u1=class extends oe{constructor(){super(...arguments);h(this,"target");h(this,"invertForward",!1);h(this,"keepUpDirection",!0);h(this,"copyTargetRotation",!1)}onBeforeRender(){let t=this.target;t||(t=this.context.mainCamera),t&&(g0(this.gameObject,t,this.keepUpDirection,this.copyTargetRotation),this.invertForward&&this.gameObject.quaternion.multiply(u1.flipYQuat))}createBehaviours(t,n,r){if(n.uuid===this.gameObject.uuid){let o=n;if(this.keepUpDirection){const l=_s.createEmptyParent(n);o=l;const c=this.invertForward?-1:1;l.matrix.multiply(new le().makeRotationZ(Math.PI/2*c)),n.matrix.multiply(new le().makeRotationZ(-Math.PI/2*c))}const a=new cn("lookat "+this.name,es.sceneStartTrigger(),Ct.lookAtCameraAction(o,void 0,this.invertForward?Ud.back:Ud.forward,this.keepUpDirection?Ud.up:Ud.zero));t.addBehavior(a)}}};let $l=u1;h($l,"flipYQuat",new se().setFromAxisAngle(new x(0,1,0),Math.PI));cb([v(ne)],$l.prototype,"target",void 0);cb([v()],$l.prototype,"invertForward",void 0);cb([v()],$l.prototype,"keepUpDirection",void 0);cb([v()],$l.prototype,"copyTargetRotation",void 0);var P7=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const iv=Q("debugnestedgltf");class RE extends oe{constructor(){super(...arguments);h(this,"filePath");h(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var n;(n=this.filePath)==null||n.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var n,r,o,a,l;if(this._isLoadingOrDoneLoading)return;iv&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const c=new ll;c.idProvider=new En(this.hash(this.guid)),c.parent=t,this.gameObject.updateMatrix();const u=this.gameObject.matrix;iv&&console.log("Load nested:",((n=this.filePath)==null?void 0:n.uri)??this.filePath,this.gameObject.position);const d=await((o=(r=this.filePath)==null?void 0:r.instantiate)==null?void 0:o.call(this.filePath,c));iv&&console.log("Nested loaded:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,d),d&&(d.matrixAutoUpdate=!1,d.matrix.identity(),d.applyMatrix4(u),d.matrixAutoUpdate=!0,d.layers.disableAll(),d.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:d,assetReference:this.filePath}}))),iv&&console.log("Nested loading done:",((l=this.filePath)==null?void 0:l.uri)??this.filePath,d)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let n=0;for(let r=0;r<t.length;r++)n=t.charCodeAt(r)+((n<<5)-n);return n}}P7([v(tt)],RE.prototype,"filePath",void 0);var BE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const M7=Q("debugnet");class ph extends oe{constructor(){super(...arguments);h(this,"url",null);h(this,"urlParameterName",null);h(this,"localhost",null)}awake(){M7&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let t=this.url?ph.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const a=Q(this.urlParameterName);a&&typeof a=="string"&&(t=a)}if(!t)return null;const r=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return r!=null&&r.groups?(r==null?void 0:r.groups.socket_prefix)?t:"wss://"+(r==null?void 0:r.groups.url):null}static GetUrl(t,n){let r=t;const o=ph.IsLocalNetwork()&&n;if(o&&(r=n),t!=null&&t.startsWith("/")){const a=o?r:window.location.origin;a!=null&&a.endsWith("/")&&t.startsWith("/")&&(t=t.substring(1)),r=a+t}return r}static IsLocalNetwork(t=window.location.hostname){return fr(t)}}BE([v()],ph.prototype,"url",void 0);BE([v()],ph.prototype,"urlParameterName",void 0);BE([v()],ph.prototype,"localhost",void 0);var hb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Zf extends oe{constructor(){super(...arguments);h(this,"referenceSpace");h(this,"from");h(this,"affectPosition",!1);h(this,"affectRotation",!1);h(this,"alignLookDirection",!1);h(this,"levelLookDirection",!1);h(this,"levelPosition",!1);h(this,"positionOffset",new x(0,0,0));h(this,"rotationOffset",new x(0,0,0));h(this,"offset",new x(0,0,0))}update(){if(!this.from)return;var t=Ve(this.from),n=Ht(this.from);this.offset.copy(this.positionOffset);const r=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(r),t.add(this.offset),this.levelPosition&&this.referenceSpace){const c=new tc(this.gameObject.up,0),u=Ve(this.referenceSpace);c.setFromNormalAndCoplanarPoint(this.gameObject.up,u);const d=new x(0,0,0);c.projectPoint(t,d),t.copy(d)}this.affectPosition&&Sn(this.gameObject,t);const o=new Gt(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),a=new se().setFromEuler(o);this.affectRotation&&na(this.gameObject,n.multiply(a));const l=new x;this.from.getWorldDirection(l).multiplyScalar(50),this.levelLookDirection&&(l.y=0),this.alignLookDirection&&this.gameObject.lookAt(l)}}hb([v(j)],Zf.prototype,"referenceSpace",void 0);hb([v(j)],Zf.prototype,"from",void 0);hb([v(x)],Zf.prototype,"positionOffset",void 0);hb([v(x)],Zf.prototype,"rotationOffset",void 0);var PE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Hd;(function(s){s[s.NewTab=0]="NewTab",s[s.SameTab=1]="SameTab",s[s.NewWindow=2]="NewWindow"})(Hd||(Hd={}));class Xm extends oe{constructor(){super(...arguments);h(this,"url");h(this,"mode",Hd.NewTab);h(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let t=this.url;switch(!t.startsWith("mailto:")&&t.includes("@")&&(t="mailto:"+t),be()&&bi("Open URL: "+t),this.mode){case Hd.NewTab:$p(),globalThis.open(t,"_blank");break;case Hd.SameTab:$p()&&Cu()?globalThis.open(t,"_top"):globalThis.open(t,"_self");break;case Hd.NewWindow:$p()?globalThis.open(t,"_top"):globalThis.open(t,"_new");break}}start(){this.gameObject.getComponentInParent(Co)||this.gameObject.addComponent(Co)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var n;this.clickable&&!t.used&&((n=this.url)!=null&&n.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(be()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}PE([v()],Xm.prototype,"url",void 0);PE([v()],Xm.prototype,"mode",void 0);PE([v()],Xm.prototype,"clickable",void 0);function k7(s,i){var t=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t!=null){var n,r,o,a,l=[],c=!0,u=!1;try{if(o=(t=t.call(s)).next,i===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);c=!0);}catch(d){u=!0,r=d}finally{try{if(!c&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return l}}function aC(){aC=function(){return i};var s,i={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(D,L,V){D[L]=V.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(D,L,V){return Object.defineProperty(D,L,{value:V,enumerable:!0,configurable:!0,writable:!0}),D[L]}try{u({},"")}catch{u=function(L,V,te){return L[V]=te}}function d(D,L,V,te){var K=L&&L.prototype instanceof b?L:b,ue=Object.create(K.prototype),de=new W(te||[]);return r(ue,"_invoke",{value:B(D,V,de)}),ue}function f(D,L,V){try{return{type:"normal",arg:D.call(L,V)}}catch(te){return{type:"throw",arg:te}}}i.wrap=d;var p="suspendedStart",g="suspendedYield",m="executing",A="completed",y={};function b(){}function _(){}function w(){}var S={};u(S,a,function(){return this});var E=Object.getPrototypeOf,I=E&&E(E(Y([])));I&&I!==t&&n.call(I,a)&&(S=I);var k=w.prototype=b.prototype=Object.create(S);function T(D){["next","throw","return"].forEach(function(L){u(D,L,function(V){return this._invoke(L,V)})})}function P(D,L){function V(K,ue,de,_e){var Ee=f(D[K],D,ue);if(Ee.type!=="throw"){var Xe=Ee.arg,Me=Xe.value;return Me&&typeof Me=="object"&&n.call(Me,"__await")?L.resolve(Me.__await).then(function(Ke){V("next",Ke,de,_e)},function(Ke){V("throw",Ke,de,_e)}):L.resolve(Me).then(function(Ke){Xe.value=Ke,de(Xe)},function(Ke){return V("throw",Ke,de,_e)})}_e(Ee.arg)}var te;r(this,"_invoke",{value:function(K,ue){function de(){return new L(function(_e,Ee){V(K,ue,_e,Ee)})}return te=te?te.then(de,de):de()}})}function B(D,L,V){var te=p;return function(K,ue){if(te===m)throw new Error("Generator is already running");if(te===A){if(K==="throw")throw ue;return{value:s,done:!0}}for(V.method=K,V.arg=ue;;){var de=V.delegate;if(de){var _e=M(de,V);if(_e){if(_e===y)continue;return _e}}if(V.method==="next")V.sent=V._sent=V.arg;else if(V.method==="throw"){if(te===p)throw te=A,V.arg;V.dispatchException(V.arg)}else V.method==="return"&&V.abrupt("return",V.arg);te=m;var Ee=f(D,L,V);if(Ee.type==="normal"){if(te=V.done?A:g,Ee.arg===y)continue;return{value:Ee.arg,done:V.done}}Ee.type==="throw"&&(te=A,V.method="throw",V.arg=Ee.arg)}}}function M(D,L){var V=L.method,te=D.iterator[V];if(te===s)return L.delegate=null,V==="throw"&&D.iterator.return&&(L.method="return",L.arg=s,M(D,L),L.method==="throw")||V!=="return"&&(L.method="throw",L.arg=new TypeError("The iterator does not provide a '"+V+"' method")),y;var K=f(te,D.iterator,L.arg);if(K.type==="throw")return L.method="throw",L.arg=K.arg,L.delegate=null,y;var ue=K.arg;return ue?ue.done?(L[D.resultName]=ue.value,L.next=D.nextLoc,L.method!=="return"&&(L.method="next",L.arg=s),L.delegate=null,y):ue:(L.method="throw",L.arg=new TypeError("iterator result is not an object"),L.delegate=null,y)}function U(D){var L={tryLoc:D[0]};1 in D&&(L.catchLoc=D[1]),2 in D&&(L.finallyLoc=D[2],L.afterLoc=D[3]),this.tryEntries.push(L)}function G(D){var L=D.completion||{};L.type="normal",delete L.arg,D.completion=L}function W(D){this.tryEntries=[{tryLoc:"root"}],D.forEach(U,this),this.reset(!0)}function Y(D){if(D||D===""){var L=D[a];if(L)return L.call(D);if(typeof D.next=="function")return D;if(!isNaN(D.length)){var V=-1,te=function K(){for(;++V<D.length;)if(n.call(D,V))return K.value=D[V],K.done=!1,K;return K.value=s,K.done=!0,K};return te.next=te}}throw new TypeError(typeof D+" is not iterable")}return _.prototype=w,r(k,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:_,configurable:!0}),_.displayName=u(w,c,"GeneratorFunction"),i.isGeneratorFunction=function(D){var L=typeof D=="function"&&D.constructor;return!!L&&(L===_||(L.displayName||L.name)==="GeneratorFunction")},i.mark=function(D){return Object.setPrototypeOf?Object.setPrototypeOf(D,w):(D.__proto__=w,u(D,c,"GeneratorFunction")),D.prototype=Object.create(k),D},i.awrap=function(D){return{__await:D}},T(P.prototype),u(P.prototype,l,function(){return this}),i.AsyncIterator=P,i.async=function(D,L,V,te,K){K===void 0&&(K=Promise);var ue=new P(d(D,L,V,te),K);return i.isGeneratorFunction(L)?ue:ue.next().then(function(de){return de.done?de.value:ue.next()})},T(k),u(k,c,"Generator"),u(k,a,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),i.keys=function(D){var L=Object(D),V=[];for(var te in L)V.push(te);return V.reverse(),function K(){for(;V.length;){var ue=V.pop();if(ue in L)return K.value=ue,K.done=!1,K}return K.done=!0,K}},i.values=Y,W.prototype={constructor:W,reset:function(D){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(G),!D)for(var L in this)L.charAt(0)==="t"&&n.call(this,L)&&!isNaN(+L.slice(1))&&(this[L]=s)},stop:function(){this.done=!0;var D=this.tryEntries[0].completion;if(D.type==="throw")throw D.arg;return this.rval},dispatchException:function(D){if(this.done)throw D;var L=this;function V(Ee,Xe){return ue.type="throw",ue.arg=D,L.next=Ee,Xe&&(L.method="next",L.arg=s),!!Xe}for(var te=this.tryEntries.length-1;te>=0;--te){var K=this.tryEntries[te],ue=K.completion;if(K.tryLoc==="root")return V("end");if(K.tryLoc<=this.prev){var de=n.call(K,"catchLoc"),_e=n.call(K,"finallyLoc");if(de&&_e){if(this.prev<K.catchLoc)return V(K.catchLoc,!0);if(this.prev<K.finallyLoc)return V(K.finallyLoc)}else if(de){if(this.prev<K.catchLoc)return V(K.catchLoc,!0)}else{if(!_e)throw new Error("try statement without catch or finally");if(this.prev<K.finallyLoc)return V(K.finallyLoc)}}}},abrupt:function(D,L){for(var V=this.tryEntries.length-1;V>=0;--V){var te=this.tryEntries[V];if(te.tryLoc<=this.prev&&n.call(te,"finallyLoc")&&this.prev<te.finallyLoc){var K=te;break}}K&&(D==="break"||D==="continue")&&K.tryLoc<=L&&L<=K.finallyLoc&&(K=null);var ue=K?K.completion:{};return ue.type=D,ue.arg=L,K?(this.method="next",this.next=K.finallyLoc,y):this.complete(ue)},complete:function(D,L){if(D.type==="throw")throw D.arg;return D.type==="break"||D.type==="continue"?this.next=D.arg:D.type==="return"?(this.rval=this.arg=D.arg,this.method="return",this.next="end"):D.type==="normal"&&L&&(this.next=L),y},finish:function(D){for(var L=this.tryEntries.length-1;L>=0;--L){var V=this.tryEntries[L];if(V.finallyLoc===D)return this.complete(V.completion,V.afterLoc),G(V),y}},catch:function(D){for(var L=this.tryEntries.length-1;L>=0;--L){var V=this.tryEntries[L];if(V.tryLoc===D){var te=V.completion;if(te.type==="throw"){var K=te.arg;G(V)}return K}}throw new Error("illegal catch attempt")},delegateYield:function(D,L,V){return this.delegate={iterator:Y(D),resultName:L,nextLoc:V},this.method==="next"&&(this.arg=s),y}},i}function Ne(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}function sB(s,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,Q2(n.key),n)}}function ze(s,i,t){return i&&sB(s.prototype,i),t&&sB(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function N(s,i,t){return i=Q2(i),i in s?Object.defineProperty(s,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[i]=t,s}function $f(s,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(i&&i.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),i&&lC(s,i)}function Ly(s){return Ly=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ly(s)}function lC(s,i){return lC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},lC(s,i)}function D7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lt(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function O7(s,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lt(s)}function ep(s){var i=D7();return function(){var n=Ly(s),r;if(i){var o=Ly(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return O7(this,r)}}function mf(s,i){return L7(s)||k7(s,i)||z2(s,i)||F7()}function L7(s){if(Array.isArray(s))return s}function z2(s,i){if(s){if(typeof s=="string")return rB(s,i);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rB(s,i)}}function rB(s,i){(i==null||i>s.length)&&(i=s.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=s[t];return n}function F7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oB(s,i){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!t){if(Array.isArray(s)||(t=z2(s))||i&&s&&typeof s.length=="number"){t&&(s=t);var n=0,r=function(){};return{s:r,n:function(){return n>=s.length?{done:!0}:{done:!1,value:s[n++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){t=t.call(s)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,l=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw l}}}}function U7(s,i){if(typeof s!="object"||s===null)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,i||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(s)}function Q2(s){var i=U7(s,"string");return typeof i=="symbol"?i:String(i)}var N7=function(s){$f(t,s);var i=ep(t);function t(n){var r;return Ne(this,t),r=i.call(this),N(lt(r),"type","ParticleEmitter"),N(lt(r),"system",void 0),r.system=n,r}return ze(t,[{key:"clone",value:function(){var r=this.system.clone();return r.emitter.copy(this,!0),r.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(r){var o=[];for(var a in r){var l=r[a];delete l.metadata,o.push(l)}return o}},{key:"toJSON",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r===void 0||typeof r=="string",l={};a&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},l.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var c={};if(c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.castShadow===!0&&(c.castShadow=!0),this.receiveShadow===!0&&(c.receiveShadow=!0),this.visible===!1&&(c.visible=!1),this.frustumCulled===!1&&(c.frustumCulled=!1),this.renderOrder!==0&&(c.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(c.userData=this.userData),c.layers=this.layers.mask,c.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(c.matrixAutoUpdate=!1),this.system!==null&&(c.ps=this.system.toJSON(r,o)),this.children.length>0){c.children=[];for(var u=0;u<this.children.length;u++)this.children[u].type!=="ParticleSystemPreview"&&c.children.push(this.children[u].toJSON(r).object)}if(a){var d=this.extractFromCache(r.geometries),f=this.extractFromCache(r.materials),p=this.extractFromCache(r.textures),g=this.extractFromCache(r.images);d.length>0&&(l.geometries=d),f.length>0&&(l.materials=f),p.length>0&&(l.textures=p),g.length>0&&(l.images=g)}return l.object=c,l}}]),t}(ne),gw=function(){function s(i){Ne(this,s),N(this,"data",void 0),N(this,"next",void 0),N(this,"prev",void 0),this.data=i,this.next=null,this.prev=null}return ze(s,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),s}(),z7=function(){function s(){Ne(this,s),N(this,"length",void 0),N(this,"head",void 0),N(this,"tail",void 0),this.length=0,this.head=this.tail=null}return ze(s,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"pop",value:function(){if(this.tail){var t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"queue",value:function(t){var n=new gw(t);this.tail||(this.tail=n),this.head&&(this.head.prev=n,n.next=this.head),this.head=n,this.length++}},{key:"push",value:function(t){var n=new gw(t);this.head||(this.head=n),this.tail&&(this.tail.next=n,n.prev=this.tail),this.tail=n,this.length++}},{key:"insertBefore",value:function(t,n){var r=new gw(n);r.next=t,r.prev=t.prev,r.prev!==null&&(r.prev.next=r),r.next.prev=r,t==this.head&&(this.head=r),this.length++}},{key:"remove",value:function(t){if(!(this.head===null||this.tail===null)){var n=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);n.next!==null&&n.data!==t;)n=n.next;n.data===t&&(n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.length--)}}},{key:"values",value:aC().mark(function i(){var t;return aC().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this.head;case 1:if(t===null){r.next=7;break}return r.next=4,t.data;case 4:t=t.next,r.next=1;break;case 7:case"end":return r.stop()}},i,this)})}]),s}(),am=function(){function s(){Ne(this,s),N(this,"parentMatrix",void 0),N(this,"startSpeed",0),N(this,"startColor",new Ue),N(this,"startSize",1),N(this,"position",new x),N(this,"velocity",new x),N(this,"age",0),N(this,"life",1),N(this,"size",1),N(this,"angularVelocity",void 0),N(this,"rotation",0),N(this,"color",new Ue),N(this,"uvTile",0)}return ze(s,[{key:"died",get:function(){return this.age>=this.life}}]),s}(),Q7=ze(function s(i,t,n){Ne(this,s),this.position=i,this.size=t,this.color=n}),lm=function(){function s(){Ne(this,s),N(this,"parentMatrix",void 0),N(this,"startSpeed",0),N(this,"startColor",new Ue),N(this,"startSize",1),N(this,"position",new x),N(this,"localPosition",void 0),N(this,"velocity",new x),N(this,"age",0),N(this,"life",1),N(this,"size",1),N(this,"length",100),N(this,"color",new Ue),N(this,"previous",new z7),N(this,"uvTile",0)}return ze(s,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new Q7(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),s}(),ps=function(){function s(i){Ne(this,s),N(this,"type",void 0),this.value=i,this.type="value"}return ze(s,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new s(this.value)}}],[{key:"fromJSON",value:function(t){return new s(t.value)}}]),s}(),ub=function(){function s(i,t){Ne(this,s),N(this,"type",void 0),this.a=i,this.b=t,this.type="value"}return ze(s,[{key:"genValue",value:function(){return ct.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new s(this.a,this.b)}}],[{key:"fromJSON",value:function(t){return new s(t.a,t.b)}}]),s}(),j7=function(){function s(){Ne(this,s),N(this,"functions",void 0),this.functions=new Array}return ze(s,[{key:"findFunction",value:function(t){for(var n=0,r=0,o=this.functions.length-1;r+1<o;)if(n=Math.floor((r+o)/2),t<this.getStartX(n))o=n-1;else if(t>this.getEndX(n))r=n+1;else return n;for(var a=r;a<=o;a++)if(t>=this.functions[a][1]&&t<=this.getEndX(a))return a;return-1}},{key:"getStartX",value:function(t){return this.functions[t][1]}},{key:"setStartX",value:function(t,n){t>0&&(this.functions[t][1]=n)}},{key:"getEndX",value:function(t){return t+1<this.functions.length?this.functions[t+1][1]:1}},{key:"setEndX",value:function(t,n){t+1<this.functions.length&&(this.functions[t+1][1]=n)}},{key:"insertFunction",value:function(t,n){var r=this.findFunction(t);this.functions.splice(r+1,0,[n,t])}},{key:"removeFunction",value:function(t){return this.functions.splice(t,1)[0][0]}},{key:"getFunction",value:function(t){return this.functions[t][0]}},{key:"setFunction",value:function(t,n){this.functions[t][0]=n}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),s}(),cC=function(){function s(i,t,n,r){Ne(this,s),N(this,"p",void 0),this.p=[i,t,n,r]}return ze(s,[{key:"genValue",value:function(t){var n=t*t,r=t*t*t,o=1-t,a=o*o,l=a*o;return this.p[0]*l+this.p[1]*a*t*3+this.p[2]*o*n*3+this.p[3]*r}},{key:"derivativeCoefficients",value:function(t){for(var n=[],r=t,o=r.length-1;o>0;o--){for(var a=[],l=0;l<o;l++){var c=o*(r[l+1]-r[l]);a.push(c)}n.push(a),r=a}return n}},{key:"getSlope",value:function(t){var n=this.derivativeCoefficients(this.p)[0],r=1-t,o=r*r,a=r*t*2,l=t*t;return o*n[0]+a*n[1]+l*n[2]}},{key:"controlCurve",value:function(t,n){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-n/3}},{key:"hull",value:function(t){var n=this.p,r=[],o,a=0,l=0,c=0,u=[];for(u[a++]=n[0],u[a++]=n[1],u[a++]=n[2],u[a++]=n[3];n.length>1;){for(r=[],l=0,c=n.length-1;l<c;l++)o=t*n[l]+(1-t)*n[l+1],u[a++]=o,r.push(o);n=r}return u}},{key:"split",value:function(t){var n=this.hull(t),r={left:new s(n[0],n[4],n[7],n[9]),right:new s(n[9],n[8],n[6],n[3]),span:n};return r}},{key:"clone",value:function(){return new s(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(t){return new s(t.p0,t.p1,t.p2,t.p3)}}]),s}(),G7=function(s){$f(t,s);var i=ep(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new cC(0,.3333333333333333,.6666666666666666,1),0]];return Ne(this,t),n=i.call(this),N(lt(n),"type",void 0),n.type="function",n.functions=r,n}return ze(t,[{key:"genValue",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=this.findFunction(r);return o===-1?0:this.functions[o][0].genValue((r-this.getStartX(o))/(this.getEndX(o)-this.getStartX(o)))}},{key:"toSVG",value:function(r,o){if(o<1)return"";for(var a=["M",0,this.functions[0][0].p[0]].join(" "),l=1/o;l<=1;l+=1/o)a=[a,"L",l*r,this.genValue(l)].join(" ");return a}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(r){var o=mf(r,2),a=o[0],l=o[1];return{function:a.toJSON(),start:l}})}}},{key:"clone",value:function(){return new t(this.functions.map(function(r){var o=mf(r,2),a=o[0],l=o[1];return[a.clone(),l]}))}}],[{key:"fromJSON",value:function(r){return new t(r.functions.map(function(o){return[cC.fromJSON(o.function),o.start]}))}}]),t}(j7);function $t(s){switch(s.type){case"ConstantValue":return ps.fromJSON(s);case"IntervalValue":return ub.fromJSON(s);case"PiecewiseBezier":return G7.fromJSON(s);default:return new ps(0)}}var cm=function(i){return{r:i.x,g:i.y,b:i.z,a:i.w}},hm=function(i){return new Ue(i.r,i.g,i.b,i.a)},H7=function(i,t){switch(t){case"Vector3":return new x(i.x,i.y,i.z);case"Vector4":return new Ue(i.x,i.y,i.z,i.w);case"Color":return new x(i.r,i.g,i.b);case"Number":return i;default:return i}},V7=function(i,t){switch(t){case"Vector3":return{x:i.x,y:i.y,z:i.z};case"Vector4":return{x:i.x,y:i.y,z:i.z,w:i.w};case"Color":return{r:i.x,g:i.y,b:i.z};case"Number":return i;default:return i}},W7=function(){function s(i,t){Ne(this,s),N(this,"type",void 0),this.a=i,this.b=t,this.type="value"}return ze(s,[{key:"genColor",value:function(t){var n=Math.random();return t.copy(this.a).lerp(this.b,n)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:cm(this.a),b:cm(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(hm(t.a),hm(t.b))}}]),s}(),hC=function(){function s(i,t){Ne(this,s),N(this,"type",void 0),this.a=i,this.b=t,this.type="function"}return ze(s,[{key:"genColor",value:function(t,n){return t.copy(this.a).lerp(this.b,n)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:cm(this.a),b:cm(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(hm(t.a),hm(t.b))}}]),s}(),nv=function(){function s(i,t){Ne(this,s),N(this,"keys",void 0),N(this,"type",void 0),N(this,"subType",void 0),this.subType=t,this.type="function",this.keys=i}return ze(s,[{key:"findKey",value:function(t){for(var n=0,r=0,o=this.keys.length-1;r+1<o;)if(n=Math.floor((r+o)/2),t<this.getStartX(n))o=n-1;else if(t>this.getEndX(n))r=n+1;else return n;for(var a=r;a<=o;a++)if(t>=this.getStartX(a)&&t<=this.getEndX(a))return a;return-1}},{key:"getStartX",value:function(t){return this.keys[t][1]}},{key:"getEndX",value:function(t){return t+1<this.keys.length?this.keys[t+1][1]:1}},{key:"genValue",value:function(t,n){var r=this.findKey(n);return this.subType==="Number"?r===-1?this.keys[0][0]:r+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[r+1][0]-this.keys[r][0])*((n-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))+this.keys[r][0]:r===-1?t.copy(this.keys[0][0]):r+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[r][0]).lerp(this.keys[r+1][0],(n-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toJSON",value:function(){var t=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(n){var r=mf(n,2),o=r[0],a=r[1];return{value:V7(o,t.subType),pos:a}})}}},{key:"clone",value:function(){return this.subType==="Number"?new s(this.keys.map(function(t){var n=mf(t,2),r=n[0],o=n[1];return[r,o]}),this.subType):new s(this.keys.map(function(t){var n=mf(t,2),r=n[0],o=n[1];return[r.clone(),o]}),this.subType)}}],[{key:"fromJSON",value:function(t){return new s(t.keys.map(function(n){return[H7(n.value,t.subType),n.pos]}),t.subType)}}]),s}(),sv=new x,uC=function(){function s(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new x(0,0,0),0],[new x(1,1,1),0]],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Ne(this,s),N(this,"type",void 0),N(this,"color",void 0),N(this,"alpha",void 0),this.type="function",this.color=new nv(i,"Color"),this.alpha=new nv(t,"Number")}return ze(s,[{key:"genColor",value:function(t,n){return this.color.genValue(sv,n),t.set(sv.x,sv.y,sv.z,this.alpha.genValue(1,n))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var t=new s;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}}],[{key:"fromJSON",value:function(t){if(t.functions){var n=t.functions.map(function(o){return[hC.fromJSON(o.function).a,o.start]});return t.functions.length>0&&n.push([hC.fromJSON(t.functions[t.functions.length-1].function).b,1]),new s(n.map(function(o){return[new x(o[0].x,o[0].y,o[0].z),o[1]]}),n.map(function(o){return[o[0].w,o[1]]}))}else{var r=new s;return r.alpha=nv.fromJSON(t.alpha),r.color=nv.fromJSON(t.color),r}}}]),s}(),mw=new Ue,q7=function(){function s(i,t){Ne(this,s),N(this,"gradient1",void 0),N(this,"gradient2",void 0),N(this,"type",void 0),this.type="memorizedFunction",this.gradient1=i,this.gradient2=t}return ze(s,[{key:"startGen",value:function(t){t.rand=Math.random()}},{key:"genColor",value:function(t,n,r){return this.gradient1.genColor(t,n),this.gradient2.genColor(mw,n),r&&r.rand?t.lerp(mw,r.rand):t.lerp(mw,Math.random()),t}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new s(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(t){return new s(uC.fromJSON(t.gradient1),uC.fromJSON(t.gradient2))}}]),s}(),Fy=function(){function s(i){Ne(this,s),N(this,"type",void 0),this.color=i,this.type="value"}return ze(s,[{key:"genColor",value:function(t){return t.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:cm(this.color)}}},{key:"clone",value:function(){return new s(this.color.clone())}}],[{key:"fromJSON",value:function(t){return new s(hm(t.color))}}]),s}();function ME(s){switch(s.type){case"ConstantColor":return Fy.fromJSON(s);case"ColorRange":return hC.fromJSON(s);case"RandomColor":return W7.fromJSON(s);case"Gradient":return uC.fromJSON(s);case"RandomColorBetweenGradient":return q7.fromJSON(s);default:return new Fy(new Ue(1,1,1,1))}}var aB=function(){function s(){Ne(this,s),N(this,"type",void 0),this.type="rotation"}return ze(s,[{key:"genValue",value:function(t,n){var r,o,a,l,c,u;do r=Math.random()*2-1,o=Math.random()*2-1,a=r*r+o*o;while(a>1);do l=Math.random()*2-1,c=Math.random()*2-1,u=l*l+c*c;while(u>1);var d=Math.sqrt((1-a)/u);return t.set(r,o,d*l,d*c),t}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),j2=function(){function s(i,t){Ne(this,s),N(this,"type",void 0),this.axis=i,this.angle=t,this.type="rotation"}return ze(s,[{key:"genValue",value:function(t,n){return t.setFromAxisAngle(this.axis,this.angle.genValue(n))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(t){return new s(t.axis,$t(t.angle))}}]),s}(),X7=function(){function s(i,t,n){Ne(this,s),N(this,"type",void 0),this.angleX=i,this.angleY=t,this.angleZ=n,this.type="rotation"}return ze(s,[{key:"genValue",value:function(t,n){return t.setFromEuler(new Gt(this.angleX.genValue(n),this.angleY.genValue(n),this.angleZ.genValue(n)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new s(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(t){return new s($t(t.angleX),$t(t.angleY),$t(t.angleZ))}}]),s}();function G2(s){switch(s.type){case"AxisAngle":return j2.fromJSON(s);case"Euler":return X7.fromJSON(s);case"RandomQuat":return aB.fromJSON(s);default:return new aB}}function Y7(s){switch(s.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return $t(s);case"AxisAngle":case"RandomQuat":case"Euler":return G2(s);default:return new ps(0)}}var lB=function(){function s(i){Ne(this,s),N(this,"type","ColorOverLife"),this.color=i}return ze(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,n){this.color.type==="memorizedFunction"?this.color.genColor(t.color,t.age/t.life,t.colorOverLifeMemory):this.color.genColor(t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(ME(t.color))}}]),s}(),cB=function(){function s(i,t){Ne(this,s),N(this,"type","RotationOverLife"),N(this,"tempQuat",new se),this.angularVelocity=i,this.dynamic=t}return ze(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof am&&(t.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(t,n){this.dynamic?t.rotation+=n*this.angularVelocity.genValue(t.age/t.life):t instanceof am&&(t.rotation+=n*t.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.angularVelocity),t.dynamic)}}]),s}(),hB=function(){function s(i){Ne(this,s),N(this,"type","SizeOverLife"),this.size=i}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.size=t.startSize*this.size.genValue(t.age/t.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.size))}}]),s}(),uB=function(){function s(i){Ne(this,s),N(this,"type","SpeedOverLife"),this.speed=i}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.velocity.normalize().multiplyScalar(t.startSpeed*this.speed.genValue(t.age/t.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.speed))}}]),s}(),dB=function(){function s(i,t){Ne(this,s),N(this,"type","RotationBySpeed"),N(this,"tempQuat",new se),this.angularVelocity=i,this.speedRange=t}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){var r=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=n*this.angularVelocity.genValue(r)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.angularVelocity),ub.fromJSON(t.speedRange))}}]),s}(),fB=function(){function s(i,t){Ne(this,s),N(this,"type","SizeBySpeed"),this.size=i,this.speedRange=t}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){var n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.size=t.startSize*this.size.genValue(n)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.size),ub.fromJSON(t.speedRange))}}]),s}(),pB=function(){function s(i,t){Ne(this,s),N(this,"type","ColorBySpeed"),this.color=i,this.speedRange=t}return ze(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,n){var r=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(t.color,r,t.colorOverLifeMemory):this.color.genColor(t.color,r),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(ME(t.color),ub.fromJSON(t.speedRange))}}]),s}(),gB=function(){function s(i){Ne(this,s),N(this,"type","FrameOverLife"),this.frame=i}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){t.uvTile=Math.floor(this.frame.genValue(t.age/t.life))}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new s(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.frame))}}]),s}();new x(0,0,1);var mB=function(){function s(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new x(0,1,0);Ne(this,s),N(this,"type","OrbitOverLife"),N(this,"rotation",void 0),N(this,"line",void 0),N(this,"temp",new x),this.orbitSpeed=i,this.axis=t,this.rotation=new se,this.line=new OC}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){this.line.set(new x(0,0,0),this.axis),this.line.closestPointToPoint(t.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.age/t.life)*n),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new s(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.orbitSpeed),t.axis?new x(t.axis[0],t.axis[1],t.axis[2]):void 0)}}]),s}(),AB=function(){function s(i,t){Ne(this,s),N(this,"type","ApplyForce"),N(this,"magnitudeValue",void 0),this.direction=i,this.magnitude=t,this.magnitudeValue=this.magnitude.genValue()}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){t.velocity.addScaledVector(this.direction,this.magnitudeValue*n)}},{key:"frameUpdate",value:function(t){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new s(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){var n;return new s(new x(t.direction[0],t.direction[1],t.direction[2]),$t((n=t.magnitude)!==null&&n!==void 0?n:t.force))}}]),s}(),vB=function(){function s(i,t){Ne(this,s),N(this,"type","GravityForce"),N(this,"temp",new x),this.center=i,this.magnitude=t}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*n)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new s(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new x(t.center[0],t.center[1],t.center[2]),t.magnitude)}}]),s}(),yB=function(){function s(i){Ne(this,s),N(this,"type","WidthOverLength"),this.width=i}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){if(t instanceof lm)for(var n=t.previous.values(),r=0;r<t.previous.length;r++){var o=n.next();o.value.size=this.width.genValue((t.previous.length-r)/t.length)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new s(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.width))}}]),s}();new x(0,0,1);var bB=function(){function s(i){Ne(this,s),N(this,"type","ChangeEmitDirection"),N(this,"_temp",new x),N(this,"_q",new se),this.angle=i}return ze(s,[{key:"initialize",value:function(t){var n=t.velocity.length();n!=0&&(t.velocity.normalize(),t.velocity.x===0&&t.velocity.y===0?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(n))}},{key:"update",value:function(t,n){}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.angle))}}]),s}(),K7=new x(1,1,1),_B=new x(0,0,1),wB=function(){function s(i,t,n){Ne(this,s),N(this,"type","EmitSubParticleSystem"),N(this,"q_",new se),N(this,"v_",new x),N(this,"v2_",new x),this.particleSystem=i,this.useVelocityAsBasis=t,this.subParticleSystem=n,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return ze(s,[{key:"initialize",value:function(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new le}}},{key:"update",value:function(t,n){if(!(!this.subParticleSystem||!t.emissionState)){var r=t.emissionState.matrix,o;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))r.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(_B).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);var a=this.v_.length(),l=this.v2_.length();r.set(this.v_.x/a,this.v2_.x/l,t.velocity.x,t.position.x,this.v_.y/a,this.v2_.y/l,t.velocity.y,t.position.y,this.v_.z/a,this.v2_.z/l,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof se?o=t.rotation:(this.q_.setFromAxisAngle(_B,t.rotation),o=this.q_),r.compose(t.position,o,K7);this.particleSystem.worldSpace||r.multiplyMatrices(this.particleSystem.emitter.matrixWorld,r),this.subParticleSystem.system.emit(n,t.emissionState,r)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new s(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t,n){return new s(n,t.useVelocityAsBasis,t.subParticleSystem)}}]),s}(),J7=.5*(Math.sqrt(3)-1),Bp=(3-Math.sqrt(3))/6,Z7=1/3,Aa=1/6,$7=(Math.sqrt(5)-1)/4,zn=(5-Math.sqrt(5))/20,pn=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Vi=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),H2=function(){function s(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Ne(this,s),N(this,"p",void 0),N(this,"perm",void 0),N(this,"permMod12",void 0);var t=typeof i=="function"?i:tq(i);this.p=eq(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[n&255],this.permMod12[n]=this.perm[n]%12}return ze(s,[{key:"noise2D",value:function(t,n){var r=this.permMod12,o=this.perm,a=0,l=0,c=0,u=(t+n)*J7,d=Math.floor(t+u),f=Math.floor(n+u),p=(d+f)*Bp,g=d-p,m=f-p,A=t-g,y=n-m,b,_;A>y?(b=1,_=0):(b=0,_=1);var w=A-b+Bp,S=y-_+Bp,E=A-1+2*Bp,I=y-1+2*Bp,k=d&255,T=f&255,P=.5-A*A-y*y;if(P>=0){var B=r[k+o[T]]*3;P*=P,a=P*P*(pn[B]*A+pn[B+1]*y)}var M=.5-w*w-S*S;if(M>=0){var U=r[k+b+o[T+_]]*3;M*=M,l=M*M*(pn[U]*w+pn[U+1]*S)}var G=.5-E*E-I*I;if(G>=0){var W=r[k+1+o[T+1]]*3;G*=G,c=G*G*(pn[W]*E+pn[W+1]*I)}return 70*(a+l+c)}},{key:"noise3D",value:function(t,n,r){var o=this.permMod12,a=this.perm,l,c,u,d,f=(t+n+r)*Z7,p=Math.floor(t+f),g=Math.floor(n+f),m=Math.floor(r+f),A=(p+g+m)*Aa,y=p-A,b=g-A,_=m-A,w=t-y,S=n-b,E=r-_,I,k,T,P,B,M;w>=S?S>=E?(I=1,k=0,T=0,P=1,B=1,M=0):w>=E?(I=1,k=0,T=0,P=1,B=0,M=1):(I=0,k=0,T=1,P=1,B=0,M=1):S<E?(I=0,k=0,T=1,P=0,B=1,M=1):w<E?(I=0,k=1,T=0,P=0,B=1,M=1):(I=0,k=1,T=0,P=1,B=1,M=0);var U=w-I+Aa,G=S-k+Aa,W=E-T+Aa,Y=w-P+2*Aa,D=S-B+2*Aa,L=E-M+2*Aa,V=w-1+3*Aa,te=S-1+3*Aa,K=E-1+3*Aa,ue=p&255,de=g&255,_e=m&255,Ee=.6-w*w-S*S-E*E;if(Ee<0)l=0;else{var Xe=o[ue+a[de+a[_e]]]*3;Ee*=Ee,l=Ee*Ee*(pn[Xe]*w+pn[Xe+1]*S+pn[Xe+2]*E)}var Me=.6-U*U-G*G-W*W;if(Me<0)c=0;else{var Ke=o[ue+I+a[de+k+a[_e+T]]]*3;Me*=Me,c=Me*Me*(pn[Ke]*U+pn[Ke+1]*G+pn[Ke+2]*W)}var Pt=.6-Y*Y-D*D-L*L;if(Pt<0)u=0;else{var Tt=o[ue+P+a[de+B+a[_e+M]]]*3;Pt*=Pt,u=Pt*Pt*(pn[Tt]*Y+pn[Tt+1]*D+pn[Tt+2]*L)}var hi=.6-V*V-te*te-K*K;if(hi<0)d=0;else{var Ei=o[ue+1+a[de+1+a[_e+1]]]*3;hi*=hi,d=hi*hi*(pn[Ei]*V+pn[Ei+1]*te+pn[Ei+2]*K)}return 32*(l+c+u+d)}},{key:"noise4D",value:function(t,n,r,o){var a=this.perm,l,c,u,d,f,p=(t+n+r+o)*$7,g=Math.floor(t+p),m=Math.floor(n+p),A=Math.floor(r+p),y=Math.floor(o+p),b=(g+m+A+y)*zn,_=g-b,w=m-b,S=A-b,E=y-b,I=t-_,k=n-w,T=r-S,P=o-E,B=0,M=0,U=0,G=0;I>k?B++:M++,I>T?B++:U++,I>P?B++:G++,k>T?M++:U++,k>P?M++:G++,T>P?U++:G++;var W=B>=3?1:0,Y=M>=3?1:0,D=U>=3?1:0,L=G>=3?1:0,V=B>=2?1:0,te=M>=2?1:0,K=U>=2?1:0,ue=G>=2?1:0,de=B>=1?1:0,_e=M>=1?1:0,Ee=U>=1?1:0,Xe=G>=1?1:0,Me=I-W+zn,Ke=k-Y+zn,Pt=T-D+zn,Tt=P-L+zn,hi=I-V+2*zn,Ei=k-te+2*zn,Ps=T-K+2*zn,Wr=P-ue+2*zn,ss=I-de+3*zn,Ar=k-_e+3*zn,qr=T-Ee+3*zn,Xr=P-Xe+3*zn,Ro=I-1+4*zn,Bo=k-1+4*zn,Yr=T-1+4*zn,vr=P-1+4*zn,Dn=g&255,er=m&255,yr=A&255,rs=y&255,Ms=.6-I*I-k*k-T*T-P*P;if(Ms<0)l=0;else{var ks=a[Dn+a[er+a[yr+a[rs]]]]%32*4;Ms*=Ms,l=Ms*Ms*(Vi[ks]*I+Vi[ks+1]*k+Vi[ks+2]*T+Vi[ks+3]*P)}var On=.6-Me*Me-Ke*Ke-Pt*Pt-Tt*Tt;if(On<0)c=0;else{var Zi=a[Dn+W+a[er+Y+a[yr+D+a[rs+L]]]]%32*4;On*=On,c=On*On*(Vi[Zi]*Me+Vi[Zi+1]*Ke+Vi[Zi+2]*Pt+Vi[Zi+3]*Tt)}var os=.6-hi*hi-Ei*Ei-Ps*Ps-Wr*Wr;if(os<0)u=0;else{var tr=a[Dn+V+a[er+te+a[yr+K+a[rs+ue]]]]%32*4;os*=os,u=os*os*(Vi[tr]*hi+Vi[tr+1]*Ei+Vi[tr+2]*Ps+Vi[tr+3]*Wr)}var as=.6-ss*ss-Ar*Ar-qr*qr-Xr*Xr;if(as<0)d=0;else{var un=a[Dn+de+a[er+_e+a[yr+Ee+a[rs+Xe]]]]%32*4;as*=as,d=as*as*(Vi[un]*ss+Vi[un+1]*Ar+Vi[un+2]*qr+Vi[un+3]*Xr)}var zt=.6-Ro*Ro-Bo*Bo-Yr*Yr-vr*vr;if(zt<0)f=0;else{var yt=a[Dn+1+a[er+1+a[yr+1+a[rs+1]]]]%32*4;zt*=zt,f=zt*zt*(Vi[yt]*Ro+Vi[yt+1]*Bo+Vi[yt+2]*Yr+Vi[yt+3]*vr)}return 27*(l+c+u+d+f)}}]),s}();function eq(s){for(var i=new Uint8Array(256),t=0;t<256;t++)i[t]=t;for(var n=0;n<255;n++){var r=n+~~(s()*(256-n)),o=i[n];i[n]=i[r],i[r]=o}return i}function tq(s){var i=0,t=0,n=0,r=1,o=iq();return i=o(" "),t=o(" "),n=o(" "),i-=o(s),i<0&&(i+=1),t-=o(s),t<0&&(t+=1),n-=o(s),n<0&&(n+=1),function(){var a=2091639*i+r*23283064365386963e-26;return i=t,t=n,n=a-(r=a|0)}}function iq(){var s=4022871197;return function(i){i=i.toString();for(var t=0;t<i.length;t++){s+=i.charCodeAt(t);var n=.02519603282416938*s;s=n>>>0,n-=s,n*=s,s=n>>>0,n-=s,s+=n*4294967296}return(s>>>0)*23283064365386963e-26}}var xB=function(){function s(i,t,n,r){Ne(this,s),N(this,"type","TurbulenceField"),N(this,"generator",new H2),N(this,"timeOffset",new x),N(this,"temp",new x),N(this,"temp2",new x),this.scale=i,this.octaves=t,this.velocityMultiplier=n,this.timeScale=r,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,n){var r=t.position.x/this.scale.x,o=t.position.y/this.scale.y,a=t.position.z/this.scale.z;this.temp.set(0,0,0);for(var l=1,c=0;c<this.octaves;c++)this.temp2.set(this.generator.noise4D(r*l,o*l,a*l,this.timeOffset.x*l)/l,this.generator.noise4D(r*l,o*l,a*l,this.timeOffset.y*l)/l,this.generator.noise4D(r*l,o*l,a*l,this.timeOffset.z*l)/l),this.temp.add(this.temp2),l*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,n)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}},{key:"clone",value:function(){return new s(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new x(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new x(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new x(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}}]),s}(),CB=new se,SB=function(){function s(i,t){Ne(this,s),N(this,"type","Rotation3DOverLife"),N(this,"tempQuat",new se),this.angularVelocity=i,this.dynamic=t}return ze(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof am&&(t.angularVelocity=new se,this.angularVelocity.genValue(t.angularVelocity))}},{key:"update",value:function(t,n){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,t.age/t.life),this.tempQuat.slerpQuaternions(CB,this.tempQuat,n),t.rotation.multiply(this.tempQuat)):t instanceof am&&(this.tempQuat.slerpQuaternions(CB,t.angularVelocity,n),t.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(G2(t.angularVelocity),t.dynamic)}}]),s}(),EB=function(){function s(i,t,n){Ne(this,s),N(this,"type","ForceOverLife"),N(this,"_temp",new x),this.x=i,this.y=t,this.z=n}return ze(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){this._temp.set(this.x.genValue(t.age/t.life),this.y.genValue(t.age/t.life),this.z.genValue(t.age/t.life)),t.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s($t(t.x),$t(t.y),$t(t.z))}}]),s}(),IB=function(){function s(i,t){Ne(this,s),N(this,"type","Noise"),N(this,"generator",new H2),N(this,"duration",0),N(this,"temp",new x),this.frequency=i,this.power=t}return ze(s,[{key:"initialize",value:function(t){t.startTime=this.duration}},{key:"update",value:function(t,n){this.temp.set(this.generator.noise2D(t.startTime*this.frequency.x,t.life/t.age*this.frequency.x),this.generator.noise2D(t.startTime*this.frequency.y+100.25,t.life/t.age*this.frequency.y+100.154),this.generator.noise2D(t.startTime*this.frequency.z+200.89,t.life/t.age*this.frequency.z+200.1)).multiply(this.power),t.position.addScaledVector(this.temp,n)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(t){this.duration+=t}},{key:"clone",value:function(){return new s(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new x(t.frequency[0],t.frequency[1],t.frequency[2]),new x(t.power[0],t.power[1],t.power[2]))}}]),s}(),nq={ApplyForce:{type:"ApplyForce",constructor:AB,params:[["direction","vec3"],["magnitude","value"]],loadJSON:AB.fromJSON},Noise:{type:"Noise",constructor:IB,params:[["frequency","vec3"],["power","vec3"]],loadJSON:IB.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:xB,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:xB.fromJSON},GravityForce:{type:"GravityForce",constructor:vB,params:[["center","vec3"],["magnitude","number"]],loadJSON:vB.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:lB,params:[["color","colorFunc"]],loadJSON:lB.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:cB,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:cB.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:SB,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:SB.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:hB,params:[["size","valueFunc"]],loadJSON:hB.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:pB,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:pB.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:dB,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:dB.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:fB,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:fB.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:uB,params:[["speed","valueFunc"]],loadJSON:uB.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:gB,params:[["frame","valueFunc"]],loadJSON:gB.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:EB,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:EB.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:mB,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:mB.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:yB,params:[["width","valueFunc"]],loadJSON:yB.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:bB,params:[["angle","value"]],loadJSON:bB.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:wB,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:wB.fromJSON}};function sq(s,i){return nq[s.type].loadJSON(s,i)}var TB=function(){function s(){var i,t,n,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ne(this,s),N(this,"type","cone"),N(this,"radius",void 0),N(this,"arc",void 0),N(this,"thickness",void 0),N(this,"angle",void 0),this.radius=(i=o.radius)!==null&&i!==void 0?i:10,this.arc=(t=o.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(n=o.thickness)!==null&&n!==void 0?n:1,this.angle=(r=o.angle)!==null&&r!==void 0?r:Math.PI/6}return ze(s,[{key:"initialize",value:function(t){var n=Math.random(),r=ct.lerp(1-this.thickness,1,Math.random()),o=n*this.arc,a=Math.sqrt(r),l=Math.sin(o),c=Math.cos(o);t.position.x=a*c,t.position.y=a*l,t.position.z=0;var u=this.angle*a;t.velocity.set(0,0,Math.cos(u)).addScaledVector(t.position,Math.sin(u)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),RB=function(){function s(){var i,t,n,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ne(this,s),N(this,"type","donut"),N(this,"radius",void 0),N(this,"arc",void 0),N(this,"thickness",void 0),N(this,"angle",void 0),this.radius=(i=o.radius)!==null&&i!==void 0?i:10,this.arc=(t=o.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(n=o.thickness)!==null&&n!==void 0?n:1,this.angle=(r=o.angle)!==null&&r!==void 0?r:Math.PI/6}return ze(s,[{key:"initialize",value:function(t){var n=Math.random(),r=ct.lerp(this.thickness,1,Math.random()),o=n*this.arc,a=Math.sqrt(r),l=Math.sin(o),c=Math.cos(o);t.position.x=a*c,t.position.y=a*l,t.position.z=0;var u=this.angle*a;t.velocity.set(0,0,Math.cos(u)).addScaledVector(t.position,Math.sin(u)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),BB=function(){function s(){Ne(this,s),N(this,"type","point")}return ze(s,[{key:"initialize",value:function(t){var n=Math.random(),r=Math.random(),o=n*Math.PI*2,a=Math.acos(2*r-1),l=Math.cbrt(Math.random()),c=Math.sin(o),u=Math.cos(o),d=Math.sin(a),f=Math.cos(a);t.velocity.x=l*d*u,t.velocity.y=l*d*c,t.velocity.z=l*f,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),dC=function(){function s(){var i,t,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ne(this,s),N(this,"type","sphere"),N(this,"radius",void 0),N(this,"arc",void 0),N(this,"thickness",void 0),this.radius=(i=r.radius)!==null&&i!==void 0?i:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(n=r.thickness)!==null&&n!==void 0?n:1}return ze(s,[{key:"initialize",value:function(t){var n=Math.random(),r=Math.random(),o=ct.lerp(1-this.thickness,1,Math.random()),a=n*this.arc,l=Math.acos(2*r-1),c=Math.cbrt(o),u=Math.sin(a),d=Math.cos(a),f=Math.sin(l),p=Math.cos(l);t.position.x=c*f*d,t.position.y=c*f*u,t.position.z=c*p,t.velocity.setScalar(0).addScaledVector(t.position,t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),PB=function(){function s(i){Ne(this,s),N(this,"type","mesh_surface"),N(this,"_triangleIndexToArea",[]),N(this,"_geometry",void 0),N(this,"_tempA",new x),N(this,"_tempB",new x),N(this,"_tempC",new x),i&&(this.geometry=i)}return ze(s,[{key:"geometry",get:function(){return this._geometry},set:function(t){if(this._geometry=t,t!==void 0&&typeof t!="string"){var n=new zP;this._triangleIndexToArea.length=0;var r=0;if(t.getIndex()){var o=t.getIndex().array,a=o.length/3;this._triangleIndexToArea.push(0);for(var l=0;l<a;l++)n.setFromAttributeAndIndices(t.getAttribute("position"),o[l*3],o[l*3+1],o[l*3+2]),r+=n.getArea(),this._triangleIndexToArea.push(r);t.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(t){var n=this._geometry;if(!n||n.getIndex()===null){t.position.set(0,0,0),t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);return}for(var r=this._triangleIndexToArea.length-1,o=0,a=r,l=Math.random()*this._triangleIndexToArea[r];o+1<a;){var c=Math.floor((o+a)/2);l<this._triangleIndexToArea[c]?a=c:o=c}var u=Math.random(),d=Math.random();u+d>1&&(u=1-u,d=1-d);var f=n.getIndex().array[o*3],p=n.getIndex().array[o*3+1],g=n.getIndex().array[o*3+2],m=n.getAttribute("position");this._tempA.fromBufferAttribute(m,f),this._tempB.fromBufferAttribute(m,p),this._tempC.fromBufferAttribute(m,g),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,u).addScaledVector(this._tempC,d),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new s(this._geometry)}}],[{key:"fromJSON",value:function(t,n){return new s(n.geometries[t.geometry])}}]),s}(),MB=function(){function s(){var i,t,n,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ne(this,s),N(this,"type","grid"),N(this,"width",void 0),N(this,"height",void 0),N(this,"column",void 0),N(this,"row",void 0),this.width=(i=o.width)!==null&&i!==void 0?i:1,this.height=(t=o.height)!==null&&t!==void 0?t:1,this.column=(n=o.column)!==null&&n!==void 0?n:10,this.row=(r=o.row)!==null&&r!==void 0?r:10}return ze(s,[{key:"initialize",value:function(t){var n=Math.floor(Math.random()*this.row),r=Math.floor(Math.random()*this.column);t.position.x=r*this.width/this.column-this.width/2,t.position.y=n*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new s({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),rq={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:TB,loadJSON:TB.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:RB,loadJSON:RB.fromJSON},point:{type:"point",params:[],constructor:BB,loadJSON:BB.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:dC,loadJSON:dC.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:MB,loadJSON:MB.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:PB,loadJSON:PB.fromJSON}};function oq(s,i){return rq[s.type].loadJSON(s,i)}var we=function(s){return s[s.BillBoard=0]="BillBoard",s[s.StretchedBillBoard=1]="StretchedBillBoard",s[s.Mesh=2]="Mesh",s[s.Trail=3]="Trail",s[s.HorizontalBillBoard=4]="HorizontalBillBoard",s[s.VerticalBillBoard=5]="VerticalBillBoard",s}({}),V2=function(s){$f(t,s);var i=ep(t);function t(n){var r;Ne(this,t),r=i.call(this),N(lt(r),"type","VFXBatch"),N(lt(r),"systems",void 0),N(lt(r),"settings",void 0),N(lt(r),"maxParticles",void 0),r.maxParticles=1e3,r.systems=new Set;var o=new mo;return o.mask=n.layers.mask,r.settings={instancingGeometry:n.instancingGeometry,renderMode:n.renderMode,renderOrder:n.renderOrder,material:n.material.clone(),uTileCount:n.uTileCount,vTileCount:n.vTileCount,layers:o},r.frustumCulled=!1,r.renderOrder=r.settings.renderOrder,r}return ze(t,[{key:"addSystem",value:function(r){this.systems.add(r)}},{key:"removeSystem",value:function(r){this.systems.delete(r)}}]),t}(Z),aq=new x(0,0,1),Aw=new se,lq=new x,cq=new x;new x;var kB=60,hq=new pr(1,1,1,1),uq=function(){function s(i){var t,n,r,o,a,l,c,u,d,f,p,g,m,A,y,b,_,w,S,E,I;Ne(this,s),N(this,"autoDestroy",void 0),N(this,"prewarm",void 0),N(this,"looping",void 0),N(this,"duration",void 0),N(this,"startLife",void 0),N(this,"startSpeed",void 0),N(this,"startRotation",void 0),N(this,"startSize",void 0),N(this,"startColor",void 0),N(this,"startTileIndex",void 0),N(this,"rendererEmitterSettings",void 0),N(this,"emissionOverTime",void 0),N(this,"emissionOverDistance",void 0),N(this,"emissionBursts",void 0),N(this,"onlyUsedByOther",void 0),N(this,"worldSpace",void 0),N(this,"speedFactor",void 0),N(this,"particleNum",void 0),N(this,"paused",void 0),N(this,"particles",void 0),N(this,"emitterShape",void 0),N(this,"emitter",void 0),N(this,"rendererSettings",void 0),N(this,"neededToUpdateRender",void 0),N(this,"behaviors",void 0),N(this,"prewarmed",void 0),N(this,"emissionState",void 0),N(this,"emitEnded",void 0),N(this,"markForDestroy",void 0),N(this,"previousWorldPos",void 0),N(this,"temp",new x),N(this,"travelDistance",0),N(this,"normalMatrix",new za),N(this,"_renderer",void 0),this.autoDestroy=i.autoDestroy===void 0?!1:i.autoDestroy,this.duration=(t=i.duration)!==null&&t!==void 0?t:1,this.looping=i.looping===void 0?!0:i.looping,this.prewarm=i.prewarm===void 0?!1:i.prewarm,this.startLife=(n=i.startLife)!==null&&n!==void 0?n:new ps(5),this.startSpeed=(r=i.startSpeed)!==null&&r!==void 0?r:new ps(0),this.startRotation=(o=i.startRotation)!==null&&o!==void 0?o:new ps(0),this.startSize=(a=i.startSize)!==null&&a!==void 0?a:new ps(1),this.startColor=(l=i.startColor)!==null&&l!==void 0?l:new Fy(new Ue(1,1,1,1)),this.emissionOverTime=(c=i.emissionOverTime)!==null&&c!==void 0?c:new ps(10),this.emissionOverDistance=(u=i.emissionOverDistance)!==null&&u!==void 0?u:new ps(0),this.emissionBursts=(d=i.emissionBursts)!==null&&d!==void 0?d:[],this.onlyUsedByOther=(f=i.onlyUsedByOther)!==null&&f!==void 0?f:!1,this.emitterShape=(p=i.shape)!==null&&p!==void 0?p:new dC,this.behaviors=(g=i.behaviors)!==null&&g!==void 0?g:new Array,this.worldSpace=(m=i.worldSpace)!==null&&m!==void 0?m:!1,this.speedFactor=(A=i.speedFactor)!==null&&A!==void 0?A:0,this.rendererEmitterSettings=(y=i.rendererEmitterSettings)!==null&&y!==void 0?y:{},this.rendererSettings={instancingGeometry:(b=i.instancingGeometry)!==null&&b!==void 0?b:hq,renderMode:(_=i.renderMode)!==null&&_!==void 0?_:we.BillBoard,renderOrder:(w=i.renderOrder)!==null&&w!==void 0?w:0,material:i.material,uTileCount:(S=i.uTileCount)!==null&&S!==void 0?S:1,vTileCount:(E=i.vTileCount)!==null&&E!==void 0?E:1,layers:(I=i.layers)!==null&&I!==void 0?I:new mo},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=i.startTileIndex||new ps(0),this.emitter=new N7(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return ze(s,[{key:"time",get:function(){return this.emissionState.time},set:function(t){this.emissionState.time=t}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(t){if((this.rendererSettings.renderMode!=we.Trail&&t===we.Trail||this.rendererSettings.renderMode==we.Trail&&t!==we.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==t)switch(t){case we.Trail:this.rendererEmitterSettings={startLength:new ps(30),followLocalOrigin:!1};break;case we.Mesh:this.rendererEmitterSettings={geometry:new pr(1,1)},this.startRotation=new j2(new x(0,1,0),new ps(0));break;case we.BillBoard:case we.VerticalBillBoard:case we.HorizontalBillBoard:case we.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===we.Mesh&&(this.startRotation=new ps(0));break}this.rendererSettings.renderMode=t,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(t,n,r){Aw.setFromRotationMatrix(r);var o=lq,a=Aw,l=cq;r.decompose(o,a,l);for(var c=0;c<t;c++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===we.Trail?this.particles.push(new lm):this.particles.push(new am);var u=this.particles[this.particleNum-1];if(this.startColor.genColor(u.startColor,this.emissionState.time,{}),u.color.copy(u.startColor),u.startSpeed=this.startSpeed.genValue(n.time/this.duration),u.life=this.startLife.genValue(n.time/this.duration),u.age=0,u.startSize=this.startSize.genValue(n.time/this.duration),u.uvTile=Math.floor(this.startTileIndex.genValue()),u.size=u.startSize,this.rendererSettings.renderMode===we.Mesh||this.rendererSettings.renderMode===we.BillBoard||this.rendererSettings.renderMode===we.VerticalBillBoard||this.rendererSettings.renderMode===we.HorizontalBillBoard||this.rendererSettings.renderMode===we.StretchedBillBoard){var d=u;this.rendererSettings.renderMode===we.Mesh?(d.rotation instanceof se||(d.rotation=new se),this.startRotation.type==="rotation"?this.startRotation.genValue(d.rotation,n.time/this.duration):d.rotation.setFromAxisAngle(aq,this.startRotation.genValue(n.time/this.duration))):this.startRotation.type==="rotation"?d.rotation=0:d.rotation=this.startRotation.genValue(n.time/this.duration)}else if(this.rendererSettings.renderMode===we.Trail){var f=u;f.length=this.rendererEmitterSettings.startLength.genValue(n.time/this.duration),f.reset()}if(this.emitterShape.initialize(u),this.rendererSettings.renderMode===we.Trail&&this.rendererEmitterSettings.followLocalOrigin){var p=u;p.localPosition=new x().copy(p.position)}this.worldSpace?(u.position.applyMatrix4(r),u.startSize=u.startSize*(Math.abs(l.x)+Math.abs(l.y)+Math.abs(l.z))/3,u.size=u.startSize,u.velocity.multiply(l).applyMatrix3(this.normalMatrix),u.rotation&&u.rotation instanceof se&&u.rotation.multiplyQuaternions(Aw,u.rotation)):this.onlyUsedByOther&&(u.parentMatrix=r);for(var g=0;g<this.behaviors.length;g++)this.behaviors[g].initialize(u)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(t){t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(t){if(!this.paused){for(var n=this.emitter;n.parent;)n=n.parent;if(n.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var r=0;r<this.duration*kB;r++)this.update(1/kB)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld);for(var o=0;o<this.behaviors.length;o++){for(var a=0;a<this.particleNum;a++)this.particles[a].died||this.behaviors[o].update(this.particles[a],t);this.behaviors[o].frameUpdate(t)}for(var l=0;l<this.particleNum;l++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[l].localPosition?(this.particles[l].position.copy(this.particles[l].localPosition),this.particles[l].parentMatrix?this.particles[l].position.applyMatrix4(this.particles[l].parentMatrix):this.particles[l].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[l].position.addScaledVector(this.particles[l].velocity,t),this.particles[l].age+=t;if(this.rendererSettings.renderMode===we.Trail)for(var c=0;c<this.particleNum;c++){var u=this.particles[c];u.update()}for(var d=0;d<this.particleNum;d++){var f=this.particles[d];f.died&&(!(f instanceof lm)||f.previous.length===0)&&(this.particles[d]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=f,this.particleNum--,d--)}}}},{key:"emit",value:function(t,n,r){n.time>this.duration&&(this.looping?(n.time-=this.duration,n.burstIndex=0,this.behaviors.forEach(function(u){u.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(r);var o=Math.ceil(n.waitEmiting);for(this.spawn(o,n,r),n.waitEmiting-=o;n.burstIndex<this.emissionBursts.length&&this.emissionBursts[n.burstIndex].time<=n.time;){if(Math.random()<this.emissionBursts[n.burstIndex].probability){var a=this.emissionBursts[n.burstIndex].count;this.spawn(a,n,r)}n.burstIndex++}if(!this.emitEnded&&(n.waitEmiting+=t*this.emissionOverTime.genValue(n.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var l=this.emissionOverDistance.genValue(n.time/this.duration);if(this.travelDistance*l>0){var c=Math.floor(this.travelDistance*l);this.travelDistance-=c/l,n.waitEmiting+=c}}this.previousWorldPos===void 0&&(this.previousWorldPos=new x),this.emitter.getWorldPosition(this.previousWorldPos),n.time+=t}},{key:"toJSON",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t===void 0||typeof t=="string";if(r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),n.useUrlForImage&&this.texture.source!==void 0){var o=this.texture.source;t.images[o.uuid]={uuid:o.uuid,url:this.texture.image.url}}var a;this.renderMode===we.Trail?a={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===we.Mesh?a={}:a={};var l=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[l.uuid]&&(t.geometries[l.uuid]=l.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:a,speedFactor:this.renderMode===we.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(c){return c.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(t){this.behaviors.push(t)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var t=[],n=oB(this.emissionBursts),r;try{for(n.s();!(r=n.n()).done;){var o=r.value,a={};Object.assign(a,o),t.push(a)}}catch(g){n.e(g)}finally{n.f()}var l=[],c=oB(this.behaviors),u;try{for(c.s();!(u=c.n()).done;){var d=u.value;l.push(d.clone())}}catch(g){c.e(g)}finally{c.f()}var f;this.renderMode===we.Trail?f={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:f={};var p=new mo;return p.mask=this.layers.mask,new s({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:f,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:l,worldSpace:this.worldSpace,layers:p})}}],[{key:"fromJSON",value:function(t,n,r){var o,a=oq(t.shape,n),l;t.renderMode===we.Trail?l={startLength:t.rendererEmitterSettings.startLength!=null?$t(t.rendererEmitterSettings.startLength):new ps(30),followLocalOrigin:t.rendererEmitterSettings.followLocalOrigin}:t.renderMode===we.Mesh?l={}:l={};var c=new mo;t.layers&&(c.mask=t.layers);var u=new s({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:a,startLife:$t(t.startLife),startSpeed:$t(t.startSpeed),startRotation:Y7(t.startRotation),startSize:$t(t.startSize),startColor:ME(t.startColor),emissionOverTime:$t(t.emissionOverTime),emissionOverDistance:$t(t.emissionOverDistance),emissionBursts:t.emissionBursts,onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:n.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:l,renderOrder:t.renderOrder,speedFactor:t.speedFactor,layers:c,material:t.material?n.materials[t.material]:t.texture?new _t({map:n.textures[t.texture],transparent:(o=t.transparent)!==null&&o!==void 0?o:!0,blending:t.blending,side:_i}):new _t({color:16777215,transparent:!0,blending:l0,side:_i}),startTileIndex:typeof t.startTileIndex=="number"?new ps(t.startTileIndex):$t(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,behaviors:[],worldSpace:t.worldSpace});return u.behaviors=t.behaviors.map(function(d){var f=sq(d,u);return f.type==="EmitSubParticleSystem"&&(r[d.subParticleSystem]=f),f}),u}}]),s}(),vw=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,dq=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,Ym=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,fq=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Ym,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),pq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Ym,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),gq=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(Ym,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),mq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(Ym,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function fC(s){return s===0?"uv":"uv".concat(s)}new x(0,0,1);var Aq=function(s){$f(t,s);var i=ep(t);function t(n){var r;return Ne(this,t),r=i.call(this,n),N(lt(r),"offsetBuffer",void 0),N(lt(r),"rotationBuffer",void 0),N(lt(r),"sizeBuffer",void 0),N(lt(r),"colorBuffer",void 0),N(lt(r),"uvTileBuffer",void 0),N(lt(r),"velocityBuffer",void 0),N(lt(r),"vector_",new x),N(lt(r),"vector2_",new x),N(lt(r),"vector3_",new x),N(lt(r),"quaternion_",new se),N(lt(r),"quaternion2_",new se),N(lt(r),"quaternion3_",new se),N(lt(r),"rotationMat_",new za),N(lt(r),"rotationMat2_",new za),r.maxParticles=1e3,r.setupBuffers(),r.rebuildMaterial(),r}return ze(t,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new kc(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Hs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new kc(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Hs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===we.Mesh?(this.rotationBuffer=new kc(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Hs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===we.BillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.StretchedBillBoard)&&(this.rotationBuffer=new kc(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Hs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new kc(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Hs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new kc(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Hs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===we.StretchedBillBoard&&(this.velocityBuffer=new kc(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Hs),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new QP,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(r){for(;r>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var r,o={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var a=this.settings.material;r=a0.merge([Vn.common,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.roughnessmap,Vn.metalnessmap,Vn.fog,Vn.lights,{emissive:{value:new xe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),r.diffuse.value=a.color,r.opacity.value=a.opacity,r.emissive.value=a.emissive,r.roughness.value=a.roughness,r.metalness.value=a.metalness,a.envMap&&(r.envMap.value=a.envMap,r.envMapIntensity.value=a.envMapIntensity),a.normalMap&&(r.normalMap.value=a.normalMap,r.normalScale.value=a.normalScale),a.roughnessMap&&(r.roughnessMap.value=a.roughnessMap),a.metalnessMap&&(r.metalnessMap.value=a.metalnessMap),a.map&&(r.map=new ee(a.map))}else r={},r.map=new ee(this.settings.material.map);this.settings.material.alphaTest&&(o.USE_ALPHATEST="",r.alphaTest=new ee(this.settings.material.alphaTest)),o.USE_UV="";var l=this.settings.uTileCount,c=this.settings.vTileCount;(l>1||c>1)&&(o.UV_TILE="",r.tileCount=new ee(new ae(l,c))),this.settings.material.normalMap&&(o.USE_NORMALMAP="",o.NORMALMAP_UV=fC(this.settings.material.normalMap.channel),r.normalMapTransform=new ee(new za().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(o.USE_MAP="",o.MAP_UV=fC(this.settings.material.map.channel),r.mapTransform=new ee(new za().copy(this.settings.material.map.matrix))),o.USE_COLOR_ALPHA="";var u=!1;if(this.settings.renderMode===we.BillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.Mesh){var d,f;this.settings.renderMode===we.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(o.USE_COLOR="",d=gq,f=dq,u=!0):(d=pq,f=vw):(d=fq,f=vw),this.settings.renderMode===we.VerticalBillBoard?o.VERTICAL="":this.settings.renderMode===we.HorizontalBillBoard&&(o.HORIZONTAL=""),this.material=new et({uniforms:r,defines:o,vertexShader:d,fragmentShader:f,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:u})}else if(this.settings.renderMode===we.StretchedBillBoard)r.speedFactor=new ee(1),this.material=new et({uniforms:r,defines:o,vertexShader:mq,fragmentShader:vw,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var r=this,o=0,a=0;this.systems.forEach(function(l){a+=l.particleNum}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=l.particles,u=l.particleNum,d=r.quaternion2_,f=r.vector2_,p=r.vector3_;l.emitter.matrixWorld.decompose(f,d,p),r.rotationMat_.setFromMatrix4(l.emitter.matrixWorld);for(var g=0;g<u;g++,o++){var m=c[g];if(r.settings.renderMode===we.Mesh){var A=void 0;if(l.worldSpace)A=m.rotation;else{var y=void 0;m.parentMatrix?y=r.quaternion3_.setFromRotationMatrix(m.parentMatrix):y=d,A=r.quaternion_,A.copy(m.rotation).multiply(y)}r.rotationBuffer.setXYZW(o,A.x,A.y,A.z,A.w)}else(r.settings.renderMode===we.StretchedBillBoard||r.settings.renderMode===we.VerticalBillBoard||r.settings.renderMode===we.HorizontalBillBoard||r.settings.renderMode===we.BillBoard)&&r.rotationBuffer.setX(o,m.rotation);var b=void 0;if(l.worldSpace?b=m.position:(b=r.vector_,m.parentMatrix?b.copy(m.position).applyMatrix4(m.parentMatrix):b.copy(m.position).applyMatrix4(l.emitter.matrixWorld)),r.offsetBuffer.setXYZ(o,b.x,b.y,b.z),r.colorBuffer.setXYZW(o,m.color.x,m.color.y,m.color.z,m.color.w),l.worldSpace||m.parentMatrix?r.sizeBuffer.setX(o,m.size):r.sizeBuffer.setX(o,m.size*(Math.abs(p.x)+Math.abs(p.y)+Math.abs(p.z))/3),r.uvTileBuffer.setX(o,m.uvTile),r.settings.renderMode===we.StretchedBillBoard&&r.velocityBuffer){var _=l.speedFactor,w=void 0;l.worldSpace?w=m.velocity:(w=r.vector_,m.parentMatrix?(r.rotationMat2_.setFromMatrix4(m.parentMatrix),w.copy(m.velocity).applyMatrix3(r.rotationMat2_)):w.copy(m.velocity).applyMatrix3(r.rotationMat_)),r.velocityBuffer.setXYZ(o,w.x*_,w.y*_,w.z*_)}}}),this.geometry.instanceCount=o,o>0&&(this.offsetBuffer.updateRange.count=o*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=o,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=o*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=o,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===we.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=o*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===we.Mesh?(this.rotationBuffer.updateRange.count=o*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===we.StretchedBillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.BillBoard)&&(this.rotationBuffer.updateRange.count=o,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(V2),vq=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,yq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(Ym,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new x(0,0,1);var bq=function(s){$f(t,s);var i=ep(t);function t(n){var r;return Ne(this,t),r=i.call(this,n),N(lt(r),"positionBuffer",void 0),N(lt(r),"previousBuffer",void 0),N(lt(r),"nextBuffer",void 0),N(lt(r),"uvBuffer",void 0),N(lt(r),"sideBuffer",void 0),N(lt(r),"widthBuffer",void 0),N(lt(r),"colorBuffer",void 0),N(lt(r),"indexBuffer",void 0),N(lt(r),"vector_",new x),N(lt(r),"vector2_",new x),N(lt(r),"vector3_",new x),N(lt(r),"quaternion_",new se),r.maxParticles=1e4,r.setupBuffers(),r.rebuildMaterial(),r}return ze(t,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new Vt,this.indexBuffer=new Je(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Hs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new Je(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Hs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new Je(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Hs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new Je(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Hs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new Je(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Hs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new Je(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Hs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new Je(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Hs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new Je(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Hs),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(r){for(;r>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var r={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new ae(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new ae(1,1)}},o={};if(o.USE_UV="",o.USE_COLOR_ALPHA="",this.settings.material.map&&(o.USE_MAP="",o.MAP_UV=fC(this.settings.material.map.channel),r.map=new ee(this.settings.material.map),r.mapTransform=new ee(new za().copy(this.settings.material.map.matrix))),this.settings.renderMode===we.Trail)this.material=new et({uniforms:r,defines:o,vertexShader:yq,fragmentShader:vq,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||l0});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var r=this,o=0,a=0,l=0;this.systems.forEach(function(c){for(var u=0;u<c.particleNum;u++)l+=c.particles[u].previous.length*2}),l>this.maxParticles&&this.expandBuffers(l),this.systems.forEach(function(c){var u=r.quaternion_,d=r.vector2_,f=r.vector3_;c.emitter.matrixWorld.decompose(d,u,f);for(var p=c.particles,g=c.particleNum,m=r.settings.uTileCount,A=r.settings.vTileCount,y=1/m,b=1/A,_=0;_<g;_++){var w=p[_],S=w.uvTile%A,E=Math.floor(w.uvTile/A),I=w.previous.values(),k=I.next(),T=k.value,P=T;k.done||(k=I.next());var B=void 0;k.value!==void 0?B=k.value:B=P;for(var M=0;M<w.previous.length;M++,o+=2){if(r.positionBuffer.setXYZ(o,P.position.x,P.position.y,P.position.z),r.positionBuffer.setXYZ(o+1,P.position.x,P.position.y,P.position.z),c.worldSpace?(r.positionBuffer.setXYZ(o,P.position.x,P.position.y,P.position.z),r.positionBuffer.setXYZ(o+1,P.position.x,P.position.y,P.position.z)):(w.parentMatrix?r.vector_.copy(P.position).applyMatrix4(w.parentMatrix):r.vector_.copy(P.position).applyMatrix4(c.emitter.matrixWorld),r.positionBuffer.setXYZ(o,r.vector_.x,r.vector_.y,r.vector_.z),r.positionBuffer.setXYZ(o+1,r.vector_.x,r.vector_.y,r.vector_.z)),c.worldSpace?(r.previousBuffer.setXYZ(o,T.position.x,T.position.y,T.position.z),r.previousBuffer.setXYZ(o+1,T.position.x,T.position.y,T.position.z)):(w.parentMatrix?r.vector_.copy(T.position).applyMatrix4(w.parentMatrix):r.vector_.copy(T.position).applyMatrix4(c.emitter.matrixWorld),r.previousBuffer.setXYZ(o,r.vector_.x,r.vector_.y,r.vector_.z),r.previousBuffer.setXYZ(o+1,r.vector_.x,r.vector_.y,r.vector_.z)),c.worldSpace?(r.nextBuffer.setXYZ(o,B.position.x,B.position.y,B.position.z),r.nextBuffer.setXYZ(o+1,B.position.x,B.position.y,B.position.z)):(w.parentMatrix?r.vector_.copy(B.position).applyMatrix4(w.parentMatrix):r.vector_.copy(B.position).applyMatrix4(c.emitter.matrixWorld),r.nextBuffer.setXYZ(o,r.vector_.x,r.vector_.y,r.vector_.z),r.nextBuffer.setXYZ(o+1,r.vector_.x,r.vector_.y,r.vector_.z)),r.sideBuffer.setX(o,-1),r.sideBuffer.setX(o+1,1),c.worldSpace)r.widthBuffer.setX(o,P.size),r.widthBuffer.setX(o+1,P.size);else if(w.parentMatrix)r.widthBuffer.setX(o,P.size),r.widthBuffer.setX(o+1,P.size);else{var U=(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3;r.widthBuffer.setX(o,P.size*U),r.widthBuffer.setX(o+1,P.size*U)}r.uvBuffer.setXY(o,(M/w.previous.length+S)*y,(A-E-1)*b),r.uvBuffer.setXY(o+1,(M/w.previous.length+S)*y,(A-E)*b),r.colorBuffer.setXYZW(o,P.color.x,P.color.y,P.color.z,P.color.w),r.colorBuffer.setXYZW(o+1,P.color.x,P.color.y,P.color.z,P.color.w),M+1<w.previous.length&&(r.indexBuffer.setX(a*3,o),r.indexBuffer.setX(a*3+1,o+1),r.indexBuffer.setX(a*3+2,o+2),a++,r.indexBuffer.setX(a*3,o+2),r.indexBuffer.setX(a*3+1,o+1),r.indexBuffer.setX(a*3+2,o+3),a++),T=P,P=B,k.done||(k=I.next(),k.value!==void 0&&(B=k.value))}}}),this.positionBuffer.updateRange.count=o*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=o*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=o*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=o,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=o,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=o*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=o*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=a*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,a*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(V2),_q=function(s){$f(t,s);var i=ep(t);function t(){var n;return Ne(this,t),n=i.call(this),N(lt(n),"batches",[]),N(lt(n),"systemToBatchIndex",new Map),N(lt(n),"type","BatchedRenderer"),n}return ze(t,[{key:"addSystem",value:function(r){r._renderer=this;for(var o=r.getRendererSettings(),a=0;a<this.batches.length;a++)if(t.equals(this.batches[a].settings,o)){this.batches[a].addSystem(r),this.systemToBatchIndex.set(r,a);return}var l;switch(o.renderMode){case we.Trail:l=new bq(o);break;case we.Mesh:case we.BillBoard:case we.VerticalBillBoard:case we.HorizontalBillBoard:case we.StretchedBillBoard:l=new Aq(o);break}l.addSystem(r),this.batches.push(l),this.systemToBatchIndex.set(r,this.batches.length-1),this.add(l)}},{key:"deleteSystem",value:function(r){var o=this.systemToBatchIndex.get(r);o!=null&&(this.batches[o].removeSystem(r),this.systemToBatchIndex.delete(r))}},{key:"updateSystem",value:function(r){this.deleteSystem(r),this.addSystem(r)}},{key:"update",value:function(r){this.systemToBatchIndex.forEach(function(a,l){l.update(r)});for(var o=0;o<this.batches.length;o++)this.batches[o].update()}}],[{key:"equals",value:function(r,o){return r.material.side===o.material.side&&r.material.blending===o.material.blending&&r.material.transparent===o.material.transparent&&r.material.type===o.material.type&&r.material.alphaTest===o.material.alphaTest&&r.material.map===o.material.map&&r.renderMode===o.renderMode&&r.uTileCount===o.uTileCount&&r.vTileCount===o.vTileCount&&r.instancingGeometry===o.instancingGeometry&&r.renderOrder===o.renderOrder&&r.layers.mask===o.layers.mask}}]),t}(ne),wq=_q,DB=function(){function s(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new x;Ne(this,s),N(this,"locations",[]),this.scaleX=i,this.scaleY=t,this.position=n}return ze(s,[{key:"transform",value:function(t,n){t.x=this.locations[n%this.locations.length].x*this.scaleX+this.position.x,t.y=this.locations[n%this.locations.length].y*this.scaleY+this.position.y,t.z=this.position.z}},{key:"clone",value:function(){var t=new s(this.scaleX,this.scaleY,this.position.clone());return t.locations=this.locations.map(function(n){return n.clone()}),t}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(t){return{x:t.x,y:t.y}})}}},{key:"fromImage",value:function(t,n){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var o=r.getContext("2d");if(o){o.drawImage(t,0,0);var a=o.getImageData(0,0,r.width,r.height,{colorSpace:"srgb"});r.remove(),this.locations.length=0;for(var l=0;l<a.height;l++)for(var c=0;c<a.width;c++)a.data[(l*a.width+c)*4+3]>n&&this.locations.push(new ae(c,a.height-l))}}}],[{key:"fromJSON",value:function(t){var n=new s(t.scaleX,t.scaleY,new x(t.position[0],t.position[1],t.position[2]));return n.locations=t.locations.map(function(r){return new ae(r.x,r.y)}),n}}]),s}();function xq(s){switch(s.type){case"TextureSequencer":return DB.fromJSON(s);default:return new DB}}var Cq=function(){function s(i){Ne(this,s),N(this,"type","ApplySequences"),N(this,"sequencers",[]),N(this,"time",0),N(this,"index",0),N(this,"pCount",0),N(this,"delay",void 0),N(this,"tempV",new x),this.delay=i}return ze(s,[{key:"initialize",value:function(t){t.id=this.pCount,t.dst=new x,t.begin=new x,t.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(t,n){var r=this.sequencers[this.index],o=t.id*this.delay;this.time>=r[0].a+o&&this.time<=r[0].b+o?(t.inMotion||(t.inMotion=!0,t.begin.copy(t.position),r[1].transform(t.dst,t.id)),t.position.lerpVectors(t.begin,t.dst,s.BEZIER.genValue((this.time-r[0].a-o)/(r[0].b-r[0].a)))):this.time>r[0].b+o&&(t.inMotion=!1)}},{key:"frameUpdate",value:function(t){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=t}},{key:"appendSequencer",value:function(t,n){this.sequencers.push([t,n])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(t){var n=mf(t,2),r=n[0],o=n[1];return{range:r.toJSON(),sequencer:o.toJSON()}})}}},{key:"clone",value:function(){var t=new s(this.delay);return t.sequencers=this.sequencers.map(function(n){return[n[0].clone(),n[1].clone()]}),t}}],[{key:"fromJSON",value:function(t){var n=new s(t.delay);return t.sequencers.forEach(function(r){n.sequencers.push([$t(r.range),xq(r.sequencer)])}),n}}]),s}();N(Cq,"BEZIER",new cC(0,0,1,1));var X=function(s){return s[s.Number=0]="Number",s[s.Vec2=1]="Vec2",s[s.Vec3=2]="Vec3",s[s.Vec4=3]="Vec4",s[s.Boolean=4]="Boolean",s[s.AnyType=5]="AnyType",s}({}),OB=ze(function s(i,t,n,r){Ne(this,s),N(this,"input",void 0),N(this,"inputIndex",void 0),N(this,"output",void 0),N(this,"outputIndex",void 0),this.input=i,this.inputIndex=t,this.input.outputs[t].push(this),this.output=n,this.outputIndex=r,this.output.inputs[r]=this}),Sq=function(){function s(){Ne(this,s),N(this,"visited",new Set),N(this,"graph_",void 0),N(this,"context_",void 0),s.Instance=this}return ze(s,[{key:"traverse",value:function(t){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(t.id);for(var n=[],r=0;r<t.inputs.length;r++)if(t.inputs[r]instanceof OB){var o=t.inputs[r].input;this.visited.has(o.id)||this.traverse(o),n.push(o.outputValues[t.inputs[r].inputIndex])}else n.push(t.inputs[r].getValue(this.context_));t.func(this.context_,n,t.outputValues),this.graph_.nodesInOrder.push(t)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var t=this.graph_.nodesInOrder,n=0;n<t.length;n++){for(var r=[],o=t[n],a=0;a<o.inputs.length;a++)if(o.inputs[a]instanceof OB)r.push(o.inputs[a].input.outputValues[o.inputs[a].inputIndex]);else if(o.inputs[a]!==void 0)r.push(o.inputs[a].getValue(this.context_));else throw new Error("miss input for node ".concat(o.id));o.func(this.context_,r,o.outputValues)}}},{key:"run",value:function(t,n){if(this.graph_=t,this.context_=n,t.compiled)this.executeCompiledGraph();else{t.nodesInOrder.length=0,this.visited.clear();for(var r=0;r<t.outputNodes.length;r++){var o=t.outputNodes[r];this.traverse(o)}t.compiled=!0}}}]),s}();N(Sq,"Instance",void 0);var vt=function(){function s(i){Ne(this,s),N(this,"name",void 0),N(this,"nodeTypeSignatures",[]),this.name=i}return ze(s,[{key:"addSignature",value:function(t,n,r){this.nodeTypeSignatures.push({inputTypes:t,outputTypes:n,func:r})}}]),s}(),db=new vt("add");db.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=t[0]+t[1]});db.addSignature([X.Vec2,X.Vec2],[X.Vec2],function(s,i,t,n){n[0].addVectors(t[0],t[1])});db.addSignature([X.Vec3,X.Vec3],[X.Vec3],function(s,i,t,n){n[0].addVectors(t[0],t[1])});db.addSignature([X.Vec4,X.Vec4],[X.Vec4],function(s,i,t,n){n[0].addVectors(t[0],t[1])});var fb=new vt("sub");fb.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=t[0]-t[1]});fb.addSignature([X.Vec2,X.Vec2],[X.Vec2],function(s,i,t,n){n[0].subVectors(t[0],t[1])});fb.addSignature([X.Vec3,X.Vec3],[X.Vec3],function(s,i,t,n){n[0].subVectors(t[0],t[1])});fb.addSignature([X.Vec4,X.Vec4],[X.Vec4],function(s,i,t,n){n[0].subVectors(t[0],t[1])});var pb=new vt("mul");pb.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=t[0]*t[1]});pb.addSignature([X.Vec2,X.Number],[X.Vec2],function(s,i,t,n){n[0].copy(t[0]).multiplyScalar(t[1])});pb.addSignature([X.Vec3,X.Number],[X.Vec3],function(s,i,t,n){n[0].copy(t[0]).multiplyScalar(t[1])});pb.addSignature([X.Vec4,X.Number],[X.Vec4],function(s,i,t,n){n[0].copy(t[0]).multiplyScalar(t[1])});var gb=new vt("div");gb.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=t[0]/t[1]});gb.addSignature([X.Vec2,X.Number],[X.Vec2],function(s,i,t,n){n[0].copy(t[0]).divideScalar(t[1])});gb.addSignature([X.Vec3,X.Number],[X.Vec3],function(s,i,t,n){n[0].copy(t[0]).divideScalar(t[1])});gb.addSignature([X.Vec4,X.Number],[X.Vec4],function(s,i,t,n){n[0].copy(t[0]).divideScalar(t[1])});var Eq=new vt("sin");Eq.addSignature([X.Number],[X.Number],function(s,i,t,n){n[0]=Math.sin(t[0])});var Iq=new vt("cos");Iq.addSignature([X.Number],[X.Number],function(s,i,t,n){n[0]=Math.cos(t[0])});var Tq=new vt("tan");Tq.addSignature([X.Number],[X.Number],function(s,i,t,n){n[0]=Math.tan(t[0])});var Rq=new vt("abs");Rq.addSignature([X.Number],[X.Number],function(s,i,t,n){n[0]=Math.abs(t[0])});var Bq=new vt("min");Bq.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=Math.min(t[0],t[1])});var Pq=new vt("max");Pq.addSignature([X.Number,X.Number],[X.Number],function(s,i,t,n){n[0]=Math.max(t[0],t[1])});var kE=new vt("dot");kE.addSignature([X.Vec2,X.Vec2],[X.Number],function(s,i,t,n){n[0]=t[0].dot(t[1])});kE.addSignature([X.Vec3,X.Vec3],[X.Number],function(s,i,t,n){n[0]=t[0].dot(t[1])});kE.addSignature([X.Vec4,X.Vec4],[X.Number],function(s,i,t,n){n[0]=t[0].dot(t[1])});var Mq=new vt("cross");Mq.addSignature([X.Vec3,X.Vec3],[X.Vec3],function(s,i,t,n){n[0].crossVectors(t[0],t[1])});var DE=new vt("length");DE.addSignature([X.Vec2],[X.Number],function(s,i,t,n){n[0]=t[0].length()});DE.addSignature([X.Vec3],[X.Number],function(s,i,t,n){n[0]=t[0].length()});DE.addSignature([X.Vec4],[X.Number],function(s,i,t,n){n[0]=t[0].length()});var OE=new vt("lengthSq");OE.addSignature([X.Vec2],[X.Number],function(s,i,t,n){n[0]=t[0].lengthSq()});OE.addSignature([X.Vec3],[X.Number],function(s,i,t,n){n[0]=t[0].lengthSq()});OE.addSignature([X.Vec4],[X.Number],function(s,i,t,n){n[0]=t[0].lengthSq()});var LE=new vt("normalize");LE.addSignature([X.Vec2],[X.Vec2],function(s,i,t,n){n[0].copy(t[0]).normalize()});LE.addSignature([X.Vec3],[X.Vec3],function(s,i,t,n){n[0].copy(t[0]).normalize()});LE.addSignature([X.Vec4],[X.Vec4],function(s,i,t,n){n[0].copy(t[0]).normalize()});var W2=new vt("distance");W2.addSignature([X.Vec2,X.Vec2],[X.Number],function(s,i,t,n){n[0]=t[0].distanceTo(t[1])});W2.addSignature([X.Vec3,X.Vec3],[X.Number],function(s,i,t,n){n[0]=t[0].distanceTo(t[1])});var kq=new vt("and");kq.addSignature([X.Boolean,X.Boolean],[X.Boolean],function(s,i,t,n){n[0]=t[0]&&t[1]});var Dq=new vt("or");Dq.addSignature([X.Boolean,X.Boolean],[X.Boolean],function(s,i,t,n){n[0]=t[0]||t[1]});var Oq=new vt("not");Oq.addSignature([X.Boolean],[X.Boolean],function(s,i,t,n){n[0]=!t[0]});var mb=new vt("equal");mb.addSignature([X.Number,X.Number],[X.Boolean],function(s,i,t,n){n[0]=t[0]===t[1]});mb.addSignature([X.Vec2,X.Vec2],[X.Boolean],function(s,i,t,n){n[0]=t[0].equals(t[1])});mb.addSignature([X.Vec3,X.Vec3],[X.Boolean],function(s,i,t,n){n[0]=t[0].equals(t[1])});mb.addSignature([X.Vec4,X.Vec4],[X.Boolean],function(s,i,t,n){n[0]=t[0].equals(t[1])});var Lq=new vt("lessThan");Lq.addSignature([X.Number,X.Number],[X.Boolean],function(s,i,t,n){n[0]=t[0]<t[1]});var Fq=new vt("greaterThan");Fq.addSignature([X.Number,X.Number],[X.Boolean],function(s,i,t,n){n[0]=t[0]>t[1]});var Uq=new vt("lessThanOrEqual");Uq.addSignature([X.Number,X.Number],[X.Boolean],function(s,i,t,n){n[0]=t[0]<=t[1]});var Nq=new vt("greaterThanOrEqual");Nq.addSignature([X.Number,X.Number],[X.Boolean],function(s,i,t,n){n[0]=t[0]>=t[1]});var zq=new vt("if");zq.addSignature([X.Boolean,X.AnyType,X.AnyType],[X.AnyType],function(s,i,t,n){n[0]=t[0]?t[1]:t[2]});var Qq=new vt("number");Qq.addSignature([],[X.Number],function(s,i,t,n){n[0]=i.value});var jq=new vt("vec2");jq.addSignature([],[X.Vec2],function(s,i,t,n){n[0]=i.value});var Gq=new vt("vec3");Gq.addSignature([],[X.Vec3],function(s,i,t,n){n[0]=i.value});var Hq=new vt("vec4");Hq.addSignature([],[X.Vec4],function(s,i,t,n){n[0]=i.value});var Vq=new vt("bool");Vq.addSignature([],[X.Boolean],function(s,i,t,n){n[0]=i.value});var Wq=new vt("particlePosition");Wq.addSignature([],[X.Vec3],function(s,i,t,n){n[0]=s.particle[i.property]});var qq=new vt("particleVelocity");qq.addSignature([],[X.Vec3],function(s,i,t,n){n[0]=s.particle[i.property]});var Xq=new vt("particleRotation");Xq.addSignature([],[X.Number],function(s,i,t,n){n[0]=s.particle[i.property]});var Yq=new vt("particleAge");Yq.addSignature([],[X.Number],function(s,i,t,n){n[0]=s.particle[i.property]});var Km=new vt("output");Km.addSignature([X.Number],[X.Number],function(s,i,t,n){n[0]=t[0]});Km.addSignature([X.Vec2],[X.Vec2],function(s,i,t,n){n[0]=t[0]});Km.addSignature([X.Vec3],[X.Vec3],function(s,i,t,n){n[0]=t[0]});Km.addSignature([X.Vec4],[X.Vec4],function(s,i,t,n){n[0]=t[0]});Km.addSignature([X.Boolean],[X.Boolean],function(s,i,t,n){n[0]=t[0]});setTimeout(()=>console.log("Particle system powered by three.quarks. https://quarks.art/"),100);var Si=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Zp=Q("debugparticles"),Kq=Q("noprogressive"),Jq=Q("debugprogressive");var Uy;(function(s){s[s.Birth=0]="Birth",s[s.Collision=1]="Collision",s[s.Death=2]="Death",s[s.Trigger=3]="Trigger",s[s.Manual=4]="Manual"})(Uy||(Uy={}));class la extends oe{constructor(){super(...arguments);h(this,"renderMode");h(this,"particleMaterial");h(this,"trailMaterial");h(this,"particleMesh");h(this,"maxParticleSize");h(this,"minParticleSize");h(this,"velocityScale");h(this,"cameraVelocityScale");h(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&be()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var n;return((n=this.particleMaterial)==null?void 0:n.transparent)??!1}getMaterial(t=!1){let n=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return n&&t&&n.side===il&&(n=n.clone(),n.side=Wc,t?this.trailMaterial=n:this.particleMaterial=n),n&&!Kq&&n._didRequestTextureLOD===void 0&&(n._didRequestTextureLOD=0,Jq&&console.log("Load material LOD",n.name),pt.assignTextureLOD(n,0)),n}getMesh(t){let n=null;if(!n&&(this.particleMesh instanceof Z&&(n=this.particleMesh.geometry),n===null)){n=new pr(1,1);const o=n.attributes.uv;for(let a=0;a<o.count;a++)o.setX(a,1-o.getX(a))}return new Z(n,this.getMaterial())}}Si([v()],la.prototype,"renderMode",void 0);Si([v(mt)],la.prototype,"particleMaterial",void 0);Si([v(mt)],la.prototype,"trailMaterial",void 0);Si([v()],la.prototype,"maxParticleSize",void 0);Si([v()],la.prototype,"minParticleSize",void 0);Si([v()],la.prototype,"velocityScale",void 0);Si([v()],la.prototype,"cameraVelocityScale",void 0);Si([v()],la.prototype,"lengthScale",void 0);class rv{constructor(i,t=1){h(this,"_curve");h(this,"_factor");h(this,"type","function");this._curve=i,this._factor=t}genValue(i){return this._curve.evaluate(i,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class FE{constructor(i){h(this,"type","value");h(this,"system");this.system=i}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class Zq extends FE{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class $q extends FE{constructor(){super(...arguments);h(this,"_lastPosition",new x);h(this,"_lastDistance",0)}update(){const t=Ve(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const o=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let l=this._lastDistance/this.system.deltaTime*o;Number.isFinite(l)||(l=0),t+=l}const n=this.system.emission.getBurst();n>0&&(t+=n/this.system.deltaTime);const r=this.system.maxParticles-this.system.currentParticles;return ye.clamp(t,0,r/this.system.deltaTime)}}class eX extends FE{genValue(){return this.system.isPlaying,0}}class ed{constructor(i){h(this,"system");h(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",i&&(this.system=i)}get context(){return this.system.context}initialize(i){}update(i,t){}frameUpdate(i){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class tX extends ed{constructor(){super(...arguments);h(this,"type","NeedleTextureSheet")}update(t,n){const r=this.system.textureSheetAnimation;if(r.enabled){const o=t.age/t.life,a=r.evaluate(o);a!==void 0&&(t.uvTile=a)}}}const LB=Symbol("particleRotation");class iX extends ed{constructor(){super(...arguments);h(this,"type","NeedleRotation")}initialize(t){t[LB]=Math.random()}update(t,n){if(t.rotation===void 0)return;const r=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(r,t[LB])*n:this.system.renderer.renderMode===Ma.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const o=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(r,o)*n}}}const FB=Symbol("sizeLerpFactor"),nX=new x;class sX extends ed{constructor(){super(...arguments);h(this,"type","NeedleSize");h(this,"_minSize",0);h(this,"_maxSize",1)}initialize(t){t[FB]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,n){const r=t.age/t.life;let o=1;this.system.sizeOverLifetime.enabled&&(o*=this.system.sizeOverLifetime.evaluate(r,void 0,t[FB]).x);let a=1;if(this.system.renderer.renderMode!==Ma.Mesh&&(a=this.system.worldScale.x/this.system.cameraScale),t.size=t.startSize*o*a,this.system.localspace){const l=q2(this.system,nX);t.size*=l.x}}}const Vd=Symbol("particleLife"),yw=Symbol("trailLifetime"),UB=Symbol("trailStartLength"),bw=Symbol("trailWidthRandom");class rX extends ed{constructor(){super(...arguments);h(this,"type","NeedleTrail")}initialize(t){t instanceof lm&&(t[Vd]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[yw]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[yw]),t[UB]=t.length,t[bw]=Math.random())}update(t){var n;if((n=this.system.trails)!=null&&n.enabled&&t instanceof lm){const r=t,o=t.age/t[Vd],a=t.previous.values(),l=t.previous.length;for(let c=0;c<l;c++){const d=a.next().value,f=1-c/(l-1);let p=t.size;p<=0&&!this.system.trails.sizeAffectsWidth&&(p=20*this.system.trails.widthOverTrail.evaluate(.5,r[bw])),d.size=this.system.trails.getWidth(p,o,f,r[bw]),d.color.copy(t.color),this.system.trails.getColor(d.color,o,f)}if(t.age>t[Vd]){t.velocity.set(0,0,0);const c=(t.age-t[Vd])/t[yw];r.length=ye.lerp(t[UB],0,c)}}}}const ov=Symbol("startVelocity"),NB=Symbol("gravityModifier"),_w=Symbol("gravitySpeed"),av=Symbol("velocity lerp factor"),pC=new x;class oX extends ed{constructor(){super(...arguments);h(this,"type","NeedleVelocity");h(this,"_gravityDirection",new x)}initialize(t){var o,a;const n=this.system.main.simulationSpeed;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),t.velocity.copy(this.system.shape.getDirection(t,t.position)).multiplyScalar(t.startSpeed),(o=this.system.inheritVelocity)!=null&&o.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[ov]?t[ov].copy(t.velocity):t[ov]=t.velocity.clone();const r=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[NB]=r*n,t[_w]=r*n*.5,t[av]=Math.random(),(a=this.system.velocityOverLifetime)==null||a.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===ia.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,n){var p;const r=t[ov],o=t[NB];if(o!==0){const g=o*t[_w];pC.copy(this._gravityDirection).multiplyScalar(g),t[_w]+=n*.05,r.add(pC)}t.velocity.copy(r);const a=t.age/t.life;(p=this.system.inheritVelocity)!=null&&p.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,a,t[av]);const l=this.system.noise;l.enabled&&l.apply(0,t.position,t.velocity,n,t.age,t.life);const c=this.system.sizeBySpeed;c!=null&&c.enabled&&(t.size=c.evaluate(t.velocity,a,t[av],t.size));const u=this.system.colorBySpeed;u!=null&&u.enabled&&u.evaluate(t.velocity,t[av],t.color);const d=this.system.velocityOverLifetime;d.enabled&&d.apply(t,0,t.position,t.velocity,n,t.age,t.life);const f=this.system.limitVelocityOverLifetime;f.enabled&&f.apply(t.position,r,t.velocity,t.size,a,n,1),this.system.worldspace&&t.velocity.multiply(this.system.worldScale)}}const zB=Symbol("colorLerpFactor"),QB=new Ut(1,1,1,1),Nh=new Ut(1,1,1,1);class aX extends ed{constructor(){super(...arguments);h(this,"type","NeedleColor")}initialize(t){}_init(t){const n=this.system.renderer.particleMaterial;Nh.copy(this.system.main.startColor.evaluate(Math.random())),n!=null&&n.color&&(QB.copy(n.color),Nh.multiply(QB)),Nh.convertLinearToSRGB(),t.startColor.set(Nh.r,Nh.g,Nh.b,Nh.alpha),t.color.copy(t.startColor),t[zB]=Math.random()}update(t,n){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const r=t.age/t.life,o=this.system.colorOverLifetime.color.evaluate(r,t[zB]);t.color.set(o.r,o.g,o.b,"alpha"in o?o.alpha:1).multiply(t.startColor)}else t.color.copy(t.startColor)}}class lX{constructor(i){h(this,"system");h(this,"emission");h(this,"autoDestroy");h(this,"startLength");h(this,"emissionBursts");h(this,"onlyUsedByOther");h(this,"behaviors",[]);h(this,"rendererEmitterSettings",{startLength:new ps(220),followLocalOrigin:!1});h(this,"flatWhiteTexture");h(this,"clonedTexture",{original:void 0,clone:void 0});this.system=i,this.emission=new $q(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new rv(this.system.main.startLifetime)}get startSpeed(){return new rv(this.system.main.startSpeed)}get startRotation(){return new rv(this.system.main.startRotation)}get startSize(){return new rv(this.system.main.startSize)}get startColor(){return new Fy(new Ue(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new eX(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return we.Trail;switch(this.system.renderer.renderMode){case Ma.Billboard:return we.BillBoard;case Ma.Stretch:return we.StretchedBillBoard;case Ma.HorizontalBillboard:return we.HorizontalBillBoard;case Ma.VerticalBillboard:return we.VerticalBillBoard;case Ma.Mesh:return we.Mesh}return we.BillBoard}get speedFactor(){var t;let i=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===Ma.Stretch&&(i*=this.system.renderer.velocityScale??1),i}get texture(){const i=this.material;if(i&&i.map){const t=i.map;if(this.clonedTexture.original!==t||!this.clonedTexture.clone){const n=t.clone();n.premultiplyAlpha=!1,n.colorSpace=zi,this.clonedTexture.original=t,this.clonedTexture.clone=n}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=VS(new Ut(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new Zq(this.system)}get uTileCount(){var i;return this.anim.enabled?(i=this.anim)==null?void 0:i.numTilesX:void 0}get vTileCount(){var i;return this.anim.enabled?(i=this.anim)==null?void 0:i.numTilesY:void 0}get renderOrder(){return 1}get blending(){var i;return((i=this.system.renderer.particleMaterial)==null?void 0:i.blending)??$F}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===ia.World}}class cX{constructor(){h(this,"burstIndex",0);h(this,"burstWaveIndex",0);h(this,"time",0);h(this,"waitEmiting",0)}}class wi extends oe{constructor(){super(...arguments);h(this,"_state");h(this,"colorOverLifetime");h(this,"main");h(this,"emission");h(this,"sizeOverLifetime");h(this,"shape");h(this,"noise");h(this,"trails");h(this,"velocityOverLifetime");h(this,"limitVelocityOverLifetime");h(this,"inheritVelocity");h(this,"colorBySpeed");h(this,"textureSheetAnimation");h(this,"rotationOverLifetime");h(this,"rotationBySpeed");h(this,"sizeBySpeed");h(this,"_cameraScale",1);h(this,"__worldQuaternion",new se);h(this,"_worldQuaternionInverted",new se);h(this,"_worldScale",new x);h(this,"_worldPositionFrame",-1);h(this,"_worldPos",new x);h(this,"_renderer");h(this,"_batchSystem");h(this,"_particleSystem");h(this,"_interface");h(this,"_container");h(this,"_time",0);h(this,"_isPlaying",!0);h(this,"_isUsedAsSubsystem",!1);h(this,"_didPreWarm",!1);h(this,"_bursts");h(this,"_subEmitterSystems");h(this,"_lastBatchesCount",-1);h(this,"lastMaterialVersion",-1)}play(t=!1){var n;t&&j.foreachComponent(this.gameObject,r=>{r instanceof wi&&r!==this&&r.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(n=this.emission)==null||n.reset()}pause(t=!0){t&&j.foreachComponent(this.gameObject,n=>{n instanceof wi&&n!==this&&n.pause(!1)},!0),this._isPlaying=!1}stop(t=!0,n=!1){t&&j.foreachComponent(this.gameObject,r=>{r instanceof wi&&r!==this&&r.stop(!1,n)},!0),this._isPlaying=!1,this._time=0,n&&this.reset()}reset(){var t;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(t=this.emission)==null||t.reset())}emit(t){if(this._particleSystem){this.onUpdate(),t=Math.min(t,this.maxParticles-this.currentParticles),this._state||(this._state=new cX),this._state.waitEmiting=t,this._state.time=0;const n=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=n}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(t){this.main.playOnAwake=t}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var t;return((t=this._particleSystem)==null?void 0:t.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===ia.World}get localspace(){return this.main.simulationSpace===ia.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,Ve(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(t){return this._particleSystem?(t instanceof ed&&(t.system=this),be()&&console.log("add behaviour",t),this._particleSystem.addBehavior(t),!0):!1}removeBehaviour(t){if(!this._particleSystem)return!1;const n=this._particleSystem.behaviors,r=n.indexOf(t);return r!==-1&&n.splice(r,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(t){for(let n=0;n<t.length;n++){const r=t[n];if(!(r instanceof Iy)){const o=new Iy;Mf(o,r),t[n]=o}}this._bursts=t}set subEmitterSystems(t){for(let n=0;n<t.length;n++){const r=t[n];if(!(r instanceof Ny)){const o=new Ny;Mf(o,r),t[n]=o}}Zp&&t.length>0&&console.log("SubEmitters: ",t,this),this._subEmitterSystems=t}onAfterDeserialize(t){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const n of this._subEmitterSystems)n._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(la),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ne,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new wq,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new lX(this),this._particleSystem=new uq(this._interface),this._particleSystem.addBehavior(new sX(this)),this._particleSystem.addBehavior(new aX(this)),this._particleSystem.addBehavior(new tX(this)),this._particleSystem.addBehavior(new iX(this)),this._particleSystem.addBehavior(new oX(this)),this._particleSystem.addBehavior(new rX(this)),this._batchSystem.addSystem(this._particleSystem);const t=this._particleSystem.emitter;this.context.scene.add(t),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),Zp&&(console.log(this),this.gameObject.add(new dr(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof Z&&this._interface.renderMode==we.Mesh&&pt.assignMeshLOD(this.renderer.particleMesh,0).then(t=>{t&&this.particleSystem&&this._interface.renderMode==we.Mesh&&(this.particleSystem.instancingGeometry=t)})}onDestroy(){var t,n,r,o;(t=this._container)==null||t.removeFromParent(),(n=this._batchSystem)==null||n.removeFromParent(),(r=this._particleSystem)==null||r.emitter.removeFromParent(),(o=this._particleSystem)==null||o.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var t;this.main&&(this._didPreWarm===!1&&((t=this.main)==null?void 0:t.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var d;if(!((d=this.emission)!=null&&d.enabled)||this.emission.rateOverTime.getMax()<=0)return;const n=1/60,r=this.main.duration,o=this.main.startLifetime.getMax(),a=1e3,l=Math.min(Math.max(r,o)/Math.max(.01,this.main.simulationSpeed),a),c=Math.ceil(l/n),u=Date.now();Zp&&console.log(`Particles ${this.name} - Prewarm for ${c} frames (${l} sec). Duration: ${r}, Lifetime: ${o}`);for(let f=0;f<c&&!(this.currentParticles>=this.maxParticles);f++){const p=Date.now()-u;if(p>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${p}`);break}this.onUpdate(),this.onSimulate(n)}}onSimulate(t){if(this._batchSystem){let n=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,n=!0),n&&this.updateLayers(),this._batchSystem.update(t)}this._time+=t,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let t=0;t<this._batchSystem.batches.length;t++){const n=this._batchSystem.batches[t];n.layers.disableAll();const r=this.layer;n.layers.mask=1<<r}}onUpdate(){var a,l;const t=this.renderer.getMaterial(this.trails.enabled);if(t&&t.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=t.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const n=this.context.mainCamera;if(n){const c=oi(n);this._cameraScale=c.x}const r=!this.worldspace,o=this.gameObject;if(Ht(o,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),oi(this.gameObject,this._worldScale),r&&this._container&&((a=this.gameObject)!=null&&a.parent)){const c=q2(this,pC);this._container.matrix.makeScale(c.x,c.y,c.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(l=this.inheritVelocity)==null||l.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var t;if(this._subEmitterSystems&&this._particleSystem)for(const n of this._subEmitterSystems){n.particleSystem&&(n.particleSystem.__internalAwake?n.particleSystem.__internalAwake():be()&&console.warn("SubParticleSystem serialization issue(?)",n.particleSystem,n));const r=(t=n.particleSystem)==null?void 0:t._particleSystem;if(r){n.particleSystem._isUsedAsSubsystem=!0;const o=new UE(this,this._particleSystem,n.particleSystem,r);o.emitterType=n.type,o.emitterProbability=n.emitProbability,this._particleSystem.addBehavior(o)}else Zp&&console.warn("Could not add SubParticleSystem",n,this)}}}Si([v(eb)],wi.prototype,"colorOverLifetime",void 0);Si([v(Is)],wi.prototype,"main",void 0);Si([v(pc)],wi.prototype,"emission",void 0);Si([v(Yu)],wi.prototype,"sizeOverLifetime",void 0);Si([v(ei)],wi.prototype,"shape",void 0);Si([v(Nt)],wi.prototype,"noise",void 0);Si([v(Ci)],wi.prototype,"trails",void 0);Si([v(Pi)],wi.prototype,"velocityOverLifetime",void 0);Si([v(hn)],wi.prototype,"limitVelocityOverLifetime",void 0);Si([v(gc)],wi.prototype,"inheritVelocity",void 0);Si([v(Xf)],wi.prototype,"colorBySpeed",void 0);Si([v(Ts)],wi.prototype,"textureSheetAnimation",void 0);Si([v(aa)],wi.prototype,"rotationOverLifetime",void 0);Si([v(To)],wi.prototype,"rotationBySpeed",void 0);Si([v(mr)],wi.prototype,"sizeBySpeed",void 0);class Ny{constructor(){h(this,"particleSystem");h(this,"emitProbability",1);h(this,"properties");h(this,"type")}_deserialize(i,t){const n=this.particleSystem;if(n instanceof wi)return;let r="";n&&typeof n.guid=="string"&&(r=n.guid,this.particleSystem=j.findByGuid(r,t)),Zp&&!(this.particleSystem instanceof wi)&&console.warn("Could not find particle system for sub emitter",r,t,this)}}function q2(s,i){if(i.set(1,1,1),s.gameObject.parent&&s.localspace)switch(s.main.scalingMode){case Ey.Local:i=oi(s.gameObject.parent,i),i.x=1/i.x,i.y=1/i.y,i.z=1/i.z;break;default:if(!s.unsupported_scaling_mode){s.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+Ey[s.main.scalingMode]+" is not supported";be()&&Xt(t),console.warn(t,s.name,s)}i=oi(s.gameObject,i);break}return i}new x(1,1,1);new x(0,0,1);class UE{constructor(i,t,n,r){h(this,"system");h(this,"particleSystem");h(this,"subSystem");h(this,"subParticleSystem");h(this,"type","NeedleParticleSubEmitter");h(this,"emitterType");h(this,"emitterProbability");h(this,"q_",new se);h(this,"v_",new x);h(this,"v2_",new x);h(this,"_emitterMatrix",new le);h(this,"_circularBuffer");this.system=i,this.particleSystem=t,this.subSystem=n,this.subParticleSystem=r,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const o=1e3;this._circularBuffer=new wo(()=>new le,o)}clone(){throw new Error("Method not implemented.")}initialize(i){i.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===Uy.Birth&&this.run(i)}update(i,t){this.run(i)}frameUpdate(i){}toJSON(){}reset(){}run(i){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!i.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===Uy.Death){let r=i.life;if(i[Vd]!==void 0&&(r=i[Vd]),!(i.age+t*1.2>=r))return;const a=this.subSystem.main.maxParticles-this.subSystem.currentParticles;i.emissionState.waitEmiting=a}const n=new le;n.set(1,0,0,i.position.x,0,1,0,i.position.y,0,0,1,i.position.z,0,0,0,1),this.particleSystem.worldSpace||n.multiplyMatrices(this._emitterMatrix,n),this.subParticleSystem.emit(t,i.emissionState,n)}}var hX=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Ab extends Es{constructor(){super(...arguments);h(this,"granularity",new Ae(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new dk;return this.granularity.onValueChanged=n=>{t.granularity=n},t}}hX([v(Ae)],Ab.prototype,"granularity",void 0);oa("PixelationEffect",Ab);class um extends oe{constructor(){super(...arguments);h(this,"_didAssignPlayerColor",!1);h(this,"tryAssignColor",()=>{const t=j.getComponentInParent(this.gameObject,Zn);if(t&&t.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(t.owner),!0;const n=j.getComponentInParent(this.gameObject,_n);return n!=null&&n.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(n.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(je.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(je.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield G6(.2),!this.tryAssignColor()););}assignUserColor(t){const n=um.hashCode(t),r=um.colorFromHashCode(n);if(this.gameObject.type==="Mesh"){const o=this.gameObject;this.assignColor(r,t,o)}else if(this.gameObject.children)for(const o of this.gameObject.children){const a=o;a.material&&a.material.color&&this.assignColor(r,t,a)}}assignColor(t,n,r){let o=r.material;o&&(o._playerMaterial!==n&&(o=o.clone(),o._playerMaterial=n,r.material=o),o.color=t)}static hashCode(t){var n=0,r,o;if(t.length===0)return n;for(r=0;r<t.length;r++)o=t.charCodeAt(r),n=(n<<5)-n+o,n|=0;return n}static colorFromHashCode(t){const n=(t&16711680)>>16,r=(t&65280)>>8,o=t&255;return new xe(n/255,r/255,o/255)}}new ku(-1,1,1,-1,0,1);class uX extends Vt{constructor(){super(),this.setAttribute("position",new ln([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ln([0,2,0,0,2,0],2))}}new uX;const Jm=new Vt;Jm.setAttribute("position",new Je(new Float32Array([-1,-1,3,-1,-1,3]),2));Jm.setAttribute("uv",new Je(new Float32Array([0,0,2,0,0,2]),2));Jm.boundingSphere=new hc;Jm.computeBoundingSphere=function(){};const dX=new ku;class zh{constructor(i){this._mesh=new Z(Jm,i),this._mesh.frustumCulled=!1}render(i){i.render(this._mesh,dX)}get material(){return this._mesh.material}set material(i){this._mesh.material=i}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const fX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new le},viewMat:{value:new le},projViewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new x},resolution:{value:new ae},biasAdjustment:{value:new ae},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(linDepth, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          #ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + farMinusNear * sampleDepth;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},pX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new le},viewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new x},resolution:{value:new ae},color:{value:new x(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},gX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new le},viewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new x},resolution:{value:new ae},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},mX={uniforms:{sceneDepth:{value:null},resolution:{value:new ae},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new le},projectionMatrixInv:{value:new le},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var X2="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";const AX=Uint8Array.from(atob(X2),s=>s.charCodeAt(0));function Y2(s,i,t){if(i.getQueryParameter(s,i.QUERY_RESULT_AVAILABLE)){const o=i.getQueryParameter(s,i.QUERY_RESULT)/1e6;t.lastTime=t.lastTime===0?o:t.timeRollingAverage*t.lastTime+(1-t.timeRollingAverage)*o}else setTimeout(()=>{Y2(s,i,t)},1)}class K2 extends Rn{constructor(i,t,n=512,r=512){super(),this.width=n,this.height=r,this.clear=!0,this.camera=t,this.scene=i,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new xe(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(o,a,l)=>{const c=o[a];return o[a]=l,l.equals?l.equals(c)||this.firstFrame():c!==l&&this.firstFrame(),a==="aoSamples"&&c!==l&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="denoiseSamples"&&c!==l&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="halfRes"&&c!==l&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),a==="depthAwareUpsampling"&&c!==l&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="gammaCorrection"&&(this.autosetGamma=!1),a==="transparencyAware"&&c!==l&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new le,this.lastProjectionMatrix=new le,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new zh(new et({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:qi}),this.readTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:qi}),this.outputTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1}),this.accumulationRenderTarget=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:qi,type:$n,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new zh(new et({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Uf(AX,128,128),this.bluenoise.colorSpace=xu,this.bluenoise.wrapS=ic,this.bluenoise.wrapT=ic,this.bluenoise.minFilter=Zt,this.bluenoise.magFilter=Zt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new ae,this._c=new xe}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new Et(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=qc,this.depthDownsampleTarget.textures[0].type=Ao,this.depthDownsampleTarget.textures[0].minFilter=Zt,this.depthDownsampleTarget.textures[0].magFilter=Zt,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=qi,this.depthDownsampleTarget.textures[1].type=$n,this.depthDownsampleTarget.textures[1].minFilter=Zt,this.depthDownsampleTarget.textures[1].magFilter=Zt,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new zh(new et(mX))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let i=!1;this.scene.traverse(t=>{t.material&&t.material.transparent&&(i=!0)}),i&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Et(this.width,this.height,{minFilter:Mt,magFilter:Zt,type:$n,format:qi}),this.transparencyRenderTargetDWTrue=new Et(this.width,this.height,{minFilter:Mt,magFilter:Zt,type:$n,format:qi}),this.transparencyRenderTargetDWTrue.depthTexture=new EC(this.width,this.height,vP),this.depthCopyPass=new zh(new et({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(i){const t=this.scene.background,n=i.getClearColor(new xe),r=i.getClearAlpha(),o=new Map,a=i.autoClearDepth;this.scene.traverse(l=>{o.set(l,l.visible)}),this.scene.background=null,i.autoClearDepth=!1,i.setClearColor(new xe(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,i.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&(l.material.transparent&&!l.material.depthWrite&&!l.userData.treatAsOpaque||!!l.userData.cannotReceiveAO))}),i.clear(!0,!0,!0),this.depthCopyPass.render(i),i.render(this.scene,this.camera),i.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&l.material.transparent&&l.material.depthWrite&&!l.userData.treatAsOpaque)}),i.clear(!0,!0,!0),this.depthCopyPass.render(i),i.render(this.scene,this.camera),this.scene.traverse(l=>{l.visible=o.get(l)}),i.setClearColor(n,r),this.scene.background=t,i.autoClearDepth=a}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(i=!1,t=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const n={...fX};n.fragmentShader=n.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),i&&(n.fragmentShader=`#define LOGDEPTH
`+n.fragmentShader),t&&(n.fragmentShader=`#define ORTHO
`+n.fragmentShader),this.configuration.halfRes&&(n.fragmentShader=`#define HALFRES
`+n.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new et(n)):this.effectShaderQuad=new zh(new et(n))}configureDenoisePass(i=!1,t=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const n={...gX};n.fragmentShader=n.fragmentShader.replace("16",this.configuration.denoiseSamples),i&&(n.fragmentShader=`#define LOGDEPTH
`+n.fragmentShader),t&&(e.fragmentShader=`#define ORTHO
`+e.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new et(n)):this.poissonBlurQuad=new zh(new et(n))}configureEffectCompositer(i=!1,t=!1){this.firstFrame();const n={...pX};i&&(n.fragmentShader=`#define LOGDEPTH
`+n.fragmentShader),t&&(n.fragmentShader=`#define ORTHO
`+n.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(n.fragmentShader=`#define HALFRES
`+n.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new et(n)):this.effectCompositerQuad=new zh(new et(n))}generateHemisphereSamples(i){const t=[];for(let n=0;n<i;n++){const r=2.399963*n,o=Math.sqrt(n+.5)/Math.sqrt(i),a=o*Math.cos(r),l=o*Math.sin(r),c=Math.sqrt(1-(a*a+l*l));t.push(new x(a,l,c))}return t}generateDenoiseSamples(i,t){const n=2*Math.PI*t/i,r=1/i,o=r,a=[];let l=r,c=0;for(let u=0;u<i;u++)a.push(new ae(Math.cos(c),Math.sin(c)).multiplyScalar(Math.pow(l,.75))),l+=o,c+=n;return a}setSize(i,t){this.firstFrame(),this.width=i,this.height=t;const n=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(i*n,t*n),this.readTargetInternal.setSize(i*n,t*n),this.accumulationRenderTarget.setSize(i*n,t*n),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(i*n,t*n),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(i,t),this.transparencyRenderTargetDWTrue.setSize(i,t)),this.outputTargetInternal.setSize(i,t)}setDepthTexture(i){this.depthTexture=i}firstFrame(){this.needsFrame=!0}render(i,t,n){const r=i.xr.enabled;i.xr.enabled=!1,i.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=i.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(t.texture.type!==this.outputTargetInternal.texture.type||t.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.format=t.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(i.setRenderTarget(this.accumulationRenderTarget),i.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let o,a,l;this.debugMode&&(o=i.getContext(),a=o.getExtension("EXT_disjoint_timer_query_webgl2"),a===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(l=o.createQuery(),o.beginQuery(a.TIME_ELAPSED_EXT,l)),this.configuration.transparencyAware&&this.renderTransparency(i),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(i.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(i)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new x),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new ae(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=i.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,i.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(i);for(let d=0;d<this.configuration.denoiseIterations;d++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new x),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=d,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=i.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,i.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(i);i.setRenderTarget(this.accumulationRenderTarget);const u=i.autoClear;i.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(i),i.autoClear=u}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=i.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new x),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),i.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(i),i.setRenderTarget(this.renderToScreen?null:n),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(i),this.debugMode&&(o.endQuery(a.TIME_ELAPSED_EXT),Y2(l,o,this)),i.xr.enabled=r}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(i){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(i)}setQualityMode(i){i==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):i==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):i==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):i==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):i==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(X2),s=>s.charCodeAt(0));var J2=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class vb extends Es{constructor(){super(...arguments);h(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new Z2),this._effect}set amount(t){this.effect.uniforms.get("amount").value=t}get amount(){return this.effect.uniforms.get("amount").value}set radius(t){this.effect.uniforms.get("radius").value=t}get radius(){return this.effect.uniforms.get("radius").value}}J2([v()],vb.prototype,"amount",null);J2([v()],vb.prototype,"radius",null);const vX=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,yX=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class Z2 extends Ys{constructor(){super("Sharpening",yX,{vertexShader:vX,blendFunction:Ze.NORMAL,uniforms:new Map([["amount",new ee(1)],["radius",new ee(1)]])})}}const Qh=Q("debugpost"),ww=Symbol("needle:postprocessing-handler"),xw=Symbol("needle:previous-autoclear-state");class NE{constructor(i){h(this,"_composer",null);h(this,"_lastVolumeComponents");h(this,"_effects",[]);h(this,"_isActive",!1);h(this,"context");this.context=i}get isActive(){return this._isActive}get composer(){return this._composer}apply(i){this._isActive=!0,this.onApply(this.context,i)}unapply(){var n;if(Qh&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const r of this._lastVolumeComponents)r.unapply();this._lastVolumeComponents.length=0}const i=this.context;i[ww]===this&&delete i[ww],i.composer===this._composer&&((n=i.composer)==null||n.dispose(),i.composer=null),typeof i.renderer[xw]=="boolean"&&(i.renderer.autoClear=i.renderer[xw])}dispose(){this.unapply();for(const i of this._effects)i.dispose();this._effects.length=0,this._composer=null}onApply(i,t){if(!t)return;i[ww]=this,Qh&&console.log("refreshing volume profile",t),this._lastVolumeComponents=[...t],this._effects.length=0;const n={handler:this,components:this._lastVolumeComponents};for(let r=0;r<this._lastVolumeComponents.length;r++){const o=this._lastVolumeComponents[r];if(o.context=i,o.apply){if(o.active){if(!i.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const a=o.apply(n);if(!a)continue;Array.isArray(a)?this._effects.push(...a):this._effects.push(a)}}else o.active&&Xt("Volume component is not a VolumeComponent: "+o.__type)}if(this.context.renderer.toneMapping!=Cf&&!this._effects.find(r=>r instanceof $v)){const r=new $v;this._effects.push(r)}this.applyEffects(i)}applyEffects(i){const t=this._effects;if(t.length<=0)return;const n=i.mainCameraComponent,r=i.renderer,o=i.scene,a=n.cam;r[xw]=r.autoClear;const l=r.capabilities.maxSamples;this._composer||(this._composer=new pS(r,{frameBufferType:$n,stencilBuffer:!0,multisampling:Math.min(uc()?4:8,l)})),i.composer&&i.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),i.composer=this._composer;const c=i.composer;c.setMainCamera(a),c.setRenderer(r),c.setMainScene(o);for(const d of c.passes)d.dispose();c.removeAllPasses();const u=new y0(o,a);u.name="Render To Screen",u.mainScene=o,c.addPass(u);try{this.orderEffects();const d=[];for(const f of t)if(f instanceof Ys)d.push(f);else if(f instanceof Rn){const p=new $1(a,...d);p.mainScene=o,p.name=d.map(g=>g.constructor.name).join(", "),p.enabled=!0,d.length=0,c.addPass(f)}if(d.length>0){const f=new $1(a,...d);f.name=d.map(p=>p.name).join(" "),f.mainScene=o,f.enabled=!0,c.addPass(f)}}catch(d){console.error("Error while applying postprocessing effects",d),c.removeAllPasses()}Qh&&console.log("PostProcessing Passes",t,"->",c.passes)}orderEffects(){var t;Qh&&console.log("Before ordering effects",[...this._effects]);const i=this._effects;i.sort((n,r)=>{const o=jB.findIndex(l=>n.constructor.name.endsWith(l.name)),a=jB.findIndex(l=>r.constructor.name.endsWith(l.name));return o<0?(Qh&&console.warn("Unknown effect found: ",n.constructor.name),-1):a<0?(Qh&&console.warn("Unknown effect found: ",r.constructor.name),1):o<0?1:a<0?-1:o-a}),Qh&&console.log("After ordering effects",[...this._effects]);for(let n=0;n<i.length;n++){const r=i[n];if(((t=r==null?void 0:r.configuration)==null?void 0:t.gammaCorrection)!==void 0){const o=n===i.length-1;r.configuration.gammaCorrection=o}}}}const jB=[vk,vS,pk,gk,K2,mk,hk,ak,mS,fk,Ak,dk,$v,uk,ok,Z2];async function zE(s){const{NeedleEngineHTMLElement:i}=await hh(()=>Promise.resolve().then(()=>pY),void 0,import.meta.url);i.observedAttributes.includes(s)||i.observedAttributes.push(s)}var Zm=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const co=Q("debugskybox");zE("skybox-image");zE("environment-image");function GB(s,i,t,n,r){const o=new lc;o.allowDrop=!1,o.allowNetworking=!1,o.background=t,o.environment=n,j.addComponent(s.scene,o);const a=l=>{typeof l=="string"&&(co&&console.log(r,"CHANGED TO",l),o.setSkybox(l))};return pU(s.domElement,r,a),o.addEventListener("destroy",()=>{co&&console.log("Destroyed attribute remote skybox",r),gU(s.domElement,r,a)}),o.setSkybox(i)}xt.addContextCreatedCallback(s=>{var o;const i=s.context,t=i.domElement.getAttribute("skybox-image"),n=i.domElement.getAttribute("environment-image"),r=new Array;if(t){co&&console.log("Creating remote skybox to load "+t),((o=i.mainCameraComponent)==null?void 0:o.clearFlags)!==hr.Skybox&&console.warn('"skybox-image" attribute has no effect: camera clearflags are not set to "Skybox"');const a=GB(i,t,!0,!1,"skybox-image");r.push(a)}if(n){co&&console.log("Creating remote environment to load "+n);const a=GB(i,n,!1,!0,"environment-image");r.push(a)}return r.length>0?NC(r):Promise.resolve()});function $2(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function HB(s){const t=$2().find(n=>n.src===s);return t?(co&&console.log("Skybox: Found previously loaded texture for "+s),t.texture):null}async function bX(s){const i=await s;jD(i,!0),si(i)}function _X(s,i){const t=$2();for(;t.length>5;){const n=t.shift();n&&bX(n.texture)}i.then(n=>jD(n,!1)),t.push({src:s,texture:i})}class lc extends oe{constructor(){super(...arguments);h(this,"url");h(this,"allowDrop",!0);h(this,"background",!0);h(this,"environment",!0);h(this,"allowNetworking",!0);h(this,"_loader");h(this,"_prevUrl");h(this,"_prevLoadedEnvironment");h(this,"_prevEnvironment",null);h(this,"_prevBackground",null);h(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]);h(this,"onDragOverEvent",t=>{if(this.allowDrop&&t.dataTransfer)for(const n of t.dataTransfer.types)(n==="text/uri-list"||n==="Files")&&t.preventDefault()});h(this,"onDrop",t=>{var n,r,o,a;if(this.allowDrop&&t.dataTransfer){for(const l of t.dataTransfer.types)if(co&&console.log(l),l==="text/uri-list"){const c=t.dataTransfer.getData(l);co&&console.log(l,c);let u=(r=(n=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(c))==null?void 0:n.groups)==null?void 0:r.name;if(u||(u=(a=(o=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(c))==null?void 0:o.groups)==null?void 0:a.name),co&&console.log(u),u){const d="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+u+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${d}`),t.preventDefault(),this.setSkybox(d);break}else if(this.isValidTextureType(c)){console.log("[Remote Skybox] Setting skybox from url: "+c),t.preventDefault(),this.setSkybox(c);break}else{console.warn(`[RemoteSkybox] Unknown url ${c}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const d=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:t,url:c,apply:f=>{t.preventDefault(),this.setSkybox(f)}}});this.dispatchEvent(d)}}else if(l=="Files"){const c=t.dataTransfer.files.item(0);if(co&&console.log(l,c),!c)continue;if(!this.isValidTextureType(c.name)){console.warn(`[RemoteSkybox]: File "${c.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(HB(c.name)===null){const u=new Blob([c]),d=URL.createObjectURL(u);t.preventDefault(),this.setSkybox(d,c.name)}else t.preventDefault(),this.setSkybox(c.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Bt.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(t,n){var a;if(!this.activeAndEnabled||(t=wX(t,this.environment,this.background),!t))return!1;if(n??(n=t),this.isValidTextureType(n)||console.warn("Potentially invalid skybox url",n,"on",this.name),co&&console.log("Set remote skybox url: "+t),this._prevUrl===t&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(a=this._prevLoadedEnvironment)==null||a.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=t;const r=await this.loadTexture(t,n);if(!r||!this.enabled)return!1;this.url=t;const o=t.lastIndexOf("/");return r.name=t.substring(o>=0?o+1:0),this._loader instanceof Xa&&(r.colorSpace=He),this._prevLoadedEnvironment=r,this.applySkybox(),!0}async loadTexture(t,n){var u,d,f,p,g;if(!t)return Promise.resolve(null);n??(n=t);const r=HB(n);if(r){const m=await r;if(((d=(u=m.source)==null?void 0:u.data)==null?void 0:d.length)>0||(g=(p=(f=m.source)==null?void 0:f.data)==null?void 0:p.data)!=null&&g.length)return m}const o=n.endsWith(".exr"),a=n.endsWith(".hdr");o?this._loader instanceof sm||(this._loader=new sm):a?this._loader instanceof uy||(this._loader=new uy):this._loader instanceof Xa||(this._loader=new Xa),co&&console.log("Loading skybox: "+t);const l=this._loader.loadAsync(t);return _X(n,l),await l}applySkybox(){var n;const t=this._prevLoadedEnvironment;t&&(t.mapping=eU,t.needsUpdate=!0,this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),co&&console.log("Set remote skybox",this.url,!Bt.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=t),this.background&&!Bt.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((n=this.context.mainCameraComponent)==null?void 0:n.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(t){return t.startsWith("http://")||t.startsWith("https://")}isValidTextureType(t){for(const n of this.validTextureTypes)if(t.endsWith(n))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}Zm([e2(lc.prototype.urlChangedSyncField),v(URL)],lc.prototype,"url",void 0);Zm([v()],lc.prototype,"allowDrop",void 0);Zm([v()],lc.prototype,"background",void 0);Zm([v()],lc.prototype,"environment",void 0);Zm([v()],lc.prototype,"allowNetworking",void 0);function wX(s,i,t){const n=i&&!t;switch(s==null?void 0:s.toLowerCase()){case"studio":return n?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return n?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return n?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return n?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return s===void 0?null:s}var Bs=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const cr=Q("debugsceneswitcher"),xX=Q("sceneswitcher:clearscene"),Fv="scene";zE(Fv);const Mc=Promise.resolve(!1);class Mn extends oe{constructor(){super(...arguments);h(this,"autoLoadFirstScene",!0);h(this,"scenes",[]);h(this,"loadingScene");h(this,"queryParameterName","scene");h(this,"useSceneName",!0);h(this,"clamp",!0);h(this,"useHistory",!0);h(this,"useKeyboard",!0);h(this,"useSwipe",!0);h(this,"useSceneLighting",!0);h(this,"useSceneBackground",!0);h(this,"preloadNext",1);h(this,"preloadPrevious",1);h(this,"preloadConcurrent",2);h(this,"createMenuButtons",!1);h(this,"sceneLoaded",new ti);h(this,"_currentIndex",-1);h(this,"_currentScene");h(this,"_engineElementOverserver");h(this,"_preloadScheduler");h(this,"_menuButtons");h(this,"onPopState",async t=>{if(!this.useHistory)return;const n=this.useHistory;try{this.useHistory=!1;let r=!1;if(this.queryParameterName&&(r=await this.tryLoadFromQueryParam()),!r){const o=t==null?void 0:t.state;if(o&&o.startsWith(this.guid)){const a=o.substr(this.guid.length+2);cr&&console.log("PopState",a),await this.trySelectSceneFromValue(a)}}}finally{this.useHistory=n}});h(this,"normalizedSwipeThresholdX",.1);h(this,"_didSwipe",!1);h(this,"onInputPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const n=this.context.input.getPointerPositionDelta(t.button);if(n){const r=n.x/this.context.domWidth;r>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):r<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});h(this,"onInputPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});h(this,"onInputKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const n=t.key.toLowerCase();if(!n)return;const r=parseInt(n)-1;if(r>=0){this.trySelectSceneFromValue(r);return}switch(n){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});h(this,"__lastSwitchScene");h(this,"__lastSwitchScenePromise");h(this,"_currentlyLoadingScene");h(this,"_lastLoadingScene");h(this,"_loadingScenePromise");h(this,"_isCurrentlyLoading",!1);h(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const t of this.scenes)t&&!t.hasUrl&&t.asset instanceof ne&&t.asset.removeFromParent();cr&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(dt.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(dt.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(dt.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const n of t)if(n.type==="attributes"&&n.attributeName===Fv){const r=this.context.domElement.getAttribute(Fv);r!==null&&this.trySelectSceneFromValue(r)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new CX(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(Fv);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var t;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(dt.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(dt.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(dt.PointerUp,this.onInputPointerUp),(t=this._preloadScheduler)==null||t.stop(),this._menuButtons){for(const n of this._menuButtons)n.remove();this._menuButtons=void 0}}addScene(t){if(typeof t=="string"){let n=this.context.addressables.findAssetReference(t);return n||(n=new tt(t),this.context.addressables.registerAssetReference(n)),this.scenes.push(n),n}return this.scenes.push(t),t}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var r,o,a;if(cr&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const l=(r=this.scenes)==null?void 0:r.find(c=>c.uri===t);if(!l){const c=tt.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(c)}if(l)t=(o=this.scenes)==null?void 0:o.indexOf(l);else return Mc}if(!((a=this.scenes)!=null&&a.length))return Mc;if(t<0){if(this.clamp)return Mc;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return Mc;t=0}const n=this.scenes[t];return this.switchScene(n)}async switchScene(t){if(!(t instanceof tt)){const r=typeof t;return r==="string"?this.select(t):r==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",r),!1)}return t.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __internalSwitchScene(t){var r,o,a,l;if(this._currentScene){cr&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const c=this.tryGetSceneEventListener(this._currentScene.asset);if(c!=null&&c.sceneClosing){const u=c.sceneClosing();u instanceof Promise&&await u}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ne&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const n=this._currentIndex=((r=this.scenes)==null?void 0:r.indexOf(t))??-1;try{this._currentlyLoadingScene=t,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const c=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:n}});this.dispatchEvent(c),await this.onStartLoading(),await t.loadAssetAsync((d,f)=>{this._currentLoadingProgress=f,this.dispatchEvent(f)}).catch(console.error),await this.onEndLoading();const u=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:n}});if(this.dispatchEvent(u),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,u.defaultPrevented)return cr&&console.warn("Adding loaded scene prevented:",t,u),!1;if(!t.asset)return cr&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===n){if(cr&&console.log("ADD",t.uri),this._currentScene=t,xX){const p=((o=this.context.mainCameraComponent)==null?void 0:o.gameObject)||this.context.mainCamera;p==null||p.removeFromParent();const g=this.gameObject.removeFromParent();xo(this.context.scene,!0,!0),this.context.scene=new ws,this.context.scene.add(g),p&&this.context.scene.add(p)}if(j.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useSceneBackground){const p=this.context.lightmaps.tryGetSkybox(t.url);p?(p.mapping=Ya,this.context.scene.background=p):cr&&console.warn("SceneSwitcher: Can't find skybox for scene "+t.url)}if(this.useHistory&&n>=0){let p=n.toString();if(this.useSceneName&&(p=VB(t.uri)),(a=this.queryParameterName)!=null&&a.length)Qw(this.queryParameterName,p,this.useHistory);else{const g=history.state,m=this.guid+"::"+n;g!==m&&history.pushState(m,"unused",location.href)}}const d=this.tryGetSceneEventListener(t.asset);if(d!=null&&d.sceneOpened){const p=d.sceneOpened(this);p instanceof Promise&&await p}const f=new CustomEvent("scene-opened",{detail:{scene:t,switcher:this,index:n}});return this.dispatchEvent(f),(l=this.sceneLoaded)==null||l.invoke(this),!0}}catch(c){console.error(c)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const n=this.scenes[t];if(n instanceof tt)return n.preload()}return Mc}tryLoadFromQueryParam(){var n;if(!((n=this.queryParameterName)!=null&&n.length))return Mc;const t=Q(this.queryParameterName);return typeof t=="boolean"?Mc:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const n=parseInt(t);if(n>=0&&n<this.scenes.length)return this.select(n);{const r=t.toLowerCase();for(let o=0;o<this.scenes.length;o++){const a=this.scenes[o];if(a&&VB(a.uri).toLowerCase().includes(r))return this.select(o)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return fr()&&console.warn('Can not find scene: "'+t+'"',this),Mc}async onStartLoading(){var t,n;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((n=this.loadingScene)!=null&&n.asset))){cr&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const r=this.loadingScene.asset;j.add(r,this.gameObject);const o=this.tryGetSceneEventListener(r);if(o!=null&&o.sceneOpened){const a=o.sceneOpened(this);a instanceof Promise&&await a}}if(this._isCurrentlyLoading){const r=this.tryGetSceneEventListener(this.gameObject);if(r&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){cr&&console.log("Remove loading scene",this.loadingScene.uri);const n=this.loadingScene.asset,r=this.tryGetSceneEventListener(n);if(typeof(r==null?void 0:r.sceneClosing)=="function"){const o=r.sceneClosing();o instanceof Promise&&await o}j.remove(n)}if(!this._isCurrentlyLoading){const n=this.tryGetSceneEventListener(this.gameObject);if(n&&n.sceneClosing){const r=n.sceneClosing();r instanceof Promise&&await r}}}tryGetSceneEventListener(t,n=0){const r=j.foreachComponent(t,o=>o.sceneClosing?o:void 0);if(n===0&&!r&&t.children.length)for(const o of t.children){const a=this.tryGetSceneEventListener(o,n+1);if(a)return a}return r||null}}Bs([v()],Mn.prototype,"autoLoadFirstScene",void 0);Bs([v(tt)],Mn.prototype,"scenes",void 0);Bs([v(tt)],Mn.prototype,"loadingScene",void 0);Bs([v()],Mn.prototype,"queryParameterName",void 0);Bs([v()],Mn.prototype,"useSceneName",void 0);Bs([v()],Mn.prototype,"clamp",void 0);Bs([v()],Mn.prototype,"useHistory",void 0);Bs([v()],Mn.prototype,"useKeyboard",void 0);Bs([v()],Mn.prototype,"useSwipe",void 0);Bs([v()],Mn.prototype,"useSceneLighting",void 0);Bs([v()],Mn.prototype,"useSceneBackground",void 0);Bs([v()],Mn.prototype,"preloadNext",void 0);Bs([v()],Mn.prototype,"preloadPrevious",void 0);Bs([v()],Mn.prototype,"preloadConcurrent",void 0);Bs([v()],Mn.prototype,"createMenuButtons",void 0);Bs([v(ti)],Mn.prototype,"sceneLoaded",void 0);function VB(s){const i=s.split("/").pop(),t=i==null?void 0:i.split(".").shift();return t!=null&&t.length?t:s}class CX{constructor(i,t=1,n=1,r=2){h(this,"maxLoadAhead");h(this,"maxLoadBehind");h(this,"maxConcurrent");h(this,"_isRunning",!1);h(this,"_switcher");h(this,"_loadTasks",[]);h(this,"_maxConcurrentLoads",1);this._switcher=i,this.maxLoadAhead=t,this.maxLoadBehind=n,this.maxConcurrent=r}begin(){if(this._isRunning)return;cr&&console.log("Preload begin"),this._isRunning=!0;let i=-1,t,n;const r=this._switcher.scenes,o=setInterval(()=>{if(this.allLoaded()&&(cr&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(o);return}if(this.canLoadNewScene()===!1)return;i!==this._switcher.currentIndex&&(i=this._switcher.currentIndex,n=0,t=0);const a=n%2===0;a&&(t+=1),n+=1;const l=a?this.maxLoadAhead:this.maxLoadBehind;if(t>l)return;const c=a?i+t:i-t;if(c<0||c<0||c>=r.length)return;const u=r[c];new SX(c,u,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const i of this._switcher.scenes)if((i==null?void 0:i.isLoaded())===!1)return!1}return!0}}class SX{constructor(i,t,n){h(this,"index");h(this,"asset");h(this,"tasks");this.index=i,this.asset=t,this.tasks=n,n.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(cr&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),cr&&console.log("Preload finished: "+this.asset.uri,this.index));const i=this.tasks.indexOf(this);i>=0&&this.tasks.splice(i,1)}}function EX(){return new Promise((s,i)=>{const n=()=>{n!=null&&(document.removeEventListener("pointerdown",n),document.removeEventListener("click",n),document.removeEventListener("dragstart",n),document.removeEventListener("touchstart",n),s())};document.addEventListener("pointerdown",n),document.addEventListener("click",n),document.addEventListener("dragstart",n),document.addEventListener("touchstart",n)})}async function IX(s){await EX(),s()}var Vr=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const gn=Q("debugvideo");var Vc;(function(s){s[s.None=0]="None",s[s.AdjustHeight=1]="AdjustHeight",s[s.AdjustWidth=2]="AdjustWidth"})(Vc||(Vc={}));var Bl;(function(s){s[s.VideoClip=0]="VideoClip",s[s.Url=1]="Url"})(Bl||(Bl={}));var Sg;(function(s){s[s.None=0]="None",s[s.AudioSource=1]="AudioSource",s[s.Direct=2]="Direct",s[s.APIOnly=3]="APIOnly"})(Sg||(Sg={}));var Eg;(function(s){s[s.CameraFarPlane=0]="CameraFarPlane",s[s.CameraNearPlane=1]="CameraNearPlane",s[s.RenderTexture=2]="RenderTexture",s[s.MaterialOverride=3]="MaterialOverride"})(Eg||(Eg={}));class Tn extends oe{constructor(){super();h(this,"playOnAwake",!0);h(this,"aspectMode",Vc.None);h(this,"clip",null);h(this,"source",Bl.Url);h(this,"_url",null);h(this,"renderMode");h(this,"targetMaterialProperty");h(this,"targetMaterialRenderer");h(this,"targetTexture");h(this,"time",0);h(this,"_playbackSpeed",1);h(this,"_isLooping",!1);h(this,"_muted",!1);h(this,"_audioOutputMode",Sg.Direct);h(this,"playInBackground",!0);h(this,"_crossOrigin","anonymous");h(this,"_videoElement",null);h(this,"_videoTexture",null);h(this,"_videoMaterial",null);h(this,"_isPlaying",!1);h(this,"wasPlaying",!1);h(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});h(this,"_receivedInput",!1);h(this,"_overlay",null);h(this,"_targetObjects");h(this,"_updateAspectRoutineId",-1);h(this,"_hls");h(this,"onHlsAvailable",()=>{var t;gn&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(t=this._videoElement)==null||t.play(),gn&&console.log("HLS: loaded",this.clip))});IX(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],Q("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(t){const r=this._url!==t;this.__didAwake?r&&this.setClipURL(t??""):this._url=t}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}get currentVideo(){return this.clip}set audioOutputMode(t){t!==this._audioOutputMode&&(t===Sg.AudioSource&&be()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){gn&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(t){this.clip=t,this.source=Bl.VideoClip,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(t){this._url!==t&&(this._url=t,this.source=Bl.Url,gn&&console.log("set url",t),this._videoElement?t.endsWith(".m3u8")||t.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var t,n;gn&&console.log("VideoPlayer.onEnable",Bl[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(t=this._overlay)==null||t.start():(n=this._overlay)==null||n.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this.videoElement)==null||t.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,n;if(this._videoElement||this.create(!1),!this._videoElement){gn&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((n=this._videoElement)!=null&&n.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}gn&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(r=>{var o;console.log(r),gn&&console.error("Error playing video",r,"CODE="+r.code,(o=this.videoElement)==null?void 0:o.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),gn&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),gn&&console.log("STOP",this))}pause(){var t,n;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(n=this._videoElement)==null||n.pause(),gn&&console.log("PAUSE",this,this.currentTime)}create(t){let n;switch(this.source){case Bl.VideoClip:n=this.clip;break;case Bl.Url:n=this.url,!(n!=null&&n.length)&&typeof this.clip=="string"&&(n=this.clip);break}return n?(this._videoElement||(gn&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof n=="string"?(gn&&console.log("Set Video src",n),this._videoElement.src=n):(gn&&console.log("Set Video srcObject",n),this._videoElement.srcObject=n),this._videoTexture||(this._videoTexture=new tU(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=He,t&&this.handleBeginPlaying(t),gn&&console.log("Video: handle playing done...",n,t),!0):(gn&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==Vc.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var n;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new TX(this.context)),this._overlay.add(this._videoTexture)}else(n=this._overlay)==null||n.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),gn&&console.log("created video element",t),t}handleBeginPlaying(t){var o,a;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let n=this.gameObject;switch(this.renderMode){case Eg.MaterialOverride:n=(o=this.targetMaterialRenderer)==null?void 0:o.gameObject,n||(n=(a=j.getComponent(this.gameObject,ci))==null?void 0:a.gameObject);break;case Eg.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!n){console.error("Missing target for video material renderer",this.name,Eg[this.renderMode],this);return}const r=n.material;if(r){this._targetObjects.push(n),r!==this._videoMaterial&&(this._videoMaterial=r.clone(),n.material=this._videoMaterial);const l="map",c=this._videoMaterial;if(!this.targetMaterialProperty)c[l]=this._videoTexture;else switch(this.targetMaterialProperty){default:c[l]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===Sg.None;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,n=void 0,r=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==Vc.None&&this.clip&&r===this.clip&&this._isPlaying;){if(!r||typeof r=="string")return;let o;for(const a of r.getVideoTracks()){const l=a.getSettings();if(l&&l.width&&l.height){o=l.width/l.height;break}else o=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(o===void 0){for(let a=0;a<10;a++)yield;if(!this.isPlaying)break;continue}if(n===o){yield;continue}for(const a of this._targetObjects){let l=1;if(a.parent){const c=oi(a.parent);l=c.x/c.y}switch(this.aspectMode){case Vc.AdjustHeight:a.scale.y=1/o*a.scale.x*l;break;case Vc.AdjustWidth:a.scale.x=o*a.scale.y*l;break}}for(let a=0;a<3;a++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===Bl.Url}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let t=document.head.querySelector("script[data-hls_library]");t?globalThis.Hls?this.onHlsAvailable():t.addEventListener("load",this.onHlsAvailable):(gn&&console.log("HLS: load script"),t=document.createElement("script"),t.dataset.hls_library="hls.js",t.src="https://cdn.jsdelivr.net/npm/hls.js@1",t.addEventListener("load",this.onHlsAvailable),document.head.append(t))}}Vr([v()],Tn.prototype,"playOnAwake",void 0);Vr([v()],Tn.prototype,"aspectMode",void 0);Vr([v(URL)],Tn.prototype,"clip",void 0);Vr([v()],Tn.prototype,"source",void 0);Vr([v(URL)],Tn.prototype,"url",null);Vr([v()],Tn.prototype,"renderMode",void 0);Vr([v()],Tn.prototype,"targetMaterialProperty",void 0);Vr([v(ci)],Tn.prototype,"targetMaterialRenderer",void 0);Vr([v(At)],Tn.prototype,"targetTexture",void 0);Vr([v()],Tn.prototype,"time",void 0);Vr([v()],Tn.prototype,"playbackSpeed",null);Vr([v()],Tn.prototype,"isLooping",null);Vr([v()],Tn.prototype,"audioOutputMode",null);class TX{constructor(i){h(this,"context");h(this,"_videos",[]);h(this,"_screenspaceModeQuad");h(this,"_isInScreenspaceMode",!1);h(this,"_input");this.context=i,this._input=new RX(this)}get enabled(){return this._isInScreenspaceMode}set enabled(i){i?this.start():this.stop()}add(i){this._videos.indexOf(i)===-1&&this._videos.push(i)}remove(i){if(!i)return;const t=this._videos.indexOf(i);t>=0&&this._videos.splice(t,1)}start(){var r;if(this._isInScreenspaceMode||this._videos.length<0)return;const i=this._videos[this._videos.length-1];if(!i)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Uu.createPrimitive(Ko.Quad,{material:new BX(i)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const n=t.material;n==null||n.reset(),(r=this._input)==null||r.enable(n)}stop(){var i;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((i=this._input)==null||i.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const i=(t=this._screenspaceModeQuad)==null?void 0:t.material;i&&(i.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class RX{constructor(i){h(this,"_onResizeScreenFn");h(this,"_onKeyUpFn");h(this,"_onMouseWheelFn");h(this,"context");h(this,"overlay");h(this,"_material");h(this,"_isPinching",!1);h(this,"_lastPinch",0);this.overlay=i,this.context=i.context}enable(i){this._material=i,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=r=>{r.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=r=>{this.overlay.enabled&&(i.zoom+=r.deltaY*5e-4,r.preventDefault())},{passive:!1});const t=new ae;window.addEventListener("mousemove",r=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const o=new ae(r.movementX,r.movementY);o.x/=this.context.domElement.clientWidth,o.y/=this.context.domElement.clientHeight,t.set(o.x,o.y),t.multiplyScalar(i.zoom/-this.context.time.deltaTime*.01),i.offset=i.offset.add(t)}}),window.addEventListener("pointermove",r=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(r.movementX,r.movementY),t.multiplyScalar(i.zoom*-this.context.time.deltaTime*.05),i.offset=i.offset.add(t))});let n=0;window.addEventListener("touchstart",r=>{if(r.touches.length<2){this.context.time.time-n<.3&&this.overlay.stop(),n=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",r=>{if(!this._isPinching||!this._material)return;const o=r.touches[0],a=r.touches[1],l=o.clientX-a.clientX,c=o.clientY-a.clientY,u=Math.sqrt(l*l+c*c);if(this._lastPinch!==0){const d=u-this._lastPinch;this._material.zoom-=d*.004}this._lastPinch=u}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class BX extends et{constructor(t){super();h(this,"_offset",new ae);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Ue(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const n=this.uniforms.offsetScale.value;n.x=t.x,n.y=t.y,this.uniforms.offsetScale.value=n,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const n=this.uniforms.offsetScale.value;t<.001&&(t=.001),n.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var $m=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Qn=Q("debugscreensharing");var gC;(function(s){s[s.Screen=0]="Screen",s[s.Camera=1]="Camera",s[s.Canvas=2]="Canvas",s[s.Microphone=3]="Microphone"})(gC||(gC={}));var Cr;(function(s){s[s.Idle=0]="Idle",s[s.Sending=1]="Sending",s[s.Receiving=2]="Receiving"})(Cr||(Cr={}));class td extends oe{constructor(){super(...arguments);h(this,"allowStartOnClick",!0);h(this,"autoConnect",!1);h(this,"_videoPlayer");h(this,"_audioSource");h(this,"device","Screen");h(this,"deviceName");h(this,"deviceFilter");h(this,"_net");h(this,"_requestOpen",!1);h(this,"_currentStream",null);h(this,"_currentMode",Cr.Idle);h(this,"onJoinedRoom",async()=>{await nc(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});h(this,"_activeShareRequest",null);h(this,"onReceiveStream",t=>{var n;((n=t.stream)==null?void 0:n.active)===!0&&this.setStream(t.stream,Cr.Receiving)});h(this,"onCallEnded",t=>{Qn&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var n;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((n=this.videoPlayer)!=null&&n.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===Cr.Sending}get isReceiving(){if(this._currentMode===Cr.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const n of t)if(n.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=gC[this.device]),Qn&&console.log("Screensharing",this.name,this),kt.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===Cr.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const t=Ag.getOrCreate(this.context,this.guid);this._net=new H0(this.context,t)}onEnable(){var t,n,r;(t=this._net)==null||t.enable(),(n=this._net)==null||n.addEventListener(Bi.StreamReceived,this.onReceiveStream),(r=this._net)==null||r.addEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(je.JoinedRoom,this.onJoinedRoom),this.autoConnect&&nc(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var t,n,r;(t=this._net)==null||t.removeEventListener(Bi.StreamReceived,this.onReceiveStream),(n=this._net)==null||n.removeEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(je.JoinedRoom,this.onJoinedRoom),(r=this._net)==null||r.disable(),this.close()}_ensureVideoPlayer(){const t=new Tn;t.aspectMode=Vc.AdjustWidth,j.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),be()&&Xt("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=j.getComponent(this.gameObject,Tn)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const n=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},r={video:n,audio:n},o=r.video;switch(o!==void 0&&typeof o!="boolean"&&(o.width||(o.width={max:1920}),o.height||(o.height={max:1920}),o.aspectRatio||(o.aspectRatio={ideal:1.7777777778}),o.frameRate||(o.frameRate={ideal:24}),o.facingMode||(o.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(r,t);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const c=await navigator.mediaDevices.getDisplayMedia(r);this._requestOpen?this.setStream(c,Cr.Sending):Hl(c)}break;case"Canvas":const a=0,l=this.context.renderer.domElement.captureStream(a);this.setStream(l,Cr.Sending);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}r.video=!1;const c=await navigator.mediaDevices.getUserMedia(r);this._requestOpen?this.setStream(c,Cr.Sending):Hl(c)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(n){if(n.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",n)}}close(){var t;this._requestOpen=!1,this._currentStream&&(Qn&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),Hl(this._currentStream),this._currentMode=Cr.Idle,this._currentStream=null)}setStream(t,n){var a,l,c;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=n;const r=this.device!=="Microphone",o=n===Cr.Sending;r?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new kt,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),o||(Qn&&console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(a=this._audioSource)==null||a.play(t))),o&&((l=this._net)==null||l.startSendingStream(t)),o&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(c=this._audioSource)==null||c.stop());for(const u of t.getTracks())u.addEventListener("ended",()=>{Qn&&console.log("Track ended",u),this.close()}),Qn&&u.kind==="video"&&console.log(o?"Video â†’":"Video â†",u.getSettings())}async tryShareUserCamera(t,n){const r=(await navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="videoinput");Qn&&console.log(`Request camera. These are your kind:videoinput devices:
`,r);let o=!1;for(const a of r)try{if(!this._requestOpen){Qn&&console.log("Camera selection cancelled");break}if(a.kind!=="videoinput"){Qn&&console.log("Skipping non-video device",a);continue}const l=a.deviceId;if((n==null?void 0:n.deviceId)!=null||(n==null?void 0:n.deviceFilter)!=null){if((n==null?void 0:n.deviceId)!==void 0&&l!==n.deviceId){Qn&&console.log("Skipping device due to options.deviceId: "+a.label+"; "+a.deviceId);continue}if(n!=null&&n.deviceFilter&&n.deviceFilter(a)===!1){Qn&&console.log("Skipping device due to options.deviceFilter: "+a.label+"; "+a.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(a)===!1){Qn&&console.log("Skipping device due to ScreenShare.deviceFilter: "+a.label+"; "+a.deviceId);continue}else Qn&&console.log("Selected device by filter",a);else if(this.deviceName){const d=a.label.toLowerCase(),f=this.deviceName.toLowerCase(),p=d.includes(f),g=a.deviceId===this.deviceName;if(!p&&!g){Qn&&console.log("Skipping device due to ScreenShare.deviceName: "+a.label+"; "+a.deviceId);continue}else Qn&&console.log("Selected device by name",a)}t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=l),o=!0;const u=await navigator.mediaDevices.getUserMedia(t).catch(d=>(console.error("Failed to get user media",d),null));if(u===null)continue;this._requestOpen?(this.setStream(u,Cr.Sending),Qn&&console.log("Selected camera",a)):(Hl(u),Qn&&console.log("Camera selection cancelled"));break}catch(l){if(l.message==="Failed to allocate videosource"||l.message==="Could not start video source"){Xt("Failed to start video: Try another camera (Code "+l.code+")"),console.warn(l);continue}else console.error("Failed to get user media",l.message,l.code,l)}!o&&be()&&(Xt("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",r,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+n!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(n==null?void 0:n.deviceId)!=null,"Using options.deviceFilter? "+(n==null?void 0:n.deviceFilter)!=null))}}$m([v()],td.prototype,"allowStartOnClick",void 0);$m([v()],td.prototype,"autoConnect",void 0);$m([v(Tn)],td.prototype,"videoPlayer",null);$m([v()],td.prototype,"device",void 0);$m([v()],td.prototype,"deviceName",void 0);var eA=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Eh extends Es{constructor(){super(...arguments);h(this,"intensity",new Ae(2));h(this,"falloff",new Ae(1));h(this,"samples",new Ae(9));h(this,"color",new Ae(new xe(0,0,0)));h(this,"luminanceInfluence",new Ae(.7));h(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof bt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,n=new vk(this.context.scene,t),r=new vS({normalBuffer:n.texture,resolutionScale:.5}),o=this._ssao=new gk(t,n.texture,{normalDepthBuffer:r.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Ze.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=l=>{o.intensity=l},this.falloff.onValueChanged=l=>{o.ssaoMaterial.radius=l*.1},this.samples.onValueChanged=l=>{o.samples=l},this.color.onValueChanged=l=>{o.color||(o.color=new xe),o.color.copy(l)},this.luminanceInfluence.onValueChanged=l=>{o.luminanceInfluence=l};const a=new Array;return a.push(n),a.push(r),a.push(o),a}}eA([v(Ae)],Eh.prototype,"intensity",void 0);eA([v(Ae)],Eh.prototype,"falloff",void 0);eA([v(Ae)],Eh.prototype,"samples",void 0);eA([v(Ae)],Eh.prototype,"color",void 0);eA([v(Ae)],Eh.prototype,"luminanceInfluence",void 0);oa("ScreenSpaceAmbientOcclusion",Eh);var id=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Ig;(function(s){s[s.Performance=0]="Performance",s[s.Low=1]="Low",s[s.Medium=2]="Medium",s[s.High=3]="High",s[s.Ultra=4]="Ultra"})(Ig||(Ig={}));class dl extends Es{constructor(){super(...arguments);h(this,"gammaCorrection",!0);h(this,"aoRadius",new Ae(1));h(this,"falloff",new Ae(1));h(this,"intensity",new Ae(1));h(this,"color",new Ae(new xe(0,0,0)));h(this,"screenspaceRadius",!1);h(this,"quality",Ig.Medium);h(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(Ig[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,n=this._ssao=new K2(this.context.scene,t,this.context.domWidth,this.context.domHeight),r=Ig[this.quality];n.setQualityMode(r),n.configuration.gammaCorrection=this.gammaCorrection,n.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=a=>{n.configuration.intensity=a},this.falloff.onValueChanged=a=>{n.configuration.distanceFalloff=a},this.aoRadius.onValueChanged=a=>{n.configuration.aoRadius=a},this.color.onValueChanged=a=>{n.color||(n.color=new xe),n.configuration.color.copy(a)};const o=new Array;return o.push(n),o}}id([Ss(),v()],dl.prototype,"gammaCorrection",void 0);id([v(Ae)],dl.prototype,"aoRadius",void 0);id([v(Ae)],dl.prototype,"falloff",void 0);id([v(Ae)],dl.prototype,"intensity",void 0);id([v(Ae)],dl.prototype,"color",void 0);id([Ss(),v()],dl.prototype,"screenspaceRadius",void 0);id([Ss(),v()],dl.prototype,"quality",void 0);oa("ScreenSpaceAmbientOcclusionN8",dl);var eL=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Wd;(function(s){s[s.ShadowMask=0]="ShadowMask",s[s.Additive=1]="Additive",s[s.Occluder=2]="Occluder"})(Wd||(Wd={}));class yb extends oe{constructor(){super(...arguments);h(this,"mode",Wd.ShadowMask);h(this,"shadowColor",new Ut(0,0,0,1));h(this,"targetMesh")}start(){if(this.gameObject instanceof Z)this.gameObject instanceof Z&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const t=Uu.createPrimitive(Ko.Quad,{name:"ShadowCatcher",material:new Jn({color:10066329,roughness:1,metalness:0,transparent:!0})});t.receiveShadow=!0,t.geometry.rotateX(-Math.PI/2),this.gameObject.add(t),this.targetMesh=t}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case Wd.ShadowMask:this.applyShadowMaterial();break;case Wd.Additive:this.applyLightBlendMaterial();break;case Wd.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const t=this.targetMesh.material;t.blending=l0,this.applyMaterialOptions(t),t.onBeforeCompile=n=>{n.fragmentShader=n.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const t=new mP;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),this.targetMesh.material=t}else{const t=this.targetMesh.material;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t)}}applyOccluderMaterial(){if(this.targetMesh){let t=this.targetMesh.material;if(!t){const n=new _t;this.targetMesh.material=n,t=n}t.depthWrite=!0,t.stencilWrite=!0,t.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}eL([v()],yb.prototype,"mode",void 0);eL([v(Ut)],yb.prototype,"shadowColor",void 0);var bb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const d1=class extends oe{constructor(){super(...arguments);h(this,"target",null);h(this,"followFactor",.1);h(this,"rotateFactor",.1);h(this,"positionAxes",Nd.All);h(this,"flipForward",!1);h(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(t){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const n=Ve(this.target),r=this._firstUpdate||t?1:ye.clamp01(this.context.time.deltaTime*this.followFactor),o=this.worldPosition;this.positionAxes&Nd.X&&(o.x=ye.lerp(o.x,n.x,r)),this.positionAxes&Nd.Y&&(o.y=ye.lerp(o.y,n.y,r)),this.positionAxes&Nd.Z&&(o.z=ye.lerp(o.z,n.z,r)),this.worldPosition=o}if(this.rotateFactor>0){const n=Ht(this.target);this.flipForward&&n.premultiply(d1._invertForward);const r=this._firstUpdate||t?1:ye.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(n,r)}this._firstUpdate=!1}}};let tl=d1;h(tl,"_invertForward",new se().setFromAxisAngle(new x(0,1,0),Math.PI));bb([v(ne)],tl.prototype,"target",void 0);bb([v()],tl.prototype,"followFactor",void 0);bb([v()],tl.prototype,"rotateFactor",void 0);bb([v()],tl.prototype,"positionAxes",void 0);class PX extends Z{constructor(i){const t=new MX(i),n=new pr(t.image.width*.001,t.image.height*.001),r=new _t({map:t,toneMapped:!1,transparent:!0});super(n,r);function o(a){r.map.dispatchDOMEvent(a)}this.addEventListener("mousedown",o),this.addEventListener("mousemove",o),this.addEventListener("mouseup",o),this.addEventListener("click",o),this.dispose=function(){n.dispose(),r.dispose(),r.map.dispose(),mC.delete(i),this.removeEventListener("mousedown",o),this.removeEventListener("mousemove",o),this.removeEventListener("mouseup",o),this.removeEventListener("click",o)}}}class MX extends jP{constructor(i){super(WB(i)),this.dom=i,this.anisotropy=16,this.colorSpace=He,this.minFilter=Mt,this.magFilter=Mt;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),n={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(i,n),this.observer=t}dispatchDOMEvent(i){i.data&&kX(this.dom,i.type,i.data.x,i.data.y)}update(){this.image=WB(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const mC=new WeakMap;function WB(s){const i=document.createRange(),t=new xe;function n(p){const g=[];let m=!1;function A(){if(m&&(m=!1,p.restore()),g.length===0)return;let y=-1/0,b=-1/0,_=1/0,w=1/0;for(let S=0;S<g.length;S++){const E=g[S];y=Math.max(y,E.x),b=Math.max(b,E.y),_=Math.min(_,E.x+E.width),w=Math.min(w,E.y+E.height)}p.save(),p.beginPath(),p.rect(y,b,_-y,w-b),p.clip(),m=!0}return{add:function(y){g.push(y),A()},remove:function(){g.pop(),A()}}}function r(p,g,m,A){A!==""&&(p.textTransform==="uppercase"&&(A=A.toUpperCase()),d.font=p.fontWeight+" "+p.fontSize+" "+p.fontFamily,d.textBaseline="top",d.fillStyle=p.color,d.fillText(A,g,m+parseFloat(p.fontSize)*.1))}function o(p,g,m,A,y){m<2*y&&(y=m/2),A<2*y&&(y=A/2),d.beginPath(),d.moveTo(p+y,g),d.arcTo(p+m,g,p+m,g+A,y),d.arcTo(p+m,g+A,p,g+A,y),d.arcTo(p,g+A,p,g,y),d.arcTo(p,g,p+m,g,y),d.closePath()}function a(p,g,m,A,y,b){const _=p[g+"Width"],w=p[g+"Style"],S=p[g+"Color"];_!=="0px"&&w!=="none"&&S!=="transparent"&&S!=="rgba(0, 0, 0, 0)"&&(d.strokeStyle=S,d.lineWidth=parseFloat(_),d.beginPath(),d.moveTo(m,A),d.lineTo(m+y,A+b),d.stroke())}function l(p,g){let m=0,A=0,y=0,b=0;if(p.nodeType===Node.TEXT_NODE){i.selectNode(p);const w=i.getBoundingClientRect();m=w.left-c.left-.5,A=w.top-c.top-.5,y=w.width,b=w.height,r(g,m,A,p.nodeValue.trim())}else{if(p.nodeType===Node.COMMENT_NODE)return;if(p instanceof HTMLCanvasElement){if(p.style.display==="none")return;const w=p.getBoundingClientRect();m=w.left-c.left-.5,A=w.top-c.top-.5,d.save();const S=window.devicePixelRatio;d.scale(1/S,1/S),d.drawImage(p,m,A),d.restore()}else if(p instanceof HTMLImageElement){if(p.style.display==="none")return;const w=p.getBoundingClientRect();m=w.left-c.left-.5,A=w.top-c.top-.5,y=w.width,b=w.height,d.drawImage(p,m,A,y,b)}else{if(p.style.display==="none")return;const w=p.getBoundingClientRect();m=w.left-c.left-.5,A=w.top-c.top-.5,y=w.width,b=w.height,g=window.getComputedStyle(p),o(m,A,y,b,parseFloat(g.borderRadius));const S=g.backgroundColor;S!=="transparent"&&S!=="rgba(0, 0, 0, 0)"&&(d.fillStyle=S,d.fill());const E=["borderTop","borderLeft","borderBottom","borderRight"];let I=!0,k=null;for(const T of E){if(k!==null&&(I=g[T+"Width"]===g[k+"Width"]&&g[T+"Color"]===g[k+"Color"]&&g[T+"Style"]===g[k+"Style"]),I===!1)break;k=T}if(I===!0){const T=parseFloat(g.borderTopWidth);g.borderTopWidth!=="0px"&&g.borderTopStyle!=="none"&&g.borderTopColor!=="transparent"&&g.borderTopColor!=="rgba(0, 0, 0, 0)"&&(d.strokeStyle=g.borderTopColor,d.lineWidth=T,d.stroke())}else a(g,"borderTop",m,A,y,0),a(g,"borderLeft",m,A,0,b),a(g,"borderBottom",m,A+b,y,0),a(g,"borderRight",m+y,A,0,b);if(p instanceof HTMLInputElement){let T=g.accentColor;(T===void 0||T==="auto")&&(T=g.color),t.set(T);const B=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(p.type==="radio"&&(o(m,A,y,b,b),d.fillStyle="white",d.strokeStyle=T,d.lineWidth=1,d.fill(),d.stroke(),p.checked&&(o(m+2,A+2,y-4,b-4,b),d.fillStyle=T,d.strokeStyle=B,d.lineWidth=2,d.fill(),d.stroke())),p.type==="checkbox"&&(o(m,A,y,b,2),d.fillStyle=p.checked?T:"white",d.strokeStyle=p.checked?B:T,d.lineWidth=1,d.stroke(),d.fill(),p.checked)){const M=d.textAlign;d.textAlign="center";const U={color:B,fontFamily:g.fontFamily,fontSize:b+"px",fontWeight:"bold"};r(U,m+y/2,A,"âœ”"),d.textAlign=M}if(p.type==="range"){const[M,U,G]=["min","max","value"].map(Y=>parseFloat(p[Y])),W=(G-M)/(U-M)*(y-b);o(m,A+b/4,y,b/2,b/4),d.fillStyle=B,d.strokeStyle=T,d.lineWidth=1,d.fill(),d.stroke(),o(m,A+b/4,W+b/2,b/2,b/4),d.fillStyle=T,d.fill(),o(m+W,A,b,b,b/2),d.fillStyle=T,d.fill()}(p.type==="color"||p.type==="text"||p.type==="number")&&(f.add({x:m,y:A,width:y,height:b}),r(g,m+parseInt(g.paddingLeft),A+parseInt(g.paddingTop),p.value),f.remove())}}}const _=g.overflow==="auto"||g.overflow==="hidden";_&&f.add({x:m,y:A,width:y,height:b});for(let w=0;w<p.childNodes.length;w++)l(p.childNodes[w],g);_&&f.remove()}const c=s.getBoundingClientRect();let u=mC.get(s);u===void 0&&(u=document.createElement("canvas"),u.width=c.width,u.height=c.height,mC.set(s,u));const d=u.getContext("2d"),f=new n(d);return d.clearRect(0,0,u.width,u.height),l(s),u}function kX(s,i,t,n){const r={clientX:t*s.offsetWidth+s.offsetLeft,clientY:n*s.offsetHeight+s.offsetTop,view:s.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(i,r));const o=s.getBoundingClientRect();t=t*o.width+o.left,n=n*o.height+o.top;function a(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const c=l.getBoundingClientRect();if(t>c.left&&t<c.right&&n>c.top&&n<c.bottom&&(l.dispatchEvent(new MouseEvent(i,r)),l instanceof HTMLInputElement&&l.type==="range"&&(i==="mousedown"||i==="click"))){const[u,d]=["min","max"].map(m=>parseFloat(l[m])),f=c.width,g=(t-c.x)/f;l.value=u+(d-u)*g,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let u=0;u<l.childNodes.length;u++)a(l.childNodes[u])}}a(s)}const Uv=new ae,vd={type:"",data:Uv},qB=new Du;class DX extends Fr{listenToPointerEvents(i,t){const n=this,r=new Du,o=i.domElement;function a(l){l.stopPropagation();const c=i.domElement.getBoundingClientRect();Uv.x=(l.clientX-c.left)/c.width*2-1,Uv.y=-(l.clientY-c.top)/c.height*2+1,r.setFromCamera(Uv,t);const u=r.intersectObjects(n.children,!1);if(u.length>0){const d=u[0],f=d.object,p=d.uv;vd.type=l.type,vd.data.set(p.x,1-p.y),f.dispatchEvent(vd)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a)}listenToXRControllerEvents(i){const t=this,n={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function r(o){const a=o.target;qB.setFromXRController(a);const l=qB.intersectObjects(t.children,!1);if(l.length>0){const c=l[0],u=c.object,d=c.uv;vd.type=n[o.type],vd.data.set(d.x,1-d.y),u.dispatchEvent(vd)}}i.addEventListener("move",r),i.addEventListener("select",r),i.addEventListener("selectstart",r),i.addEventListener("selectend",r)}}var tL=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class _b extends oe{constructor(){super(...arguments);h(this,"id",null);h(this,"keepAspect",!1);h(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const n=new DX;n.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(n);const r=new PX(t);n.add(r),r.visible=!1;const o=r.material;o.transparent=!0,setTimeout(()=>{r.visible=!0;const a=m0(this.gameObject).clone();A0(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const l=new Cn;l.setFromObject(n),this.setWorldRotation(a.x,a.y,a.z);const c=l.max.x-l.min.x,u=l.max.y-l.min.y;if(this.keepAspect){const f=c/u;c>u?r.scale.set(1/c,1/u/f,1):r.scale.set(1/c*f,1/u,1)}else r.scale.set(1/c,1/u,1);const d=this.gameObject.scale;r.scale.multiply(d)},1)}onDisable(){var t;(t=this._object)==null||t.removeFromParent()}}tL([v()],_b.prototype,"id",void 0);tL([v()],_b.prototype,"keepAspect",void 0);var tA=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Tg=Q("debugspatialtrigger"),XB=new mo,YB=new mo;function OX(s,i){return XB.mask=s,YB.mask=i,XB.test(YB)}class ec extends oe{constructor(){super(...arguments);h(this,"triggerMask",0);h(this,"onEnter");h(this,"onStay");h(this,"onExit");h(this,"currentIntersected",[]);h(this,"lastIntersected",[])}start(){Tg&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of wu.triggers)OX(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const n=this.lastIntersected[t];this.currentIntersected.indexOf(n)<0&&(this.onExitTrigger(n),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var n;Tg&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(n=this.onEnter)==null||n.invoke(this,t)}onExitTrigger(t){var n;Tg&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(n=this.onExit)==null||n.invoke(this,t)}onStayTrigger(t){var n;t.raiseOnStayEvent(this),(n=this.onStay)==null||n.invoke(this,t)}}tA([v()],ec.prototype,"triggerMask",void 0);tA([v(ti)],ec.prototype,"onEnter",void 0);tA([v(ti)],ec.prototype,"onStay",void 0);tA([v(ti)],ec.prototype,"onExit",void 0);const Fg=class extends oe{constructor(){super(...arguments);h(this,"triggerMask");h(this,"boxHelper")}start(){Tg&&console.log(this.name,this.triggerMask,this)}onEnable(){var t;Fg.triggers.push(this),this.boxHelper||(this.boxHelper=j.addNewComponent(this.gameObject,Xo),(t=this.boxHelper)==null||t.showHelper(null,Tg))}onDisable(){Fg.triggers.splice(Fg.triggers.indexOf(this),1)}test(t){return this.boxHelper?this.boxHelper.isInBox(t)??!1:!1}raiseOnEnterEvent(t){j.foreachComponent(this.gameObject,n=>{n!==t&&n instanceof ec&&n.onEnterTrigger(this)},!1)}raiseOnStayEvent(t){j.foreachComponent(this.gameObject,n=>{n!==t&&n instanceof ec&&n.onStayTrigger(this)},!1)}raiseOnExitEvent(t){j.foreachComponent(this.gameObject,n=>{n!==t&&n instanceof ec&&n.onExitTrigger(this)},!1)}};let wu=Fg;h(wu,"triggers",[]);tA([v()],wu.prototype,"triggerMask",void 0);var LX=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o},Ff;(function(s){s[s.FirstPerson=0]="FirstPerson",s[s.ThirdPerson=1]="ThirdPerson"})(Ff||(Ff={}));const Mr=Q("debugspectator");class QE extends oe{constructor(){super(...arguments);h(this,"cam",null);h(this,"useKeys",!0);h(this,"_mode",Ff.FirstPerson);h(this,"orbit",null);h(this,"_handler");h(this,"eventSub_WebXRRequestStartEvent",null);h(this,"eventSub_WebXRStartEvent",null);h(this,"eventSub_WebXREndEvent",null);h(this,"_debug");h(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var n;return((n=this.target)==null?void 0:n.userId)===t}isFollowedBy(t){var n;return(n=this.followers)==null?void 0:n.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var n;if(this._handler){const r=(n=this._handler.currentTarget)==null?void 0:n.userId,o=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(o==null?void 0:o.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),j.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,r)):this._handler.currentTarget!==t&&(this._handler.set(t),j.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,r))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,n;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((n=this.context.players.getPlayerView(this.localId))==null?void 0:n.currentObject)}awake(){if(this._debug=new NX(this.context,this),this._networking=new jX(this.context,this),this._networking.awake(),j.setActive(this.gameObject,!1),this.cam=j.getComponent(this.gameObject,Bt),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new FX(this.context,this.cam,this)),this.orbit=j.getComponent(this.context.mainCamera,Lt)}onDestroy(){var t,n;this.stopSpectating(),(t=this._handler)==null||t.destroy(),(n=this._networking)==null||n.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,n=/Windows|MacOS/.test(t),r=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return n&&!r}onBeforeXR(t){this.isSupportedPlatform()&&j.setActive(this.gameObject,!0)}onEnterXR(t){this.isSupportedPlatform()&&(Mr&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(t){var n,r;this.context.removeCamera(this.cam),j.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(n=this._handler)==null||n.set(void 0),(r=this._handler)==null||r.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Yl.Headset),this.target=this.context.players.getPlayerView(this.localId)),Mr&&console.log("Follow self",this.target)}onAfterRender(){var d,f,p;if(!this.cam)return;const t=this.context.renderer,n=t.xr.enabled;if(!t.xr.isPresenting&&!((d=this._handler)!=null&&d.currentTarget))return;(f=this._handler)==null||f.update(this._mode);const r=t.getRenderTarget();let o=null;const a=t.state;if(!r){if(!t.state.bindFramebuffer||!a.bindXRFramebuffer)return;o=t._framebuffer,a.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const l=this.context.mainCameraComponent;if(l){const g=l.backgroundColor;g&&t.setClearColor(g,g.alpha),this.cam.backgroundColor=g,this.cam.clearFlags=l.clearFlags,this.cam.nearClipPlane=l.nearClipPlane,this.cam.farClipPlane=l.farClipPlane}else t.setClearColor(new xe(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const c=(p=this.cam)==null?void 0:p.cam;this.context.updateAspect(c);const u=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,c),t.xr.isPresenting=u,t.xr.enabled=n,r?t.setRenderTarget(r):a.bindXRFramebuffer&&a.bindXRFramebuffer(o),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===Ff.FirstPerson;for(const n of _n.instances)if(n.avatar&&"isLocalAvatar"in n.avatar&&"flags"in n.avatar){let r=go.All;this.isSpectatingSelf&&(r=t&&n.avatar.isLocalAvatar?go.FirstPerson:go.ThirdPerson);const o=n.avatar.flags;if(!o)continue;for(const a of o)a.UpdateVisible(r)}}resetAvatarFlags(){var t;for(const n of _n.instances)if(n.avatar&&"flags"in n.avatar){const r=n.avatar.flags;if(!r)continue;for(const o of r)"isLocalAvatar"in n.avatar&&((t=n.avatar)!=null&&t.isLocalAvatar)?o.UpdateVisible(go.FirstPerson):o.UpdateVisible(go.ThirdPerson)}}}LX([v()],QE.prototype,"useKeys",void 0);class FX{constructor(i,t,n){h(this,"context");h(this,"cam");h(this,"spectator");h(this,"follow");h(this,"target");h(this,"view");h(this,"currentObject");this.context=i,this.cam=t,this.spectator=n}get currentTarget(){return this.view}set(i){const t=i==null?void 0:i.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=i,this.follow||(this.follow=j.addNewComponent(this.cam.gameObject,tl)),this.target||(this.target=new ne),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,Mr&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){Mr&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var i;(i=this.target)==null||i.removeFromParent(),this.follow&&j.destroy(this.follow)}update(i){var r,o,a,l,c,u;if(((r=this.currentTarget)==null?void 0:r.isConnected)===!1||((o=this.currentTarget)==null?void 0:o.removed)===!0){Mr&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((a=this.currentTarget)==null?void 0:a.currentObject)!==this.currentObject&&(Mr&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;t&&(this.cam.cam.near!==t.near||this.cam.cam.far!==t.far)&&(this.cam.cam.near=t.near,this.cam.cam.far=t.far,this.cam.cam.updateProjectionMatrix());const n=(l=this.follow)==null?void 0:l.target;if(!(!n||!this.follow)){switch(i){case Ff.FirstPerson:((c=this.view)==null?void 0:c.viewDevice)!==Yl.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),n.position.set(0,0,0);break;case Ff.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,n.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((u=this.view)==null?void 0:u.viewDevice)!==Yl.Browser?n.quaternion.copy(UX):n.quaternion.identity()}}}const UX=new se().setFromAxisAngle(new x(0,1,0),Math.PI);class NX{constructor(i,t){h(this,"context");h(this,"spectator");this.context=i,this.spectator=t,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",r=>{if(!this.spectator.useKeys)return;r.key==="Escape"&&this.spectator.stopSpectating()});let n=0;this.context.input.addEventListener(dt.PointerDown,r=>{n=this.context.time.time}),this.context.input.addEventListener(dt.PointerUp,r=>{const o=this.context.time.time-n;o>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&o<.3&&this.trySelectObject()})}trySelectObject(){const i=new sc;i.setMask(16777215);const t=this.context.physics.raycast(i);if(Mr&&console.log(...t),t!=null&&t.length)for(const n of t){if(n.distance<.2)continue;const r=n.object,o=j.getComponentInParent(r,_n),a=o==null?void 0:o.connectionId;if(a){const l=this.context.players.getPlayerView(a);this.spectator.target=l,Mr&&console.log("spectate",a,o);break}}}}class zX{constructor(i,t,n){h(this,"guid");h(this,"dontSave",!0);h(this,"targetUserId");h(this,"stoppedFollowing");this.guid=i,this.targetUserId=t,this.stoppedFollowing=n}}class QX{constructor(i,t){h(this,"guid");h(this,"userId");this.guid=i.guid,this.userId=t}}class jX{constructor(i,t){h(this,"followers",[]);h(this,"context");h(this,"spectator");h(this,"_followerEventMethod");h(this,"_requestFollowMethod");h(this,"_joinedRoomMethod");h(this,"_lastRequestFollowUser");h(this,"_enforceFollowInterval");this.context=i,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(je.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",i=>{this.spectator.useKeys&&(i.key==="f"?this.onRequestFollowMe():i.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(je.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(i,t){if(Mr&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",i,t),this.context.connection.connectionId){const n=(i==null?void 0:i.userId)===void 0,r=n?t:i==null?void 0:i.userId,o=new zX(this.context.connection.connectionId,r,n);this.context.connection.send("spectator-follower-changed",o)}}onRequestFollowMe(i=!1){if(Mr&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=i?void 0:this.context.connection.connectionId,n=new QX(this.spectator,t);this.context.connection.send("spectator-request-follow",n)}}onUserJoinedRoom(){Q("followme")&&this.onRequestFollowMe()}onFollowerEvent(i){const t=i.targetUserId,n=i.guid;if(Mr&&console.log(i),t===this.context.connection.connectionId)if(i.stoppedFollowing){const r=this.followers.indexOf(n);r!==-1&&(this.followers.splice(r,1),this.removeDisconnectedFollowers(),console.log(n,"unfollows you",this.followers.length))}else this.followers.includes(n)||(this.followers.push(n),this.removeDisconnectedFollowers(),console.log(n,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let i=this.followers.length-1;i>=0;i--){const t=this.followers[i];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(i,1)}}onRequestFollowEvent(i){if(this._lastRequestFollowUser=i,i.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(i.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(i.userId);if(t)this.spectator.target=t;else return Mr&&console.warn("Could not find view",i.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(Mr&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class ka{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(i,t){return this.bb_pos=i,this.bb=t,this}static getRootAsSyncedCameraModel(i,t){return(t||new ka).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSyncedCameraModel(i,t){return i.setPosition(i.position()+CS),(t||new ka).__init(i.readInt32(i.position())+i.position(),i)}userId(i){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,i):null}guid(i){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,i):null}dontSave(){const i=this.bb.__offset(this.bb_pos,8);return i?!!this.bb.readInt8(this.bb_pos+i):!1}pos(i){const t=this.bb.__offset(this.bb_pos,10);return t?(i||new mu).__init(this.bb_pos+t,this.bb):null}rot(i){const t=this.bb.__offset(this.bb_pos,12);return t?(i||new mu).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(i){i.startObject(5)}static addUserId(i,t){i.addFieldOffset(0,t,0)}static addGuid(i,t){i.addFieldOffset(1,t,0)}static addDontSave(i,t){i.addFieldInt8(2,+t,0)}static addPos(i,t){i.addFieldStruct(3,t,0)}static addRot(i,t){i.addFieldStruct(4,t,0)}static endSyncedCameraModel(i){return i.endObject()}static finishSyncedCameraModelBuffer(i,t){i.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(i,t){i.finish(t,void 0,!0)}}var GX=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const zy="SCAM";Wk(zy,ka.getRootAsSyncedCameraModel);const wr=new Cm;class HX{constructor(i,t){h(this,"userId");h(this,"guid");this.guid=t,this.userId=i}send(i,t){if(i){wr.clear();const n=wr.createString(this.guid),r=wr.createString(this.userId);ka.startSyncedCameraModel(wr),ka.addGuid(wr,n),ka.addUserId(wr,r);const o=Ve(i),a=m0(i);ka.addPos(wr,mu.createVec3(wr,o.x,o.y,o.z)),ka.addRot(wr,mu.createVec3(wr,a.x,a.y,a.z));const l=ka.endSyncedCameraModel(wr);wr.finish(l,zy),t.sendBinary(wr.asUint8Array())}}}const t0=class extends oe{constructor(){super(...arguments);h(this,"cameraPrefab",null);h(this,"_lastWorldPosition");h(this,"_lastWorldQuaternion");h(this,"_model",null);h(this,"_needsUpdate",!0);h(this,"_lastUpdateTime",0);h(this,"remoteCams",{});h(this,"userToCamMap",{});h(this,"_camTimeoutInSeconds",10);h(this,"_receiveCallback",null)}getCameraObject(t){const n=this.userToCamMap[t];return n?this.remoteCams[n].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(zy,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(zy,this._receiveCallback)}update(){for(const o in this.remoteCams){const a=this.remoteCams[o],l=this.context.time.realtimeSinceStartup-a.lastUpdate;if(!a||l>this._camTimeoutInSeconds){be()&&console.log("Remote cam timeout",o),a!=null&&a.obj&&j.destroy(a.obj),delete this.remoteCams[o],a&&delete this.userToCamMap[a.userId],t0.instances.push(a),this.context.players.removePlayerView(a.userId,Yl.Browser);continue}}if(this.context.isInXR)return;const t=this.context.mainCamera;if(t===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new HX(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const n=Ve(t),r=Ht(t);(n.distanceTo(this._lastWorldPosition)>.001||r.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(n),this._lastWorldQuaternion.copy(r),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(t,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,t,Yl.Browser))}onReceivedRemoteCameraInfoBin(t){const n=t.guid();if(!n)return;const r=t.userId();if(!r||!this.context.connection.userIsInRoom(r)||!this.cameraPrefab)return;let o=this.remoteCams[n];if(!o)if("isObject3D"in this.cameraPrefab){const u=new ll;u.context=this.context;const d=j.instantiate(this.cameraPrefab,u);o=this.remoteCams[n]={obj:d,lastUpdate:this.context.time.realtimeSinceStartup,userId:r},o.obj.visible=!0,this.gameObject.add(d),this.userToCamMap[r]=n,t0.instances.push(o);const f=j.getOrAddComponent(d,_n);f.connectionId=r,f.avatar=d}else return;const a=o.obj;this.context.players.setPlayerView(r,a,Yl.Browser),o.lastUpdate=this.context.time.realtimeSinceStartup,ta.markDirty(a);const l=t.pos();l&&Tf(a,l.x(),l.y(),l.z());const c=t.rot();c&&A0(a,c.x(),c.y(),c.z())}};let Af=t0;h(Af,"instances",[]);GX([v([ne,tt])],Af.prototype,"cameraPrefab",void 0);var Ih=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Cw="view",Sw=Q("debugsyncedroom");class fl extends oe{constructor(){super(...arguments);h(this,"roomName","");h(this,"urlParameterName","room");h(this,"joinRandomRoom");h(this,"requireRoomParameter",!1);h(this,"autoRejoin",!0);h(this,"createJoinButton",!0);h(this,"createViewOnlyButton",!1);h(this,"_lastJoinedRoom");h(this,"_roomPrefix","");h(this,"_lastPingTime",0);h(this,"_lastRoomTime",-1);h(this,"_userWantsToBeInARoom",!1);h(this,"_roomButton");h(this,"_roomButtonIconJoin");h(this,"_roomButtonIconLeave");h(this,"updateRoomButtonState",()=>{var t,n;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(t=this._roomButtonIconJoin)==null||t.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(n=this._roomButtonIconLeave)==null||n.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))});h(this,"_viewOnlyButton");h(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const t=document.createElement("button");this._viewOnlyButton=t,t.classList.add("view-only-button"),t.setAttribute("priority","90"),t.onclick=()=>{var r;const n=this.getViewOnlyUrl();n!=null&&n.length?navigator.canShare({url:n})?(r=navigator.share({url:n}))==null||r.catch(o=>{console.warn(o)}):(navigator.clipboard.writeText(n),bi("View only URL copied to clipboard")):Xt("Could not create view only URL")},t.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",t.textContent="Share View URL",t.prepend(ys("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){const t=Q(Cw);return t||Q(this.urlParameterName)}set roomPrefix(t){this._roomPrefix=t}get roomPrefix(){return this._roomPrefix}awake(){var t;this.joinRandomRoom===void 0&&((t=this.roomName)==null?void 0:t.length)<=0&&(this.joinRandomRoom=!0),Sw&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const t=Q(Cw);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const n=this.createRoomButton();this.context.menu.appendChild(n)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var t;(t=this._roomButton)==null||t.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){var r;t===void 0&&(t=0);let n=!1;if(((r=this.urlParameterName)==null?void 0:r.length)>0){const o=Q(this.urlParameterName);if(o&&(typeof o=="string"||typeof o=="number")){n=!0;const a=lU(o.toString());this.roomName=a}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!n?((Sw||be())&&console.warn('SyncedRoom: Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`SyncedRoom: Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(Sw&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):be()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,n=new URLSearchParams(t);return n.has(this.urlParameterName)&&n.delete(this.urlParameterName),n.set(Cw,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+n.toString()}return null}setRandomRoomUrlParameter(){const t=c0(),n=this.generateRoomName();Q(this.urlParameterName)?t.set(this.urlParameterName,n):t.append(this.urlParameterName,n),VP(n,t)}generateRoomName(){let t="";for(let n=0;n<6;n++)t+=Math.floor(Math.random()*10).toFixed(0);return t}createRoomButton(){if(this._roomButton)return this._roomButton;const t=document.createElement("button");return this._roomButton=t,t.classList.add("create-room-button"),t.setAttribute("priority","90"),t.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&Qw(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const n=Q(this.urlParameterName);(!n||n===!0)&&(this._lastJoinedRoom?Qw(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=ys("group"),this._roomButtonIconLeave=ys("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(je.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(je.LeftRoom,this.updateRoomButtonState),t}destroyRoomButton(){this.context.connection.stopListen(je.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(je.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(je.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(je.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var t;this.context.connection.stopListen(je.JoinedRoom,this.onCreateViewOnlyButton),(t=this._viewOnlyButton)==null||t.remove()}}Ih([v()],fl.prototype,"roomName",void 0);Ih([v()],fl.prototype,"urlParameterName",void 0);Ih([v()],fl.prototype,"joinRandomRoom",void 0);Ih([v()],fl.prototype,"requireRoomParameter",void 0);Ih([v()],fl.prototype,"autoRejoin",void 0);Ih([v()],fl.prototype,"createJoinButton",void 0);Ih([v()],fl.prototype,"createViewOnlyButton",void 0);Ih([v()],fl.prototype,"roomPrefix",null);function VX(){const s=Q("testwindowcount")||0;s&&s>0&&WX(s)}function WX(s){if(Q("testwindow"))return null;const i=new URL(window.location.href);w1(i.searchParams,F9,1),w1(i.searchParams,"testwindow",1);const t=i.toString(),n=[];window.onbeforeunload=()=>{for(const c of n)c.close()};const r=.05,o=128;let a=0,l=0;for(let c=0;c<s;c++){a*o+o*.01>=window.innerWidth&&(l+=1,a=0);const u=a*(o*(1+r))+window.screenLeft,d=l*(o*(1+r))+window.screenTop+90+60*l;a+=1;const f=window.open(t,"test window "+c,`popup=yes width=${o} height=${o} top=${d} left=${u}`);if(!f){console.warn("Failed to open window");continue}n.push(f),f.onload=()=>{f.onbeforeunload=()=>{for(let p=0;p<n.length;p++){const g=n[p];g!==f&&g.close()}n.length=0}}}return n}class iL extends oe{awake(){VX()}}class nL extends oe{constructor(){super(...arguments);h(this,"transformsPerFrame",10);h(this,"interval",0);h(this,"useFlatbuffers",!0);h(this,"builder",null);h(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(om,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new sL(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new Cm(1024));const t=this.builder;for(let n=0;n<this.transformsPerFrame;n++){t.clear();const r=KO(this.context.connection.connectionId,this);this.context.connection.sendBinary(r)}}else if(this.models)for(let t=0;t<this.models.length;t++){const n=this.models[t];n.dontSave=!0,n.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,n)}}}}class sL{constructor(i,t){h(this,"guid");h(this,"fast",!1);h(this,"position");h(this,"rotation");h(this,"velocity");h(this,"dontSave");this.guid=i,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(i,t){const n=i.worldPosition;this.position.x=n.x,this.position.y=n.y,this.position.z=n.z;const r=i.worldQuaternion;if(this.rotation.x=r.x,this.rotation.y=r.y,this.rotation.z=r.z,this.rotation.w=r.w,this.fast=!1,t){const o=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=o.x,this.velocity.y=o.y,this.velocity.z=o.z}}}h(sL,"temp",new x);var tp=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class yc extends Es{constructor(){super(...arguments);h(this,"offset",new Ae(0));h(this,"rotation",new Ae(0));h(this,"focusArea",new Ae(.4));h(this,"feather",new Ae(.3));h(this,"kernelSize",new Ae(Ka.MEDIUM));h(this,"resolutionScale",new Ae(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Ka.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const t=new mk({kernelSize:Ka.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=n=>t.offset=n,this.rotation.onValueChanged=n=>t.rotation=n,this.focusArea.onValueChanged=n=>t.focusArea=n,this.feather.onValueChanged=n=>t.feather=n,this.kernelSize.onValueChanged=n=>t.blurPass.kernelSize=n,this.resolutionScale.onValueChanged=n=>t.resolution.scale=n/window.devicePixelRatio,t}}tp([v(Ae)],yc.prototype,"offset",void 0);tp([v(Ae)],yc.prototype,"rotation",void 0);tp([v(Ae)],yc.prototype,"focusArea",void 0);tp([v(Ae)],yc.prototype,"feather",void 0);tp([v(Ae)],yc.prototype,"kernelSize",void 0);tp([v(Ae)],yc.prototype,"resolutionScale",void 0);oa("TiltShiftEffect",yc);var wb=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class ip extends oe{constructor(){super(...arguments);h(this,"isGizmo",!1);h(this,"translationSnap",1);h(this,"rotationSnapAngle",15);h(this,"scaleSnap",.25);h(this,"control");h(this,"orbit");h(this,"onControlChangedEvent",t=>{const n=this.orbit;if(n&&(n.enabled=!t.value),t.value){const r=j.getComponentInParent(this.gameObject,rc);r&&r.requestOwnership()}});h(this,"windowKeyDownListener",t=>{if(this.enabled&&this.control)switch(t.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});h(this,"windowKeyUpListener",t=>{if(this.enabled)switch(t.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var t;this.isGizmo&&!Em||this.context.mainCamera&&(this.control||(this.control=new p6(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(n=>{const r=n;if(r.layers.set(2),r){const o=r.material;o&&(o.opacity=.3)}}),this.orbit=j.getComponentInParent(this.context.mainCamera,Lt)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(t=this.control)==null||t.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var t,n;(t=this.control)==null||t.removeFromParent(),(n=this.control)==null||n.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(ct.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}wb([v()],ip.prototype,"isGizmo",void 0);wb([v()],ip.prototype,"translationSnap",void 0);wb([v()],ip.prototype,"rotationSnapAngle",void 0);wb([v()],ip.prototype,"scaleSnap",void 0);var jE=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class np extends Es{constructor(){super(...arguments);h(this,"color",new Ae({r:0,g:0,b:0,a:1}));h(this,"intensity",new Ae(0));h(this,"center",new Ae({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new Ak;return this.intensity.onValueChanged=n=>{t.offset=n,this.updateDarkness(t)},this.color.onValueChanged=n=>{this.updateDarkness(t)},t}updateDarkness(t){const n=this.intensity.value;t.darkness=n}}jE([v(Ae)],np.prototype,"color",void 0);jE([v(Ae)],np.prototype,"intensity",void 0);jE([v(Ae)],np.prototype,"center",void 0);oa("Vignette",np);var qX=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Ew=Q("debugpost");class xb extends oe{constructor(){super(...arguments);h(this,"sharedProfile");h(this,"_postprocessing");h(this,"_activeEffects",[]);h(this,"_effects",[]);h(this,"_lastApplyTime");h(this,"_rapidApplyCount",0);h(this,"_isDirty",!1);h(this,"_modificationQueue");h(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(t){let n=t;return n instanceof Ys&&(n=new Dy(n)),this._effects.includes(n)||(this._effects.push(n),this._isDirty=!0),t}removeEffect(t){let n=-1;return t instanceof Ys?n=this._effects.findIndex(r=>r instanceof Dy&&r.effect===t):n=this._effects.indexOf(t),n!==-1&&(this._effects.splice(n,1),this._isDirty=!0),t}markDirty(){this._isDirty=!0}awake(){var t;Ew&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",n=>{n.key==="p"&&(this.enabled=!this.enabled,bi("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(t=this.sharedProfile)==null||t.init()}onEnable(){this._isDirty=!0}onDisable(){var t;(t=this._postprocessing)==null||t.unapply(),this._isDirty=!1}onBeforeRender(){var t;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof pS)){Ew&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((t=this._postprocessing)==null?void 0:t.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var t;if(Ew&&console.log("Apply PostProcessing "+this.name),be()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(t=this.sharedProfile)!=null&&t.components){const n=this.sharedProfile.components;for(const r of n)r.active&&!this._activeEffects.includes(r)&&this._activeEffects.push(r)}for(const n of this._effects)n.active&&!this._activeEffects.includes(n)&&this._activeEffects.push(n);this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new NE(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var t;(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var n,r;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((n=this._activeEffects)!=null&&n.length))return;const o=t.propertyName.split(".");if(o.length===3||o.length===4){const a=o[1],l=o[2];for(const c of this._activeEffects)if(((r=c.typeName)==null?void 0:r.toLowerCase())===a.toLowerCase()){if(l==="active"){c.active=t.value,this.scheduleRecreate();return}if(!lv.has(a)){const u=new Array;lv.set(a,u);const d=Object.keys(c);for(const f of d)c[f]instanceof Ae&&u.push(f)}if(lv.has(a)){const u=l.toLowerCase(),d=lv.get(a);for(const f of d)if(f.toLowerCase()===u){const p=c[f];p instanceof Ae&&(o.length===4&&o[3]==="active"?(p.overrideState=t.value,this.scheduleRecreate()):p&&p.value!==void 0&&(p.value=t.value));return}}console.warn("Unknown modification",l);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}qX([Pm(Q0)],xb.prototype,"sharedProfile",void 0);const lv=new Map;g9(xb);var XX=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const Nv=Q("debugarcamera");class GE extends oe{constructor(){super(...arguments);h(this,"backgroundTint",new Ut(1,1,1,1));h(this,"backgroundPlane");h(this,"threeTexture");h(this,"forceTextureInitialization",function(){const t=new _t,n=new pr,r=new ws;r.add(new Z(n,t));const o=new bt;return function(l,c){t.map=c,l.render(r,o),Nv&&console.warn("Force texture initialization")}}());h(this,"preRender",()=>{if(!this||!this.gameObject)return;const n=this.context.renderer.xr.getFrame();n&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new At,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=KX(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(n))})}onBeforeXR(t,n){n.optionalFeatures=n.optionalFeatures||[],n.optionalFeatures.push("camera-access"),Nv&&console.warn("Requesting camera-access")}onEnterXR(t){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(t){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const n=this.context.pre_render_callbacks.indexOf(this.preRender);n>=0&&this.context.pre_render_callbacks.splice(n,1)}get background(){return this.backgroundPlane}onBeforeRender(t){this.updateFromFrame(t)}updateFromFrame(t){if(!t)return;const n=t.session.enabledFeatures;if(n&&!n.some(o=>o==="camera-access")){this.background&&(this.background.visible=!1);return}const r=t.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(r){for(const o of r.views)if("camera"in o&&o.camera){let l=this.context.renderer.xr.getBinding();if(l||(l=new XRWebGLBinding(t.session,this.context.renderer.getContext())),l){let c=null;if("getCameraImage"in l){c=l.getCameraImage(o.camera);const u=this.context.renderer.properties.get(this.threeTexture);u.__webglTexture=c,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):Nv&&console.warn("No background plane to set texture on")}}}}}}XX([v(Ut)],GE.prototype,"backgroundTint",void 0);const YX=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function KX(s){const i="vec4("+s.r.toFixed(3)+","+s.g.toFixed(3)+","+s.b.toFixed(3)+","+s.a.toFixed(3)+")";Nv&&console.log(i);const t=new Z(new pr(2,2),new et({name:"BackgroundMaterial",uniforms:a0.clone(sf.background.uniforms),vertexShader:sf.background.vertexShader,fragmentShader:YX.replaceAll("<backgroundTint>",i),side:_i,depthTest:!1,depthWrite:!1,fog:!1}));return t.geometry.deleteAttribute("normal"),Object.defineProperty(t.material,"map",{get:function(){return this.threeTexture}}),t.renderOrder=-1e4,t.layers.set(2),t.frustumCulled=!1,t.setTexture=function(n){t.material.uniforms.t2D.value=n},t}var nd=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const KB=Q("debugimagetracking"),i0=class{constructor(i,t,n,r,o,a){h(this,"measuredSize");h(this,"state");h(this,"_position");h(this,"_rotation");h(this,"_trackingComponent");h(this,"_trackedImage");h(this,"_bitmap");h(this,"_pose");this._trackingComponent=i,this._trackedImage=t,this._bitmap=n,this.measuredSize=r,this.state=o,this._pose=a}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(i){return this.ensureTransformData(),i.copy(this._position),i}getQuaternion(i){return this.ensureTransformData(),i.copy(this._rotation),i}applyToObject(i,t=void 0){this.ensureTransformData();const n=i.position.distanceToSquared(this._position)/.05+i.quaternion.angleTo(this._rotation)/.05;t&&(t*=Math.max(1,n)),t===void 0||t>=1?(i.position.copy(this._position),i.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),i.position.lerp(this._position,t),i.quaternion.slerp(this._rotation,t))}ensureTransformData(){if(!this._position){this._position=i0._positionBuffer.get(),this._rotation=i0._rotationBuffer.get();const i=this._pose.transform,t=Fe.active.convertSpace(i);this._position.copy(t==null?void 0:t.position),this._rotation.copy(t==null?void 0:t.quaternion)}}};let ou=i0;h(ou,"_positionBuffer",new wo(()=>new x,20)),h(ou,"_rotationBuffer",new wo(()=>new se,20));class bc{constructor(){h(this,"image");h(this,"widthInMeters",.25);h(this,"object");h(this,"createObjectInstance",!1);h(this,"imageDoesNotMove",!1);h(this,"hideWhenTrackingIsLost",!0)}}nd([v(URL)],bc.prototype,"image",void 0);nd([v()],bc.prototype,"widthInMeters",void 0);nd([v(tt)],bc.prototype,"object",void 0);nd([v()],bc.prototype,"createObjectInstance",void 0);nd([v()],bc.prototype,"imageDoesNotMove",void 0);nd([v()],bc.prototype,"hideWhenTrackingIsLost",void 0);class JX{constructor(i,t,n){h(this,"filename");h(this,"widthInMeters");h(this,"imageData");this.filename=i,this.imageData=t,this.widthInMeters=n}get extensionName(){return"image-tracking"}onAfterHierarchy(i,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onBeforeBuildDocument(i){const t=j.findObjectOfType(oh);!t||!t.trackedImages||t.trackedImages.length>1&&(be()&&Xt("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(i){i.files["image_tracking/"+this.filename]=this.imageData}onExportObject(i,t,n){var o;const r=j.findObjectOfType(oh);if(!(!r||!r.trackedImages)){for(const a of r.trackedImages)if(((o=a.object)==null?void 0:o.asset)===i){const l=j.findObjectOfType(li);if(!l)continue;const{scale:c,target:u}=l.getARScaleAndTarget();let d=i;const f=new le;if(i!==u)for(;d.parent&&d.parent!==u;)d=d.parent,f.premultiply(d.matrix);const p=f.clone().invert();t.matrix=p.scale(new x(c,c,c));break}}}}const ef=class extends oe{constructor(){super(...arguments);h(this,"trackedImages");h(this,"smooth",!0);h(this,"trackedImageIndexMap",new Map);h(this,"imageToObjectMap",new Map);h(this,"currentImages",[]);h(this,"onImageTrackingUpdate",t=>{const n=Fe.active;if(n)for(const r of t){const o=r.model,a=r.state==="tracked";if(!o.object)continue;let l=this.imageToObjectMap.get(o);if(l===void 0)l={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(o,l),o.object.loadAssetAsync().then(c=>{if(o.createObjectInstance&&c&&(c=j.instantiate(c)),c){l.object=c;for(const u of c.getComponentsInChildren(ci))u.setInstancingEnabled(!1);n.rig?(n.rig.gameObject.add(c),r.applyToObject(c),c.activeSelf||j.setActive(c,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(l.frames++,a&&(l.lastTrackingTime=Date.now()),o.imageDoesNotMove&&l.frames>10||!l.object)continue;n.rig&&(n.rig.gameObject.add(l.object),r.applyToObject(l.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),l.object.activeSelf||j.setActive(l.object,!0))}}})}awake(){if(KB&&console.log(this),!!this.trackedImages){for(const t of this.trackedImages)if(t.image&&!ef._imageElements.has(t.image)){const n=t.image;ef._imageElements.set(n,null);const r=document.createElement("img");r.src=n,r.addEventListener("load",async()=>{const o=await createImageBitmap(r);ef._imageElements.set(n,o);const a=await CV(o);if(a){const c=await(await a.convertToBlob({type:"image/png"})).arrayBuffer(),u=j.findObjectOfType(li);u&&this.trackedImages&&(u.extensions.push(new JX("marker.png",new Uint8Array(c),this.trackedImages[0].widthInMeters)),u.anchoringType="image")}})}}}onBeforeXR(t,n){var r;if(this.trackedImages){n.optionalFeatures=n.optionalFeatures||[],n.optionalFeatures.includes("image-tracking")||n.optionalFeatures.push("image-tracking"),n.trackedImages=[];for(const o of this.trackedImages)if((r=o.image)!=null&&r.length&&o.widthInMeters>0){const a=ef._imageElements.get(o.image);a&&(this.trackedImageIndexMap.set(n.trackedImages.length,o),n.trackedImages.push({image:a,widthInMeters:o.widthInMeters}))}}}onEnterXR(t){var n;if(this.trackedImages){for(const r of this.trackedImages)if((n=r.object)!=null&&n.asset){const o=r.object.asset;o.userData||(o.userData={});const a={visible:o.visible,parent:o.parent,matrix:o.matrix.clone()};o.userData["image-tracking"]=a}}for(const r of this.imageToObjectMap.values())r.frames=0}onLeaveXR(t){var n,r;if(this.trackedImages){for(const o of this.trackedImages)if((n=o.object)!=null&&n.asset){const a=o.object.asset;if(a.userData){const l=a.userData["image-tracking"];l&&(a.visible=l.visible,(r=l.parent)==null||r.add(a),a.matrix.copy(l.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale)),delete a.userData["image-tracking"]}}}}onUpdateXR(t){var o;this.currentImages.length=0;const n=t.xr.frame;if(!n)return;if("getImageTrackingResults"in n){if(((o=t.xr.session.enabledFeatures)==null?void 0:o.includes("image-tracking"))===!1)return;if(n.session&&typeof n.getImageTrackingResults=="function"){const a=n.getImageTrackingResults();if(a.length>0){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const c of a){const u=c.trackingState,d=c.index,f=this.trackedImageIndexMap.get(d);if(f){const p=n.getPose(c.imageSpace,l),g=new ou(this,f,c.image,c.measuredSize,u,p);this.currentImages.push(g)}else KB&&console.warn("No tracked image for index",d)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(c){console.error(c)}}}}}else{const a=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(a)),Xt(a);return}const r=1e3;for(const[a,l]of this.imageToObjectMap){if(!l.object||!a||a.hideWhenTrackingIsLost===!1)continue;let c=!1;for(const u of this.currentImages)if(u.model===a){const d=Date.now()-l.lastTrackingTime;if(a.imageDoesNotMove||u.state==="tracked"||d<=r){c=!0;break}}c||j.setActive(l.object,!1)}}};let oh=ef;h(oh,"_imageElements",new Map);nd([v(bc)],oh.prototype,"trackedImages",void 0);const Pp=new x,Mp=new x,JB=new za;class ZX extends xf{constructor(i,t=1,n=16711680){const r=new Vt,o=i.geometry.attributes.normal.count,a=new ln(o*2*3,3);r.setAttribute("position",a),super(r,new Zo({color:n,toneMapped:!1})),this.object=i,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),JB.getNormalMatrix(this.object.matrixWorld);const i=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry;if(n){const r=n.attributes.position,o=n.attributes.normal;let a=0;for(let l=0,c=r.count;l<c;l++)Pp.fromBufferAttribute(r,l).applyMatrix4(i),Mp.fromBufferAttribute(o,l),Mp.applyMatrix3(JB).normalize().multiplyScalar(this.size).add(Pp),t.setXYZ(a,Pp.x,Pp.y,Pp.z),a=a+1,t.setXYZ(a,Mp.x,Mp.y,Mp.z),a=a+1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var sp=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const jh=Q("debugplanetracking");class Th extends oe{constructor(){super(...arguments);h(this,"dataTemplate");h(this,"occluder",!0);h(this,"initiateRoomCaptureIfNoData",!0);h(this,"usePlaneData",!0);h(this,"useMeshData",!0);h(this,"runInVR",!0);h(this,"bounds",new Cn);h(this,"center",new x);h(this,"labelOffset",new x);h(this,"_dataId",1);h(this,"_allPlanes",new Map);h(this,"_allMeshes",new Map);h(this,"firstTimeNoPlanesDetected",-100);h(this,"makeOccluder",(t,n,r=!1)=>{if(n){if(n instanceof Array){for(const o of n)this.makeOccluder(t,o,r);return}!r&&!n.name.toLowerCase().includes("occlu")||(n.colorWrite=!1,n.depthTest=!0,n.depthWrite=!0,n.transparent=!1,n.polygonOffset=!0,n.polygonOffsetFactor=1,n.polygonOffsetUnits=.1,t.renderOrder=-1e3)}});h(this,"_flipForwardMatrix",new le().makeRotationY(Math.PI));h(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(t,n){t==="immersive-vr"&&!this.runInVR||(n.optionalFeatures=n.optionalFeatures||[],this.usePlaneData&&!n.optionalFeatures.includes("plane-detection")&&n.optionalFeatures.push("plane-detection"),this.useMeshData&&!n.optionalFeatures.includes("mesh-detection")&&n.optionalFeatures.push("mesh-detection"))}onEnterXR(t){for(const n of this._allPlanes.keys())this.removeData(n,this._allPlanes);for(const n of this._allMeshes.keys())this.removeData(n,this._allMeshes)}onLeaveXR(t){for(const n of this._allPlanes.keys())this.removeData(n,this._allPlanes);for(const n of this._allMeshes.keys())this.removeData(n,this._allMeshes)}onUpdateXR(t){if(!this.runInVR&&t.xr.isVR)return;const n=t.xr.rig;if(!n){console.warn("No XR rig found, cannot parent tracked planes to it");return}const r=t.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const l=r.detectedPlanes,c=r.detectedMeshes,u=l!==void 0&&l.size>0,d=c!==void 0&&c.size>0;if(this.initiateRoomCaptureIfNoData&&(!u&&!d&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(u||d)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in r.session&&(r.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),l!==void 0&&this.processFrameData(t.xr,n.gameObject,r,l,this._allPlanes),c!==void 0&&this.processFrameData(t.xr,n.gameObject,r,c,this._allMeshes),jh){const f=this.context.mainCameraComponent.gameObject.worldPosition;for(const p of this._allPlanes.values())!p.mesh||!p.mesh.visible||(this.bounds.makeEmpty(),p.mesh.traverse(g=>{g instanceof Z&&this.bounds.expandByObject(g)}),this.bounds.getCenter(this.center),this.labelOffset.copy(f).sub(this.center).normalize().multiplyScalar(.1),Pe.DrawLabel(this.center.add(this.labelOffset),(p.xrData.semanticLabel||"plane").toUpperCase()+`
`+p.xrData.lastChangedTime.toFixed(2),.02))}}removeData(t,n){const r=n.get(t);if(!r)return;n.delete(t),jh&&console.log("Plane no longer tracked, id="+r.id),r.mesh&&(r.mesh.removeFromParent(),r.mesh.traverse(a=>{const l=a.userData.normalsHelper;l?(l.dispose(),l.removeFromParent()):jh&&console.warn("No normals helper found for mesh",r.mesh)}),xo(r.mesh,!0,!0));const o=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:r}});this.dispatchEvent(o)}processFrameData(t,n,r,o,a){const c=this.context.renderer.xr.getReferenceSpace();if(c){for(const u of a.keys())o.has(u)||this.removeData(u,a);for(const u of o){const d="planeSpace"in u?u.planeSpace:"meshSpace"in u?u.meshSpace:void 0;if(!d)continue;const f=r.getPose(d,c);let p;if(a.has(u)){const g=a.get(u);if(p=g.mesh,g.timestamp<u.lastChangedTime){if(g.timestamp=u.lastChangedTime,g.mesh){const A=this.createGeometry(u);if(g.mesh instanceof Z)g.mesh.geometry.dispose(),g.mesh.geometry=A,this.makeOccluder(g.mesh,g.mesh.material);else if(g.mesh instanceof Fr)for(const y of g.mesh.children)y instanceof Z&&(y.geometry.dispose(),y.geometry=A,this.makeOccluder(y,y.material));if(g.collider){const y=g.mesh;g.collider.sharedMesh=y,g.collider.convex=this.checkIfContextShouldBeConvex(y,g.xrData),g.collider.onDisable(),g.collider.onEnable()}jh&&(console.log("Plane updated, id="+g.id,g),g.mesh.traverse(y=>{if(!(y instanceof Z))return;const b=y.userData.normalsHelper;b&&b.update()}))}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:g}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const g=new Z;jh?g.material=new bP:this.occluder?(g.material=new _t,this.makeOccluder(g,g.material,!0)):g.material=new _t({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new tt("","",g)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const g=j.instantiate(this.dataTemplate.asset);if(g.name="xr-tracked-plane",p=g,qM(g,!1),g instanceof Z)si(g.geometry),g.geometry=this.createGeometry(u),this.makeOccluder(g,g.material,this.occluder);else if(g instanceof Fr)for(const y of g.children)y instanceof Z&&(si(y.geometry),y.geometry=this.createGeometry(u),this.makeOccluder(y,y.material,this.occluder));const m=g.getComponent(Hf);if(m){const y=g;m.sharedMesh=y,m.convex=this.checkIfContextShouldBeConvex(y,u),m.onDisable(),m.onEnable()}g.matrixAutoUpdate=!1,g.matrixWorldNeedsUpdate=!0,n.add(g);const A={id:this._dataId++,xrData:u,timestamp:u.lastChangedTime,mesh:g,collider:m};a.set(u,A),jh&&console.log("New plane detected, id="+A.id,A);try{const y=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:A}});this.dispatchEvent(y)}catch(y){console.error(y)}}}p&&(f?(p.visible=!0,p.matrix.fromArray(f.transform.matrix),p.matrix.premultiply(this._flipForwardMatrix)):p.visible=!1,jh&&p.traverse(g=>{if(g instanceof Z)if(g.userData.normalsHelper)g.userData.normalsHelper.update();else{const m=new ZX(g,.05,255);m.layers.disableAll(),m.layers.set(2),this.context.scene.add(m),g.userData.normalsHelper=m}}))}}}checkIfContextShouldBeConvex(t,n){if(!t)return!0;if(t){const r=new Cn;r.expandByObject(t);const o=new x;r.getSize(o);let a=!0;return o.x>2&&o.y>2&&o.z>1.5&&(a=!1),a&&"semanticLabel"in n&&n.semanticLabel==="wall"&&(a=!0),a}return!0}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new Vt}createMeshGeometry(t,n){const r=t.toString()+"_"+n.toString();if(this._verticesCache.has(r))return this._verticesCache.get(r);const o=new Vt;o.setIndex(new Je(n,1)),o.setAttribute("position",new Je(t,3));const a=Array();for(let l=0;l<t.length;l+=3)a.push(t[l],t[l+2]);return o.setAttribute("uv",new Je(t,3)),o.computeVertexNormals(),this._verticesCache.set(r,o),o}createPlaneGeometry(t){const n=new Vt,r=[],o=[];t.forEach(g=>{r.push(g.x,g.y,g.z),o.push(g.x,g.z)});const a=new x(r[0],r[1],r[2]),l=new x(r[3],r[4],r[5]),c=new x(r[6],r[7],r[8]),u=new x,d=new x;u.subVectors(l,a),d.subVectors(c,a),u.cross(d),u.normalize();const f=[];for(let g=0;g<r.length/3;g++)f.push(u.x,u.y,u.z);const p=[];for(let g=2;g<t.length;++g)p.push(0,g-1,g);return n.setAttribute("position",new Je(new Float32Array(r),3)),n.setAttribute("uv",new Je(new Float32Array(o),2)),n.setAttribute("normal",new Je(new Float32Array(f),3)),n.setIndex(p),n}}sp([v(tt)],Th.prototype,"dataTemplate",void 0);sp([v()],Th.prototype,"occluder",void 0);sp([v()],Th.prototype,"initiateRoomCaptureIfNoData",void 0);sp([v()],Th.prototype,"usePlaneData",void 0);sp([v()],Th.prototype,"useMeshData",void 0);sp([v()],Th.prototype,"runInVR",void 0);var rp=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};class Rh extends oe{constructor(){super(...arguments);h(this,"side","none");h(this,"controller",!0);h(this,"hands",!1);h(this,"controlVisibility",!0);h(this,"useGripSpace",!1);h(this,"resetTransformAfterXRSession",!0);h(this,"_startPosition",new x);h(this,"_startRotation",new se);h(this,"_startScale",new x)}get activeAndEnabled(){return!0}onEnterXR(t){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(t){const n=t.xr.getController(this.side);if(n){if(n.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||n.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=n.gripWorldPosition,this.gameObject.worldQuaternion=n.gripWorldQuaternion,this.gameObject.worldScale=Be(n.xr.rigScale,n.xr.rigScale,n.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=n.rayWorldPosition,this.gameObject.worldQuaternion=n.rayWorldQuaternion,this.gameObject.worldScale=Be(n.xr.rigScale,n.xr.rigScale,n.xr.rigScale).multiply(this._startScale))}}onLeaveXR(t){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}rp([v()],Rh.prototype,"side",void 0);rp([v()],Rh.prototype,"controller",void 0);rp([v()],Rh.prototype,"hands",void 0);rp([v()],Rh.prototype,"controlVisibility",void 0);rp([v()],Rh.prototype,"useGripSpace",void 0);rp([v()],Rh.prototype,"resetTransformAfterXRSession",void 0);var $X=globalThis&&globalThis.__decorate||function(s,i,t,n){var r=arguments.length,o=r<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,i,t,n);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(o=(r<3?a(o):r>3?a(i,t,o):a(i,t))||o);return r>3&&o&&Object.defineProperty(i,t,o),o};const ZB=Q("debugwebxr");class HE extends oe{constructor(){super(...arguments);h(this,"priority",0);h(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var t;(t=Fe.active)==null||t.setRigActive(this)}awake(){if(ZB){const t=new ne;t.position.y+=.5,this.gameObject.add(t);const n=t.addNewComponent(Vf);n&&(n.isGizmo=!1);const r=new dr(.5);this.gameObject.add(r)}}isXRRig(){return!0}supportsXR(t){return!0}onEnterXR(t){this._startScale=this.gameObject.scale.clone(),t.xr.addRig(this),ZB&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(t){t.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}$X([v()],HE.prototype,"priority",void 0);class rL{}const eY=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:Ct,ActionCollection:GO,ActionModel:Br,AlignmentConstraint:D0,Animation:qs,AnimationCurve:Jo,AnimationExtension:z0,AnimationTrackHandler:eE,Animator:Cs,AnimatorController:yo,Antialiasing:j0,AudioExtension:ju,AudioListener:vu,AudioSource:kt,AudioTrackHandler:ff,Avatar:Eu,AvatarBlink_Simple:Gf,AvatarEyeLook_Rotation:sh,AvatarLoader:r2,AvatarMarker:_n,AvatarModel:aE,Avatar_Brain_LookAt:wy,Avatar_MouthShapes:V0,Avatar_MustacheShake:s2,Avatar_POI:Kl,AxesHelper:Lm,BaseUIComponent:sa,BasicIKConstraint:o2,BehaviorExtension:cE,BehaviorModel:cn,BloomEffect:Jl,BoxCollider:Vu,BoxGizmo:Vf,BoxHelperComponent:Xo,Button:_h,CallInfo:Nl,Camera:Bt,CameraTargetReachedEvent:yy,Canvas:In,CanvasGroup:Iu,CapsuleCollider:dh,ChangeMaterialOnClick:Vl,ChangeTransformOnClick:Wf,CharacterController:qf,CharacterControllerInput:xh,ChromaticAberration:J0,Collider:Io,ColorAdjustments:qu,ColorBySpeedModule:Xf,ColorOverLifetimeModule:eb,ContactShadows:bo,ControlTrackHandler:tE,CustomBranding:Ku,Deletable:P2,DeleteBox:bE,DepthOfField:hl,DeviceFlag:_E,DocumentExtension:M2,DragControls:wn,DropListener:$u,Duplicatable:Sh,EffectWrapper:Dy,EmissionModule:pc,EmphasizeOnClick:jm,EventList:ti,EventListEvent:YS,EventSystem:Dr,EventTrigger:CE,FieldWithDefault:S2,FixedJoint:k2,FlyControls:D2,Fog:Vm,GltfExport:Ua,GltfExportBox:U2,Gradient:Xu,Graphic:Zl,GraphicRaycaster:JS,GridHelper:Wm,GridLayoutGroup:f2,GroundProjectedEnv:yh,GroupActionModel:nu,HideOnStart:p2,HingeJoint:rb,HorizontalLayoutGroup:d2,Image:zm,InheritVelocityModule:gc,InputField:uo,InstanceHandle:gf,InstancingHandler:pf,Interactable:B2,Keyframe:ur,LODGroup:lb,LODModel:Jf,Light:Hr,LimitVelocityOverLifetimeModule:hn,LogStats:N2,LookAt:$l,LookAtConstraint:jf,MainModule:Is,MaskableGraphic:q0,MeshCollider:Hf,MeshRenderer:$0,MinMaxCurve:Se,MinMaxGradient:xn,NeedleMenu:Ac,NestedGltf:RE,Networking:ph,NoiseModule:Nt,ObjectRaycaster:Co,OffsetConstraint:Zf,OpenURL:Xm,OrbitControls:Lt,Outline:Um,Padding:Wu,ParticleBurst:Iy,ParticleSubEmitter:UE,ParticleSystem:wi,ParticleSystemRenderer:la,PhysicsExtension:AE,PixelationEffect:Ab,PlayAnimationOnClick:Wa,PlayAudioOnClick:Tu,PlayableDirector:$a,PlayerColor:um,PointerEventData:km,PostProcessingHandler:NE,PreliminaryAction:Gm,PreliminaryTrigger:Y0,RawImage:fE,Rect:c2,RectTransform:ts,ReflectionProbe:Wl,RegisteredAnimationInfo:iE,RemoteSkybox:lc,Renderer:ci,RendererLightmap:Cy,Rigidbody:It,RotationBySpeedModule:To,RotationOverLifetimeModule:aa,SceneSwitcher:Mn,ScreenCapture:td,ScreenSpaceAmbientOcclusion:Eh,ScreenSpaceAmbientOcclusionN8:dl,SetActiveOnClick:ho,ShadowCatcher:yb,ShapeModule:ei,SharpeningEffect:vb,SignalAsset:F0,SignalReceiver:nh,SignalReceiverEvent:Om,SignalTrackHandler:by,Size:l2,SizeBySpeedModule:mr,SizeOverLifetimeModule:Yu,SkinnedMeshRenderer:E2,SmoothFollow:tl,SpatialGrabRaycaster:Au,SpatialHtml:_b,SpatialTrigger:wu,SpatialTriggerReceiver:ec,SpectatorCamera:QE,SphereCollider:Fm,Sprite:mc,SpriteData:el,SpriteRenderer:Gr,SpriteSheet:Bu,SubEmitterSystem:Ny,SyncedCamera:Af,SyncedRoom:fl,SyncedTransform:rc,TapGestureTrigger:g2,TeleportTarget:mE,TestRunner:iL,TestSimulateUserData:nL,Text:$s,TextBuilder:vE,TextExtension:ib,TextureSheetAnimationModule:Ts,TiltShiftEffect:yc,ToneMappingEffect:oc,TrailModule:Ci,TransformData:an,TransformGizmo:ip,TriggerBuilder:es,TriggerModel:ih,UIRaycastUtils:ZS,UIRootComponent:O0,USDZExporter:li,USDZText:ru,USDZUIExtension:yE,UsageMarker:nb,VariantAction:jO,VelocityOverLifetimeModule:Pi,VerticalLayoutGroup:u2,VideoPlayer:Tn,Vignette:np,VisibilityAction:K0,Voip:Hu,Volume:xb,VolumeParameter:Ae,VolumeProfile:Q0,WebARCameraBackground:GE,WebARSessionRoot:fh,WebXR:Ai,WebXRImageTracking:oh,WebXRImageTrackingModel:bc,WebXRPlaneTracking:Th,WebXRTrackedImage:ou,XRControllerFollow:Rh,XRControllerModel:ac,XRControllerMovement:So,XRFlag:Kn,XRRig:HE,XRState:bs,__Ignore:rL},Symbol.toStringTag,{value:"Module"}));class tY extends oe{constructor(){super(...arguments);h(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}O.add("__Ignore",rL);O.add("ActionBuilder",Ct);O.add("ActionCollection",GO);O.add("ActionModel",Br);O.add("AlignmentConstraint",D0);O.add("Animation",qs);O.add("AnimationCurve",Jo);O.add("AnimationExtension",z0);O.add("AnimationTrackHandler",eE);O.add("Animator",Cs);O.add("AnimatorController",yo);O.add("Antialiasing",j0);O.add("AudioExtension",ju);O.add("AudioListener",vu);O.add("AudioSource",kt);O.add("AudioTrackHandler",ff);O.add("Avatar",Eu);O.add("Avatar_Brain_LookAt",wy);O.add("Avatar_MouthShapes",V0);O.add("Avatar_MustacheShake",s2);O.add("Avatar_POI",Kl);O.add("AvatarBlink_Simple",Gf);O.add("AvatarEyeLook_Rotation",sh);O.add("AvatarLoader",r2);O.add("AvatarMarker",_n);O.add("AvatarModel",aE);O.add("AxesHelper",Lm);O.add("BaseUIComponent",sa);O.add("BasicIKConstraint",o2);O.add("BehaviorExtension",cE);O.add("BehaviorModel",cn);O.add("BloomEffect",Jl);O.add("BoxCollider",Vu);O.add("BoxGizmo",Vf);O.add("BoxHelperComponent",Xo);O.add("Button",_h);O.add("CallInfo",Nl);O.add("Camera",Bt);O.add("CameraTargetReachedEvent",yy);O.add("Canvas",In);O.add("CanvasGroup",Iu);O.add("CapsuleCollider",dh);O.add("ChangeMaterialOnClick",Vl);O.add("ChangeTransformOnClick",Wf);O.add("CharacterController",qf);O.add("CharacterControllerInput",xh);O.add("ChromaticAberration",J0);O.add("Collider",Io);O.add("ColorAdjustments",qu);O.add("ColorBySpeedModule",Xf);O.add("ColorOverLifetimeModule",eb);O.add("ContactShadows",bo);O.add("ControlTrackHandler",tE);O.add("CustomBranding",Ku);O.add("Deletable",P2);O.add("DeleteBox",bE);O.add("DepthOfField",hl);O.add("DeviceFlag",_E);O.add("DocumentExtension",M2);O.add("DragControls",wn);O.add("DropListener",$u);O.add("Duplicatable",Sh);O.add("EffectWrapper",Dy);O.add("EmissionModule",pc);O.add("EmphasizeOnClick",jm);O.add("EventList",ti);O.add("EventListEvent",YS);O.add("EventSystem",Dr);O.add("EventTrigger",CE);O.add("FieldWithDefault",S2);O.add("FixedJoint",k2);O.add("FlyControls",D2);O.add("Fog",Vm);O.add("GltfExport",Ua);O.add("GltfExportBox",U2);O.add("Gradient",Xu);O.add("Graphic",Zl);O.add("GraphicRaycaster",JS);O.add("GridHelper",Wm);O.add("GridLayoutGroup",f2);O.add("GroundProjectedEnv",yh);O.add("GroupActionModel",nu);O.add("HideOnStart",p2);O.add("HingeJoint",rb);O.add("HorizontalLayoutGroup",d2);O.add("Image",zm);O.add("InheritVelocityModule",gc);O.add("InputField",uo);O.add("InstanceHandle",gf);O.add("InstancingHandler",pf);O.add("Interactable",B2);O.add("Keyframe",ur);O.add("Light",Hr);O.add("LimitVelocityOverLifetimeModule",hn);O.add("LODGroup",lb);O.add("LODModel",Jf);O.add("LogStats",N2);O.add("LookAt",$l);O.add("LookAtConstraint",jf);O.add("MainModule",Is);O.add("MaskableGraphic",q0);O.add("MeshCollider",Hf);O.add("MeshRenderer",$0);O.add("MinMaxCurve",Se);O.add("MinMaxGradient",xn);O.add("NeedleMenu",Ac);O.add("NestedGltf",RE);O.add("Networking",ph);O.add("NoiseModule",Nt);O.add("ObjectRaycaster",Co);O.add("OffsetConstraint",Zf);O.add("OpenURL",Xm);O.add("OrbitControls",Lt);O.add("Outline",Um);O.add("Padding",Wu);O.add("ParticleBurst",Iy);O.add("ParticleSubEmitter",UE);O.add("ParticleSystem",wi);O.add("ParticleSystemRenderer",la);O.add("PhysicsExtension",AE);O.add("PixelationEffect",Ab);O.add("PlayableDirector",$a);O.add("PlayAnimationOnClick",Wa);O.add("PlayAudioOnClick",Tu);O.add("PlayerColor",um);O.add("PlayerState",Zn);O.add("PlayerSync",Gu);O.add("PointerEventData",km);O.add("PostProcessingHandler",NE);O.add("PreliminaryAction",Gm);O.add("PreliminaryTrigger",Y0);O.add("PresentationMode",tY);O.add("RawImage",fE);O.add("Rect",c2);O.add("RectTransform",ts);O.add("ReflectionProbe",Wl);O.add("RegisteredAnimationInfo",iE);O.add("RemoteSkybox",lc);O.add("Renderer",ci);O.add("RendererLightmap",Cy);O.add("Rigidbody",It);O.add("RotationBySpeedModule",To);O.add("RotationOverLifetimeModule",aa);O.add("SceneSwitcher",Mn);O.add("ScreenCapture",td);O.add("ScreenSpaceAmbientOcclusion",Eh);O.add("ScreenSpaceAmbientOcclusionN8",dl);O.add("SetActiveOnClick",ho);O.add("ShadowCatcher",yb);O.add("ShapeModule",ei);O.add("SharpeningEffect",vb);O.add("SignalAsset",F0);O.add("SignalReceiver",nh);O.add("SignalReceiverEvent",Om);O.add("SignalTrackHandler",by);O.add("Size",l2);O.add("SizeBySpeedModule",mr);O.add("SizeOverLifetimeModule",Yu);O.add("SkinnedMeshRenderer",E2);O.add("SmoothFollow",tl);O.add("SpatialGrabRaycaster",Au);O.add("SpatialHtml",_b);O.add("SpatialTrigger",wu);O.add("SpatialTriggerReceiver",ec);O.add("SpectatorCamera",QE);O.add("SphereCollider",Fm);O.add("Sprite",mc);O.add("SpriteData",el);O.add("SpriteRenderer",Gr);O.add("SpriteSheet",Bu);O.add("SubEmitterSystem",Ny);O.add("SyncedCamera",Af);O.add("SyncedRoom",fl);O.add("SyncedTransform",rc);O.add("TapGestureTrigger",g2);O.add("TeleportTarget",mE);O.add("TestRunner",iL);O.add("TestSimulateUserData",nL);O.add("Text",$s);O.add("TextBuilder",vE);O.add("TextExtension",ib);O.add("TextureSheetAnimationModule",Ts);O.add("TiltShiftEffect",yc);O.add("ToneMappingEffect",oc);O.add("TrailModule",Ci);O.add("TransformData",an);O.add("TransformGizmo",ip);O.add("TriggerBuilder",es);O.add("TriggerModel",ih);O.add("UIRaycastUtils",ZS);O.add("UIRootComponent",O0);O.add("UsageMarker",nb);O.add("USDZExporter",li);O.add("USDZText",ru);O.add("USDZUIExtension",yE);O.add("VariantAction",jO);O.add("VelocityOverLifetimeModule",Pi);O.add("VerticalLayoutGroup",u2);O.add("VideoPlayer",Tn);O.add("Vignette",np);O.add("VisibilityAction",K0);O.add("Voip",Hu);O.add("Volume",xb);O.add("VolumeParameter",Ae);O.add("VolumeProfile",Q0);O.add("WebARCameraBackground",GE);O.add("WebARSessionRoot",fh);O.add("WebXR",Ai);O.add("WebXRImageTracking",oh);O.add("WebXRImageTrackingModel",bc);O.add("WebXRPlaneTracking",Th);O.add("WebXRTrackedImage",ou);O.add("XRControllerFollow",Rh);O.add("XRControllerModel",ac);O.add("XRControllerMovement",So);O.add("XRFlag",Kn);O.add("XRRig",HE);O.add("XRState",bs);const Rg=bn,iY=Q("debugtypestore");iY&&console.log(O);function nY(s,i){const n=i6(s,i);return n!==void 0?n:null}const sY=new t6,Iw=Symbol("deserialize-queue");async function rY(s,i,t,n=null,r){if(!t)return;let o=n;typeof o=="number"&&(o=new En(n));const a=i.indexOf("?");i=a===-1?i:i.substring(0,a);const l=new tO(t.scene);l.gltfId=i,l.context=s,l.gltf=t,l.nodeToObject=r==null?void 0:r.nodeToObjectMap,l.implementationInformation=sY;let c=s[Iw];if(c||(c=s[Iw]=[]),t.scenes)for(const u of t.scenes)await yC(l,u,c);if(t.children)for(const u of t.children)await yC(l,u,c);s.new_scripts_pre_setup_callbacks.push(()=>{const u=s[Iw];if(u){for(const d of u)oY(d,l);u.length=0}if(o){const d={},f=[];vC(t,o,d,f);for(const p of t.scenes)vC(p,o,d,f);for(const p of f)p.resolveGuids(d)}})}const AC=Symbol("original-component-name"),yd=new Map;function vC(s,i,t,n){if(i===null||!s)return;const r=s.guid,o=s.guid;o!=null&&o.length&&(yd.has(o)||(Rg&&console.log('Creating InstanceIdProvider with key "'+o+'" for object '+s.name),yd.set(o,new En(o))));const a=o&&yd.get(o)||i;if(s.guid=a.generateUUID(),r&&r!=="invalid"&&(t[r]=s.guid),s&&s.userData&&s.userData.components)for(const l of s.userData.components){if(l===null)continue;const c=l.guid;c?yd.has(c)||(Rg&&console.log('Creating InstanceIdProvider with key "'+c+'" for component '+l[AC]),yd.set(c,new En(c))):Rg&&console.warn("Can not create IdProvider: component "+l[AC]+" has no guid",l.guid);const u=yd.get(c)||i,d=l.guid;l.guid=u.generateUUID(),d&&d!=="invalid"&&(t[d]=l.guid),l.resolveGuids&&n.push(l)}if(s.children)for(const l of s.children)vC(l,i,t,n)}const kp=[];async function yC(s,i,t,n){if(!i)return;const r=i.userData;if(r){const o=r.builtin_components;if(o&&o.length>0)for(const a of o)try{if(a===null)continue;const l=O.get(a.name);if(l!=null){const c=new l;c.sourceId=s.gltfId,Mf(c,a,s.implementationInformation),c.context=s.context,"guid"in a&&(c[vv]=a.guid),c[AC]=a.name,uf(i,c,!1),t.push({instance:c,compData:a,obj:i}),c.isCamera&&s.context&&s.context.mainCamera===null&&c.tag==="MainCamera"&&s.context.setCurrentCamera(c)}else Rg&&console.debug("unknown component: "+a.name),kp.includes(a.name)||kp.push(a.name)}catch(l){console.error(a.name+" - "+l.message,l)}if(kp.length>0){const a=kp.join(", ");console.warn("unknown components: "+a),kp.length=0,fr()&&bi(`<strong>Unknown components in scene</strong>:

${a}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Yi.Warn)}}if(i.children)for(const o of i.children)await yC(s,o,t)}function oY(s,i){const{instance:t,compData:n,obj:r}=s;i.object=r,i.target=t,Sx(t,n,i),Rg&&console.debug("add "+n.name,n,t)}const oL=Q("debugfileformat");async function aY(s,i=!0){var n;if(i){const r=s,o=new URL(r,globalThis.location.origin);let a=null;const l=o.searchParams.get("filetype");switch(l&&(a=l.toUpperCase()),a!=null&&a.length||(a=(n=o.pathname.split(".").pop())==null?void 0:n.toUpperCase()),console.debug("Use file extension to determine type: "+a),a){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const t=await fetch(s,{method:"GET",headers:{range:"bytes=0-32"}}).catch(r=>null);if(t!=null&&t.ok){const r=await t.arrayBuffer(),o=lY(r);return oL&&console.log("Determined file type from header: "+o),o}return"unknown"}function lY(s){if(s.byteLength<4)return"unknown";const i=new Uint8Array(s);return oL&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(s)+`"
`,i),i[0]==103&&i[1]==108&&i[2]==84&&i[3]==70?(console.debug("GLTF detected"),"glb"):i[0]==80&&i[1]==75&&i[2]==3&&i[3]==4?(console.debug("USDZ detected"),"usdz"):i[0]==80&&i[1]==88&&i[2]==82&&i[3]==45&&i[4]==85&&i[5]==83&&i[6]==68&&i[7]==67?(console.debug("Binary USD detected"),"usd"):i[0]==35&&i[1]==117&&i[2]==115&&i[3]==100&&i[4]==97?(console.debug("ASCII USD detected"),"usda"):i[0]==75&&i[1]==97&&i[2]==121&&i[3]==100&&i[4]==97&&i[5]==114&&i[6]==97&&i[7]==32?(console.debug("Binary FBX detected"),"fbx"):i[0]==59&&i[1]==32&&i[2]==70&&i[3]==66&&i[4]==88&&i[5]==32?(console.debug("ASCII FBX detected"),"fbx"):i[0]==35&&i[1]==32&&i[2]==66&&i[3]==108&&i[4]==101&&i[5]==110&&i[6]==100&&i[7]==101&&i[8]==114&&i[9]==32||i[0]==35&&i[1]==32&&i[2]==65&&i[3]==108&&i[4]==105&&i[5]==97&&i[6]==115&&i[7]==32&&i[8]==79&&i[9]==66&&i[10]==74?(console.debug("OBJ detected"),"obj"):(console.debug("Could not determine file type from binary data",i),"unknown")}class aL{createBuiltinComponents(i,t,n,r,o){return rY(i,t,n,r,o)}writeBuiltinComponentData(i,t){return nY(i,t)}parseSync(i,t,n,r){return cY(i,t,n,r)}loadSync(i,t,n,r,o){return dL(i,t,n,r,o)}}HP(aL);const lL=Q("printGltf")||Q("printgltf"),cL=Q("downloadgltf");var ah;(function(s){s[s.BeforeLoad=0]="BeforeLoad",s[s.AfterLoaded=1]="AfterLoaded",s[s.FinishedSetup=10]="FinishedSetup"})(ah||(ah={}));class vf{constructor(i,t,n,r){h(this,"context");h(this,"loader");h(this,"path");h(this,"gltf");this.context=i,this.path=t,this.loader=n,this.gltf=r}}const lh={};function fJ(s,i){lh[s]=lh[s]||[],lh[s].push(i)}function pJ(s,i){if(lh[s]){const t=lh[s].indexOf(i);t>=0&&lh[s].splice(t,1)}}function yf(s,i){if(lh[s])for(const t of lh[s])t(i)}async function hL(s,i,t,n,r){lL&&console.warn("glTF",i,t),i.includes("?")&&(i=i.split("?")[0]),await nl().createBuiltinComponents(s,i,t,n,r)}async function uL(s,i){const t=await aY(s)||"unknown";switch(console.debug("Determined file type: "+t+" for url",s),t){case"unknown":return console.warn("Unknown file type. Assuming glTF:",s),new rl;case"fbx":return new BO;case"obj":return new qS;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",t);case"gltf":case"glb":case"vrm":const n=new rl;return await _2(n,i,s),n}}async function cY(s,i,t,n){typeof t!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),t=""),lL&&console.log("Parse glTF",t);const r=await uL(t,s);if(!r)return;if(r instanceof qS){typeof i!="string"&&(i=new TextDecoder().decode(i));const a=r.parse(i);return{animations:a.animations,scene:a,scenes:[a]}}if(!(r instanceof rl)){const a=r.parse(i,t);return gL(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=b2(r);return new Promise((a,l)=>{try{let c=t.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const d=c.split("/");d.pop(),c=d.join("/"),c.endsWith("/")||(c+="/")}r.resourcePath=c,k0(r,s),yf(ah.BeforeLoad,new vf(s,t,r));const u=s.mainCamera;r.parse(i,"",async d=>{x2(t,d,s),yf(ah.AfterLoaded,new vf(s,t,r,d)),await hL(s,t,d,n,o),await fL(d.scene,s,u),yf(ah.FinishedSetup,new vf(s,t,r,d)),a(d),cL&&pL(i)},d=>{console.error('Loading asset at "'+t+`" failed
`,d),a(void 0)})}catch(c){console.error(c),l(c)}})}async function dL(s,i,t,n,r){hY(i);const o=await uL(i,s);if(!o)return;if(!(o instanceof rl)){const l=await o.loadAsync(i,r);return gL(o,l),{animations:l.animations,scene:l,scenes:[l]}}const a=b2(o);return new Promise((l,c)=>{try{k0(o,s),yf(ah.BeforeLoad,new vf(s,i,o));const u=s.mainCamera;o.load(i,async d=>{x2(i,d,s),yf(ah.AfterLoaded,new vf(s,i,o,d)),await hL(s,t,d,n,a),await fL(d.scene,s,u),yf(ah.FinishedSetup,new vf(s,i,o,d)),l(d),cL&&pL(i)},d=>{r==null||r.call(o,d)},d=>{console.error('Loading asset at "'+i+`" failed
`,d),l(void 0)})}catch(u){console.error(u),c(u)}})}async function fL(s,i,t){t||(t=i.mainCamera);try{t?await i.renderer.compileAsync(s,t,i.scene).catch(n=>{console.warn(n.message)}):E5(s,i)}catch(n){console.warn((n==null?void 0:n.message)||n)}}function hY(s){if(new URL(s,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;bi(t),console.warn(t)}}function pL(s){if(typeof s=="string"){const i=document.createElement("a");i.href=s,i.download=s.split("/").pop(),i.click()}else{const i=new Blob([s],{type:"application/octet-stream"}),t=window.URL.createObjectURL(i),n=document.createElement("a");n.href=t,n.download="download.glb",n.click()}}function gL(s,i){if(i!=null&&i.isObject3D){const t=i;s instanceof BO?t.traverse(n=>{const r=n;r!=null&&r.isMesh&&XM(r,r.material)}):s instanceof qS&&t.traverse(n=>{})}}HP(aL);const Ti=Q("debugwebcomponent"),$B="needle-engine",mL="vr",AL="desktop",uY=[TO,mL,AL],Dp="ar-session-active",Op="desktop-session-active",dY=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure"];class vL extends HTMLElement{constructor(){super();h(this,"_context");h(this,"_overlay_ar");h(this,"_loadingProgress01",0);h(this,"_loadingView");h(this,"_previousSrc",null);h(this,"_didFullyLoad",!1);h(this,"_loadId",0);h(this,"_abortController",null);h(this,"_lastSourceFiles",null);h(this,"_createContextPromise",null);h(this,"onXRSessionStarted",()=>{var n;const t=this.context.xrSessionMode;t==="immersive-ar"?this.onEnterAR(this.context.xrSession):t==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(n=this.context.xrSession)==null||n.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:t}})),t==="immersive-ar"?this.onExitAR(this.context.xrSession):t==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});h(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});h(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});h(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new GH,this.addEventListener("ready",this.onReady),xO(),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Ge({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return dY}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return t==null?null:!(t===null||t==="False"||t==="false"||t==="0")}getContext(){return new Promise((t,n)=>{if(this._context&&this.loadingFinished)t(this._context);else{const r=()=>{this.removeEventListener("loadfinished",r),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",r)}})}get context(){return this._context}async connectedCallback(){if(Ti&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const n=globalThis["needle:codegen_files"];Ti&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',n),n&&(Ti&&console.log('globalThis["needle:codegen_files"]',n),this.setAttribute("src",n))}Ti&&console.log("src",this.getAttribute("src"));const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1),Yo!=null&&Yo.length&&this.setAttribute("version",Yo)}disconnectedCallback(){var r;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const t=this.getAttribute("keep-alive"),n=t==null||(t==null?void 0:t.length)>0&&t!=="true"&&t!=="1";Ti&&console.warn('<needle-engine> disconnected, keep-alive: "'+t+'"',typeof t,"Dispose=",n),n?(Ti&&console.warn("<needle-engine> dispose"),(r=this._context)==null||r.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):Ti&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(t,n,r){switch(Ti&&console.log("attributeChangedCallback",t,n,r),t){case"src":Ti&&console.warn(`<needle-engine src>
changed from "`,n,'" to "',r,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=r);break;case"loadstart":case"progress":case"loadfinished":typeof r=="string"&&r.length>0&&(Ti&&console.log(t+" attribute changed",r),this.registerEventFromAttribute(t,r));break;case"dracoDecoderPath":Ti&&console.log("dracoDecoderPath",r),XT(r);break;case"dracoDecoderType":r==="wasm"||r==="js"?(Ti&&console.log("dracoDecoderType",r),YT(r)):console.error("Invalid dracoDecoderType",r,"expected js or wasm");break;case"ktx2DecoderPath":Ti&&console.log("ktx2DecoderPath",r),KT(r);break;case"tone-mapping":{this.applyTonemapping();break}case"tone-mapping-exposure":this.applyTonemapping()}}async onLoad(){var A,y;if(!this.isConnected)return;if(this._context||(Ti&&console.warn("Create new context"),this._context=new Ge({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._abortController&&(Ti&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=t;const n=++this._loadId;if((t==null||t.length<=0)&&(Ti&&console.warn("Clear scene",t),this._context.clear(),n!==this._loadId))return;const r=this.getAttribute("alias");this.classList.add("loading");const o=eh();this.ensureLoadStartIsRegistered();let a=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:r},cancelable:!0}));if(o){const b=this.getAttribute("hide-loading-overlay");b!=null&&b!=="0"&&(a=!1)}a===!1&&!o&&(be()||(a=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),be()&&Xt('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&a&&(this._loadingView=new Dv(this)),a&&(this._didFullyLoad!==!0?(A=this._loadingView)==null||A.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===n&&this._loadingView.onLoadingBegin("begin load")},300)),Ti&&console.warn(`--------------
Needle Engine: Begin loading `+n+`
`,t),this.onBeforeBeginLoading();const l=[],c={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},u=new CustomEvent("progress",{detail:c}),d=new Array,f=new AbortController;this._abortController=f;const p={files:t,abortSignal:f.signal,onLoadingProgress:b=>{var w;if(f.signal.aborted)return;const _=b.index;!d[_]&&b.name&&(d[_]=fY(b.name)),b.name=d[_],a&&((w=this._loadingView)==null||w.onLoadingUpdate(b)),c.name=b.name,c.progress=b.progress,this._loadingProgress01=IO(b),c.totalProgress01=this._loadingProgress01,this.dispatchEvent(u)},onLoadingFinished:(b,_,w)=>{f.signal.aborted||w&&l.push({src:_,file:w})}},g=this.getAttribute("hash");g!=null&&(this._context.hash=g),this._context.alias=r,this._createContextPromise=this._context.create(p);const m=await this._createContextPromise;if(this.applyTonemapping(),Ti&&console.warn(`--------------
Needle Engine: finished loading `+n+`
`,t,`Aborted? ${f.signal.aborted}`),this._loadId!==n||f.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,a&&m&&((y=this._loadingView)==null||y.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:r,loadedFiles:l}}))}applyTonemapping(){var r;if(!((r=this._context)!=null&&r.renderer))return;const t=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(t==null?void 0:t.toLowerCase()){case"none":this._context.renderer.toneMapping=Cf;break;case"linear":this._context.renderer.toneMapping=o0;break;case"neutral":this._context.renderer.toneMapping=Qg;break;case"agx":this._context.renderer.toneMapping=r0;break;default:t!=null&&console.warn("Invalid tone-mapping attribute: "+t)}const n=this.getAttribute("tone-mapping-exposure");if(n!=null){const o=parseFloat(n);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}internalSetLoadingMessage(t){var n;(n=this._loadingView)==null||n.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let n;Array.isArray(t)?n=t:t.startsWith("[")&&t.endsWith("]")?n=JSON.parse(t):t.includes(",")?n=t.split(","):n=[t];for(let r=n.length-1;r>=0;r--){const o=n[r];(o==="null"||o==="undefined"||(o==null?void 0:o.length)<=0)&&n.splice(r,1)}return n}checkIfSourceHasChanged(t,n){if((t==null?void 0:t.length)!==(n==null?void 0:n.length)||t==null&&n!==null||t!==null&&n==null)return!0;if(t!==null&&n!==null){for(let r=0;r<(t==null?void 0:t.length);r++)if(t[r]!==n[r])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,n){const r=this._previouslyRegisteredMap.get(t);if(r&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,r)),typeof n=="string"&&n.length>0)try{const o=(0,eval)(n);typeof o=="function"&&(this._previouslyRegisteredMap.set(t,o),this.addEventListener(t,a=>o==null?void 0:o.call(globalThis,this._context,a)))}catch(o){console.error("Error registering event "+t+'="'+n+`" failed with the following error:
`,o)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const n=this.children[t];if(n.classList.contains("vr"))return n}return null}onEnterAR(t){var r;this.onSetupAR();const n=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,n,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(r=this._overlay_ar)==null?void 0:r.ARContainer}}))}onExitAR(t){var n;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(Dp),this.classList.remove(Op);const t=this.getAROverlayContainer();Ti&&console.warn("onSetupAR:",t),t&&(t.classList.add(Dp),t.classList.remove(Op)),this.foreachHtmlElement(n=>this.setupElementsForMode(n,TO))}onSetupVR(){this.classList.remove(Dp),this.classList.remove(Op),this.foreachHtmlElement(t=>this.setupElementsForMode(t,mL))}onSetupDesktop(){this.classList.remove(Dp),this.classList.add(Op);const t=this.getAROverlayContainer();t&&(t.classList.remove(Dp),t.classList.add(Op)),this.foreachHtmlElement(n=>this.setupElementsForMode(n,AL))}setupElementsForMode(t,n,r=null){var a,l;if(t===((l=(a=this._context)==null?void 0:a.renderer)==null?void 0:l.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(n))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const c of uY)t.classList.contains(c)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let n=0;n<this.children.length;n++){const r=this.children[n];r.style&&t(r)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(Ti&&console.log("using custom draco decoder path",t),XT(t));const n=this.getAttribute("dracoDecoderType");n&&(Ti&&console.log("using custom draco decoder type",n),YT(n));const r=this.getAttribute("ktx2DecoderPath");r&&(Ti&&console.log("using custom ktx2 decoder path",r),KT(r))}}typeof window<"u"&&!window.customElements.get($B)&&window.customElements.define($B,vL);function fY(s){if(s.startsWith("blob:"))return"blob";const i=s.split("/");let t=i[i.length-1];const n=t.indexOf("?");n>0&&(t=t.substring(0,n));const r=t.indexOf("=");r>0&&(t=t.substring(r));const o=t.split(".").pop(),l=o?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(o.toLowerCase()):-1;if(o&&l>=0&&(t=t.substring(0,t.length-o.length-1)),t=decodeURIComponent(t),t.length>3){let c="",u=!1;const d=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let f=0;f<t.length;f++){let p=t[f];(p==="_"||p==="-")&&(p=" "),!(p===" "&&c.length<=0||d.includes(p)||(c.length===0&&(p=p.toUpperCase()),u&&p===" "))&&(u&&(p=p.toUpperCase()),u=!1,c+=p,p===" "&&(u=!0))}return console.debug('Generated display name: "'+t+'" â†’ "'+c+'"'),c.trim()}return console.debug("Loading: use default name",t),t}const pY=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:vL},Symbol.toStringTag,{value:"Module"}));function gY(){Ja.registerWaitForAllowAudio(()=>{const s=iU.getContext();s.addEventListener("statechange",()=>{setTimeout(()=>{const i=s.state;(i==="suspended"||i==="interrupted")&&s.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(t=>{console.log("Failed to resume AudioContext: "+t)})},500)})})}setTimeout(gY,1e3);const zv=Q("debughotreload");let dm=!1;const Bg=new Map;function gJ(){return dm}function mJ(s){var n;if(dm)return;const t=s.constructor.name;Bg.has(t)?(n=Bg.get(t))==null||n.push(s):Bg.set(t,[s])}function AJ(s){if(dm)return;const t=s.constructor.name,n=Bg.get(t);if(!n)return;const r=n.indexOf(s);r!==-1&&n.splice(r,1)}let eP=!1;function mY(){if(zv||eP)return;eP=!0;const s=console.error;console.error=(...i)=>{if(i.length){const t=i[0];if(typeof t=="string"&&t.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}s.apply(console,i)}}function vJ(s){zv&&console.log("[HMR] Apply changes",s,Object.keys(s)),mY();for(const i of Object.keys(s))try{dm=!0;const t=O.get(i);if(!t){zv&&console.log("[HMR] Type not found: "+i);continue}const n=s[i],r=Bg.get(n.name);let o="[Needle Engine] Updating type: "+i;const a=(r==null?void 0:r.length)??-1;a>0?o+=" x"+a:o+=" - no instances",console.log(o);const l=Object.getOwnPropertyNames(t.prototype),c=Object.getOwnPropertyDescriptors(n.prototype);for(const u in c)c[u].writable&&(t.prototype[u]=s[i].prototype[u]);for(const u of l)c[u]||delete t.prototype[u];if(r){const u=new n,d=Object.getOwnPropertyDescriptors(u);for(const f of r){const p=f,g=p.isComponent===!0,m=g?p.activeAndEnabled:!0,A=g?p.context:void 0;try{if(g&&A&&Ul(p,A),g&&m&&(p.enabled=!1),f.onBeforeHotReloadFields&&f.onBeforeHotReloadFields()===!1)continue;for(const y in d)if(d[y].writable){if(f[y]===void 0)f[y]=u[y];else if(typeof f[y]=="function"&&!f[y].prototype){const _=f[y],w=_.name,S="bound ";if(w===S)continue;const E=_.name.substring(S.length),I=n.prototype[E];I&&(f[y]=I.bind(f))}}f.onAfterHotReloadFields&&f.onAfterHotReloadFields()}finally{g&&A&&MS(p,A),g&&m&&(p.enabled=!0)}}}}catch(t){if(zv)console.error(t);else return!1}finally{dm=!1,Qa(Yi.Log,"Script changes applied (HMR)")}return!0}let ce;const fm=new Array(128).fill(void 0);fm.push(void 0,null,!0,!1);fm.length;let cv=null;function tP(){return cv!==null&&cv.byteLength!==0||(cv=new Int32Array(ce.memory.buffer)),cv}const AY=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&AY.decode();function Te(s,i){if(!(s instanceof i))throw new Error(`expected instance of ${i.name}`);return s.ptr}let hv=null;function vY(){return hv!==null&&hv.byteLength!==0||(hv=new Float32Array(ce.memory.buffer)),hv}let Pg=128;function iP(s){if(Pg==1)throw new Error("out of js stack");return fm[--Pg]=s,Pg}let uv=null;function yY(){return uv!==null&&uv.byteLength!==0||(uv=new Uint32Array(ce.memory.buffer)),uv}let Sr=0;function Gh(s,i){const t=i(4*s.length,4)>>>0;return vY().set(s,t/4),Sr=s.length,t}function dv(s,i){const t=i(4*s.length,4)>>>0;return yY().set(s,t/4),Sr=s.length,t}const jn=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class bY{__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_raweventqueue_free(i)}constructor(i){const t=ce.raweventqueue_new(i);return this.__wbg_ptr=t>>>0,this}drainCollisionEvents(i){try{ce.raweventqueue_drainCollisionEvents(this.__wbg_ptr,iP(i))}finally{fm[Pg++]=void 0}}drainContactForceEvents(i){try{ce.raweventqueue_drainContactForceEvents(this.__wbg_ptr,iP(i))}finally{fm[Pg++]=void 0}}clear(){ce.raweventqueue_clear(this.__wbg_ptr)}}class As{static __wrap(i){i>>>=0;const t=Object.create(As.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawgenericjoint_free(i)}static generic(i,t,n,r){Te(i,Ce),Te(t,Ce),Te(n,Ce);const o=ce.rawgenericjoint_generic(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r);return o===0?void 0:As.__wrap(o)}static spring(i,t,n,r,o){Te(r,Ce),Te(o,Ce);const a=ce.rawgenericjoint_spring(i,t,n,r.__wbg_ptr,o.__wbg_ptr);return As.__wrap(a)}static rope(i,t,n){Te(t,Ce),Te(n,Ce);const r=ce.rawgenericjoint_rope(i,t.__wbg_ptr,n.__wbg_ptr);return As.__wrap(r)}static spherical(i,t){Te(i,Ce),Te(t,Ce);const n=ce.rawgenericjoint_spherical(i.__wbg_ptr,t.__wbg_ptr);return As.__wrap(n)}static prismatic(i,t,n,r,o,a){Te(i,Ce),Te(t,Ce),Te(n,Ce);const l=ce.rawgenericjoint_prismatic(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r,o,a);return l===0?void 0:As.__wrap(l)}static fixed(i,t,n,r){Te(i,Ce),Te(t,Xn),Te(n,Ce),Te(r,Xn);const o=ce.rawgenericjoint_fixed(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr);return As.__wrap(o)}static revolute(i,t,n){Te(i,Ce),Te(t,Ce),Te(n,Ce);const r=ce.rawgenericjoint_revolute(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr);return r===0?void 0:As.__wrap(r)}}class VE{static __wrap(i){i>>>=0;const t=Object.create(VE.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawpointprojection_free(i)}point(){const i=ce.rawpointprojection_point(this.__wbg_ptr);return Ce.__wrap(i)}isInside(){return ce.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class WE{static __wrap(i){i>>>=0;const t=Object.create(WE.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawrayintersection_free(i)}normal(){const i=ce.rawraycolliderintersection_normal(this.__wbg_ptr);return Ce.__wrap(i)}toi(){return ce.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return ce.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const n=ce.__wbindgen_add_to_stack_pointer(-16);ce.rawpointcolliderprojection_featureId(n,this.__wbg_ptr);var i=tP()[n/4+0],t=tP()[n/4+1];return i===0?void 0:t>>>0}finally{ce.__wbindgen_add_to_stack_pointer(16)}}}class Xn{static __wrap(i){i>>>=0;const t=Object.create(Xn.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawrotation_free(i)}constructor(i,t,n,r){const o=ce.rawrotation_new(i,t,n,r);return this.__wbg_ptr=o>>>0,this}static identity(){const i=ce.rawrotation_identity();return Xn.__wrap(i)}get x(){return ce.rawrotation_x(this.__wbg_ptr)}get y(){return ce.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return ce.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return ce.rawintegrationparameters_erp(this.__wbg_ptr)}}class $e{static __wrap(i){i>>>=0;const t=Object.create($e.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawshape_free(i)}static cuboid(i,t,n){const r=ce.rawshape_cuboid(i,t,n);return $e.__wrap(r)}static roundCuboid(i,t,n,r){const o=ce.rawshape_roundCuboid(i,t,n,r);return $e.__wrap(o)}static ball(i){const t=ce.rawshape_ball(i);return $e.__wrap(t)}static halfspace(i){Te(i,Ce);const t=ce.rawshape_halfspace(i.__wbg_ptr);return $e.__wrap(t)}static capsule(i,t){const n=ce.rawshape_capsule(i,t);return $e.__wrap(n)}static cylinder(i,t){const n=ce.rawshape_cylinder(i,t);return $e.__wrap(n)}static roundCylinder(i,t,n){const r=ce.rawshape_roundCylinder(i,t,n);return $e.__wrap(r)}static cone(i,t){const n=ce.rawshape_cone(i,t);return $e.__wrap(n)}static roundCone(i,t,n){const r=ce.rawshape_roundCone(i,t,n);return $e.__wrap(r)}static polyline(i,t){const n=Gh(i,ce.__wbindgen_malloc),r=Sr,o=dv(t,ce.__wbindgen_malloc),a=Sr,l=ce.rawshape_polyline(n,r,o,a);return $e.__wrap(l)}static trimesh(i,t){const n=Gh(i,ce.__wbindgen_malloc),r=Sr,o=dv(t,ce.__wbindgen_malloc),a=Sr,l=ce.rawshape_trimesh(n,r,o,a);return $e.__wrap(l)}static heightfield(i,t,n,r){const o=Gh(n,ce.__wbindgen_malloc),a=Sr;Te(r,Ce);const l=ce.rawshape_heightfield(i,t,o,a,r.__wbg_ptr);return $e.__wrap(l)}static segment(i,t){Te(i,Ce),Te(t,Ce);const n=ce.rawshape_segment(i.__wbg_ptr,t.__wbg_ptr);return $e.__wrap(n)}static triangle(i,t,n){Te(i,Ce),Te(t,Ce),Te(n,Ce);const r=ce.rawshape_triangle(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr);return $e.__wrap(r)}static roundTriangle(i,t,n,r){Te(i,Ce),Te(t,Ce),Te(n,Ce);const o=ce.rawshape_roundTriangle(i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r);return $e.__wrap(o)}static convexHull(i){const t=Gh(i,ce.__wbindgen_malloc),n=Sr,r=ce.rawshape_convexHull(t,n);return r===0?void 0:$e.__wrap(r)}static roundConvexHull(i,t){const n=Gh(i,ce.__wbindgen_malloc),r=Sr,o=ce.rawshape_roundConvexHull(n,r,t);return o===0?void 0:$e.__wrap(o)}static convexMesh(i,t){const n=Gh(i,ce.__wbindgen_malloc),r=Sr,o=dv(t,ce.__wbindgen_malloc),a=Sr,l=ce.rawshape_convexMesh(n,r,o,a);return l===0?void 0:$e.__wrap(l)}static roundConvexMesh(i,t,n){const r=Gh(i,ce.__wbindgen_malloc),o=Sr,a=dv(t,ce.__wbindgen_malloc),l=Sr,c=ce.rawshape_roundConvexMesh(r,o,a,l,n);return c===0?void 0:$e.__wrap(c)}castShape(i,t,n,r,o,a,l,c,u){Te(i,Ce),Te(t,Xn),Te(n,Ce),Te(r,$e),Te(o,Ce),Te(a,Xn),Te(l,Ce);const d=ce.rawshape_castShape(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l.__wbg_ptr,c,u);return d===0?void 0:XE.__wrap(d)}intersectsShape(i,t,n,r,o){return Te(i,Ce),Te(t,Xn),Te(n,$e),Te(r,Ce),Te(o,Xn),ce.rawshape_intersectsShape(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr)!==0}contactShape(i,t,n,r,o,a){Te(i,Ce),Te(t,Xn),Te(n,$e),Te(r,Ce),Te(o,Xn);const l=ce.rawshape_contactShape(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a);return l===0?void 0:qE.__wrap(l)}containsPoint(i,t,n){return Te(i,Ce),Te(t,Xn),Te(n,Ce),ce.rawshape_containsPoint(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr)!==0}projectPoint(i,t,n,r){Te(i,Ce),Te(t,Xn),Te(n,Ce);const o=ce.rawshape_projectPoint(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r);return VE.__wrap(o)}intersectsRay(i,t,n,r,o){return Te(i,Ce),Te(t,Xn),Te(n,Ce),Te(r,Ce),ce.rawshape_intersectsRay(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o)!==0}castRay(i,t,n,r,o,a){return Te(i,Ce),Te(t,Xn),Te(n,Ce),Te(r,Ce),ce.rawshape_castRay(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o,a)}castRayAndGetNormal(i,t,n,r,o,a){Te(i,Ce),Te(t,Xn),Te(n,Ce),Te(r,Ce);const l=ce.rawshape_castRayAndGetNormal(this.__wbg_ptr,i.__wbg_ptr,t.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o,a);return l===0?void 0:WE.__wrap(l)}}class qE{static __wrap(i){i>>>=0;const t=Object.create(qE.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawshapecontact_free(i)}distance(){return ce.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const i=ce.rawpointprojection_point(this.__wbg_ptr);return Ce.__wrap(i)}point2(){const i=ce.rawraycolliderintersection_normal(this.__wbg_ptr);return Ce.__wrap(i)}normal1(){const i=ce.rawshapecollidertoi_witness2(this.__wbg_ptr);return Ce.__wrap(i)}normal2(){const i=ce.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return Ce.__wrap(i)}}class XE{static __wrap(i){i>>>=0;const t=Object.create(XE.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawshapetoi_free(i)}toi(){return ce.rawrotation_x(this.__wbg_ptr)}witness1(){const i=ce.rawshapetoi_witness1(this.__wbg_ptr);return Ce.__wrap(i)}witness2(){const i=ce.rawcontactforceevent_total_force(this.__wbg_ptr);return Ce.__wrap(i)}normal1(){const i=ce.rawshapetoi_normal1(this.__wbg_ptr);return Ce.__wrap(i)}normal2(){const i=ce.rawshapetoi_normal2(this.__wbg_ptr);return Ce.__wrap(i)}}class Ce{static __wrap(i){i>>>=0;const t=Object.create(Ce.prototype);return t.__wbg_ptr=i,t}__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,i}free(){const i=this.__destroy_into_raw();ce.__wbg_rawvector_free(i)}static zero(){const i=ce.rawvector_zero();return Ce.__wrap(i)}constructor(i,t,n){const r=ce.rawvector_new(i,t,n);return this.__wbg_ptr=r>>>0,this}get x(){return ce.rawrotation_x(this.__wbg_ptr)}set x(i){ce.rawvector_set_x(this.__wbg_ptr,i)}get y(){return ce.rawintegrationparameters_dt(this.__wbg_ptr)}set y(i){ce.rawintegrationparameters_set_dt(this.__wbg_ptr,i)}get z(){return ce.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(i){ce.rawvector_set_z(this.__wbg_ptr,i)}xyz(){const i=ce.rawvector_xyz(this.__wbg_ptr);return Ce.__wrap(i)}yxz(){const i=ce.rawvector_yxz(this.__wbg_ptr);return Ce.__wrap(i)}zxy(){const i=ce.rawvector_zxy(this.__wbg_ptr);return Ce.__wrap(i)}xzy(){const i=ce.rawvector_xzy(this.__wbg_ptr);return Ce.__wrap(i)}yzx(){const i=ce.rawvector_yzx(this.__wbg_ptr);return Ce.__wrap(i)}zyx(){const i=ce.rawvector_zyx(this.__wbg_ptr);return Ce.__wrap(i)}}class _Y{constructor(i,t,n){this.x=i,this.y=t,this.z=n}}class re{static new(i,t,n){return new _Y(i,t,n)}static intoRaw(i){return new Ce(i.x,i.y,i.z)}static zeros(){return re.new(0,0,0)}static fromRaw(i){if(!i)return null;let t=re.new(i.x,i.y,i.z);return i.free(),t}static copy(i,t){i.x=t.x,i.y=t.y,i.z=t.z}}class nP{constructor(i,t,n,r){this.x=i,this.y=t,this.z=n,this.w=r}}class Jt{static identity(){return new nP(0,0,0,1)}static fromRaw(i){if(!i)return null;let t=new nP(i.x,i.y,i.z,i.w);return i.free(),t}static intoRaw(i){return new Xn(i.x,i.y,i.z,i.w)}static copy(i,t){i.x=t.x,i.y=t.y,i.z=t.z,i.w=t.w}}class wY{constructor(i){this.elements=i}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class sP{static fromRaw(i){const t=new wY(i.elements());return i.free(),t}}var Mg,ds,rP,oP,Wi,bC,Qi,aP,Qy,_C,lP,jy,qd;(function(s){s[s.Dynamic=0]="Dynamic",s[s.Fixed=1]="Fixed",s[s.KinematicPositionBased=2]="KinematicPositionBased",s[s.KinematicVelocityBased=3]="KinematicVelocityBased"})(Mg||(Mg={}));class cP{constructor(i,t,n){this.rawSet=i,this.colliderSet=t,this.handle=n}finalizeDeserialization(i){this.colliderSet=i}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(i,t){return this.rawSet.rbLockTranslations(this.handle,i,t)}lockRotations(i,t){return this.rawSet.rbLockRotations(this.handle,i,t)}setEnabledTranslations(i,t,n,r){return this.rawSet.rbSetEnabledTranslations(this.handle,i,t,n,r)}restrictTranslations(i,t,n,r){this.setEnabledTranslations(i,t,n,r)}setEnabledRotations(i,t,n,r){return this.rawSet.rbSetEnabledRotations(this.handle,i,t,n,r)}restrictRotations(i,t,n,r){this.setEnabledRotations(i,t,n,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(i){this.rawSet.rbSetDominanceGroup(this.handle,i)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(i){this.rawSet.rbSetAdditionalSolverIterations(this.handle,i)}enableCcd(i){this.rawSet.rbEnableCcd(this.handle,i)}translation(){let i=this.rawSet.rbTranslation(this.handle);return re.fromRaw(i)}rotation(){let i=this.rawSet.rbRotation(this.handle);return Jt.fromRaw(i)}nextTranslation(){let i=this.rawSet.rbNextTranslation(this.handle);return re.fromRaw(i)}nextRotation(){let i=this.rawSet.rbNextRotation(this.handle);return Jt.fromRaw(i)}setTranslation(i,t){this.rawSet.rbSetTranslation(this.handle,i.x,i.y,i.z,t)}setLinvel(i,t){let n=re.intoRaw(i);this.rawSet.rbSetLinvel(this.handle,n,t),n.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(i,t){this.rawSet.rbSetGravityScale(this.handle,i,t)}setRotation(i,t){this.rawSet.rbSetRotation(this.handle,i.x,i.y,i.z,i.w,t)}setAngvel(i,t){let n=re.intoRaw(i);this.rawSet.rbSetAngvel(this.handle,n,t),n.free()}setNextKinematicTranslation(i){this.rawSet.rbSetNextKinematicTranslation(this.handle,i.x,i.y,i.z)}setNextKinematicRotation(i){this.rawSet.rbSetNextKinematicRotation(this.handle,i.x,i.y,i.z,i.w)}linvel(){return re.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return re.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return re.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return re.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return re.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return re.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return re.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Jt.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return sP.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return sP.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(i){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,i))}setEnabled(i){this.rawSet.rbSetEnabled(this.handle,i)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(i,t){return this.rawSet.rbSetBodyType(this.handle,i,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(i){this.rawSet.rbSetLinearDamping(this.handle,i)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(i,t){this.rawSet.rbSetAdditionalMass(this.handle,i,t)}setAdditionalMassProperties(i,t,n,r,o){let a=re.intoRaw(t),l=re.intoRaw(n),c=Jt.intoRaw(r);this.rawSet.rbSetAdditionalMassProperties(this.handle,i,a,l,c,o),a.free(),l.free(),c.free()}setAngularDamping(i){this.rawSet.rbSetAngularDamping(this.handle,i)}resetForces(i){this.rawSet.rbResetForces(this.handle,i)}resetTorques(i){this.rawSet.rbResetTorques(this.handle,i)}addForce(i,t){const n=re.intoRaw(i);this.rawSet.rbAddForce(this.handle,n,t),n.free()}applyImpulse(i,t){const n=re.intoRaw(i);this.rawSet.rbApplyImpulse(this.handle,n,t),n.free()}addTorque(i,t){const n=re.intoRaw(i);this.rawSet.rbAddTorque(this.handle,n,t),n.free()}applyTorqueImpulse(i,t){const n=re.intoRaw(i);this.rawSet.rbApplyTorqueImpulse(this.handle,n,t),n.free()}addForceAtPoint(i,t,n){const r=re.intoRaw(i),o=re.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,r,o,n),r.free(),o.free()}applyImpulseAtPoint(i,t,n){const r=re.intoRaw(i),o=re.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,r,o,n),r.free(),o.free()}}(function(s){s[s.Revolute=0]="Revolute",s[s.Fixed=1]="Fixed",s[s.Prismatic=2]="Prismatic",s[s.Rope=3]="Rope",s[s.Spring=4]="Spring",s[s.Spherical=5]="Spherical",s[s.Generic=6]="Generic"})(ds||(ds={})),function(s){s[s.AccelerationBased=0]="AccelerationBased",s[s.ForceBased=1]="ForceBased"}(rP||(rP={})),function(s){s[s.X=1]="X",s[s.Y=2]="Y",s[s.Z=4]="Z",s[s.AngX=8]="AngX",s[s.AngY=16]="AngY",s[s.AngZ=32]="AngZ"}(oP||(oP={}));class Pl{constructor(){}static fixed(i,t,n,r){let o=new Pl;return o.anchor1=i,o.anchor2=n,o.frame1=t,o.frame2=r,o.jointType=ds.Fixed,o}static spring(i,t,n,r,o){let a=new Pl;return a.anchor1=r,a.anchor2=o,a.length=i,a.stiffness=t,a.damping=n,a.jointType=ds.Spring,a}static rope(i,t,n){let r=new Pl;return r.anchor1=t,r.anchor2=n,r.length=i,r.jointType=ds.Rope,r}static generic(i,t,n,r){let o=new Pl;return o.anchor1=i,o.anchor2=t,o.axis=n,o.axesMask=r,o.jointType=ds.Generic,o}static spherical(i,t){let n=new Pl;return n.anchor1=i,n.anchor2=t,n.jointType=ds.Spherical,n}static prismatic(i,t,n){let r=new Pl;return r.anchor1=i,r.anchor2=t,r.axis=n,r.jointType=ds.Prismatic,r}static revolute(i,t,n){let r=new Pl;return r.anchor1=i,r.anchor2=t,r.axis=n,r.jointType=ds.Revolute,r}intoRaw(){let i,t,n=re.intoRaw(this.anchor1),r=re.intoRaw(this.anchor2),o=!1,a=0,l=0;switch(this.jointType){case ds.Fixed:let c=Jt.intoRaw(this.frame1),u=Jt.intoRaw(this.frame2);t=As.fixed(n,c,r,u),c.free(),u.free();break;case ds.Spring:t=As.spring(this.length,this.stiffness,this.damping,n,r);break;case ds.Rope:t=As.rope(this.length,n,r);break;case ds.Prismatic:i=re.intoRaw(this.axis),this.limitsEnabled&&(o=!0,a=this.limits[0],l=this.limits[1]),t=As.prismatic(n,r,i,o,a,l),i.free();break;case ds.Generic:i=re.intoRaw(this.axis);let d=this.axesMask;t=As.generic(n,r,i,d);break;case ds.Spherical:t=As.spherical(n,r);break;case ds.Revolute:i=re.intoRaw(this.axis),t=As.revolute(n,r,i),i.free()}return n.free(),r.free(),t}}(function(s){s[s.Average=0]="Average",s[s.Min=1]="Min",s[s.Multiply=2]="Multiply",s[s.Max=3]="Max"})(Wi||(Wi={}));class pm{constructor(i,t,n,r,o){this.distance=i,this.point1=t,this.point2=n,this.normal1=r,this.normal2=o}static fromRaw(i){if(!i)return null;const t=new pm(i.distance(),re.fromRaw(i.point1()),re.fromRaw(i.point2()),re.fromRaw(i.normal1()),re.fromRaw(i.normal2()));return i.free(),t}}(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Face=2]="Face",s[s.Unknown=3]="Unknown"})(bC||(bC={}));class Cb{constructor(i,t){this.point=i,this.isInside=t}static fromRaw(i){if(!i)return null;const t=new Cb(re.fromRaw(i.point()),i.isInside());return i.free(),t}}class xY{constructor(i,t){this.origin=i,this.dir=t}pointAt(i){return{x:this.origin.x+this.dir.x*i,y:this.origin.y+this.dir.y*i,z:this.origin.z+this.dir.z*i}}}class Sb{constructor(i,t,n,r){this.featureType=bC.Unknown,this.featureId=void 0,this.toi=i,this.normal=t,r!==void 0&&(this.featureId=r),n!==void 0&&(this.featureType=n)}static fromRaw(i){if(!i)return null;const t=new Sb(i.toi(),re.fromRaw(i.normal()),i.featureType(),i.featureId());return i.free(),t}}class iA{constructor(i,t,n,r,o){this.toi=i,this.witness1=t,this.witness2=n,this.normal1=r,this.normal2=o}static fromRaw(i,t){if(!t)return null;const n=new iA(t.toi(),re.fromRaw(t.witness1()),re.fromRaw(t.witness2()),re.fromRaw(t.normal1()),re.fromRaw(t.normal2()));return t.free(),n}}class YE extends iA{constructor(i,t,n,r,o,a){super(t,n,r,o,a),this.collider=i}static fromRaw(i,t){if(!t)return null;const n=new YE(i.get(t.colliderHandle()),t.toi(),re.fromRaw(t.witness1()),re.fromRaw(t.witness2()),re.fromRaw(t.normal1()),re.fromRaw(t.normal2()));return t.free(),n}}class kn{static fromRaw(i,t){const n=i.coShapeType(t);let r,o,a,l,c,u,d;switch(n){case jn.Ball:return new KE(i.coRadius(t));case jn.Cuboid:return r=i.coHalfExtents(t),new yL(r.x,r.y,r.z);case jn.RoundCuboid:return r=i.coHalfExtents(t),o=i.coRoundRadius(t),new bL(r.x,r.y,r.z,o);case jn.Capsule:return c=i.coHalfHeight(t),u=i.coRadius(t),new _L(c,u);case jn.Segment:return a=i.coVertices(t),new wL(re.new(a[0],a[1],a[2]),re.new(a[3],a[4],a[5]));case jn.Polyline:return a=i.coVertices(t),l=i.coIndices(t),new SL(a,l);case jn.Triangle:return a=i.coVertices(t),new xL(re.new(a[0],a[1],a[2]),re.new(a[3],a[4],a[5]),re.new(a[6],a[7],a[8]));case jn.RoundTriangle:return a=i.coVertices(t),o=i.coRoundRadius(t),new CL(re.new(a[0],a[1],a[2]),re.new(a[3],a[4],a[5]),re.new(a[6],a[7],a[8]),o);case jn.HalfSpace:return d=re.fromRaw(i.coHalfspaceNormal(t)),new CY(d);case jn.TriMesh:return a=i.coVertices(t),l=i.coIndices(t),new EL(a,l);case jn.HeightField:const f=i.coHeightfieldScale(t),p=i.coHeightfieldHeights(t),g=i.coHeightfieldNRows(t),m=i.coHeightfieldNCols(t);return new IL(g,m,p,f);case jn.ConvexPolyhedron:return a=i.coVertices(t),l=i.coIndices(t),new wC(a,l);case jn.RoundConvexPolyhedron:return a=i.coVertices(t),l=i.coIndices(t),o=i.coRoundRadius(t),new xC(a,l,o);case jn.Cylinder:return c=i.coHalfHeight(t),u=i.coRadius(t),new TL(c,u);case jn.RoundCylinder:return c=i.coHalfHeight(t),u=i.coRadius(t),o=i.coRoundRadius(t),new RL(c,u,o);case jn.Cone:return c=i.coHalfHeight(t),u=i.coRadius(t),new BL(c,u);case jn.RoundCone:return c=i.coHalfHeight(t),u=i.coRadius(t),o=i.coRoundRadius(t),new PL(c,u,o);default:throw new Error("unknown shape type: "+n)}}castShape(i,t,n,r,o,a,l,c,u){let d=re.intoRaw(i),f=Jt.intoRaw(t),p=re.intoRaw(n),g=re.intoRaw(o),m=Jt.intoRaw(a),A=re.intoRaw(l),y=this.intoRaw(),b=r.intoRaw(),_=iA.fromRaw(null,y.castShape(d,f,p,b,g,m,A,c,u));return d.free(),f.free(),p.free(),g.free(),m.free(),A.free(),y.free(),b.free(),_}intersectsShape(i,t,n,r,o){let a=re.intoRaw(i),l=Jt.intoRaw(t),c=re.intoRaw(r),u=Jt.intoRaw(o),d=this.intoRaw(),f=n.intoRaw(),p=d.intersectsShape(a,l,f,c,u);return a.free(),l.free(),c.free(),u.free(),d.free(),f.free(),p}contactShape(i,t,n,r,o,a){let l=re.intoRaw(i),c=Jt.intoRaw(t),u=re.intoRaw(r),d=Jt.intoRaw(o),f=this.intoRaw(),p=n.intoRaw(),g=pm.fromRaw(f.contactShape(l,c,p,u,d,a));return l.free(),c.free(),u.free(),d.free(),f.free(),p.free(),g}containsPoint(i,t,n){let r=re.intoRaw(i),o=Jt.intoRaw(t),a=re.intoRaw(n),l=this.intoRaw(),c=l.containsPoint(r,o,a);return r.free(),o.free(),a.free(),l.free(),c}projectPoint(i,t,n,r){let o=re.intoRaw(i),a=Jt.intoRaw(t),l=re.intoRaw(n),c=this.intoRaw(),u=Cb.fromRaw(c.projectPoint(o,a,l,r));return o.free(),a.free(),l.free(),c.free(),u}intersectsRay(i,t,n,r){let o=re.intoRaw(t),a=Jt.intoRaw(n),l=re.intoRaw(i.origin),c=re.intoRaw(i.dir),u=this.intoRaw(),d=u.intersectsRay(o,a,l,c,r);return o.free(),a.free(),l.free(),c.free(),u.free(),d}castRay(i,t,n,r,o){let a=re.intoRaw(t),l=Jt.intoRaw(n),c=re.intoRaw(i.origin),u=re.intoRaw(i.dir),d=this.intoRaw(),f=d.castRay(a,l,c,u,r,o);return a.free(),l.free(),c.free(),u.free(),d.free(),f}castRayAndGetNormal(i,t,n,r,o){let a=re.intoRaw(t),l=Jt.intoRaw(n),c=re.intoRaw(i.origin),u=re.intoRaw(i.dir),d=this.intoRaw(),f=Sb.fromRaw(d.castRayAndGetNormal(a,l,c,u,r,o));return a.free(),l.free(),c.free(),u.free(),d.free(),f}}(function(s){s[s.Ball=0]="Ball",s[s.Cuboid=1]="Cuboid",s[s.Capsule=2]="Capsule",s[s.Segment=3]="Segment",s[s.Polyline=4]="Polyline",s[s.Triangle=5]="Triangle",s[s.TriMesh=6]="TriMesh",s[s.HeightField=7]="HeightField",s[s.ConvexPolyhedron=9]="ConvexPolyhedron",s[s.Cylinder=10]="Cylinder",s[s.Cone=11]="Cone",s[s.RoundCuboid=12]="RoundCuboid",s[s.RoundTriangle=13]="RoundTriangle",s[s.RoundCylinder=14]="RoundCylinder",s[s.RoundCone=15]="RoundCone",s[s.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",s[s.HalfSpace=17]="HalfSpace"})(Qi||(Qi={}));class KE extends kn{constructor(i){super(),this.type=Qi.Ball,this.radius=i}intoRaw(){return $e.ball(this.radius)}}class CY extends kn{constructor(i){super(),this.type=Qi.HalfSpace,this.normal=i}intoRaw(){let i=re.intoRaw(this.normal),t=$e.halfspace(i);return i.free(),t}}class yL extends kn{constructor(i,t,n){super(),this.type=Qi.Cuboid,this.halfExtents=re.new(i,t,n)}intoRaw(){return $e.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class bL extends kn{constructor(i,t,n,r){super(),this.type=Qi.RoundCuboid,this.halfExtents=re.new(i,t,n),this.borderRadius=r}intoRaw(){return $e.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class _L extends kn{constructor(i,t){super(),this.type=Qi.Capsule,this.halfHeight=i,this.radius=t}intoRaw(){return $e.capsule(this.halfHeight,this.radius)}}class wL extends kn{constructor(i,t){super(),this.type=Qi.Segment,this.a=i,this.b=t}intoRaw(){let i=re.intoRaw(this.a),t=re.intoRaw(this.b),n=$e.segment(i,t);return i.free(),t.free(),n}}class xL extends kn{constructor(i,t,n){super(),this.type=Qi.Triangle,this.a=i,this.b=t,this.c=n}intoRaw(){let i=re.intoRaw(this.a),t=re.intoRaw(this.b),n=re.intoRaw(this.c),r=$e.triangle(i,t,n);return i.free(),t.free(),n.free(),r}}class CL extends kn{constructor(i,t,n,r){super(),this.type=Qi.RoundTriangle,this.a=i,this.b=t,this.c=n,this.borderRadius=r}intoRaw(){let i=re.intoRaw(this.a),t=re.intoRaw(this.b),n=re.intoRaw(this.c),r=$e.roundTriangle(i,t,n,this.borderRadius);return i.free(),t.free(),n.free(),r}}class SL extends kn{constructor(i,t){super(),this.type=Qi.Polyline,this.vertices=i,this.indices=t??new Uint32Array(0)}intoRaw(){return $e.polyline(this.vertices,this.indices)}}class EL extends kn{constructor(i,t){super(),this.type=Qi.TriMesh,this.vertices=i,this.indices=t}intoRaw(){return $e.trimesh(this.vertices,this.indices)}}class wC extends kn{constructor(i,t){super(),this.type=Qi.ConvexPolyhedron,this.vertices=i,this.indices=t}intoRaw(){return this.indices?$e.convexMesh(this.vertices,this.indices):$e.convexHull(this.vertices)}}class xC extends kn{constructor(i,t,n){super(),this.type=Qi.RoundConvexPolyhedron,this.vertices=i,this.indices=t,this.borderRadius=n}intoRaw(){return this.indices?$e.roundConvexMesh(this.vertices,this.indices,this.borderRadius):$e.roundConvexHull(this.vertices,this.borderRadius)}}class IL extends kn{constructor(i,t,n,r){super(),this.type=Qi.HeightField,this.nrows=i,this.ncols=t,this.heights=n,this.scale=r}intoRaw(){let i=re.intoRaw(this.scale),t=$e.heightfield(this.nrows,this.ncols,this.heights,i);return i.free(),t}}class TL extends kn{constructor(i,t){super(),this.type=Qi.Cylinder,this.halfHeight=i,this.radius=t}intoRaw(){return $e.cylinder(this.halfHeight,this.radius)}}class RL extends kn{constructor(i,t,n){super(),this.type=Qi.RoundCylinder,this.borderRadius=n,this.halfHeight=i,this.radius=t}intoRaw(){return $e.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class BL extends kn{constructor(i,t){super(),this.type=Qi.Cone,this.halfHeight=i,this.radius=t}intoRaw(){return $e.cone(this.halfHeight,this.radius)}}class PL extends kn{constructor(i,t,n){super(),this.type=Qi.RoundCone,this.halfHeight=i,this.radius=t,this.borderRadius=n}intoRaw(){return $e.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(s){s[s.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",s[s.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",s[s.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",s[s.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",s[s.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",s[s.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",s[s.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",s[s.ONLY_FIXED=6]="ONLY_FIXED"})(aP||(aP={}));(function(s){s[s.NONE=0]="NONE",s[s.COLLISION_EVENTS=1]="COLLISION_EVENTS",s[s.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(Qy||(Qy={}));class SY{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return re.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return re.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class EY{constructor(i,t){this.raw=t||new bY(i)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(i){this.raw.drainCollisionEvents(i)}drainContactForceEvents(i){let t=new SY;this.raw.drainContactForceEvents(n=>{t.raw=n,i(t),t.free()})}clear(){this.raw.clear()}}(function(s){s[s.NONE=0]="NONE",s[s.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",s[s.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(_C||(_C={})),function(s){s[s.EMPTY=0]="EMPTY",s[s.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(lP||(lP={})),function(s){s[s.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",s[s.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",s[s.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",s[s.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",s[s.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",s[s.FIXED_FIXED=32]="FIXED_FIXED",s[s.DEFAULT=15]="DEFAULT",s[s.ALL=60943]="ALL"}(jy||(jy={}));class hP{constructor(i,t,n,r){this.colliderSet=i,this.handle=t,this._parent=n,this._shape=r}finalizeDeserialization(i){this.handle!=null&&(this._parent=i.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=kn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return re.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Jt.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(i){this.colliderSet.raw.coSetSensor(this.handle,i)}setShape(i){let t=i.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=i}setEnabled(i){this.colliderSet.raw.coSetEnabled(this.handle,i)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(i){this.colliderSet.raw.coSetRestitution(this.handle,i)}setFriction(i){this.colliderSet.raw.coSetFriction(this.handle,i)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(i){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,i)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(i){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,i)}setCollisionGroups(i){this.colliderSet.raw.coSetCollisionGroups(this.handle,i)}setSolverGroups(i){this.colliderSet.raw.coSetSolverGroups(this.handle,i)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(i){this.colliderSet.raw.coSetActiveHooks(this.handle,i)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(i){this.colliderSet.raw.coSetActiveEvents(this.handle,i)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(i){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,i)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(i){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,i)}setDensity(i){this.colliderSet.raw.coSetDensity(this.handle,i)}setMass(i){this.colliderSet.raw.coSetMass(this.handle,i)}setMassProperties(i,t,n,r){let o=re.intoRaw(t),a=re.intoRaw(n),l=Jt.intoRaw(r);this.colliderSet.raw.coSetMassProperties(this.handle,i,o,a,l),o.free(),a.free(),l.free()}setTranslation(i){this.colliderSet.raw.coSetTranslation(this.handle,i.x,i.y,i.z)}setTranslationWrtParent(i){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,i.x,i.y,i.z)}setRotation(i){this.colliderSet.raw.coSetRotation(this.handle,i.x,i.y,i.z,i.w)}setRotationWrtParent(i){this.colliderSet.raw.coSetRotationWrtParent(this.handle,i.x,i.y,i.z,i.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return re.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(i){const t=re.intoRaw(i);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(i){this.colliderSet.raw.coSetRadius(this.handle,i)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(i){this.colliderSet.raw.coSetRoundRadius(this.handle,i)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(i){this.colliderSet.raw.coSetHalfHeight(this.handle,i)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let i=this.colliderSet.raw.coHeightfieldScale(this.handle);return re.fromRaw(i)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(i){let t=re.intoRaw(i),n=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),n}projectPoint(i,t){let n=re.intoRaw(i),r=Cb.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,n,t));return n.free(),r}intersectsRay(i,t){let n=re.intoRaw(i.origin),r=re.intoRaw(i.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,n,r,t);return n.free(),r.free(),o}castShape(i,t,n,r,o,a,l){let c=re.intoRaw(i),u=re.intoRaw(n),d=Jt.intoRaw(r),f=re.intoRaw(o),p=t.intoRaw(),g=iA.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,c,p,u,d,f,a,l));return c.free(),u.free(),d.free(),f.free(),p.free(),g}castCollider(i,t,n,r,o){let a=re.intoRaw(i),l=re.intoRaw(n),c=YE.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,a,t.handle,l,r,o));return a.free(),l.free(),c}intersectsShape(i,t,n){let r=re.intoRaw(t),o=Jt.intoRaw(n),a=i.intoRaw(),l=this.colliderSet.raw.coIntersectsShape(this.handle,a,r,o);return r.free(),o.free(),a.free(),l}contactShape(i,t,n,r){let o=re.intoRaw(t),a=Jt.intoRaw(n),l=i.intoRaw(),c=pm.fromRaw(this.colliderSet.raw.coContactShape(this.handle,l,o,a,r));return o.free(),a.free(),l.free(),c}contactCollider(i,t){return pm.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,i.handle,t))}castRay(i,t,n){let r=re.intoRaw(i.origin),o=re.intoRaw(i.dir),a=this.colliderSet.raw.coCastRay(this.handle,r,o,t,n);return r.free(),o.free(),a}castRayAndGetNormal(i,t,n){let r=re.intoRaw(i.origin),o=re.intoRaw(i.dir),a=Sb.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,r,o,t,n));return r.free(),o.free(),a}}(function(s){s[s.Density=0]="Density",s[s.Mass=1]="Mass",s[s.MassProps=2]="MassProps"})(qd||(qd={}));class gi{constructor(i){this.enabled=!0,this.shape=i,this.massPropsMode=qd.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Jt.identity(),this.translation=re.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Wi.Average,this.restitutionCombineRule=Wi.Average,this.activeCollisionTypes=jy.DEFAULT,this.activeEvents=Qy.NONE,this.activeHooks=_C.NONE,this.mass=0,this.centerOfMass=re.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=re.zeros(),this.angularInertiaLocalFrame=Jt.identity()}static ball(i){const t=new KE(i);return new gi(t)}static capsule(i,t){const n=new _L(i,t);return new gi(n)}static segment(i,t){const n=new wL(i,t);return new gi(n)}static triangle(i,t,n){const r=new xL(i,t,n);return new gi(r)}static roundTriangle(i,t,n,r){const o=new CL(i,t,n,r);return new gi(o)}static polyline(i,t){const n=new SL(i,t);return new gi(n)}static trimesh(i,t){const n=new EL(i,t);return new gi(n)}static cuboid(i,t,n){const r=new yL(i,t,n);return new gi(r)}static roundCuboid(i,t,n,r){const o=new bL(i,t,n,r);return new gi(o)}static heightfield(i,t,n,r){const o=new IL(i,t,n,r);return new gi(o)}static cylinder(i,t){const n=new TL(i,t);return new gi(n)}static roundCylinder(i,t,n){const r=new RL(i,t,n);return new gi(r)}static cone(i,t){const n=new BL(i,t);return new gi(n)}static roundCone(i,t,n){const r=new PL(i,t,n);return new gi(r)}static convexHull(i){const t=new wC(i,null);return new gi(t)}static convexMesh(i,t){const n=new wC(i,t);return new gi(n)}static roundConvexHull(i,t){const n=new xC(i,null,t);return new gi(n)}static roundConvexMesh(i,t,n){const r=new xC(i,t,n);return new gi(r)}setTranslation(i,t,n){if(typeof i!="number"||typeof t!="number"||typeof n!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:i,y:t,z:n},this}setRotation(i){return Jt.copy(this.rotation,i),this}setSensor(i){return this.isSensor=i,this}setEnabled(i){return this.enabled=i,this}setDensity(i){return this.massPropsMode=qd.Density,this.density=i,this}setMass(i){return this.massPropsMode=qd.Mass,this.mass=i,this}setMassProperties(i,t,n,r){return this.massPropsMode=qd.MassProps,this.mass=i,re.copy(this.centerOfMass,t),re.copy(this.principalAngularInertia,n),Jt.copy(this.angularInertiaLocalFrame,r),this}setRestitution(i){return this.restitution=i,this}setFriction(i){return this.friction=i,this}setFrictionCombineRule(i){return this.frictionCombineRule=i,this}setRestitutionCombineRule(i){return this.restitutionCombineRule=i,this}setCollisionGroups(i){return this.collisionGroups=i,this}setSolverGroups(i){return this.solverGroups=i,this}setActiveHooks(i){return this.activeHooks=i,this}setActiveEvents(i){return this.activeEvents=i,this}setActiveCollisionTypes(i){return this.activeCollisionTypes=i,this}setContactForceEventThreshold(i){return this.contactForceEventThreshold=i,this}}for(var yJ={byteLength:function(s){var i=uP(s),t=i[0],n=i[1];return 3*(t+n)/4-n},toByteArray:function(s){var i,t,n=uP(s),r=n[0],o=n[1],a=new IY(function(u,d,f){return 3*(d+f)/4-f}(0,r,o)),l=0,c=o>0?r-4:r;for(t=0;t<c;t+=4)i=io[s.charCodeAt(t)]<<18|io[s.charCodeAt(t+1)]<<12|io[s.charCodeAt(t+2)]<<6|io[s.charCodeAt(t+3)],a[l++]=i>>16&255,a[l++]=i>>8&255,a[l++]=255&i;return o===2&&(i=io[s.charCodeAt(t)]<<2|io[s.charCodeAt(t+1)]>>4,a[l++]=255&i),o===1&&(i=io[s.charCodeAt(t)]<<10|io[s.charCodeAt(t+1)]<<4|io[s.charCodeAt(t+2)]>>2,a[l++]=i>>8&255,a[l++]=255&i),a},fromByteArray:function(s){for(var i,t=s.length,n=t%3,r=[],o=16383,a=0,l=t-n;a<l;a+=o)r.push(RY(s,a,a+o>l?l:a+o));return n===1?(i=s[t-1],r.push(Da[i>>2]+Da[i<<4&63]+"==")):n===2&&(i=(s[t-2]<<8)+s[t-1],r.push(Da[i>>10]+Da[i>>4&63]+Da[i<<2&63]+"=")),r.join("")}},Da=[],io=[],IY=typeof Uint8Array<"u"?Uint8Array:Array,Tw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bd=0,TY=Tw.length;bd<TY;++bd)Da[bd]=Tw[bd],io[Tw.charCodeAt(bd)]=bd;function uP(s){var i=s.length;if(i%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");return t===-1&&(t=i),[t,t===i?0:4-t%4]}function RY(s,i,t){for(var n,r,o=[],a=i;a<t;a+=3)n=(s[a]<<16&16711680)+(s[a+1]<<8&65280)+(255&s[a+2]),o.push(Da[(r=n)>>18&63]+Da[r>>12&63]+Da[r>>6&63]+Da[63&r]);return o.join("")}io["-".charCodeAt(0)]=62,io["_".charCodeAt(0)]=63;const bJ=Symbol("object"),Rw=new wo(()=>new x,20);class BY{constructor(i,t,n,r,o,a){h(this,"_point");h(this,"_normal");h(this,"_tangentVelocity");h(this,"distance");h(this,"impulse");h(this,"friction");this._point=i,this.distance=t,this._normal=n,this.impulse=r,this.friction=o,this._tangentVelocity=a}get point(){return Rw.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return Rw.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return Rw.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class PY{constructor(i,t,n){h(this,"contacts");h(this,"me");h(this,"_collider");h(this,"_gameObject");this.me=i,this._collider=t,this._gameObject=t.gameObject,this.contacts=n}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var i;return(i=this.collider)==null?void 0:i.attachedRigidbody}}class MY{constructor(i,t){h(this,"object");h(this,"collider");this.object=i,this.collider=t}}const Hn=Q("debugphysics"),Bw=Q("debugcolliderplacement"),Pw=Q("debugcollisions"),kY=Q("showcolliders"),Mw=Q("debugraycasts"),or=Symbol("needle component"),Us=Symbol("physics body"),dP=Symbol("rigidbody");let Hh;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;Hn&&console.log("Use Rapier",!1,globalThis.false);const Ug=class{constructor(){h(this,"debugRenderColliders",!1);h(this,"debugRenderRaycasts",!1);h(this,"context");h(this,"_initializePromise");h(this,"_isInitialized",!1);h(this,"rapierRay",new xY({x:0,y:0,z:0},{x:0,y:0,z:1}));h(this,"raycastVectorsBuffer",new wo(()=>new x,10));h(this,"rapierSphere",null);h(this,"rapierColliderArray",[]);h(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});h(this,"rapierForwardVector",{x:0,y:0,z:1});h(this,"enabled",!1);h(this,"_tempPosition",new x);h(this,"_tempQuaternion",new se);h(this,"_tempScale",new x);h(this,"_tempMatrix",new le);h(this,"_isUpdatingPhysicsWorld",!1);h(this,"_world");h(this,"_hasCreatedWorld",!1);h(this,"eventQueue");h(this,"collisionHandler");h(this,"objects",[]);h(this,"bodies",[]);h(this,"_meshCache",new Map);h(this,"_gravity",{x:0,y:-9.81,z:0});h(this,"lines");h(this,"_tempCenterPos",new x);h(this,"_tempCenterVec",new x);h(this,"_tempCenterQuaternion",new se)}removeBody(i){var n,r,o;if(!i)return;this.validate();const t=i[Us];if(i[Us]=null,t&&this.world){const a=this.objects.findIndex(l=>l===i);if(a>=0){const l=this.bodies[a];if(this.bodies.splice(a,1),this.objects.splice(a,1),l instanceof hP){const c=l;(n=this.world)==null||n.removeCollider(c,!0);const u=c.parent();u&&u.numColliders()<=0&&(u[or]||(r=this.world)==null||r.removeRigidBody(u))}else l instanceof cP&&(l.numColliders()<=0?(o=this.world)==null||o.removeRigidBody(l):be()&&(l.did_log_removing||setTimeout(()=>{l.numColliders()>0&&(l.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(i,t,n){if(this.validate(),!!this.enabled&&!(i.destroyed||!i.gameObject)&&!(!t&&!n))if(i.isCollider===!0)console.warn("TODO: implement updating collider position");else{const r=i,o=r[Us];o&&this.syncPhysicsBody(r.gameObject,o,t,n)}}updateProperties(i){if(this.validate(),i.isCollider){const t=i,n=t[Us];n&&(this.internalUpdateColliderProperties(t,n),t.sharedMaterial&&this.updatePhysicsMaterial(t))}else{const t=i,n=this.internal_getRigidbody(t);n&&this.internalUpdateRigidbodyProperties(t,n)}}addForce(i,t,n){this.validate();const r=this.internal_getRigidbody(i);r?r.addForce(t,n):console.warn("Rigidbody doesn't exist: can not apply force")}addImpulse(i,t,n){this.validate();const r=this.internal_getRigidbody(i);r?r.applyImpulse(t,n):console.warn("Rigidbody doesn't exist: can not apply impulse")}getLinearVelocity(i){this.validate();const t=this.internal_getRigidbody(i);return t?t.linvel():null}getAngularVelocity(i){this.validate();const t=this.internal_getRigidbody(i);return t?t.angvel():null}resetForces(i,t){this.validate();const n=this.internal_getRigidbody(i);n==null||n.resetForces(t)}resetTorques(i,t){this.validate();const n=this.internal_getRigidbody(i);n==null||n.resetTorques(t)}applyImpulse(i,t,n){this.validate();const r=this.internal_getRigidbody(i);r?r.applyImpulse(t,n):console.warn("Rigidbody doesn't exist: can not apply impulse")}wakeup(i){this.validate();const t=this.internal_getRigidbody(i);t?t.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up")}isSleeping(i){this.validate();const t=this.internal_getRigidbody(i);return t==null?void 0:t.isSleeping()}setAngularVelocity(i,t,n){this.validate();const r=this.internal_getRigidbody(i);r?r.setAngvel(t,n):console.warn("Rigidbody doesn't exist: can not set angular velocity")}setLinearVelocity(i,t,n){this.validate();const r=this.internal_getRigidbody(i);r?r.setLinvel(t,n):console.warn("Rigidbody doesn't exist: can not set linear velocity")}async initialize(i){return this.context=i,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return Hn&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&Hn&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||Hn&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(i,t,n){var c;let r=n==null?void 0:n.maxDistance,o=n==null?void 0:n.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,i,t);if(!a)return null;(this.debugRenderRaycasts||Mw)&&Pe.DrawRay(a.origin,a.dir,255,1);const l=(c=this.world)==null?void 0:c.castRay(a,r,o,n==null?void 0:n.queryFilterFlags,n==null?void 0:n.filterGroups,void 0,void 0,u=>{const d=u[or];return n!=null&&n.filterPredicate?n.filterPredicate(d):(n==null?void 0:n.useIgnoreRaycastLayer)!==!1?!(d!=null&&d.gameObject.layers.isEnabled(2)):!0});if(l){const u=a.pointAt(l.toi),d=this.raycastVectorsBuffer.get();return d.set(u.x,u.y,u.z),{point:d,collider:l.collider[or]}}return null}raycastAndGetNormal(i,t,n){var c;let r=n==null?void 0:n.maxDistance,o=n==null?void 0:n.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,i,t);if(!a)return null;(this.debugRenderRaycasts||Mw)&&Pe.DrawRay(a.origin,a.dir,255,1);const l=(c=this.world)==null?void 0:c.castRayAndGetNormal(a,r,o,n==null?void 0:n.queryFilterFlags,n==null?void 0:n.filterGroups,void 0,void 0,u=>{const d=u[or];return n!=null&&n.filterPredicate?n.filterPredicate(d):(n==null?void 0:n.useIgnoreRaycastLayer)!==!1?!(d!=null&&d.gameObject.layers.isEnabled(2)):!0});if(l){const u=a.pointAt(l.toi),d=l.normal,f=this.raycastVectorsBuffer.get(),p=this.raycastVectorsBuffer.get();return f.set(u.x,u.y,u.z),p.set(d.x,d.y,d.z),{point:f,normal:p,collider:l.collider[or]}}return null}getPhysicsRay(i,t,n){var l,c,u;const r=(l=this.context)==null?void 0:l.mainCamera;if(t===void 0){const d=(c=this.context)==null?void 0:c.input.getPointerPosition(0);if(d)t=d;else return null}if(t.z===void 0){if(!r)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const d=this.raycastVectorsBuffer.get();d.x=t.x,d.y=t.y,d.z=0,(d.x>1||d.y>1||d.y<-1||d.x<-1)&&(Hn&&console.warn("Converting screenspace to raycast space",d),(u=this.context)==null||u.input.convertScreenspaceToRaycastSpace(d)),d.unproject(r),t=d}const o=t;i.origin.x=o.x,i.origin.y=o.y,i.origin.z=o.z;const a=this.raycastVectorsBuffer.get();if(n)a.set(n.x,n.y,n.z);else{if(!r)return console.error("Can not perform raycast - no camera found"),null;a.set(i.origin.x,i.origin.y,i.origin.z);const d=Ve(r);a.sub(d)}return a.normalize(),i.dir.x=a.x,i.dir.y=a.y,i.dir.z=a.z,i}sphereOverlap(i,t){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new KE(t)),this.rapierSphere.radius=t,(this.debugRenderRaycasts||Mw)&&Pe.DrawWireSphere(i,t,3359999,1),this.world.intersectionsWithShape(i,this.rapierIdentityRotation,this.rapierSphere,n=>{const r=n[or],o=new MY(r.gameObject,r);return this.rapierColliderArray.push(o),!0},void 0,void 0,void 0,void 0,n=>n.isSensor()?!1:n[or].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var i;return((i=this.world)==null?void 0:i.gravity)??this._gravity}set gravity(i){this.world?this.world.gravity=i:this._gravity=i}clearCaches(){var i,t,n,r;this._meshCache.clear(),(i=this.eventQueue)!=null&&i.raw&&((t=this.eventQueue)==null||t.free()),(n=this.world)!=null&&n.bodies&&((r=this.world)==null||r.free())}async addBoxCollider(i,t){if(this._isInitialized||await this.initialize(i.context),!i.activeAndEnabled)return;if(!this.enabled){Hn&&console.warn("Physics are disabled");return}const n=i.gameObject,r=oi(n,this._tempPosition).multiply(t);r.multiplyScalar(.5),r.x<0&&(r.x=Math.abs(r.x)),r.y<0&&(r.y=Math.abs(r.y)),r.z<0&&(r.z=Math.abs(r.z)),r.x==0&&(r.x=1e-7),r.y==0&&(r.y=1e-7),r.z==0&&(r.z=1e-7);const o=gi.cuboid(r.x,r.y,r.z);this.createCollider(i,o)}async addSphereCollider(i){if(this._isInitialized||await this.initialize(i.context),!i.activeAndEnabled)return;if(!this.enabled){Hn&&console.warn("Physics are disabled");return}const t=gi.ball(.5);this.createCollider(i,t),this.updateProperties(i)}async addCapsuleCollider(i,t,n){if(this._isInitialized||await this.initialize(i.context),!i.activeAndEnabled)return;if(!this.enabled){Hn&&console.warn("Physics are disabled");return}const r=i.gameObject,o=oi(r,this._tempPosition);o.x=Math.abs(o.x),o.y=Math.abs(o.y);const a=n*o.x;t=Math.max(t,a*2);const l=ye.clamp(t*.5*o.y-n*o.x,0,Number.MAX_SAFE_INTEGER),c=gi.capsule(l,a);this.createCollider(i,c)}async addMeshCollider(i,t,n,r){var u,d,f;if(this._isInitialized||await this.initialize(i.context),!i.activeAndEnabled)return;if(!this.enabled){Hn&&console.warn("Physics are disabled");return}let o=t.geometry;if(!o){Hn&&console.warn("Missing mesh geometry",t.name);return}(d=(u=o.index)==null?void 0:u.array)!=null&&d.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${t.name}". Consider providing an indexed geometry.`),o=zj(o));let a=o.getAttribute("position").array;const l=(f=o.index)==null?void 0:f.array;if(Math.abs(r.x-1)>1e-4||Math.abs(r.y-1)>1e-4||Math.abs(r.z-1)>1e-4){const p=o.uuid+"_"+r.x+"_"+r.y+"_"+r.z+"_"+n;if(this._meshCache.has(p))Hn&&console.warn("Use cached mesh collider"),a=this._meshCache.get(p);else{(Hn||be())&&console.warn(`Your MeshCollider "${i.name}" is scaled: consider applying the scale to the collider mesh instead (${r.x}, ${r.y}, ${r.z})`);const g=new Float32Array(a.length);for(let m=0;m<a.length;m+=3)g[m]=a[m]*r.x,g[m+1]=a[m+1]*r.y,g[m+2]=a[m+2]*r.z;a=g,this._meshCache.set(p,g)}}const c=n?gi.convexHull(a):gi.trimesh(a,l);c&&this.createCollider(i,c)}updatePhysicsMaterial(i){if(!i)return;const t=i.sharedMaterial,n=i[Us];if(n&&t){if(t.bounciness!==void 0&&n.setRestitution(t.bounciness),t.bounceCombine!==void 0)switch(t.bounceCombine){case mn.Average:n.setRestitutionCombineRule(Wi.Average);break;case mn.Maximum:n.setRestitutionCombineRule(Wi.Max);break;case mn.Minimum:n.setRestitutionCombineRule(Wi.Min);break;case mn.Multiply:n.setRestitutionCombineRule(Wi.Multiply);break}if(t.dynamicFriction!==void 0&&n.setFriction(t.dynamicFriction),t.frictionCombine!==void 0)switch(t.frictionCombine){case mn.Average:n.setFrictionCombineRule(Wi.Average);break;case mn.Maximum:n.setFrictionCombineRule(Wi.Max);break;case mn.Minimum:n.setFrictionCombineRule(Wi.Min);break;case mn.Multiply:n.setFrictionCombineRule(Wi.Multiply);break}}}getBody(i){return i?i[Us]:null}getComponent(i){return i?i[or]:null}createCollider(i,t){var a;if(!this.world)throw new Error("Physics world not initialized");const n=this._tempMatrix;let r;i.attachedRigidbody?r=this.getRigidbody(i,this._tempMatrix):(Hn&&console.log("Create collider without rigidbody",i.name),n.makeRotationFromQuaternion(Ht(i.gameObject)),n.setPosition(Ve(i.gameObject))),n.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(i,this._tempPosition),t.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),t.setRotation(this._tempQuaternion),t.setSensor(i.isTrigger);const o=i.sharedMaterial;if(o){if(o.bounciness!==void 0&&t.setRestitution(o.bounciness),o.bounceCombine!==void 0)switch(o.bounceCombine){case mn.Average:t.setRestitutionCombineRule(Wi.Average);break;case mn.Maximum:t.setRestitutionCombineRule(Wi.Max);break;case mn.Minimum:t.setRestitutionCombineRule(Wi.Min);break;case mn.Multiply:t.setRestitutionCombineRule(Wi.Multiply);break}if(o.dynamicFriction!==void 0&&t.setFriction(o.dynamicFriction),o.frictionCombine!==void 0)switch(o.frictionCombine){case mn.Average:t.setFrictionCombineRule(Wi.Average);break;case mn.Maximum:t.setFrictionCombineRule(Wi.Max);break;case mn.Minimum:t.setFrictionCombineRule(Wi.Min);break;case mn.Multiply:t.setFrictionCombineRule(Wi.Multiply);break}}((a=i.attachedRigidbody)==null?void 0:a.autoMass)===!1&&(t.setDensity(1e-6),t.setMass(1e-6));try{const l=this.world.createCollider(t,r);return l[or]=i,i[Us]=l,l.setActiveEvents(Qy.COLLISION_EVENTS),l.setActiveCollisionTypes(jy.ALL),this.objects.push(i),this.bodies.push(l),this.updateColliderCollisionGroups(i),l}catch(l){return console.error('Error creating collider "'+i.name+`"
Error:`,l),null}}updateColliderCollisionGroups(i){const t=i[Us],n=i.membership;let r=0;if(n==null)r=65535;else for(let l=0;l<n.length;l++){const c=n[l];c>31?console.error(`Rapier only supports 32 layers, layer ${c} is not supported`):r|=1<<Math.floor(c)}const o=i.filter;let a=0;if(o==null)a=65535;else for(let l=0;l<o.length;l++){const c=o[l];c>31?console.error(`Rapier only supports 32 layers, layer ${c} is not supported`):a|=1<<Math.floor(c)}t.setCollisionGroups(r<<16|a)}getRigidbody(i,t){if(!this.world)throw new Error("Physics world not initialized");let n=null;if(i.attachedRigidbody){const r=i.attachedRigidbody;if(n=r[Us],!n){const o=r.isKinematic&&!Bw;Hn&&console.log("Create rigidbody",o);const a=o?Hh.RigidBodyDesc.kinematicPositionBased():Hh.RigidBodyDesc.dynamic(),l=Ve(i.attachedRigidbody.gameObject);a.setTranslation(l.x,l.y,l.z),a.setRotation(Ht(i.attachedRigidbody.gameObject)),a.centerOfMass=new Hh.Vector3(r.centerOfMass.x,r.centerOfMass.y,r.centerOfMass.z),n=this.world.createRigidBody(a),this.bodies.push(n),this.objects.push(r)}n[or]=r,r[Us]=n,this.internalUpdateRigidbodyProperties(r,n),this.getRigidbodyRelativeMatrix(i.gameObject,r.gameObject,t),i[dP]=n}else{const r=Hh.RigidBodyDesc.kinematicPositionBased(),o=Ve(i.gameObject);r.setTranslation(o.x,o.y,o.z),r.setRotation(Ht(i.gameObject)),n=this.world.createRigidBody(r),t.identity(),n[or]=null}return n}internal_getRigidbody(i){return i.isCollider===!0?i[dP]:i[Us]}internalUpdateColliderProperties(i,t){const n=t.shape;let r=!1;switch(n.type){case Qi.Ball:{const p=n,g=i,m=i.gameObject,A=oi(m,this._tempPosition),y=Math.abs(g.radius*A.x);r=p.radius!==y,p.radius=y,r&&t.setShape(p);break}case Qi.Cuboid:const o=n,a=i,l=i.gameObject,c=oi(l,this._tempPosition),u=a.size.x*.5*c.x,d=a.size.y*.5*c.y,f=a.size.z*.5*c.z;r=o.halfExtents.x!==u||o.halfExtents.y!==d||o.halfExtents.z!==f,o.halfExtents.x=u,o.halfExtents.y=d,o.halfExtents.z=f,r&&t.setShape(o);break}if(r){const o=i.attachedRigidbody;if(o!=null&&o.autoMass){const a=this.getBody(o);a==null||a.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(i),i.isTrigger!==t.isSensor()&&t.setSensor(i.isTrigger)}internalUpdateRigidbodyProperties(i,t){if(t.enableCcd(i.collisionDetectionMode!==Ay.Discrete),t.setLinearDamping(i.drag),t.setAngularDamping(i.angularDrag),t.setGravityScale(i.useGravity?i.gravityScale:0,!0),i.dominanceGroup<=127&&i.dominanceGroup>=-127?t.setDominanceGroup(Math.floor(i.dominanceGroup)):t.setDominanceGroup(0),i.autoMass){t.setAdditionalMass(0,!1);for(let n=0;n<t.numColliders();n++)t.collider(n).setDensity(1);t.recomputeMassPropertiesFromColliders()}else{t.setAdditionalMass(i.mass,!1);for(let n=0;n<t.numColliders();n++)t.collider(n).setDensity(1e-7);t.recomputeMassPropertiesFromColliders()}t.setEnabledRotations(!i.lockRotationX,!i.lockRotationY,!i.lockRotationZ,!1),t.setEnabledTranslations(!i.lockPositionX,!i.lockPositionY,!i.lockPositionZ,!1),i.isKinematic?t.setBodyType(Hh.RigidBodyType.KinematicPositionBased,!1):t.setBodyType(Hh.RigidBodyType.Dynamic,!1)}step(i){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new EY(!1)),i===void 0||i<=0){this._isUpdatingPhysicsWorld=!1;return}else i!==void 0&&(this.world.timestep=ye.lerp(this.world.timestep,i,.8));try{this.world.step(this.eventQueue)}catch(t){console.warn("Error running physics step",t)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new DY(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(i){var t,n,r,o;if(Hn||Bw||kY||this.debugRenderColliders===!0){if(!this.lines){const l=new Zo({color:7855479,fog:!1}),c=new Vt;this.lines=new xf(c,l),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((t=this.context)==null?void 0:t.scene)&&((n=this.context)==null||n.scene.add(this.lines));const a=i.debugRender();this.lines.geometry.setAttribute("position",new Je(a.vertices,3)),this.lines.geometry.setAttribute("color",new Je(a.colors,4)),(this.context.time.frame%30===0||((r=this.lines.geometry.boundingSphere)==null?void 0:r.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((o=this.context)==null||o.scene.remove(this.lines))}syncObjects(){if(!Bw)for(let i=0;i<this.bodies.length;i++){const t=this.objects[i],n=this.bodies[i],r=t;if((r==null?void 0:r.isCollider)===!0&&!r.attachedRigidbody){const c=n.parent();c?this.syncPhysicsBody(t.gameObject,c,!0,!0):this.syncPhysicsBody(t.gameObject,n,!0,!0);continue}const o=n.translation(),a=n.rotation();if(Number.isNaN(o.x)||Number.isNaN(a.x)){!r.__COLLIDER_NAN&&be()&&(console.warn("Collider has NaN values",r.name,r.gameObject,n),r.__COLLIDER_NAN=!0);continue}const l=t.center;if(l&&l.isVector3){this._tempQuaternion.set(a.x,a.y,a.z,a.w);const c=this._tempPosition.copy(l).applyQuaternion(this._tempQuaternion),u=oi(t.gameObject);c.multiply(u),o.x-=c.x,o.y-=c.y,o.z-=c.z}Tf(t.gameObject,o.x,o.y,o.z),jM(t.gameObject,a.x,a.y,a.z,a.w)}}syncPhysicsBody(i,t,n,r){if(t instanceof cP){const o=Ve(i,this._tempPosition),a=Ht(i,this._tempQuaternion);switch(t.bodyType()){case Mg.Fixed:case Mg.KinematicPositionBased:case Mg.KinematicVelocityBased:n&&t.setNextKinematicTranslation(o),r&&t.setNextKinematicRotation(a);break;default:n&&t.setTranslation(o,!1),r&&t.setRotation(a,!1);break}}else if(t instanceof hP){i.matrixWorldNeedsUpdate&&i.updateWorldMatrix(!0,!1),i.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const o=this._tempPosition,a=this._tempQuaternion,l=t[or];if(this.tryApplyCenter(l,o),n){const c=t.translation();(c.x!==o.x||c.y!==o.y||c.z!==o.z)&&t.setTranslation(o)}if(r){const c=t.rotation();(c.x!==a.x||c.y!==a.y||c.z!==a.z||c.w!==a.w)&&t.setRotation(a)}}}tryApplyCenter(i,t){const n=i.center;n&&i.gameObject&&(n.x!==0||n.y!==0||n.z!==0)&&(this._tempCenterPos.x=n.x,this._tempCenterPos.y=n.y,this._tempCenterPos.z=n.z,oi(i.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),i.attachedRigidbody?this._tempCenterPos.applyQuaternion(i.gameObject.quaternion):(Ht(i.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),t.x+=this._tempCenterPos.x,t.y+=this._tempCenterPos.y,t.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(i,t,n,r){if(r===void 0&&(r=Ug._matricesBuffer,r.length=0),i===t){const o=oi(i,this._tempPosition);n.makeScale(o.x,o.y,o.z);for(let a=r.length-1;a>=0;a--)n.multiply(r[a]);return n}return r.push(i.matrix),i.parent&&this.getRigidbodyRelativeMatrix(i.parent,t,n,r),n}addFixedJoint(i,t){if(!this.world){console.error("Physics world not initialized");return}const n=i[Us],r=t[Us];this.calculateJointRelativeMatrices(i.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const o=Pl.fixed(Ug.centerConnectionPos,Ug.centerConnectionRot,this._tempPosition,this._tempQuaternion),a=this.world.createImpulseJoint(o,n,r,!0);Hn&&console.log("ADD FIXED JOINT",a)}addHingeJoint(i,t,n,r){if(!this.world){console.error("Physics world not initialized");return}const o=i[Us],a=t[Us];this.calculateJointRelativeMatrices(i.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const l=Hh.JointData.revolute(n,this._tempPosition,r),c=this.world.createImpulseJoint(l,o,a,!0);Hn&&console.log("ADD HINGE JOINT",c)}calculateJointRelativeMatrices(i,t,n){i.updateWorldMatrix(!0,!1),t.updateWorldMatrix(!0,!1);const r=i.matrixWorld,o=t.matrixWorld;r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,o.elements[0]=1,o.elements[5]=1,o.elements[10]=1,n.copy(o).premultiply(r.invert()).invert()}};let _d=Ug;h(_d,"_didLoadPhysicsEngine",!1),h(_d,"_matricesBuffer",[]),h(_d,"centerConnectionPos",{x:0,y:0,z:0}),h(_d,"centerConnectionRot",{x:0,y:0,z:0,w:1});class DY{constructor(i,t){h(this,"world");h(this,"eventQueue");h(this,"activeCollisions",[]);h(this,"activeCollisionsStay",[]);h(this,"activeTriggers",[]);this.world=i,this.eventQueue=t}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((i,t,n)=>{const r=this.world.getCollider(i),o=this.world.getCollider(t);if(!r||!o)return;const a=r[or],l=o[or];Pw&&console.log("EVT",a.name,l.name,n,r,o),a&&l&&(n?(this.onCollisionStarted(a,r,l,o),this.onCollisionStarted(l,o,a,r)):(this.onCollisionEnded(a,l),this.onCollisionEnded(l,a)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(i,t,n,r){let o=null;if(i.isTrigger||n.isTrigger)Df(i.gameObject,a=>{a.onTriggerEnter&&!a.destroyed&&a.onTriggerEnter(n),this.activeTriggers.push({collider:i,component:a,otherCollider:n})});else{const a=i.gameObject;this.world.contactPair(t,r,(l,c)=>{Df(a,u=>{var f;if(u.destroyed)return;const d=u.onCollisionEnter||u.onCollisionStay||u.onCollisionExit;if(d||Pw){if(!o){const p=[],g=l.normal();for(let m=0;m<l.numSolverContacts();m++){const A=l.solverContactPoint(m),y=l.contactImpulse(m);if(A){const b=l.contactDist(m),_=l.solverContactFriction(m),w=l.solverContactTangentVelocity(m),S=new BY(A,b,g,y,_,w);p.push(S),Pw&&Pe.DrawDirection(A,g,16711680,3,!0)}}o=new PY(a,n,p)}if(d){const p={collider:i,component:u,collision:o};this.activeCollisions.push(p),u.onCollisionStay&&this.activeCollisionsStay.push(p),(f=u.onCollisionEnter)==null||f.call(u,o)}}})})}}onHandleCollisionStay(){for(const i of this.activeCollisionsStay){const t=i.component;if(!t.destroyed&&t.activeAndEnabled&&t.onCollisionStay){if(i.collision.collider.destroyed)continue;const n=i.collision;t.onCollisionStay(n)}}for(const i of this.activeTriggers){const t=i.component;if(!t.destroyed&&t.activeAndEnabled&&t.onTriggerStay){const n=i.otherCollider;if(n.destroyed)continue;t.onTriggerStay(n)}}}onCollisionEnded(i,t){if(!(i.destroyed||t.destroyed)){for(let n=0;n<this.activeCollisions.length;n++){const r=this.activeCollisions[n],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisions.splice(n,1),n--;continue}if(o===i&&r.collision.collider===t){const a=r.component;if(this.activeCollisions.splice(n,1),n--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let n=0;n<this.activeCollisionsStay.length;n++){const r=this.activeCollisionsStay[n],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisionsStay.splice(n,1),n--;continue}if(o===i&&r.collision.collider===t){const a=r.component;if(this.activeCollisionsStay.splice(n,1),n--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let n=0;n<this.activeTriggers.length;n++){const r=this.activeTriggers[n],o=r.collider;if(o.destroyed||r.otherCollider.destroyed){this.activeTriggers.splice(n,1),n--;continue}if(o===i&&r.otherCollider===t){const a=r.component;if(this.activeTriggers.splice(n,1),n--,a.activeAndEnabled&&a.onTriggerExit){const l=r.otherCollider;a.onTriggerExit(l)}}}}}}class _J{static async createComparisonScene(i){const{files:t}=i,r=await Promise.all(t.map(y=>new tt(y).loadAssetAsync())),o=new ws;let a=0;for(const y of r)if(y instanceof ne){y.position.y=a,o.add(y);const b=sl([y]);a+=b.getSize(new x).y,a+=.1}const l=new bt(20);o.add(l);const c=i.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(c){let y=null;if(c.endsWith(".hdr")){const b=(await hh(()=>Promise.resolve().then(()=>cH),void 0,import.meta.url)).RGBELoader;y=new b}else if(c.endsWith(".exr")){const b=(await hh(()=>Promise.resolve().then(()=>lH),void 0,import.meta.url)).EXRLoader;y=new b}if(y){const b=await y.loadAsync(c).catch(_=>(console.error(_),null));b&&(b.mapping=Ya,b.needsUpdate=!0,o.background=b,o.environment=b,o.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",c)}const u=sl(o.children),d=u.getCenter(new x),f=u.getSize(new x),g=Math.max(f.x,f.y,f.z)/(2*Math.tan(Math.PI*l.fov/360));l.position.set(d.x,d.y,g),l.lookAt(d);const m=new WO(l,i.domElement||document.body);m.target=d,m.update();const A=(i.domElement||document.body).getBoundingClientRect();return l.aspect=A.width/A.height,l.updateProjectionMatrix(),{scene:o,camera:l}}}function wJ(s,i,t,n="image/webp",r){return OY({context:s,width:i,height:t,mimeType:n,camera:r})}function OY(s){s||(s={});const{mimeType:i="image/png",transparent:t=!1}=s;let{context:n,width:r,height:o,camera:a}=s;if(!n&&(n=xt.Current,!n))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!a&&(a=n.mainCamera,!a))return console.error("No camera found"),null;const l=n.renderer.domElement.width,c=n.renderer.domElement.height;r||(r=l),o||(o=c);const u=window.devicePixelRatio||1;r/=u,o/=u;const d=n.renderer.xr.enabled;n.renderer.xr.enabled=!1,n.renderer.domElement.style.width=r+"px",n.renderer.domElement.style.height=o+"px";const f=n.renderer.getRenderTarget(),p=n.renderer.getClearColor(new xe),g=n.renderer.getClearAlpha(),m=n.scene.background,A="aspect"in a?a.aspect:null;try{const y=n.renderer.domElement,b=s.render_events!==!1,_=new Array;b&&(Im(n.scene,ci,_),_.forEach(I=>I==null?void 0:I.onBeforeRender())),t&&(n.scene.background=null,n.renderer.setClearColor(0,0)),s.background&&(n.scene.background=null,n.renderer.setClearColor(s.background),s.background instanceof Ut&&n.renderer.setClearAlpha(s.background.a)),t&&n.renderer.setClearAlpha(0),n.renderer.setSize(r,o,!1),"cam"in a&&(a=a.cam),a instanceof bt&&(a.aspect=r/o,a.updateProjectionMatrix());const w="type"in s&&s.type==="texture";let S=null;if(w&&(S=new Et(r,o,{wrapS:Hv,wrapT:Hv,format:1023}),n.renderer.setRenderTarget(S)),n.renderNow(a||null),b&&_.forEach(I=>I.onAfterRender()),"type"in s&&s.type==="texture")return S?(s.target&&(s.target.image=S==null?void 0:S.texture.image,s.target.needsUpdate=!0),S.texture.offset.set(0,-1),S.texture.needsUpdate=!0,S.texture):(console.error("No target texture found"),null);const E=y.toDataURL(i);return"download_filename"in s&&s.download_filename&&LY(E,s.download_filename),E}finally{n.renderer.setRenderTarget(f),n.scene.background=m,n.renderer.setSize(l,c,!1),n.updateSize(!0),n.renderer.setClearColor(p,g),A!=null&&a instanceof bt&&(a.aspect=A,a.updateProjectionMatrix()),n.renderer.xr.enabled=d}return null}let Lp=null;function LY(s,i){if(s){if(!s.startsWith("data:image")){console.error("Can not save image: Data url is not an image",s);return}Lp||(Lp=document.createElement("a")),Lp.href=s,Lp.download=i,Lp.click()}}let CC=0;function fP(s){s?CC++:CC--}function xJ(){return CC>0}class ML{constructor(i){h(this,"writer");this.writer=i}writeNode(i){}}class FY extends ML{beforeWriteNode(i,t){Pe.isGizmo(i)&&(t.keep=!1)}}class UY extends ML{beforeWriteTexture(i,t){i.isRenderTargetTexture&&(t.newTexture=VS(new Ut(1,1,1,0)))}}const NY={binary:!0,animations:!0};async function CJ(s){if(!s.context)throw new Error("No context provided to exportAsGLTF");s.scene||(s.scene=s.context.scene);const i={...NY,...s},{context:t}=i,n=new ob;n.register(l=>new L2(l)),n.register(l=>new FY(l)),n.register(l=>new UY(l)),w2(n,i.context);const r={binary:i.binary,animations:QY(t,i.scene,[])},o=new zY;console.log("Exporting GLTF",r),o.onBeforeExport(i),fP(!0);const a=await n.parseAsync(i.scene,r).catch(l=>(console.error(l),null));if(fP(!1),o.onAfterExport(i),!a)throw new Error("Failed to export GLTF");if(i.downloadAs!=null){let l=null;if(a instanceof ArrayBuffer?l=new Blob([a],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",a),l){const c=URL.createObjectURL(l),u=document.createElement("a");u.href=c;let d=i.downloadAs;!d.endsWith(".glb")&&!d.endsWith(".gltf")&&(d+=i.binary?".glb":".gltf"),u.download=d,u.click()}}return a}const pP=Symbol("needle:weight");class zY{constructor(){h(this,"_undo",[])}onBeforeExport(i){i.context.animations.mixers.forEach(t=>{const n=im.tryGetActionsFromMixer(t);if(n)for(let r=0;r<n.length;r++){const o=n[r];o[pP]=o.weight,o.weight=0,this._undo.push(()=>{o.weight=o[pP]})}t.update(0)})}onAfterExport(i){this._undo.forEach(t=>t()),this._undo.length=0}}function QY(s,i,t){s.animations.mixers.forEach(r=>{const o=im.tryGetActionsFromMixer(r);if(o)for(let a=0;a<o.length;a++){const c=o[a].getClip();t.push(c)}}),Array.isArray(i)||(i=[i]);for(const r of i)im.tryGetAnimationClipsFromObjectHierarchy(r,t);const n=new Set(t);return Array.from(n)}const gP="needle-button",kw=be();var au,lu,cu,js,Ll,wf,n0,DL,s0,OL,vm;class kL extends HTMLElement{constructor(){super();ji(this,n0);ji(this,s0);ji(this,au,void 0);ji(this,lu,void 0);ji(this,cu,void 0);ji(this,js,void 0);ji(this,Ll,void 0);ji(this,wf,void 0);ji(this,vm,t=>{kw&&console.log("Needle Button clicked"),!t.defaultPrevented&&De(this,js)&&De(this,js).click()});this.removeEventListener("click",De(this,vm)),this.addEventListener("click",De(this,vm))}attributeChangedCallback(t,n,r){Ph(this,n0,DL).call(this)}}au=new WeakMap,lu=new WeakMap,cu=new WeakMap,js=new WeakMap,Ll=new WeakMap,wf=new WeakMap,n0=new WeakSet,DL=function(){var n,r;if((n=De(this,js))==null||n.remove(),this.getAttribute("ar")!=null)De(this,Ll)??Gi(this,Ll,new rh),Gi(this,js,De(this,Ll).createARButton());else if(this.getAttribute("vr")!=null)De(this,Ll)??Gi(this,Ll,new rh),Gi(this,js,De(this,Ll).createVRButton());else if(this.getAttribute("quicklook")!=null)De(this,Ll)??Gi(this,Ll,new rh),Gi(this,js,De(this,Ll).createQuicklookButton());else{kw?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}De(this,au)??Gi(this,au,this.attachShadow({mode:"open"})),De(this,lu)??Gi(this,lu,document.createElement("slot")),De(this,cu)??Gi(this,cu,document.createElement("style")),De(this,cu).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(De(this,cu).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),De(this,lu).innerHTML=De(this,js).innerHTML,De(this,lu).style.cssText="display: flex; align-items: center; justify-content: center;",De(this,js).innerHTML=De(this,lu).outerHTML,De(this,au).innerHTML=De(this,js).outerHTML,De(this,au).prepend(De(this,cu)),fy(Fx,{element:De(this,au)}),(r=De(this,wf))==null||r.disconnect(),De(this,wf)??Gi(this,wf,new MutationObserver(()=>Ph(this,s0,OL).call(this))),De(this,wf).observe(De(this,js),{attributes:!0}),kw&&console.log("Needle Button updated")},s0=new WeakSet,OL=function(){De(this,js)&&(De(this,js).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},vm=new WeakMap,h(kL,"observedAttributes",["ar","vr","quicklook"]);typeof window<"u"&&!window.customElements.get(gP)&&window.customElements.define(gP,kL);const Gy=Q("debugmissingcamera");xt.registerCallback(ut.MissingCamera,s=>{var l,c,u;Gy&&console.warn("Creating missing camera");const i=s.context.scene,t=new bt;t.name="Default Fallback Camera",i.add(t);const n=new Bt;n.sourceId=((c=(l=s.files)==null?void 0:l[0])==null?void 0:c.src)??"unknown",(u=s.context.domElement.getAttribute("skybox-image"))!=null&&u.length||0>0||s.context.lightmaps.tryGetSkybox(n.sourceId)?n.clearFlags=hr.Skybox:n.clearFlags=hr.SolidColor,n.backgroundColor=new Ut(.5,.5,.5,1),n.fieldOfView=35,s.context.domElement.getAttribute("transparent")!=null&&(n.clearFlags=hr.Uninitialized),n.backgroundBlurriness=.2;const o=uf(t,n,!0);t.position.x=0,t.position.y=1,t.position.z=2;const a=s.context.domElement;return(a==null?void 0:a.cameraControls)!=!1&&LL(s.context,o),o});xt.registerCallback(ut.ContextCreated,s=>{if(!s.context.mainCamera){Gy&&console.log("Will not auto-fit because a default camera exists");return}const i=s.context.domElement;if((i==null?void 0:i.cameraControls)==!0){const t=iz(s.context.mainCamera);if((t==null?void 0:t.isCameraController)==!0){Gy&&console.log("Will not auto-fit because a camera controller exists");return}LL(s.context)}});function LL(s,i){i=i??s.mainCameraComponent;const t=i==null?void 0:i.gameObject;if(Gy&&console.log("Creating default camera controls",i==null?void 0:i.name),t){const n=S0(t,Lt);n.sourceId=(i==null?void 0:i.sourceId)??"unknown";const r=s.domElement.getAttribute("auto-rotate");if(n.autoRotate=r!=null&&r!="0"&&(r==null?void 0:r.toLowerCase())!="false",n.autoRotateSpeed=.5,n.autoFit=!0,n.autoRotate&&r){const o=parseFloat(r);isNaN(o)||(n.autoRotateSpeed=o)}}else console.warn("Missing camera object, can not add orbit controls")}const sd={Context:Ge,glTF:{loadFromURL:dL}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=sd;function FL(s){for(const i in s)sd[i]=s[i]}FL(MV);FL(eY);sd.onStart=qO;sd.onUpdate=XO;sd.onBeforeRender=qV;sd.NeedleXRSession=Fe;for(const s of Object.getOwnPropertyNames(j))switch(s){case"prototype":case"constructor":case"length":case"name":continue;default:sd[s]=j[s];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=nU;export{bJ as $physicsKey,Ct as ActionBuilder,GO as ActionCollection,Br as ActionModel,F6 as Addressables,D0 as AlignmentConstraint,La as AmbientMode,qs as Animation,Jo as AnimationCurve,z0 as AnimationExtension,eE as AnimationTrackHandler,im as AnimationUtils,Cs as Animator,zc as AnimatorConditionMode,yo as AnimatorController,Wx as AnimatorControllerParameterType,QA as AnimatorStateInfo,j0 as Antialiasing,Ja as Application,du as ApplicationEvents,A5 as AssetDatabase,tt as AssetReference,ju as AudioExtension,vu as AudioListener,kt as AudioSource,ff as AudioTrackHandler,Eu as Avatar,Gf as AvatarBlink_Simple,sh as AvatarEyeLook_Rotation,r2 as AvatarLoader,_n as AvatarMarker,aE as AvatarModel,wy as Avatar_Brain_LookAt,V0 as Avatar_MouthShapes,s2 as Avatar_MustacheShake,Kl as Avatar_POI,Nd as Axes,Lm as AxesHelper,tk as BUILD_TIME,sa as BaseUIComponent,o2 as BasicIKConstraint,cE as BehaviorExtension,cn as BehaviorModel,oe as Behaviour,Jl as BloomEffect,Vu as BoxCollider,Vf as BoxGizmo,Xo as BoxHelperComponent,_h as Button,Ha as ButtonsFactory,Ql as CallDirection,Nl as CallInfo,Bt as Camera,yy as CameraTargetReachedEvent,In as Canvas,Iu as CanvasGroup,dh as CapsuleCollider,Vl as ChangeMaterialOnClick,Wf as ChangeTransformOnClick,qf as CharacterController,xh as CharacterControllerInput,J0 as ChromaticAberration,wo as CircularBuffer,hr as ClearFlags,ya as ClipExtrapolation,Io as Collider,PY as Collision,Ay as CollisionDetectionMode,qu as ColorAdjustments,Xf as ColorBySpeedModule,eb as ColorOverLifetimeModule,oe as Component,em as ComponentEvents,x0 as ComponentLifecycleEvents,Ax as ConnectionEvents,BY as ContactPoint,bo as ContactShadows,Ge as Context,VK as ContextArgs,ut as ContextEvent,xt as ContextRegistry,tE as ControlTrackHandler,Ku as CustomBranding,to as CustomShader,rm as DefaultReflectionMode,P2 as Deletable,bE as DeleteBox,hl as DepthOfField,_E as DeviceFlag,M2 as DocumentExtension,wn as DragControls,gs as DragMode,$u as DropListener,Sh as Duplicatable,Dy as EffectWrapper,pc as EmissionModule,jm as EmphasizeOnClick,Dv as EngineLoadingView,ti as EventList,YS as EventListEvent,Dr as EventSystem,CE as EventTrigger,S2 as FieldWithDefault,ug as FileReference,Q6 as FileReferenceSerializer,KW as FileSpawnModel,My as File_Event,k2 as FixedJoint,D2 as FlyControls,Vm as Fog,qe as FrameEvent,fS as GENERATOR,j as GameObject,Pe as Gizmos,Ua as GltfExport,U2 as GltfExportBox,vf as GltfLoadEvent,ah as GltfLoadEventType,Xu as Gradient,Zl as Graphic,JS as GraphicRaycaster,Ho as Graphics,Wm as GridHelper,f2 as GridLayoutGroup,yh as GroundProjectedEnv,nu as GroupActionModel,CT as HideFlags,p2 as HideOnStart,rb as HingeJoint,d2 as HorizontalLayoutGroup,zK as HostData,zm as Image,hg as ImageReference,z6 as ImageReferenceSerializer,gc as InheritVelocityModule,n8 as Input,Pr as InputEventQueue,dt as InputEvents,uo as InputField,gf as InstanceHandle,pf as InstancingHandler,ta as InstancingUtil,Pf as InstantiateEvent,En as InstantiateIdProvider,ll as InstantiateOptions,B2 as Interactable,DK as JoinedRoomResponse,PK as KeyEventArgs,ur as Keyframe,lb as LODGroup,Jf as LODModel,OK as LeftRoomResponse,Hr as Light,xH as LightData,hn as LimitVelocityOverLifetimeModule,WK as LoadingElementOptions,N2 as LogStats,Yi as LogType,$l as LookAt,jf as LookAtConstraint,Is as MainModule,Vx as MarkerType,q0 as MaskableGraphic,ye as Mathf,Hf as MeshCollider,$0 as MeshRenderer,Se as MinMaxCurve,xn as MinMaxGradient,pt as NEEDLE_progressive,mA as NEKeyboardEvent,Dc as NEPointerEvent,kL as NeedleButtonElement,xt as NeedleEngine,vL as NeedleEngineHTMLElement,aL as NeedleGltfLoader,Ac as NeedleMenu,Wb as NeedlePatchesKey,yV as NeedleUSDZExporter,Gk as NeedleXRController,Fe as NeedleXRSession,Z8 as NeedleXRSync,u5 as NeedleXRUtils,RE as NestedGltf,J8 as NetworkConnection,Bi as NetworkedStreamEvents,H0 as NetworkedStreams,ph as Networking,Q5 as NewInstanceModel,Nt as NoiseModule,Co as ObjectRaycaster,Uu as ObjectUtils,Zf as OffsetConstraint,Ub as OneEuroFilter,QM as OneEuroFilterXYZ,Xm as OpenURL,Lt as OrbitControls,Um as Outline,us as OwnershipEvent,LD as OwnershipModel,Wu as Padding,Iy as ParticleBurst,UE as ParticleSubEmitter,wi as ParticleSystem,ed as ParticleSystemBaseBehaviour,la as ParticleSystemRenderer,Qs as ParticleSystemShapeType,Ag as PeerHandle,X8 as PeerNetworking,ag as Physics,AE as PhysicsExtension,mn as PhysicsMaterialCombine,Ab as PixelationEffect,Wa as PlayAnimationOnClick,Tu as PlayAudioOnClick,$a as PlayableDirector,um as PlayerColor,Zn as PlayerState,Kx as PlayerStateEvent,Gu as PlayerSync,pH as PlayerView,gH as PlayerViewManager,km as PointerEventData,Kc as PointerType,Es as PostProcessingEffect,NE as PostProcessingHandler,xb as PostProcessingManager,Gm as PreliminaryAction,Y0 as PreliminaryTrigger,Ko as PrimitiveType,at as Progress,NC as PromiseAllWithErrors,E1 as PromiseErrorResult,Ut as RGBAColor,_d as RapierPhysics,fE as RawImage,sc as RaycastOptions,c2 as Rect,ts as RectTransform,Wl as ReflectionProbe,iE as RegisteredAnimationInfo,lc as RemoteSkybox,gu as RenderTexture,jV as RenderTextureSerializer,ci as Renderer,wH as RendererData,Cy as RendererLightmap,It as Rigidbody,ki as RigidbodyConstraints,je as RoomEvents,To as RotationBySpeedModule,aa as RotationOverLifetimeModule,Zx as SceneLightSettings,Mn as SceneSwitcher,td as ScreenCapture,Eh as ScreenSpaceAmbientOcclusion,dl as ScreenSpaceAmbientOcclusionN8,Vo as SendQueue,tO as SerializationContext,ho as SetActiveOnClick,yb as ShadowCatcher,ei as ShapeModule,vb as SharpeningEffect,F0 as SignalAsset,nh as SignalReceiver,Om as SignalReceiverEvent,by as SignalTrackHandler,l2 as Size,mr as SizeBySpeedModule,Yu as SizeOverLifetimeModule,E2 as SkinnedMeshRenderer,tl as SmoothFollow,Au as SpatialGrabRaycaster,_b as SpatialHtml,wu as SpatialTrigger,ec as SpatialTriggerReceiver,QE as SpectatorCamera,Fm as SphereCollider,ND as SphereIntersection,MY as SphereOverlapResult,mc as Sprite,el as SpriteData,Gr as SpriteRenderer,Bu as SpriteSheet,rJ as StateMachineBehaviour,i2 as StreamEndedEvent,D9 as StreamReceivedEvent,Ny as SubEmitterSystem,Af as SyncedCamera,fl as SyncedRoom,rc as SyncedTransform,g2 as TapGestureTrigger,mE as TeleportTarget,iL as TestRunner,_J as TestSceneUtils,nL as TestSimulateUserData,$s as Text,vE as TextBuilder,ib as TextExtension,Ts as TextureSheetAnimationModule,yc as TiltShiftEffect,CH as Time,oc as ToneMappingEffect,U0 as TrackHandler,xr as TrackType,Ci as TrailModule,an as TransformData,ip as TransformGizmo,es as TriggerBuilder,ih as TriggerModel,O as TypeStore,ZS as UIRaycastUtils,O0 as UIRootComponent,_s as USDObject,AV as USDWriter,li as USDZExporter,ru as USDZText,yE as USDZUIExtension,TT as Upload_Result,GV as UriSerializer,nb as UsageMarker,LK as UserJoinedOrLeftRoomModel,Yo as VERSION,jO as VariantAction,Pi as VelocityOverLifetimeModule,u2 as VerticalLayoutGroup,Tn as VideoPlayer,Yl as ViewDevice,np as Vignette,K0 as VisibilityAction,Hu as Voip,xb as Volume,Ae as VolumeParameter,Q0 as VolumeProfile,jK as WaitForFrames,H6 as WaitForPromise,G6 as WaitForSeconds,Zc as Watch,GE as WebARCameraBackground,fh as WebARSessionRoot,Ai as WebXR,rh as WebXRButtonFactory,oh as WebXRImageTracking,bc as WebXRImageTrackingModel,Th as WebXRPlaneTracking,ou as WebXRTrackedImage,Rh as XRControllerFollow,ac as XRControllerModel,So as XRControllerMovement,Kn as XRFlag,HE as XRRig,bs as XRState,go as XRStateFlag,rL as __Ignore,y5 as __internalNotifyObjectDestroyed,$c as activeInHierarchyFieldName,pU as addAttributeChangeCallback,vo as addComponent,lJ as addCustomExtensionPlugin,JW as addFile,ZW as addFileFromUrl,fJ as addGltfLoadEventListener,uf as addNewComponent,yS as addPatch,NS as apply,vJ as applyHMRChanges,h6 as applyPrototypeExtensions,z5 as beginListenDestroy,$W as beginListenFileSpawn,j5 as beginListenInstantiate,Vk as binaryIdentifierCasts,HK as build_scene_functions,xd as builtinComponentKeyName,IO as calculateProgress01,iK as clearBalloonMessages,iK as clearOverlayMessages,KK as colorSerializer,K5 as compareAssociation,Q_ as componentSerializer,gz as copyTexture,uL as createLoader,h9 as createMotion,sr as debugNet,xA as debugOwner,h0 as deepClone,nc as delay,LC as delayForFrames,Sx as deserializeObject,xo as destroy,x6 as destroyComponentInstance,si as disposeObjectResources,Hl as disposeStream,L6 as download,gO as download_file,vv as editorGuidKeyName,jB as effectsOrder,of as enableSpatialConsole,JK as euler,ZK as eventListSerializer,CJ as exportAsGLTF,T0 as findByGuid,US as findObjectOfType,C6 as findObjectsOfType,HD as findResourceUsers,yz as fitObjectIntoVolume,Df as foreachComponent,QS as foreachComponentEnumerator,rK as forward,AU as generateQRCode,kS as generateSeed,sl as getBoundingBox,iz as getCameraController,Qf as getComponent,I0 as getComponentInChildren,ly as getComponentInParent,E0 as getComponents,Im as getComponentsInChildren,FS as getComponentsInParent,gV as getFormattedDate,ys as getIconElement,jT as getIconTexture,$Y as getIp,eK as getIpAndLocation,ZY as getIpCloudflare,nl as getLoader,S0 as getOrAddComponent,Q as getParam,oK as getParentHierarchyPath,JY as getPath,MK as getPeerOptions,q8 as getPeerjsInstance,NK as getResourceUserCount,az as getTempColor,Ia as getTempQuaternion,Be as getTempVector,c0 as getUrlParams,vz as getVisibleInCustomShadowRendering,GM as getWorldDirection,HM as getWorldEuler,Ve as getWorldPosition,Ht as getWorldQuaternion,m0 as getWorldRotation,oi as getWorldScale,eh as hasCommercialLicense,SO as hasIndieLicense,Gx as hasPointerEventComponent,pu as hasProLicense,pO as hash,Ez as hideDebugConsole,CV as imageToCanvas,Rm as instantiate,x2 as invokeAfterImportPluginHooks,YG as invokeXRSessionEnd,XG as invokeXRSessionStart,S6 as isActiveInHierarchy,Tm as isActiveSelf,uU as isAndroidDevice,pz as isAnimationAction,qY as isDebugMode,Gg as isDesktop,kf as isDestroyed,be as isDevEnvironment,UK as isDisposed,xJ as isExporting,sU as isHostedOnGlitch,gJ as isHotReloading,IH as isIconElement,fr as isLocalNetwork,S1 as isMacOS,uc as isMobileDevice,rf as isMozillaXR,UC as isQuest,v5 as isResourceTrackingEnabled,$p as isSafari,zS as isUsingInstancing,Cu as isiOS,dL as loadSync,Xw as logHierarchy,sK as lookAtInverse,g0 as lookAtObject,YY as makeId,aU as makeIdFromRandomWords,ol as makeNameSafeForUSD,E6 as markAsInstancedRendered,lA as microphonePermissionsGranted,WY as nameof,rU as nameofFactory,UV as objectSerializer,IK as offXRSessionEnd,EK as offXRSessionStart,nJ as onAfterRender,qV as onBeforeRender,tJ as onClear,iJ as onDestroy,eJ as onInitialized,qO as onStart,XO as onUpdate,Qk as onXRSessionEnd,xS as onXRSessionStart,cY as parseSync,bz as placeOnSurface,XM as postprocessFBXMaterials,sJ as prefix,oU as pushState,KY as randomNumber,Wk as registerBinaryType,WS as registerComponent,b2 as registerComponentExtension,oa as registerCustomEffectType,w2 as registerExportExtensions,_2 as registerExtensions,mJ as registerHotReloadType,HP as registerLoader,H5 as registerPrefabProvider,u6 as registerPrototypeExtensions,QK as registerType,cU as relativePathPrefix,gU as removeAttributeChangeCallback,rO as removeComponent,cJ as removeCustomImportExtensionType,pJ as removeGltfLoadEventListener,fK as removePatch,Ou as resolveUrl,lU as sanitizeString,LY as saveImage,wJ as screenshot,OY as screenshot2,KD as sendDestroyed,v as serializable,i6 as serializeObject,Pm as serializeable,Bv as setActive,bU as setAllowBalloonMessages,tK as setAllowOverlayMessages,N1 as setAutoFitEnabled,U1 as setCameraController,I6 as setDestroyed,lK as setDevEnvironment,jD as setDisposable,ST as setDontDestroy,w1 as setOrAddParamsToUrl,XY as setParam,Qw as setParamWithoutReload,kK as setPeerOptions,FK as setResourceTrackingEnabled,VP as setState,qM as setVisibleInCustomShadowRendering,VM as setWorldEuler,Sn as setWorldPosition,Tf as setWorldPositionXYZ,na as setWorldQuaternion,jM as setWorldQuaternionXYZW,WM as setWorldRotation,A0 as setWorldRotationXYZ,Kg as setWorldScale,dS as showBalloonError,bi as showBalloonMessage,Xt as showBalloonWarning,JM as showDebugConsole,nK as slerp,C0 as syncDestroy,e2 as syncField,JD as syncInstantiate,aK as textureToCanvas,h8 as tryCastBinary,lY as tryDetermineFileTypeFromBinary,aY as tryDetermineFileTypeFromURL,jg as tryFindObject,u8 as tryGetGuid,AJ as unregisterHotReloadType,WP as unwatchWrite,O6 as upload_file,nz as useForAutoFit,Ss as validate,FC as watchWrite};
